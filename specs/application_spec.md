

![Connectivity Standards Alliance (CSA) logo](2dfa6ac3edfe874f68aa0cbccaa42322_img.jpg)

The logo for the Connectivity Standards Alliance (CSA) features the lowercase letters "csa" in a bold, blue, sans-serif font. The letter "s" is stylized with a loop at the top, resembling a lowercase "e".

Connectivity Standards Alliance (CSA) logo



# Matter Application Cluster SpecificationVersion 1.5

|               |                                                                                                                                                                          |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Document:     | 23-27350-008_Matter-1.5-Application-Cluster-Specification.pdf<br>November 10, 2025                                                                                       |
| Sponsored by: | Connectivity Standards Alliance                                                                                                                                          |
| Accepted by:  | This document has been accepted for release by the Connectivity Standards Alliance Board of Directors on <b>November 10, 2025</b>                                        |
| Abstract:     | The Matter Application Clusters specified in this document are generic interfaces that are sufficiently general to be of use across a wide range of application domains. |
| Keywords:     | Referenced in Chapter 1.                                                                                                                                                 |

---

Copyright © 2022-2025 Connectivity Standards Alliance, Inc.  
508 Second Street, Suite 109B Davis, CA 95616 - USA  
[www.csa-iot.org](http://www.csa-iot.org)  
All rights reserved.

Permission is granted to members of the Connectivity Standards Alliance to reproduce this document for their own use or the use of other Connectivity Standards Alliance members only, provided this notice is included. All other rights reserved. Duplication for sale, or for commercial or for-profit use is strictly prohibited without the prior written consent of the Connectivity Standards Alliance.



![Matter logo](1df14e8a75f3f3fcf750749dbbd2c3f1_img.jpg)

The logo consists of a stylized icon followed by the word "matter". The icon is a black, geometric shape resembling a stylized letter 'M' or a cluster of three connected nodes. To the right of the icon is the word "matter" in a lowercase, sans-serif font.

Matter logo

# Matter Application Clusters

Version 1.5, 2025-11-10 08:42:52 -0800: Approved





# Copyright Notice, License and Disclaimer

Copyright © Connectivity Standards Alliance (2021-2025). All rights reserved. The information within this document is the property of the Connectivity Standards Alliance and its use and disclosure are restricted, except as expressly set forth herein.

Connectivity Standards Alliance hereby grants you a fully-paid, non-exclusive, nontransferable, worldwide, limited and revocable license (without the right to sublicense), under Connectivity Standards Alliance's applicable copyright rights, to view, download, save, reproduce and use the document solely for your own internal purposes and in accordance with the terms of the license set forth herein. This license does not authorize you to, and you expressly warrant that you shall not: (a) permit others (outside your organization) to use this document; (b) post or publish this document; (c) modify, adapt, translate, or otherwise change this document in any manner or create any derivative work based on this document; (d) remove or modify any notice or label on this document, including this Copyright Notice, License and Disclaimer. The Connectivity Standards Alliance does not grant you any license hereunder other than as expressly stated herein.

Elements of this document may be subject to third party intellectual property rights, including without limitation, patent, copyright or trademark rights, and any such third party may or may not be a member of the Connectivity Standards Alliance. Connectivity Standards Alliance members grant other Connectivity Standards Alliance members certain intellectual property rights as set forth in the Connectivity Standards Alliance IPR Policy. Connectivity Standards Alliance members do not grant you any rights under this license. The Connectivity Standards Alliance is not responsible for, and shall not be held responsible in any manner for, identifying or failing to identify any or all such third party intellectual property rights. Please visit [www.csa-iot.org](http://www.csa-iot.org) for more information on how to become a member of the Connectivity Standards Alliance.

This document and the information contained herein are provided on an "AS IS" basis and the Connectivity Standards Alliance DISCLAIMS ALL WARRANTIES EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO (A) ANY WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OF THIRD PARTIES (INCLUDING WITHOUT LIMITATION ANY INTELLECTUAL PROPERTY RIGHTS INCLUDING PATENT, COPYRIGHT OR TRADEMARK RIGHTS); OR (B) ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE OR NONINFRINGEMENT. IN NO EVENT WILL THE CONNECTIVITY STANDARDS ALLIANCE BE LIABLE FOR ANY LOSS OF PROFITS, LOSS OF BUSINESS, LOSS OF USE OF DATA, INTERRUPTION OF BUSINESS, OR FOR ANY OTHER DIRECT, INDIRECT, SPECIAL OR EXEMPLARY, INCIDENTAL, PUNITIVE OR CONSEQUENTIAL DAMAGES OF ANY KIND, IN CONTRACT OR IN TORT, IN CONNECTION WITH THIS DOCUMENT OR THE INFORMATION CONTAINED HEREIN, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH LOSS OR DAMAGE.

All company, brand and product names in this document may be trademarks that are the sole property of their respective owners.

This notice and disclaimer must be included on all copies of this document.

Connectivity Standards Alliance  
508 Second Street, Suite 206  
Davis, CA 95616, USA



Page 1



Page 2



## Revision History

| Revision | Date               | Details       | Editor          |
|----------|--------------------|---------------|-----------------|
| 1        | September 23, 2022 | Version 1.0   | Robert Szewczyk |
| 2        | May 17, 2023       | Version 1.1   | Robert Szewczyk |
| 3        | October 18, 2023   | Version 1.2   | Robert Szewczyk |
| 4        | April 17, 2024     | Version 1.3   | Robert Szewczyk |
| 5        | November 4, 2024   | Version 1.4   | Robert Szewczyk |
| 6        | March 17, 2025     | Version 1.4.1 | Robert Szewczyk |
| 7        | July 16, 2025      | Version 1.4.2 | Robert Szewczyk |
| 8        | November 10, 2025  | Version 1.5   | Robert Szewczyk |



Page 3



Page 4







## Table of Contents

|                                                           |    |
|-----------------------------------------------------------|----|
| Copyright Notice, License and Disclaimer .....            | 1  |
| Revision History .....                                    | 3  |
| Introduction .....                                        | 25 |
| Scope and Purpose .....                                   | 25 |
| References .....                                          | 25 |
| Connectivity Standards Alliance Reference Documents ..... | 25 |
| External Reference Documents .....                        | 26 |
| Provisional .....                                         | 28 |
| List of Provisional Items .....                           | 28 |
| 1. General .....                                          | 29 |
| 1.1. General Description .....                            | 29 |
| 1.1.1. Introduction .....                                 | 29 |
| 1.1.2. Cluster List .....                                 | 29 |
| 1.2. Identify Cluster .....                               | 30 |
| 1.2.1. Revision History .....                             | 31 |
| 1.2.2. Classification .....                               | 31 |
| 1.2.3. Cluster ID .....                                   | 31 |
| 1.2.4. Data Types .....                                   | 31 |
| 1.2.5. Attributes .....                                   | 33 |
| 1.2.6. Commands .....                                     | 33 |
| 1.3. Groups Cluster .....                                 | 35 |
| 1.3.1. Revision History .....                             | 35 |
| 1.3.2. Classification .....                               | 35 |
| 1.3.3. Cluster ID .....                                   | 36 |
| 1.3.4. Features .....                                     | 36 |
| 1.3.5. Data Types .....                                   | 36 |
| 1.3.6. Attributes .....                                   | 36 |
| 1.3.7. Commands .....                                     | 36 |
| 1.4. Scenes Management Cluster .....                      | 44 |
| 1.4.1. Revision History .....                             | 44 |
| 1.4.2. Classification .....                               | 44 |
| 1.4.3. Cluster ID .....                                   | 44 |
| 1.4.4. Features .....                                     | 44 |
| 1.4.5. Dependencies .....                                 | 45 |
| 1.4.6. Handling of fabric-scoping .....                   | 45 |
| 1.4.7. Data Types .....                                   | 45 |
| 1.4.8. Attributes .....                                   | 51 |
| 1.4.9. Commands .....                                     | 51 |



Page 5



|                                                |     |
|------------------------------------------------|-----|
| 1.5. On/Off Cluster .....                      | 65  |
| 1.5.1. Revision History .....                  | 65  |
| 1.5.2. Classification .....                    | 65  |
| 1.5.3. Cluster ID .....                        | 65  |
| 1.5.4. Features .....                          | 65  |
| 1.5.5. Data Types .....                        | 67  |
| 1.5.6. Attributes .....                        | 68  |
| 1.5.7. Commands .....                          | 70  |
| 1.5.8. State Description .....                 | 73  |
| 1.6. Level Control Cluster .....               | 74  |
| 1.6.1. Revision History .....                  | 74  |
| 1.6.2. Classification .....                    | 75  |
| 1.6.3. Cluster ID .....                        | 75  |
| 1.6.4. Features .....                          | 75  |
| 1.6.5. Data Types .....                        | 78  |
| 1.6.6. Attributes .....                        | 78  |
| 1.6.7. Commands .....                          | 83  |
| 1.6.8. State Change Table for Lighting .....   | 88  |
| 1.7. Boolean State Cluster .....               | 89  |
| 1.7.1. Revision History .....                  | 89  |
| 1.7.2. Classification .....                    | 90  |
| 1.7.3. Cluster ID .....                        | 90  |
| 1.7.4. Attributes .....                        | 90  |
| 1.7.5. Events .....                            | 90  |
| 1.8. Boolean State Configuration Cluster ..... | 91  |
| 1.8.1. Revision History .....                  | 91  |
| 1.8.2. Classification .....                    | 91  |
| 1.8.3. Cluster ID .....                        | 91  |
| 1.8.4. Features .....                          | 91  |
| 1.8.5. Data Types .....                        | 92  |
| 1.8.6. Attributes .....                        | 92  |
| 1.8.7. Commands .....                          | 94  |
| 1.8.8. Events .....                            | 96  |
| 1.9. Mode Select Cluster .....                 | 97  |
| 1.9.1. Revision History .....                  | 97  |
| 1.9.2. Classification .....                    | 98  |
| 1.9.3. Cluster ID .....                        | 98  |
| 1.9.4. Features .....                          | 98  |
| 1.9.5. Data Types .....                        | 98  |
| 1.9.6. Attributes .....                        | 99  |
| 1.9.7. Commands .....                          | 101 |

Page 6



|                                                    |     |
|----------------------------------------------------|-----|
| 1.10. Mode Base Cluster .....                      | 102 |
| 1.10.1. Revision History .....                     | 102 |
| 1.10.2. Classification .....                       | 102 |
| 1.10.3. Cluster ID .....                           | 103 |
| 1.10.4. Features .....                             | 103 |
| 1.10.5. Data Types .....                           | 103 |
| 1.10.6. Attributes .....                           | 105 |
| 1.10.7. Commands .....                             | 107 |
| 1.10.8. Mode Namespace .....                       | 109 |
| 1.11. Low Power Cluster .....                      | 111 |
| 1.11.1. Revision History .....                     | 111 |
| 1.11.2. Classification .....                       | 112 |
| 1.11.3. Cluster ID .....                           | 112 |
| 1.11.4. Commands .....                             | 112 |
| 1.12. Wake On LAN Cluster .....                    | 112 |
| 1.12.1. Revision History .....                     | 113 |
| 1.12.2. Classification .....                       | 113 |
| 1.12.3. Cluster ID .....                           | 113 |
| 1.12.4. Attributes .....                           | 113 |
| 1.13. Switch Cluster .....                         | 114 |
| 1.13.1. Revision History .....                     | 114 |
| 1.13.2. Classification .....                       | 114 |
| 1.13.3. Cluster ID .....                           | 114 |
| 1.13.4. Features .....                             | 114 |
| 1.13.5. Attributes .....                           | 116 |
| 1.13.6. Events .....                               | 117 |
| 1.13.7. Sequence of generated events .....         | 121 |
| 1.13.8. Sequence of events for MultiPress .....    | 124 |
| 1.13.9. Summary of cases for MS feature flag ..... | 128 |
| 1.13.10. Multi Position Details .....              | 129 |
| 1.14. Operational State Cluster .....              | 132 |
| 1.14.1. Revision History .....                     | 132 |
| 1.14.2. Classification .....                       | 133 |
| 1.14.3. Cluster ID .....                           | 133 |
| 1.14.4. Data Types .....                           | 133 |
| 1.14.5. Attributes .....                           | 136 |
| 1.14.6. Commands .....                             | 138 |
| 1.14.7. Events .....                               | 141 |
| 1.15. Alarm Base Cluster .....                     | 143 |
| 1.15.1. Revision History .....                     | 143 |
| 1.15.2. Classification .....                       | 143 |




Page 7



|                                            |     |
|--------------------------------------------|-----|
| 1.15.3. Cluster ID .....                   | 143 |
| 1.15.4. Features .....                     | 143 |
| 1.15.5. Data Types .....                   | 144 |
| 1.15.6. Attributes .....                   | 144 |
| 1.15.7. Commands .....                     | 144 |
| 1.15.8. Events .....                       | 146 |
| 1.16. Messages Cluster .....               | 146 |
| 1.16.1. Revision History .....             | 147 |
| 1.16.2. Classification .....               | 147 |
| 1.16.3. Cluster ID .....                   | 147 |
| 1.16.4. Features .....                     | 147 |
| 1.16.5. Data Types .....                   | 148 |
| 1.16.6. Attributes .....                   | 151 |
| 1.16.7. Commands .....                     | 152 |
| 1.16.8. Events .....                       | 154 |
| 1.17. Service Area Cluster .....           | 156 |
| 1.17.1. Revision History .....             | 156 |
| 1.17.2. Classification .....               | 156 |
| 1.17.3. Cluster ID .....                   | 156 |
| 1.17.4. Features .....                     | 157 |
| 1.17.5. Data Types .....                   | 157 |
| 1.17.6. Attributes .....                   | 163 |
| 1.17.7. Commands .....                     | 168 |
| 2. Measurement and Sensing .....           | 173 |
| 2.1. General Description .....             | 173 |
| 2.1.1. Introduction .....                  | 173 |
| 2.1.2. Cluster List .....                  | 173 |
| 2.1.3. Data Types .....                    | 174 |
| 2.1.4. Measured Value .....                | 179 |
| 2.1.5. Measurement Accuracy .....          | 179 |
| 2.2. Illuminance Measurement Cluster ..... | 179 |
| 2.2.1. Revision History .....              | 180 |
| 2.2.2. Classification .....                | 180 |
| 2.2.3. Cluster ID .....                    | 180 |
| 2.2.4. Data Types .....                    | 180 |
| 2.2.5. Attributes .....                    | 180 |
| 2.3. Temperature Measurement Cluster ..... | 182 |
| 2.3.1. Revision History .....              | 182 |
| 2.3.2. Classification .....                | 182 |
| 2.3.3. Cluster ID .....                    | 182 |
| 2.3.4. Attributes .....                    | 182 |

Page 8



|                                                |     |
|------------------------------------------------|-----|
| 2.4. Pressure Measurement Cluster .....        | 183 |
| 2.4.1. Revision History .....                  | 183 |
| 2.4.2. Classification .....                    | 184 |
| 2.4.3. Cluster ID .....                        | 184 |
| 2.4.4. Features .....                          | 184 |
| 2.4.5. Attributes .....                        | 184 |
| 2.5. Flow Measurement Cluster .....            | 186 |
| 2.5.1. Revision History .....                  | 186 |
| 2.5.2. Classification .....                    | 186 |
| 2.5.3. Cluster ID .....                        | 186 |
| 2.5.4. Attributes .....                        | 187 |
| 2.6. Water Content Measurement Clusters .....  | 188 |
| 2.6.1. Revision History .....                  | 188 |
| 2.6.2. Classification .....                    | 188 |
| 2.6.3. Cluster ID .....                        | 188 |
| 2.6.4. Attributes .....                        | 188 |
| 2.7. Occupancy Sensing Cluster .....           | 189 |
| 2.7.1. Revision History .....                  | 189 |
| 2.7.2. Classification .....                    | 190 |
| 2.7.3. Cluster ID .....                        | 190 |
| 2.7.4. Features .....                          | 190 |
| 2.7.5. Data Types .....                        | 191 |
| 2.7.6. Attributes .....                        | 193 |
| 2.7.7. Events .....                            | 199 |
| 2.8. Resource Monitoring Clusters .....        | 199 |
| 2.8.1. Revision History .....                  | 200 |
| 2.8.2. Classification .....                    | 200 |
| 2.8.3. Cluster IDs .....                       | 200 |
| 2.8.4. Features .....                          | 200 |
| 2.8.5. Data Types .....                        | 201 |
| 2.8.6. Attributes .....                        | 202 |
| 2.8.7. Commands .....                          | 203 |
| 2.9. Air Quality Cluster .....                 | 204 |
| 2.9.1. Revision History .....                  | 204 |
| 2.9.2. Classification .....                    | 204 |
| 2.9.3. Cluster ID .....                        | 204 |
| 2.9.4. Features .....                          | 204 |
| 2.9.5. Data Types .....                        | 205 |
| 2.9.6. Attributes .....                        | 205 |
| 2.10. Concentration Measurement Clusters ..... | 205 |
| 2.10.1. Revision History .....                 | 205 |





Page 9



|                                                   |     |
|---------------------------------------------------|-----|
| 2.10.2. Classification .....                      | 206 |
| 2.10.3. Cluster IDs .....                         | 206 |
| 2.10.4. Features .....                            | 207 |
| 2.10.5. Data Types .....                          | 207 |
| 2.10.6. Attributes .....                          | 208 |
| 2.11. Smoke CO Alarm Cluster .....                | 211 |
| 2.11.1. Revision History .....                    | 211 |
| 2.11.2. Classification .....                      | 211 |
| 2.11.3. Cluster ID .....                          | 211 |
| 2.11.4. Features .....                            | 211 |
| 2.11.5. Data Types .....                          | 211 |
| 2.11.6. Attributes .....                          | 215 |
| 2.11.7. Commands .....                            | 218 |
| 2.11.8. Events .....                              | 218 |
| 2.12. Electrical Energy Measurement Cluster ..... | 221 |
| 2.12.1. Revision History .....                    | 221 |
| 2.12.2. Classification .....                      | 221 |
| 2.12.3. Cluster ID .....                          | 221 |
| 2.12.4. Features .....                            | 221 |
| 2.12.5. Data Types .....                          | 222 |
| 2.12.6. Attributes .....                          | 231 |
| 2.12.7. Events .....                              | 233 |
| 2.13. Electrical Power Measurement Cluster .....  | 234 |
| 2.13.1. Revision History .....                    | 234 |
| 2.13.2. Classification .....                      | 235 |
| 2.13.3. Cluster ID .....                          | 235 |
| 2.13.4. Features .....                            | 235 |
| 2.13.5. Data Types .....                          | 236 |
| 2.13.6. Attributes .....                          | 243 |
| 2.13.7. Events .....                              | 250 |
| 2.14. Zone Management Cluster .....               | 251 |
| 2.14.1. Revision History .....                    | 251 |
| 2.14.2. Classification .....                      | 251 |
| 2.14.3. Cluster ID .....                          | 251 |
| 2.14.4. Features .....                            | 252 |
| 2.14.5. Data Types .....                          | 252 |
| 2.14.6. Attributes .....                          | 258 |
| 2.14.7. Commands .....                            | 260 |
| 2.14.8. Events .....                              | 264 |
| 2.15. Soil Measurement Cluster .....              | 265 |
| 2.15.1. Revision History .....                    | 265 |

Page 10



|                                                   |     |
|---------------------------------------------------|-----|
| 2.15.2. Classification .....                      | 265 |
| 2.15.3. Cluster ID .....                          | 266 |
| 2.15.4. Attributes .....                          | 266 |
| 3. Lighting .....                                 | 269 |
| 3.1. General Description .....                    | 269 |
| 3.1.1. Introduction .....                         | 269 |
| 3.1.2. Terms .....                                | 269 |
| 3.1.3. The Dimming Light Curve .....              | 269 |
| 3.1.4. Cluster List .....                         | 270 |
| 3.2. Color Control Cluster .....                  | 270 |
| 3.2.1. Revision History .....                     | 270 |
| 3.2.2. Classification .....                       | 271 |
| 3.2.3. Cluster ID .....                           | 271 |
| 3.2.4. Features .....                             | 271 |
| 3.2.5. Dependencies .....                         | 272 |
| 3.2.6. Data Types .....                           | 273 |
| 3.2.7. Attributes .....                           | 277 |
| 3.2.8. Commands .....                             | 289 |
| 4. HVAC .....                                     | 313 |
| 4.1. General Description .....                    | 313 |
| 4.1.1. Introduction .....                         | 313 |
| 4.1.2. Terms .....                                | 313 |
| 4.1.3. Cluster List .....                         | 313 |
| 4.2. Pump Configuration and Control Cluster ..... | 313 |
| 4.2.1. Revision History .....                     | 314 |
| 4.2.2. Classification .....                       | 314 |
| 4.2.3. Cluster ID .....                           | 314 |
| 4.2.4. Features .....                             | 314 |
| 4.2.5. Dependencies .....                         | 315 |
| 4.2.6. Data Types .....                           | 315 |
| 4.2.7. Attributes .....                           | 319 |
| 4.2.8. Events .....                               | 326 |
| 4.3. Thermostat Cluster .....                     | 327 |
| 4.3.1. Revision History .....                     | 327 |
| 4.3.2. Classification .....                       | 328 |
| 4.3.3. Cluster ID .....                           | 328 |
| 4.3.4. Features .....                             | 328 |
| 4.3.5. Units of Temperature .....                 | 329 |
| 4.3.6. Setpoint Limits .....                      | 330 |
| 4.3.7. Dependencies .....                         | 331 |
| 4.3.8. Data Types .....                           | 331 |



Page 11



|                                                            |     |
|------------------------------------------------------------|-----|
| 4.3.9. Attributes .....                                    | 348 |
| 4.3.10. Commands .....                                     | 368 |
| 4.4. Fan Control Cluster .....                             | 374 |
| 4.4.1. Revision History .....                              | 374 |
| 4.4.2. Classification .....                                | 374 |
| 4.4.3. Cluster ID .....                                    | 374 |
| 4.4.4. Features .....                                      | 375 |
| 4.4.5. Data Types .....                                    | 375 |
| 4.4.6. Attributes .....                                    | 377 |
| 4.4.7. Commands .....                                      | 384 |
| 4.5. Thermostat User Interface Configuration Cluster ..... | 385 |
| 4.5.1. Revision History .....                              | 385 |
| 4.5.2. Classification .....                                | 386 |
| 4.5.3. Cluster ID .....                                    | 386 |
| 4.5.4. Conversion of Temperature Values for Display .....  | 386 |
| 4.5.5. Data Types .....                                    | 386 |
| 4.5.6. Attributes .....                                    | 387 |
| 4.6. Valve Configuration and Control Cluster .....         | 388 |
| 4.6.1. Revision History .....                              | 388 |
| 4.6.2. Classification .....                                | 388 |
| 4.6.3. Cluster ID .....                                    | 388 |
| 4.6.4. Features .....                                      | 388 |
| 4.6.5. Data Types .....                                    | 389 |
| 4.6.6. Status Codes .....                                  | 390 |
| 4.6.7. Attributes .....                                    | 390 |
| 4.6.8. Commands .....                                      | 393 |
| 4.6.9. Events .....                                        | 395 |
| 5. Entry Control .....                                     | 397 |
| 5.1. General Description .....                             | 397 |
| 5.1.1. Introduction .....                                  | 397 |
| 5.1.2. Cluster List .....                                  | 397 |
| 5.2. Door Lock Cluster .....                               | 397 |
| 5.2.1. Revision History .....                              | 398 |
| 5.2.2. Classification .....                                | 398 |
| 5.2.3. Cluster ID .....                                    | 398 |
| 5.2.4. Features .....                                      | 399 |
| 5.2.5. Recommended steps for creating a new User .....     | 402 |
| 5.2.6. Data Types .....                                    | 402 |
| 5.2.7. Status Codes .....                                  | 419 |
| 5.2.8. PIN/RFID Code Format .....                          | 420 |
| 5.2.9. Attributes .....                                    | 420 |

Page 12



|                                                                                 |     |
|---------------------------------------------------------------------------------|-----|
| 5.2.10. Commands .....                                                          | 431 |
| 5.2.11. Events .....                                                            | 471 |
| 5.3. Window Covering Cluster .....                                              | 477 |
| 5.3.1. Revision History .....                                                   | 477 |
| 5.3.2. Classification .....                                                     | 477 |
| 5.3.3. Cluster ID .....                                                         | 478 |
| 5.3.4. Features .....                                                           | 478 |
| 5.3.5. Data Types .....                                                         | 479 |
| 5.3.6. Attributes .....                                                         | 485 |
| 5.3.7. Commands .....                                                           | 491 |
| 5.4. Closure Control Cluster .....                                              | 494 |
| 5.4.1. Revision History .....                                                   | 494 |
| 5.4.2. Classification .....                                                     | 494 |
| 5.4.3. Cluster ID .....                                                         | 494 |
| 5.4.4. Association Between Closure Control and Closure Dimension Clusters ..... | 495 |
| 5.4.5. Features .....                                                           | 495 |
| 5.4.6. Data Types .....                                                         | 497 |
| 5.4.7. Attributes .....                                                         | 503 |
| 5.4.8. Commands .....                                                           | 506 |
| 5.4.9. Events .....                                                             | 509 |
| 5.5. Closure Dimension Cluster .....                                            | 510 |
| 5.5.1. Revision History .....                                                   | 511 |
| 5.5.2. Classification .....                                                     | 511 |
| 5.5.3. Cluster ID .....                                                         | 511 |
| 5.5.4. Association Between Closure Control and Closure Dimension Clusters ..... | 511 |
| 5.5.5. Features .....                                                           | 511 |
| 5.5.6. Data Types .....                                                         | 513 |
| 5.5.7. Attributes .....                                                         | 520 |
| 5.5.8. Commands .....                                                           | 524 |
| 6. Media .....                                                                  | 531 |
| 6.1. General Description .....                                                  | 531 |
| 6.1.1. Introduction .....                                                       | 531 |
| 6.1.2. Cluster List .....                                                       | 531 |
| 6.2. Account Login Cluster .....                                                | 533 |
| 6.2.1. Revision History .....                                                   | 534 |
| 6.2.2. Classification .....                                                     | 534 |
| 6.2.3. Cluster ID .....                                                         | 534 |
| 6.2.4. Commands .....                                                           | 534 |
| 6.2.5. Events .....                                                             | 538 |
| 6.3. Application Basic Cluster .....                                            | 538 |
| 6.3.1. Revision History .....                                                   | 538 |




Page 13



|                                         |     |
|-----------------------------------------|-----|
| 6.3.2. Classification .....             | 538 |
| 6.3.3. Cluster ID .....                 | 539 |
| 6.3.4. Data Types .....                 | 539 |
| 6.3.5. Attributes .....                 | 540 |
| 6.4. Application Launcher Cluster ..... | 541 |
| 6.4.1. Revision History .....           | 541 |
| 6.4.2. Classification .....             | 541 |
| 6.4.3. Cluster ID .....                 | 542 |
| 6.4.4. Features .....                   | 542 |
| 6.4.5. Data Types .....                 | 542 |
| 6.4.6. Attributes .....                 | 543 |
| 6.4.7. Commands .....                   | 544 |
| 6.5. Audio Output Cluster .....         | 546 |
| 6.5.1. Revision History .....           | 547 |
| 6.5.2. Classification .....             | 547 |
| 6.5.3. Cluster ID .....                 | 547 |
| 6.5.4. Features .....                   | 547 |
| 6.5.5. Data Types .....                 | 547 |
| 6.5.6. Attributes .....                 | 548 |
| 6.5.7. Commands .....                   | 548 |
| 6.6. Channel Cluster .....              | 549 |
| 6.6.1. Revision History .....           | 550 |
| 6.6.2. Classification .....             | 550 |
| 6.6.3. Cluster ID .....                 | 550 |
| 6.6.4. Features .....                   | 550 |
| 6.6.5. Data Types .....                 | 550 |
| 6.6.6. Attributes .....                 | 559 |
| 6.6.7. Commands .....                   | 559 |
| 6.7. Content Launcher Cluster .....     | 565 |
| 6.7.1. Revision History .....           | 565 |
| 6.7.2. Classification .....             | 566 |
| 6.7.3. Cluster ID .....                 | 566 |
| 6.7.4. Features .....                   | 566 |
| 6.7.5. Data Types .....                 | 566 |
| 6.7.6. Attributes .....                 | 575 |
| 6.7.7. Commands .....                   | 576 |
| 6.8. Keypad Input Cluster .....         | 579 |
| 6.8.1. Revision History .....           | 579 |
| 6.8.2. Classification .....             | 579 |
| 6.8.3. Cluster ID .....                 | 579 |
| 6.8.4. Features .....                   | 579 |

Page 14



|                                          |     |
|------------------------------------------|-----|
| 6.8.5. Data Types .....                  | 580 |
| 6.8.6. Commands .....                    | 583 |
| 6.9. Media Input Cluster .....           | 584 |
| 6.9.1. Revision History .....            | 584 |
| 6.9.2. Classification .....              | 584 |
| 6.9.3. Cluster ID .....                  | 584 |
| 6.9.4. Features .....                    | 584 |
| 6.9.5. Data Types .....                  | 585 |
| 6.9.6. Attributes .....                  | 586 |
| 6.9.7. Commands .....                    | 586 |
| 6.10. Media Playback Cluster .....       | 587 |
| 6.10.1. Revision History .....           | 587 |
| 6.10.2. Classification .....             | 588 |
| 6.10.3. Cluster ID .....                 | 588 |
| 6.10.4. Features .....                   | 588 |
| 6.10.5. Data Types .....                 | 589 |
| 6.10.6. Attributes .....                 | 595 |
| 6.10.7. Commands .....                   | 598 |
| 6.10.8. Events .....                     | 603 |
| 6.11. Target Navigator Cluster .....     | 605 |
| 6.11.1. Revision History .....           | 605 |
| 6.11.2. Classification .....             | 606 |
| 6.11.3. Cluster ID .....                 | 606 |
| 6.11.4. Data Types .....                 | 606 |
| 6.11.5. Attributes .....                 | 607 |
| 6.11.6. Commands .....                   | 607 |
| 6.11.7. Events .....                     | 608 |
| 6.12. Content App Observer Cluster ..... | 609 |
| 6.12.1. Revision History .....           | 609 |
| 6.12.2. Classification .....             | 610 |
| 6.12.3. Cluster ID .....                 | 610 |
| 6.12.4. Data Types .....                 | 610 |
| 6.12.5. Commands .....                   | 610 |
| 6.13. Content Control Cluster .....      | 611 |
| 6.13.1. Revision History .....           | 612 |
| 6.13.2. Classification .....             | 612 |
| 6.13.3. Cluster ID .....                 | 612 |
| 6.13.4. Features .....                   | 612 |
| 6.13.5. Data Types .....                 | 613 |
| 6.13.6. Status Codes .....               | 616 |
| 6.13.7. Attributes .....                 | 617 |



Page 15



|                                          |     |
|------------------------------------------|-----|
| 6.13.8. Commands .....                   | 620 |
| 6.13.9. Events .....                     | 627 |
| 7. Robots .....                          | 629 |
| 7.1. General Description .....           | 629 |
| 7.1.1. Introduction .....                | 629 |
| 7.1.2. Cluster List .....                | 629 |
| 7.2. RVC Run Mode Cluster .....          | 629 |
| 7.2.1. Revision History .....            | 629 |
| 7.2.2. Classification .....              | 630 |
| 7.2.3. Cluster ID .....                  | 630 |
| 7.2.4. Features .....                    | 630 |
| 7.2.5. Data Types .....                  | 631 |
| 7.2.6. Attributes .....                  | 631 |
| 7.2.7. Derived Cluster Namespace .....   | 631 |
| 7.2.8. Mode Use .....                    | 633 |
| 7.2.9. Mode Change Restrictions .....    | 633 |
| 7.3. RVC Clean Mode Cluster .....        | 633 |
| 7.3.1. Revision History .....            | 633 |
| 7.3.2. Classification .....              | 634 |
| 7.3.3. Cluster ID .....                  | 634 |
| 7.3.4. Features .....                    | 634 |
| 7.3.5. Data Types .....                  | 635 |
| 7.3.6. Attributes .....                  | 635 |
| 7.3.7. Derived Cluster Namespace .....   | 635 |
| 7.3.8. Mode Change Restrictions .....    | 636 |
| 7.3.9. Mode Examples .....               | 636 |
| 7.4. RVC Operational State Cluster ..... | 637 |
| 7.4.1. Revision History .....            | 637 |
| 7.4.2. Classification .....              | 637 |
| 7.4.3. Cluster ID .....                  | 637 |
| 7.4.4. Data Types .....                  | 637 |
| 7.4.5. Commands .....                    | 641 |
| 8. Home Appliances .....                 | 643 |
| 8.1. General Description .....           | 643 |
| 8.1.1. Introduction .....                | 643 |
| 8.1.2. Cluster List .....                | 643 |
| 8.2. Temperature Control Cluster .....   | 644 |
| 8.2.1. Revision History .....            | 644 |
| 8.2.2. Classification .....              | 644 |
| 8.2.3. Cluster ID .....                  | 645 |
| 8.2.4. Features .....                    | 645 |

Page 16



|                                                                         |     |
|-------------------------------------------------------------------------|-----|
| 8.2.5. Attributes .....                                                 | 645 |
| 8.2.6. Commands .....                                                   | 647 |
| 8.3. Dishwasher Mode Cluster .....                                      | 648 |
| 8.3.1. Revision History .....                                           | 648 |
| 8.3.2. Classification .....                                             | 649 |
| 8.3.3. Cluster ID .....                                                 | 649 |
| 8.3.4. Features .....                                                   | 649 |
| 8.3.5. Data Types .....                                                 | 649 |
| 8.3.6. Attributes .....                                                 | 649 |
| 8.3.7. Derived Cluster Namespace .....                                  | 650 |
| 8.4. Dishwasher Alarm Cluster .....                                     | 651 |
| 8.4.1. Revision History .....                                           | 651 |
| 8.4.2. Classification .....                                             | 651 |
| 8.4.3. Cluster ID .....                                                 | 651 |
| 8.4.4. Data Types .....                                                 | 651 |
| 8.5. Laundry Washer Mode Cluster .....                                  | 652 |
| 8.5.1. Revision History .....                                           | 652 |
| 8.5.2. Classification .....                                             | 652 |
| 8.5.3. Cluster ID .....                                                 | 652 |
| 8.5.4. Features .....                                                   | 652 |
| 8.5.5. Data Types .....                                                 | 652 |
| 8.5.6. Attributes .....                                                 | 653 |
| 8.5.7. Derived Cluster Namespace .....                                  | 653 |
| 8.5.8. Mode Examples .....                                              | 654 |
| 8.6. Laundry Washer Controls Cluster .....                              | 654 |
| 8.6.1. Revision History .....                                           | 654 |
| 8.6.2. Classification .....                                             | 655 |
| 8.6.3. Cluster ID .....                                                 | 655 |
| 8.6.4. Features .....                                                   | 655 |
| 8.6.5. Data Types .....                                                 | 655 |
| 8.6.6. Attributes .....                                                 | 656 |
| 8.7. Refrigerator And Temperature Controlled Cabinet Mode Cluster ..... | 657 |
| 8.7.1. Revision History .....                                           | 657 |
| 8.7.2. Classification .....                                             | 657 |
| 8.7.3. Cluster ID .....                                                 | 657 |
| 8.7.4. Features .....                                                   | 658 |
| 8.7.5. Data Types .....                                                 | 658 |
| 8.7.6. Attributes .....                                                 | 658 |
| 8.7.7. Derived Cluster Namespace .....                                  | 659 |
| 8.7.8. Mode Examples .....                                              | 659 |
| 8.8. Refrigerator Alarm Cluster .....                                   | 659 |



Page 17



|                                                   |     |
|---------------------------------------------------|-----|
| 8.8.1. Revision History .....                     | 660 |
| 8.8.2. Classification .....                       | 660 |
| 8.8.3. Cluster ID .....                           | 660 |
| 8.8.4. Features .....                             | 660 |
| 8.8.5. Data Types .....                           | 660 |
| 8.8.6. Attributes .....                           | 660 |
| 8.8.7. Commands .....                             | 661 |
| 8.9. Laundry Dryer Controls Cluster .....         | 661 |
| 8.9.1. Revision History .....                     | 661 |
| 8.9.2. Classification .....                       | 661 |
| 8.9.3. Cluster ID .....                           | 661 |
| 8.9.4. Data Types .....                           | 661 |
| 8.9.5. Attributes .....                           | 662 |
| 8.10. Oven Cavity Operational State Cluster ..... | 663 |
| 8.10.1. Revision History .....                    | 663 |
| 8.10.2. Classification .....                      | 663 |
| 8.10.3. Cluster ID .....                          | 663 |
| 8.10.4. Attributes .....                          | 663 |
| 8.10.5. Commands .....                            | 663 |
| 8.11. Oven Mode Cluster .....                     | 664 |
| 8.11.1. Revision History .....                    | 664 |
| 8.11.2. Classification .....                      | 664 |
| 8.11.3. Cluster ID .....                          | 664 |
| 8.11.4. Features .....                            | 664 |
| 8.11.5. Data Types .....                          | 665 |
| 8.11.6. Attributes .....                          | 665 |
| 8.11.7. Derived Cluster Namespace .....           | 665 |
| 8.11.8. Mode Examples .....                       | 667 |
| 8.12. Microwave Oven Mode Cluster .....           | 667 |
| 8.12.1. Revision History .....                    | 667 |
| 8.12.2. Classification .....                      | 667 |
| 8.12.3. Cluster ID .....                          | 667 |
| 8.12.4. Features .....                            | 668 |
| 8.12.5. Attributes .....                          | 668 |
| 8.12.6. Commands .....                            | 668 |
| 8.12.7. Derived Cluster Namespace .....           | 668 |
| 8.13. Microwave Oven Control Cluster .....        | 669 |
| 8.13.1. Revision History .....                    | 669 |
| 8.13.2. Classification .....                      | 669 |
| 8.13.3. Cluster ID .....                          | 670 |
| 8.13.4. Features .....                            | 670 |

Page 18



|                                             |     |
|---------------------------------------------|-----|
| 8.13.5. Attributes .....                    | 670 |
| 8.13.6. Commands .....                      | 672 |
| 9. Energy Management .....                  | 677 |
| 9.1. General Description .....              | 677 |
| 9.1.1. Introduction .....                   | 677 |
| 9.1.2. Data Types .....                     | 677 |
| 9.1.3. TariffUnitEnum Type .....            | 677 |
| 9.1.4. PowerThresholdSourceEnum Type .....  | 677 |
| 9.1.5. TariffPriceTypeEnum Type .....       | 677 |
| 9.1.6. PowerThresholdStruct Type .....      | 678 |
| 9.1.7. Cluster List .....                   | 679 |
| 9.2. Device Energy Management Cluster ..... | 680 |
| 9.2.1. Revision History .....               | 681 |
| 9.2.2. Classification .....                 | 682 |
| 9.2.3. Cluster ID .....                     | 682 |
| 9.2.4. Features .....                       | 682 |
| 9.2.5. Dependencies .....                   | 686 |
| 9.2.6. Definitions .....                    | 687 |
| 9.2.7. Data Types .....                     | 688 |
| 9.2.8. Attributes .....                     | 702 |
| 9.2.9. Commands .....                       | 706 |
| 9.2.10. Events .....                        | 715 |
| 9.3. Energy EVSE Cluster .....              | 716 |
| 9.3.1. Revision History .....               | 717 |
| 9.3.2. Classification .....                 | 717 |
| 9.3.3. Cluster ID .....                     | 717 |
| 9.3.4. Features .....                       | 718 |
| 9.3.5. Dependencies .....                   | 719 |
| 9.3.6. Definitions .....                    | 720 |
| 9.3.7. Data Types .....                     | 720 |
| 9.3.8. Attributes .....                     | 726 |
| 9.3.9. Commands .....                       | 733 |
| 9.3.10. Events .....                        | 739 |
| 9.4. Energy EVSE Mode Cluster .....         | 743 |
| 9.4.1. Revision History .....               | 744 |
| 9.4.2. Classification .....                 | 744 |
| 9.4.3. Cluster ID .....                     | 744 |
| 9.4.4. Features .....                       | 744 |
| 9.4.5. Data Types .....                     | 744 |
| 9.4.6. Attributes .....                     | 744 |
| 9.4.7. Derived Cluster Namespace .....      | 745 |



Page 19



|                                                  |     |
|--------------------------------------------------|-----|
| 9.4.8. Mode Examples .....                       | 746 |
| 9.5. Water Heater Management Cluster .....       | 746 |
| 9.5.1. Revision History .....                    | 747 |
| 9.5.2. Classification .....                      | 747 |
| 9.5.3. Cluster ID .....                          | 747 |
| 9.5.4. Features .....                            | 747 |
| 9.5.5. Dependencies .....                        | 747 |
| 9.5.6. Data Types .....                          | 748 |
| 9.5.7. Attributes .....                          | 750 |
| 9.5.8. Commands .....                            | 752 |
| 9.5.9. Events .....                              | 753 |
| 9.6. Water Heater Mode Cluster .....             | 754 |
| 9.6.1. Revision History .....                    | 754 |
| 9.6.2. Classification .....                      | 754 |
| 9.6.3. Cluster ID .....                          | 754 |
| 9.6.4. Features .....                            | 754 |
| 9.6.5. Data Types .....                          | 754 |
| 9.6.6. Attributes .....                          | 755 |
| 9.6.7. Derived Cluster Namespace .....           | 755 |
| 9.6.8. Mode Examples .....                       | 756 |
| 9.7. Energy Preference Cluster .....             | 756 |
| 9.7.1. Revision History .....                    | 757 |
| 9.7.2. Classification .....                      | 757 |
| 9.7.3. Cluster ID .....                          | 757 |
| 9.7.4. Features .....                            | 757 |
| 9.7.5. Data Types .....                          | 757 |
| 9.7.6. Attributes .....                          | 759 |
| 9.8. Device Energy Management Mode Cluster ..... | 760 |
| 9.8.1. Revision History .....                    | 761 |
| 9.8.2. Classification .....                      | 761 |
| 9.8.3. Cluster ID .....                          | 761 |
| 9.8.4. Features .....                            | 761 |
| 9.8.5. Data Types .....                          | 761 |
| 9.8.6. Attributes .....                          | 761 |
| 9.8.7. Derived Cluster Namespace .....           | 762 |
| 9.8.8. Mode Examples .....                       | 763 |
| 9.9. Commodity Price Cluster .....               | 763 |
| 9.9.1. Revision History .....                    | 764 |
| 9.9.2. Classification .....                      | 764 |
| 9.9.3. Cluster ID .....                          | 764 |
| 9.9.4. Features .....                            | 764 |

Page 20



|                                                        |     |
|--------------------------------------------------------|-----|
| 9.9.5. Data Types .....                                | 764 |
| 9.9.6. Attributes .....                                | 767 |
| 9.9.7. Commands .....                                  | 768 |
| 9.9.8. Events .....                                    | 769 |
| 9.10. Meter Identification Cluster .....               | 770 |
| 9.10.1. Revision History .....                         | 770 |
| 9.10.2. Classification .....                           | 770 |
| 9.10.3. Cluster ID .....                               | 770 |
| 9.10.4. Features .....                                 | 770 |
| 9.10.5. Data Types .....                               | 771 |
| 9.10.6. Attributes .....                               | 771 |
| 9.11. Commodity Metering Cluster .....                 | 772 |
| 9.11.1. Revision History .....                         | 772 |
| 9.11.2. Classification .....                           | 772 |
| 9.11.3. Cluster ID .....                               | 772 |
| 9.11.4. Data Types .....                               | 772 |
| 9.11.5. Attributes .....                               | 773 |
| 9.12. Commodity Tariff Cluster .....                   | 773 |
| 9.12.1. Revision History .....                         | 774 |
| 9.12.2. Classification .....                           | 774 |
| 9.12.3. Cluster ID .....                               | 774 |
| 9.12.4. Features .....                                 | 774 |
| 9.12.5. Data Types .....                               | 775 |
| 9.12.6. Attributes .....                               | 787 |
| 9.12.7. Commands .....                                 | 790 |
| 9.12.8. Tariff Examples .....                          | 793 |
| 9.12.9. Active Tariff Components for a Timestamp ..... | 805 |
| 9.13. Electrical Grid Conditions Cluster .....         | 807 |
| 9.13.1. Revision History .....                         | 807 |
| 9.13.2. Classification .....                           | 807 |
| 9.13.3. Cluster ID .....                               | 807 |
| 9.13.4. Features .....                                 | 807 |
| 9.13.5. Data Types .....                               | 807 |
| 9.13.6. Attributes .....                               | 809 |
| 9.13.7. Events .....                                   | 810 |
| 10. Network Infrastructure .....                       | 813 |
| 10.1. General Description .....                        | 813 |
| 10.1.1. Introduction .....                             | 813 |
| 10.1.2. Cluster List .....                             | 813 |
| 10.2. Wi-Fi Network Management Cluster .....           | 813 |
| 10.2.1. Revision History .....                         | 813 |



Page 21



|                                                      |     |
|------------------------------------------------------|-----|
| 10.2.2. Classification .....                         | 813 |
| 10.2.3. Cluster ID .....                             | 814 |
| 10.2.4. Attributes .....                             | 814 |
| 10.2.5. Commands .....                               | 815 |
| 10.3. Thread Border Router Management Cluster .....  | 816 |
| 10.3.1. Revision History .....                       | 816 |
| 10.3.2. Classification .....                         | 816 |
| 10.3.3. Cluster ID .....                             | 816 |
| 10.3.4. Features .....                               | 816 |
| 10.3.5. Attributes .....                             | 817 |
| 10.3.6. Commands .....                               | 818 |
| 10.4. Thread Network Directory Cluster .....         | 821 |
| 10.4.1. Revision History .....                       | 821 |
| 10.4.2. Classification .....                         | 821 |
| 10.4.3. Cluster ID .....                             | 821 |
| 10.4.4. Data Types .....                             | 821 |
| 10.4.5. Attributes .....                             | 822 |
| 10.4.6. Commands .....                               | 823 |
| 10.4.7. Guidance for Fabrics / Commissioners .....   | 825 |
| 11. Cameras .....                                    | 827 |
| 11.1. General Description .....                      | 827 |
| 11.1.1. Introduction .....                           | 827 |
| 11.1.2. Cluster List .....                           | 827 |
| 11.1.3. Data Types .....                             | 827 |
| 11.2. Camera AV Stream Management Cluster .....      | 829 |
| 11.2.1. Lifecycle and Resource Management .....      | 829 |
| 11.2.2. Revision History .....                       | 830 |
| 11.2.3. Classification .....                         | 830 |
| 11.2.4. Cluster ID .....                             | 830 |
| 11.2.5. Features .....                               | 830 |
| 11.2.6. Data Types .....                             | 832 |
| 11.2.7. Attributes .....                             | 844 |
| 11.2.8. Commands .....                               | 854 |
| 11.3. Camera AV Settings User Level Management ..... | 868 |
| 11.3.1. Revision History .....                       | 868 |
| 11.3.2. Classification .....                         | 868 |
| 11.3.3. Cluster ID .....                             | 868 |
| 11.3.4. Features .....                               | 869 |
| 11.3.5. Data Types .....                             | 869 |
| 11.3.6. Attributes .....                             | 872 |
| 11.3.7. Commands .....                               | 873 |

Page 22



|                                               |     |
|-----------------------------------------------|-----|
| 11.4. WebRTC Transport.....                   | 880 |
| 11.4.1. Background Info.....                  | 880 |
| 11.4.2. Operating Roles.....                  | 881 |
| 11.4.3. Signaling Flows.....                  | 882 |
| 11.4.4. SFrame End-to-End Encryption.....     | 886 |
| 11.4.5. Data Types .....                      | 887 |
| 11.5. WebRTC Transport Provider Cluster ..... | 892 |
| 11.5.1. Revision History .....                | 892 |
| 11.5.2. Classification .....                  | 892 |
| 11.5.3. Cluster ID .....                      | 892 |
| 11.5.4. Features.....                         | 892 |
| 11.5.5. Data Types .....                      | 893 |
| 11.5.6. Attributes .....                      | 893 |
| 11.5.7. Commands .....                        | 893 |
| 11.6. WebRTC Transport Requestor Cluster..... | 906 |
| 11.6.1. Revision History .....                | 906 |
| 11.6.2. Classification .....                  | 906 |
| 11.6.3. Cluster ID .....                      | 906 |
| 11.6.4. Attributes .....                      | 906 |
| 11.6.5. Commands .....                        | 907 |
| 11.7. Push AV Stream Transport Cluster.....   | 910 |
| 11.7.1. CMAF Ingestion.....                   | 910 |
| 11.7.2. Revision History .....                | 915 |
| 11.7.3. Classification .....                  | 916 |
| 11.7.4. Cluster ID .....                      | 916 |
| 11.7.5. Features.....                         | 916 |
| 11.7.6. Data Types .....                      | 916 |
| 11.7.7. Status Codes.....                     | 928 |
| 11.7.8. Attributes .....                      | 928 |
| 11.7.9. Commands .....                        | 929 |
| 11.7.10. Events .....                         | 939 |
| 11.8. Chime Cluster .....                     | 940 |
| 11.8.1. Revision History .....                | 940 |
| 11.8.2. Classification .....                  | 940 |
| 11.8.3. Cluster ID .....                      | 941 |
| 11.8.4. Data Types .....                      | 941 |
| 11.8.5. Attributes .....                      | 941 |
| 11.8.6. Commands .....                        | 942 |



Page 23



Page 24







# Introduction

The Matter Application Cluster specification defines generic interfaces that are sufficiently general to be of use across a wide range of application domains.

## Scope and Purpose

This document specifies the Matter Application Cluster Library (MACL). The MACL is a repository for cluster functionality that is developed by the Connectivity Standards Alliance, and is a working library with regular updates as new functionality is added. A developer constructing a new application should use the MACL to find relevant cluster functionality that can be incorporated into the new application. Correspondingly, new clusters that are defined for applications should be considered for inclusion in the MACL.

The MACL consists of a number of sets of clusters. Clusters that are generally useful across many application domains are included in the General set. Clusters that are intended for use mainly in specific application domains are grouped together in domain oriented sets.

## References

The following standards and specifications contain provisions, which through reference in this document constitute provisions of this specification. All the standards and specifications listed are normative references. At the time of publication, the editions indicated were valid. All standards and specifications are subject to revision, and parties to agreements based on this specification are encouraged to investigate the possibility of applying the most recent editions of the standards and specifications indicated below.

## Connectivity Standards Alliance Reference Documents

| Reference            | Reference Location/URL                                                                                                          | Description                                                                 |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| [Aliro]              | TBD                                                                                                                             | Aliro Specification - Under development                                     |
| [Alliance-PNP]       | <a href="https://groups.csa-iot.org/wg/members/document/21624">https://groups.csa-iot.org/wg/members/document/21624</a>         | Organizational Processes and Procedures, 13-0625, revision 8, November 2021 |
| [MatterCore]         | <a href="https://groups.csa-iot.org/wg/members-all/document/27349">https://groups.csa-iot.org/wg/members-all/document/27349</a> | Matter Core Specification                                                   |
| [MatterDevLib]       | <a href="https://groups.csa-iot.org/wg/members-all/document/27351">https://groups.csa-iot.org/wg/members-all/document/27351</a> | Matter Device Library Specification                                         |
| [StandardNamespaces] | <a href="https://groups.csa-iot.org/wg/members-all/document/31936">https://groups.csa-iot.org/wg/members-all/document/31936</a> | Standard Namespaces                                                         |



Page 25



## External Reference Documents

| Reference                     | Reference Location/URL                                                                                                                                                                                                                                                                                                                                                                  | Description                                                                                                |
|-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| [CENC]                        | <a href="https://www.iso.org/standard/84637.html">https://www.iso.org/standard/84637.html</a>                                                                                                                                                                                                                                                                                           | MPEG systems technologies Part 7: Common encryption in ISO base media file format files                    |
| [CENCISOBMFF]                 | <a href="https://www.iso.org/standard/70175.html">https://www.iso.org/standard/70175.html</a>                                                                                                                                                                                                                                                                                           | MPEG systems technologies Part 9: Common encryption of MPEG-2 transport streams                            |
| [CIE 1931]                    | <a href="https://en.wikipedia.org/wiki/CIE_1931_color_space">https://en.wikipedia.org/wiki/CIE_1931_color_space</a>                                                                                                                                                                                                                                                                     | Commission Internationale de l'Éclairage CIE 1931 Color Space                                              |
| [DASHIFINGEST]                | <a href="https://dashif.org/Ingest/">https://dashif.org/Ingest/</a>                                                                                                                                                                                                                                                                                                                     | DASH-IF Live Media Ingest Protocol                                                                         |
| [DIALRegistry]                | <a href="http://www.dial-multiscreen.org/dial-registry/namespace-database">http://www.dial-multiscreen.org/dial-registry/namespace-database</a>                                                                                                                                                                                                                                         | DIAL Registry                                                                                              |
| [EU Code of Conduct for ESAs] | <a href="https://ses.jrc.ec.europa.eu/development-of-policy-proposals-for-energy-smart-appliances">https://ses.jrc.ec.europa.eu/development-of-policy-proposals-for-energy-smart-appliances</a>                                                                                                                                                                                         | EU Code of Conduct for ESAs                                                                                |
| [HDMI]                        | <a href="https://hdmi.org/hdmi-forum-releases-version-2-1-hdmi-specification/">https://hdmi.org/hdmi-forum-releases-version-2-1-hdmi-specification/</a>                                                                                                                                                                                                                                 | HDMI CEC specification                                                                                     |
| [IEEE2030.5]                  | <a href="https://standards.ieee.org/ieee/2030.5/11216/">https://standards.ieee.org/ieee/2030.5/11216/</a>                                                                                                                                                                                                                                                                               | IEEE 2030.5                                                                                                |
| [ISO 4217]                    | <a href="https://www.iso.org/iso-4217-currency-codes.html">https://www.iso.org/iso-4217-currency-codes.html</a>                                                                                                                                                                                                                                                                         | Currency Codes                                                                                             |
| [ISO 8601]                    | <a href="https://www.iso.org/iso-8601-date-and-time-format.html">https://www.iso.org/iso-8601-date-and-time-format.html</a>                                                                                                                                                                                                                                                             | Date and time format                                                                                       |
| [MPEGCMAF]                    | <a href="https://www.iso.org/standard/79106.html">https://www.iso.org/standard/79106.html</a>                                                                                                                                                                                                                                                                                           | Multimedia application format (MPEG-A) Part 19: Common media application format (CMAF) for segmented media |
| [ISOBMFF]                     | <a href="https://www.iso.org/standard/83102.html">https://www.iso.org/standard/83102.html</a>                                                                                                                                                                                                                                                                                           | Coding of audio-visual objects Part 12: ISO base media file format                                         |
| [OpenADR]                     | <a href="https://www.openadr.org/">https://www.openadr.org/</a>                                                                                                                                                                                                                                                                                                                         | OpenADR Alliance                                                                                           |
| [PAS1878]                     | <a href="https://www.bsigroup.com/globalassets/localfiles/en-th/about-bsi/energy-smart-appliances-programme/bsi-pas-1878-energy-smart-appliances-system-functionality-and-architecture-th.pdf">https://www.bsigroup.com/globalassets/localfiles/en-th/about-bsi/energy-smart-appliances-programme/bsi-pas-1878-energy-smart-appliances-system-functionality-and-architecture-th.pdf</a> | PAS1878                                                                                                    |

Page 26



| Reference             | Reference Location/URL                                                                                                    | Description                                                                                                 |
|-----------------------|---------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
| [RFC 1738]            | <a href="https://www.rfc-editor.org/rfc/rfc1738">https://www.rfc-editor.org/rfc/rfc1738</a>                               | Uniform Resource Locators (URL)                                                                             |
| [RFC 4122]            | <a href="https://www.rfc-editor.org/rfc/rfc4122">https://www.rfc-editor.org/rfc/rfc4122</a>                               | A Universally Unique IDentifier (UUID) URN Namespace                                                        |
| [RFC 5646]            | <a href="https://tools.ietf.org/html/rfc5646">https://tools.ietf.org/html/rfc5646</a>                                     | Tags for Identifying Languages                                                                              |
| [RFC 6236]            | <a href="https://www.rfc-editor.org/rfc/rfc6236">https://www.rfc-editor.org/rfc/rfc6236</a>                               | Negotiation of Generic Image Attributes in the Session Description Protocol (SDP)                           |
| [RFC 8141]            | <a href="https://www.rfc-editor.org/rfc/rfc8141">https://www.rfc-editor.org/rfc/rfc8141</a>                               | Uniform Resource Names (URNs)                                                                               |
| [RFC 8489]            | <a href="https://www.rfc-editor.org/rfc/rfc8489">https://www.rfc-editor.org/rfc/rfc8489</a>                               | Session Traversal Utilities for NAT (STUN)                                                                  |
| [RFC 8656]            | <a href="https://www.rfc-editor.org/rfc/rfc8656">https://www.rfc-editor.org/rfc/rfc8656</a>                               | Traversal Using Relays around NAT (TURN)                                                                    |
| [RFC 8825]            | <a href="https://www.rfc-editor.org/rfc/rfc8825">https://www.rfc-editor.org/rfc/rfc8825</a>                               | Overview: Real-Time Protocols for Browser-Based Applications                                                |
| [RFC 8839]            | <a href="https://www.rfc-editor.org/rfc/rfc8839">https://www.rfc-editor.org/rfc/rfc8839</a>                               | Session Description Protocol (SDP) Offer/Answer Procedures for Interactive Connectivity Establishment (ICE) |
| [RFC 8866]            | <a href="https://www.rfc-editor.org/rfc/rfc8866">https://www.rfc-editor.org/rfc/rfc8866</a>                               | SDP: Session Description Protocol                                                                           |
| [RFC 9113]            | <a href="https://www.rfc-editor.org/rfc/rfc9113">https://www.rfc-editor.org/rfc/rfc9113</a>                               | HTTP/2                                                                                                      |
| [RFC 9429]            | <a href="https://www.rfc-editor.org/rfc/rfc9429">https://www.rfc-editor.org/rfc/rfc9429</a>                               | JavaScript Session Establishment Protocol (JSEP)                                                            |
| [RFC 9605]            | <a href="https://www.rfc-editor.org/rfc/rfc9605">https://www.rfc-editor.org/rfc/rfc9605</a>                               | Secure Frame (SFrame): Lightweight Authenticated Encryption for Real-Time Media                             |
| [RFC 9626]            | <a href="https://www.rfc-editor.org/rfc/rfc9626">https://www.rfc-editor.org/rfc/rfc9626</a>                               | Video Frame Marking RTP Header Extension                                                                    |
| [SAE J2847/3_2023 11] | <a href="https://www.sae.org/standards/content/j2847/3_202311/">https://www.sae.org/standards/content/j2847/3_202311/</a> | Communication for Plug-in Vehicles as a Distributed Energy Source                                           |
| [SAREF4ENER]          | <a href="https://saref.etsi.org/saref4ener/v1.1.2/">https://saref.etsi.org/saref4ener/v1.1.2/</a>                         | SAREF ontology for energy (ETSI TS 103 410-1)                                                               |
| [SEC 1]               | <a href="https://www.secg.org/sec1-v2.pdf">https://www.secg.org/sec1-v2.pdf</a>                                           | SEC 1: Elliptic Curve Cryptography, Version 2.0, Certicom Research, May 2009                                |
| [Thread]              | <a href="https://www.threadgroup.org">https://www.threadgroup.org</a>                                                     | Thread 1.3.0 Specification                                                                                  |



Page 27



| Reference   | Reference Location/URL                                                                                                | Description                            |
|-------------|-----------------------------------------------------------------------------------------------------------------------|----------------------------------------|
| [RFC 3986]  | <a href="https://www.rfc-editor.org/rfc/rfc3986">https://www.rfc-editor.org/rfc/rfc3986</a>                           | Uniform Resource Identifier (URI)      |
| [WakeOnLAN] | <a href="https://www.amd.com/system/files/TechDocs/20213.pdf">https://www.amd.com/system/files/TechDocs/20213.pdf</a> | Wake on LAN Magic Packet specification |

## Provisional

Per [\[Alliance-PNP\]](#), when a specification is completed there may be sections of specification text (or smaller pieces of a section) that are not certifiable at this stage. These sections (or smaller pieces of a section) are marked as provisional prior to publishing the specification. This specification uses well-defined notation to mark Provisional Conformance (see [\[MatterCore\]](#), Section 7.3) or notes a section of text with the term "provisional".

### List of Provisional Items

The following is a list of provisional items:

- Support for the Frequency feature of the [Level Control cluster](#) is provisional.
- Support for InflowError, DrainError, TempTooLow, TempTooHigh, and WaterLevelError alarms in [Dishwasher Alarm Cluster](#) is provisional.
- Support for [Energy Preference Cluster](#) is provisional.
- Support for [Content Control Cluster](#) is provisional.
- Support for PowerInWatts feature of the [Microwave Oven Control cluster](#) is provisional

Page 28







# Chapter 1. General

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter. References to external documents are contained in Chapter 1 and are made using *[Rn]* notation.

## 1.1. General Description

### 1.1.1. Introduction

The clusters specified in this document are generic interfaces that are sufficiently general to be of use across a wide range of application domains.

### 1.1.2. Cluster List

This section lists the general clusters as specified in this chapter.

*Table 1. Overview of the General Clusters*

| ID     | Cluster Name                      | Description                                                                                                                                                            |
|--------|-----------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0x0003 | <a href="#">Identify</a>          | Attributes and commands for putting a device into Identification mode (e.g., flashing a light)                                                                         |
| 0x0004 | <a href="#">Groups</a>            | Cluster to manage the associated endpoint's membership into one or more groups to support groupcast interactions.                                                      |
| 0x0062 | <a href="#">Scenes Management</a> | Attributes and commands for setting up and recalling a number of scenes for a device. Each scene corresponds to a set of stored values of specified device attributes. |
| 0x0006 | <a href="#">On/Off</a>            | Attributes and commands for switching devices between On and Off states.                                                                                               |
| 0x0008 | <a href="#">Level Control</a>     | Attributes and commands for controlling a characteristic of devices that can be set to a level between fully On and fully Off.                                         |
| 0x0045 | <a href="#">Boolean State</a>     | Attribute and event for a boolean state variable                                                                                                                       |



Page 29



| ID     | Cluster Name                                | Description                                                                                                        |
|--------|---------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| 0x0080 | <a href="#">Boolean State Configuration</a> | Attributes and commands for configuration related to boolean state                                                 |
| 0x0050 | <a href="#">Mode Select</a>                 | Allows a user to choose one mode option from several pre-defined values                                            |
| n/a    | <a href="#">Mode Base</a>                   | Allows a user to choose one mode option from several pre-defined values                                            |
| 0x0508 | <a href="#">Low Power</a>                   | This cluster provides an interface for managing low power mode on a device.                                        |
| 0x0503 | <a href="#">Wake On LAN</a>                 | This cluster provides an interface for managing low power mode on a device that supports the Wake On LAN protocol. |
| 0x003B | <a href="#">Switch</a>                      | Attributes and events for various types of switch devices.                                                         |
| 0x0060 | <a href="#">Operational State</a>           | Commands and attributes for defining a device's operational state                                                  |
| n/a    | <a href="#">Alarm Base</a>                  | Base alarm cluster from which all alarms are derived                                                               |
| 0x0097 | <a href="#">Messages</a>                    | Commands and attributes for sending messages to devices                                                            |
| 0x0150 | <a href="#">Service Area</a>                | Commands and attributes for controlling and querying the operating service areas of devices                        |

## 1.2. Identify Cluster

This cluster supports an endpoint identification state (e.g., flashing a light), that indicates to an observer (e.g., an installer) which of several nodes and/or endpoints it is. It also supports a multicast request that any endpoint that is identifying itself to respond to the initiator.

The state of this cluster MAY be shared on more than one endpoint on a node.

For Example: Two endpoints on a single node, one a temperature sensor, and one a humidity sensor, may both share the same cluster instance and therefore identification state (e.g. single LED on the node).

Page 30



### 1.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                          |
|----------|------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added     |
| 2        | CCB 2808                                             |
| 3        | All Hubs changes                                     |
| 4        | New data model format and notation; add IdentifyType |
| 5        | Removed Query feature                                |
| 6        | Added Q quality for IdentifyTime attribute           |

### 1.2.2. Classification

| Hierarchy | Role    | Scope    | PICS Code |
|-----------|---------|----------|-----------|
| Base      | Utility | Endpoint | I         |

### 1.2.3. Cluster ID

| ID     | Name     |
|--------|----------|
| 0x0003 | Identify |

### 1.2.4. Data Types

#### 1.2.4.1. IdentifyTypeEnum Type

This data type is derived from enum8.

| Value | Name             | Summary                                         | Conformance |
|-------|------------------|-------------------------------------------------|-------------|
| 0x00  | None             | No presentation.                                | M           |
| 0x01  | LightOutput      | Light output of a lighting product.             | M           |
| 0x02  | VisibleIndicator | Typically a small LED.                          | M           |
| 0x03  | AudibleBeep      |                                                 | M           |
| 0x04  | Display          | Presentation will be visible on display screen. | M           |




Page 31



| Value | Name            | Summary                                                                                                            | Conformance |
|-------|-----------------|--------------------------------------------------------------------------------------------------------------------|-------------|
| 0x05  | <b>Actuator</b> | Presentation will be conveyed by actuator functionality such as through a window blind operation or in-wall relay. | M           |

#### 1.2.4.2. EffectIdentifierEnum Type

This data type is derived from enum8.

| Value | Name                 | Summary                                                                                                                                                                                     | Conformance |
|-------|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0x00  | <b>Blink</b>         | e.g., Light is turned on/off once.                                                                                                                                                          | M           |
| 0x01  | <b>Breathe</b>       | e.g., Light is turned on/off over 1 second and repeated 15 times.                                                                                                                           | M           |
| 0x02  | <b>Okay</b>          | e.g., Colored light turns green for 1 second; non-colored light flashes twice.                                                                                                              | M           |
| 0x0B  | <b>ChannelChange</b> | e.g., Colored light turns orange for 8 seconds; non-colored light switches to the maximum brightness for 0.5s and then minimum brightness for 7.5s.                                         | M           |
| 0xFE  | <b>FinishEffect</b>  | Complete the current effect sequence before terminating. e.g., if in the middle of a breathe effect (as above), first complete the current 1s breathe effect and then terminate the effect. | M           |
| 0xFF  | <b>StopEffect</b>    | Terminate the effect as soon as possible.                                                                                                                                                   | M           |

#### 1.2.4.3. EffectVariantEnum Type

This data type is derived from enum8.

Page 32







| Value | Name           | Summary                              | Conformance |
|-------|----------------|--------------------------------------|-------------|
| 0x00  | <b>Default</b> | Indicates the default effect is used | M           |

## 1.2.5. Attributes

| ID     | Name                 | Type              | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------------|-------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Identify-Time</b> | uint16            | all        | Q       |          | RW VO  | M           |
| 0x0001 | <b>Identify-Type</b> | Identify-TypeEnum | desc       |         |          | R V    | M           |

### 1.2.5.1. IdentifyTime Attribute

This attribute SHALL represent the remaining length of time, in seconds, that the endpoint will continue to identify itself.

If this attribute is set to a value other than 0 then the device SHALL enter its identification state, in order to indicate to an observer which of several nodes and/or endpoints it is. It is RECOMMENDED that this state consists of flashing a light with a period of 0.5 seconds. The IdentifyTime attribute SHALL be decremented every second while in this state.

If this attribute reaches or is set to the value 0 then the device SHALL terminate its identification state.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- When it changes from 0 to any other value and vice versa, or
- When it is written by a client, or
- When the value is set by an Identify command.

Since this attribute is not being reported during a regular countdown, clients SHOULD NOT rely on the reporting of this attribute in order to keep track of the remaining duration.

### 1.2.5.2. IdentifyType Attribute

This attribute SHALL indicate how the identification state is presented to the user.

This attribute SHALL contain one of the values defined in [IdentifyTypeEnum](#). The value None SHALL NOT be used if the device is capable of presenting its identification state using one of the other methods defined in [IdentifyTypeEnum](#).

## 1.2.6. Commands



Page 33



| ID   | Name                 | Direction                   | Response | Access | Conformance |
|------|----------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>Identify</b>      | client $\Rightarrow$ server | Y        | M      | M           |
| 0x40 | <b>TriggerEffect</b> | client $\Rightarrow$ server | Y        | M      | O           |

### 1.2.6.1. Identify Command

This command starts or stops the receiving device identifying itself.

This command SHALL have the following data fields:

| ID | Name                | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------------------|--------|------------|---------|----------|-------------|
| 0  | <b>IdentifyTime</b> | uint16 | all        |         |          | M           |

#### 1.2.6.1.1. Effect on Receipt

On receipt of this command, the device SHALL set the IdentifyTime attribute to the value of the IdentifyTime field. This then starts, continues, or stops the device's identification state as detailed in [IdentifyTime](#).

### 1.2.6.2. TriggerEffect Command

This command allows the support of feedback to the user, such as a certain light effect. It is used to allow an implementation to provide visual feedback to the user under certain circumstances such as a color light turning green when it has successfully connected to a network. The use of this command and the effects themselves are entirely up to the implementer to use whenever a visual feedback is useful but it is not the same as and does not replace the identify mechanism used during commissioning.

This command SHALL have the following data fields:

| ID | Name                    | Type                                 | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|--------------------------------------|------------|---------|----------|-------------|
| 0  | <b>EffectIdentifier</b> | <a href="#">EffectIdentifierEnum</a> | desc       |         |          | M           |
| 1  | <b>EffectVariant</b>    | <a href="#">EffectVariantEnum</a>    | desc       |         |          | M           |

#### 1.2.6.2.1. EffectIdentifier Field

This field SHALL indicate the identify effect to use and SHALL contain one of the non-reserved values in [EffectIdentifierEnum](#).

All values of the [EffectIdentifierEnum](#) SHALL be supported. Implementors MAY deviate from the example light effects in [EffectIdentifierEnum](#), but they SHOULD indicate during testing how they handle each effect.

Page 34







#### 1.2.6.2.2. EffectVariant Field

This field SHALL indicate which variant of the effect, indicated in the EffectIdentifier field, SHOULD be triggered. If a device does not support the given variant, it SHALL use the default variant. This field SHALL contain one of the values in [EffectVariantEnum](#).

#### 1.2.6.2.3. Effect on Receipt

On receipt of this command, the device SHALL execute the trigger effect indicated in the EffectIdentifier and EffectVariant fields. If the EffectVariant field specifies a variant that is not supported on the device, it SHALL execute the default variant.

### 1.3. Groups Cluster

The Groups cluster manages, per endpoint, the content of the node-wide Group Table that is part of the underlying interaction layer.

In a network supporting fabrics, group IDs referenced by attributes or other elements of this cluster are scoped to the accessing fabric.

The Groups cluster is scoped to the endpoint. Groups cluster commands support discovering the endpoint membership in a group, adding the endpoint to a group, removing the endpoint from a group, removing endpoint membership from all groups. All commands defined in this cluster SHALL only affect groups scoped to the accessing fabric.

When group names are supported, the server stores a name string, which is set by the client for each assigned group and indicated in response to a client request.

Note that configuration of group addresses for outgoing commands is achieved using the Message Layer mechanisms where the Group Table is not involved. Hence this cluster does not play a part in that.

#### 1.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                     |
|----------|-----------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added; CCB 1745 2100 |
| 2        | CCB 2289                                                        |
| 3        | CCB 2310 2704                                                   |
| 4        | New data model format and notation                              |

#### 1.3.2. Classification



Page 35



| Hierarchy | Role    | Scope    | PICS Code |
|-----------|---------|----------|-----------|
| Base      | Utility | Endpoint | G         |

### 1.3.3. Cluster ID

| ID     | Name   |
|--------|--------|
| 0x0004 | Groups |

### 1.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature    | Summary                                  |
|-----|------|------------|------------------------------------------|
| 0   | GN   | GroupNames | The ability to store a name for a group. |

#### 1.3.4.1. GroupNames Feature

The Group Names feature indicates the ability to store a name for a group when a group is added.

### 1.3.5. Data Types

#### 1.3.5.1. NameSupportBitmap Type

This data type is derived from map8.

| Bit | Name       | Summary                                  | Conformance |
|-----|------------|------------------------------------------|-------------|
| 7   | GroupNames | The ability to store a name for a group. | M           |

### 1.3.6. Attributes

| ID     | Name        | Type              | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------|-------------------|------------|---------|----------|--------|-------------|
| 0x0000 | NameSupport | NameSupportBitmap | desc       | F       |          | R V    | M           |

#### 1.3.6.1. NameSupport Attribute

This attribute provides legacy, read-only access to whether the Group Names feature is supported. The most significant bit, bit 7 (GroupNames), SHALL be equal to bit 0 of the FeatureMap attribute (GN Feature). All other bits SHALL be 0.

### 1.3.7. Commands

Page 36



| ID   | Name                               | Direction                   | Response                   | Access | Conformance |
|------|------------------------------------|-----------------------------|----------------------------|--------|-------------|
| 0x00 | <b>AddGroup</b>                    | client $\Rightarrow$ server | AddGroupResponse           | M F    | M           |
| 0x01 | <b>ViewGroup</b>                   | client $\Rightarrow$ server | ViewGroupResponse          | O F    | M           |
| 0x02 | <b>GetGroup-Membership</b>         | client $\Rightarrow$ server | GetGroupMembershipResponse | O F    | M           |
| 0x03 | <b>RemoveGroup</b>                 | client $\Rightarrow$ server | Remove-GroupResponse       | M F    | M           |
| 0x04 | <b>RemoveAll-Groups</b>            | client $\Rightarrow$ server | Y                          | M F    | M           |
| 0x05 | <b>AddGroupIfIdentifying</b>       | client $\Rightarrow$ server | Y                          | M F    | M           |
| 0x00 | <b>AddGroupResponse</b>            | client $\Leftarrow$ server  | N                          |        | M           |
| 0x01 | <b>ViewGroupResponse</b>           | client $\Leftarrow$ server  | N                          |        | M           |
| 0x02 | <b>GetGroup-MembershipResponse</b> | client $\Leftarrow$ server  | N                          |        | M           |
| 0x03 | <b>Remove-GroupResponse</b>        | client $\Leftarrow$ server  | N                          |        | M           |

### 1.3.7.1. AddGroup Command

The AddGroup command allows a client to add group membership in a particular group for the server endpoint.

| ID | Name             | Type     | Constraint | Quality | Fallback | Conformance |
|----|------------------|----------|------------|---------|----------|-------------|
| 0  | <b>GroupID</b>   | group-id | min 1      |         |          | M           |
| 1  | <b>GroupName</b> | string   | max 16     |         |          | M           |

#### 1.3.7.1.1. GroupID Field

This field SHALL be used to identify the group and any associated key material to which the server endpoint is to be added.

#### 1.3.7.1.2. GroupName Field

This field MAY be set to a human-readable name for the group. If the client has no name for the



Page 37



group, the GroupName field SHALL be set to the empty string.

Support of group names is optional and is indicated by the FeatureMap and NameSupport attribute.

#### 1.3.7.1.3. Effect on Receipt

If the server does not support group names, the GroupName field SHALL be ignored.

On receipt of the AddGroup command, the server SHALL perform the following procedure:

1. If the command fields are not within constraints, the status SHALL be CONSTRAINT\_ERROR, and the server continues from step 6.
2. If the receiving node requires security material to support the group ID and that material does not exist for this group ID, the status SHALL be UNSUPPORTED\_ACCESS and the server continues from step 6.
3. If the server endpoint is a member of the group indicated by the GroupID, the group name SHALL be updated (if supported) to GroupName, the status SHALL be SUCCESS, and the server continues from step 6.
4. If there are no available resources to add the membership for the server endpoint, the status SHALL be RESOURCE\_EXHAUSTED, and the server continues from step 6.
5. The server SHALL add the server endpoint as a member of the group indicated by the GroupID, the group name SHALL be updated (if supported) to GroupName, and the status SHALL be SUCCESS.
  - a. If the GroupID had already been added to the Group Table because of a previous AddGroup or AddGroupIfIdentifying command and a GroupName is provided and the server supports GroupName storage, then the GroupName associated with the GroupID in the Group Table SHALL be updated to reflect the new GroupName provided for the Group, such that subsequent ViewGroup commands yield the same name for all endpoints which have a group association to the given GroupID.
6. If the AddGroup command was received as a unicast, the server SHALL generate an AddGroupResponse command with the Status field set to the evaluated status. If the AddGroup command was received as a groupcast, the server SHALL NOT generate an AddGroupResponse command.

See [AddGroupResponse](#) for a description of the response command.

#### 1.3.7.2. ViewGroup Command

The ViewGroup command allows a client to request that the server responds with a ViewGroupResponse command containing the name string for a particular group.

| ID | Name    | Type     | Constraint | Quality | Fallback | Conformance |
|----|---------|----------|------------|---------|----------|-------------|
| 0  | GroupID | group-id | min 1      |         |          | M           |

Page 38



#### 1.3.7.2.1. Effect on Receipt

On receipt of the ViewGroup command, the server SHALL perform the following procedure:

1. If the command fields are not within constraints, the status SHALL be CONSTRAINT\_ERROR and the server continues from step 4.
2. If the server endpoint is a member of the group indicated by the GroupID, the status SHALL be SUCCESS, and the server continues from step 4.
3. Else the status SHALL be NOT\_FOUND.
4. If the ViewGroup command was received as a unicast, the server SHALL generate a ViewGroupResponse command for the group, and the Status field set to the evaluated status. If the ViewGroup command was received as a groupcast, the server SHALL NOT generate a ViewGroupResponse command.

See [ViewGroupResponse](#) for a description of the response command.

#### 1.3.7.3. GetGroupMembership Command

The GetGroupMembership command allows a client to inquire about the group membership of the server endpoint, in a number of ways.

| ID | Name      | Type           | Constraint | Quality | Fallback | Conformance |
|----|-----------|----------------|------------|---------|----------|-------------|
| 0  | GroupList | list[group-id] | all[min 1] |         |          | M           |

##### 1.3.7.3.1. Effect on Receipt

On receipt of the GetGroupMembership command, the server SHALL respond with group membership information using the GetGroupMembershipResponse command as follows:

If the GroupList field is empty, the server SHALL respond with all group IDs indicating the groups of which the server endpoint is a member.

If the GroupList field contains at least one group ID indicating a group of which the server endpoint is a member, the server SHALL respond with each group ID indicating a group of which the server endpoint is a member that matches a group in the GroupList field.

If the GroupList field contains one or more group IDs but does not contain any group ID indicating a group of which the server endpoint is a member, the server SHALL only respond if the command is unicast. The response SHALL return with an empty GroupList field.

#### 1.3.7.4. RemoveGroup Command

The RemoveGroup command allows a client to request that the server removes the membership for the server endpoint, if any, in a particular group.



Page 39



| ID | Name    | Type     | Constraint | Quality | Fallback | Conformance |
|----|---------|----------|------------|---------|----------|-------------|
| 0  | GroupID | group-id | min 1      |         |          | M           |

#### 1.3.7.4.1. Effect on Receipt

On receipt of the RemoveGroup command, the server SHALL perform the following procedure:

1. If the command fields are not within constraints, the status SHALL be CONSTRAINT\_ERROR and the server continues from step 4.
2. If the server endpoint is a member of the group indicated by the GroupID, the server SHALL remove the server endpoint membership in the group, the status SHALL be SUCCESS, and the server continues from step 4.
3. Else the status SHALL be NOT\_FOUND.
4. If the RemoveGroup command was received as a unicast, the server SHALL generate a RemoveGroupResponse command with the Status field set to the evaluated status. If the RemoveGroup command was received as a groupcast, the server SHALL NOT generate a RemoveGroupResponse command.

See [RemoveGroupResponse](#) for a description of the response command.

Additionally, if the Scenes Management cluster is supported on the same endpoint, scenes associated with the indicated group SHALL be removed on that endpoint.

#### 1.3.7.5. RemoveAllGroups Command

The RemoveAllGroups command allows a client to direct the server to remove all group associations for the server endpoint.

##### 1.3.7.5.1. Effect on Receipt

On receipt of this command, the server SHALL remove all group memberships for the server endpoint from the Group Table. If the RemoveAllGroups command was received as unicast and a response is not suppressed, the server SHALL generate a response with the Status field set to SUCCESS.

Additionally, if the Scenes Management cluster is supported on the same endpoint, all scenes, except for scenes associated with group ID 0, SHALL be removed on that endpoint.

#### 1.3.7.6. AddGroupIfIdentifying Command

The AddGroupIfIdentifying command allows a client to add group membership in a particular group for the server endpoint, on condition that the endpoint is identifying itself. Identifying functionality is controlled using the Identify cluster, (see [Identify Cluster](#)).

For correct operation of the AddGroupIfIdentifying command, any endpoint that supports the Groups server cluster SHALL also support the Identify server cluster.

This command might be used to assist configuring group membership in the absence of a commis-

Page 40







sioning tool.

| ID | Name             | Type     | Constraint | Quality | Fallback | Conformance |
|----|------------------|----------|------------|---------|----------|-------------|
| 0  | <b>GroupID</b>   | group-id | min 1      |         |          | M           |
| 1  | <b>GroupName</b> | string   | max 16     |         |          | M           |

#### 1.3.7.6.1. GroupID Field

This field SHALL be used to identify the group and any associated key material to which the server endpoint is to be added.

#### 1.3.7.6.2. GroupName Field

This field MAY be set to a human-readable name for the group. If the client has no name for the group, the GroupName field SHALL be set to the empty string.

Support of group names is optional and is indicated by the FeatureMap and NameSupport attribute.

#### 1.3.7.6.3. Effect on Receipt

If the server does not support group names, the GroupName field SHALL be ignored.

On receipt of the AddGroupIfIdentifying command, the server SHALL perform the following procedure:

1. The server verifies that it is currently identifying itself. If the server is not currently identifying itself, the status SHALL be SUCCESS, and the server continues from step 7.
2. If the command fields are not within constraints, the status SHALL be CONSTRAINT\_ERROR and the server continues from step 7.
3. If the receiving node requires security material to support the group ID, and that material does not exist for this group ID, the status SHALL be UNSUPPORTED\_ACCESS and the server continues from step 7.
4. If the server endpoint is a member of the group indicated by the GroupID, the status SHALL be SUCCESS and the server continues from step 7.
5. If there are no available resources to add the membership for the server endpoint, the status SHALL be RESOURCE\_EXHAUSTED and the server continues from step 7.
6. The server SHALL add the server endpoint as a member of the group indicated by the GroupID, the group name SHALL be updated (if supported) to GroupName, and the status SHALL be SUCCESS.
  - a. If the GroupID had already been added to the Group Table because of a previous AddGroup or AddGroupIfIdentifying command and a GroupName is provided and the server supports GroupName storage, then the GroupName associated with the GroupID in the Group Table SHALL be updated to reflect the new GroupName provided for the Group, such that subsequent ViewGroup commands yield the same name for all endpoints which have a group association to the given GroupID.




Page 41



7. If the AddGroupIfIdentifying command was received as unicast and the evaluated status is not SUCCESS, or if the AddGroupIfIdentifying command was received as unicast and the evaluated status is SUCCESS and a response is not suppressed, the server SHALL generate a response with the Status field set to the evaluated status.

### 1.3.7.7. AddGroupResponse Command

The AddGroupResponse is sent by the Groups cluster server in response to an AddGroup command.

| ID | Name    | Type     | Constraint | Quality | Fallback | Conformance |
|----|---------|----------|------------|---------|----------|-------------|
| 0  | Status  | enum8    | desc       |         |          | M           |
| 1  | GroupID | group-id | min 1      |         |          | M           |

#### 1.3.7.7.1. Status Field

This field is set according to the Effect on Receipt section of the AddGroup command.

#### 1.3.7.7.2. GroupID Field

This field is set to the GroupID field of the received AddGroup command.

### 1.3.7.8. ViewGroupResponse Command

The ViewGroupResponse command is sent by the Groups cluster server in response to a ViewGroup command.

| ID | Name      | Type     | Constraint | Quality | Fallback | Conformance |
|----|-----------|----------|------------|---------|----------|-------------|
| 0  | Status    | enum8    | desc       |         |          | M           |
| 1  | GroupID   | group-id | min 1      |         |          | M           |
| 2  | GroupName | string   | max 16     |         |          | M           |

#### 1.3.7.8.1. Status Field

This field is according to the Effect on Receipt section of the ViewGroup command.

#### 1.3.7.8.2. GroupID Field

This field is set to the GroupID field of the received ViewGroup command.

#### 1.3.7.8.3. GroupName Field

If the status is SUCCESS, and group names are supported, this field is set to the group name associated with that group in the Group Table; otherwise it is set to the empty string.

### 1.3.7.9. GetGroupMembershipResponse Command

The GetGroupMembershipResponse command is sent by the Groups cluster server in response to a

Page 42



GetGroupMembership command.

The GetGroupMembershipResponse command SHALL have the following data fields:

| ID | Name             | Type           | Constraint | Quality | Fallback | Conformance |
|----|------------------|----------------|------------|---------|----------|-------------|
| 0  | <b>Capacity</b>  | uint8          | all        | X       |          | M           |
| 1  | <b>GroupList</b> | list[group-id] | all[min 1] |         |          | M           |

#### 1.3.7.9.1. Capacity Field

This field SHALL contain the remaining capacity of the Group Table of the node. The following values apply:

- 0 - No further groups MAY be added.
- $0 < \text{Capacity} < 0xFE$  - Capacity holds the number of groups that MAY be added.
- $0xFE$  - At least 1 further group MAY be added (exact number is unknown).
- null - It is unknown if any further groups MAY be added.

#### 1.3.7.9.2. GroupList Field

The GroupList field SHALL contain either the group IDs of all the groups in the Group Table for which the server endpoint is a member of the group (in the case where the GroupList field of the received GetGroupMembership command was empty), or the group IDs of all the groups in the Group Table for which the server endpoint is a member of the group *and* for which the group ID was included in the the GroupList field of the received GetGroupMembership command (in the case where the GroupList field of the received GetGroupMembership command was not empty).

Zigbee: If the total number of groups will cause the maximum payload length of a frame to be exceeded, then the GroupList field SHALL contain only as many groups as will fit.

### 1.3.7.10. RemoveGroupResponse Command

The RemoveGroupResponse command is generated by the server in response to the receipt of a RemoveGroup command.

| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>Status</b>  | enum8    | desc       |         |          | M           |
| 1  | <b>GroupID</b> | group-id | min 1      |         |          | M           |

#### 1.3.7.10.1. Status Field

This field is according to the Effect on Receipt section of the RemoveGroup command.

#### 1.3.7.10.2. GroupID Field

This field is set to the GroupID field of the received RemoveGroup command.




Page 43



## 1.4. Scenes Management Cluster

The Scenes Management cluster provides attributes and commands for setting up and recalling scenes. Each scene corresponds to a set of stored values of specified attributes for one or more clusters on the same end point as the Scenes Management cluster.

In most cases scenes are associated with a particular group identifier. Scenes MAY also exist without a group, in which case the value 0 replaces the group identifier. Note that extra care is required in these cases to avoid a scene identifier collision, and that commands related to scenes without a group MAY only be unicast, i.e., they SHALL NOT be multicast or broadcast.

### 1.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Based on the ZCL Scenes Cluster, Updated the Cluster ID to 0x0062, the name to Scenes Management, removed the provisional status; Removed attributes SceneCount, CurrentScene, CurrentGroup, SceneValid, and NameSupport; Removed Explicit, TableSize and FabricScenes features; Removed EnhancedAddScene, EnhancedAddSceneResponse, Enhanced-ViewScene, EnhancedViewSceneResponse; TransitionTime field changed milliseconds in AddScene, ViewSceneResponse and RecallScene |

### 1.4.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | S         |

### 1.4.3. Cluster ID

| ID     | Name              | Conformance |
|--------|-------------------|-------------|
| 0x0062 | Scenes Management |             |

### 1.4.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

Page 44







| Bit | Code | Feature    | Conformance | Summary                                  |
|-----|------|------------|-------------|------------------------------------------|
| 0   | SN   | SceneNames | O           | The ability to store a name for a scene. |

The following sections describe each feature in some detail. Further details are found within the specification.

#### 1.4.4.1. SceneNames Feature

This feature indicates the ability to store a name for a scene when a scene is added.

### 1.4.5. Dependencies

Any endpoint that implements the Scenes Management server cluster SHALL also implement the Groups server cluster.

Note that the [RemoveGroup command](#) and the [RemoveAllGroups command](#) of the [Groups cluster](#) also remove scenes.

### 1.4.6. Handling of fabric-scoping

Attributes and commands for this cluster are scoped to the accessing fabric and SHALL only affect or reflect data related to the accessing fabric, with the exception of the [SceneValid Field](#) of the FabricSceneInfo attribute.

The following constraints apply in addition to any other stated requirements in individual data model elements:

- Any attribute read, attribute write or command invoked on the server when no accessing fabric is available SHALL fail with a status code of UNSUPPORTED\_ACCESS returned to the client.
- When accessing scene information, implementations SHALL ensure that scenes with identical Group ID and Scene ID across fabrics will only access the data for the accessing fabric, so that the same identifier values used by different accessing fabrics do not cause mixing or overwriting of another fabric's scenes.
- Upon leaving a fabric with the RemoveFabric command of the Operational Credentials Cluster, all scenes data for the associated fabric SHALL be removed from the Scene Table.
- The Scene Table capacity for a given fabric SHALL be less than half (rounded down towards 0) of the Scene Table entries (as indicated in the SceneTableSize attribute), with a maximum of 253 entries (to allow expressing it in the GetSceneMembershipResponse command). If the Scene Table capacity is about to be exceeded by adding or storing a scene, then the resource exhaustion behavior of the associated command SHALL apply.

### 1.4.7. Data Types



Page 45



#### 1.4.7.1. CopyModeBitmap Type

This data type is derived from map8.

| Bit | Name          | Summary                            | Conformance |
|-----|---------------|------------------------------------|-------------|
| 0   | CopyAllScenes | Copy all scenes in the scene table | M           |

#### 1.4.7.2. SceneInfoStruct Type

| Access Modifier: Fabric Scoped |                   |          |            |         |          |        |             |
|--------------------------------|-------------------|----------|------------|---------|----------|--------|-------------|
| ID                             | Name              | Type     | Constraint | Quality | Fallback | Access | Conformance |
| 0                              | SceneCount        | uint8    | all        |         |          |        | M           |
| 1                              | CurrentScene      | uint8    | desc       |         |          | S      | M           |
| 2                              | CurrentGroup      | group-id | all        |         |          | S      | M           |
| 3                              | SceneValid        | bool     | all        |         |          | S      | M           |
| 4                              | RemainingCapacity | uint8    | max 253    |         |          |        | M           |

##### 1.4.7.2.1. SceneCount Field

This field SHALL indicate the number of scenes currently used in the server's Scene Table on the endpoint where the Scenes Management cluster appears.

This only includes the count for the associated fabric.

##### 1.4.7.2.2. CurrentScene Field

This field SHALL indicate the scene identifier of the scene last invoked on the associated fabric. If no scene has been invoked, the value of this field SHALL be 0xFF, the undefined scene identifier.

##### 1.4.7.2.3. CurrentGroup Field

This field SHALL indicate the group identifier of the scene last invoked on the associated fabric, or 0 if the scene last invoked is not associated with a group.

##### 1.4.7.2.4. SceneValid Field

This field SHALL indicate whether the state of the server corresponds to that associated with the CurrentScene and CurrentGroup fields of the SceneInfoStruct they belong to. TRUE indicates that these fields are valid, FALSE indicates that they are not valid.

Page 46







This field SHALL be set to False for all other fabrics when an attribute with the Scenes ("S") designation in the Quality column of another cluster present on the same endpoint is modified or when the current scene is modified by a fabric through the [RecallScene](#) or [StoreScene](#) commands, regardless of the fabric-scoped access quality of the command.

In the event where the SceneValid field is set to False for a fabric, the CurrentScene and CurrentGroup fields SHALL be the last invoked scene and group for that fabric. In the event where no scene was previously invoked for that fabric, the CurrentScene and CurrentGroup fields SHALL be their default values.

#### 1.4.7.2.5. RemainingCapacity Field

This field SHALL indicate the remaining capacity of the [Scene Table](#) on this endpoint for the accessing fabric. Note that this value may change between reads, even if no entries are added or deleted on the accessing fabric, due to other clients associated with other fabrics adding or deleting entries that impact the resource usage on the device.

#### 1.4.7.3. AttributeValuePairStruct Type

This data type indicates a combination of an identifier and the value of an attribute.

| ID | Name            | Type      | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|-----------|------------|---------|----------|--------|-------------|
| 0  | AttributeID     | attrib-id | all        |         |          |        | M           |
| 1  | ValueUnsigned8  | uint8     |            |         |          |        | O.a         |
| 2  | ValueSigned8    | int8      |            |         |          |        | O.a         |
| 3  | ValueUnsigned16 | uint16    |            |         |          |        | O.a         |
| 4  | ValueSigned16   | int16     |            |         |          |        | O.a         |
| 5  | ValueUnsigned32 | uint32    |            |         |          |        | O.a         |
| 6  | ValueSigned32   | int32     |            |         |          |        | O.a         |
| 7  | ValueUnsigned64 | uint64    |            |         |          |        | O.a         |
| 8  | ValueSigned64   | int64     |            |         |          |        | O.a         |

##### 1.4.7.3.1. AttributeID Field

This field SHALL be present for all instances in a given [ExtensionFieldSetStruct](#).




Page 47



Which Value\* field is used SHALL be determined based on the data type of the attribute indicated by AttributeID, as described in the [Value\\* Fields subsection](#).

The AttributeID field SHALL NOT refer to an attribute without the Scenes ("S") designation in the Quality column of the cluster specification.

#### 1.4.7.3.2. ValueUnsigned8, ValueSigned8, ValueUnsigned16, ValueSigned16, ValueUnsigned32, ValueSigned32, ValueUnsigned64, ValueSigned64 Fields

These fields SHALL indicate the attribute value as part of an extension field set, associated with a given AttributeID under an ExtensionFieldSetStruct's ClusterID. Which of the fields is used SHALL be determined by the type of the attribute indicated by AttributeID as follows:

- Data types bool, map8, and uint8 SHALL map to ValueUnsigned8.
- Data types int8 SHALL map to ValueSigned8.
- Data types map16 and uint16 SHALL map to ValueUnsigned16.
- Data types int16 SHALL map to ValueSigned16.
- Data types map32, uint24, and uint32 SHALL map to ValueUnsigned32.
- Data types int24 and int32 SHALL map to ValueSigned32.
- Data types map64, uint40, uint48, uint56 and uint64 SHALL map to ValueUnsigned64.
- Data types int40, int48, int56 and int64 SHALL map to ValueSigned64.
- For derived types, the mapping SHALL be based on the base type. For example, an attribute of type percent SHALL be treated as if it were of type uint8, whereas an attribute of type percent100ths SHALL be treated as if it were of type uint16.
- For boolean nullable attributes, any value that is not 0 or 1 SHALL be considered to have the null value.
- For boolean non-nullable attributes, any value that is not 0 or 1 SHALL be considered to have the value FALSE.
- For non-boolean nullable attributes, any value that is not a valid numeric value for the attribute's type after accounting for range reductions due to being nullable and constraints SHALL be considered to have the null value for the type.
- For non-boolean non-nullable attributes, any value that is not a valid numeric value for the attribute's type after accounting for constraints SHALL be considered to be the valid attribute value that is closest to the provided value.
  - In the event that an invalid provided value is of equal numerical distance to the two closest valid values, the lowest of those values SHALL be considered the closest valid attribute value.

If the used field does not match the data type of the attribute indicated by AttributeID, the AttributeValuePairStruct SHALL be considered invalid.

Examples of processing are:

- ColorControl cluster CurrentX (AttributeID 0x0003) has a type of uint16 and is not nullable.

Page 48







- ValueUnsigned16 of 0xAB12 would be used as-is, as it is in range.
- ValueUnsigned16 of 0xFF80 is outside of the range allowed for attribute CurrentX, and would be saturated to the closest valid value, which is the maximum of the attribute's constraint range: 0xFEFF.
- LevelControl cluster CurrentLevel (AttributeID 0x0000) has a type of uint8 and is nullable.
  - ValueUnsigned8 of 0xA1 would be used as-is, as it is in range.
  - ValueUnsigned8 of 0xFF is outside the range allowed for nullable attribute CurrentLevel, and would be considered as the null value.

#### 1.4.7.4. ExtensionFieldSetStruct Type

This data type indicates for a given cluster a set of attributes and their values.

| ID | Name                      | Type                                             | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------------|--------------------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>ClusterID</b>          | cluster-id                                       | all        |         |          |        | M           |
| 1  | <b>AttributeValueList</b> | list[ <a href="#">AttributeValuePairStruct</a> ] | desc       |         |          |        | M           |

##### 1.4.7.4.1. ClusterID Field

This field SHALL indicate the cluster-id of the cluster whose attributes are in the AttributeValueList field.

##### 1.4.7.4.2. AttributeValueList Field

This field SHALL indicate a set of attributes and their values which are stored as part of a scene.

Attributes which do not have the Scenes ("S") designation in the Quality column of their cluster specification SHALL NOT be used in the AttributeValueList field.

##### 1.4.7.4.3. Form of ExtensionFieldSetStruct

The AttributeValuePairStructs in the AttributeValueList MAY be in any order.

The AttributeValueList SHOULD contain all the attributes with the Scenes ("S") quality as the specification of the cluster identified by ClusterID describes, but AttributeValuePairStruct MAY be omitted.

An example using the Color Control cluster:

- Attribute 0x0001, CurrentSaturation, S quality, optional, implemented
- Attribute 0x0003, CurrentX, S quality, optional based on feature, implemented
- Attribute 0x0004, CurrentY, S quality, optional based on feature, implemented
- Attribute 0x0007, ColorTemperatureMireds, S quality, optional based on feature, implemented
- Attribute 0x4000, EnhancedCurrentHue, S quality, optional based on feature, implemented




Page 49



- Attribute 0x4001, EnhancedColorMode, S quality, mandatory, implemented
- Attribute 0x4002, ColorLoopActive, S quality, optional based on feature, NOT implemented
- Attribute 0x4003, ColorLoopDirection, S quality, optional based on feature, NOT implemented
- Attribute 0x4004, ColorLoopTime, S quality, optional based on feature, NOT implemented

An ExtensionFieldSetStruct containing an invalid AttributeValuePairStruct SHALL be considered invalid.

#### 1.4.7.5. Logical Scene Table

The Scene Table is used to store information for each scene capable of being invoked on the server. Each scene is defined for a particular group. The Scene Table is defined here as a conceptual illustration to assist in understanding the underlying data to be stored when scenes are defined. Though the Scene Table is defined here using the data model architecture rules and format, the design is not normative.

The Scene table is logically a list of fabric-scoped structs. The logical fields of each Scene Table entry struct are illustrated below. An ExtensionFieldSetStruct MAY be present for each Scenes-supporting cluster implemented on the same endpoint.

| Quality: Fabric Scoped |                             |                               |              |         |          |        |             |
|------------------------|-----------------------------|-------------------------------|--------------|---------|----------|--------|-------------|
| ID                     | Name                        | Type                          | Constraint   | Quality | Fallback | Access | Conformance |
| 0                      | <b>Scene-GroupID</b>        | group-id                      | all          |         |          |        | M           |
| 1                      | <b>SceneID</b>              | uint8                         | max 254      |         |          |        | M           |
| 2                      | <b>Scene-Name</b>           | string                        | max 16       |         |          |        | SN          |
| 3                      | <b>Scene-TransitionTime</b> | uint32                        | max 60000000 |         | 0        |        | M           |
| 4                      | <b>Extension-Fields</b>     | list[ExtensionFieldSetStruct] |              |         | empty    |        | M           |

##### 1.4.7.5.1. SceneGroupID Field

This field is the group identifier for which this scene applies, or 0 if the scene is not associated with a group.

##### 1.4.7.5.2. SceneID Field

This field is unique within this group, which is used to identify this scene.

Page 50







#### 1.4.7.5.3. SceneName Field

The field is the name of the scene.

If scene names are not supported, any commands that write a scene name SHALL simply discard the name, and any command that returns a scene name SHALL return an empty string.

#### 1.4.7.5.4. SceneTransitionTime Field

This field is the amount of time, in milliseconds, it will take for a cluster to change from its current state to the requested state.

#### 1.4.7.5.5. ExtensionFields Field

See the Scene Table Extensions subsections of individual clusters. A Scene Table Extension SHALL only use attributes with the Scene quality. Each ExtensionFieldSetStruct holds a set of values of these attributes for a cluster implemented on the same endpoint where the Scene ("S") designation appears in the quality column. A scene is the aggregate of all such fields across all clusters on the endpoint.

### 1.4.8. Attributes

| ID     | Name            | Type                  | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------|-----------------------|------------|---------|----------|--------|-------------|
| 0x0000 | DoNotUse        |                       |            |         |          | R V    | X           |
| 0x0001 | SceneTableSize  | uint16                | desc       | F       |          | R V    | M           |
| 0x0002 | FabricSceneInfo | list[SceneInfoStruct] | desc       |         |          | R V F  | M           |

#### 1.4.8.1. SceneTableSize Attribute

This attribute SHALL indicate the number of entries in the [Scene Table](#) on this endpoint. This is the total across all fabrics; note that a single fabric cannot use all those entries (see [Handling of fabric-scoping](#)). The minimum size of this table, (i.e., the minimum number of scenes to support across all fabrics per endpoint) SHALL be 16, unless a device type in which this cluster is used, defines a larger value in the device type definition.

#### 1.4.8.2. FabricSceneInfo Attribute

This attribute SHALL indicate a list of fabric scoped information about scenes on this endpoint.

The number of list entries for this attribute SHALL NOT exceed the number of supported fabrics by the device.

### 1.4.9. Commands




Page 51



| ID   | Name                               | Direction                   | Response                   | Access | Conformance |
|------|------------------------------------|-----------------------------|----------------------------|--------|-------------|
| 0x00 | <b>AddScene</b>                    | client $\Rightarrow$ server | AddSceneResponse           | M F    | M           |
| 0x00 | <b>AddSceneResponse</b>            | client $\Leftarrow$ server  | N                          |        | M           |
| 0x01 | <b>ViewScene</b>                   | client $\Rightarrow$ server | ViewSceneResponse          | O F    | M           |
| 0x01 | <b>ViewSceneResponse</b>           | client $\Leftarrow$ server  | N                          |        | M           |
| 0x02 | <b>RemoveScene</b>                 | client $\Rightarrow$ server | RemoveSceneResponse        | M F    | M           |
| 0x02 | <b>RemoveSceneResponse</b>         | client $\Leftarrow$ server  | N                          |        | M           |
| 0x03 | <b>RemoveAllScenes</b>             | client $\Rightarrow$ server | RemoveAllScenesResponse    | M F    | M           |
| 0x03 | <b>RemoveAllScenesResponse</b>     | client $\Leftarrow$ server  | N                          |        | M           |
| 0x04 | <b>StoreScene</b>                  | client $\Rightarrow$ server | StoreSceneResponse         | M F    | M           |
| 0x04 | <b>StoreSceneResponse</b>          | client $\Leftarrow$ server  | N                          |        | M           |
| 0x05 | <b>RecallScene</b>                 | client $\Rightarrow$ server | Y                          | O F    | M           |
| 0x06 | <b>GetScene-Membership</b>         | client $\Rightarrow$ server | GetSceneMembershipResponse | O F    | M           |
| 0x06 | <b>GetScene-MembershipResponse</b> | client $\Leftarrow$ server  | N                          |        | M           |
| 0x40 | <b>CopyScene</b>                   | client $\Rightarrow$ server | CopySceneResponse          | M F    | O           |
| 0x40 | <b>CopySceneResponse</b>           | client $\Leftarrow$ server  | N                          |        | CopyScene   |

#### 1.4.9.1. Generic Usage Notes

The scene identifier 0, when used with group identifier 0, is reserved for the global scene used by the On/Off cluster.

#### 1.4.9.2. AddScene Command

This command is used to add a new scene.

Page 52



| ID | Name                            | Type                                            | Constraint   | Quality | Fallback | Conformance |
|----|---------------------------------|-------------------------------------------------|--------------|---------|----------|-------------|
| 0  | <b>GroupID</b>                  | group-id                                        | all          |         |          | M           |
| 1  | <b>SceneID</b>                  | uint8                                           | max 254      |         |          | M           |
| 2  | <b>TransitionTime</b>           | uint32                                          | max 60000000 |         |          | M           |
| 3  | <b>SceneName</b>                | string                                          | max 16       |         |          | M           |
| 4  | <b>ExtensionFieldSetStructs</b> | list[ <a href="#">ExtensionFieldSetStruct</a> ] | desc         |         |          | M           |

It is not mandatory for an extension field set to be included in the command for every cluster on that endpoint that has a defined extension field set. Extension field sets MAY be omitted, including the case of no extension field sets at all.

#### 1.4.9.2.1. GroupID Field

This field SHALL indicate the group identifier in the Group Table.

#### 1.4.9.2.2. SceneID Field

This field SHALL indicate the scene identifier in the Scene Table.

#### 1.4.9.2.3. TransitionTime Field

This field SHALL indicate the transition time of the scene, measured in milliseconds.

#### 1.4.9.2.4. SceneName Field

This field SHALL indicate the name of the scene.

#### 1.4.9.2.5. ExtensionFieldSetStructs Field

This field SHALL contains the list of extension fields.

#### 1.4.9.2.6. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of the GroupID field is non-zero, the server verifies that the endpoint has an entry for that GroupID in the Group Table. If there is no such entry in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 5.
2. If the ExtensionFieldSetStructs list is formatted in a way deemed invalid according to the ExtensionFieldSetStruct structure definition (see [ExtensionFieldSetStruct](#)), then the status SHALL be INVALID\_COMMAND in the AddSceneResponse, and the server continues from step 5.
3. If a scene already exists under the same group/scene identifier pair, in step 4 the already existing scene entry SHALL be replaced with the new scene being added. Otherwise, if a scene cannot be created due to the lack of Scene Table capacity for the given fabric, the status SHALL be




Page 53



RESOURCE\_EXHAUSTED and the server continues from step 5.

4. The server adds the scene entry into its Scene Table with fields copied from the AddScene command data fields and the status SHALL be SUCCESS.
  - a. Any ExtensionFieldSetStruct referencing a ClusterID that is not implemented on the endpoint MAY be omitted during processing.
  - b. Any AttributeValuePairStruct referencing an AttributeID from the referenced cluster that is not implemented on the endpoint MAY be omitted during processing.
  - c. If the ExtensionFieldSetStructs list has multiple entries listing the same ClusterID, the last one within the list SHALL be the one recorded.
  - d. Within a single entry of the ExtensionFieldSetStructs list, if an ExtensionFieldSet contains the same AttributeID more than once, the last one within the ExtensionFieldSet SHALL be the one recorded.
5. If the AddScene command was received as a unicast, the server SHALL then generate an AddSceneResponse command with the Status field set to the evaluated status.

The SceneTransitionTime field of the Scene Table SHALL be updated with the value of the TransitionTime.

#### 1.4.9.3. AddSceneResponse Command

This command is sent in response to the [AddScene](#) command.

| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>Status</b>  | status   | desc       |         |          | M           |
| 1  | <b>GroupID</b> | group-id | all        |         |          | M           |
| 2  | <b>SceneID</b> | uint8    | max 254    |         |          | M           |

##### 1.4.9.3.1. Status Field

This field SHALL be set according to the Effect on Receipt section for [AddScene](#) command.

##### 1.4.9.3.2. GroupID Field

The GroupID field SHALL be set to the corresponding field of the received [AddScene](#) command.

##### 1.4.9.3.3. SceneID Field

The SceneID field SHALL be set to the corresponding field of the received [AddScene](#) command.

##### 1.4.9.3.4. When Generated

This command is generated in response to a received [AddScene](#) command.

#### 1.4.9.4. ViewScene Command

This command returns the details for the requested scene.

Page 54



| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>GroupID</b> | group-id | all        |         |          | M           |
| 1  | <b>SceneID</b> | uint8    | max 254    |         |          | M           |

#### 1.4.9.4.1. GroupID Field

This field SHALL indicate the group identifier in the Group Table.

#### 1.4.9.4.2. SceneID Field

This field SHALL indicate the scene identifier in the Scene Table.

#### 1.4.9.4.3. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of the GroupID field is non-zero, the server verifies that the endpoint has an entry for that GroupID in the Group Table. If there is no such entry in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 4.
2. The server verifies that the scene entry corresponding to the GroupID and SceneID fields exists in its Scene Table. If there is no such entry in its Scene Table, the status SHALL be NOT\_FOUND and the server continues from step 4.
3. The server retrieves the requested scene entry from its Scene Table and the status SHALL be SUCCESS.
4. If the ViewScene command was received as a unicast, the server SHALL then generate a ViewSceneResponse command with the retrieved scene entry and the Status field set to the evaluated status.

#### NOTE

The order of attributes within the ExtensionFieldSetStruct MAY differ in implementation-defined ways from any potential order given in a prior AddScene.

### 1.4.9.5. ViewSceneResponse Command

This command is sent in response to the [ViewScene](#) command.

| ID | Name                        | Type     | Constraint      | Quality | Fallback | Conformance          |
|----|-----------------------------|----------|-----------------|---------|----------|----------------------|
| 0  | <b>Status</b>               | status   | desc            |         |          | M                    |
| 1  | <b>GroupID</b>              | group-id | all             |         |          | M                    |
| 2  | <b>SceneID</b>              | uint8    | max 254         |         |          | M                    |
| 3  | <b>Transition-<br/>Time</b> | uint32   | max<br>60000000 |         |          | Status ==<br>SUCCESS |
| 4  | <b>SceneName</b>            | string   | max 16          |         |          | Status ==<br>SUCCESS |




Page 55



| ID | Name                       | Type                           | Constraint | Quality | Fallback | Conformance       |
|----|----------------------------|--------------------------------|------------|---------|----------|-------------------|
| 5  | Extension-FieldSet-Structs | list[ExtensionFieldSet-Struct] |            |         |          | Status == SUCCESS |

#### 1.4.9.5.1. Status Field

This field SHALL be set according to the Effect on Receipt section for [ViewScene](#) command.

#### 1.4.9.5.2. GroupID Field

The GroupID field SHALL be set to the corresponding field of the received [ViewScene](#) command.

#### 1.4.9.5.3. SceneID Field

The SceneID field SHALL be set to the corresponding field of the received [ViewScene](#) command.

#### 1.4.9.5.4. TransitionTime Field

This field SHALL be set to the corresponding field in the Scene Table entry.

#### 1.4.9.5.5. SceneName Field

This field SHALL be set to the corresponding field in the Scene Table entry.

#### 1.4.9.5.6. ExtensionFieldSetStructs Field

This field SHALL be set to the corresponding field in the Scene Table entry.

#### 1.4.9.5.7. When Generated

This command is generated in response to a received [ViewScene](#) command.

### 1.4.9.6. RemoveScene Command

This command removes the specified scene.

| ID | Name    | Type     | Constraint | Quality | Fallback | Conformance |
|----|---------|----------|------------|---------|----------|-------------|
| 0  | GroupID | group-id | all        |         |          | M           |
| 1  | SceneID | uint8    | max 254    |         |          | M           |

#### 1.4.9.6.1. GroupID Field

This field SHALL indicate the group identifier in the Group Table.

#### 1.4.9.6.2. SceneID Field

This field SHALL indicate the scene identifier in the Scene Table.

Page 56







#### 1.4.9.6.3. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of the GroupID field is non-zero, the server verifies that the endpoint has an entry for that GroupID in the Group Table. If there is no such entry in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 4.
2. The server verifies that the scene entry corresponding to the GroupID and SceneID fields exists in its Scene Table. If there is no such entry in its Scene Table, the status SHALL be NOT\_FOUND and the server continues from step 4.
3. The server removes the requested scene entry from its Scene Table and the status SHALL be SUCCESS.
4. If the RemoveScene command was received as a unicast, the server SHALL then generate a RemoveSceneResponse command with the Status field set to the evaluated status.

#### 1.4.9.7. RemoveSceneResponse Command

This command is sent in response to the [RemoveScene](#) command.

| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>Status</b>  | status   | desc       |         |          | M           |
| 1  | <b>GroupID</b> | group-id | all        |         |          | M           |
| 2  | <b>SceneID</b> | uint8    | max 254    |         |          | M           |

##### 1.4.9.7.1. Status Field

This field SHALL be set according to the Effect on Receipt section for [RemoveScene](#) command.

##### 1.4.9.7.2. GroupID Field

The GroupID field SHALL be set to the corresponding field of the received [RemoveScene](#) command.

##### 1.4.9.7.3. SceneID Field

The SceneID field SHALL be set to the corresponding field of the received [RemoveScene](#) command.

##### 1.4.9.7.4. When Generated

This command is generated in response to a received [RemoveScene](#) command.

#### 1.4.9.8. RemoveAllScenes Command

This command removes all scenes for the specified GroupID.

| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>GroupID</b> | group-id | all        |         |          | M           |




Page 57



#### 1.4.9.8.1. GroupID Field

This field SHALL indicate the group identifier in the Group Table.

#### 1.4.9.8.2. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of the GroupID field is non-zero, the server verifies that the endpoint has an entry for that GroupID in the Group Table. If there is no such entry in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 3.
2. The server SHALL remove all scenes, corresponding to the value of the GroupID field, from its Scene Table and the status SHALL be SUCCESS.
3. If the RemoveAllScenes command was received as a unicast, the server SHALL then generate a RemoveAllScenesResponse command with the Status field set to the evaluated status.

### 1.4.9.9. RemoveAllScenesResponse Command

This command is sent in response to the [RemoveAllScenes](#) command.

| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>Status</b>  | status   | desc       |         |          | M           |
| 1  | <b>GroupID</b> | group-id | all        |         |          | M           |

#### 1.4.9.9.1. Status Field

This field SHALL be set according to the Effect on Receipt section for [RemoveAllScenes](#) command.

#### 1.4.9.9.2. GroupID Field

The GroupID field SHALL be set to the corresponding field of the received [RemoveAllScenes](#) command.

#### 1.4.9.9.3. When Generated

This command is generated in response to a received [RemoveAllScenes](#) command.

### 1.4.9.10. StoreScene Command

This command will create a new entry for the requested scene.

| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>GroupID</b> | group-id | all        |         |          | M           |
| 1  | <b>SceneID</b> | uint8    | max 254    |         |          | M           |

Page 58



#### 1.4.9.10.1. GroupID Field

This field SHALL indicate the group identifier in the Group Table.

#### 1.4.9.10.2. SceneID Field

This field SHALL indicate the scene identifier in the Scene Table.

#### 1.4.9.10.3. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of the GroupID field is non-zero, the server verifies that the endpoint has an entry for that GroupID in the Group Table. If there is no such entry in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 4.
2. If a scene already exists under the same group/scene identifier pair, in step 3 the already existing scene entry SHALL be used to store the current state.  
If a scene cannot be created due to the lack of Scene Table capacity for the given fabric, the status SHALL be RESOURCE\_EXHAUSTED and the server continues from step 4.
3. If a scene already exists under the same group/scene identifier pair, the ExtensionFieldSets of the stored scene SHALL be replaced with the ExtensionFieldSets corresponding to the current state of other clusters on the same endpoint and the other fields of the scene table entry SHALL remain unchanged.  
Otherwise, a new entry SHALL be added to the scene table, using the provided GroupID and SceneID, with SceneTransitionTime set to 0, with SceneName set to the empty string, and with ExtensionFieldSets corresponding to the current state of other clusters on the same endpoint. The status SHALL be SUCCESS.
4. If the StoreScene command was received as a unicast, the server SHALL then generate a StoreSceneResponse command with the Status field set to the evaluated status.

Note that if a scene to be stored requires a TransitionTime field and/or a SceneName field, these must be set up by a prior AddScene command, e.g., with no scene extension field sets.

#### 1.4.9.11. StoreSceneResponse Command

This command is sent in response to the [StoreScene](#) command.

| ID | Name    | Type     | Constraint | Quality | Fallback | Conformance |
|----|---------|----------|------------|---------|----------|-------------|
| 0  | Status  | status   | desc       |         |          | M           |
| 1  | GroupID | group-id | all        |         |          | M           |
| 2  | SceneID | uint8    | max 254    |         |          | M           |

##### 1.4.9.11.1. Status Field

This field SHALL be set according to the Effect on Receipt section for [StoreScene](#) command.



Page 59



#### 1.4.9.11.2. GroupID Field

The GroupID field SHALL be set to the corresponding field of the received [StoreScene](#) command.

#### 1.4.9.11.3. SceneID Field

The SceneID field SHALL be set to the corresponding field of the received [StoreScene](#) command.

#### 1.4.9.11.4. When Generated

This command is generated in response to a received [StoreScene](#) command.

### 1.4.9.12. RecallScene Command

This command will cause the specified scene to be recalled.

| ID | Name                  | Type     | Constraint   | Quality | Fallback | Conformance |
|----|-----------------------|----------|--------------|---------|----------|-------------|
| 0  | <b>GroupID</b>        | group-id | all          |         |          | M           |
| 1  | <b>SceneID</b>        | uint8    | max 254      |         |          | M           |
| 2  | <b>TransitionTime</b> | uint32   | max 60000000 | X       |          | O           |

#### 1.4.9.12.1. GroupID Field

This field SHALL indicate the group identifier in the Group Table.

#### 1.4.9.12.2. SceneID Field

This field SHALL indicate the scene identifier in the Scene Table.

#### 1.4.9.12.3. TransitionTime Field

This field SHALL indicate the transition time of the scene, measured in milliseconds.

#### 1.4.9.12.4. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of the GroupID field is non-zero, the server verifies that the endpoint has an entry for that GroupID in the Group Table. If there is no such entry in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 4.
2. The server verifies that the scene entry corresponding to the GroupID and SceneID fields exists in its Scene Table. If there is no such entry in its Scene Table, the status SHALL be NOT\_FOUND and the server continues from step 4.
3. The server retrieves the requested scene entry from its Scene Table. For each other cluster implemented on the endpoint, it SHALL retrieve any corresponding extension field sets from the Scene Table and set the attributes and corresponding state of the cluster accordingly. If there is no extension field set for a cluster, the state of that cluster SHALL remain unchanged. If

Page 60



an extension field set omits the values of any attributes, the values of these attributes SHALL remain unchanged. If an extension field set would cause an unknown or missing attribute to be set for any reason, that attribute SHALL be skipped. The status SHALL be SUCCESS.

4. If the RecallScene command was received as a unicast, the server SHALL then generate a response with the Status field set to the evaluated status.

If the TransitionTime data field is present in the command and its value is not equal to null, this field SHALL indicate the transition time in milliseconds. In all other cases (command data field not present or value equal to null), the SceneTransitionTime field of the Scene Table entry SHALL indicate the transition time. The transition time determines how long the transition takes from the old cluster state to the new cluster state. It is recommended that, where possible (e.g., it is not possible for attributes with Boolean data type), a gradual transition SHOULD take place from the old to the new state over this time. However, the exact transition algorithm is implementation-defined.

#### 1.4.9.13. GetSceneMembership Command

This command can be used to get the used scene identifiers within a certain group, for the endpoint that implements this cluster.

| ID | Name           | Type     | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------|------------|---------|----------|-------------|
| 0  | <b>GroupID</b> | group-id | all        |         |          | M           |

##### 1.4.9.13.1. GroupID Field

This field SHALL indicate the group identifier in the Group Table.

##### 1.4.9.13.2. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of the GroupID field is non-zero, the server verifies that the endpoint has an entry for that GroupID in the Group Table. If there is no such entry in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 3.
2. The status SHALL be SUCCESS.
3. If the GetSceneMembership command was received as a unicast, the server SHALL then generate a GetSceneMembershipResponse command with the Status field set to the evaluated status.

#### 1.4.9.14. GetSceneMembershipResponse Command

This command is sent in response to the [GetSceneMembership](#) command.

| ID | Name            | Type     | Constraint | Quality | Fallback | Conformance |
|----|-----------------|----------|------------|---------|----------|-------------|
| 0  | <b>Status</b>   | status   | desc       |         |          | M           |
| 1  | <b>Capacity</b> | uint8    | all        | X       |          | M           |
| 2  | <b>GroupID</b>  | group-id | all        |         |          | M           |



Page 61



| ID | Name             | Type        | Constraint | Quality | Fallback | Conformance       |
|----|------------------|-------------|------------|---------|----------|-------------------|
| 3  | <b>SceneList</b> | list[uint8] |            |         |          | Status == Success |

#### 1.4.9.14.1. Status Field

This field SHALL be set according to the Effect on Receipt section for [GetSceneMembership](#) command.

#### 1.4.9.14.2. Capacity Field

This field SHALL contain the remaining capacity of the Scene Table of the server (for all groups for the accessing fabric). The following values apply:

- 0 - No further scenes MAY be added.
- $0 < \text{Capacity} < 0xFE$  - Capacity holds the number of scenes that MAY be added.
- $0xFE$  - At least 1 further scene MAY be added (exact number is unknown).
- null - It is unknown if any further scenes MAY be added.

#### 1.4.9.14.3. GroupID Field

This field SHALL be set to the corresponding field of the received [GetSceneMembership](#) command.

#### 1.4.9.14.4. SceneList Field

If the status is not SUCCESS then this field SHALL be omitted, else this field SHALL contain the identifiers of all the scenes in the Scene Table with the corresponding Group ID.

#### 1.4.9.14.5. When Generated

This command is generated in response to a received [GetSceneMembership](#) command.

### 1.4.9.15. CopyScene Command

This command allows a client to efficiently copy scenes from one group/scene identifier pair to another group/scene identifier pair.

| ID | Name                       | Type                           | Constraint | Quality | Fallback | Conformance |
|----|----------------------------|--------------------------------|------------|---------|----------|-------------|
| 0  | <b>Mode</b>                | <a href="#">CopyModeBitmap</a> | desc       |         |          | M           |
| 1  | <b>GroupIdentifierFrom</b> | group-id                       | all        |         |          | M           |
| 2  | <b>SceneIdentifierFrom</b> | uint8                          | max 254    |         |          | M           |

Page 62



| ID | Name                     | Type     | Constraint | Quality | Fallback | Conformance |
|----|--------------------------|----------|------------|---------|----------|-------------|
| 3  | <b>GroupIdentifierTo</b> | group-id | all        |         |          | M           |
| 4  | <b>SceneIdentifierTo</b> | uint8    | max 254    |         |          | M           |

#### 1.4.9.15.1. Mode Field

This field SHALL contain the information of how the scene copy is to proceed.

The CopyAllScenes bit of the Mode indicates whether all scenes are to be copied. If this value is set to 1, all scenes are to be copied and the SceneIdentifierFrom and SceneIdentifierTo fields SHALL be ignored. Otherwise this bit is set to 0.

#### 1.4.9.15.2. GroupIdentifierFrom Field

This field SHALL indicate the identifier of the group from which the scene is to be copied. Together with the SceneIdentifierFrom field, this field uniquely identifies the scene to copy from the Scene Table.

#### 1.4.9.15.3. SceneIdentifierFrom Field

This field SHALL indicate the identifier of the scene from which the scene is to be copied. Together with the GroupIdentifierFrom field, this field uniquely identifies the scene to copy from the Scene Table.

#### 1.4.9.15.4. GroupIdentifierTo Field

This field SHALL indicate the identifier of the group to which the scene is to be copied. Together with the SceneIdentifierTo field, this field uniquely identifies the scene to copy to the Scene Table.

#### 1.4.9.15.5. SceneIdentifierTo Field

This field SHALL indicate the identifier of the scene to which the scene is to be copied. Together with the GroupIdentifierTo field, this field uniquely identifies the scene to copy to the Scene Table.

#### 1.4.9.15.6. Effect on Receipt

On receipt of this command, the server SHALL perform the following procedure:

1. If the value of either the GroupIdentifierFrom field or the Group Identifier To field is non-zero, the server verifies that the endpoint has an entry for these non-zero group identifiers in the Group Table. If there are no such entries in the Group Table, the status SHALL be INVALID\_COMMAND and the server continues from step 5.
2. If the CopyAllScenes sub-field of the Mode field is set to 0, the server verifies that the scene entry corresponding to the GroupIdentifierFrom and SceneIdentifierFrom fields exists in its Scene Table. If there is no such entry in its Scene Table, the status SHALL be NOT\_FOUND and the server continues from step 5.




Page 63



3. If the CopyAllScenes sub-field of the Mode field is set to 1, the server SHALL copy all its available scenes with group identifier equal to the GroupIdentifierFrom field under the group identifier specified in the GroupIdentifierTo field, leaving the scene identifiers the same. In this case, the SceneIdentifierFrom and SceneIdentifierTo fields SHALL be ignored.

If the CopyAllScenes sub-field of the Mode field is set to 0, the server SHALL copy the Scene Table entry corresponding to the GroupIdentifierFrom and SceneIdentifierFrom fields to the Scene Table entry corresponding to the GroupIdentifierTo and SceneIdentifierTo fields.

Regardless of the value of the CopyAllScenes subfield, if a scene already exists under the same group/scene identifier pair, it SHALL be replaced with the scene being copied.

Regardless of the value of the CopyAllScenes subfield, if a scene cannot be copied due to the lack of Scene Table capacity for the given fabric, the status SHALL be RESOURCE\_EXHAUSTED and the server continues from step 5. In this case, scenes already copied SHALL be kept.

4. The status SHALL be SUCCESS.
5. If the CopyScene command was received as a unicast, the server SHALL then generate a CopySceneResponse command with the Status field set to the evaluated status.

#### 1.4.9.16. CopySceneResponse Command

This command is sent in response to the [CopyScene](#) command.

| ID | Name                | Type     | Constraint | Quality | Fallback | Conformance |
|----|---------------------|----------|------------|---------|----------|-------------|
| 0  | Status              | status   | desc       |         |          | M           |
| 1  | GroupIdentifierFrom | group-id | all        |         |          | M           |
| 2  | SceneIdentifierFrom | uint8    | max 254    |         |          | M           |

##### 1.4.9.16.1. Status Field

This field SHALL be set according to the Effect on Receipt section for the [CopyScene](#) command.

##### 1.4.9.16.2. GroupIdentifierFrom Field

This field SHALL be set to the same values as in the corresponding fields of the received [CopyScene](#) command.

##### 1.4.9.16.3. SceneIdentifierFrom Field

This field SHALL be set to the same values as in the corresponding fields of the received [CopyScene](#) command.

##### 1.4.9.16.4. When Generated

The CopySceneResponse command is generated in response to a received [CopyScene](#) command.

Page 64



## 1.5. On/Off Cluster

Attributes and commands for turning devices on and off.

### 1.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                 |
|----------|-----------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added; CCB 1555                  |
| 2        | ZLO 1.0: StartUpOnOff                                                       |
| 3        | FeatureMap global attribute support with Level Control and Lighting feature |
| 4        | New data model format and notation                                          |
| 5        | Addition of Dead Front behavior and associated FeatureMap entry             |
| 6        | Addition of OffOnly feature and associated FeatureMap entry                 |

### 1.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | 00        |

### 1.5.3. Cluster ID

| ID     | Name   |
|--------|--------|
| 0x0006 | On/Off |

### 1.5.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature           | Conformance | Summary                                        |
|-----|------|-------------------|-------------|------------------------------------------------|
| 0   | LT   | Lighting          | [!OFFONLY]  | Behavior that supports lighting applications.  |
| 1   | DF   | DeadFrontBehavior | [!OFFONLY]  | Device has <a href="#">Dead Front behavior</a> |




Page 65



| Bit | Code    | Feature | Conformance | Summary                                             |
|-----|---------|---------|-------------|-----------------------------------------------------|
| 2   | OFFONLY | OffOnly | [(LT   DF)] | Device supports the <a href="#">OffOnly</a> feature |

#### 1.5.4.1. Lighting Feature

This cluster is used for a lighting application.

On receipt of a Level Control cluster command that causes the OnOff attribute to be set to FALSE, the OnTime attribute SHALL be set to 0.

On receipt of a Level Control cluster command that causes the OnOff attribute to be set to TRUE, if the value of the OnTime attribute is equal to 0, the server SHALL set the OffWaitTime attribute to 0.

#### 1.5.4.2. DeadFrontBehavior Feature

When this feature is supported, the device exposing this server cluster exhibits "dead front" behavior when the "OnOff" attribute is FALSE (Off). This "dead front" behavior includes:

- clusters other than this cluster that are also exposed MAY respond with failures to Invoke and Write interactions. Such failure responses when in a "dead front" SHALL be with an INVALID\_IN\_STATE status code.
- clusters other than this cluster MAY change the values of their attributes to best-effort values, due to the actual values not being defined or available in this state. Device type specifications that require support for the DF feature SHOULD define what these best-effort values are.
- Report Transactions SHALL continue to be generated. Such transactions MAY include best-effort values as noted above.
- Event generation logic for clusters other than this cluster is unchanged (noting possible use of best-effort attribute values as in the preceding bullets).

When this feature is supported and the OnOff attribute changes from TRUE to FALSE (e.g. when receiving an Off Command, or due to a manual interaction on the device), it SHALL start executing this "dead front" behavior.

When this feature is supported and the OnOff attribute changes from FALSE to TRUE (e.g. when receiving an On Command, or due to a manual interaction on the device), it SHALL stop executing this "dead front" behavior.

When this feature is supported, and any change of the "dead front" state leads to changes in attributes of other clusters due to the "dead front" feature, these attribute changes SHALL NOT be skipped or omitted from the usual processing associated with attribute changes. For example, if an attribute changes from value 4 to null on "dead front" behavior due to an Off command being received, this change SHALL be processed for reporting and subscriptions.

#### 1.5.4.3. OffOnly Feature

When this feature is supported, the [Off](#) command SHALL be supported and the [On](#) and [Toggle](#) com-

Page 66



mands SHALL NOT be supported.

This feature is useful for devices which can be turned off via the [Off](#) command received by an instance of this cluster but cannot be turned on via commands received by an instance of this cluster due to regulatory requirements.

## 1.5.5. Data Types

### 1.5.5.1. OnOffControlBitmap Type

This data type is derived from map8.

| Bit | Name                    | Summary                                                | Conformance |
|-----|-------------------------|--------------------------------------------------------|-------------|
| 0   | <b>AcceptOnlyWhenOn</b> | Indicates a command is only accepted when in On state. | M           |

### 1.5.5.2. StartUpOnOffEnum Type

This data type is derived from enum8.

| Value | Name          | Summary                                                                                                                                                                                                    | Conformance |
|-------|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>Off</b>    | Set the OnOff attribute to FALSE                                                                                                                                                                           | M           |
| 1     | <b>On</b>     | Set the OnOff attribute to TRUE                                                                                                                                                                            | M           |
| 2     | <b>Toggle</b> | If the previous value of the OnOff attribute is equal to FALSE, set the OnOff attribute to TRUE. If the previous value of the OnOff attribute is equal to TRUE, set the OnOff attribute to FALSE (toggle). | M           |

### 1.5.5.3. EffectIdentifierEnum Type

This data type is derived from enum8.

| Value | Name          | Summary         | Conformance |
|-------|---------------|-----------------|-------------|
| 0x00  | DelayedAllOff | Delayed All Off | M           |
| 0x01  | DyingLight    | Dying Light     | M           |



Page 67



#### 1.5.5.4. DelayedAllOffEffectVariantEnum Type

This data type is derived from enum8.

| Value | Name               | Summary                                                    | Conformance |
|-------|--------------------|------------------------------------------------------------|-------------|
| 0x00  | DelayedOffFastFade | Fade to off in 0.8 seconds                                 | M           |
| 0x01  | NoFade             | No fade                                                    | M           |
| 0x02  | DelayedOffSlowFade | 50% dim down in 0.8 seconds then fade to off in 12 seconds | M           |

#### 1.5.5.5. DyingLightEffectVariantEnum Type

This data type is derived from enum8.

| Value | Name              | Summary                                         | Conformance |
|-------|-------------------|-------------------------------------------------|-------------|
| 0x00  | DyingLightFadeOff | 20% dim up in 0.5s then fade to off in 1 second | M           |

### 1.5.6. Attributes

| ID     | Name                      | Type             | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------------------|------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>OnOff</b>              | bool             | all        | N S     |          | R V    | M           |
| 0x4000 | <b>GlobalSceneControl</b> | bool             | all        |         |          | R V    | LT          |
| 0x4001 | <b>OnTime</b>             | uint16           | all        |         |          | RW VO  | LT          |
| 0x4002 | <b>OffWaitTime</b>        | uint16           | all        |         |          | RW VO  | LT          |
| 0x4003 | <b>StartUpOnOff</b>       | StartUpOnOffEnum | desc       | N X     |          | RW VM  | LT          |

#### 1.5.6.1. Scene Table Extensions

If the Scenes Management server cluster is implemented on the same endpoint, the following attribute SHALL be part of the ExtensionFieldSetStruct of the Scene Table.

- OnOff

#### 1.5.6.2. OnOff Attribute

This attribute indicates whether the device type implemented on the endpoint is turned off or

Page 68







turned on, in these cases the value of the OnOff attribute equals FALSE, or TRUE respectively.

### 1.5.6.3. GlobalSceneControl Attribute

In order to support the use case where the user gets back the last setting of a set of devices (e.g. level settings for lights), a global scene is introduced which is stored when the devices are turned off and recalled when the devices are turned on. The global scene is defined as the scene that is stored with group identifier 0 and scene identifier 0.

This attribute is defined in order to prevent a second Off command storing the all-devices-off situation as a global scene, and to prevent a second On command destroying the current settings by going back to the global scene.

This attribute SHALL be set to TRUE after the reception of a command which causes the OnOff attribute to be set to TRUE, such as a standard On command, a MoveToLevel(WithOnOff) command, a RecallScene command or a [OnWithRecallGlobalScene](#) command.

This attribute is set to FALSE after reception of a OffWithEffect command.

These concepts are illustrated in [Explanation of the Behavior of Store and Recall Global Scene functionality using a State Diagram](#).

![State Diagram for GlobalSceneControl functionality. The diagram shows two main states: 'GlobalSceneControl := TRUE' and 'GlobalSceneControl := FALSE'. Transitions include 'OffWithEffect' to 'store global scene' (which then leads to 'GlobalSceneControl := FALSE'), 'On¹' from 'GlobalSceneControl := FALSE' to 'GlobalSceneControl := TRUE', and 'OnWithRecallGlobalScene' from 'GlobalSceneControl := FALSE' to 'recall global scene' (which then leads to 'GlobalSceneControl := TRUE'). Self-loops for 'other commands' exist on both main states.](a7721892ae499a78173ff3dfdc4e65a9_img.jpg)

```

stateDiagram-v2
    [*] --> GlobalSceneControl_TRUE((GlobalSceneControl := TRUE))
    GlobalSceneControl_TRUE --> store_global_scene((store global scene))
    store_global_scene --> GlobalSceneControl_FALSE((GlobalSceneControl := FALSE))
    GlobalSceneControl_FALSE --> recall_global_scene((recall global scene))
    recall_global_scene --> GlobalSceneControl_TRUE
    GlobalSceneControl_TRUE --> OffWithEffect((OffWithEffect))
    OffWithEffect --> store_global_scene
    GlobalSceneControl_TRUE --> other_commands((other commands))
    GlobalSceneControl_FALSE --> other_commands
    GlobalSceneControl_FALSE --> On1((On¹))
    On1 --> GlobalSceneControl_TRUE
    GlobalSceneControl_FALSE --> OnWithRecallGlobalScene((OnWithRecallGlobalScene))
    OnWithRecallGlobalScene --> recall_global_scene
  
```

State Diagram for GlobalSceneControl functionality. The diagram shows two main states: 'GlobalSceneControl := TRUE' and 'GlobalSceneControl := FALSE'. Transitions include 'OffWithEffect' to 'store global scene' (which then leads to 'GlobalSceneControl := FALSE'), 'On¹' from 'GlobalSceneControl := FALSE' to 'GlobalSceneControl := TRUE', and 'OnWithRecallGlobalScene' from 'GlobalSceneControl := FALSE' to 'recall global scene' (which then leads to 'GlobalSceneControl := TRUE'). Self-loops for 'other commands' exist on both main states.

Note 1: Any command which causes the OnOff attribute to be set to TRUE except OnWithRecallGlobalScene, e.g. On or Toggle.

Figure 1. Explanation of the Behavior of Store and Recall Global Scene functionality using a State Diagram

### 1.5.6.4. OnTime Attribute

This attribute specifies the length of time (in 1/10ths second) that the On state SHALL be maintained before automatically transitioning to the Off state when using the `OnWithTimedOff` command. This attribute can be written at any time, but writing a value only has effect when in the Timed On state. See [OnWithTimedOff](#) for more details.



Page 69



#### 1.5.6.5. OffWaitTime Attribute

This attribute specifies the length of time (in 1/10ths second) that the Off state SHALL be guarded to prevent another OnWithTimedOff command turning the server back to its On state (e.g., when leaving a room, the lights are turned off but an occupancy sensor detects the leaving person and attempts to turn the lights back on). This attribute can be written at any time, but writing a value only has an effect when in the Timed On state followed by a transition to the Delayed Off state, or in the Delayed Off state. See [OnWithTimedOff](#) for more details.

#### 1.5.6.6. StartUpOnOff Attribute

This attribute SHALL define the desired startup behavior of a device when it is supplied with power and this state SHALL be reflected in the OnOff attribute. If the value is null, the OnOff attribute is set to its previous value. Otherwise, the behavior is defined in the table defining [StartUpOnOffEnum](#).

This behavior does not apply to reboots associated with OTA. After an OTA restart, the OnOff attribute SHALL return to its value prior to the restart.

### 1.5.7. Commands

| ID   | Name                            | Direction                   | Response | Access | Conformance |
|------|---------------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>Off</b>                      | client $\Rightarrow$ server | Y        | O      | M           |
| 0x01 | <b>On</b>                       | client $\Rightarrow$ server | Y        | O      | !OFFONLY    |
| 0x02 | <b>Toggle</b>                   | client $\Rightarrow$ server | Y        | O      | !OFFONLY    |
| 0x40 | <b>OffWithEffect</b>            | client $\Rightarrow$ server | Y        | O      | LT          |
| 0x41 | <b>OnWithRecall-GlobalScene</b> | client $\Rightarrow$ server | Y        | O      | LT          |
| 0x42 | <b>OnWith-TimedOff</b>          | client $\Rightarrow$ server | Y        | O      | LT          |

#### 1.5.7.1. Off Command

This command allows devices to be turned off.

##### 1.5.7.1.1. Effect on Receipt

On receipt of the Off command, a server SHALL set the OnOff attribute to FALSE.

Additionally, when the OnTime attribute is supported, the server SHALL set the OnTime attribute to 0.

#### 1.5.7.2. On Command

This command allows devices to be turned on.

Page 70



#### 1.5.7.2.1. Effect on Receipt

If the OffOnly feature is supported, on receipt of the On command, an UNSUPPORTED\_COMMAND failure status response SHALL be sent. Otherwise, on receipt of the On command, a server SHALL set the OnOff attribute to TRUE.

Additionally, when the OnTime and OffWaitTime attributes are both supported, if the value of the OnTime attribute is equal to 0, the server SHALL set the OffWaitTime attribute to 0.

#### 1.5.7.3. Toggle Command

This command allows devices to be toggled.

##### 1.5.7.3.1. Effect on Receipt

If the OffOnly feature is supported, on receipt of the Toggle command, an UNSUPPORTED\_COMMAND failure status response SHALL be sent. Otherwise, on receipt of the Toggle command, if the value of the OnOff attribute is equal to FALSE, the server SHALL set the OnOff attribute to TRUE, otherwise, the server SHALL set the OnOff attribute to FALSE.

Additionally, when the OnTime and OffWaitTime attributes are both supported, if the value of the OnOff attribute is equal to FALSE and if the value of the OnTime attribute is equal to 0, the server SHALL set the OffWaitTime attribute to 0. If the value of the OnOff attribute is equal to TRUE, the server SHALL set the OnTime attribute to 0.

#### 1.5.7.4. OffWithEffect Command

The OffWithEffect command allows devices to be turned off using enhanced ways of fading.

The OffWithEffect command SHALL have the following data fields:

| ID | Name                    | Type                                 | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|--------------------------------------|------------|---------|----------|-------------|
| 0  | <b>EffectIdentifier</b> | <a href="#">EffectIdentifierEnum</a> | desc       |         |          | M           |
| 1  | <b>EffectVariant</b>    | enum8                                | desc       |         |          | M           |

##### 1.5.7.4.1. EffectIdentifier Field

This field specifies the fading effect to use when turning the device off. This field SHALL contain one of the non-reserved values listed in [EffectIdentifierEnum](#).

##### 1.5.7.4.2. EffectVariant Field

This field is used to indicate which variant of the effect, indicated in the EffectIdentifier field, SHOULD be triggered. If the server does not support the given variant, it SHALL use the default variant. This field is dependent on the value of the EffectIdentifier field and SHALL contain one of the non-reserved values listed in either [DelayedAllOffEffectVariantEnum](#) or [DyingLightEffectVariantEnum](#).




Page 71



#### 1.5.7.4.3. Effect on Receipt

On receipt of the OffWithEffect command the server SHALL check the value of the GlobalSceneControl attribute.

If the GlobalSceneControl attribute is equal to TRUE, the server SHALL store its settings in its global scene then set the GlobalSceneControl attribute to FALSE, then set the OnOff attribute to FALSE and if the OnTime attribute is supported set the OnTime attribute to 0.

If the GlobalSceneControl attribute is equal to FALSE, the server SHALL only set the OnOff attribute to FALSE.

#### 1.5.7.5. OnWithRecallGlobalScene Command

This command allows the recall of the settings when the device was turned off.

##### 1.5.7.5.1. Effect on Receipt

On receipt of the OnWithRecallGlobalScene command, if the GlobalSceneControl attribute is equal to TRUE, the server SHALL discard the command.

If the GlobalSceneControl attribute is equal to FALSE, the Scenes Management cluster server on the same endpoint SHALL recall its global scene, updating the OnOff attribute accordingly. The OnOff server SHALL then set the GlobalSceneControl attribute to TRUE.

Additionally, when the OnTime and OffWaitTime attributes are both supported, if the value of the OnTime attribute is equal to 0, the server SHALL set the OffWaitTime attribute to 0.

#### 1.5.7.6. OnWithTimedOff Command

This command allows devices to be turned on for a specific duration with a guarded off duration so that SHOULD the device be subsequently turned off, further OnWithTimedOff commands, received during this time, are prevented from turning the devices back on. Further OnWithTimedOff commands received while the server is turned on, will update the period that the device is turned on.

The OnWithTimedOff command SHALL have the following data fields:

| ID | Name         | Type               | Constraint | Quality | Fallback | Conformance |
|----|--------------|--------------------|------------|---------|----------|-------------|
| 0  | OnOffControl | OnOffControlBitmap | 0 to 1     |         |          | M           |
| 1  | OnTime       | uint16             | max 0xFFFF |         |          | M           |
| 2  | OffWaitTime  | uint16             | max 0xFFFF |         |          | M           |

##### 1.5.7.6.1. OnOffControl Field

This field contains information on how the server is to be operated.

Page 72



#### 1.5.7.6.1.1. AcceptOnlyWhenOn Bit

This bit specifies whether the OnWithTimedOff command is to be processed unconditionally or only when the OnOff attribute is equal to TRUE. If this sub-field is set to 1, the OnWithTimedOff command SHALL only be accepted if the OnOff attribute is equal to TRUE. If this sub-field is set to 0, the OnWithTimedOff command SHALL be processed unconditionally.

#### 1.5.7.6.2. OnTime Field

This field is used to adjust the value of the OnTime attribute.

#### 1.5.7.6.3. OffWaitTime Field

This field is used to adjust the value of the OffWaitTime attribute.

#### 1.5.7.6.4. Effect on Receipt

On receipt of this command, if the AcceptOnlyWhenOn sub-field of the OnOffControl field is set to 1, and the value of the OnOff attribute is equal to FALSE, the command SHALL be discarded.

If the value of the OffWaitTime attribute is greater than zero and the value of the OnOff attribute is equal to FALSE, then the server SHALL set the OffWaitTime attribute to the minimum of the OffWaitTime attribute and the value specified in the OffWaitTime field.

In all other cases, the server SHALL set the OnTime attribute to the maximum of the OnTime attribute and the value specified in the OnTime field, set the OffWaitTime attribute to the value specified in the OffWaitTime field and set the OnOff attribute to TRUE.

If the values of the OnTime and OffWaitTime attributes are both not equal to 0xFFFF, the server SHALL then update these attributes every  $1/10^{\text{th}}$  second until both the OnTime and OffWaitTime attributes are equal to 0, as follows:

- If the value of the OnOff attribute is equal to TRUE and the value of the OnTime attribute is greater than zero, the server SHALL decrement the value of the OnTime attribute. If the value of the OnTime attribute reaches 0, the server SHALL set the OffWaitTime and OnOff attributes to 0 and FALSE, respectively.
- If the value of the OnOff attribute is equal to FALSE and the value of the OffWaitTime attribute is greater than zero, the server SHALL decrement the value of the OffWaitTime attribute. If the value of the OffWaitTime attribute reaches 0, the server SHALL terminate the update.

### 1.5.8. State Description

The operation of the On/Off cluster with respect to the On, Off, and OnWithTimedOff commands is illustrated in [On/Off Cluster Operation State Machine](#). In this diagram, the values X and Y correspond to the OnTime and OffWaitTime fields, respectively, of the OnWithTimedOff command. In the Timed On state, the OnTime attribute is decremented every  $1/10^{\text{th}}$  second, unless its value equals 0xFFFF. Similarly, in the Delayed Off state, the OffWaitTime attribute is decremented every  $1/10^{\text{th}}$  second, unless its value equals 0xFFFF.



Page 73



![Figure 2: On/Off Cluster Operation State Machine. This state machine diagram shows four states: 'Timed On' (OnOff := TRUE, OnTime decrements), 'On' (OnOff := TRUE), 'Delayed Off' (OnOff := FALSE, OffWaitTime decrements), and 'Off' (OnOff := FALSE). Transitions are triggered by commands like OnWithTimedOff(x,y), Off, and On2, with associated attribute updates.](66e89867f97592fd4bfab0e4f2b2054f_img.jpg)

```

stateDiagram-v2
    [*] --> TimedOn: OnWithTimedOff(x,y) / OnTime:=max(x,OnTime); OffWaitTime:=y;
    TimedOn --> On: OnWithTimedOff(x,y) / OnTime:=x; OffWaitTime:=y;
    On --> TimedOn: OnWithTimedOff(x,y) / OnTime:=x; OffWaitTime:=y;
    On --> Off: Off¹ / OffWaitTime:=0;
    On --> DelayedOff: On2 / OffWaitTime:=0;
    TimedOn --> DelayedOff: Off¹ / OnTime:=0;
    TimedOn --> Off: OnTime == 0 / OffWaitTime:=0;
    DelayedOff --> Off: OffWaitTime == 0;
    Off --> On: On2;
    Off --> DelayedOff: Off¹;
    Off --> [*]: Off¹;
  
```

Off¹: Any command which causes the OnOff attribute to be set to FALSE, e.g. Off, Toggle or OffWithEffect.  
 On2: Any command which causes the OnOff attribute to be set to TRUE, e.g. On, Toggle or OnWithRecallGlobalScene.

Figure 2: On/Off Cluster Operation State Machine. This state machine diagram shows four states: 'Timed On' (OnOff := TRUE, OnTime decrements), 'On' (OnOff := TRUE), 'Delayed Off' (OnOff := FALSE, OffWaitTime decrements), and 'Off' (OnOff := FALSE). Transitions are triggered by commands like OnWithTimedOff(x,y), Off, and On2, with associated attribute updates.

Figure 2. On/Off Cluster Operation State Machine

## 1.6. Level Control Cluster

This cluster provides an interface for controlling a characteristic of a device that can be set to a level, for example the brightness of a light, the degree of closure of a door, or the power output of a heater.

### 1.6.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                            |
|----------|--------------------------------------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added                                                       |
| 2        | Added Options attribute, state change table; ZLO 1.0; Base cluster (no change) CCB 2085 1775 2281 2147 |

Page 74







| Revision | Description                                                                                                                                                                         |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 3        | CCB 2574 2616 2659 2702 2814 2818 2819 2898                                                                                                                                         |
| 4        | FeatureMap support with On/Off, Lighting and Frequency features                                                                                                                     |
| 5        | New data model format and notation                                                                                                                                                  |
| 6        | Added Q quality for CurrentLevel, CurrentFrequency and RemainingTime attributes, added clarifications for behavior related to Step value and adjusted constraint of DefaultMoveRate |

### 1.6.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | LVL       |

### 1.6.3. Cluster ID

Derived cluster specifications are defined elsewhere. This base cluster specification MAY be used for generic level control; however, it is recommended to derive another cluster to better define the application and domain requirements. If one or more derived cluster identifiers and the base identifier exists on a device endpoint, then they SHALL all represent a single instance of the device level control.

| ID     | Name          |
|--------|---------------|
| 0x0008 | Level Control |

### 1.6.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature   | Conformance | Summary                                      | Fallback |
|-----|------|-----------|-------------|----------------------------------------------|----------|
| 0   | 00   | OnOff     | 0           | Dependency with the On/Off cluster           | 1        |
| 1   | LT   | Lighting  | 0           | Behavior that supports lighting applications | 0        |
| 2   | FQ   | Frequency | P           | Supports frequency attributes and behavior.  | 0        |




Page 75



The following sections describe each feature in some detail. Further details are found within the specification.

#### 1.6.4.1. On/Off Feature

For many applications, a close relationship between this cluster and the On/Off cluster is needed. This section describes the dependencies that are required when an endpoint that implements this server cluster and also implements the On/Off server cluster. Before the On/Off feature bit in the FeatureMap existed, there was a dependency between this cluster and the On/Off cluster.

The OnOff attribute of the On/Off cluster and the CurrentLevel attribute of the Level Control cluster are intrinsically independent variables, as they are on different clusters. However, when both clusters are implemented on the same endpoint, dependencies MAY be introduced between them. Facilities are provided to introduce dependencies if required.

##### 1.6.4.1.1. Effect of On/Off Commands on the CurrentLevel attribute

The [OnLevel](#) attribute determines whether commands of the On/Off cluster have a permanent effect on the CurrentLevel attribute or not. If this attribute is defined (i.e., implemented and not equal to null) they do have a permanent effect, otherwise they do not. There is always a temporary effect, due to fading up / down.

The effect on the Level Control cluster on receipt of the various commands of the On/Off cluster are as detailed in the [Effect of On/Off Commands when associated with Level Control](#) table. In this table, and throughout this cluster specification, 'level' means the value of the CurrentLevel attribute.

*Table 2. Effect of On/Off Commands when associated with Level Control*

| Command | Action On Receipt                                                                                                                                                                                                               |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| On      | Temporarily store CurrentLevel.<br>Set CurrentLevel to the minimum level allowed for the device.<br>Change CurrentLevel to OnLevel, or to the stored level if OnLevel is not defined, over the time period OnOffTransitionTime. |
| Off     | Temporarily store CurrentLevel.<br>Change CurrentLevel to the minimum level allowed for the device over the time period OnOffTransitionTime.<br>If OnLevel is not defined, set the CurrentLevel to the stored level.            |
| Toggle  | If the OnOff attribute has the value FALSE, proceed as for the On command. Otherwise proceed as for the Off command.                                                                                                            |

Intention of the actions described in the table above is that CurrentLevel, which was in effect before any of the On, Off or Toggle commands were issued, SHALL be restored, after the transition is completed. If another of these commands is received, before the transition is completed, the originally stored CurrentLevel SHALL be preserved and restored.

Page 76



#### 1.6.4.1.2. Effect of Level Control Commands on the OnOff Attribute

There are two sets of commands provided in the Level Control cluster. These are identical, except that the first set (MoveToLevel, Move and Step commands) SHALL NOT affect the OnOff attribute, whereas the second set ('with On/Off' variants) SHALL.

The first set is used to maintain independence between the CurrentLevel and OnOff attributes, so changing CurrentLevel has no effect on the OnOff attribute. As examples, this represents the behavior of a volume control with a separate mute button, or a 'turn to set level and press to turn on/off' light dimmer.

The second set is used to link the CurrentLevel and OnOff attributes. When the level is reduced to its minimum the OnOff attribute is automatically turned to FALSE, and when the level is increased above its minimum the OnOff attribute is automatically turned to TRUE. As an example, this represents the behavior of a light dimmer with no independent on/off switch.

For the Stop command, the StopWithOnOff is included solely for symmetry, to allow easy choice of one or other set of commands – both Stop commands are identical, because the dependency on On/Off is determined by the original command that is being stopped.

#### 1.6.4.1.3. Effect of Level Control Commands Depends on OnOff

Before the Options attribute was introduced, all commands except those postfixed with 'with On/Off', had no effect if the OnOff attribute of the On/Off cluster, on the same endpoint, was FALSE. Even if the On/Off (OO) feature set bit is set to zero, this is still true. To allow such commands to function, please see the Options attribute below.

#### 1.6.4.1.4. GlobalSceneControl and Commands with On/Off

If a MoveToLevel(WithOnOff), Move(WithOnOff) or Step(WithOnOff) command is received that causes a change to the value of the OnOff attribute of the On/Off cluster, the value of the GlobalSceneControl attribute of the On/Off cluster SHALL be updated according to section [GlobalSceneControl](#).

### 1.6.4.2. Lighting Feature

This feature supports an interface for controlling the level of a light source.

For the CurrentLevel attribute:

A value of 0x00 SHALL NOT be used.

A value of 0x01 SHALL indicate the minimum level that can be attained on a device.

A value of 0xFF SHALL indicate the maximum level that can be attained on a device.

A value of null SHALL represent an undefined value.

All other values are application specific gradations from the minimum to the maximum level.

### 1.6.4.3. Frequency Feature

**NOTE** The Frequency feature is provisional.



Page 77



## 1.6.5. Data Types

### 1.6.5.1. OptionsBitmap Type

This data type is derived from map8.

| Bit | Name                          | Summary                             | Conformance |
|-----|-------------------------------|-------------------------------------|-------------|
| 0   | <b>ExecuteIfOff</b>           | Dependency on On/Off cluster        | LT   OO     |
| 1   | <b>CoupleColorTempToLevel</b> | Dependency on Color Control cluster | LT          |

#### 1.6.5.1.1. ExecuteIfOff Bit

This bit indicates if this cluster has a dependency with the On/Off cluster.

#### 1.6.5.1.2. CoupleColorTempToLevel Bit

This bit indicates if this cluster has a dependency with the Color Control cluster.

### 1.6.5.2. MoveModeEnum Type

This data type is derived from enum8.

| Value | Name        | Summary            | Conformance |
|-------|-------------|--------------------|-------------|
| 0     | <b>Up</b>   | Increase the level | M           |
| 1     | <b>Down</b> | Decrease the level | M           |

### 1.6.5.3. StepModeEnum Type

This data type is derived from enum8.

| Value | Name        | Summary        | Conformance |
|-------|-------------|----------------|-------------|
| 0     | <b>Up</b>   | Step upwards   | M           |
| 1     | <b>Down</b> | Step downwards | M           |

## 1.6.6. Attributes

| ID     | Name                 | Type   | Constraint           | Quality | Fallback | Access | Conformance |
|--------|----------------------|--------|----------------------|---------|----------|--------|-------------|
| 0x0000 | <b>CurrentLevel</b>  | uint8  | MinLevel to MaxLevel | N Q S X |          | R V    | M           |
| 0x0001 | <b>RemainingTime</b> | uint16 | all                  | Q       |          | R V    | LT          |

Page 78







| ID     | Name                        | Type           | Constraint                   | Quality | Fallback | Access | Conformance |
|--------|-----------------------------|----------------|------------------------------|---------|----------|--------|-------------|
| 0x0002 | <b>MinLevel</b>             | uint8          | 1 to 254                     |         | 1        | RV     | [LT]        |
| 0x0002 | <b>MinLevel</b>             | uint8          | max 254                      |         | 0        | RV     | ![LT]       |
| 0x0003 | <b>MaxLevel</b>             | uint8          | MinLevel to 254              |         | 254      | RV     | O           |
| 0x0004 | <b>Current-Frequency</b>    | uint16         | MinFrequency to MaxFrequency | P Q S   |          | RV     | FQ          |
| 0x0005 | <b>MinFrequency</b>         | uint16         | all                          |         |          | RV     | FQ          |
| 0x0006 | <b>MaxFrequency</b>         | uint16         | min Min-Frequency            |         |          | RV     | FQ          |
| 0x0010 | <b>OnOff-TransitionTime</b> | uint16         | all                          |         | 0        | RW VO  | O           |
| 0x0011 | <b>OnLevel</b>              | uint8          | MinLevel to MaxLevel         | X       |          | RW VO  | M           |
| 0x0012 | <b>OnTransitionTime</b>     | uint16         | all                          | X       | null     | RW VO  | O           |
| 0x0013 | <b>OffTransitionTime</b>    | uint16         | all                          | X       | null     | RW VO  | O           |
| 0x0014 | <b>Default-MoveRate</b>     | uint8          | min 1                        | X       | MS       | RW VO  | O           |
| 0x000F | <b>Options</b>              | Options-Bitmap | desc                         |         |          | RW VO  | M           |
| 0x4000 | <b>StartUpCurrentLevel</b>  | uint8          | desc                         | N X     |          | RW VM  | LT          |

#### 1.6.6.1. Scene Table Extensions

If the Scenes Management server cluster is implemented on the same endpoint, the following attributes SHALL be part of the ExtensionFieldSetStruct of the Scene Table. If the implicit form of the ExtensionFieldSetStruct is used, the order of the attributes in the AttributeValueList is in the given order, i.e., the attribute listed as 1 is added first:

1. CurrentLevel
2. CurrentFrequency

Attributes in the scene table that are not supported by the device (according to the FeatureMap



Page 79



attribute) SHALL be present in the scene table but ignored. An extension field set value outside of the accepted values of the corresponding MoveTo<Target> command, e.g. a null value for the CurrentLevel attribute, corresponding to the MoveToLevel command, SHALL be ignored.

#### 1.6.6.2. CurrentLevel Attribute

This attribute SHALL indicate the current level of this device. The meaning of 'level' is device dependent.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second, or
- At the end of the movement/transition, or
- When it changes from null to any other value and vice versa.

#### 1.6.6.3. RemainingTime Attribute

This attribute SHALL indicate the time remaining until the current command is complete - it is specified in 1/10ths of a second.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- When it changes from 0 to any value higher than 10, or
- When it changes, with a delta larger than 10, caused by the invoke of a command, or
- When it changes to 0.

For commands with a transition time or changes to the transition time less than 1 second, changes to this attribute SHALL NOT be reported.

As this attribute is not being reported during a regular countdown, clients SHOULD NOT rely on the reporting of this attribute in order to keep track of the remaining duration.

#### 1.6.6.4. MinLevel Attribute

This attribute SHALL indicate the minimum value of CurrentLevel that is capable of being assigned.

#### 1.6.6.5. MaxLevel Attribute

This attribute SHALL indicate the maximum value of CurrentLevel that is capable of being assigned.

#### 1.6.6.6. CurrentFrequency Attribute

This attribute SHALL indicate the frequency at which the device is at CurrentLevel. A CurrentFrequency of 0 is unknown.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second, or

Page 80



- At the start of the movement/transition, or
- At the end of the movement/transition.

#### 1.6.6.7. MinFrequency Attribute

This attribute SHALL indicate the minimum value of CurrentFrequency that is capable of being assigned. MinFrequency SHALL be less than or equal to MaxFrequency. A value of 0 indicates undefined.

#### 1.6.6.8. MaxFrequency Attribute

This attribute SHALL indicate the maximum value of CurrentFrequency that is capable of being assigned. MaxFrequency SHALL be greater than or equal to MinFrequency. A value of 0 indicates undefined.

#### 1.6.6.9. Options Attribute

This attribute SHALL indicate the selected options of the device.

The Options attribute is a bitmap that determines the default behavior of some cluster commands. Each command that is dependent on the Options attribute SHALL first construct a temporary Options bitmap that is in effect during the command processing. The temporary Options bitmap has the same format and meaning as the Options attribute, but includes any bits that may be overridden by command fields.

This attribute is meant to be changed only during commissioning.

Command execution SHALL NOT continue beyond the Options processing if all of these criteria are true:

- The command is one of the ‘without On/Off’ commands: Move, Move to Level, Step, or Stop.
- The On/Off cluster exists on the same endpoint as this cluster.
- The OnOff attribute of the On/Off cluster, on this endpoint, is FALSE.
- The value of the ExecuteIfOff bit is 0.

##### 1.6.6.9.1. ExecuteIfOff Bit

If this bit is set, commands in this cluster are executed and potentially change the CurrentLevel attribute when the OnOff attribute of the On/Off cluster is FALSE.

##### 1.6.6.9.2. CoupleColorTempToLevel Bit

If this bit is set, changes to the CurrentLevel attribute SHALL be coupled with the color temperature set in the Color Control cluster.

When not supporting the Lighting feature, this bit SHALL be zero and ignored.



Page 81



#### 1.6.6.10. OnOffTransitionTime Attribute

This attribute SHALL indicate the time taken to move to or from the target level when On or Off commands are received by an On/Off cluster on the same endpoint. It is specified in 1/10ths of a second.

The actual time taken SHOULD be as close to OnOffTransitionTime as the device is able. Please note that if the device is not able to move at a variable rate, the OnOffTransitionTime attribute SHOULD NOT be implemented.

#### 1.6.6.11. OnLevel Attribute

This attribute SHALL indicate the value that the CurrentLevel attribute is set to when the OnOff attribute of an On/Off cluster on the same endpoint is set to TRUE, as a result of processing an On/Off cluster command. If the OnLevel attribute is not implemented, or is set to the null value, it has no effect. For more details see [Effect of On/Off Commands on the CurrentLevel attribute](#).

OnLevel represents a mandatory field that was previously not present or optional. Implementers should be aware that older devices may not implement it.

#### 1.6.6.12. OnTransitionTime Attribute

This attribute SHALL indicate the time taken to move the current level from the minimum level to the maximum level when an On command is received by an On/Off cluster on the same endpoint. It is specified in 1/10ths of a second. If this attribute is not implemented, or contains a null value, the OnOffTransitionTime SHALL be used instead.

#### 1.6.6.13. OffTransitionTime Attribute

This attribute SHALL indicate the time taken to move the current level from the maximum level to the minimum level when an Off command is received by an On/Off cluster on the same endpoint. It is specified in 1/10ths of a second. If this attribute is not implemented, or contains a null value, the OnOffTransitionTime SHALL be used instead.

#### 1.6.6.14. DefaultMoveRate Attribute

This attribute SHALL indicate the movement rate, in units per second, when a Move command is received with a null value Rate parameter.

#### 1.6.6.15. StartUpCurrentLevel Attribute

This attribute SHALL indicate the desired startup level for a device when it is supplied with power and this level SHALL be reflected in the CurrentLevel attribute. The values of the StartUpCurrentLevel attribute are listed below:

| Value | Action on power up                                                          |
|-------|-----------------------------------------------------------------------------|
| 0     | Set the CurrentLevel attribute to the minimum value permitted on the device |

Page 82



| Value        | Action on power up                                   |
|--------------|------------------------------------------------------|
| null         | Set the CurrentLevel attribute to its previous value |
| other values | Set the CurrentLevel attribute to this value         |

This behavior does not apply to reboots associated with OTA. After an OTA restart, the CurrentLevel attribute SHALL return to its value prior to the restart.

### 1.6.7. Commands

| ID   | Name                                | Direction                   | Response | Access | Conformance |
|------|-------------------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>MoveToLevel</b>                  | client $\Rightarrow$ server | Y        | O      | M           |
| 0x01 | <b>Move</b>                         | client $\Rightarrow$ server | Y        | O      | M           |
| 0x02 | <b>Step</b>                         | client $\Rightarrow$ server | Y        | O      | M           |
| 0x03 | <b>Stop</b>                         | client $\Rightarrow$ server | Y        | O      | M           |
| 0x04 | <b>MoveToLevel-<br/>WithOnOff</b>   | client $\Rightarrow$ server | Y        | O      | M           |
| 0x05 | <b>MoveWith-<br/>OnOff</b>          | client $\Rightarrow$ server | Y        | O      | M           |
| 0x06 | <b>StepWith-<br/>OnOff</b>          | client $\Rightarrow$ server | Y        | O      | M           |
| 0x07 | <b>StopWith-<br/>OnOff</b>          | client $\Rightarrow$ server | Y        | O      | M           |
| 0x08 | <b>MoveToClos-<br/>estFrequency</b> | client $\Rightarrow$ server | Y        | O      | FQ          |

#### 1.6.7.1. MoveToLevel Command

This command will move the device to the specified level.

| ID | Name                         | Type               | Constraint | Quality | Fallback | Conformance |
|----|------------------------------|--------------------|------------|---------|----------|-------------|
| 0  | <b>Level</b>                 | uint8              | max 254    |         |          | M           |
| 1  | <b>Transition-<br/>Time</b>  | uint16             | all        | X       |          | M           |
| 2  | <b>Options-<br/>Mask</b>     | Options-<br>Bitmap | desc       |         |          | M           |
| 3  | <b>OptionsOve-<br/>rride</b> | Options-<br>Bitmap | desc       |         |          | M           |



Page 83



### 1.6.7.1.1. Effect on Receipt

The OptionsMask and OptionsOverride fields SHALL both be present. Default values are provided to interpret missing fields from legacy devices. A temporary Options bitmap SHALL be created from the Options attribute, using the OptionsMask and OptionsOverride fields. Each bit of the temporary Options bitmap SHALL be determined as follows:

Each bit in the Options attribute SHALL determine the corresponding bit in the temporary Options bitmap, unless the OptionsMask field is present and has the corresponding bit set to 1, in which case the corresponding bit in the OptionsOverride field SHALL determine the corresponding bit in the temporary Options bitmap.

The resulting temporary Options bitmap SHALL then be processed as defined in the [Options attribute](#).

On receipt of this command, a device SHALL move from its current level to the value given in the Level field. The meaning of 'level' is device dependent – e.g., for a light it MAY mean brightness level.

The movement SHALL be as continuous as technically practical, i.e., not a step function, and the time taken to move to the new level SHALL be equal to the value of the TransitionTime field, in tenths of a second, or as close to this as the device is able.

If the TransitionTime field takes the value null then the time taken to move to the new level SHALL instead be determined by the OnOffTransitionTime attribute. If OnOffTransitionTime, which is an optional attribute, is not present, the device SHALL move to its new level as fast as it is able.

If the device is not able to move at a variable rate, the TransitionTime field MAY be disregarded.

### 1.6.7.2. Move Command

This command will move the device using the specified values.

| ID | Name                   | Type                          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|-------------------------------|------------|---------|----------|-------------|
| 0  | <b>MoveMode</b>        | <a href="#">MoveModeEnum</a>  | desc       |         |          | M           |
| 1  | <b>Rate</b>            | uint8                         | all        | X       |          | M           |
| 2  | <b>OptionsMask</b>     | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |
| 3  | <b>OptionsOverride</b> | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |

#### 1.6.7.2.1. MoveMode Field

This field SHALL be one of the non-reserved values in [MoveModeEnum](#).

Page 84







### 1.6.7.2.2. Rate Field

This field SHALL indicate the rate of movement in units per second. The actual rate of movement SHOULD be as close to this rate as the device is able. If the Rate field is null, then the value of the DefaultMoveRate attribute SHALL be used if that attribute is supported and its value is not null. If the Rate field is null and the DefaultMoveRate attribute is either not supported or set to null, then the device SHOULD move as fast as it is able. If the device is not able to move at a variable rate, this field MAY be disregarded.

### 1.6.7.2.3. Effect on Receipt

On receipt of this command, if the Rate field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.

Otherwise, a device SHALL first create and process a temporary Options bitmap as described in the [MoveToLevel](#) command.

On receipt of this command, a device SHALL move from its current level in an up or down direction in a continuous fashion, as detailed below.

| MoveMode | Action on Receipt                                                                                                               |
|----------|---------------------------------------------------------------------------------------------------------------------------------|
| Up       | Increase the device's level at the rate given in the Rate field. If the level reaches the maximum allowed for the device, stop. |
| Down     | Decrease the device's level at the rate given in the Rate field. If the level reaches the minimum allowed for the device, stop. |

## 1.6.7.3. Step Command

This command will do a relative step change of the device using the specified values.

| ID | Name            | Type                          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|-------------------------------|------------|---------|----------|-------------|
| 0  | StepMode        | <a href="#">StepModeEnum</a>  | desc       |         |          | M           |
| 1  | StepSize        | uint8                         | all        |         |          | M           |
| 2  | TransitionTime  | uint16                        | all        | X       |          | M           |
| 3  | OptionsMask     | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |
| 4  | OptionsOverride | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |

### 1.6.7.3.1. StepMode Field

This field SHALL be one of the non-reserved values in [StepModeEnum](#).



Page 85



#### 1.6.7.3.2. StepSize Field

This field SHALL indicate the change to CurrentLevel.

#### 1.6.7.3.3. TransitionTime Field

This field SHALL indicate the time that SHALL be taken to perform the step, in tenths of a second. A step is a change in the CurrentLevel of StepSize units. The actual time taken SHOULD be as close to this as the device is able. If the TransitionTime field is equal to null, the device SHOULD move as fast as it is able.

If the device is not able to move at a variable rate, the TransitionTime field MAY be disregarded.

#### 1.6.7.3.4. Effect on Receipt

On receipt of this command, if the StepSize field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.

Otherwise, a device SHALL first create and process a temporary Options bitmap as described in the [MoveToLevel](#) command.

On receipt of this command, a device SHALL move from its current level in an up or down direction as detailed below.

| StepMode | Action on Receipt                                                                                                                                                                                              |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Up       | Increase CurrentLevel by StepSize units, or until it reaches the maximum level allowed for the device if this reached in the process. In the latter case, the transition time SHALL be proportionally reduced. |
| Down     | Decrease CurrentLevel by StepSize units, or until it reaches the minimum level allowed for the device if this reached in the process. In the latter case, the transition time SHALL be proportionally reduced. |

#### 1.6.7.4. Stop Command

This command will stop the actions of various other commands that are still in progress.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 1  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

Page 86



#### 1.6.7.4.1. Effect of Receipt

On receipt of this command, a device SHALL first create and process a temporary Options bitmap as described in the [MoveToLevel](#) command.

Upon receipt of this command, any MoveToLevel, Move or Step command (and their 'with On/Off' variants) currently in process SHALL be terminated. The value of CurrentLevel SHALL be left at its value upon receipt of the Stop command, and RemainingTime SHALL be set to zero.

This command has two entries in the [Commands](#) list, one for the MoveToLevel, Move and Step commands, and one for their 'with On/Off' counterparts. This is solely for symmetry, to allow easy choice of one or other set of commands – the Stop commands are identical, because the dependency on On/Off is determined by the original command that is being stopped.

#### 1.6.7.5. MoveToClosestFrequency Command

This command will cause the device to change the current frequency to the requested value.

| ID | Name      | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------|--------|------------|---------|----------|-------------|
| 0  | Frequency | uint16 | all        |         |          | M           |

##### 1.6.7.5.1. Effect of Receipt

Upon receipt of this command, the device SHALL change its current frequency to the requested frequency, or to the closest frequency that it can generate. If the device cannot approximate the frequency, then it SHALL return a default response with an error code of `CONSTRAINT_ERROR`. Determining if a requested frequency can be approximated by a supported frequency is a manufacturer-specific decision.

#### 1.6.7.6. 'With On/Off' Commands

The MoveToLevelWithOnOff, MoveWithOnOff and StepWithOnOff commands have identical data fields compared to the MoveToLevel, Move and Step commands respectively. They also have the same effects, except for the following additions.

Before commencing any command that has the effect of setting the CurrentLevel attribute above the minimum level allowed by the device, the OnOff attribute of the On/Off cluster on the same endpoint, if implemented, SHALL be set to TRUE ('On').

If any command that has the effect of setting the CurrentLevel attribute to the minimum level allowed by the device, the OnOff attribute of the On/Off cluster on the same endpoint, if implemented, SHALL be set to FALSE ('Off').

The StopWithOnOff command has identical data fields compared to the Stop command. Both Stop commands are identical, because the dependency on On/Off is determined by the original command that is being stopped.



Page 87



### 1.6.8. State Change Table for Lighting

Below is a table of examples of state changes when Level Control and On/Off clusters are on the same endpoint and the Lighting feature is set.

EiO - ExecuteIfOff field in the Options attribute

OnOff – Attribute value of On/Off cluster: FALSE='Off', TRUE='On'

*MIN* - MinLevel

*MAX* - MaxLevel

*MID* – Midpoint between MinLevel and MaxLevel

#### 1.6.8.1. Lighting Device State Change examples

| Cur-<br>rentLeve<br>l | EiO | OnOff | Physical<br>Device | Com-<br>mand<br>Before<br>After                                    | Cur-<br>rentLeve<br>l | OnOff | Physical<br>Device                    | Device<br>Output<br>Result                                             |
|-----------------------|-----|-------|--------------------|--------------------------------------------------------------------|-----------------------|-------|---------------------------------------|------------------------------------------------------------------------|
| <i>any</i>            | 0   | FALSE | Off                | Move-<br>ToLevel(l<br>= <i>MID</i> , t=2<br>sec)                   | <i>same</i>           | FALSE | Off                                   | Stays off                                                              |
| <i>any</i>            | 0   | FALSE | Off                | Move-<br>ToLevel-<br>With-<br>OnOff(l=<br><i>MID</i> , t=2<br>sec  | <i>MID</i>            | TRUE  | On (mid-<br>point<br>bright-<br>ness) | Turns on<br>and out-<br>put level<br>adjusts or<br>stays at<br>half    |
| <i>any</i>            | 1   | FALSE | Off                | Move-<br>ToLevel(l<br>= <i>MID</i> , t=2<br>sec)                   | <i>MID</i>            | FALSE | Off                                   | Stays off                                                              |
| <i>any</i>            | 1   | FALSE | Off                | Move-<br>ToLevel-<br>With-<br>OnOff(l=<br><i>MID</i> , t=2<br>sec) | <i>MID</i>            | TRUE  | On                                    | Turns on<br>and out-<br>put level<br>adjusts to<br>or stays<br>at half |
| <i>any</i>            | 1   | FALSE | Off                | Move(up,<br>rate=64/s)                                             | <i>MAX</i>            | FALSE | Off                                   | Stays off                                                              |

Page 88







| Cur-<br>rentLeve<br>l | EiO        | OnOff | Physical<br>Device          | Com-<br>mand<br>Before<br>After                                    | Cur-<br>rentLeve<br>l | OnOff | Physical<br>Device                    | Device<br>Output<br>Result                                            |
|-----------------------|------------|-------|-----------------------------|--------------------------------------------------------------------|-----------------------|-------|---------------------------------------|-----------------------------------------------------------------------|
| <i>any</i>            | 1          | FALSE | Off                         | Move-<br>With-<br>OnOff(up,<br>rate=64/s)                          | <i>MAX</i>            | TRUE  | On                                    | Turn on<br>and out-<br>put level<br>adjusts to<br>or stays<br>at full |
| <i>any</i>            | 1          | FALSE | Off                         | Move-<br>With-<br>OnOff(do<br>wn,<br>rate=64/s)                    | <i>MIN</i>            | FALSE | Off                                   | Stays off                                                             |
| <i>any</i>            | <i>any</i> | TRUE  | On (any<br>bright-<br>ness) | Move-<br>ToLevel-<br>With-<br>OnOff(l=<br><i>MID</i> , t=2<br>sec) | <i>MID</i>            | TRUE  | On (mid-<br>point<br>bright-<br>ness) | Output<br>level<br>adjusts to<br>or stays<br>at half                  |
| <i>any</i>            | <i>any</i> | TRUE  | On (any<br>bright-<br>ness) | Move-<br>With-<br>OnOff(up,<br>rate=64/s)                          | <i>MAX</i>            | TRUE  | On (full<br>bright-<br>ness)          | Output<br>level<br>adjusts to<br>or stays<br>at full                  |
| <i>any</i>            | <i>any</i> | TRUE  | On (any<br>bright-<br>ness) | Move(do<br>wn,<br>rate=64/s)                                       | <i>MIN</i>            | TRUE  | On (at<br>minimum<br>bright-<br>ness) | Output<br>level<br>adjusts to<br>minimum                              |
| <i>any</i>            | <i>any</i> | TRUE  | On (any<br>bright-<br>ness) | Move-<br>With-<br>OnOff(do<br>wn,<br>rate=64/s)                    | <i>MIN</i>            | FALSE | Off                                   | Output<br>level<br>adjusts to<br>off                                  |

## 1.7. Boolean State Cluster

This cluster provides an interface to a boolean state.

### 1.7.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.




Page 89



| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

## 1.7.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | BOOL      |

## 1.7.3. Cluster ID

| ID     | Name          |
|--------|---------------|
| 0x0045 | Boolean State |

## 1.7.4. Attributes

| ID     | Name       | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | StateValue | bool |            | P       |          | R V    | M           |

### 1.7.4.1. StateValue Attribute

This represents a boolean state.

The semantics of this boolean state are defined by the device type using this cluster.

For example, in a Contact Sensor device type, FALSE=open or no contact, TRUE=closed or contact.

## 1.7.5. Events

| ID   | Name        | Priority | Quality | Access | Conformance |
|------|-------------|----------|---------|--------|-------------|
| 0x00 | StateChange | INFO     |         | V      | O           |

### 1.7.5.1. StateChange Event

If this event is supported, it SHALL be generated when the StateValue attribute changes.

| ID | Name       | Type | Constraint | Quality | Fallback | Conformance |
|----|------------|------|------------|---------|----------|-------------|
| 0  | StateValue | bool |            |         |          | M           |

#### 1.7.5.1.1. StateValue Field

This field SHALL indicate the new value of the StateValue attribute.

Page 90







## 1.8. Boolean State Configuration Cluster

This cluster is used to configure a boolean sensor, including optional state change alarm features and configuration of the sensitivity level associated with the sensor.

### 1.8.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 1.8.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | BOOLCFG   |

### 1.8.3. Cluster ID

| ID     | Name                        |
|--------|-----------------------------|
| 0x0080 | Boolean State Configuration |

### 1.8.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code    | Feature          | Conformance | Summary                                            |
|-----|---------|------------------|-------------|----------------------------------------------------|
| 0   | VIS     | Visual           | 0           | Supports visual alarms                             |
| 1   | AUD     | Audible          | 0           | Supports audible alarms                            |
| 2   | SPRS    | AlarmSuppress    | [VIS   AUD] | Supports ability to suppress or acknowledge alarms |
| 3   | SENSLVL | SensitivityLevel | 0           | Supports ability to set sensor sensitivity         |

#### 1.8.4.1. AlarmSuppress Feature

This feature SHALL indicate that the device is able to suppress the supported alarm modes, when the user acknowledges the alarm. This is intended to stop visual and/or audible alarms, when the




Page 91



user has become aware that the sensor is triggered, but it is no longer desired to have the alarm modes active on the device, e.g.:

- The triggering cause have been resolved by the user, but the sensor has not yet stopped detecting the triggering cause.
- The user is not able to address the triggering cause, but is aware of the alarm and suppress/acknowledge it be addressed at a later point.

Acknowledge of alarms will for the remainder of this cluster be referred to as suppress.

A suppressed alarm is still considered active and will remain so unless it is actively disabled or the triggering condition is not longer present. The action of suppressing an alarm mode is only applicable to and is intended to stop the physical alarming, e.g. emitting a sound or blinking a light; it does not impact alarm reporting in AlarmsActive.

## 1.8.5. Data Types

### 1.8.5.1. AlarmModeBitmap Type

This data type is derived from map8.

| Bit | Name    | Summary          | Conformance |
|-----|---------|------------------|-------------|
| 0   | Visual  | Visual alarming  | VIS         |
| 1   | Audible | Audible alarming | AUD         |

### 1.8.5.2. SensorFaultBitmap Type

This data type is derived from map16.

| Bit | Name         | Summary                    | Conformance |
|-----|--------------|----------------------------|-------------|
| 0   | GeneralFault | Unspecified fault detected | M           |

## 1.8.6. Attributes

| ID     | Name                       | Type  | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|----------------------------|-------|--------------------------------------|---------|----------|--------|-------------|
| 0x0000 | CurrentSensitivityLevel    | uint8 | max (SupportedSensitivityLevels - 1) | N       |          | RW VO  | SENSLVL     |
| 0x0001 | SupportedSensitivityLevels | uint8 | 2 to 10                              | F       |          | R V    | SENSLVL     |

Page 92







| ID     | Name                           | Type                | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|--------------------------------|---------------------|--------------------------------------|---------|----------|--------|-------------|
| 0x0002 | <b>DefaultSensitivityLevel</b> | uint8               | max (SupportedSensitivityLevels - 1) | F       | MS       | RV     | [SENSLVL]   |
| 0x0003 | <b>AlarmsActive</b>            | Alarm-ModeBitmap    | all                                  |         |          | RV     | VIS   AUD   |
| 0x0004 | <b>AlarmsSuppressed</b>        | Alarm-ModeBitmap    | all                                  |         |          | RV     | SPRS        |
| 0x0005 | <b>AlarmsEnabled</b>           | Alarm-ModeBitmap    | all                                  | N       | MS       | RV     | [VIS   AUD] |
| 0x0006 | <b>AlarmsSupported</b>         | Alarm-ModeBitmap    | all                                  | F       |          | RV     | VIS   AUD   |
| 0x0007 | <b>SensorFault</b>             | Sensor-Fault-Bitmap | all                                  |         | 0        | RV     | 0           |

#### 1.8.6.1. CurrentSensitivityLevel Attribute

This attribute SHALL indicate the currently selected sensitivity level.

If a write interaction to this attribute contains an unsupported sensitivity value, a CONSTRAINT\_ERROR status SHALL be returned.

#### 1.8.6.2. SupportedSensitivityLevels Attribute

This attribute SHALL indicate the number of supported sensitivity levels by the device.

These supported sensitivity levels SHALL be ordered by sensitivity, where a value of 0 SHALL be considered the lowest sensitivity level (least sensitive) and the highest supported value SHALL be considered the highest sensitivity level.

The number of supported sensitivity levels SHOULD represent unique sensitivity levels supported by the device.

#### 1.8.6.3. DefaultSensitivityLevel Attribute

This attribute SHALL indicate the default sensitivity level selected by the manufacturer.

#### 1.8.6.4. AlarmsActive Attribute

This attribute SHALL indicate which specific alarm modes on the server are currently active. When




Page 93



the sensor is no longer triggered, this attribute SHALL be set to the inactive state, by setting the bit to 0, for all supported alarm modes.

If an alarm mode is not supported, the bit indicating this alarm mode SHALL always be 0.

A bit SHALL indicate whether the alarm mode inactive or not:

- 0 = Inactive
- 1 = Active

#### **1.8.6.5. AlarmsSuppressed Attribute**

This attribute SHALL indicate which specific alarm modes on the server are currently suppressed. When the sensor is no longer triggered, this attribute SHALL be set to the unsuppressed state, by setting the bit to 0, for all supported alarm modes.

If an alarm mode is not supported, the bit indicating this alarm mode SHALL always be 0.

A bit SHALL indicate whether the alarm mode is suppressed or not:

- 0 = Not suppressed
- 1 = Suppressed

#### **1.8.6.6. AlarmsEnabled Attribute**

This attribute SHALL indicate the alarm modes that will be emitted if the sensor is triggered.

If an alarm mode is not supported, the bit indicating this alarm mode SHALL always be 0.

A bit SHALL indicate whether the alarm mode is enabled or disabled:

- 0 = Disabled
- 1 = Enabled

#### **1.8.6.7. AlarmsSupported Attribute**

This attribute SHALL indicate the alarms supported by the sensor.

A bit SHALL indicate whether the alarm mode is supported:

- 0 = Not supported
- 1 = Supported

#### **1.8.6.8. SensorFault Attribute**

This attribute SHALL indicate any faults registered by the device.

### **1.8.7. Commands**

Page 94







| ID   | Name               | Direction                   | Response | Access | Conformance |
|------|--------------------|-----------------------------|----------|--------|-------------|
| 0x00 | SuppressAlarm      | client $\Rightarrow$ server | Y        | O      | SPRS        |
| 0x01 | EnableDisableAlarm | client $\Rightarrow$ server | Y        | O      | VIS   AUD   |

### 1.8.7.1. SuppressAlarm Command

This command will suppress the alarm modes specified.

| ID | Name             | Type             | Constraint | Quality | Fallback | Conformance |
|----|------------------|------------------|------------|---------|----------|-------------|
| 0  | AlarmsToSuppress | Alarm-ModeBitmap | all        |         |          | M           |

#### 1.8.7.1.1. AlarmsToSuppress Field

This field SHALL indicate the alarm modes to suppress.

##### 1.8.7.1.2. Effect on Receipt

If any of the requested alarm modes are not supported this command SHALL be ignored and the server SHALL return an CONSTRAINT\_ERROR status code.

If any of the requested alarm modes are not active, in case the sensor is not triggered or the alarm mode is disabled/not supported, this command SHALL be ignored and the server SHALL return an INVALID\_IN\_STATE status code.

In the case an alarm is already suppressed and the specific bit is set in the [AlarmsSuppressed](#) attribute, the bit SHALL be ignored and the remaining bits SHALL be evaluated.

For the valid bits in the AlarmsToSuppress field, the device SHALL suppress the specified alarm modes as requested in the AlarmsToSuppress field and set the [AlarmsSuppressed](#) attribute accordingly.

### 1.8.7.2. EnableDisableAlarm Command

This command allows setting the enable or disable value for the specified alarm modes.

| ID | Name                  | Type             | Constraint | Quality | Fallback | Conformance |
|----|-----------------------|------------------|------------|---------|----------|-------------|
| 0  | AlarmsToEnableDisable | Alarm-ModeBitmap | all        |         |          | M           |

#### 1.8.7.2.1. AlarmsToEnableDisable Field

This field SHALL indicate the alarm modes to either enable or disable depending on the bit status,




Page 95



as specified for the [AlarmsEnabled](#) attribute.

#### 1.8.7.2.2. Effect on Receipt

If any of the requested alarm modes are not supported this command SHALL be ignored and the server SHALL return an CONSTRAINT\_ERROR status code.

If all the bits are valid, the value of the [AlarmsEnabled](#) attribute SHALL be set to the value of the AlarmsToEnableDisable field.

If an alarm mode is being enabled and the trigger condition is met, the device SHALL immediately activate the alarm mode and set the associated bit in the [AlarmsActive](#) attribute.

If an alarm mode is being disabled, any alarm mode which is either in the active or suppressed state SHALL be cleared and the alarm mode SHALL be considered not active.

### 1.8.8. Events

| ID   | Name                      | Priority | Quality | Access | Conformance |
|------|---------------------------|----------|---------|--------|-------------|
| 0x00 | <b>AlarmsStateChanged</b> | INFO     |         | V      | VIS   AUD   |
| 0x01 | <b>SensorFault</b>        | INFO     |         | V      | O           |

#### 1.8.8.1. AlarmsStateChanged Event

This event SHALL be generated after any bits in the [AlarmsActive](#) and/or [AlarmsSuppressed](#) attributes change. This MAY occur in situations such as when internal processing by the server determines that an alarm mode becomes active or inactive, or when the [SuppressAlarm](#) or [EnableDisableAlarm](#) commands are processed in a way that some alarm modes becomes suppressed, active or inactive.

If several alarm modes change state at the same time, a single event combining multiple changes MAY be emitted instead of multiple events each representing a single change.

| ID | Name                    | Type                             | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|----------------------------------|------------|---------|----------|-------------|
| 0  | <b>AlarmsActive</b>     | <a href="#">Alarm-ModeBitmap</a> | all        |         |          | M           |
| 1  | <b>AlarmsSuppressed</b> | <a href="#">Alarm-ModeBitmap</a> | all        |         |          | SPRS        |

##### 1.8.8.1.1. AlarmsActive Field

This field SHALL indicate the state of active alarm modes, as indicated by the [AlarmsActive](#) attribute, at the time the event was generated.

Page 96



#### 1.8.8.1.2. AlarmsSuppressed Field

This field SHALL indicate the state of suppressed alarm modes, as indicated by the [AlarmsSuppressed](#) attribute, at the time the event was generated.

#### 1.8.8.2. SensorFault Event

This event SHALL be generated when the device registers or clears a fault.

| ID | Name               | Type                               | Constraint | Quality | Fallback | Conformance |
|----|--------------------|------------------------------------|------------|---------|----------|-------------|
| 0  | <b>SensorFault</b> | <a href="#">SensorFault-Bitmap</a> | all        |         |          | M           |

##### 1.8.8.2.1. SensorFault Field

This field SHALL indicate the value of the [SensorFault](#) attribute, at the time this event is generated.

## 1.9. Mode Select Cluster

This cluster provides an interface for controlling a characteristic of a device that can be set to one of several predefined values. For example, the light pattern of a disco ball, the mode of a massage chair, or the wash cycle of a laundry machine.

The server allows the client to set a mode on the server. A mode is one of a list of options that may be presented by a client for a user choice, or understood by the client, via the semantic tags on the mode.

A semantic tag is either a standard tag within a standard category namespace, or a manufacturer specific tag, within the namespace of the vendor ID of the manufacturer. If there is no semantic tag, the mode is anonymous, and the selection is made by the user solely based on the Label string.

Each cluster ID that indicates this specification SHALL define a distinct purpose for the cluster instance. For example: A LightBlinking cluster ID supports blinking modes for a light (and is described that way).

An anonymous mode SHALL support the derived cluster purpose. A manufacturer specific semantic tag SHALL support the derived cluster purpose. An anonymous mode SHALL NOT replace the meaning of a standard semantic tag, when one exists, for the cluster purpose.

### 1.9.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |



Page 97



| Revision | Description                                                                            |
|----------|----------------------------------------------------------------------------------------|
| 2        | The MfgCode field was marked non-nullable. Updated the related text. Reorder sections. |

### 1.9.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | MOD       |

### 1.9.3. Cluster ID

| ID     | Name        |
|--------|-------------|
| 0x0050 | Mode Select |

### 1.9.4. Features

This cluster SHALL support the FeatureMap global attribute:

| Bit | Code     | Feature | Summary                           |
|-----|----------|---------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | Dependency with the OnOff cluster |

#### 1.9.4.1. OnOff Feature

This feature creates a dependency between an OnOff cluster instance and this cluster instance on the same endpoint. See [Section 1.9.6.6, “OnMode Attribute”](#) for more information.

### 1.9.5. Data Types

#### 1.9.5.1. SemanticTagStruct Type

A Semantic Tag is meant to be interpreted by the client for the purpose the cluster serves.

| ID | Name    | Type      | Constraint | Quality | Fallback | Access | Conformance |
|----|---------|-----------|------------|---------|----------|--------|-------------|
| 0  | MfgCode | vendor-id | desc       | F       |          |        | M           |
| 1  | Value   | enum16    | all        | F       |          |        | M           |

##### 1.9.5.1.1. Value Field

This field SHALL indicate the semantic tag within a semantic tag namespace which is either manufacturer specific or standard. For semantic tags in a standard namespace, see [Standard Namespace](#).

##### 1.9.5.1.2. MfgCode Field

This field SHALL indicate a manufacturer code (Vendor ID), and the Value field SHALL indicate a

Page 98







semantic tag defined by the manufacturer. Each manufacturer code supports a single namespace of values. The same manufacturer code and semantic tag value in separate cluster instances are part of the same namespace and have the same meaning. For example: a manufacturer tag meaning "pinch", has the same meaning in a cluster whose purpose is to choose the amount of sugar, or amount of salt.

### 1.9.5.2. ModeOptionStruct Type

This is a struct representing a possible mode of the server.

| ID | Name                 | Type                                       | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------|--------------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Label</b>         | string                                     | max 64     | F       | MS       |        | M           |
| 1  | <b>Mode</b>          | uint8                                      |            | F       | MS       |        | M           |
| 2  | <b>Semantic-Tags</b> | list[ <a href="#">Semantic-TagStruct</a> ] | max 64     | F       | MS       |        | M           |

#### 1.9.5.2.1. Label Field

This field is readable text that describes the mode option that can be used by a client to indicate to the user what this option means. This field is meant to be readable and understandable by the user.

#### 1.9.5.2.2. Mode Field

The Mode field is used to identify the mode option. The value SHALL be unique for every item in the SupportedModes attribute.

#### 1.9.5.2.3. SemanticTags Field

This field is a list of semantic tags that map to the mode option. This MAY be used by clients to determine the meaning of the mode option as defined in a standard or manufacturer specific namespace. Semantic tags can help clients look for options that meet certain criteria. A semantic tag SHALL be either a standard tag or manufacturer specific tag as defined in each [SemanticTagStruct](#) list entry.

A mode option MAY have more than one semantic tag. A mode option MAY be mapped to a mixture of standard and manufacturer specific semantic tags.

All standard semantic tags are from a single namespace indicated by the StandardNamespace attribute.

For example: A mode labeled "100%" can have both the **HIGH** (MS) and **MAX** (standard) semantic tag. Clients seeking the option for either **HIGH** or **MAX** will find the same option in this case.

## 1.9.6. Attributes



Page 99



| ID     | Name              | Type                   | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------|------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | Description       | string                 | max 64     | F       | MS       | R V    | M           |
| 0x0001 | StandardNamespace | enum16                 | desc       | F X     | null     | R V    | M           |
| 0x0002 | SupportedModes    | list[ModeOptionStruct] | max 255    | F       | MS       | R V    | M           |
| 0x0003 | CurrentMode       | uint8                  | desc       | N       | MS       | R V    | M           |
| 0x0004 | StartUpMode       | uint8                  | desc       | N X     | MS       | RW VO  | O           |
| 0x0005 | OnMode            | uint8                  | desc       | N X     | null     | RW VO  | DEPONOFF    |

#### 1.9.6.1. Description Attribute

This attribute describes the purpose of the server, in readable text.

For example, a coffee machine may have a Mode Select cluster for the amount of milk to add, and another Mode Select cluster for the amount of sugar to add. In this case, the first instance can have the description **Milk** and the second instance can have the description **Sugar**. This allows the user to tell the purpose of each of the instances.

#### 1.9.6.2. StandardNamespace Attribute

This attribute, when not null, SHALL indicate a single standard namespace for any standard semantic tag value supported in this or any other cluster instance with the same value of this attribute. A null value indicates no standard namespace, and therefore, no standard semantic tags are provided in this cluster instance. Each standard namespace and corresponding values and value meanings SHALL be defined in another document.

#### 1.9.6.3. SupportedModes Attribute

This attribute is the list of supported modes that may be selected for the CurrentMode attribute. Each item in this list represents a unique mode as indicated by the Mode field of the ModeOptionStruct. Each entry in this list SHALL have a unique value for the Mode field.

#### 1.9.6.4. CurrentMode Attribute

This attribute represents the current mode of the server.

The value of this field must match the Mode field of one of the entries in the **SupportedModes** attribute.

Page 100







#### 1.9.6.5. StartUpMode Attribute

The StartUpMode attribute value indicates the desired startup mode for the server when it is supplied with power.

If this attribute is not null, the CurrentMode attribute SHALL be set to the StartUpMode value, when the server is powered up, except in the case when the OnMode attribute overrides the StartUpMode attribute (see [Section 1.9.6.6.1, “OnMode with Power Up”](#)).

This behavior does not apply to reboots associated with OTA. After an OTA restart, the CurrentMode attribute SHALL return to its value prior to the restart.

The value of this field SHALL match the Mode field of one of the entries in the [SupportedModes](#) attribute.

If this attribute is not implemented, or is set to the null value, it SHALL have no effect.

#### 1.9.6.6. OnMode Attribute

This attribute SHALL indicate the value of CurrentMode that depends on the state of the On/Off cluster on the same endpoint. If this attribute is not present or is set to null, it SHALL NOT have an effect, otherwise the CurrentMode attribute SHALL depend on the OnOff attribute of the On/Off cluster as described in the table below:

| OnOff Change | CurrentMode Change           |
|--------------|------------------------------|
| ON → OFF     | No change                    |
| OFF → ON     | Change CurrentMode to OnMode |
| OFF → OFF    | No change                    |
| ON → ON      | No change                    |

The value of this field SHALL match the Mode field of one of the entries in the [SupportedModes](#) attribute.

##### 1.9.6.6.1. OnMode with Power Up

If the On/Off feature is supported and the On/Off cluster attribute [StartUpOnOff](#) is present, with a value of On (turn on at power up), then the CurrentMode attribute SHALL be set to the OnMode attribute value when the server is supplied with power, except if the OnMode attribute is null.

### 1.9.7. Commands

| ID   | Name                | Direction       | Response | Access | Conformance |
|------|---------------------|-----------------|----------|--------|-------------|
| 0x00 | <b>ChangeToMode</b> | client ⇒ server | Y        | O      | M           |

#### 1.9.7.1. ChangeToMode Command

On receipt of this command, if the [NewMode](#) field indicates a valid mode transition within the sup-




Page 101



ported list, the server SHALL set the [CurrentMode](#) attribute to the [NewMode](#) value, otherwise, the server SHALL respond with an [INVALID\\_COMMAND](#) status response.

| ID | Name                    | Type  | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|-------|------------|---------|----------|-------------|
| 0  | <a href="#">NewMode</a> | uint8 | desc       |         |          | M           |

## 1.10. Mode Base Cluster

This cluster provides an interface for controlling a characteristic of a device that can be set to one of several predefined values. For example, the light pattern of a disco ball, the mode of a massage chair, or the wash cycle of a laundry machine.

The server allows the client to set a mode on the server. A mode is one of a list of options that may be presented by a client for a user choice, or understood by the client, via the mode's tags.

A mode tag is either a standard tag within a standard category namespace, or a manufacturer specific tag, within the namespace of the vendor ID of the manufacturer.

Any derived cluster specification based on this cluster SHALL support the standard mode tag value definitions and command status definitions defined in this cluster and MAY define additional standard mode tag values and standard command status values that are supported in the respective derived cluster instances.

Each cluster ID that indicates this specification SHALL define a distinct purpose for the cluster instance. For example: A LightBlinking cluster ID supports blinking modes for a light (and is described that way).

An anonymous mode SHALL NOT replace the meaning of a standard mode tag, when one exists, for the cluster purpose.

### 1.10.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                                                                                  |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                                                                                             |
| 2        | ChangeToModeResponse command: StatusText must be provided for InvalidInMode status. Require at least one standard mode tag. Define reserved ranges for base/derived clusters |

### 1.10.2. Classification

Page 102



| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | MODB      |

### 1.10.3. Cluster ID

| ID  | Name      |
|-----|-----------|
| n/a | Mode Base |

### 1.10.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code     | Feature | Summary                           |
|-----|----------|---------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | Dependency with the OnOff cluster |

#### 1.10.4.1. OnOff Feature

This feature creates a dependency between an OnOff cluster instance and this cluster instance on the same endpoint. See [OnMode](#) for more information.

### 1.10.5. Data Types

#### 1.10.5.1. ModeTagStruct Type

A Mode Tag is meant to be interpreted by the client for the purpose the cluster serves.

| ID | Name    | Type      | Constraint | Quality | Fallback | Access | Conformance |
|----|---------|-----------|------------|---------|----------|--------|-------------|
| 0  | MfgCode | vendor-id | desc       |         |          |        | O           |
| 1  | Value   | enum16    | all        |         |          |        | M           |

##### 1.10.5.1.1. MfgCode Field

If the MfgCode field exists, the Value field SHALL be in the manufacturer-specific value range (see [Section 1.10.8, “Mode Namespace”](#)).

This field SHALL indicate the manufacturer's VendorID and it SHALL determine the meaning of the Value field.

The same manufacturer code and mode tag value in separate cluster instances are part of the same namespace and have the same meaning. For example: a manufacturer tag meaning "pinch" can be used both in a cluster whose purpose is to choose the amount of sugar, or in a cluster whose purpose is to choose the amount of salt.




Page 103



### 1.10.5.1.2. Value Field

This field SHALL indicate the mode tag within a mode tag namespace which is either manufacturer specific or standard.

### 1.10.5.2. ModeOptionStruct Type

This is a struct representing a possible mode of the server.

| ID | Name            | Type                                  | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|---------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Label</b>    | string                                | max 64     | F       |          |        | M           |
| 1  | <b>Mode</b>     | uint8                                 |            | F       |          |        | M           |
| 2  | <b>ModeTags</b> | list[ <a href="#">ModeTagStruct</a> ] | max 8      | F       |          |        | M           |

#### 1.10.5.2.1. Label Field

This field SHALL indicate readable text that describes the mode option, so that a client can provide it to the user to indicate what this option means. This field is meant to be readable and understandable by the user.

#### 1.10.5.2.2. Mode Field

This field is used to identify the mode option.

#### 1.10.5.2.3. ModeTags Field

This field SHALL contain a list of tags that are associated with the mode option. This MAY be used by clients to determine the full or the partial semantics of a certain mode, depending on which tags they understand, using standard definitions and/or manufacturer specific namespace definitions.

The standard mode tags are defined in this cluster specification. For the derived cluster instances, if the specification of the derived cluster defines a namespace, the set of standard mode tags also includes the mode tag values from that namespace.

Mode tags can help clients look for options that meet certain criteria, render the user interface, use the mode in an automation, or to craft help text their voice-driven interfaces. A mode tag SHALL be either a standard tag or a manufacturer specific tag, as defined in each [ModeTagStruct](#) list entry.

A mode option MAY have more than one mode tag. A mode option MAY be associated with a mixture of standard and manufacturer specific mode tags. A mode option SHALL be associated with at least one standard mode tag.

Each mode tag in this field SHALL be distinct from other mode tags in this field. For example, a simplified list containing [Auto, Auto] would not be allowed.

A few examples are provided below.

- A mode named "100%" can have both the High (manufacturer specific) and Max (standard)

Page 104







- mode tag. Clients seeking the mode for either High or Max will find the same mode in this case.
- A mode that includes a LowEnergy tag can be displayed by the client using a widget icon that shows a green leaf.
  - A mode that includes a LowNoise tag may be used by the client when the user wishes for a lower level of audible sound, less likely to disturb the household's activities.
  - A mode that includes a LowEnergy tag (standard, defined in this cluster specification) and also a Delicate tag (standard, defined in the namespace of a Laundry Mode derived cluster).
  - A mode that includes both a generic Quick tag (defined here), and Vacuum and Mop tags, (defined in the RVC Clean cluster that is a derivation of this cluster).

### 1.10.6. Attributes

| ID     | Name                  | Type                                     | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------|------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>SupportedModes</b> | list[ <a href="#">ModeOptionStruct</a> ] | 2 to 255   | F       |          | RV     | M           |
| 0x0001 | <b>CurrentMode</b>    | uint8                                    | desc       | N       |          | RV     | M           |
| 0x0002 | <b>StartUpMode</b>    | uint8                                    | desc       | N X     | MS       | RW VO  | O           |
| 0x0003 | <b>OnMode</b>         | uint8                                    | desc       | N X     |          | RW VO  | DEPONOFF    |

#### 1.10.6.1. SupportedModes Attribute

This attribute SHALL contain the list of supported modes that may be selected for the CurrentMode attribute. Each item in this list represents a unique mode as indicated by the Mode field of the [ModeOptionStruct](#).

Each entry in this list SHALL have a unique value for the Mode field.

Each entry in this list SHALL have a unique value for the Label field.

The set of ModeTags listed in each entry in this list SHALL be distinct from the sets of ModeTags listed in the other entries. This comparison SHALL NOT depend on the order of the ModeTags in the lists. Two sets SHALL be considered distinct if one of them contains an element that the other one does not. Note that the two sets could have a non-empty intersection, or one could be a subset of the other, and still be distinct.

Simplified examples of allowed ModeTags lists:

| SupportedModes Index | Simplified mode tag list | Reason       |
|----------------------|--------------------------|--------------|
| 0                    | Cool                     | Subset is ok |



Page 105



| SupportedModes Index | Simplified mode tag list | Reason                                                                       |
|----------------------|--------------------------|------------------------------------------------------------------------------|
| 1                    | Cool, MfrTag1            | Overlap is ok, the set was made unique by adding a manufacturer specific tag |
| 2                    | Cool, MfrTag2            | Overlap is ok, list is unique                                                |

Simplified examples of disallowed ModeTags lists:

| SupportedModes Index | Simplified mode tag list | Reason                |
|----------------------|--------------------------|-----------------------|
| 0                    | Cool, MfrTag1            | Tag set is duplicated |
| 1                    | MfrTag1, Cool            | Tag set is duplicated |

#### 1.10.6.2. CurrentMode Attribute

This attribute SHALL indicate the current mode of the server.

The value of this field SHALL match the Mode field of one of the entries in the SupportedModes attribute.

The value of this attribute may change at any time via an out-of-band interaction outside of the server, such as interactions with a user interface, via internal mode changes due to autonomously progressing through a sequence of operations, on system time-outs or idle delays, or via interactions coming from a fabric other than the one which last executed a ChangeToMode.

#### 1.10.6.3. StartUpMode Attribute

This attribute SHALL indicate the desired startup mode for the server when it is supplied with power.

If this attribute is not null, the CurrentMode attribute SHALL be set to the StartUpMode value, when the server is powered up, except in the case when the OnMode attribute overrides the StartUpMode attribute (see [Section 1.10.6.4.1, “OnMode with Power Up”](#)).

This behavior does not apply to reboots associated with OTA. After an OTA restart, the CurrentMode attribute SHALL return to its value prior to the restart.

The value of this field SHALL match the Mode field of one of the entries in the SupportedModes attribute.

If this attribute is not implemented, or is set to the null value, it SHALL have no effect.

#### 1.10.6.4. OnMode Attribute

This attribute SHALL indicate whether the value of CurrentMode depends on the state of the On/Off cluster on the same endpoint. If this attribute is not present or is set to null, there is no dependency, otherwise the CurrentMode attribute SHALL depend on the OnOff attribute in the On/Off cluster as described in the table below:

Page 106



| OnOff Change | CurrentMode Change           |
|--------------|------------------------------|
| ON → OFF     | No change                    |
| OFF → ON     | Change CurrentMode to OnMode |
| OFF → OFF    | No change                    |
| ON → ON      | No change                    |

The value of this field SHALL match the Mode field of one of the entries in the SupportedModes attribute.

#### 1.10.6.4.1. OnMode with Power Up

If the On/Off feature is supported and the On/Off cluster attribute [StartUpOnOff](#) is present, with a value of On (turn on at power up), then the CurrentMode attribute SHALL be set to the OnMode attribute value when the server is supplied with power, except if the OnMode attribute is null.

### 1.10.7. Commands

| ID   | Name                  | Direction       | Response             | Access | Conformance |
|------|-----------------------|-----------------|----------------------|--------|-------------|
| 0x00 | ChangeTo-Mode         | client ⇒ server | ChangeToModeResponse | O      | M           |
| 0x01 | ChangeTo-ModeResponse | client ← server | N                    |        | M           |

#### 1.10.7.1. ChangeToMode Command

This command is used to change device modes.

On receipt of this command the device SHALL respond with a ChangeToModeResponse command.

This command SHALL have the following data fields:

| ID | Name    | Type  | Constraint | Quality | Fallback | Conformance |
|----|---------|-------|------------|---------|----------|-------------|
| 0  | NewMode | uint8 | desc       |         |          | M           |

##### 1.10.7.1.1. NewMode Field

If the NewMode field doesn't match the Mode field of any entry of the SupportedModes list, the ChangeToModeResponse command's Status field SHALL indicate UnsupportedMode and the StatusText field SHALL be included and MAY be used to indicate the issue, with a human readable string, or include an empty string.

If the NewMode field matches the Mode field of one entry of the SupportedModes list, but the device is not able to transition as requested, the ChangeToModeResponse command SHALL:

- Have the Status set to a product-specific Status value representing the error, or GenericFailure if



Page 107



a more specific error cannot be provided. See [Status](#) field for details.

- Provide a human readable string in the StatusText field.

If the NewMode field matches the Mode field of one entry of the SupportedModes list and the device is able to transition as requested, the server SHALL transition into the mode associated with NewMode, the ChangeToModeResponse command SHALL have the Status field set to Success, the StatusText field MAY be supplied with a human readable string or include an empty string and the CurrentMode field SHALL be set to the value of the NewMode field.

If the NewMode field is the same as the value of the CurrentMode attribute the ChangeToModeResponse command SHALL have the Status field set to Success and the StatusText field MAY be supplied with a human readable string or include an empty string.

### 1.10.7.2. ChangeToModeResponse Command

This command is sent by the device on receipt of the ChangeToMode command. This command SHALL have the following data fields:

| ID | Name              | Type   | Constraint | Quality | Fallback | Conformance            |
|----|-------------------|--------|------------|---------|----------|------------------------|
| 0  | <b>Status</b>     | enum8  | desc       |         |          | M                      |
| 1  | <b>StatusText</b> | string | max 64     |         |          | [Status == Success], M |

#### 1.10.7.2.1. Status Field

##### 1.10.7.2.1.1. Mode Base Status Code Ranges

The following table defines the enumeration ranges for the ChangeToModeResponse command's Status field values.

| Status Code Range | Range Name                 | Summary                                                                                                                               |
|-------------------|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------|
| 0x00 to 0x3F      | <b>CommonCodes</b>         | Common standard values defined in the generic Mode Base cluster specification.                                                        |
| 0x40 to 0x7F      | <b>DerivedClusterCodes</b> | Derived cluster specific standard values defined in the derived Mode Base cluster specification.                                      |
| 0x80 to 0xBF      | <b>MfgCodes</b>            | Manufacturer specific values. For the derived Mode Base cluster instances, these are manufacturer specific under the derived cluster. |

The set of Status field values defined in each of the generic or derived Mode Base cluster specifications is called StatusCode.

Page 108







### 1.10.7.2.1.2. Mode Base Status CommonCodes Range

The following table defines the common StatusCode values.

| Status Code | Name                   | Summary                                                                                                                                           |
|-------------|------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| 0x00        | <b>Success</b>         | Switching to the mode indicated by the NewMode field is allowed and possible. The CurrentMode attribute is set to the value of the NewMode field. |
| 0x01        | <b>UnsupportedMode</b> | The value of the NewMode field doesn't match any entries in the SupportedModes attribute.                                                         |
| 0x02        | <b>GenericFailure</b>  | Generic failure code, indicating that switching to the mode indicated by the NewMode field is not allowed or not possible.                        |
| 0x03        | <b>InvalidInMode</b>   | The received request cannot be handled due to the current mode of the device                                                                      |

The derived cluster code definitions SHALL NOT duplicate the common code definitions. For example, a derived cluster specification SHALL NOT define a status code with the same semantic as the common code of 0x01 (UnsupportedMode).

If the Status field is set to Success, the StatusText field is optional.

If the Status field is set to UnsupportedMode, the StatusText field SHALL be an empty string.

If the Status field is not set to Success or UnsupportedMode, the StatusText field SHALL include a vendor-defined error description which can be used to explain the error to the user. For example, if the Status field is set to InvalidInMode, the StatusText field SHOULD indicate why the transition to the requested mode is not allowed, given the current mode of the device, which may involve other clusters.

### 1.10.8. Mode Namespace

This section provides the definitions of the mode tag ranges and of the common standard mode tag values available in the instances of this cluster.

The following table defines the enumeration ranges for the ModeTagStruct Value field values.

| Mode Tag Value Range | Range Name        | Summary                                                       |
|----------------------|-------------------|---------------------------------------------------------------|
| 0x0000 to 0x3FFF     | <b>CommonTags</b> | Common standard values defined in this cluster specification. |




Page 109



| Mode Tag Value Range | Range Name                | Summary                                                                                                                     |
|----------------------|---------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| 0x4000 to 0x7FFF     | <b>DerivedClusterTags</b> | Derived cluster specific standard values defined in the derived cluster specification.                                      |
| 0x8000 to 0xBFFF     | <b>MfgTags</b>            | Manufacturer-specific values. For the derived cluster instances, these are manufacturer specific under the derived cluster. |

The derived cluster specific standard value definitions SHALL not duplicate the common standard value definitions. For example, a derived cluster specification can't define a mode tag value with the same mode as the common standard tag value of 0x0001 (Quick).

The set of ModeTagStruct Value field values defined in each of the generic or derived Mode Base cluster specifications is called ModeTag.

The following table defines the common ModeTag values.

| Mode Tag Value | Name             |
|----------------|------------------|
| 0x0000         | <b>Auto</b>      |
| 0x0001         | <b>Quick</b>     |
| 0x0002         | <b>Quiet</b>     |
| 0x0003         | <b>LowNoise</b>  |
| 0x0004         | <b>LowEnergy</b> |
| 0x0005         | <b>Vacation</b>  |
| 0x0006         | <b>Min</b>       |
| 0x0007         | <b>Max</b>       |
| 0x0008         | <b>Night</b>     |
| 0x0009         | <b>Day</b>       |

#### 1.10.8.1. Auto Tag

The device decides which options, features and setting values to use.

#### 1.10.8.2. Quick Tag

The mode of the device is optimizing for faster completion.

#### 1.10.8.3. Quiet Tag

The device is silent or barely audible while in this mode.

Page 110







#### 1.10.8.4. LowNoise Tag

Either the mode is inherently low noise or the device optimizes for that.

#### 1.10.8.5. LowEnergy Tag

The device is optimizing for lower energy usage in this mode. Sometimes called "Eco mode".

#### 1.10.8.6. Vacation Tag

A mode suitable for use during vacations or other extended absences.

#### 1.10.8.7. Min Tag

The mode uses the lowest available setting value.

#### 1.10.8.8. Max Tag

The mode uses the highest available setting value.

#### 1.10.8.9. Night Tag

The mode is recommended or suitable for use during night time.

#### 1.10.8.10. Day Tag

The mode is recommended or suitable for use during day time.

### 1.11. Low Power Cluster

This cluster provides an interface for managing low power mode on a device.

This cluster would be supported on an endpoint that represents a physical device with a low power mode. This cluster provides a `sleep()` command to allow clients to manually put the device into low power mode. There is no command here to wake up a sleeping device because that operation often involves other protocols such as [Wake On LAN](#). Most devices automatically enter low power mode based upon inactivity.

The cluster server for Low Power is implemented by a device that supports a low power mode, such as a TV, Set-top box, or Smart Speaker.

#### NOTE

We have considered a "DisableLowPowerMode" command but have not added it due to suspected issues with energy consumption regulations. This can be added in the future.

#### 1.11.1. Revision History

The global `ClusterRevision` attribute value SHALL be the highest revision number in the table below.



Page 111



| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 1.11.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | LOWPOWER  |

### 1.11.3. Cluster ID

| ID     | Name      |
|--------|-----------|
| 0x0508 | Low Power |

### 1.11.4. Commands

| ID   | Name  | Direction                   | Response | Access | Conformance |
|------|-------|-----------------------------|----------|--------|-------------|
| 0x00 | Sleep | client $\Rightarrow$ server | Y        | O      | M           |

#### 1.11.4.1. Sleep Command

This command SHALL put the device into low power mode.

## 1.12. Wake On LAN Cluster

This cluster provides an interface for managing low power mode on a device that supports the Wake On LAN or Wake On Wireless LAN (WLAN) protocol (see [[Wake On LAN](#)]).

This cluster would be supported on IP devices that have a low power mode AND support the ability to be woken up using the Wake on LAN or Wake on WLAN protocol. This cluster provides the device MAC address which is a required input to the Wake on LAN protocol. Besides the MAC address, this cluster provides an optional link-local IPv6 address which is useful to support "Wake on Direct Packet" used by some Ethernet and Wi-Fi devices.

Acting on the MAC address or link-local IPv6 address information does require the caller to be in the same broadcast domain as the destination. To wake the destination up, the caller sends a multicast-based magic UDP packet that contains destination's MAC address in the UDP payload to FF02::1, the IPv6 all-nodes link-local multicast group address. If the optional link-local address is provided by the destination through this cluster, the caller also sends the magic UDP packet in unicast to that link-local address. This unicast-based method is particularly useful for Wi-Fi devices, since due to lack of MAC layer retransmission mechanism, multicast over Wi-Fi is not as reliable as unicast. If a device provides the link-local address in this cluster, its Ethernet controller or Wi-Fi radio SHALL respond to the IPv6 neighbor solicitation message for the link-local address without the need to wake host CPU up. In order to receive the magic or neighbor solicitation packets in multicast, the Wi-Fi devices must support Group Temporal Key (GTK) rekey operation in low power mode.

Most devices automatically enter low power mode based upon inactivity.

Page 112







The cluster server for Wake on LAN or Wake on WLAN is implemented by a device that supports the Wake on LAN/WLAN protocol, such as a TV, Set-top Box, or Smart Speaker.

### 1.12.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 1.12.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | WAKEONLAN |

### 1.12.3. Cluster ID

| ID     | Name        |
|--------|-------------|
| 0x0503 | Wake on LAN |

### 1.12.4. Attributes

| ID     | Name             | Type    | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------|---------|------------|---------|----------|--------|-------------|
| 0x0000 | MACAddress       | string  | max 12     | F       |          | R V    | O           |
| 0x0001 | LinkLocalAddress | ipv6adr | desc       | F       |          | R V    | O           |

#### 1.12.4.1. MACAddress Attribute

This attribute SHALL indicate the current MAC address of the device. Only 48-bit MAC Addresses SHALL be used for this attribute as required by the Wake on LAN protocol.

Format of this attribute SHALL be an upper-case hex-encoded string representing the hex address, like **12345678ABCD**.

#### 1.12.4.2. LinkLocalAddress Attribute

This attribute SHALL indicate the current link-local address of the device. Only 128-bit IPv6 link-local addresses SHALL be used for this attribute.

#### NOTE

Some companies may consider MAC Address to be protected data subject to PII handling considerations and will therefore choose not to include it or read it. The MAC Address can often be determined using ARP in IPv4 or NDP in IPv6.



Page 113



## 1.13. Switch Cluster

This cluster exposes interactions with a switch device, for the purpose of using those interactions by other devices.

Two types of switch devices are supported: latching switch (e.g. rocker switch) and momentary switch (e.g. push button), distinguished with their feature flags.

Interactions with the switch device are exposed as attributes (for the latching switch) and as events (for both types of switches).

An interested client MAY subscribe to these attributes/events and thus be informed of the interactions, and can perform actions based on this, for example by sending commands to perform an action such as controlling a light or a window shade.

### 1.13.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                                                                                               |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                                                                                                          |
| 2        | Behavior clarifications for ambiguous combinations of events; Introduction of TotalNumberOfPressesCounted == 0 when MultiPressMax is exceeded; Introduction of ActionSwitch feature flag. |

### 1.13.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | SWTCH     |

### 1.13.3. Cluster ID

| ID     | Name   |
|--------|--------|
| 0x003B | Switch |

### 1.13.4. Features

These feature flags SHALL be used to indicate the physics as well as the detection/reporting capabilities of the device represented by the cluster.

| Bit | Code | Feature         | Conformance | Summary             |
|-----|------|-----------------|-------------|---------------------|
| 0   | LS   | LatchingSwitch  | O.a         | Switch is latching  |
| 1   | MS   | MomentarySwitch | O.a         | Switch is momentary |

Page 114



| Bit | Code | Feature                   | Conformance       | Summary                                                                                                                                        |
|-----|------|---------------------------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 2   | MSR  | MomentarySwitchRelease    | [MS & !AS]        | Switch supports release events generation                                                                                                      |
| 3   | MSL  | MomentarySwitchLongPress  | [MS & (MSR   AS)] | Switch supports long press detection                                                                                                           |
| 4   | MSM  | MomentarySwitchMultiPress | AS, [MS & MSR]    | Switch supports multi-press detection                                                                                                          |
| 5   | AS   | ActionSwitch              | [MS]              | Switch is momentary, targeted at specific user actions (focus on multi-press and optionally long press) with a reduced event generation scheme |

#### 1.13.4.1. LatchingSwitch Feature

This feature flag is for a switch that maintains its position after being pressed (or turned).

#### 1.13.4.2. MomentarySwitch Feature

This feature flag is for a switch that does not maintain its position after being pressed (or turned). After releasing, it goes back to its idle position.

#### 1.13.4.3. MomentarySwitchRelease Feature

This feature flag is for a momentary switch that can distinguish and report release events.

#### 1.13.4.4. MomentarySwitchLongPress Feature

This feature flag is for a momentary switch that can distinguish and report long presses from short presses.

#### 1.13.4.5. MomentarySwitchMultiPress Feature

This feature flag is for a momentary switch that can distinguish and report double press and potentially multiple presses with more events, such as triple press, etc.

#### 1.13.4.6. ActionSwitch Feature

This feature flag indicates simplified handling of events for multi-press-capable switches. See [Section 1.13.8, “Sequence of events for MultiPress”](#).



Page 115



### 1.13.5. Attributes

| ID     | Name                     | Type  | Constraint                  | Quality | Fallback | Access | Conformance |
|--------|--------------------------|-------|-----------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>NumberOfPositions</b> | uint8 | min 2                       | F       |          | R V    | M           |
| 0x0001 | <b>CurrentPosition</b>   | uint8 | max (NumberOfPositions - 1) | N       |          | R V    | M           |
| 0x0002 | <b>MultiPressMax</b>     | uint8 | min 2                       | F       |          | R V    | MSM         |

#### 1.13.5.1. NumberOfPositions Attribute

This attribute SHALL indicate the maximum number of positions the switch has. Any kind of switch has a minimum of 2 positions. Also see [Section 1.13.10, “Multi Position Details”](#) for the case NumberOfPositions>2.

#### 1.13.5.2. CurrentPosition Attribute

This attribute SHALL indicate the position of the switch.

The valid range is zero to NumberOfPositions - 1.

CurrentPosition value 0 SHALL be assigned to the default position of the switch: for example the "open" state of a rocker switch, or the "idle" state of a push button switch.

#### 1.13.5.3. MultiPressMax Attribute

This attribute SHALL indicate how many consecutive presses can be detected and reported by a momentary switch which supports multi-press (MSM feature flag set).

For example, a momentary switch supporting single press, double press and triple press, but not quad press and beyond, would return the value 3.

When more than MultiPressMax presses are detected within a multi-press sequence:

- The server for cluster revision < 2 SHOULD generate a MultiPressComplete event with the TotalNumberOfPressesCounted field set to the value of the MultiPressMax attribute, and avoid generating any further InitialPress and MultiPressOngoing events until the switch has become fully idle (i.e. no longer in the process of counting presses within the multipress).
- The server for cluster revision >= 2 SHALL generate a MultiPressComplete event with the TotalNumberOfPressesCounted field set to zero (indicating an aborted sequence), and SHALL NOT generate any further InitialPress and MultiPressOngoing events until the switch has become fully idle (i.e. no longer in the process of counting presses within the multipress).

This approach avoids unintentionally causing intermediate actions where there is a very long

Page 116







sequence of presses beyond MultiPressMax that MAY be taken in account specially by switches (e.g. to trigger special behavior such as factory reset for which generating events towards the client is not appropriate).

### 1.13.6. Events

| ID   | Name                      | Priority | Quality | Access | Conformance |
|------|---------------------------|----------|---------|--------|-------------|
| 0x00 | <b>Switch-Latched</b>     | INFO     |         | V      | LS          |
| 0x01 | <b>InitialPress</b>       | INFO     |         | V      | MS          |
| 0x02 | <b>LongPress</b>          | INFO     |         | V      | MSL         |
| 0x03 | <b>ShortRelease</b>       | INFO     |         | V      | MSR         |
| 0x04 | <b>LongRelease</b>        | INFO     |         | V      | MSL         |
| 0x05 | <b>MultiPressOngoing</b>  | INFO     |         | V      | MSM & !AS   |
| 0x06 | <b>MultiPressComplete</b> | INFO     |         | V      | MSM         |

#### 1.13.6.1. SwitchLatched Event

This event SHALL be generated, when the latching switch is moved to a new position. It MAY have been delayed by debouncing within the switch.

The data of this event SHALL contain the following information:

| ID | Name               | Type  | Constraint                   | Quality | Fallback | Conformance |
|----|--------------------|-------|------------------------------|---------|----------|-------------|
| 0  | <b>NewPosition</b> | uint8 | 0 to (NumberOfPositions - 1) |         |          | M           |

##### 1.13.6.1.1. NewPosition Field

This field SHALL indicate the new value of the CurrentPosition attribute, i.e. after the move.

#### 1.13.6.2. InitialPress Event

This event SHALL be generated, when the momentary switch starts to be pressed (after debouncing).

The data of this event SHALL contain the following information:




Page 117



| ID | Name               | Type  | Constraint                   | Quality | Fallback | Conformance |
|----|--------------------|-------|------------------------------|---------|----------|-------------|
| 0  | <b>NewPosition</b> | uint8 | 0 to (NumberOfPositions - 1) |         |          | M           |

#### 1.13.6.2.1. NewPosition Field

This field SHALL indicate the new value of the CurrentPosition attribute, i.e. while pressed.

#### 1.13.6.3. LongPress Event

This event SHALL be generated when the momentary switch has been pressed for a "long" time. The time interval constituting a "long" time is manufacturer-determined, since it depends on the switch physics.

- When the AS feature flag is set, this event:
  - SHALL NOT be generated during a multi-press sequence (since a long press is a separate cycle from any multi-press cycles);
  - SHALL only be generated after the first InitialPress following a MultiPressComplete when a long press is detected after the idle time.
- Else, when the MSM feature flag is set, this event:
  - SHALL NOT be generated during a multi-press sequence (since a long press is a separate cycle from any multi-press cycles);
  - SHALL only be generated after the first InitialPress following a MultiPressComplete when a long press is detected after the idle time;
  - SHALL NOT be generated after a MultiPressOngoing event without an intervening MultiPressComplete event.

The above constraints imply that for a given activity detection cycle of a switch having MSM and/or MSL feature flags set, the entire activity is either a single long press detection cycle of (InitialPress, LongPress, LongRelease), or a single multi-press detection cycle (ending in MultiPressComplete), where presses that would otherwise be reported as long presses are instead reported as a counted press in the MultiPressComplete event, and as InitialPress/ShortRelease pairs otherwise (where applicable).

The rationale for this constraint is the ambiguity of interpretation of events when mixing long presses and multi-press events.

The data of this event SHALL contain the following information:

| ID | Name               | Type  | Constraint                   | Quality | Fallback | Conformance |
|----|--------------------|-------|------------------------------|---------|----------|-------------|
| 0  | <b>NewPosition</b> | uint8 | 0 to (NumberOfPositions - 1) |         |          | M           |

Page 118







#### 1.13.6.3.1. NewPosition Field

This field SHALL indicate the new value of the CurrentPosition attribute, i.e. while pressed.

#### 1.13.6.4. ShortRelease Event

If the server has the Action Switch (AS) feature flag set, this event SHALL NOT be generated at all, since setting the Action Switch feature flag forbids the Momentary Switch ShortRelease (MSR) feature flag from being set. Otherwise, the following paragraphs describe the situations where this event is generated.

This event SHALL be generated, when the momentary switch has been released (after debouncing).

- If the server has the Momentary Switch LongPress (MSL) feature flag set, then this event SHALL be generated when the switch is released if **no** LongPress event had been generated since the previous InitialPress event.
- If the server does not have the Momentary Switch LongPress (MSL) feature flag set, this event SHALL be generated when the switch is released - even when the switch was pressed for a long time.
- Also see [Section 1.13.7, “Sequence of generated events”](#).

The data of this event SHALL contain the following information:

| ID | Name                    | Type  | Constraint                   | Quality | Fallback | Conformance |
|----|-------------------------|-------|------------------------------|---------|----------|-------------|
| 0  | <b>PreviousPosition</b> | uint8 | 0 to (NumberOfPositions - 1) |         |          | M           |

#### 1.13.6.4.1. PreviousPosition Field

This field SHALL indicate the previous value of the CurrentPosition attribute, i.e. just prior to release.

#### 1.13.6.5. LongRelease Event

This event SHALL be generated, when the momentary switch has been released (after debouncing) and after having been pressed for a long time, i.e. this event SHALL be generated when the switch is released if a LongPress event has been generated since the previous InitialPress event. Also see [Section 1.13.7, “Sequence of generated events”](#).

The data of this event SHALL contain the following information:

| ID | Name                    | Type  | Constraint                   | Quality | Fallback | Conformance |
|----|-------------------------|-------|------------------------------|---------|----------|-------------|
| 0  | <b>PreviousPosition</b> | uint8 | 0 to (NumberOfPositions - 1) |         |          | M           |



Page 119



#### 1.13.6.5.1. PreviousPosition Field

This field SHALL indicate the previous value of the CurrentPosition attribute, i.e. just prior to release.

#### 1.13.6.6. MultiPressOngoing Event

If the server has the Action Switch (AS) feature flag set, this event SHALL NOT be generated at all. Otherwise, the following paragraphs describe the situations where this event is generated.

This event SHALL be generated to indicate how many times the momentary switch has been pressed in a multi-press sequence, *during* that sequence. See [Section 1.13.8, “Sequence of events for MultiPress”](#).

The data of this event SHALL contain the following information:

| ID | Name                                 | Type  | Constraint                   | Quality | Fallback | Conformance |
|----|--------------------------------------|-------|------------------------------|---------|----------|-------------|
| 0  | <b>NewPosition</b>                   | uint8 | 0 to (NumberOfPositions - 1) |         |          | M           |
| 1  | <b>CurrentNumberOfPressesCounted</b> | uint8 | 2 to MultiPressMax           |         |          | M           |

##### 1.13.6.6.1. NewPosition Field

This field SHALL indicate the new value of the CurrentPosition attribute, i.e. while pressed.

##### 1.13.6.6.2. CurrentNumberOfPressesCounted Field

This field SHALL contain:

- a value of 2 when the second press of a multi-press sequence has been detected,
- a value of 3 when the third press of a multi-press sequence has been detected,
- a value of N when the N<sup>th</sup> press of a multi-press sequence has been detected.

#### 1.13.6.7. MultiPressComplete Event

This event SHALL be generated to indicate how many times the momentary switch has been pressed in a multi-press sequence, after it has been detected that the sequence has *ended*. See [Section 1.13.8, “Sequence of events for MultiPress”](#).

The data of this event SHALL contain the following information:

Page 120



| ID | Name                               | Type  | Constraint                   | Quality | Fallback | Conformance |
|----|------------------------------------|-------|------------------------------|---------|----------|-------------|
| 0  | <b>PreviousPosition</b>            | uint8 | 0 to (NumberOfPositions - 1) |         |          | M           |
| 1  | <b>TotalNumberOfPressesCounted</b> | uint8 | max MultiPressMax            |         |          | M           |

The PreviousPosition field SHALL indicate the previous value of the CurrentPosition attribute, i.e. just prior to release.

The TotalNumberOfPressesCounted field SHALL contain:

- a value of 0 when there was an aborted multi-press sequence, where the number of presses goes beyond MultiPressMax presses,
- a value of 1 when there was exactly one press in a multi-press sequence (and the sequence has ended), i.e. there was no double press (or more),
- a value of 2 when there were exactly two presses in a multi-press sequence (and the sequence has ended),
- a value of 3 when there were exactly three presses in a multi-press sequence (and the sequence has ended),
- a value of N when there were exactly N presses in a multi-press sequence (and the sequence has ended).

#### NOTE

The introduction of TotalNumberOfPressesCounted supporting the value 0 MAY impact clients of switches using cluster revision 1 since such servers would not use this value of TotalNumberOfPressesCounted to indicate an aborted sequence. Clients SHOULD always act using the TotalNumberOfPressesCounted field taken into account since for values from 1 to MultiPressMax, the user action that led to the event was different depending on the count.

### 1.13.7. Sequence of generated events

This section describes the sequence of events that will be generated by three types of momentary switches (distinguished by their feature flags). For each switch type, we will define the sequence of generated events for these three interactions:

1. Sequence for a switch which is pressed briefly.
2. Sequence for a switch pressed for a long time.
3. Sequence for a switch pressed for a very long time.

In the three interactions described in the subsections below, if the NumberOfPositions attribute is equal to 2, the InitialPress and LongPress events have the NewPosition field set to 1 and the ShortRelease and LongRelease events have the PreviousPosition field set to 1. For larger values of the



Page 121



NumberOfPositions attribute, see [Section 1.13.10, “Multi Position Details”](#).

#### 1.13.7.1. Switches with long-press detection support (MSL feature flag set)

This switch (with feature flags MS & MSL both set) SHALL generate either a sequence of two or three (depending on how long the switch is pressed) events for one interaction cycle, in the order given below and illustrated in the figure below.

- Upon a short press:
  - Generate InitialPress
  - If the MSR feature flag is set and the AS feature flag is NOT set, generate ShortRelease after the previous event, when release is detected.
  - If the MSM feature flag is set, generate MultiPressComplete(1) after the previous event(s).
- Upon a long press (or very long press):
  - Generate InitialPress
  - Generate LongPress after the previous event, when long press is detected
  - Generate LongRelease (and NOT MultiPressComplete(1)) after the previous event, when switch release is detected.

A LongPress event SHALL be generated exactly once for this case and SHALL NOT be repeated, irrespective how long the switch is pressed.

The image shows a time representation of the state of the switch (low=not pressed, high=pressed) with the colored dots indicating the various events generated at that moment in time.

Long presses, feature flags: MS & MSL

![Diagram illustrating switch press events for short, long, and even longer presses with feature flags MS and MSL set.](db6f6e9f69edb58bff0b65268e020fd6_img.jpg)

The diagram shows three horizontal lines representing switch states over time. The top line is labeled 'Short press', the middle 'Long press', and the bottom 'Even longer press'. Each line shows a transition from low to high (press) and back to low (release). Colored dots on the lines represent generated events:

- Short press:** A green dot at the start of the press (InitialPress). A blue dot at the end of the press (ShortRelease if MSR & !AS). A yellow dot at the end of the press (MultiPressComplete(1) if MSM).
- Long press:** A green dot at the start of the press (InitialPress). A yellow dot at the end of the press (LongPress). A purple dot at the end of the press (LongRelease).
- Even longer press:** A green dot at the start of the press (InitialPress). A yellow dot at the end of the press (LongPress). A purple dot at the end of the press (LongRelease).

Below the lines, two horizontal arrows indicate thresholds: 'threshold1 (minimum to be detected)' and 'threshold2 (before considered long press)'.

Diagram illustrating switch press events for short, long, and even longer presses with feature flags MS and MSL set.

*Figure 3. Switch device with MSL feature flag set (single press case)*

Page 122







### 1.13.7.2. Switches without long-press detection support (MSL feature flag not set)

This switch (with feature flags states MS & !MSL) SHALL NOT generate LongPress and LongRelease events and therefore it SHALL generate a sequence of two events for one interaction cycle, irrespective of how long the switch is pressed, in the order given and illustrated below, based on whether the MSM, AS and MSR flags are set.

- Any press length:

1. Generate InitialPress

2. If the MSR feature flag is set and the AS feature flag is NOT set, generate ShortRelease after the previous event, when the release is detected.

3. If the MSM feature flag is set, generate MultiPressComplete(1) after the previous event(s).

NOTE

Even after a "long" period being pressed, the release event is never LongRelease. A device without the MSL feature flag SHALL NOT generate the LongPress and LongRelease events.

#### Presses, feature flags: MS & !MSL

![Diagram illustrating switch presses without MSL feature flag set. It shows three horizontal lines representing different press durations: 'Short press', 'Long press', and 'Even longer press'. A vertical dashed line labeled 'threshold1 (minimum to be detected)' marks the start of detection. The 'Short press' line shows an 'InitialPress' event (green dot) and a 'ShortRelease' event (blue dot) if MSR & !AS. The 'Long press' and 'Even longer press' lines show an 'InitialPress' event (green dot) and a 'MultiPressComplete(1)' event (orange dot) if MSM. Dashed lines connect the 'InitialPress' event to the 'ShortRelease' and 'MultiPressComplete(1)' events.](66b2567aa84dd1d036931b056352e11e_img.jpg)

Diagram illustrating switch presses without MSL feature flag set. It shows three horizontal lines representing different press durations: 'Short press', 'Long press', and 'Even longer press'. A vertical dashed line labeled 'threshold1 (minimum to be detected)' marks the start of detection. The 'Short press' line shows an 'InitialPress' event (green dot) and a 'ShortRelease' event (blue dot) if MSR & !AS. The 'Long press' and 'Even longer press' lines show an 'InitialPress' event (green dot) and a 'MultiPressComplete(1)' event (orange dot) if MSM. Dashed lines connect the 'InitialPress' event to the 'ShortRelease' and 'MultiPressComplete(1)' events.

Figure 4. Switch device without MSL feature flag not set (single press case)

### 1.13.7.3. Switches with most basic MS-only feature flag set, not (MSR | MSL | MSM | AS)

This switch (with feature flags states MS & !MSR & !MSL & !MSM & !AS) SHALL generate a single InitialPress event for one interaction cycle, irrespective of how long the switch is pressed, as illustrated in the figure below.

A device with this set of feature flags SHALL NOT generate any of the ShortRelease, LongPress and LongRelease events.



Page 123



## Presses, feature flags: MS & !MSR & !MSL

![Figure 5: Switch device delivering only 'InitialPress' events (single press case). The diagram shows three horizontal lines representing switch states. The top line is labeled 'Short press', the middle 'Long press', and the bottom 'Even longer press'. A vertical dashed line marks the 'InitialPress' event. A horizontal line labeled 'threshold1 (minimum to be detected)' is shown below the 'Even longer press' line. The diagram illustrates that only the 'InitialPress' event is generated for a single press, regardless of its duration.](684f7a2cd4ba3346bcaec1f7336f6aa3_img.jpg)

Figure 5: Switch device delivering only 'InitialPress' events (single press case). The diagram shows three horizontal lines representing switch states. The top line is labeled 'Short press', the middle 'Long press', and the bottom 'Even longer press'. A vertical dashed line marks the 'InitialPress' event. A horizontal line labeled 'threshold1 (minimum to be detected)' is shown below the 'Even longer press' line. The diagram illustrates that only the 'InitialPress' event is generated for a single press, regardless of its duration.

Figure 5. Switch device delivering only 'InitialPress' events (single press case)

### 1.13.8. Sequence of events for MultiPress

Multi-press detection is a feature of momentary switches (indicated with feature flag MSM being set, with optional AS feature flag set) that they can count and report sequences of press-release cycles within a certain time frame, for example to indicate that the user has pressed the switch once, twice or three (or even more) times in succession. The definition of the time window for this detection is manufacturer-specific since it depends on the switch physics. The maximum number of presses which can be detected and reported SHALL be indicated in attribute MultiPressMax. The minimum value and default value for MultiPressMax are both 2.

A switch supporting MultiPress SHALL set feature flags MS & MSM, and MAY optionally, according to conformance rules of each flag, set flags MSL, MSR, and AS.

The ActionSwitch (AS) feature flag is a behavior selector which, when set, reduces the number of events generated by the switch.

A press cycle when MSM is set is **either** a long-press cycle (if MSL set), **or** a multi-press cycle.

- If the MSL feature flag is set and the cycle is deemed "long" during the first press cycle after InitialPress, then the switch SHALL react as described in [Section 1.13.7.1, "Switches with long-press detection support \(MSL feature flag set\)"](#), and SHALL NOT consider this to be the start of a multi-press sequence (see penultimate case illustrated in [Figure 7, "Switch device with MSM and AS feature flags \(multi-press case\)"](#)).
- If the MSL feature flag is not set or if the first button press cycle is short, then the switch SHALL count presses until the switch becomes sufficiently idle, and SHALL NOT generate LongPress and LongRelease events for intermediate presses within the multi-press cycle that are "long".

Page 124







### 1.13.8.1. Multi-press behavior when ActionsSwitch (AS) feature flag is not set

A switch with the MSM feature flag set but the AS flag unset:

- SHALL generate an InitialPress event at the start of every button press within a button multi-press cycle;
- SHALL generate a ShortRelease event at the end of every button press within a button multi-press cycle if MSR is set;
- SHALL generate a MultiPressOngoing event after the InitialPress event of the second and subsequent presses of a button multi-press cycle;
- SHALL generate a MultiPressComplete at the end of a multi-press cycle, including single presses;
- SHALL NOT (for cluster revision  $\ge 2$ ) or SHOULD NOT (for cluster revision  $< 2$ ) generate any LongPress and LongRelease events within the multi-press cycle.

The MultiPressOngoing event is provided for parties interested in keeping track of the actual presses during the multi-press sequence. The MultiPressComplete event is provided for parties interested in the outcome of the whole sequence: after the multi-press sequence has ended, they will receive the MultiPressComplete event indicating how many times the switch was pressed.

In the figure below, several sequences of user interaction are indicated:

- Single press sequence: after the press and release moments, the InitialPress SHALL be generated, and ShortRelease events SHALL be generated if the MSR feature flag is set. After some further time, when the switch has detected that there is no second press, it SHALL generate MultiPressComplete(1) since it has detected that the sequence consisted of one press. No MultiPressOngoing event SHALL be generated for this case.
- Double press sequence: after each of the press and release moments, the InitialPress SHALL be generated, and ShortRelease events SHALL be generated if the MSR feature flag is set. Additionally, when the switch is pressed for the second time, the MultiPressOngoing(2) event SHALL be generated, as the switch has detected the second press. Note that this event coincides with the second InitialPress event; both SHALL be generated. After some further time, when the switch has detected that there is no third press, it SHALL generate MultiPressComplete(2) since it has detected that the sequence consisted of two presses.
- Triple press sequence: after each press and release moments, the InitialPress SHALL be generated, and ShortRelease events SHALL be generated if the MSR feature flag is set. Additionally, when the switch is pressed for the second time, the MultiPressOngoing(2) event SHALL be generated, as the switch has detected the second press. Note that this event coincides with the second InitialPress event; both SHALL be generated. Additionally, when the switch is pressed for the third time, the MultiPressOngoing(3) event SHALL be generated, as the switch has detected the third press. Note that this event coincides with the third InitialPress event; both SHALL be generated. After some further time, when the switch has detected that there is no fourth press, it SHALL generate MultiPressComplete(3) since it has detected that the sequence consisted of three presses.
  - This case specifically does NOT generate LongPress and LongRelease events within the sequence (even though the figure below illustrates a longer press duration for the second




Page 125



press in one of the cases), since multi-press sequences SHOULD/SHALL NOT generate LongPress and LongRelease events within the sequence (see [LongPress](#) for more details).

- N presses starting with a long press (if MSL feature flag is set): this starts with a long press sequence which SHALL be considered according to [Section 1.13.7.1, “Switches with long-press detection support \(MSL feature flag set\)”](#). Then it is a sequence similar to triple press, with N presses instead of 3.

For the above cases where multiple events need to be generated at the same time, the MultiPressOngoing event SHALL be generated directly after the InitialPress event.

|             |                                                                                                                                                                                                                                                                                 |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | The numbers in parentheses in the bulleted text above and in the figure below indicate the value of the CurrentNumberOfPressesCounted resp. TotalNumberOfPressesCounted field in the event data.                                                                                |
| <b>NOTE</b> | As with the other figures, sufficient debounce time needs to be taken into account for the detection of press and release events. This is included in the figure, and has been left out of the description above for readability, but SHALL be applied.                         |
| <b>NOTE</b> | Several of the events require very low congestion and latency in the final system to be usable for real-time control and use cases. Care must be taken during design not to rely on very low latency and real-time event timestamps if the low-latency assumptions do not hold. |

![Figure 6: Switch device with MSM and !AS feature flags (multi-press case). The diagram shows four scenarios: Single press, Double press, Triple press with long press not at the start (MSL), and Long press followed by N-press (MSL). Each scenario shows a timeline of button presses and the corresponding events generated: InitialPress, ShortRelease (if MSR), MultiPressOngoing, and MultiPressComplete. A note indicates the absence of LongPress and LongRelease events when not at the start of a multi-press sequence.](4a448e802f242603ce81c8a19c52e8ce_img.jpg)

The diagram illustrates the sequence of events for a switch device under different multi-press conditions, considering the MSM and !AS feature flags. It shows four scenarios:

- Single press:** A single press event is detected, followed by an InitialPress event (labeled ①). If the MSR (Multi-Press Release) feature is set, a ShortRelease event follows. Finally, a MultiPressComplete(1) event is generated.
- Double press:** Two consecutive press events are detected. The first press generates an InitialPress event (labeled ①). The second press generates a MultiPressOngoing(2) event (labeled ②). If MSR is set, a ShortRelease event follows. Finally, a MultiPressComplete(2) event is generated.
- Triple press with long press not at the start (MSL):** Three consecutive press events are detected. The first press generates an InitialPress event (labeled ①). The second press generates a MultiPressOngoing(2) event (labeled ②). The third press generates a MultiPressOngoing(3) event (labeled ③). If MSR is set, a ShortRelease event follows. Finally, a MultiPressComplete(3) event is generated.
- Long press followed by N-press (MSL):** A long press event is detected, followed by N consecutive press events. The long press generates an InitialPress event. The first press event generates a MultiPressOngoing(1) event (labeled ①). Subsequent press events generate MultiPressOngoing events up to MultiPressOngoing(N) (labeled N). If MSR is set, a ShortRelease event follows. Finally, a MultiPressComplete(N) event is generated.

A note indicates: "Note absence of LongPress and LongRelease in when not at start of a multi-press sequence".

Figure 6: Switch device with MSM and !AS feature flags (multi-press case). The diagram shows four scenarios: Single press, Double press, Triple press with long press not at the start (MSL), and Long press followed by N-press (MSL). Each scenario shows a timeline of button presses and the corresponding events generated: InitialPress, ShortRelease (if MSR), MultiPressOngoing, and MultiPressComplete. A note indicates the absence of LongPress and LongRelease events when not at the start of a multi-press sequence.

Figure 6. Switch device with MSM and !AS feature flags (multi-press case)

### 1.13.8.2. Multi-press behavior when ActionsSwitch (AS) feature flag is set

When the ActionSwitch feature flag is set, the behavior for all presses:

Page 126







- The switch SHALL only generate an InitialPress event at the start of every button press cycle (whether long or not);
- The switch SHALL NOT generate ShortRelease events;
- The switch SHALL NOT generate MultiPressOngoing events.

Because of these simplifications, clients can decide to act purely on the following to determine user action:

- LongRelease (if MSL feature flag is set) to determine the end of a long press.
  - InitialPress and LongPress (if MSL feature flag is set), if needed, to detect the start of the press and long-press periods so that actions such as "do action X while long pressed and stop on release" can be supported.
- MultiPressComplete to determine the end of a series of presses (0 .. MultiPressMax)
  - Only the final count of presses detected by the switch is provided.
  - The value of 0 indicates an aborted press (e.g. maybe too many presses in a row, button held down for too long, etc).
  - The value of 1 indicates a single press, 2 a double-press, etc.

Because of the omission of ShortRelease, MultiPressOngoing and the "inner" InitialPress events, less network traffic is generated, while not missing the overall "action" intent from the end-user.

In the figure below, several sequences of user interaction are indicated:

- Single press sequence: after the initial press detection, the InitialPress event is generated. After some further time, when the switch has detected that there is no second press, and the press is not a long press (if MSL feature flag is set), it generates the MultiPressComplete(1) event since it has detected that the sequence consisted of one press.
- Double press sequence: after the initial press detection, the InitialPress event is generated. After some further time, when the switch has detected that there is no third press, it generates the MultiPressComplete(2) event since it has detected that the sequence consisted of two presses.
- N-press sequence: after the initial press detection, the InitialPress event is generated. Additionally, when the switch is pressed for the second time, we note that the press is long, but there is not a LongPress or LongRelease event, since long presses inside (not at the start) of a multi-press sequence are treated as short presses. After some further time, when the switch has detected that there are no further presses beyond N presses, it generates a MultiPressComplete(N) event since it has detected that the sequence consisted of N presses.
- Long press sequence followed by N-press sequence:
  - This case contains two separate sequences, since a long press sequence is always an independent sequence, and does not get reported as "long" within multi-presses (see previous example case).
  - The first sequence is a Long Press sequence of: InitialPress, LongPress, and finally, LongRelease.
  - The second sequence, whether immediate or not, is a N-press sequence of: InitialPress, and finally, MultiPressComplete(N).



Page 127



- N-press sequence with  $N > \text{MultiPressMax}$ : after the initial press detection, the InitialPress event is generated. After some further time, when the switch has detected that there are no further presses beyond N presses, it generates a MultiPressComplete(0) event since it has detected that the multi-press sequence is done, but since there were more presses than MultiPressMax, the sequence uses 0 for TotalNumberOfPressesCounted to indicate invalid complete sequence.

![Figure 7: Switch device with MSM and AS feature flags (multi-press case). The diagram illustrates various switch press scenarios and the corresponding events generated. It includes: Single press (InitialPress, →1 action, →2 events); Double press (InitialPress, MultiPressComplete(1), MultiPressComplete(2), →1 action, →2 events); N-press with long in the middle (InitialPress, MultiPressComplete(N), →1 action, →2 events); Long-press followed by N-press (MSL) (InitialPress, LongPress, LongRelease, MultiPressComplete(N), →2 actions, →2 sequences of events, →5 events (3 + 2)); and Too many presses (> MultiPressMax) (InitialPress, MultiPressComplete(0) because N > MultiPressMax, →1 action, →2 events). A callout box notes: 'Long press is always independent at start, never considered within N-press.' and 'All N-presses emit a single InitialPress and MultiPressComplete pair.'](92724c769da9d46b730fde1a6dccb023_img.jpg)

Figure 7: Switch device with MSM and AS feature flags (multi-press case). The diagram illustrates various switch press scenarios and the corresponding events generated. It includes: Single press (InitialPress, →1 action, →2 events); Double press (InitialPress, MultiPressComplete(1), MultiPressComplete(2), →1 action, →2 events); N-press with long in the middle (InitialPress, MultiPressComplete(N), →1 action, →2 events); Long-press followed by N-press (MSL) (InitialPress, LongPress, LongRelease, MultiPressComplete(N), →2 actions, →2 sequences of events, →5 events (3 + 2)); and Too many presses (> MultiPressMax) (InitialPress, MultiPressComplete(0) because N > MultiPressMax, →1 action, →2 events). A callout box notes: 'Long press is always independent at start, never considered within N-press.' and 'All N-presses emit a single InitialPress and MultiPressComplete pair.'

Figure 7. Switch device with MSM and AS feature flags (multi-press case)

### 1.13.9. Summary of cases for MS feature flag

Given the variety of situations that may arise due to the different switch capabilities, the following describes the edges that would unambiguously convey user action intents:

- MS & !MSR & !MSM: Every action cycle is only a single InitialPress event.
- MS & !MSM: Every action cycle ends on ShortRelease or LongRelease (if MSL feature flag is set), depending on long or short press and whether MSR/MSL feature flags are set.
- MS & MSM: Every action cycle ends on either LongRelease (if MSL feature flag is set and first press was long) or MultiPressComplete.
  - The AS feature flag does not change the outcome of which events can be used for action detection.
  - The AS feature flag is backwards-compatible with previous revisions of this cluster.
  - The AS feature flag primarily offers a reduction of events generated.

The above list is relevant for the case of a client which does not use the events indicating progress during the action cycle (i.e. ShortRelease, MultiPressOngoing, repeated InitialPress) for its operation.

Page 128






## 1.13.10. Multi Position Details

This section will discuss some archetypes of switch devices with more than 2 positions and how they SHALL set attribute values and generate events matching their characteristics.

For the SwitchLatched, InitialPress, LongPress and MultiPressOngoing events, the field NewPosition SHALL be set to the value corresponding to the new position to which the switch was moved. For the ShortRelease, LongRelease and MultiPressComplete events, the field PreviousPosition SHALL be set to the value corresponding to the position of the switch just preceding the (latest) release.

### 1.13.10.1. Latching Switch with N stable positions ( $N > 2$ ) with fixed sequence

With such a device, the user can move the switch from a position M to positions M-1 and M+1 (either with a wraparound between the end positions, or fixed stop at the end positions).

On each interaction with the switch device, it SHALL generate a SwitchLatched event with the NewPosition field set to the value associated with the new position.

Due to the physical constraints, such an event will have a NewPosition field which is equal to the previous NewPosition field plus or minus 1 (modulo NumPositions if the switch does not have end stops).

In a first example, a switch has 3 positions, associated with values 0, 1 and 2. In this case, wrap-around is not possible: from position 0 it can only be moved to position 1.

![Figure 8: Rotary switch device with 3 positions. The figure shows three diagrams of a rotary switch in different positions. Each diagram shows a switch handle with three positions labeled A, B, and C. In the first diagram, the handle is in position A, and the text below it says 'pos A => report 0'. In the second diagram, the handle is in position B, and the text below it says 'pos B => report 1'. In the third diagram, the handle is in position C, and the text below it says 'pos C => report 2'.](dc97dfb92635e1cf022faf0457f9c56b_img.jpg)

Figure 8: Rotary switch device with 3 positions. The figure shows three diagrams of a rotary switch in different positions. Each diagram shows a switch handle with three positions labeled A, B, and C. In the first diagram, the handle is in position A, and the text below it says 'pos A => report 0'. In the second diagram, the handle is in position B, and the text below it says 'pos B => report 1'. In the third diagram, the handle is in position C, and the text below it says 'pos C => report 2'.

Figure 8. Rotary switch device with 3 positions

In another example, a switch has 8 positions, associated with values 0 through 7. In this case, the physics of the switch allow wraparound: from position 0 it can be moved to position 1 or to position 7.



Page 129



![Figure 9: A rotary switch device with 8 positions and wraparound. The switch is circular with 8 positions labeled 0 through 7 around the perimeter. A black pointer is currently pointing towards position 0. The positions are arranged clockwise starting from the top: 0, 1, 2, 3, 4, 5, 6, 7.](0b8b3bfc048feb76864f1845ea8db92e_img.jpg)

Figure 9: A rotary switch device with 8 positions and wraparound. The switch is circular with 8 positions labeled 0 through 7 around the perimeter. A black pointer is currently pointing towards position 0. The positions are arranged clockwise starting from the top: 0, 1, 2, 3, 4, 5, 6, 7.

Figure 9. Rotary switch device with 8 positions and wraparound

### 1.13.10.2. Latching Switch with N stable positions ( $N > 2$ ) with random sequence (example: radio buttons)

With such a device, the user can press any of the available buttons, so this switch does not show the incrementing or decrementing behavior of `NewPosition` which we discussed for the latching switch with fixed sequence. In the example in the figure below, the 5 buttons are labeled "A" through "E" for the user and are associated with values 0 through 4. The user first presses the "A" button, and the switch device generates a `SwitchLatched` event with `NewPosition` set to 0. Then the user first presses the "D" button, and the switch device generates a `SwitchLatched` event with `NewPosition` set to 4.

![Figure 10, left: A switch device with 5 radio buttons labeled A, B, C, D, and E. The button labeled 'A' is currently pressed, indicated by a small white rectangle above it.](453397f2f19d6550d34ab27a2b6ef2e0_img.jpg)

Figure 10, left: A switch device with 5 radio buttons labeled A, B, C, D, and E. The button labeled 'A' is currently pressed, indicated by a small white rectangle above it.

button A pressed => report 0

![Figure 10, right: A switch device with 5 radio buttons labeled A, B, C, D, and E. The button labeled 'D' is currently pressed, indicated by a small white rectangle above it.](26a01fb10c99d8c95d291f1f0ce81d3e_img.jpg)

Figure 10, right: A switch device with 5 radio buttons labeled A, B, C, D, and E. The button labeled 'D' is currently pressed, indicated by a small white rectangle above it.

button D pressed => report 4

Figure 10. Switch device with radio buttons

### 1.13.10.3. Momentary Switch with 2 or more non-stable positions

For a Momentary Switch with more than 1 stable position, it depends on the physics of the switch device which sequence of events will be generated.

#### NOTE

In this section we will mention only the `InitialPress` and `ShortRelease` events. The switch device could also generate the other events defined above for a momentary switch, depending on the capabilities of the switch device and the interaction with the switch device.

The first variant (figure below, example: up/down control for window blinds) shows a switch in neutral position (left figure) which corresponds to `CurrentPosition=0`. The user can press the top

Page 130







side (position value 1) or the bottom side (position value 2). It is not possible to go directly from position 1 to position 2 or vice versa - the switch will always need to go through the neutral position 0.

So when the user presses the top side of the switch, the InitialPress (NewPosition=1) event will be generated. When they release the top side, the ShortRelease (PreviousPosition=1) event will be generated. The user continues to press the bottom side, and the event InitialPress (NewPosition=2) is generated. Upon release of the bottom side, the event ShortRelease (PreviousPosition=2) is generated.

![Figure 11: Up/down control switch device. Three diagrams showing the switch in neutral position (0), top side pressed (1), and bottom side pressed (2).](7e18e0709e8d00856a51db1a29110668_img.jpg)

The figure shows three vertical switch components. The first is labeled 'neutral position (0)' and shows a central handle. The second is labeled 'top side pressed (1)' and shows the handle tilted upwards. The third is labeled 'bottom side pressed (2)' and shows the handle tilted downwards.

Figure 11: Up/down control switch device. Three diagrams showing the switch in neutral position (0), top side pressed (1), and bottom side pressed (2).

*Figure 11. Up/down control switch device*

Another variant (figure below, example: joystick) has a control handle with a neutral position in the middle (left figure) which corresponds to CurrentPosition=0. The handle can be moved along the dotted lines.

In the middle figure, the user moves the handle to the East position and then releases it (which makes it return to the neutral middle position). This generates this sequence of events:

```
InitialPress (NewPosition=3)    // move to East
ShortRelease (PreviousPosition=3) // back to middle (from East)
```

In the righthand figure, the user moves the handle to the SouthWest position, then to the South position and then releases it (which makes it return to the neutral middle position). This generates this sequence of events:

```
InitialPress (NewPosition=6)    // move to SouthWest
InitialPress (NewPosition=5)    // move to South
ShortRelease (PreviousPosition=5) // back to middle (from South)
```



Page 131



![Figure 12: Switch device with joystick. Three diagrams showing a 3x3 grid of points (0-8) with a joystick in the center (0). (i) no interaction, stick in middle position. (ii) move to East and release (to middle). (iii) move to SouthWest, then to South, then release (to middle position).](0ebeca0b008c7e7d4a5b5e90d2483e8c_img.jpg)

Figure 12 illustrates the switch device with joystick interaction. It shows three states of a 3x3 grid of points (0-8) with a joystick in the center (0).  
 (i) no interaction, stick in middle position: The joystick is centered at point 0.  
 (ii) move to East and release (to middle): The joystick moves from point 0 to point 3 (East) and then returns to point 0.  
 (iii) move to SouthWest, then to South, then release (to middle position): The joystick moves from point 0 to point 6 (SouthWest), then to point 5 (South), and then returns to point 0.

Figure 12: Switch device with joystick. Three diagrams showing a 3x3 grid of points (0-8) with a joystick in the center (0). (i) no interaction, stick in middle position. (ii) move to East and release (to middle). (iii) move to SouthWest, then to South, then release (to middle position).

Figure 12. Switch device with joystick

Therefore, in the "joystick" variation, there could be a succession of InitialPress events without an intermediate ShortRelease events - unlike the "window blinds control" variation which will always have such an intermediate ShortRelease event.

## 1.14. Operational State Cluster

This cluster supports remotely monitoring and, where supported, changing the operational state of any device where a state machine is a part of the operation.

This cluster defines common states, scoped to this cluster (e.g. Stopped, Running, Paused, Error). A derived cluster specification may define more states scoped to the derivation. Manufacturer specific states are supported in this cluster and any derived clusters thereof. When defined in a derived instance, such states are scoped to the derivation.

Actual state transitions are dependent on both the implementation, and the requirements that may additionally be imposed by a derived cluster.

An implementation that supports remotely starting its operation can make use of this cluster's Start command to do so. A device that supports remote pause or stop of its currently selected operation can similarly make use of this cluster's Pause and Stop commands to do so. The ability to remotely pause or stop is independent of how the operation was started (for example, an operation started by using a manual button press can be stopped by using a Stop command if the device supports remotely stopping the operation).

Additionally, this cluster provides events for monitoring the operational state of the device.

### 1.14.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

Page 132



| Revision | Description                                                                                                          |
|----------|----------------------------------------------------------------------------------------------------------------------|
| 2        | The Pause and Resume commands are usable in all compatible states. Define reserved ranges for base/derived clusters. |
| 3        | Changed CountdownTime attribute to Q quality.                                                                        |

### 1.14.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | OPSTATE   |

### 1.14.3. Cluster ID

| ID     | Name              |
|--------|-------------------|
| 0x0060 | Operational State |

### 1.14.4. Data Types

#### 1.14.4.1. OperationalStateEnum Type

This type defines the set of known operational state values, and is derived from enum8. The following table defines the applicable ranges for values that are defined within this type. All values that are undefined SHALL be treated as reserved. As shown by the table, states that may be specific to a certain Device Type or other modality SHALL be defined in a derived cluster of this cluster.

| Value        | Name                        | Summary                                               |
|--------------|-----------------------------|-------------------------------------------------------|
| 0x00 to 0x3F | <b>GeneralStates</b>        | Generally applicable values for state, defined herein |
| 0x40 to 0x7F | <b>DerivedClusterStates</b> | Derived Cluster defined states                        |
| 0x80 to 0xBF | <b>ManufacturerStates</b>   | Vendor specific states                                |

The derived cluster-specific state definitions SHALL NOT duplicate any general state definitions. That is, a derived cluster specification of this cluster cannot define states with the same semantics as the general states defined below.

A manufacturer-specific state definition SHALL NOT duplicate the general state definitions or derived cluster state definitions. That is, a manufacturer-defined state defined for this cluster or a derived cluster thereof cannot define a state with the same semantics as the general states defined below or states defined in a derived cluster. Such manufacturer-specific state definitions SHALL be scoped in the context of the Vendor ID present in the Basic Information cluster.

The following table defines the generally applicable states.




Page 133



| Value | Name           | Summary                                  | Conformance |
|-------|----------------|------------------------------------------|-------------|
| 0x00  | <b>Stopped</b> | The device is stopped                    | M           |
| 0x01  | <b>Running</b> | The device is operating                  | M           |
| 0x02  | <b>Paused</b>  | The device is paused during an operation | M           |
| 0x03  | <b>Error</b>   | The device is in an error state          | M           |

#### 1.14.4.2. OperationalStateStruct Type

The OperationalStateStruct is used to indicate a possible state of the device.

| ID | Name                         | Type                 | Constraint | Quality | Fallback | Conformance                                                   |
|----|------------------------------|----------------------|------------|---------|----------|---------------------------------------------------------------|
| 0  | <b>OperationalStateID</b>    | OperationalStateEnum | all        |         | 0        | M                                                             |
| 1  | <b>OperationalStateLabel</b> | string               | max 64     |         |          | OperationalStateID >=<br>0x80 & OperationalStateID <=<br>0xBF |

##### 1.14.4.2.1. OperationalStateID Field

This SHALL be populated with a value from the [OperationalStateEnum](#).

##### 1.14.4.2.2. OperationalStateLabel Field

This field is present when the OperationalStateID is from the set reserved for Manufacturer Specific States. If present, this SHALL contain a human-readable description of the operational state.

#### 1.14.4.3. ErrorStateEnum Type

This type defines the set of known operational error values, and is derived from enum8. The following table defines the applicable ranges for values that are defined within this type. All values that are undefined SHALL be treated as reserved. As shown by the table, errors that may be specific to a certain Device Type or other modality SHALL be defined in a derived cluster of this cluster.

| Value        | Name                        | Summary                                               |
|--------------|-----------------------------|-------------------------------------------------------|
| 0x00 to 0x3F | <b>GeneralErrors</b>        | Generally applicable values for error, defined herein |
| 0x40 to 0x7F | <b>DerivedClusterErrors</b> | Derived Cluster defined errors                        |
| 0x80 to 0xBF | <b>ManufacturerError</b>    | Vendor specific errors                                |

Page 134



The derived cluster-specific error definitions SHALL NOT duplicate the general error definitions. That is, a derived cluster specification of this cluster cannot define errors with the same semantics as the general errors defined below.

The manufacturer-specific error definitions SHALL NOT duplicate the general error definitions or derived cluster-specific error definitions. That is, a manufacturer-defined error defined for this cluster or a derived cluster thereof cannot define errors with the same semantics as the general errors defined below or errors defined in a derived cluster. Such manufacturer-specific error definitions SHALL be scoped in the context of the Vendor ID present in the Basic Information cluster.

The set of ErrorStateID field values defined in each of the generic or derived Operational State cluster specifications is called ErrorState.

#### 1.14.4.3.1. ErrorStateEnum GeneralErrors Range

The following table defines the generally applicable ErrorState values.

| Value | Name                      | Summary                                                    | Conformance |
|-------|---------------------------|------------------------------------------------------------|-------------|
| 0x00  | NoError                   | The device is not in an error state                        | M           |
| 0x01  | UnableToStartOrResume     | The device is unable to start or resume operation          | M           |
| 0x02  | UnableToCompleteOperation | The device was unable to complete the current operation    | M           |
| 0x03  | CommandInvalidInState     | The device cannot process the command in its current state | M           |

#### 1.14.4.4. ErrorStateStruct Type

| ID | Name              | Type           | Constraint | Quality | Fallback | Conformance                                          |
|----|-------------------|----------------|------------|---------|----------|------------------------------------------------------|
| 0  | ErrorStateID      | ErrorStateEnum | all        |         | 0        | M                                                    |
| 1  | ErrorStateLabel   | string         | max 64     |         | empty    | ErrorStateID<br>>= 0x80 &<br>ErrorStateID<br><= 0xBF |
| 2  | ErrorStateDetails | string         | max 64     |         | empty    | O                                                    |

##### 1.14.4.4.1. ErrorStateID Field

This SHALL be populated with a value from the [ErrorStateEnum](#).



Page 135



#### 1.14.4.4.2. ErrorStateLabel Field

This field is present when the ErrorStateID is from the set reserved for Manufacturer Specific errors. If present, this SHALL contain a human-readable description of the error state.

#### 1.14.4.4.3. ErrorStateDetails Field

This SHALL be a human-readable string that provides details about the error condition. As an example, if the ErrorStateID indicates that the device is a Robotic Vacuum that is stuck, the ErrorStateDetails contains "left wheel blocked".

### 1.14.5. Attributes

| ID     | Name                         | Type                         | Constraint     | Quality | Fallback | Access | Conformance |
|--------|------------------------------|------------------------------|----------------|---------|----------|--------|-------------|
| 0x0000 | <b>PhaseList</b>             | list[string]                 | max 32[max 64] | X       | MS       | R V    | M           |
| 0x0001 | <b>Current-Phase</b>         | uint8                        | desc           | X       | MS       | R V    | M           |
| 0x0002 | <b>Count-downTime</b>        | elapsed-s                    | max 259200     | Q X     | null     | R V    | O           |
| 0x0003 | <b>Operational-StateList</b> | list[OperationalStateStruct] | desc           |         | MS       | R V    | M           |
| 0x0004 | <b>Operational-State</b>     | OperationalStateEnum         | all            |         |          | R V    | M           |
| 0x0005 | <b>OperationalError</b>      | ErrorStateStruct             | desc           |         |          | R V    | M           |

#### 1.14.5.1. PhaseList Attribute

This attribute SHALL indicate a list of names of different phases that the device can go through for the selected function or mode. The list may not be in sequence order. For example in a washing machine this could include items such as "pre-soak", "rinse", and "spin". These phases are manufacturer specific and may change when a different function or mode is selected.

A null value indicates that the device does not present phases during its operation. When this attribute's value is null, the CurrentPhase attribute SHALL also be set to null.

#### 1.14.5.2. CurrentPhase Attribute

This attribute represents the current phase of operation being performed by the server. This SHALL be the positional index representing the value from the set provided in the PhaseList Attribute, where the first item in that list is an index of 0. Thus, this attribute SHALL have a maximum value that is "length(PhaseList) - 1".

Page 136



This attribute SHALL be null if the PhaseList attribute is null or if the PhaseList attribute is an empty list.

#### 1.14.5.3. CountdownTime Attribute

This attribute SHALL represent the estimated time left before the operation is completed, in seconds.

A value of 0 (zero) means that the operation has completed.

A value of null represents that there is no time currently defined until operation completion. This MAY happen, for example, because no operation is in progress or because the completion time is unknown.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- If it has changed due to a change in the CurrentPhase or OperationalState attributes, or
- When it changes from 0 to any other value and vice versa, or
- When it changes from null to any other value and vice versa, or
- When it increases, or
- When there is any increase or decrease in the estimated time remaining that was due to progressing insight of the server's control logic, or
- When it changes at a rate significantly different from one unit per second.

Changes to this attribute merely due to the normal passage of time with no other dynamic change of device state SHALL NOT be reported.

As this attribute is not being reported during a regular countdown, clients SHOULD NOT rely on the reporting of this attribute in order to keep track of the remaining duration.

#### 1.14.5.4. OperationalStateList Attribute

This attribute describes the set of possible operational states that the device exposes. An operational state is a fundamental device state such as Running or Error. Details of the phase of a device when, for example, in a state of Running are provided by the CurrentPhase attribute.

All devices SHALL, at a minimum, expose the set of states matching the commands that are also supported by the cluster instance, in addition to Error. The set of possible device states are defined in the [OperationalStateEnum](#). A device type requiring implementation of this cluster SHALL define the set of states that are applicable to that specific device type.

#### 1.14.5.5. OperationalState Attribute

This attribute specifies the current operational state of a device. This SHALL be populated with a valid OperationalStateID from the set of values in the OperationalStateList Attribute.

#### 1.14.5.6. OperationalError Attribute

This attribute SHALL specify the details of any current error condition being experienced on the




Page 137



device when the OperationalState attribute is populated with Error. See [Section 1.14.4.4, “ErrorStateStruct Type”](#) for general requirements on the population of this attribute.

When there is no error detected, this SHALL have an ErrorStateID of NoError.

## 1.14.6. Commands

| ID   | Name                              | Direction                   | Response                   | Access | Conformance                   |
|------|-----------------------------------|-----------------------------|----------------------------|--------|-------------------------------|
| 0x00 | <b>Pause</b>                      | client $\Rightarrow$ server | OperationalCommandResponse | O      | Resume, O                     |
| 0x01 | <b>Stop</b>                       | client $\Rightarrow$ server | OperationalCommandResponse | O      | Start, O                      |
| 0x02 | <b>Start</b>                      | client $\Rightarrow$ server | OperationalCommandResponse | O      | O                             |
| 0x03 | <b>Resume</b>                     | client $\Rightarrow$ server | OperationalCommandResponse | O      | Pause, O                      |
| 0x04 | <b>OperationalCommandResponse</b> | client $\Leftarrow$ server  | N                          | O      | Pause   Stop   Start   Resume |

Note that it is entirely possible due to regulatory or other reasons for an instance of this cluster to expose no possible commands. When that occurs, this cluster does not provide any ability to actuate the device, instead it provides readable (and by extension, can be subscribed to) information as to the state of the device only. The commands that are supported SHALL be exposed by the device in the AcceptedCommandList global attribute.

### 1.14.6.1. Pause Command

This command SHALL be supported if the device supports remotely pausing the operation. If this command is supported, the Resume command SHALL also be supported.

On receipt of this command, the device SHALL pause its operation if it is possible based on the current function of the server. For example, if it is at a point where it is safe to do so and/or permitted, but can be restarted from the point at which pause occurred.

If this command is received when already in the Paused state the device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of NoError but take no further action.

A device that receives this command in any state which is not Pause-compatible SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of CommandInvalidInState and SHALL take no further action.

Page 138







States are defined as Pause-compatible as follows:

- For states defined in this cluster specification, in [Table 3, “Pause Compatibility”](#).
- For states defined by derived cluster specifications, in the corresponding specifications.
- For manufacturer-specific states, by the manufacturer.

A device that is unable to honor the Pause command for whatever reason SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of CommandInvalidInState but take no further action.

Otherwise, on success:

- The OperationalState attribute SHALL be set to Paused.
- The device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of NoError.

The following table defines the compatibility of this cluster’s states with the Pause command.

*Table 3. Pause Compatibility*

| State Value | State Name | Pause-Compatible |
|-------------|------------|------------------|
| 0x00        | Stopped    | N                |
| 0x01        | Running    | Y                |
| 0x02        | Paused     | Y                |
| 0x03        | Error      | N                |

#### 1.14.6.2. Stop Command

This command SHALL be supported if the device supports remotely stopping the operation.

On receipt of this command, the device SHALL stop its operation if it is at a position where it is safe to do so and/or permitted. Restart of the device following the receipt of the Stop command SHALL require attended operation unless remote start is allowed by the device type and any jurisdiction governing remote operation of the device.

If this command is received when already in the Stopped state the device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of NoError but take no further action.

A device that is unable to honor the Stop command for whatever reason SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of CommandInvalidInState but take no further action.

Otherwise, on success:

- The OperationalState attribute SHALL be set to Stopped.
- The device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of NoError.



Page 139



### 1.14.6.3. Start Command

This command SHALL be supported if the device supports remotely starting the operation. If this command is supported, the 'Stop command SHALL also be supported.

On receipt of this command, the device SHALL start its operation if it is safe to do so and the device is in an operational state from which it can be started. There may be either regulatory or manufacturer-imposed safety and security requirements that first necessitate some specific action at the device before a Start command can be honored. In such instances, a device SHALL respond with a status code of `CommandInvalidInState` if a Start command is received prior to the required on-device action.

If this command is received when already in the Running state the device SHALL respond with an `OperationalCommandResponse` command with an `ErrorStateID` of `NoError` but take no further action.

A device that is unable to honor the Start command for whatever reason SHALL respond with an `OperationalCommandResponse` command with an `ErrorStateID` of `UnableToStartOrResume` but take no further action.

Otherwise, on success:

- The `OperationalState` attribute SHALL be set to `Running`.
- The device SHALL respond with an `OperationalCommandResponse` command with an `ErrorStateID` of `NoError`.

### 1.14.6.4. Resume Command

This command SHALL be supported if the device supports remotely resuming the operation. If this command is supported, the Pause command SHALL also be supported.

On receipt of this command, the device SHALL resume its operation from the point it was at when it received the Pause command, or from the point when it was paused by means outside of this cluster (for example by manual button press).

If this command is received when already in the Running state the device SHALL respond with an `OperationalCommandResponse` command with an `ErrorStateID` of `NoError` but take no further action.

A device that receives this command in any state which is not Resume-compatible SHALL respond with an `OperationalCommandResponse` command with an `ErrorStateID` of `CommandInvalidInState` and SHALL take no further action.

States are defined as Resume-compatible as follows:

- For states defined in this cluster specification, in [Table 4, “Resume Compatibility”](#).
- For states defined by derived cluster specifications, in the corresponding specifications.
- For manufacturer-specific states, by the manufacturer.

The following table defines the compatibility of this cluster's states with the Resume command.

Page 140







*Table 4. Resume Compatibility*

| State Value | State Name | Resume-Compatible |
|-------------|------------|-------------------|
| 0x00        | Stopped    | N                 |
| 0x01        | Running    | Y                 |
| 0x02        | Paused     | Y                 |
| 0x03        | Error      | N                 |

A device that is unable to honor the Resume command for any other reason SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of UnableToStartOrResume but take no further action.

Otherwise, on success:

- The OperationalState attribute SHALL be set to the most recent non-Error operational state prior to entering the Paused state.
- The device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of NoError.

#### 1.14.6.5. OperationalCommandResponse Command

This command SHALL be supported by an implementation if any of the other commands defined by this cluster are supported (i.e. listed in the AcceptedCommandList global attribute). This command SHALL also be supported by an implementation of a derived cluster as a response to any commands that MAY be additionally defined therein.

This command SHALL be generated in response to any of the Start, Stop, Pause, or Resume commands. The data for this command SHALL be as follows:

| ID   | Name                 | Type             | Constraint | Quality | Fallback | Conformance |
|------|----------------------|------------------|------------|---------|----------|-------------|
| 0x00 | CommandResponseState | ErrorStateStruct | all        |         |          | M           |

##### 1.14.6.5.1. CommandResponseState Field

This SHALL indicate the success or otherwise of the attempted command invocation. On a successful invocation of the attempted command, the ErrorStateID SHALL be populated with NoError. See the individual command sections for additional specific requirements on population.

#### 1.14.7. Events

| ID   | Name             | Priority | Access | Conformance |
|------|------------------|----------|--------|-------------|
| 0x00 | OperationalError | CRITICAL | V      | M           |



Page 141



| ID   | Name                | Priority | Access | Conformance |
|------|---------------------|----------|--------|-------------|
| 0x01 | OperationCompletion | INFO     | V      | O           |

#### 1.14.7.1. OperationalError Event

This event is generated when a reportable error condition is detected. A device that generates this event SHALL also set the OperationalState attribute to Error, indicating an error condition.

This event SHALL contain the following fields:

| ID | Name       | Type             | Constraint | Quality | Fallback | Conformance |
|----|------------|------------------|------------|---------|----------|-------------|
| 0  | ErrorState | ErrorStateStruct | all        |         |          | M           |

#### 1.14.7.2. OperationCompletion Event

This event SHOULD be generated when the overall operation ends, successfully or otherwise. For example, the completion of a cleaning operation in a Robot Vacuum Cleaner, or the completion of a wash cycle in a Washing Machine.

It is highly RECOMMENDED that appliances device types employing the Operational State cluster support this event, even if it is optional. This assists clients in executing automations or issuing notifications at critical points in the device operation cycles.

This event SHALL contain the following fields:

| ID | Name                 | Type      | Constraint | Quality | Fallback | Conformance |
|----|----------------------|-----------|------------|---------|----------|-------------|
| 0  | CompletionErrorCode  | enum8     | all        |         |          | M           |
| 1  | TotalOperationalTime | elapsed-s | all        | X       |          | O           |
| 2  | PausedTime           | elapsed-s | all        | X       |          | O           |

##### 1.14.7.2.1. CompletionErrorCode Field

This field provides an indication of the state at the end of the operation. This field SHALL have a value from the [ErrorStateEnum](#) set. A value of NoError indicates success, that is, no error has been detected.

##### 1.14.7.2.2. TotalOperationalTime Field

The total operational time, in seconds, from when the operation was started via an initial Start command or autonomous/manual starting action, until the operation completed. This includes any time spent while paused. There may be cases whereby the total operational time exceeds the maximum

Page 142



value that can be conveyed by this attribute, in such instances, this attribute SHALL be populated with null.

#### 1.14.7.2.3. PausedTime Field

The total time spent in the paused state, in seconds. There may be cases whereby the total paused time exceeds the maximum value that can be conveyed by this attribute, in such instances, this attribute SHALL be populated with null.

### 1.15. Alarm Base Cluster

This cluster is a base cluster from which clusters for particular alarms for a device type can be derived. Each derivation SHALL define the values for the AlarmBitmap data type used in this cluster. Each derivation SHALL define which alarms are latched.

#### 1.15.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                           |
|----------|---------------------------------------|
| 1        | Initial revision                      |
| 2        | Changed event field ID's to match SDK |

#### 1.15.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | ALARM     |

#### 1.15.3. Cluster ID

| ID  | Name       |
|-----|------------|
| n/a | Alarm Base |

#### 1.15.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code  | Feature | Summary                              |
|-----|-------|---------|--------------------------------------|
| 0   | RESET | Reset   | Supports the ability to reset alarms |

##### 1.15.4.1. Reset Feature

This feature indicates that alarms can be reset via the Reset command.



Page 143



## 1.15.5. Data Types

### 1.15.5.1. AlarmBitmap Type

This data type SHALL be a map32 with values defined by the derived cluster. The meaning of each bit position SHALL be consistent for all attributes in a derived cluster. That is, if bit 0 is defined for an alarm, the Latch, State, and Supported information for that alarm are also bit 0.

### 1.15.6. Attributes

| ID     | Name             | Type         | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------|--------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Mask</b>      | Alarm-Bitmap | all        |         |          | R V    | M           |
| 0x0001 | <b>Latch</b>     | Alarm-Bitmap | all        | F       |          | R V    | RESET       |
| 0x0002 | <b>State</b>     | Alarm-Bitmap | all        |         |          | R V    | M           |
| 0x0003 | <b>Supported</b> | Alarm-Bitmap | all        | F       |          | R V    | M           |

#### 1.15.6.1. Mask Attribute

This attribute SHALL indicate a bitmap where each bit set in the Mask attribute corresponds to an alarm that SHALL be enabled.

#### 1.15.6.2. Latch Attribute

This attribute SHALL indicate a bitmap where each bit set in the Latch attribute SHALL indicate that the corresponding alarm will be latched when set, and will not reset to inactive when the underlying condition which caused the alarm is no longer present, and so requires an explicit reset using the Reset command.

#### 1.15.6.3. State Attribute

This attribute SHALL indicate a bitmap where each bit SHALL represent the state of an alarm. The value of true means the alarm is active, otherwise the alarm is inactive.

#### 1.15.6.4. Supported Attribute

This attribute SHALL indicate a bitmap where each bit SHALL represent whether or not an alarm is supported. The value of true means the alarm is supported, otherwise the alarm is not supported.

If an alarm is not supported, the corresponding bit in Mask, Latch, and State SHALL be false.

### 1.15.7. Commands

Page 144



| ID   | Name                | Direction                   | Response | Access | Conformance |
|------|---------------------|-----------------------------|----------|--------|-------------|
| 0x00 | Reset               | client $\Rightarrow$ server | Y        | O      | RESET       |
| 0x01 | ModifyEnabledAlarms | client $\Rightarrow$ server | Y        | O      | O           |

### 1.15.7.1. Reset Command

This command resets active and latched alarms (if possible). Any generated Notify event SHALL contain fields that represent the state of the server after the command has been processed.

| ID | Name   | Type         | Constraint | Quality | Fallback | Conformance |
|----|--------|--------------|------------|---------|----------|-------------|
| 0  | Alarms | Alarm-Bitmap | all        |         |          | M           |

#### 1.15.7.1.1. Alarms Field

This field SHALL indicate a bitmap where each bit set in this field corresponds to an alarm that SHALL be reset to inactive in the State attribute unless the alarm definition requires manual intervention. If the alarms indicated are successfully reset, the response status code SHALL be SUCCESS, otherwise, the response status code SHALL be FAILURE.

### 1.15.7.2. ModifyEnabledAlarms Command

This command allows a client to request that an alarm be enabled or suppressed at the server.

| ID | Name | Type         | Constraint | Quality | Fallback | Conformance |
|----|------|--------------|------------|---------|----------|-------------|
| 0  | Mask | Alarm-Bitmap | all        |         |          | M           |

#### 1.15.7.2.1. Mask Field

This field SHALL indicate a bitmap where each bit set in this field corresponds to an alarm that SHOULD be enabled or suppressed. A value of 1 SHALL indicate that the alarm SHOULD be enabled while a value of 0 SHALL indicate that the alarm SHOULD be suppressed.

A server that receives this command with a Mask that includes bits that are set for unknown alarms SHALL respond with a status code of INVALID\_COMMAND.

A server that receives this command with a Mask that includes bits that are set for alarms which are not supported, as indicated in the Supported attribute, SHALL respond with a status code of INVALID\_COMMAND.

A server that is unable to enable a currently suppressed alarm, or is unable to suppress a currently enabled alarm SHALL respond with a status code of FAILURE; otherwise the server SHALL respond with a status code of SUCCESS.



Page 145



On a SUCCESS case, the server SHALL also change the value of the Mask attribute to the value of the Mask field from this command. After that the server SHALL also update the value of its State attribute to reflect the status of the new alarm set as indicated by the new value of the Mask attribute.

### 1.15.8. Events

| ID   | Name   | Priority | Quality | Access | Conformance |
|------|--------|----------|---------|--------|-------------|
| 0x00 | Notify | INFO     |         | V      | M           |

#### 1.15.8.1. Notify Event

This event SHALL be generated when one or more alarms change state.

| ID | Name     | Type         | Constraint | Quality | Fallback | Conformance |
|----|----------|--------------|------------|---------|----------|-------------|
| 0  | Active   | Alarm-Bitmap | all        |         |          | M           |
| 1  | Inactive | Alarm-Bitmap | all        |         |          | M           |
| 2  | State    | Alarm-Bitmap | all        |         |          | M           |
| 3  | Mask     | Alarm-Bitmap | all        |         |          | M           |

##### 1.15.8.1.1. Active Field

This field SHALL indicate those alarms that have become active.

##### 1.15.8.1.2. Inactive Field

This field SHALL indicate those alarms that have become inactive.

##### 1.15.8.1.3. Mask Field

This field SHALL be a copy of the Mask attribute when this event was generated.

##### 1.15.8.1.4. State Field

This field SHALL be a copy of the new State attribute value that resulted in the event being generated. That is, this field SHALL have all the bits in Active set and SHALL NOT have any of the bits in Inactive set.

## 1.16. Messages Cluster

This cluster provides an interface for passing messages to be presented by a device.

Page 146



### 1.16.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                      |
|----------|------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added                 |
| 2        | Updated from SE1.4 version; CCB 1819                             |
| 3        | Initial Matter release; renamed from EnergyMessaging to Messages |

### 1.16.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | MESS      |

### 1.16.3. Cluster ID

| ID     | Name     |
|--------|----------|
| 0x0097 | Messages |

### 1.16.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature              | Conformance | Summary |
|-----|------|----------------------|-------------|---------|
| 0   | CONF | ReceivedConfirmation | 0           |         |
| 1   | RESP | ConfirmationResponse | [CONF]      |         |
| 2   | RPLY | ConfirmationReply    | [CONF]      |         |
| 3   | PROT | ProtectedMessages    | 0           |         |

#### 1.16.4.1. ReceivedConfirmation Feature

This feature SHALL indicate that the device can get confirmation from a user that the message was received.

#### 1.16.4.2. ConfirmationResponse Feature

This feature SHALL indicate that the device is capable of presenting a list of responses to the user and recording the user's choice of response.




Page 147



#### 1.16.4.3. ConfirmationReply Feature

This feature SHALL indicate that the device is capable of collecting a free-form text response to a message.

#### 1.16.4.4. ProtectedMessages Feature

This feature SHALL indicate that the device is capable of requiring the user to authenticate before viewing a message; e.g. entering a PIN or password before viewing a message with billing information.

### 1.16.5. Data Types

#### 1.16.5.1. MessageID Type

This data type is an octstr of fixed length 16, containing the binary encoding of a UUID as specified in [RFC 4122](#).

#### 1.16.5.2. MessageControlBitmap Type

This data type is derived from map16, and indicates control information related to a message.

| Bit | Name                        | Summary                                  | Conformance |
|-----|-----------------------------|------------------------------------------|-------------|
| 0   | <b>ConfirmationRequired</b> | Message requires confirmation from user  | CONF        |
| 1   | <b>ResponseRequired</b>     | Message requires response from user      | RESP        |
| 2   | <b>ReplyMessage</b>         | Message supports reply message from user | RPLY        |
| 3   | <b>MessageConfirmed</b>     | Message has already been confirmed       | CONF        |
| 4   | <b>MessageProtected</b>     | Message required PIN/password protection | PROT        |

##### 1.16.5.2.1. ConfirmationRequired Bit

This bit SHALL indicate that the message originator requests a confirmation of receipt by the user. If confirmation is required, the device SHOULD present the message until it is either confirmed by the user selecting a confirmation option, or the message expires.

##### 1.16.5.2.2. ResponseRequired Bit

This bit SHALL indicate that a [MessagePresented](#) event SHOULD be generated based on the response of the user to the message.

Page 148



#### 1.16.5.2.3. ReplyMessage Bit

This bit SHALL indicate that a free-form user reply is to be included in the confirmation of receipt.

#### 1.16.5.2.4. MessageConfirmed Bit

This bit SHALL indicate the current confirmation state of a message, which is useful in the event that there are multiple Messages cluster client devices on a network.

#### 1.16.5.2.5. MessageProtected Bit

This bit SHALL indicate that user authentication (e.g. by password or PIN) is required before viewing a message.

### 1.16.5.3. FutureMessagePreferenceEnum Type

This data type is derived from enum8.

A display device MAY include this preference in the [MessageComplete](#) event as a hint to clients about how to handle future similar messages.

| Value | Name              | Summary                                    | Conformance |
|-------|-------------------|--------------------------------------------|-------------|
| 0     | <b>Allowed</b>    | Similar messages are allowed               | M           |
| 1     | <b>Increased</b>  | Similar messages should be sent more often | M           |
| 2     | <b>Reduced</b>    | Similar messages should be sent less often | M           |
| 3     | <b>Disallowed</b> | Similar messages should not be sent        | M           |
| 4     | <b>Banned</b>     | No further messages should be sent         | M           |

### 1.16.5.4. MessagePriorityEnum Type

This data type is derived from enum8.

Priority SHOULD be used to decide which messages to show when the number of eligible messages is larger than the device's capacity to present them.

| Value | Name       | Summary                                                  | Conformance |
|-------|------------|----------------------------------------------------------|-------------|
| 0     | <b>Low</b> | Message to be transferred with a low level of importance | M           |




Page 149



| Value | Name            | Summary                                                       | Conformance |
|-------|-----------------|---------------------------------------------------------------|-------------|
| 1     | <b>Medium</b>   | Message to be transferred with a medium level of importance   | M           |
| 2     | <b>High</b>     | Message to be transferred with a high level of importance     | M           |
| 3     | <b>Critical</b> | Message to be transferred with a critical level of importance | M           |

### 1.16.5.5. MessageStruct Type

This represents a single message.

| Access Modifier: Fabric Scoped |                        |                                   |            |         |          |        |             |
|--------------------------------|------------------------|-----------------------------------|------------|---------|----------|--------|-------------|
| ID                             | Name                   | Type                              | Constraint | Quality | Fallback | Access | Conformance |
| 0                              | <b>MessageID</b>       | MessageID                         | all        |         |          | S      | M           |
| 1                              | <b>Priority</b>        | MessagePriorityEnum               |            |         |          | S      | M           |
| 2                              | <b>Message-Control</b> | Message-Control-Bitmap            |            |         |          | S      | M           |
| 3                              | <b>StartTime</b>       | epoch-s                           |            | X       |          | S      | M           |
| 4                              | <b>Duration</b>        | uint64                            | all        | X       |          | S      | M           |
| 5                              | <b>Message-Text</b>    | string                            | max 256    |         |          | S      | M           |
| 6                              | <b>Responses</b>       | list[MessageResponseOptionStruct] | max 4      |         |          | S      | RESP        |

#### 1.16.5.5.1. MessageID Field

This field SHALL indicate a globally unique ID for this message.

#### 1.16.5.5.2. Priority Field

This field SHALL indicate the priority level for this message.

Page 150



#### 1.16.5.5.3. MessageControl Field

This field SHALL indicate control information related to the message.

#### 1.16.5.5.4. StartTime Field

This field SHALL indicate the time in UTC at which the message becomes available to be presented. A null value SHALL indicate "now."

#### 1.16.5.5.5. Duration Field

This field SHALL indicate the amount of time, in milliseconds, after the [StartTime](#) during which the message is available to be presented. A null value SHALL indicate "until changed".

#### 1.16.5.5.6. MessageText Field

This field SHALL indicate a string containing the message to be presented.

#### 1.16.5.5.7. Responses Field

This field SHALL indicate a list of potential responses to the message. The entries in this list SHALL have unique values of MessageResponseID.

If the [ResponseRequired](#) bit is set on the message but this list is empty, the device SHALL provide a generic acknowledgement button, e.g. "OK".

If the [ResponseRequired](#) bit is not set on the message, this list SHALL be ignored.

### 1.16.5.6. MessageResponseOptionStruct Type

This represents a possible response to a message.

| ID | Name              | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------|--------|------------|---------|----------|--------|-------------|
| 0  | MessageResponseID | uint32 | min 1      |         |          |        | M           |
| 1  | Label             | string | max 32     |         |          |        | M           |

#### 1.16.5.6.1. MessageResponseID Field

This field SHALL indicate a unique unsigned 32-bit number identifier for this message response option.

#### 1.16.5.6.2. Label Field

This field SHALL indicate the text for this option; e.g. "Yes", "No", etc.

## 1.16.6. Attributes



Page 151



| ID     | Name                     | Type                                   | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------|----------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Messages</b>          | list[ <a href="#">Mes-sageStruct</a> ] | max 8      |         |          | R V F  | M           |
| 0x0001 | <b>ActiveMes-sageIDs</b> | list[ <a href="#">Mes-sageID</a> ]     | max 8      |         |          | R V    | M           |

#### 1.16.6.1. Messages Attribute

This attribute SHALL indicate a list of queued messages.

In addition to filtering based upon fabric, to preserve user privacy, the server MAY further limit the set of messages returned in a read request. At minimum, the server SHALL return to a client those messages that the client itself created/submitted.

#### 1.16.6.2. ActiveMessageIDs Attribute

This attribute SHALL indicate a list of the [MessageIDs](#) of the [Messages](#) currently being presented. If this list is empty, no messages are currently being presented.

This list SHALL NOT be fabric-scoped; it SHALL contain [MessageIDs](#) for all [Messages](#) being presented, no matter what fabric the client that queued them is on.

### 1.16.7. Commands

| ID   | Name                           | Direction                   | Response | Access | Conformance |
|------|--------------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>PresentMes-sagesRequest</b> | client $\Rightarrow$ server | Y        | O F    | M           |
| 0x01 | <b>CancelMes-sagesRequest</b>  | client $\Rightarrow$ server | Y        | O F    | M           |

#### 1.16.7.1. PresentMessagesRequest Command

Upon receipt, this SHALL cause the [message](#) in the passed fields to be appended to the [Messages](#) attribute.

If appending the message would cause the number of messages to be greater than the capacity of the list, the device SHALL NOT append any message to [Messages](#), and SHALL return a status code of RESOURCE\_EXHAUSTED.

When displaying a message in response to this command, an indication (ex. visual) of the origin node of the command SHALL be provided. This could be in the form of a friendly name label which uniquely identifies the node to the user. This friendly name label is typically assigned by the Matter Admin at the time of commissioning and, when it's a device, is often editable by the user. It might be a combination of a company name and friendly name, for example, "Acme" or "Acme Streaming Service on Alice's Phone".

Page 152







|             |                                                                                                                                                                                                                                                               |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | It is currently not specified where the friendly name label can be found on the node, meaning that clients SHOULD NOT rely on a certain method they happen to observe in a particular server instance, since other instances could employ a different method. |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

The device SHOULD make it possible for the user to view which nodes have access to this cluster and to individually remove privileges for each node.

| ID | Name                  | Type                               | Constraint | Quality | Fallback | Conformance |
|----|-----------------------|------------------------------------|------------|---------|----------|-------------|
| 0  | <b>MessageID</b>      | MessageID                          | all        |         |          | M           |
| 1  | <b>Priority</b>       | MessagePriorityEnum                |            |         |          | M           |
| 2  | <b>MessageControl</b> | MessageControlBitmap               |            |         |          | M           |
| 3  | <b>StartTime</b>      | epoch-s                            |            | X       |          | M           |
| 4  | <b>Duration</b>       | uint64                             | all        | X       |          | M           |
| 5  | <b>MessageText</b>    | string                             | max 256    |         |          | M           |
| 6  | <b>Responses</b>      | list[MessageResponseOption-Struct] | max 4      |         |          | RESP        |

#### 1.16.7.1.1. MessageID Field

This field SHALL indicate a globally unique ID for this message. See [MessageID](#).

#### 1.16.7.1.2. Priority Field

This field SHALL indicate the priority level for this message. See [Priority](#).

#### 1.16.7.1.3. MessageControl Field

This field SHALL indicate control information related to the message. See [MessageControl](#).

#### 1.16.7.1.4. StartTime Field

This field SHALL indicate the time in UTC at which the message becomes available to be presented. A null value SHALL indicate "now." See [StartTime](#).

#### 1.16.7.1.5. Duration Field

This field SHALL indicate the amount of time, in milliseconds, after the [StartTime](#) during which the message is available to be presented. A null value SHALL indicate "until changed". See [Duration](#).




Page 153



#### 1.16.7.1.6. MessageText Field

This field SHALL indicate a string containing the message to be presented. See [MessageText](#).

#### 1.16.7.1.7. Responses Field

This field SHALL indicate a list of potential responses to the message. The entries in this list SHALL have unique values of MessageResponseID.

If the [ResponseRequired](#) bit is set on the message but this list is empty, the device SHALL provide a generic acknowledgement button, e.g. "OK".

If the [ResponseRequired](#) bit is not set on the message, this list SHALL be ignored.

See [Responses](#).

### 1.16.7.2. CancelMessagesRequest Command

This command will cancel the message IDs specified.

| ID | Name       | Type            | Constraint | Quality | Fallback | Conformance |
|----|------------|-----------------|------------|---------|----------|-------------|
| 0  | MessageIDs | list[MessageID] | max 8      |         |          | M           |

#### 1.16.7.2.1. MessageIDs Field

This field SHALL indicate the [MessageIDs](#) for the messages being cancelled.

Cancelling a message SHALL cause it to be removed from [Messages](#), cause its [MessageID](#) to be removed from [ActiveMessageIDs](#) and cause any active presentation of the message to cease.

Message IDs in this command that indicate messages that do not exist in [Messages](#), or that are not scoped to the fabric of the sender, SHALL be ignored.

### 1.16.8. Events

| ID   | Name             | Priority | Quality | Access | Conformance |
|------|------------------|----------|---------|--------|-------------|
| 0x00 | MessageQueued    | INFO     |         | V      | M           |
| 0x01 | MessagePresented | INFO     |         | V      | M           |
| 0x02 | MessageComplete  | INFO     |         | V      | M           |

#### 1.16.8.1. MessageQueued Event

This event SHALL be generated when a message is added to the [messages](#) attribute.

Page 154



| Access Modifier: Fabric-Sensitive |           |           |            |         |          |             |
|-----------------------------------|-----------|-----------|------------|---------|----------|-------------|
| ID                                | Name      | Type      | Constraint | Quality | Fallback | Conformance |
| 0                                 | MessageID | MessageID |            |         |          | M           |

#### 1.16.8.1.1. MessageID Field

This field SHALL indicate the [MessageID](#) for newly added message.

#### 1.16.8.2. MessagePresented Event

This event SHALL be generated when the message is presented to the user.

| Access Modifier: Fabric-Sensitive |           |           |            |         |          |             |
|-----------------------------------|-----------|-----------|------------|---------|----------|-------------|
| ID                                | Name      | Type      | Constraint | Quality | Fallback | Conformance |
| 0                                 | MessageID | MessageID |            |         |          | M           |

#### 1.16.8.2.1. MessageID Field

This field SHALL indicate the [MessageID](#) for the message being presented.

#### 1.16.8.3. MessageComplete Event

This event SHALL be generated when the message is confirmed by the user, or when the [Duration](#) field of the message has elapsed without confirmation.

| Access Modifier: Fabric-Sensitive |                          |                              |            |         |          |             |
|-----------------------------------|--------------------------|------------------------------|------------|---------|----------|-------------|
| ID                                | Name                     | Type                         | Constraint | Quality | Fallback | Conformance |
| 0                                 | MessageID                | MessageID                    |            |         |          | M           |
| 1                                 | ResponseID               | uint32                       | all        | X       |          | RESP        |
| 2                                 | Reply                    | string                       | max 256    | X       |          | RPLY        |
| 3                                 | FutureMessagesPreference | FutureMessagesPreferenceEnum | all        | X       |          | M           |

#### 1.16.8.3.1. MessageID Field

This field SHALL indicate the [MessageID](#) for the message being confirmed.

#### 1.16.8.3.2. ResponseID Field

This field SHALL indicate the [MessageResponseID](#) selected by the user. If there was no response before the [Duration](#) field of the message has elapsed, this field SHALL be null.



Page 155



#### 1.16.8.3.3. Reply Field

This field SHALL indicate a user-provided reply to the message. If there was no reply, or the message did not have the [ReplyRequired](#) bit set, this field SHALL be null.

#### 1.16.8.3.4. FutureMessagesPref Field

This field SHALL indicate a user-provided preference for the delivery of similar messages in the future. A null value SHALL indicate no change in preference.

### 1.17. Service Area Cluster

This cluster provides an interface for controlling the areas where a device should operate, for reporting the status at each area, and for querying the current area.

The device MAY operate at one area at a time, as in the case of a mobile device, such as a robot. Other devices MAY operate at (service) multiple areas simultaneously, as in the case of a sensor that can monitor multiple areas. This cluster specification uses the term "operate" to describe both the operating and servicing actions, regardless of the device type.

The cluster allows the client to select one or more areas on the server, to indicate where the device SHOULD attempt to operate. An area is one of a list of options that MAY be presented by a client for a user choice, or understood by the client, via the semantic data of the area.

The area semantic data is a combination of semantic tags, indicating one or more of the following: the building floor, area type, landmark, and relative position.

#### 1.17.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                 |
|----------|---------------------------------------------|
| 1        | Initial revision                            |
| 2        | Rename InitialTimeEstimate to EstimatedTime |

#### 1.17.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | SEAR      |

#### 1.17.3. Cluster ID

| ID     | Name         |
|--------|--------------|
| 0x0150 | Service Area |

Page 156







## 1.17.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code          | Feature            | Summary                                                     |
|-----|---------------|--------------------|-------------------------------------------------------------|
| 0   | <b>SELRUN</b> | SelectWhileRunning | The device allows changing the selected areas while running |
| 1   | <b>PROG</b>   | ProgressReporting  | The device implements the progress reporting feature        |
| 2   | <b>MAPS</b>   | Maps               | The device has map support                                  |

### 1.17.4.1. SelectWhileRunning Feature

This feature indicates whether this device allows changing the selected areas, by using the SelectAreas command, while operating.

## 1.17.5. Data Types

### 1.17.5.1. LandmarkInfoStruct Type

The data from this structure indicates a landmark and position relative to the landmark.

| ID | Name                       | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------------|------|------------|---------|----------|--------|-------------|
| 0  | <b>LandmarkTag</b>         | tag  | all        |         |          |        | M           |
| 1  | <b>RelativePositionTag</b> | tag  | all        | X       |          |        | M           |

#### 1.17.5.1.1. LandmarkTag Field

This field SHALL indicate that the area is associated with a landmark.

This field SHALL be the ID of a landmark semantic tag, located within the [Common Landmark Namespace](#). For example, this tag MAY indicate that the area refers to an area next to a table.

#### 1.17.5.1.2. RelativePositionTag Field

This field SHALL identify the position of the area relative to a landmark. This is a static description of a zone known to the server, and this field never reflects the device's own proximity or position relative to the landmark, but that of the zone.

This field SHALL be the ID of a relative position semantic tag, located within the [Common Relative Position Namespace](#).




Page 157



If the RelativePositionTag field is null, this field indicates proximity to the landmark. Otherwise, the RelativePositionTag field indicates the position of the area relative to the landmark indicated by the LandmarkTag field. For example, this tag, in conjunction with the LandmarkTag field, MAY indicate that the area refers to a zone under a table.

#### 1.17.5.2. AreaInfoStruct Type

The data from this structure indicates the name and/or semantic data describing an area, as detailed below.

| ID | Name                 | Type                                | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------|-------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Location-Info</b> | <a href="#">location-desc</a>       | all        | X       |          |        | M           |
| 1  | <b>LandmarkInfo</b>  | <a href="#">Landmark-InfoStruct</a> | all        | X       |          |        | M           |

This data type includes the LocationInfo field, with the following fields: LocationName, FloorNumber, AreaType. Additional semantic data MAY be available in the LandmarkInfo field.

For an area description to be meaningful, it SHALL have at least one of the following:

- a non-empty name (LocationInfo's LocationName field)

OR

- some semantic data (one or more of these: FloorNumber, AreaType or LandmarkTag)

The normative text from the remainder of this section describes these constraints.

If the LocationInfo field is null, the LandmarkInfo field SHALL NOT be null.

If the LandmarkInfo field is null, the LocationInfo field SHALL NOT be null.

If LocationInfo is not null, and its LocationName field is an empty string, at least one of the following SHALL NOT be null:

- LocationInfo's FloorNumber field
- LocationInfo's AreaType field
- LandmarkInfo field

If all three of the following are null, LocationInfo's LocationName field SHALL NOT be an empty string:

- LocationInfo's FloorNumber field
- LocationInfo's AreaType field
- LandmarkInfo field

Page 158



#### 1.17.5.2.1. LocationInfo Field

This field SHALL indicate the name of the area, floor number and/or area type.

A few examples are provided below.

- An area can have LocationInfo's LocationName field set to "blue room", and the AreaType field set to the ID of a "Living Room" semantic tag. Clients wishing to direct the device to operate in (or service) the living room can use this area.
- An area can have LocationInfo set to null, the LandmarkInfo's LandmarkTag field set to the ID of the "Table" landmark semantic tag, and the RelativePositionTag field set to the ID of the "Under" position semantic tag. With such an area indication, the client can request the device to operate in (or service) the area located under the table.

#### 1.17.5.2.2. LandmarkInfo Field

This field SHALL indicate an association with a landmark. A value of null indicates that the information is not available or known. For example, this may indicate that the area refers to a zone next to a table.

If this field is not null, that indicates that the area is restricted to the zone where the landmark is located, as indicated by the LandmarkTag and, if not null, by the RelativePositionTag fields, rather than to the entire room or floor where the landmark is located, if those are indicated by the LocationInfo field.

#### 1.17.5.3. MapStruct Type

This is a struct representing a map.

| ID | Name  | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------|--------|------------|---------|----------|--------|-------------|
| 0  | MapID | uint32 |            |         | MS       |        | M           |
| 1  | Name  | string | max 64     |         | MS       |        | M           |

##### 1.17.5.3.1. MapID Field

This field SHALL represent the map's identifier.

##### 1.17.5.3.2. Name Field

This field SHALL represent a human understandable map description.

For example: "Main Floor", or "Second Level".

#### 1.17.5.4. AreaStruct Type

This is a struct representing an area known to the server.



Page 159



| ID | Name            | Type           | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|----------------|------------|---------|----------|--------|-------------|
| 0  | <b>AreaID</b>   | uint32         |            |         | MS       |        | M           |
| 1  | <b>MapID</b>    | uint32         | desc       | X       | MS       |        | M           |
| 2  | <b>AreaInfo</b> | AreaInfoStruct |            |         | MS       |        | M           |

#### 1.17.5.4.1. AreaID Field

This field SHALL represent the identifier of the area.

#### 1.17.5.4.2. MapID Field

This field SHALL indicate the map identifier which the area is associated with. A value of null indicates that the area is not associated with a map.

If the SupportedMaps attribute is not empty, this field SHALL match the MapID field of an entry from the SupportedMaps attribute's list. If the SupportedMaps attribute is empty, this field SHALL be null.

#### 1.17.5.4.3. AreaInfo Field

This field SHALL contain data describing the area.

This SHOULD be used by clients to determine the name and/or the full, or the partial, semantics of a certain area.

**NOTE**

If any entries on the SupportedAreas attribute's list have the AreaInfo field missing the semantic data, the client MAY remind the user to assign the respective data.

#### 1.17.5.5. ProgressStruct Type

This is a struct indicating the progress.

| ID | Name                        | Type                  | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------------|-----------------------|------------|---------|----------|--------|-------------|
| 0  | <b>AreaID</b>               | uint32                |            |         | MS       |        | M           |
| 1  | <b>Status</b>               | OperationalStatusEnum |            |         | MS       |        | M           |
| 2  | <b>TotalOperationalTime</b> | elapsed-s             |            | X       | MS       |        | O           |
| 3  | <b>EstimatedTime</b>        | elapsed-s             |            | X       | MS       |        | O           |

Page 160







#### 1.17.5.5.1. AreaID Field

This field SHALL indicate the identifier of the area, and the identifier SHALL be an entry in the SupportedAreas attribute's list.

#### 1.17.5.5.2. Status Field

This field SHALL indicate the operational status of the device regarding the area indicated by the AreaID field.

#### 1.17.5.5.3. TotalOperationalTime Field

This field SHALL indicate the total operational time, in seconds, from when the device started to operate at the area indicated by the AreaID field, until the operation finished, due to completion or due to skipping, including any time spent while paused.

A value of null indicates that the total operational time is unknown.

There MAY be cases where the total operational time exceeds the maximum value that can be conveyed by this attribute, and in such instances this attribute SHALL be populated with null.

This attribute SHALL be null if the Status field is not set to Completed or Skipped.

#### 1.17.5.5.4. EstimatedTime Field

This field SHALL indicate the estimated time for the operation, in seconds, from when the device will start operating at the area indicated by the AreaID field, until the operation completes, excluding any time spent while not operating in the area.

A value of null indicates that the estimated time is unknown. If the estimated time is unknown, or if it exceeds the maximum value that can be conveyed by this attribute, this attribute SHALL be null.

After initializing the [ProgressStruct](#) instance, the server SHOULD NOT change the value of this field, except when repopulating the entire instance, to avoid excessive reporting of the Progress attribute changes.

#### 1.17.5.6. OperationalStatusEnum Type

This data type is derived from enum8.

The following table defines the status values.

| Value | Name           | Summary                                                                                                                                              | Conformance |
|-------|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0x00  | <b>Pending</b> | The device has not yet started operating at the given area, or has not finished operating at that area but it is not currently operating at the area | M           |



Page 161



| Value | Name             | Summary                                                                                                                                                                                                                                                                                          | Conformance |
|-------|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0x01  | <b>Operating</b> | The device is currently operating at the given area                                                                                                                                                                                                                                              | M           |
| 0x02  | <b>Skipped</b>   | The device has skipped the given area, before or during operating at it, due to a SkipArea command, due an out of band command (e.g. from the vendor's application), due to a vendor specific reason, such as a time limit used by the device, or due the device ending operating unsuccessfully | M           |
| 0x03  | <b>Completed</b> | The device has completed operating at the given area                                                                                                                                                                                                                                             | M           |

#### 1.17.5.6.1. SelectAreasStatus Type

This data type is derived from enum8.

| Value | Name                   | Summary                                                                                                                                                                            | Conformance |
|-------|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0x00  | <b>Success</b>         | Attempting to operate in the areas identified by the entries of the NewAreas field is allowed and possible. The SelectedAreas attribute is set to the value of the NewAreas field. | M           |
| 0x01  | <b>UnsupportedArea</b> | The value of at least one of the entries of the NewAreas field doesn't match any entries in the SupportedAreas attribute.                                                          | M           |

Page 162







| Value | Name                 | Summary                                                                                                             | Conformance |
|-------|----------------------|---------------------------------------------------------------------------------------------------------------------|-------------|
| 0x02  | <b>InvalidInMode</b> | The received request cannot be handled due to the current mode of the device.                                       | M           |
| 0x03  | <b>InvalidSet</b>    | The set of values is invalid. For example, areas on different floors, that a robot knows it can't reach on its own. | M           |

#### 1.17.5.6.2. SkipAreaStatus Type

This data type is derived from enum8.

| Value | Name                      | Summary                                                                                                                                                      | Conformance |
|-------|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0x00  | <b>Success</b>            | Skipping the area is allowed and possible, or the device was operating at the last available area and has stopped.                                           | M           |
| 0x01  | <b>InvalidAreaList</b>    | The SelectedAreas attribute is empty.                                                                                                                        | M           |
| 0x02  | <b>InvalidInMode</b>      | The received request cannot be handled due to the current mode of the device. For example, the CurrentArea attribute is null or the device is not operating. | M           |
| 0x03  | <b>InvalidSkippedArea</b> | The SkippedArea field doesn't match an entry in the SupportedAreas list.                                                                                     | M           |

### 1.17.6. Attributes

| ID     | Name                  | Type                               | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------|------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>SupportedAreas</b> | list[ <a href="#">AreaStruct</a> ] | max 255    |         | MS       | RV     | M           |




Page 163



| ID     | Name                    | Type                                   | Constraint | Quality | Fallback | Access | Conformance   |
|--------|-------------------------|----------------------------------------|------------|---------|----------|--------|---------------|
| 0x0001 | <b>SupportedMaps</b>    | list[ <a href="#">MapStruct</a> ]      | max 255    |         | MS       | R V    | MAPS          |
| 0x0002 | <b>SelectedAreas</b>    | list[ <a href="#">uint32</a> ]         | desc       |         | empty    | R V    | M             |
| 0x0003 | <b>CurrentArea</b>      | <a href="#">uint32</a>                 | desc       | X       | null     | R V    | desc          |
| 0x0004 | <b>EstimatedEndTime</b> | <a href="#">epoch-s</a>                |            | Q X     | null     | R V    | [CurrentArea] |
| 0x0005 | <b>Progress</b>         | list[ <a href="#">ProgressStruct</a> ] | max 255    |         | empty    | R V    | PROG          |

#### 1.17.6.1. SupportedAreas Attribute

This attribute SHALL contain the list of areas that can be included in the SelectedAreas attribute's list. Each item in this list represents a unique area, as indicated by the AreaID field of [AreaStruct](#).

Each entry in this list SHALL have a unique value for the AreaID field.

If the SupportedMaps attribute is not empty, each entry in this list SHALL have a unique value for the combination of the MapID and AreaInfo fields.

If the SupportedMaps attribute is empty, each entry in this list SHALL have a unique value for the AreaInfo field and SHALL have the MapID field set to null.

An empty value indicates that the device is currently unable to provide the list of supported areas.

##### NOTE

due to the maximum size of this list and to the fact that the entries MAY include strings (see LocationName), care must be taken by implementers to avoid creating a data structure that is overly large, which can result in significant latency in accessing this attribute.

The value of this attribute MAY change at any time via an out-of-band interaction outside of the server, such as interactions with a user interface, or due to internal device changes.

When removing entries in the SupportedAreas attribute list the server SHALL adjust the values of the SelectedAreas, CurrentArea, and Progress attributes such that they only reference valid entries in the updated SupportedAreas attribute list. These changes to the SelectedAreas, CurrentArea, and Progress attributes MAY result in the server setting some or all of them to empty (for SelectedAreas and Progress) or null (for CurrentArea), or updating them with data that matches the constraints from the description of the respective attributes. These actions are required to ensure having a consistent representation of the maps and locations available to the clients.

The SupportedAreas attribute list changes mentioned above SHOULD NOT be allowed while the device is operating, to reduce the impact on the clients, and the potential confusion for the users.

Page 164







A few examples are provided below.

Valid list of areas:

- AreaID=0, LocationName="yellow bedroom", MapID=null
- AreaID=1, LocationName="orange bedroom", MapID=null

Valid list of areas:

- AreaID=5, LocationName="hallway", MapID=1
- AreaID=3, LocationName="hallway", MapID=2

### 1.17.6.2. SupportedMaps Attribute

This attribute SHALL contain the list of supported maps.

A map is a full or a partial representation of a home, known to the device. For example:

- a single level home MAY be represented using a single map
- a two level home MAY be represented using two maps, one for each level
- a single level home MAY be represented using two maps, each including a different set of rooms, such as "map of living room and kitchen" and "map of bedrooms and hallway"
- a single level home MAY be represented using one map for the indoor areas (living room, bedrooms etc.) and one for the outdoor areas (garden, swimming pool etc.)

Each map includes one or more areas - see the SupportedAreas attribute. In the context of this cluster specification, a map is effectively a group label for a set of areas, rather than a graphical representation that the clients can display to the users. The clients that present the list of available areas for user selection (see the SelectAreas command) MAY choose to filter the SupportedAreas list based on the associated map. For example, the clients MAY allow the user to indicate that the device is to operate on the first floor, and allow the user to choose only from the areas situated on that level.

If empty, that indicates that the device is currently unable to provide this information.

Each entry in this list SHALL have a unique value for the MapID field.

Each entry in this list SHALL have a unique value for the Name field.

|             |                                                                                                                                                                                                                                                                                                             |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | due to the maximum size of this list and to the fact that the entries MAY include strings (see the Name field of the MapStruct data type), care must be taken by implementers to avoid creating a data structure that is overly large, which can result in significant latency in accessing this attribute. |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

The value of this attribute MAY change at any time via an out-of-band interaction outside of the server, such as interactions with a user interface.

When updating the SupportedMaps attribute list by deleting entries, or by setting the attribute to an empty list, the SupportedAreas attribute SHALL be updated such that all entries in that list meet the constraints indicated in the description of the SupportedAreas attribute. This MAY result in the



Page 165



server removing entries from the SupportedAreas attribute list. See the SupportedAreas attribute description for the implications of changing that attribute.

The SupportedMaps attribute list changes mentioned above SHOULD NOT be allowed while the device is operating, to reduce the impact on the clients, and the potential confusion for the users.

#### 1.17.6.3. SelectedAreas Attribute

This attribute SHALL indicate the set of areas where the device SHOULD attempt to operate.

The mobile devices MAY travel without operating across any areas while attempting to reach the areas indicated by the SelectedAreas attribute. For example, a robotic vacuum cleaner MAY drive without cleaning when traveling without operating.

If this attribute is empty, the device is not constrained to operate in any specific areas.

If this attribute is not empty:

- each item in this list SHALL match the AreaID field of an entry in the SupportedAreas attribute's list
- each entry in this list SHALL have a unique value

#### 1.17.6.4. CurrentArea Attribute

If the device is mobile, this attribute SHALL indicate the area where the device is currently located, regardless of whether it is operating or not, such as while traveling between areas.

If the device is not mobile and can operate at multiple areas sequentially, this attribute SHALL indicate the area which is currently being serviced, or the area which is currently traversed by the device. For example, a camera device MAY use this attribute to indicate which area it currently takes video of (serviced area) or which area it currently has in view but not taking video of (e.g. an area which is traversed while panning).

##### NOTE

A device MAY traverse an area regardless of the status of the area (pending, skipped, or completed).

If a device can simultaneously operate at multiple areas, such as in the case of a sensor that can monitor multiple areas at the same time, the CurrentArea attribute SHALL NOT be implemented, since it doesn't apply. Else this attribute SHALL be optionally implemented.

A null value indicates that the device is currently unable to provide this information. For example, the device is traversing an unknown area, or the SupportedAreas attribute was updated and the area where the device is located was removed from that list.

If not null, the value of this attribute SHALL match the AreaID field of an entry on the SupportedAreas attribute's list.

#### 1.17.6.5. EstimatedEndTime Attribute

This attribute SHALL represent the estimated Epoch time for completing operating at the area indi-

Page 166







cated by the CurrentArea attribute, in seconds.

A value of 0 means that the operation has completed.

When this attribute is null, that represents that there is no time currently defined until operation completion. This MAY happen, for example, because no operation is in progress or because the completion time is unknown.

This attribute SHALL be null if the CurrentArea attribute is null.

If the Progress attribute is available, and it contains an entry matching CurrentArea, the server MAY use the time estimate provided in the EstimatedTime field of that entry to compute the EstimatedEndTime attribute.

The value of this attribute SHALL only be reported in the following cases:

- when it changes to or from 0
- when it decreases
- when it changes to or from null

**NOTE**

If the device is capable of pausing its operation, this attribute MAY be set to null, to indicate that completion time is unknown, or increment the value while being in the paused state.

#### 1.17.6.6. Progress Attribute

This attribute SHALL indicate the operating status at one or more areas.

Each entry in this list SHALL have a unique value for the AreaID field.

For each entry in this list, the AreaID field SHALL match an entry on the SupportedAreas attribute's list.

When this attribute is empty, that represents that no progress information is currently available.

If the SelectedAreas attribute is empty, indicating the device is not constrained to operate in any specific areas, the Progress attribute list MAY change while the device operates, due to the device adding new entries dynamically, when it determines which ones it can attempt to operate at.

If the SelectedAreas attribute is not empty, and the device starts operating:

- the Progress attribute list SHALL be updated so each entry of SelectedAreas has a matching Progress list entry, based on the AreaID field
- the length of the Progress and SelectedAreas list SHALL be the same
- the entries in the Progress list SHALL be initialized by the server, by having their status set to Pending or Operating, and the TotalOperationalTime field set to null

When the device ends operation unexpectedly, such as due to an error, the server SHALL update all Progress list entries with the Status field set to Operating or Pending to Skipped.



Page 167



When the device finishes operating, successfully or not, it SHALL NOT change the Progress attribute, except in the case of an unexpected end of operation as described above, or due to changes to the SupportedMaps or SupportedAreas attributes, so the clients can retrieve the progress information at that time.

**NOTE**

if the device implements the Operational Status cluster, or a derivation of it, in case the device fails to service any locations in the SelectedAreas list before ending the operation, it SHOULD use the Operational Status cluster to indicate that the device was unable to complete the operation (see the UnableToCompleteOperation error from that cluster specification). The clients SHOULD then read the Progress attribute, and indicate which areas have been successfully serviced (marked as completed).

### 1.17.7. Commands

| ID   | Name                       | Direction                   | Response            | Access | Conformance                                                |
|------|----------------------------|-----------------------------|---------------------|--------|------------------------------------------------------------|
| 0x00 | <b>SelectAreas</b>         | client $\Rightarrow$ server | SelectAreasResponse | O      | M                                                          |
| 0x01 | <b>SelectAreasResponse</b> | client $\Leftarrow$ server  | N                   | O      | M                                                          |
| 0x02 | <b>SkipArea</b>            | client $\Rightarrow$ server | SkipAreaResponse    | O      | [ <a href="#">CurrentArea</a>   <a href="#">Progress</a> ] |
| 0x03 | <b>SkipAreaResponse</b>    | client $\Leftarrow$ server  | N                   | O      | SkipArea                                                   |

#### 1.17.7.1. SelectAreas Command

This command is used to select a set of device areas, where the device is to operate.

On receipt of this command the device SHALL respond with a SelectAreasResponse command.

This command SHALL have the following data fields:

| ID | Name            | Type         | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------------|------------|---------|----------|-------------|
| 0  | <b>NewAreas</b> | list[uint32] | desc       |         |          | M           |

##### 1.17.7.1.1. NewAreas Field

This field indicates which areas the device is to operate at.

If this field is empty, that indicates that the device is to operate without being constrained to any specific areas, and the operation will not allow skipping using the SkipArea Command, otherwise the field SHALL be a list of unique values that match the AreaID field of entries on the SupportedAreas list.

Page 168



### 1.17.7.1.2. Effect on Receipt

If the NewAreas field contains any duplicated entries, the device SHALL operate on only the first instance of an entry in the list.

For example, if the list [1, 2, 2, 3, 2] were received, the device would ignore the duplicated instances of 2 in the list and operate as if the list [1, 2, 3] had been received instead.

If the device determines that it can't operate at all areas from the list, the SelectAreasResponse command's Status field SHALL indicate InvalidSet.

If at least one entry on the NewAreas field doesn't match the AreaID field of any entry of the SupportedAreas list, the SelectAreasResponse command's Status field SHALL indicate UnsupportedArea.

If the current state of the device doesn't allow for the areas to be selected, the SelectAreasResponse command SHALL have the Status field set to InvalidInMode.

Unless the SelectWhileRunning feature indicates that selecting areas is allowed while the device is in a non-idle state, such as operating or paused, the SelectAreasResponse command SHALL have the Status field set to InvalidInMode if this restriction prevents changing the selected areas.

Otherwise, if the device accepts the request, the server will attempt to operate at the areas indicated by the entries of the NewArea field, the SelectAreasResponse command SHALL have the Status field set to Success, and the SelectedAreas attribute SHALL be set to the value of the NewAreas field.

**NOTE**

The device MAY start to operate immediately or wait until specifically requested to operate. The behavior of the device is manufacturer specific.

If the NewAreas field is the same as the value of the SelectedAreas attribute the SelectAreasResponse command SHALL have the Status field set to Success and the StatusText field MAY be supplied with a human readable string or include an empty string.

### 1.17.7.2. SelectAreasResponse Command

This command is sent by the device on receipt of the SelectAreas command. This command SHALL have the following data fields:

| ID | Name       | Type              | Constraint | Quality | Fallback | Conformance |
|----|------------|-------------------|------------|---------|----------|-------------|
| 0  | Status     | SelectAreasStatus | all        |         |          | M           |
| 1  | StatusText | string            | max 256    |         |          | M           |

#### 1.17.7.2.1. Status Field

If the Status field is set to Success or UnsupportedArea, the server MAY use a non-empty string for the StatusText field to provide additional information. For example, if Status is set to Unsupported-




Page 169



edArea, the server MAY use StatusText to indicate which areas are unsupported.

If the Status field is not set to Success, or UnsupportedArea, the StatusText field SHALL include a vendor-defined error description which can be used to explain the error to the user. For example, if the Status field is set to InvalidInMode, the StatusText field SHOULD indicate why the request is not allowed, given the current mode of the device, which MAY involve other clusters.

### 1.17.7.3. SkipArea Command

This command is used to skip the given area, and to attempt operating at other areas on the SupportedAreas attribute list.

On receipt of this command the device SHALL respond with a SkipAreaResponse command.

This command SHALL have the following data fields:

| ID | Name               | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------------------|--------|------------|---------|----------|-------------|
| 0  | <b>SkippedArea</b> | uint32 | desc       |         |          | M           |

#### 1.17.7.3.1. SkippedArea Field

The SkippedArea field indicates the area to be skipped.

The SkippedArea field SHALL match an entry in the SupportedAreas list.

#### 1.17.7.3.2. Effect on Receipt

If the SelectedAreas attribute is empty, the SkipAreaResponse command's Status field SHALL indicate InvalidAreaList.

If the SkippedArea field does not match an entry in the SupportedAreas attribute, the SkipAreaResponse command's Status field SHALL indicate InvalidSkippedArea.

If the SkipArea command can not be handled by the device, e.g. due to the current state, the SkipAreaResponse command's Status field SHALL indicate InvalidInMode.

Otherwise, if the device accepts the request, the device SHALL return a SkipAreaResponse with the Status field set to Success and:

- If the device is currently operating at the area identified by SkippedArea, as indicated by either the CurrentArea or the Progress attributes, if implemented, the device SHALL stop operating at that area.
- If the Progress attribute is implemented, the entry corresponding to SkippedArea SHALL be updated to indicate that the area was skipped.
- The device SHALL attempt to operate only at the areas in the SelectedAreas attribute list where operating has not been skipped or completed, using a vendor defined order.
- If the device has either skipped or completed operating at all areas on the SelectedAreas

Page 170



attribute list, the server SHALL stop operating.

#### 1.17.7.4. SkipAreaResponse Command

This command is sent by the device on receipt of the SkipArea command.

This command SHALL have the following data fields:

| ID | Name       | Type           | Constraint | Quality | Fallback | Conformance |
|----|------------|----------------|------------|---------|----------|-------------|
| 0  | Status     | SkipAreaStatus | all        |         |          | M           |
| 1  | StatusText | string         | max 256    |         |          | M           |

##### 1.17.7.4.1. Status Field

If the Status field is set to Success or InvalidAreaList, the server MAY use a non-empty string for the StatusText field to provide additional information. For example, if Status is set to InvalidAreaList, the server MAY use StatusText to indicate why this list is invalid.

If the Status field is not set to Success or InvalidAreaList, the StatusText field SHALL include a vendor defined error description which can be used to explain the error to the user. For example, if the Status field is set to InvalidInMode, the StatusText field SHOULD indicate why the request is not allowed, given the current mode of the device, which MAY involve other clusters.



Page 171



Page 172







## Chapter 2. Measurement and Sensing

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter. References to external documents are contained in Chapter 1 and are made using [Rn] notation.

### 2.1. General Description

#### 2.1.1. Introduction

The clusters specified in this document are generic measurement and sensing interfaces that are sufficiently general to be of use across a wide range of application domains.

#### 2.1.2. Cluster List

This section lists the measurement and sensing clusters as specified in this chapter.

*Table 5. Overview of the Measurement and Sensing Clusters*

| Cluster ID | Cluster Name                                  | Description                                                                                                                 |
|------------|-----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| 0x0400     | <a href="#">Illuminance Measurement</a>       | Attributes and commands for configuring the measurement of illuminance, and reporting illuminance measurements              |
| 0x0402     | <a href="#">Temperature Measurement</a>       | Attributes and commands for configuring the measurement of temperature, and reporting temperature measurements              |
| 0x0403     | <a href="#">Pressure Measurement</a>          | Attributes and commands for configuring the measurement of pressure, and reporting pressure measurements                    |
| 0x0404     | <a href="#">Flow Measurement</a>              | Attributes and commands for configuring the measurement of flow, and reporting flow rates                                   |
| 0x0405     | <a href="#">Relative Humidity Measurement</a> | Supports configuring the measurement of relative humidity, and reporting relative humidity measurements of water in the air |
| 0x0406     | <a href="#">Occupancy Sensing</a>             | Attributes and commands for configuring occupancy sensing, and reporting occupancy status                                   |




Page 173



| Cluster ID | Cluster Name                  | Description                                                                                      |
|------------|-------------------------------|--------------------------------------------------------------------------------------------------|
| various    | Resource Monitoring           | Attributes and commands for reporting conditions of various resources                            |
| 0x005B     | Air Quality Measurement       | Attributes for reporting air quality classification                                              |
| various    | Concentration Measurement     | Attributes and aliases for concentration measurements                                            |
| 0x005C     | Smoke and CO Alarm            | An interface to smoke and CO alarms                                                              |
| 0x0091     | Electrical Energy Measurement | Attributes and commands for measuring electrical energy                                          |
| 0x0090     | Electrical Power Measurement  | Attributes and commands for measuring electrical power                                           |
| 0x0550     | Zone Management               | Attributes and commands for configuration and management of sensing zones.                       |
| 0x0430     | Soil Measurement              | Attributes and commands for configuring the measurement of soil, and reporting soil measurements |

## 2.1.3. Data Types

### 2.1.3.1. MeasurementTypeEnum Type

This data type is derived from enum16.

| Value | Name            | Summary                            | Conformance |
|-------|-----------------|------------------------------------|-------------|
| 0     | Unspecified     |                                    | M           |
| 1     | Voltage         | Voltage in millivolts (mV)         | M           |
| 2     | ActiveCurrent   | Active current in milliamps (mA)   | M           |
| 3     | ReactiveCurrent | Reactive current in milliamps (mA) | M           |
| 4     | ApparentCurrent | Apparent current in milliamps (mA) | M           |
| 5     | ActivePower     | Active power in milliwatts (mW)    | M           |

Page 174



| Value | Name             | Summary                                                 | Conformance |
|-------|------------------|---------------------------------------------------------|-------------|
| 6     | ReactivePower    | Reactive power in milli-volt-amps reactive (mVAR)       | M           |
| 7     | ApparentPower    | Apparent power in millivolt-amps (mVA)                  | M           |
| 8     | RMSVoltage       | Root mean squared voltage in millivolts (mV)            | M           |
| 9     | RMSCurrent       | Root mean squared current in milliamps (mA)             | M           |
| 10    | RMSPower         | Root mean squared power in milliwatts (mW)              | M           |
| 11    | Frequency        | AC frequency in millihertz (mHz)                        | M           |
| 12    | PowerFactor      | Power Factor ratio in +/- 1/100ths of a percent.        | M           |
| 13    | NeutralCurrent   | AC neutral current in milliamps (mA)                    | M           |
| 14    | ElectricalEnergy | Electrical energy in milliwatt-hours (mWh)              | M           |
| 15    | ReactiveEnergy   | Reactive power in milli-volt-amp-hours reactive (mVARh) | M           |
| 16    | ApparentEnergy   | Apparent power in millivolt-amp-hours (mVAh)            | M           |
| 17    | SoilMoisture     | Soil moisture in percent                                | M           |

### 2.1.3.2. MeasurementAccuracyRangeStruct Type

This struct represents the accuracy of a measurement for a range of measurement values. Accuracy SHALL be expressed as a maximum +/- percentage of the true value, a maximum +/- fixed value of the true value, or both.

| ID | Name            | Type  | Constraint            | Quality | Fallback | Access | Conformance |
|----|-----------------|-------|-----------------------|---------|----------|--------|-------------|
| 0  | <b>RangeMin</b> | int64 | $-2^{62}$ to $2^{62}$ |         |          |        | M           |



Page 175



| ID | Name                  | Type          | Constraint               | Quality | Fallback | Access | Conformance  |
|----|-----------------------|---------------|--------------------------|---------|----------|--------|--------------|
| 1  | <b>RangeMax</b>       | int64         | $-2^{62}$ to $2^{62}$    |         |          |        | M            |
| 2  | <b>PercentMax</b>     | percent100ths | all                      |         |          |        | O.a+         |
| 3  | <b>PercentMin</b>     | percent100ths | max PercentTypical       |         |          |        | [PercentMax] |
| 4  | <b>PercentTypical</b> | percent100ths | PercentMin to PercentMax |         |          |        | [PercentMin] |
| 5  | <b>FixedMax</b>       | uint64        | max ( $2^{62} - 1$ )     |         |          |        | O.a+         |
| 6  | <b>FixedMin</b>       | uint64        | max FixedMax             |         |          |        | [FixedMax]   |
| 7  | <b>FixedTypical</b>   | uint64        | FixedMin to FixedMax     |         |          |        | [FixedMin]   |

- If both **PercentMax** and **FixedMax** are indicated, then for a given true value in the range between **RangeMin** and **RangeMax**,
  - the reported value SHALL be less than or equal to the sum of the true value, **FixedMax** and **PercentMax** percent of the true value.
  - the reported value SHALL be greater than or equal to the true value minus the sum of **FixedMax** and **PercentMax** percent of the true value.
- If only **PercentMax** is indicated, then for a given true value in the range between **RangeMin** and **RangeMax**,
  - the reported value SHALL be less than or equal to the sum of the true value and **PercentMax** percent of the true value.
  - the reported value SHALL be greater than or equal to the true value minus **PercentMax** percent of the true value.
- If only **FixedMax** is indicated, then for a given true value in the range between **RangeMin** and **RangeMax**,
  - the reported value SHALL be less than or equal to the sum of the true value and **FixedMax**.
  - the reported value SHALL be greater than or equal to the true value minus **FixedMax**.

#### 2.1.3.2.1. RangeMin Field

This field SHALL indicate the minimum measurement value for the specified level of accuracy.

The value of this field SHALL be greater than or equal to the value of the **MinMeasuredValue** field on the encompassing **MeasurementAccuracyStruct**.

Page 176







The value of this field SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

#### 2.1.3.2.2. RangeMax Field

This field SHALL indicate the maximum measurement value for the specified level of accuracy.

The value of this field SHALL be greater than the value of the [RangeMin](#) field.

The value of this field SHALL be greater than or equal to the value of the [MinMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

The value of this field SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

#### 2.1.3.2.3. PercentMax Field

This field SHALL indicate the maximum +/- percentage accuracy for the associated measurement.

#### 2.1.3.2.4. PercentMin Field

This field SHALL indicate the minimum +/- percentage accuracy for the associated measurement.

#### 2.1.3.2.5. PercentTypical Field

This field SHALL indicate the typical +/- percentage accuracy for the associated measurement.

#### 2.1.3.2.6. FixedMax Field

This field SHALL indicate the maximum +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

#### 2.1.3.2.7. FixedMin Field

This field SHALL indicate the minimum +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

#### 2.1.3.2.8. FixedTypical Field

This field SHALL indicate the typical +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

### 2.1.3.3. MeasurementAccuracyStruct Type

This struct represents the set of accuracy ranges for a given measurement, the maximum and minimum values for the measurement, and whether the measurement is directly measured or just estimated from other information.



Page 177



| ID | Name                    | Type                                                   | Constraint            | Quality | Fallback | Access | Conformance |
|----|-------------------------|--------------------------------------------------------|-----------------------|---------|----------|--------|-------------|
| 0  | <b>MeasurementType</b>  | <a href="#">MeasurementTypeEnum</a>                    | all                   |         |          |        | M           |
| 1  | <b>Measured</b>         | bool                                                   | all                   |         |          |        | M           |
| 2  | <b>MinMeasuredValue</b> | int64                                                  | $-2^{62}$ to $2^{62}$ |         |          |        | M           |
| 3  | <b>MaxMeasuredValue</b> | int64                                                  | $-2^{62}$ to $2^{62}$ |         |          |        | M           |
| 4  | <b>AccuracyRanges</b>   | list[ <a href="#">MeasurementAccuracyRangeStruct</a> ] | min 1                 |         |          |        | M           |

#### 2.1.3.3.1. MeasurementType Field

This field SHALL indicate the type of measurement for the accuracy provided.

#### 2.1.3.3.2. Measured Field

This field SHALL indicate whether the associated measurement was directly measured. If this field is not set to true, then the associated measurement was estimated.

#### 2.1.3.3.3. MinMeasuredValue Attribute

This field SHALL indicate the minimum value that can be measured.

#### 2.1.3.3.4. MaxMeasuredValue Attribute

This field SHALL indicate the maximum value that can be measured.

#### 2.1.3.3.5. AccuracyRanges Field

This field SHALL indicate a list of measurement ranges and their associated accuracies.

The value of the [RangeMin](#) field on the first [MeasurementAccuracyRangeStruct](#) in this list SHALL be equal to the value of the [MinMeasuredValue](#) field.

The value of the [RangeMax](#) field on the last [MeasurementAccuracyRangeStruct](#) in this list SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field.

The value of the [RangeMin](#) field on each [MeasurementAccuracyRangeStruct](#) in this list other than the first SHALL be one more the value of the [RangeMax](#) field on the previous [MeasurementAccuracyRangeStruct](#) in this list (i.e. there SHALL be no gaps in the accuracy ranges, and the ranges SHALL

Page 178



be in increasing order).

## 2.1.4. Measured Value

This section provides requirements on the attributes `MeasuredValue`, `MinMeasuredValue`, `MaxMeasuredValue`. Accuracy of `MeasuredValue` is discussed in the following section.

### 2.1.4.1. Constraint

Where `MinMeasuredValue` or `MaxMeasuredValue` attributes are mandatory the null value MAY be used to indicate that a limit is unknown.

For any measurement cluster with `MeasuredValue`, `MinMeasuredValue` and `MaxMeasuredValue` attributes, the following SHALL be always be true:

- If `MinMeasuredValue` and `MaxMeasuredValue` are both known, then `MaxMeasuredValue` SHALL be greater than `MinMeasuredValue`.
- If `MaxMeasuredValue` is known, then `MeasuredValue` SHALL be less than or equal to `MaxMeasuredValue`.
- If `MinMeasuredValue` is known, then `MeasuredValue` SHALL be greater than or equal to `MinMeasuredValue`.

## 2.1.5. Measurement Accuracy

Measurement clusters MAY express the accuracy of their measurements with a [Tolerance](#) attribute expressing a simple magnitude of error, or with a `MeasurementAccuracyStruct` expressing magnitude or percentage ranges of error for different ranges of measured values.

### 2.1.5.1. Tolerance Attribute

For any measurement cluster with a `MeasuredValue` and `Tolerance` attribute, when `Tolerance` is implemented the following SHALL always be true:

- The `Tolerance` attribute SHALL indicate the magnitude of the possible error that is associated with `MeasuredValue` attribute, using the same units and resolution. The true value SHALL be in the range (`MeasuredValue` – `Tolerance`) to (`MeasuredValue` + `Tolerance`).
- If known, the true value SHALL never be outside the possible physical range. Some examples:
  - a temperature SHALL NOT be below absolute zero
  - a concentration SHALL NOT be negative

## 2.2. Illuminance Measurement Cluster

The Illuminance Measurement cluster provides an interface to illuminance measurement functionality, including configuration and provision of notifications of illuminance measurements.




Page 179



## 2.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                          |
|----------|----------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added; CCB 2048 2049 2050 |
| 2        | CCB 2167                                                             |
| 3        | New data model format and notation                                   |

## 2.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | ILL       |

## 2.2.3. Cluster ID

| ID     | Name                    |
|--------|-------------------------|
| 0x0400 | Illuminance Measurement |

## 2.2.4. Data Types

### 2.2.4.1. LightSensorTypeEnum Type

This data type is derived from enum8.

| Value     | Name              | Summary                                               | Conformance |
|-----------|-------------------|-------------------------------------------------------|-------------|
| 0         | <b>Photodiode</b> | Indicates photodiode sensor type                      | M           |
| 1         | <b>CMOS</b>       | Indicates CMOS sensor type                            | M           |
| 64 to 254 | <b>MS</b>         | Reserved for manufacturer specific light sensor types | O           |

## 2.2.5. Attributes

Page 180







| ID     | Name                     | Type                | Constraint                              | Quality | Fallback | Access | Conformance |
|--------|--------------------------|---------------------|-----------------------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>Measured-Value</b>    | uint16              | 0, MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | M           |
| 0x0001 | <b>MinMeasured-Value</b> | uint16              | 1 to 65533                              | X       |          | R V    | M           |
| 0x0002 | <b>MaxMeasured-Value</b> | uint16              | min (MinMeasuredValue + 1)              | X       |          | R V    | M           |
| 0x0003 | <b>Tolerance</b>         | uint16              | max 2048                                |         |          | R V    | O           |
| 0x0004 | <b>LightSensorType</b>   | LightSensorTypeEnum | all                                     | X       | null     | R V    | O           |

#### 2.2.5.1. MeasuredValue Attribute

This attribute SHALL indicate the illuminance in Lux (symbol lx) as follows:

- $\text{MeasuredValue} = 10,000 \times \log_{10}(\text{illuminance}) + 1$ ,

where  $1 \text{ lx} \le \text{illuminance} \le 3.576 \text{ Mlx}$ , corresponding to a MeasuredValue in the range 1 to 0xFFFE.

The MeasuredValue attribute can take the following values:

- 0 indicates a value of illuminance that is too low to be measured,
- $\text{MinMeasuredValue} \le \text{MeasuredValue} \le \text{MaxMeasuredValue}$  under normal circumstances,
- null indicates that the illuminance measurement is invalid.

The MeasuredValue attribute is updated continuously as new measurements are made.

#### 2.2.5.2. MinMeasuredValue Attribute

This attribute SHALL indicate the minimum value of MeasuredValue that can be measured. A value of null indicates that this attribute is not defined. See [Measured Value](#) for more details.

#### 2.2.5.3. MaxMeasuredValue Attribute

This attribute SHALL indicate the maximum value of MeasuredValue that can be measured. A value of null indicates that this attribute is not defined. See [Measured Value](#) for more details.

#### 2.2.5.4. Tolerance Attribute

See [Measured Value](#).



Page 181



### 2.2.5.5. LightSensorType Attribute

This attribute SHALL indicate the electronic type of the light sensor. This attribute SHALL be set to one of the non-reserved values listed in [LightSensorTypeEnum](#) or null in case the sensor type is unknown.

## 2.3. Temperature Measurement Cluster

This cluster provides an interface to temperature measurement functionality, including configuration and provision of notifications of temperature measurements.

### 2.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                      |
|----------|--------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added |
| 2        | CCB 2241 2370                                    |
| 3        | CCB 2823                                         |
| 4        | New data model format and notation               |

### 2.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | TMP       |

### 2.3.3. Cluster ID

| ID     | Name                    |
|--------|-------------------------|
| 0x0402 | Temperature Measurement |

### 2.3.4. Attributes

| ID     | Name                  | Type        | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|-----------------------|-------------|--------------------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>Measured-Value</b> | temperature | MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | M           |

Page 182



| ID     | Name                    | Type        | Constraint                 | Quality | Fallback | Access | Conformance |
|--------|-------------------------|-------------|----------------------------|---------|----------|--------|-------------|
| 0x0001 | <b>MinMeasuredValue</b> | temperature | -27315 to 32766            | X       |          | R V    | M           |
| 0x0002 | <b>MaxMeasuredValue</b> | temperature | min (MinMeasuredValue + 1) | X       |          | R V    | M           |
| 0x0003 | <b>Tolerance</b>        | uint16      | max 2048                   |         | 0        | R V    | O           |

#### 2.3.4.1. MeasuredValue Attribute

This attribute SHALL indicate the measured temperature.

The null value indicates that the temperature is unknown.

#### 2.3.4.2. MinMeasuredValue Attribute

This attribute SHALL indicate the minimum value of MeasuredValue that is capable of being measured. See [Measured Value](#) for more details.

The null value indicates that the value is not available.

#### 2.3.4.3. MaxMeasuredValue Attribute

This attribute indicates the maximum value of MeasuredValue that is capable of being measured. See [Measured Value](#) for more details.

The null value indicates that the value is not available.

#### 2.3.4.4. Tolerance Attribute

See [Measured Value](#).

## 2.4. Pressure Measurement Cluster

This cluster provides an interface to pressure measurement functionality, including configuration and provision of notifications of pressure measurements.

### 2.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                      |
|----------|--------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added |



Page 183



| Revision | Description                        |
|----------|------------------------------------|
| 2        | CCB 2241 2370                      |
| 3        | New data model format and notation |

#### 2.4.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | PRS       |

#### 2.4.3. Cluster ID

| ID     | Name                 |
|--------|----------------------|
| 0x0403 | Pressure Measurement |

#### 2.4.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature  | Conformance | Summary                       |
|-----|------|----------|-------------|-------------------------------|
| 0   | EXT  | Extended | 0           | Extended range and resolution |

#### 2.4.5. Attributes

| ID     | Name                     | Type   | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|--------------------------|--------|--------------------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>Measured-Value</b>    | int16  | MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | M           |
| 0x0001 | <b>MinMeasured-Value</b> | int16  | max 32766                            | X       |          | R V    | M           |
| 0x0002 | <b>MaxMeasured-Value</b> | int16  | (MinMeasuredValue + 1) to 32767      | X       |          | R V    | M           |
| 0x0003 | <b>Tolerance</b>         | uint16 | max 2048                             |         | 0        | R V    | O           |
| 0x0010 | <b>Scaled-Value</b>      | int16  | MinScaledValue to MaxScaledValue     | X       |          | R V    | EXT         |

Page 184







| ID     | Name                    | Type   | Constraint                      | Quality | Fallback | Access | Conformance |
|--------|-------------------------|--------|---------------------------------|---------|----------|--------|-------------|
| 0x0011 | <b>Min-Scaled-Value</b> | int16  | max 32766                       | X       |          | R V    | EXT         |
| 0x0012 | <b>Max-Scaled-Value</b> | int16  | (Min-Scaled-Value + 1) to 32767 | X       |          | R V    | EXT         |
| 0x0013 | <b>ScaledTolerance</b>  | uint16 | max 2048                        |         | 0        | R V    | [EXT]       |
| 0x0014 | <b>Scale</b>            | int8   | min -127                        |         |          | R V    | EXT         |

#### 2.4.5.1. MeasuredValue Attribute

This attribute SHALL represent the pressure in kPa as follows:

$$\text{MeasuredValue} = 10 \times \text{Pressure [kPa]}$$

The null value indicates that the value is not available.

#### 2.4.5.2. MinMeasuredValue Attribute

This attribute SHALL indicate the minimum value of MeasuredValue that can be measured. See [Measured Value](#) for more details.

The null value indicates that the value is not available.

#### 2.4.5.3. MaxMeasuredValue Attribute

This attribute SHALL indicate the maximum value of MeasuredValue that can be measured. See [Measured Value](#) for more details.

The null value indicates that the value is not available.

#### 2.4.5.4. Tolerance Attribute

See [Measured Value](#).

#### 2.4.5.5. ScaledValue Attribute

This attribute SHALL represent the pressure in Pascals as follows:

$$\text{ScaledValue} = 10^{\text{Scale}} \times \text{Pressure [Pa]}$$

The null value indicates that the value is not available.




Page 185



#### 2.4.5.6. MinScaledValue Attribute

This attribute SHALL indicate the minimum value of ScaledValue that can be measured.

The null value indicates that the value is not available.

#### 2.4.5.7. MaxScaledValue Attribute

This attribute SHALL indicate the maximum value of ScaledValue that can be measured.

The null value indicates that the value is not available.

#### 2.4.5.8. ScaledTolerance Attribute

This attribute SHALL indicate the magnitude of the possible error that is associated with ScaledValue. The true value is located in the range

(ScaledValue – ScaledTolerance) to (ScaledValue + ScaledTolerance).

#### 2.4.5.9. Scale Attribute

This attribute SHALL indicate the base 10 exponent used to obtain ScaledValue (see [ScaledValue](#)).

### 2.5. Flow Measurement Cluster

This cluster provides an interface to flow measurement functionality, including configuration and provision of notifications of flow measurements.

#### 2.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                      |
|----------|--------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added |
| 2        | CCB 2241 2370                                    |
| 3        | New data model format and notation               |

#### 2.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | FLW       |

#### 2.5.3. Cluster ID

Page 186



| ID     | Name             |
|--------|------------------|
| 0x0404 | Flow Measurement |

## 2.5.4. Attributes

| ID     | Name                     | Type   | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|--------------------------|--------|--------------------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>Measured-Value</b>    | uint16 | MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | M           |
| 0x0001 | <b>MinMeasured-Value</b> | uint16 | max 65533                            | X       |          | R V    | M           |
| 0x0002 | <b>MaxMeasured-Value</b> | uint16 | min (MinMeasuredValue + 1)           | X       |          | R V    | M           |
| 0x0003 | <b>Tolerance</b>         | uint16 | max 2048                             |         | 0        | R V    | O           |

### 2.5.4.1. MeasuredValue Attribute

This attribute SHALL indicate the flow in  $m^3/h$  as follows:

$\text{MeasuredValue} = 10 \times \text{Flow}$

The null value indicates that the flow measurement is unknown, otherwise the range SHALL be as described in [Measured Value](#).

### 2.5.4.2. MinMeasuredValue Attribute

This attribute SHALL indicate the minimum value of MeasuredValue that can be measured. See [Measured Value](#) for more details.

The null value indicates that the value is not available.

### 2.5.4.3. MaxMeasuredValue Attribute

This attribute SHALL indicate the maximum value of MeasuredValue that can be measured. See [Measured Value](#) for more details.

The null value indicates that the value is not available.

### 2.5.4.4. Tolerance Attribute

See [Measured Value](#).



Page 187



## 2.6. Water Content Measurement Clusters

This is a base cluster. The server cluster provides an interface to water content measurement functionality. The measurement is reportable and may be configured for reporting. Water content measurements currently is, but are not limited to relative humidity.

### 2.6.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                      |
|----------|--------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added |
| 2        | CCB 2241                                         |
| 3        | New data model format and notation               |

### 2.6.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | RH        |

### 2.6.3. Cluster ID

| ID     | Name                          |
|--------|-------------------------------|
| 0x0405 | Relative Humidity Measurement |

### 2.6.4. Attributes

| ID     | Name                     | Type   | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|--------------------------|--------|--------------------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>Measured-Value</b>    | uint16 | MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | M           |
| 0x0001 | <b>MinMeasured-Value</b> | uint16 | max 9999                             | X       |          | R V    | M           |
| 0x0002 | <b>MaxMeasured-Value</b> | uint16 | (MinMeasuredValue + 1) to 10000      | X       |          | R V    | M           |

Page 188







| ID     | Name             | Type   | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------|--------|------------|---------|----------|--------|-------------|
| 0x0003 | <b>Tolerance</b> | uint16 | max 2048   |         |          | RV     | 0           |

#### 2.6.4.1. MeasuredValue Attribute

MeasuredValue represents the water content in % as follows:

MeasuredValue = 100 x water content

Where  $0\% \le \text{water content} \le 100\%$ , corresponding to a MeasuredValue in the range 0 to 10000.

The maximum resolution this format allows is 0.01%.

MinMeasuredValue and MaxMeasuredValue define the range of the sensor.

The null value indicates that the measurement is unknown, otherwise the range SHALL be as described in [Measured Value](#).

MeasuredValue is updated continuously as new measurements are made.

#### 2.6.4.2. MinMeasuredValue Attribute

The MinMeasuredValue attribute indicates the minimum value of MeasuredValue that can be measured. The null value means this attribute is not defined. See [Measured Value](#) for more details.

#### 2.6.4.3. MaxMeasuredValue Attribute

The MaxMeasuredValue attribute indicates the maximum value of MeasuredValue that can be measured. The null value means this attribute is not defined. See [Measured Value](#) for more details.

#### 2.6.4.4. Tolerance Attribute

See [Measured Value](#).

## 2.7. Occupancy Sensing Cluster

The server cluster provides an interface to occupancy sensing functionality based on one or more sensing modalities, including configuration and provision of notifications of occupancy status.

### 2.7.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                 |
|----------|-----------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added                            |
| 2        | Physical Contact Occupancy feature with mandatory OccupancySensorTypeBitmap |




Page 189



| Revision | Description                                                                                                                                                                                                                                                                                                                                                          |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 3        | New data model format and notation                                                                                                                                                                                                                                                                                                                                   |
| 4        | Remove nullable from PhysicalContact delay attributes and ability to not report transitions                                                                                                                                                                                                                                                                          |
| 5        | Rework to add modalities: radar-, ambient-sensing- and vision-based sensors; add sensitivity setting (via co-located BooleanStateConfiguration cluster on same endpoint); add new attribute for tuning the sensor's reporting; add event OccupancyChanged; add <b>N</b> quality for HoldTime and other timing attributes; describe how to accommodate legacy clients |

### 2.7.1.1. Backward compatibility

With the introduction of new sensor modalities in cluster revision 5, the indication for those modalities SHALL be done using feature bits. Indication of those new modalities is not feasible via the legacy attributes OccupancySensorType and OccupancySensorTypeBitmap. Servers SHALL set these attributes for backward compatibility with clients implementing a cluster revision  $\le 4$  as described in [OccupancySensorType and OccupancySensorTypeBitmap Attributes](#). Clients implementing a cluster revision  $\ge 5$  SHOULD use the server's ClusterRevision attribute, and SHOULD ignore these legacy attributes.

With the same revision 5, the attribute HoldTime (along with the HoldTimeLimits) is used to determine the reporting when occupancy is no longer detected. This replaces the 9 legacy attributes PIROccupiedToUnoccupiedDelay through PhysicalContactUnoccupiedToOccupiedThreshold. Servers MAY use the applicable attributes from this set of legacy attributes if and only if HoldTime is supported (see Attribute table and [the corresponding explanation](#) for details on conformance).

For the case of a server which supports none of the modalities supported in ClusterRevision  $\le 4$  (i.e. none of PIR, US and PHY), specific mappings for the legacy attributes OccupancySensorType and OccupancySensorTypeBitmap are provided [below](#), representing this sensor as a PIR sensor for best-effort backward compatibility. For this case, the legacy timing attributes linked to PIR (i.e. PIROccupiedToUnoccupiedDelay through PIRUnoccupiedToOccupiedThreshold) apply.

### 2.7.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | OCC       |

### 2.7.3. Cluster ID

| Cluster ID | Cluster Name      |
|------------|-------------------|
| 0x0406     | Occupancy Sensing |

### 2.7.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below. For sensor devices implementing multiple modalities, please see the guidance provided in the Occupancy Sensor

Page 190



device type description.

| Bit | Code         | Feature         | Conformance | Summary                                                                                                           |
|-----|--------------|-----------------|-------------|-------------------------------------------------------------------------------------------------------------------|
| 0   | <b>OTHER</b> | Other           | O.a+        | Supports sensing using a modality not listed in the other bits                                                    |
| 1   | <b>PIR</b>   | PassiveInfrared | O.a+        | Supports sensing using PIR (Passive InfraRed)                                                                     |
| 2   | <b>US</b>    | Ultrasonic      | O.a+        | Supports sensing using UltraSound                                                                                 |
| 3   | <b>PHY</b>   | PhysicalContact | O.a+        | Supports sensing using a physical contact                                                                         |
| 4   | <b>AIR</b>   | ActiveInfrared  | O.a+        | Supports sensing using Active InfraRed measurement (e.g. time-of-flight or transreflective/reflective IR sensing) |
| 5   | <b>RAD</b>   | Radar           | O.a+        | Supports sensing using radar waves (microwave)                                                                    |
| 6   | <b>RFS</b>   | RFSensing       | O.a+        | Supports sensing using analysis of radio signals, e.g.: RSSI, CSI and/or any other metric from the signal         |
| 7   | <b>VIS</b>   | Vision          | O.a+        | Supports sensing based on analyzing images                                                                        |

## 2.7.5. Data Types

### 2.7.5.1. OccupancyBitmap Type

This data type is derived from map8.

| Bit | Name            | Summary                              | Conformance |
|-----|-----------------|--------------------------------------|-------------|
| 0   | <b>Occupied</b> | Indicates the sensed occupancy state | M           |



Page 191



#### 2.7.5.1.1. Occupied Bit

If this bit is set, it SHALL indicate the occupied state else if the bit is not set, it SHALL indicate the unoccupied state.

#### 2.7.5.2. OccupancySensorTypeBitmap Type

This data type is derived from map8.

| Bit | Name                   | Summary                              | Conformance |
|-----|------------------------|--------------------------------------|-------------|
| 0   | <b>PIR</b>             | Indicates a passive infrared sensor. | M           |
| 1   | <b>Ultrasonic</b>      | Indicates a ultrasonic sensor.       | M           |
| 2   | <b>PhysicalContact</b> | Indicates a physical contact sensor. | M           |

**NOTE**

This enum is as defined in ClusterRevision 4 and its definition SHALL NOT be extended; the feature flags provide the sensor modality (or modalities) for later cluster revisions. See [Backward Compatibility section](#).

#### 2.7.5.3. OccupancySensorTypeEnum Type

This data type is derived from enum8.

| Value | Name                    | Summary                                             | Conformance |
|-------|-------------------------|-----------------------------------------------------|-------------|
| 0     | <b>PIR</b>              | Indicates a passive infrared sensor.                | M           |
| 1     | <b>Ultrasonic</b>       | Indicates a ultrasonic sensor.                      | M           |
| 2     | <b>PIRAndUltrasonic</b> | Indicates a passive infrared and ultrasonic sensor. | M           |
| 3     | <b>PhysicalContact</b>  | Indicates a physical contact sensor.                | M           |

**NOTE**

This enum is as defined in ClusterRevision 4 and its definition SHALL NOT be extended; the feature flags provide the sensor modality (or modalities) for later cluster revisions. See [Backward Compatibility section](#).

#### 2.7.5.4. HoldTimeLimitsStruct Type

This structure provides information on the server's supported values for the HoldTime attribute.

Page 192



| ID | Name                   | Type   | Constraint                       | Quality | Fallback | Access | Conformance |
|----|------------------------|--------|----------------------------------|---------|----------|--------|-------------|
| 0  | <b>HoldTimeMin</b>     | uint16 | min 1                            |         |          |        | M           |
| 1  | <b>HoldTimeMax</b>     | uint16 | min<br>maxOf(HoldTimeMin,<br>10) |         |          |        | M           |
| 2  | <b>HoldTimeDefault</b> | uint16 | HoldTimeMin<br>to HoldTimeMax    |         |          |        | M           |

#### 2.7.5.4.1. HoldTimeMin Field

This field SHALL specify the minimum value of the server's supported value for the HoldTime attribute, in seconds.

#### 2.7.5.4.2. HoldTimeMax Field

This field SHALL specify the maximum value of the server's supported value for the HoldTime attribute, in seconds.

#### 2.7.5.4.3. HoldTimeDefault Field

This field SHALL specify the (manufacturer-determined) default value of the server's HoldTime attribute, in seconds. This is the value that a client who wants to reset the settings to a valid default SHOULD use.

### 2.7.6. Attributes

| ID   | Name                             | Type                      | Constraint | Quality | Fallback | Access | Conformance |
|------|----------------------------------|---------------------------|------------|---------|----------|--------|-------------|
| 0x00 | <b>Occupancy</b>                 | OccupancyBitmap           | 0 to 1     | P       |          | RV     | M           |
| 0x00 | <b>OccupancySensorType</b>       | OccupancySensorTypeEnum   | desc       | F       |          | RV     | M, D        |
| 0x00 | <b>OccupancySensorTypeBitmap</b> | OccupancySensorTypeBitmap | 0 to 7     | F       |          | RV     | M, D        |




Page 193



| ID         | Name                                                       | Type                           | Con-<br>strai<br>nt                                                                                                          | Qual<br>ity | Fall-<br>back | Acce<br>ss | Conformance                                                                                                              |
|------------|------------------------------------------------------------|--------------------------------|------------------------------------------------------------------------------------------------------------------------------|-------------|---------------|------------|--------------------------------------------------------------------------------------------------------------------------|
| 0x00<br>03 | <b>HoldTime</b>                                            | uint16                         | Hold<br>-<br>Time<br>Lim-<br>its.H<br>old-<br>Time<br>Min<br>to<br>Hold<br>-<br>Time<br>Lim-<br>its.H<br>old-<br>Time<br>Max | N           |               | RW<br>VM   | O                                                                                                                        |
| 0x00<br>04 | <b>HoldTimeLimits</b>                                      | HoldTime-<br>Lim-<br>itsStruct |                                                                                                                              | F           |               | R V        | HoldTime                                                                                                                 |
| 0x00<br>10 | <b>PIROccupied-<br/>ToUnoccupied-<br/>Delay</b>            | uint16                         | all                                                                                                                          | N           | 0             | RW<br>VM   | [HoldTime & (PIR   (!PIR & !US & !PHY))], D                                                                              |
| 0x00<br>11 | <b>PIRUnoccupied-<br/>ToOccupiedDe-<br/>lay</b>            | uint16                         | all                                                                                                                          | N           | 0             | RW<br>VM   | (HoldTime & (PIR   (!PIR & !US & !PHY))) & PIRUnoccupiedToOccupiedThreshold, [HoldTime & (PIR   (!PIR & !US & !PHY))], D |
| 0x00<br>12 | <b>PIRUnoccupied-<br/>ToOccu-<br/>piedThreshold</b>        | uint8                          | 1 to<br>254                                                                                                                  | N           | 1             | RW<br>VM   | (HoldTime & (PIR   (!PIR & !US & !PHY))) & PIRUnoccupiedToOccupiedDelay, [HoldTime & (PIR   (!PIR & !US & !PHY))], D     |
| 0x00<br>20 | <b>UltrasonicOccu-<br/>piedToUnoccu-<br/>piedDelay</b>     | uint16                         | all                                                                                                                          | N           | 0             | RW<br>VM   | [HoldTime & US], D                                                                                                       |
| 0x00<br>21 | <b>UltrasonicUnoc-<br/>cupiedToOccu-<br/>piedDelay</b>     | uint16                         | all                                                                                                                          | N           | 0             | RW<br>VM   | HoldTime & US & UltrasonicUnoccupiedToOccupiedThreshold, [HoldTime & US], D                                              |
| 0x00<br>22 | <b>UltrasonicUnoc-<br/>cupiedToOccu-<br/>piedThreshold</b> | uint8                          | 1 to<br>254                                                                                                                  | N           | 1             | RW<br>VM   | HoldTime & US & UltrasonicUnoccupiedToOccupiedDelay, [HoldTime & US], D                                                  |

Page 194







| ID     | Name                                     | Type   | Constraint | Quality | Fallback | Access | Conformance                                                                        |
|--------|------------------------------------------|--------|------------|---------|----------|--------|------------------------------------------------------------------------------------|
| 0x0030 | PhysicalContactOccupiedToUnoccupiedDelay | uint16 | all        | N       | 0        | RW VM  | [HoldTime & PHY], D                                                                |
| 0x0031 | PhysicalContactUnoccupiedToOccupiedDelay | uint16 | all        | N       | 0        | RW VM  | HoldTime & PHY & PhysicalContactUnoccupiedToOccupiedThreshold, [HoldTime & PHY], D |
| 0x0032 | PhysicalContactUnoccupiedThreshold       | uint8  | 1 to 254   | N       | 1        | RW VM  | HoldTime & PHY & PhysicalContactUnoccupiedToOccupiedDelay, [HoldTime & PHY], D     |

#### 2.7.6.1. Occupancy Attribute

This attribute SHALL indicate the sensed (processed) status of occupancy. For compatibility reasons this is expressed as a bitmap where the status is indicated in bit 0: a value of 1 means occupied, and 0 means unoccupied, with the other bits set to 0; this can be considered equivalent to a boolean.

#### 2.7.6.2. OccupancySensorType and OccupancySensorTypeBitmap Attributes

These attributes SHALL indicate the type of sensor. In ClusterRevision  $\le 4$ , these were used to specify the type of the occupancy sensor using a bitmap. For ClusterRevision  $>= 5$ , the server SHALL indicate the type of sensor using the feature flags, and the server SHALL provide these attributes for the backward compatibility with clients implementing a cluster revision  $\le 4$ , using the mapping according to the following table. Also see [Backward Compatibility section](#).

| Feature Flag Value |    |     | Value of OccupancySensorTypeBitmap | Value of OccupancySensorType |
|--------------------|----|-----|------------------------------------|------------------------------|
| PIR                | US | PHY |                                    |                              |
| 0                  | 0  | 0   | PIR *                              | PIR *                        |
| 1                  | 0  | 0   | PIR                                | PIR                          |
| 0                  | 1  | 0   | Ultrasonic                         | Ultrasonic                   |
| 1                  | 1  | 0   | PIR + Ultrasonic                   | PIRAndUltrasonic             |
| 0                  | 0  | 1   | PhysicalContact                    | PhysicalContact              |
| 1                  | 0  | 1   | PhysicalContact + PIR              | PIR **                       |
| 0                  | 1  | 1   | PhysicalContact + Ultrasonic       | Ultrasonic **                |



Page 195



| Feature Flag Value |   |   | Value of OccupancySensorTypeBitmap | Value of OccupancySensorType |
|--------------------|---|---|------------------------------------|------------------------------|
| 1                  | 1 | 1 | PhysicalContact + PIR + Ultrasonic | PIRAndUltrasonic             |

\* In case the feature flags PIR, US and PHY are all set to 0, these attributes are set to mimic a PIR sensor since this likely will give the best compatibility with clients implementing a cluster revision  $\le 4$ , which are not aware of the feature flags and the added modalities. In this case, timing parameters (when HoldTime is supported) are expressed using the PIROccupiedToUnoccupiedDelay, PIRUnoccupiedToOccupiedDelay and PIRUnoccupiedToOccupiedThreshold attributes.

\*\* These combinations of sensor type were not defined for OccupancySensorType in ClusterRevision  $\le 4$ , so they are mapped to a combination which *was* defined in that version.

### 2.7.6.3. HoldTime Attribute

This attribute SHALL specify the time delay, in seconds, before the sensor changes to its unoccupied state after the last detection of occupancy in the sensed area. This is equivalent to the legacy \*OccupiedToUnoccupiedDelay attributes.

Low values of HoldTime SHOULD be avoided since they could lead to many reporting messages. A value 0 for HoldTime SHALL NOT be used.

The figure below illustrates this with an example of how this attribute is used for a PIR sensor. It uses threshold detection to generate an "internal detection" signal, which needs post-processing to become usable for transmission (traffic shaping). The bit in the Occupancy attribute will be set to 1 when the internal detection signal goes high, and will stay at 1 for HoldTime after the (last) instance where the internal detection signal goes low.

The top half of the figure shows the case of a single trigger: the bit in the Occupancy attribute will be 1 for the duration of the PIR signal exceeding the threshold plus HoldTime. The bottom half of the figure shows the case of multiple triggers: the second trigger starts before the HoldTime of the first trigger has expired; this results in a single period of the bit in the Occupancy attribute being 1. The bit in the Occupancy attribute will be set to 1 from the start of the first period where the PIR signal exceeds the threshold until HoldTime after the last moment where the PIR exceeded the threshold.

Page 196







*single trigger case*![Diagram illustrating the single trigger case for PIR signal processing. The top part shows a PIR signal graph with a red dashed threshold line. A red circle marks the first crossing of the threshold. Below the graph, the 'internal detection' signal shows a series of short pulses. An arrow points from the first pulse to the 'Occupancy attribute' signal, which is a long horizontal bar. A 'HoldTime' arrow indicates the duration of this occupancy state.](df72bd7468eb8bd59e911d0b5cb7a810_img.jpg)

The diagram illustrates the 'single trigger case' for PIR signal processing. It consists of three main parts: a PIR signal graph, an 'internal detection' signal, and an 'Occupancy attribute' signal.

- PIR signal graph:** Shows a fluctuating blue line representing the sensor output. A red dashed horizontal line represents the 'threshold'. A red circle marks the first point where the signal crosses the threshold.
- internal detection:** A horizontal line with a series of short, rectangular pulses. The first pulse corresponds to the first threshold crossing marked by the red circle.
- Occupancy attribute:** A horizontal line that is low until the first pulse of the 'internal detection' signal, then becomes high for a duration indicated by the 'HoldTime' arrow.

Diagram illustrating the single trigger case for PIR signal processing. The top part shows a PIR signal graph with a red dashed threshold line. A red circle marks the first crossing of the threshold. Below the graph, the 'internal detection' signal shows a series of short pulses. An arrow points from the first pulse to the 'Occupancy attribute' signal, which is a long horizontal bar. A 'HoldTime' arrow indicates the duration of this occupancy state.

*multiple trigger case*![Diagram illustrating the multiple trigger case for PIR signal processing. The top part shows two PIR signal graphs with a red dashed threshold line. A red circle marks the first crossing of the threshold in the first graph. Below the graphs, the 'internal detection' signal shows a series of short pulses. An arrow points from the first pulse to the 'Occupancy attribute' signal, which is a long horizontal bar. A 'HoldTime' arrow indicates the duration of this occupancy state. A dashed vertical line labeled 'retriggering within HoldTime' shows that if another pulse occurs within the HoldTime, the occupancy state is renewed.](54d030ecf3f147af8773b8a23549856e_img.jpg)

The diagram illustrates the 'multiple trigger case' for PIR signal processing. It consists of three main parts: two PIR signal graphs, an 'internal detection' signal, and an 'Occupancy attribute' signal.

- PIR signal graph:** Shows two separate graphs of a fluctuating blue line. Each graph has a red dashed horizontal line representing the 'threshold'. A red circle marks the first crossing of the threshold in the first graph.
- internal detection:** A horizontal line with a series of short, rectangular pulses. The first pulse corresponds to the first threshold crossing marked by the red circle.
- Occupancy attribute:** A horizontal line that is low until the first pulse of the 'internal detection' signal, then becomes high for a duration indicated by the 'HoldTime' arrow. A dashed vertical line labeled 'retriggering within HoldTime' indicates that if another pulse occurs within the HoldTime, the occupancy state is renewed.

Diagram illustrating the multiple trigger case for PIR signal processing. The top part shows two PIR signal graphs with a red dashed threshold line. A red circle marks the first crossing of the threshold in the first graph. Below the graphs, the 'internal detection' signal shows a series of short pulses. An arrow points from the first pulse to the 'Occupancy attribute' signal, which is a long horizontal bar. A 'HoldTime' arrow indicates the duration of this occupancy state. A dashed vertical line labeled 'retriggering within HoldTime' shows that if another pulse occurs within the HoldTime, the occupancy state is renewed.

Figure 13. Processing of PIR signal towards Occupancy attribute using HoldTime

#### 2.7.6.4. HoldTimeLimits Attribute

This attribute SHALL indicate the server's limits, and default value, for the HoldTime attribute.

#### 2.7.6.5. Attributes to support legacy implementations

The following 3 sets of 3 attributes each were used in ClusterRevision  $\le 4$  to indicate timings and conditions to tune the reporting by the sensor - separately for each of the three sensor modalities defined in that revision. In ClusterRevision  $\ge 5$ , these are replaced by the HoldTime attribute (shared for all modalities). A server with ClusterRevision  $\ge 5$  MAY (under the conformance conditions stated in the attributes table above) provide these attributes for backward compatibility with clients implementing a cluster revision  $\le 4$ . When doing so, the provided values for these legacy \*OccupiedToUnoccupied attributes SHALL follow the values in the HoldTime attribute when updated, and vice-versa, such that any present \*OccupiedToUnoccupiedDelay attribute maintains equality to HoldTime.



Page 197



Also see [Backward Compatibility section](#).

Some, but not all, of the implications of the conformance rules for these attributes are:

- if attribute HoldTime is not supported, these 9 legacy attributes SHALL NOT be supported
- if modality PIR is supported, while both PHY and US modalities are not supported,
  - the 3 legacy attributes related to PIR MAY be supported (if allowed by the other rules)
  - the 6 legacy attributes related to Ultrasonic and PhysicalContact SHALL NOT be supported
- if modality US is supported while both PIR and PHY modalities are not supported:
  - the 3 legacy attributes related to UltraSonic MAY be supported (if allowed by the other rules)
  - the 6 legacy attributes related to PIR and PhysicalContact SHALL NOT be supported
- if modality PHY is supported while both PIR and US modalities are not supported:
  - the 3 legacy attributes related to PhysicalContact MAY be supported (if allowed by the other rules)
  - the 6 legacy attributes related to PIR and Ultrasonic SHALL NOT be supported
- the legacy attributes related to UnoccupiedToOccupiedDelay and UnoccupiedToOccupiedThreshold for a certain modality SHALL be both supported or both not supported
- if none of the modalities PIR, US, and PHY is supported (this case is presented as a PIR sensor for compatibility):
  - the 3 legacy attributes related to PIR MAY be supported (if allowed by the other rules)
  - the 6 legacy attributes related to Ultrasonic and PhysicalContact SHALL NOT be supported

For cases where more than one of the PIR, PHY and US modalities is supported *and* the timing parameters are provided for more than one modality, it is manufacturer specific how to combine those timing parameters.

#### **2.7.6.6. PIROccupiedToUnoccupiedDelay Attribute**

This attribute SHALL specify the time delay, in seconds, before the PIR sensor changes to its unoccupied state after the last detection of occupancy in the sensed area.

#### **2.7.6.7. PIRUnoccupiedToOccupiedDelay Attribute**

This attribute SHALL specify the time delay, in seconds, before the PIR sensor changes to its occupied state after the first detection of occupancy in the sensed area.

#### **2.7.6.8. PIRUnoccupiedToOccupiedThreshold Attribute**

This attribute SHALL specify the number of occupancy detection events that must occur in the period PIRUnoccupiedToOccupiedDelay, before the PIR sensor changes to its occupied state.

#### **2.7.6.9. UltrasonicOccupiedToUnoccupiedDelay Attribute**

This attribute SHALL specify the time delay, in seconds, before the Ultrasonic sensor changes to its unoccupied state after the last detection of occupancy in the sensed area.

Page 198



#### 2.7.6.10. UltrasonicUnoccupiedToOccupiedDelay Attribute

This attribute SHALL specify the time delay, in seconds, before the Ultrasonic sensor changes to its occupied state after the first detection of occupancy in the sensed area.

#### 2.7.6.11. UltrasonicUnoccupiedToOccupiedThreshold Attribute

This attribute SHALL specify the number of occupancy detection events that must occur in the period UltrasonicUnoccupiedToOccupiedDelay, before the Ultrasonic sensor changes to its occupied state.

#### 2.7.6.12. PhysicalContactOccupiedToUnoccupiedDelay Attribute

This attribute SHALL specify the time delay, in seconds, before the physical contact occupancy sensor changes to its unoccupied state after detecting the unoccupied event.

#### 2.7.6.13. PhysicalContactUnoccupiedToOccupiedDelay Attribute

This attribute SHALL specify the time delay, in seconds, before the physical contact sensor changes to its occupied state after the first detection of the occupied event.

#### 2.7.6.14. PhysicalContactUnoccupiedToOccupiedThreshold Attribute

This attribute SHALL specify the number of occupancy detection events that must occur in the period PhysicalContactUnoccupiedToOccupiedDelay, before the PhysicalContact sensor changes to its occupied state.

### 2.7.7. Events

| ID   | Name              | Priority | Quality | Access | Conformance |
|------|-------------------|----------|---------|--------|-------------|
| 0x00 | Occupancy-Changed | INFO     |         | V      | O           |

#### 2.7.7.1. OccupancyChanged Event

If this event is supported, it SHALL be generated when the Occupancy attribute changes.

| ID | Name      | Type             | Constraint | Quality | Fallback | Conformance |
|----|-----------|------------------|------------|---------|----------|-------------|
| 0  | Occupancy | Occupancy-Bitmap |            |         |          | M           |

##### 2.7.7.1.1. Occupancy Field

This field SHALL indicate the new value of the Occupancy attribute.

## 2.8. Resource Monitoring Clusters

This generic cluster provides an interface to the current condition of a resource. A resource is a




Page 199



component of a device that is designed to be replaced, refilled, or emptied when exhausted or full. Examples of resources include filters, cartridges, and water tanks. While batteries fit this definition they are not intended to be used with this cluster. Use the power source cluster for batteries instead.

**NOTE**

This cluster is not meant to be used for monitoring of the system resources, such as processing, memory utilization, networking properties, etc.

This cluster SHALL be used via an alias to a specific resource type (see [Cluster IDs](#)).

### 2.8.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 2.8.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | REPM      |

### 2.8.3. Cluster IDs

The table below is a list of aliased Cluster IDs which represent different resource types and conform to this cluster definition.

| ID     | Name                               | PICS       |
|--------|------------------------------------|------------|
| 0x0071 | HEPA Filter Monitoring             | HEPAFREMON |
| 0x0072 | Activated Carbon Filter Monitoring | ACFREMON   |
| 0x0079 | Water Tank Level Monitoring        | WTLREPMON  |

### 2.8.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature   | Conformance | Summary                                                         |
|-----|------|-----------|-------------|-----------------------------------------------------------------|
| 0   | CON  | Condition | 0           | Supports monitoring the condition of the resource in percentage |
| 1   | WRN  | Warning   | 0           | Supports warning indication                                     |

Page 200







| Bit | Code | Feature                | Conformance | Summary                                              |
|-----|------|------------------------|-------------|------------------------------------------------------|
| 2   | REP  | ReplacementProductList | O           | Supports specifying the list of replacement products |

## 2.8.5. Data Types

### 2.8.5.1. DegradationDirectionEnum Type

This data type is derived from enum8.

Indicates the direction in which the condition of the resource changes over time.

| Value | Name | Summary                                                                             | Conformance |
|-------|------|-------------------------------------------------------------------------------------|-------------|
| 0     | Up   | The degradation of the resource is indicated by an upwards moving/increasing value  | M           |
| 1     | Down | The degradation of the resource is indicated by a downwards moving/decreasing value | M           |

### 2.8.5.2. ChangeIndicationEnum Type

This data type is derived from enum8.

| Value | Name     | Summary                                                                | Conformance |
|-------|----------|------------------------------------------------------------------------|-------------|
| 0     | OK       | Resource is in good condition, no intervention required                | M           |
| 1     | Warning  | Resource will be exhausted soon, intervention will shortly be required | WRN         |
| 2     | Critical | Resource is exhausted, immediate intervention is required              | M           |

### 2.8.5.3. ProductIdentifierTypeEnum Type

This data type is derived from enum8.

Indicate the type of identifier used to describe the product. Devices SHOULD use globally-recognized IDs over OEM specific ones.




Page 201



| Value | Name    | Summary                                     | Conformance |
|-------|---------|---------------------------------------------|-------------|
| 0     | UPC     | 12-digit Universal Product Code             | M           |
| 1     | GTIN-8  | 8-digit Global Trade Item Number            | M           |
| 2     | EAN     | 13-digit European Article Number            | M           |
| 3     | GTIN-14 | 14-digit Global Trade Item Number           | M           |
| 4     | OEM     | Original Equipment Manufacturer part number | M           |

#### 2.8.5.4. ReplacementProductStruct Type

Indicates the product identifier that can be used as a replacement for the resource.

| ID | Name                   | Type                      | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|---------------------------|------------|---------|----------|--------|-------------|
| 0  | ProductIdentifierType  | ProductIdentifierTypeEnum | desc       |         |          |        | M           |
| 1  | ProductIdentifierValue | string                    | max 20     |         |          |        | M           |

#### 2.8.6. Attributes

| ID     | Name                 | Type                     | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------------|--------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | Condition            | percent                  |            |         |          | R V    | CON         |
| 0x0001 | DegradationDirection | DegradationDirectionEnum | desc       | F       |          | R V    | CON         |
| 0x0002 | ChangeIndication     | ChangeIndicationEnum     |            |         |          | R V    | M           |
| 0x0003 | InPlaceIndicator     | bool                     |            |         |          | R V    | O           |
| 0x0004 | LastChangedTime      | epoch-s                  | all        | N X     | null     | RW VO  | O           |

Page 202







| ID     | Name                          | Type                                             | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------------------|--------------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0005 | <b>ReplacementProductList</b> | list[ <a href="#">ReplacementProductStruct</a> ] | max 5      | F       |          | RV     | REP         |

#### 2.8.6.1. Condition Attribute

This attribute SHALL indicate the current condition of the resource in percent.

#### 2.8.6.2. DegradationDirection Attribute

This attribute SHALL indicate the direction of change for the condition of the resource over time, which helps to determine whether a higher or lower condition value is considered optimal.

#### 2.8.6.3. ChangeIndication Attribute

This attribute SHALL be populated with a value from [ChangeIndicationEnum](#) that is indicative of the current requirement to change the resource.

#### 2.8.6.4. InPlaceIndicator Attribute

This attribute SHALL indicate whether a resource is currently installed. A value of true SHALL indicate that a resource is installed. A value of false SHALL indicate that a resource is not installed.

#### 2.8.6.5. LastChangedTime Attribute

This attribute MAY indicates the time at which the resource has been changed, if supported by the server. The attribute SHALL be null if it was never set or is unknown.

#### 2.8.6.6. ReplacementProductList Attribute

This attribute SHALL indicate the list of supported products that may be used as replacements for the current resource. Each item in this list represents a unique [ReplacementProductStruct](#).

### 2.8.7. Commands

| ID   | Name                  | Direction                   | Response | Access | Conformance |
|------|-----------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>ResetCondition</b> | client $\Rightarrow$ server | Y        | O      | O           |

#### 2.8.7.1. ResetCondition Command

Upon receipt, the device SHALL reset the Condition and ChangeIndicator attributes, indicating full resource availability and readiness for use, as initially configured. Invocation of this command MAY cause the LastChangedTime to be updated automatically based on the clock of the server, if the server supports setting the attribute.



Page 203



## 2.9. Air Quality Cluster

This cluster provides an interface to air quality classification using distinct levels with human-readable labels.

### 2.9.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 2.9.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | AIRQUAL   |

### 2.9.3. Cluster ID

| ID     | Name        |
|--------|-------------|
| 0x005B | Air Quality |

### 2.9.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code  | Feature       | Conformance | Summary                                               |
|-----|-------|---------------|-------------|-------------------------------------------------------|
| 0   | FAIR  | Fair          | 0           | Cluster supports the Fair air quality level           |
| 1   | MOD   | Moderate      | 0           | Cluster supports the Moderate air quality level       |
| 2   | VPOOR | VeryPoor      | 0           | Cluster supports the Very poor air quality level      |
| 3   | XPOOR | ExtremelyPoor | 0           | Cluster supports the Extremely poor air quality level |

Page 204







## 2.9.5. Data Types

### 2.9.5.1. AirQualityEnum Type

This data type is derived from `enum8`.

The `AirQualityEnum` provides a representation of the quality of the analyzed air. It is up to the device manufacturer to determine the mapping between the measured values and their corresponding enumeration values.

| Value | Name                 | Summary                            | Conformance |
|-------|----------------------|------------------------------------|-------------|
| 0     | <b>Unknown</b>       | The air quality is unknown.        | M           |
| 1     | <b>Good</b>          | The air quality is good.           | M           |
| 2     | <b>Fair</b>          | The air quality is fair.           | FAIR        |
| 3     | <b>Moderate</b>      | The air quality is moderate.       | MOD         |
| 4     | <b>Poor</b>          | The air quality is poor.           | M           |
| 5     | <b>VeryPoor</b>      | The air quality is very poor.      | VPOOR       |
| 6     | <b>ExtremelyPoor</b> | The air quality is extremely poor. | XPOOR       |

### 2.9.6. Attributes

| ID     | Name              | Type                           | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------|--------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>AirQuality</b> | <a href="#">AirQualityEnum</a> | desc       |         |          | RV     | M           |

#### 2.9.6.1. AirQuality Attribute

This attribute SHALL indicate a value from [AirQualityEnum](#) that is indicative of the currently measured air quality.

## 2.10. Concentration Measurement Clusters

The server cluster provides an interface to concentration measurement functionality.

This cluster SHALL be used via an alias to a specific substance (see [Cluster IDs](#)).

### 2.10.1. Revision History

The global `ClusterRevision` attribute value SHALL be the highest revision number in the table below.




Page 205



| Revision | Description                                                                                                                   |
|----------|-------------------------------------------------------------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added                                                                              |
| 2        | CCB 2882                                                                                                                      |
| 3        | Cluster redesigned to add support for Level Indication, Peak/Average Measurement, Medium/Unit of Measurement and Uncertainty. |

## 2.10.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | CONC      |

## 2.10.3. Cluster IDs

The table below is a list of Cluster IDs that conform to this specification.

| ID     | Name                                                       | PICS     |
|--------|------------------------------------------------------------|----------|
| 0x040C | Carbon Monoxide Concentration Measurement                  | CMOCONC  |
| 0x040D | Carbon Dioxide Concentration Measurement                   | CDOCONC  |
| 0x0413 | Nitrogen Dioxide Concentration Measurement                 | NDOCONC  |
| 0x0415 | Ozone Concentration Measurement                            | OZCONC   |
| 0x042A | PM2.5 Concentration Measurement                            | PMICONC  |
| 0x042B | Formaldehyde Concentration Measurement                     | FLDCONC  |
| 0x042C | PM1 Concentration Measurement                              | PMHCONC  |
| 0x042D | PM10 Concentration Measurement                             | PMKCONC  |
| 0x042E | Total Volatile Organic Compounds Concentration Measurement | TVOCCONC |
| 0x042F | Radon Concentration Measurement                            | RNCONC   |

Page 206



## 2.10.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature            | Conformance | Summary                                                                                 |
|-----|------|--------------------|-------------|-----------------------------------------------------------------------------------------|
| 0   | MEA  | NumericMeasurement | O.a+        | Cluster supports numeric measurement of substance                                       |
| 1   | LEV  | LevelIndication    | O.a+        | Cluster supports basic level indication for substance using the ConcentrationLevel enum |
| 2   | MED  | MediumLevel        | [LEV]       | Cluster supports the Medium Concentration Level                                         |
| 3   | CRI  | CriticalLevel      | [LEV]       | Cluster supports the Critical Concentration Level                                       |
| 4   | PEA  | PeakMeasurement    | [MEA]       | Cluster supports peak numeric measurement of substance                                  |
| 5   | AVG  | AverageMeasurement | [MEA]       | Cluster supports average numeric measurement of substance                               |

## 2.10.5. Data Types

### 2.10.5.1. MeasurementUnitEnum Type

This data type is derived from enum8.

| Value | Name | Summary                          | Conformance |
|-------|------|----------------------------------|-------------|
| 0     | PPM  | Parts per Million ( $10^6$ )     | MEA         |
| 1     | PPB  | Parts per Billion ( $10^9$ )     | MEA         |
| 2     | PPT  | Parts per Trillion ( $10^{12}$ ) | MEA         |
| 3     | MGM3 | Milligram per m <sup>3</sup>     | MEA         |
| 4     | UGM3 | Microgram per m <sup>3</sup>     | MEA         |
| 5     | NGM3 | Nanogram per m <sup>3</sup>      | MEA         |
| 6     | PM3  | Particles per m <sup>3</sup>     | MEA         |



Page 207



| Value | Name | Summary                      | Conformance |
|-------|------|------------------------------|-------------|
| 7     | BQM3 | Becquerel per m <sup>3</sup> | MEA         |

Where mentioned, Billion refers to 10<sup>9</sup>, Trillion refers to 10<sup>12</sup> (short scale).

#### 2.10.5.2. MeasurementMediumEnum Type

This data type is derived from enum8.

| Value | Name  | Summary                                | Conformance |
|-------|-------|----------------------------------------|-------------|
| 0     | Air   | The measurement is being made in Air   | M           |
| 1     | Water | The measurement is being made in Water | M           |
| 2     | Soil  | The measurement is being made in Soil  | M           |

#### 2.10.5.3. LevelValueEnum Type

This data type is derived from enum8.

| Value | Name     | Summary                          | Conformance |
|-------|----------|----------------------------------|-------------|
| 0     | Unknown  | The level is Unknown             | M           |
| 1     | Low      | The level is considered Low      | M           |
| 2     | Medium   | The level is considered Medium   | MED         |
| 3     | High     | The level is considered High     | M           |
| 4     | Critical | The level is considered Critical | CRI         |

### 2.10.6. Attributes

| ID     | Name           | Type   | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|----------------|--------|--------------------------------------|---------|----------|--------|-------------|
| 0x0000 | Measured-Value | single | MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | MEA         |

Page 208







| ID     | Name                               | Type                  | Constraint                           | Quality | Fallback | Access | Conformance |
|--------|------------------------------------|-----------------------|--------------------------------------|---------|----------|--------|-------------|
| 0x0001 | <b>MinMeasured-Value</b>           | single                | all                                  | X       |          | R V    | MEA         |
| 0x0002 | <b>MaxMeasured-Value</b>           | single                | min MinMeasured-Value                | X       |          | R V    | MEA         |
| 0x0003 | <b>PeakMeasured-Value</b>          | single                | MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | PEA         |
| 0x0004 | <b>PeakMeasuredValueWindow</b>     | elapsed-s             | max 604800                           | P       |          | R V    | PEA         |
| 0x0005 | <b>AverageMeasured-Value</b>       | single                | MinMeasuredValue to MaxMeasuredValue | P X     |          | R V    | AVG         |
| 0x0006 | <b>AverageMeasured-ValueWindow</b> | elapsed-s             | max 604800                           | P       |          | R V    | AVG         |
| 0x0007 | <b>Uncertainty</b>                 | single                | MS                                   |         | MS       | R V    | [MEA]       |
| 0x0008 | <b>MeasurementUnit</b>             | MeasurementUnitEnum   |                                      | F       |          | R V    | MEA         |
| 0x0009 | <b>MeasurementMedium</b>           | MeasurementMediumEnum |                                      | F       |          | R V    | M           |
| 0x000A | <b>Level-Value</b>                 | LevelValueEnum        |                                      |         |          | R V    | LEV         |

#### 2.10.6.1. MeasuredValue Attribute

This attribute SHALL represent the most recent measurement as a single-precision floating-point number. MeasuredValue's unit is represented by MeasurementUnit.

A value of null indicates that the measurement is unknown or outside the valid range.

MinMeasuredValue and MaxMeasuredValue define the valid range for MeasuredValue.



Page 209



#### **2.10.6.2. MinMeasuredValue Attribute**

This attribute SHALL represent the minimum value of MeasuredValue that is capable of being measured. A MinMeasuredValue of null indicates that the MinMeasuredValue is not defined.

#### **2.10.6.3. MaxMeasuredValue Attribute**

This attribute SHALL represent the maximum value of MeasuredValue that is capable of being measured. A MaxMeasuredValue of null indicates that the MaxMeasuredValue is not defined.

#### **2.10.6.4. PeakMeasuredValue Attribute**

This attribute SHALL represent the maximum value of MeasuredValue that has been measured during the [PeakMeasuredValueWindow](#). If this attribute is provided, the PeakMeasuredValueWindow attribute SHALL also be provided.

#### **2.10.6.5. PeakMeasuredValueWindow Attribute**

This attribute SHALL represent the window of time used for determining the PeakMeasuredValue. The value is in seconds.

#### **2.10.6.6. AverageMeasuredValue Attribute**

This attribute SHALL represent the average value of MeasuredValue that has been measured during the [AverageMeasuredValueWindow](#). If this attribute is provided, the AverageMeasuredValueWindow attribute SHALL also be provided.

#### **2.10.6.7. AverageMeasuredValueWindow Attribute**

This attribute SHALL represent the window of time used for determining the AverageMeasuredValue. The value is in seconds.

#### **2.10.6.8. Uncertainty Attribute**

This attribute SHALL represent the range of error or deviation that can be found in MeasuredValue and PeakMeasuredValue. This is considered a +/- value and should be considered to be in MeasurementUnit.

#### **2.10.6.9. MeasurementUnit Attribute**

This attribute SHALL represent the unit of MeasuredValue. See [MeasurementUnitEnum](#).

#### **2.10.6.10. MeasurementMedium Attribute**

This attribute SHALL represent the medium in which MeasuredValue or LevelValue is being measured. See [MeasurementMediumEnum](#).

#### **2.10.6.11. LevelValue Attribute**

This attribute SHALL represent the level of the substance detected. See [LevelValueEnum](#).

Page 210







## 2.11. Smoke CO Alarm Cluster

This cluster provides an interface for observing and managing the state of smoke and CO alarms.

### 2.11.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 2.11.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | SMOKECO   |

### 2.11.3. Cluster ID

| ID     | Name           |
|--------|----------------|
| 0x005C | Smoke CO Alarm |

### 2.11.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code  | Feature    | Conformance | Summary              |
|-----|-------|------------|-------------|----------------------|
| 0   | SMOKE | SmokeAlarm | O.a+        | Supports Smoke alarm |
| 1   | CO    | COAlarm    | O.a+        | Supports CO alarm    |

### 2.11.5. Data Types

#### 2.11.5.1. AlarmStateEnum Type

This data type is derived from enum8.

| Value | Name     | Summary                                   | Conformance |
|-------|----------|-------------------------------------------|-------------|
| 0     | Normal   | Nominal state, the device is not alarming | M           |
| 1     | Warning  | Warning state                             | O           |
| 2     | Critical | Critical state                            | M           |




Page 211



#### 2.11.5.1.1. Normal Value

This value SHALL indicate that this alarm is not alarming.

#### 2.11.5.1.2. Warning Value

This value SHALL indicate that this alarm is in a warning state. Alarms in this state SHOULD be subject to being muted via physical interaction.

#### 2.11.5.1.3. Critical Value

This value SHALL indicate that this alarm is in a critical state. Alarms in this state SHALL NOT be subject to being muted via physical interaction.

#### 2.11.5.2. SensitivityEnum Type

This data type is derived from enum8.

| Value | Name            | Summary              | Conformance |
|-------|-----------------|----------------------|-------------|
| 0     | <b>High</b>     | High sensitivity     | O           |
| 1     | <b>Standard</b> | Standard Sensitivity | M           |
| 2     | <b>Low</b>      | Low sensitivity      | O           |

#### 2.11.5.3. ExpressedStateEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                   | Conformance |
|-------|--------------------------|-------------------------------------------|-------------|
| 0     | <b>Normal</b>            | Nominal state, the device is not alarming | M           |
| 1     | <b>SmokeAlarm</b>        | Smoke Alarm state                         | SMOKE       |
| 2     | <b>COAlarm</b>           | CO Alarm state                            | CO          |
| 3     | <b>BatteryAlert</b>      | Battery Alert State                       | M           |
| 4     | <b>Testing</b>           | Test in Progress                          | M           |
| 5     | <b>HardwareFault</b>     | Hardware Fault Alert State                | M           |
| 6     | <b>EndOfService</b>      | End of Service Alert State                | M           |
| 7     | <b>InterconnectSmoke</b> | Interconnected Smoke Alarm State          | O           |
| 8     | <b>InterconnectCO</b>    | Interconnected CO Alarm State             | O           |

Page 212







#### 2.11.5.3.1. Normal Value

This value SHALL indicate that this alarm is not alarming.

#### 2.11.5.3.2. SmokeAlarm Value

This value SHALL indicate that this alarm is currently expressing visual indication of Smoke Alarm. This value SHALL indicate that the alarm is currently expressing audible indication of Smoke Alarm unless the DeviceMuted attribute is supported and set to Muted.

#### 2.11.5.3.3. COAlarm Value

This value SHALL indicate that this alarm is currently expressing visual indication of CO Alarm. This value SHALL indicate that the alarm is currently expressing audible indication of CO Alarm unless the DeviceMuted attribute is supported and set to Muted.

#### 2.11.5.3.4. BatteryAlert Value

This value SHALL indicate that this alarm is currently expressing visual indication of Critical Low Battery. This value SHALL indicate that the alarm is currently expressing audible indication of Critical Low Battery unless the DeviceMuted attribute is supported and set to Muted.

#### 2.11.5.3.5. Testing Value

This value SHALL indicate that this alarm is currently expressing visual and audible indication of SelfTest.

#### 2.11.5.3.6. HardwareFault Value

This value SHALL indicate that this alarm is currently expressing visual indication of Hardware Fault. This value SHALL indicate that the alarm is currently expressing audible indication of Hardware Fault unless the DeviceMuted attribute is supported and set to Muted.

#### 2.11.5.3.7. EndOfService Value

This value SHALL indicate that this alarm is currently expressing visual indication of End Of Service. This value SHALL indicate that the alarm is currently expressing audible indication of End of Service unless the DeviceMuted attribute is supported and set to Muted.

#### 2.11.5.3.8. InterconnectSmoke Value

This value SHALL indicate that this alarm is currently expressing visual indication of Smoke Alarm caused by Interconnect. This value SHALL indicate that the alarm is currently expressing audible indication of Smoke Alarm caused by Interconnect unless the DeviceMuted attribute is supported and set to Muted.

#### 2.11.5.3.9. InterconnectCO Value

This value SHALL indicate that this alarm is currently expressing visual indication of CO Alarm caused by Interconnect. This value SHALL indicate that the alarm is currently expressing audible indication of CO Alarm caused by Interconnect unless the DeviceMuted attribute is supported and set to Muted.



Page 213



#### 2.11.5.4. MuteStateEnum Type

This data type is derived from enum8.

| Value | Name            | Summary   | Conformance |
|-------|-----------------|-----------|-------------|
| 0     | <b>NotMuted</b> | Not Muted | M           |
| 1     | <b>Muted</b>    | Muted     | M           |

##### 2.11.5.4.1. NotMuted Value

This value SHALL indicate that the device is not muted.

##### 2.11.5.4.2. Muted Value

This value SHALL indicate that the device is muted.

#### 2.11.5.5. EndOfServiceEnum Type

This data type is derived from enum8.

| Value | Name           | Summary                               | Conformance |
|-------|----------------|---------------------------------------|-------------|
| 0     | <b>Normal</b>  | Device has not expired                | M           |
| 1     | <b>Expired</b> | Device has reached its end of service | M           |

##### 2.11.5.5.1. Expired Value

This value SHALL indicate that the device has reached its end of service, and needs to be replaced.

##### 2.11.5.5.2. Normal Value

This value SHALL indicate that the device has not yet reached its end of service, and does not need to be imminently replaced.

#### 2.11.5.6. ContaminationStateEnum Type

This data type is derived from enum8.

| Value | Name            | Summary                                       | Conformance |
|-------|-----------------|-----------------------------------------------|-------------|
| 0     | <b>Normal</b>   | Nominal state, the sensor is not contaminated | M           |
| 1     | <b>Low</b>      | Low contamination                             | O           |
| 2     | <b>Warning</b>  | Warning state                                 | O           |
| 3     | <b>Critical</b> | Critical state, will cause nuisance alarms    | M           |

Page 214



#### 2.11.5.6.1. Normal Value

This value SHALL indicate that the smoke sensor has nominal contamination levels, no customer action is required.

#### 2.11.5.6.2. Low Value

This value SHALL indicate that the smoke sensor has detectable contamination levels, but the contamination is too low to cause a visible or audible alarm.

#### 2.11.5.6.3. Warning Value

This value SHALL indicate that the smoke sensor has contamination levels in a warning state. At this level, the contamination may cause a visible or audible alarm. User intervention is suggested.

#### 2.11.5.6.4. Critical Value

This value SHALL indicate that the smoke sensor has contamination levels in a critical state. At this level, the contamination should cause a visible or audible alarm. User intervention is required. Critical contamination of the sensor SHALL also be reflected as a HardwareFault.

### 2.11.6. Attributes

| ID     | Name                   | Type                | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------|---------------------|------------|---------|----------|--------|-------------|
| 0x0000 | Expressed State        | Expressed-StateEnum | all        | N       |          | RV     | M           |
| 0x0001 | Smoke-State            | AlarmStateEnum      | all        | N       |          | RV     | SMOKE       |
| 0x0002 | COState                | AlarmStateEnum      | all        | N       |          | RV     | CO          |
| 0x0003 | BatteryAlert           | AlarmStateEnum      | all        | N       |          | RV     | M           |
| 0x0004 | Device-Muted           | MuteStateEnum       | all        | N       |          | RV     | O           |
| 0x0005 | TestInProgress         | bool                | all        |         |          | RV     | M           |
| 0x0006 | Hardware-FaultAlert    | bool                | all        | N       |          | RV     | M           |
| 0x0007 | EndOfServiceAlert      | EndOfServiceEnum    | all        | N       |          | RV     | M           |
| 0x0008 | InterconnectSmokeAlarm | AlarmStateEnum      | all        |         |          | RV     | O           |




Page 215



| ID     | Name                          | Type                   | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------------------|------------------------|------------|---------|----------|--------|-------------|
| 0x0009 | <b>Interconnect-COAlarm</b>   | AlarmStateEnum         | all        |         |          | R V    | O           |
| 0x000A | <b>Contamination-State</b>    | ContaminationStateEnum | all        |         |          | R V    | [SMOKE]     |
| 0x000B | <b>Smoke-SensitivityLevel</b> | SensitivityEnum        | all        |         |          | RW VM  | [SMOKE]     |
| 0x000C | <b>Expiry-Date</b>            | epoch-s                | all        | F       |          | R V    | O           |

#### 2.11.6.1. ExpressedState Attribute

This attribute SHALL indicate the visibly- and audibly-expressed state of the alarm. When multiple alarm conditions are being reflected in the server, this attribute SHALL indicate the condition with the highest priority. Priority order of conditions is determined by the manufacturer and SHALL be supplied as a part of certification procedure. If the value of ExpressedState is not Normal, the attribute corresponding to the value SHALL NOT be Normal. For example, if the ExpressedState is set to SmokeAlarm, the value of the SmokeState will indicate the severity of the alarm (Warning or Critical). Clients SHOULD also read the other attributes to be aware of further alarm conditions beyond the one indicated in ExpressedState.

Visible expression is typically a LED light pattern. Audible expression is a horn or speaker pattern. Audible expression SHALL BE suppressed if the DeviceMuted attribute is supported and set to Muted.

#### 2.11.6.2. SmokeState Attribute

This attribute SHALL indicate whether the device's smoke sensor is currently triggering a smoke alarm.

#### 2.11.6.3. COState Attribute

This attribute SHALL indicate whether the device's CO sensor is currently triggering a CO alarm.

#### 2.11.6.4. BatteryAlert Attribute

This attribute SHALL indicate whether the power resource fault detection mechanism is currently triggered at the device. If the detection mechanism is triggered, this attribute SHALL be set to Warning or Critical, otherwise it SHALL be set to Normal. The battery state SHALL also be reflected in the Power Source cluster representing the device's battery using the appropriate supported attributes and events.

Page 216



#### **2.11.6.5. DeviceMuted Attribute**

This attribute SHALL indicate the whether the audible expression of the device is currently muted. Audible expression is typically a horn or speaker pattern.

#### **2.11.6.6. TestInProgress Attribute**

This attribute SHALL indicate whether the device self-test is currently activated. If the device self-test is activated, this attribute SHALL be set to True, otherwise it SHALL be set to False.

#### **2.11.6.7. HardwareFaultAlert Attribute**

This attribute SHALL indicate whether the hardware fault detection mechanism is currently triggered. If the detection mechanism is triggered, this attribute SHALL be set to True, otherwise it SHALL be set to False.

#### **2.11.6.8. EndOfServiceAlert Attribute**

This attribute SHALL indicate whether the end-of-service has been triggered at the device. This attribute SHALL be set to Expired when the device reaches the end-of-service.

#### **2.11.6.9. InterconnectSmokeAlarm Attribute**

This attribute SHALL indicate whether the interconnected smoke alarm is currently triggering by branching devices. When the interconnected smoke alarm is being triggered, this attribute SHALL be set to Warning or Critical, otherwise it SHALL be set to Normal.

#### **2.11.6.10. InterconnectCOAlarm Attribute**

This attribute SHALL indicate whether the interconnected CO alarm is currently triggering by branching devices. When the interconnected CO alarm is being triggered, this attribute SHALL be set to Warning or Critical, otherwise it SHALL be set to Normal.

#### **2.11.6.11. ContaminationState Attribute**

This attribute SHALL indicate the contamination level of the smoke sensor.

#### **2.11.6.12. SmokeSensitivityLevel Attribute**

This attribute SHALL indicate the sensitivity level of the smoke sensor configured on the device.

#### **2.11.6.13. ExpiryDate Attribute**

This attribute SHALL indicate the date when the device reaches its stated expiry date. After the ExpiryDate has been reached, the EndOfServiceAlert SHALL start to be triggered. To account for better customer experience across time zones, the EndOfServiceAlert MAY be delayed by up to 24 hours after the ExpiryDate. Similarly, clients MAY delay any actions based on the ExpiryDate by up to 24 hours to best align with the local time zone.



Page 217



## 2.11.7. Commands

| ID   | Name                   | Direction                   | Response | Access | Conformance |
|------|------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>SelfTestRequest</b> | client $\Rightarrow$ server | Y        | O      | O           |

### 2.11.7.1. SelfTestRequest Command

This command SHALL initiate a device self-test. The return status SHALL indicate whether the test was successfully initiated. Only one SelfTestRequest may be processed at a time. When the value of the ExpressedState attribute is any of SmokeAlarm, COAlarm, Testing, InterconnectSmoke, InterconnectCO, the device SHALL NOT execute the self-test, and SHALL return status code BUSY.

Upon successful acceptance of SelfTestRequest, the TestInProgress attribute SHALL be set to True and ExpressedState attribute SHALL be set to Testing. Any faults identified during the test SHALL be reflected in the appropriate attributes and events. Upon completion of the self test procedure, the SelfTestComplete event SHALL be generated, the TestInProgress attribute SHALL be set to False and ExpressedState attribute SHALL be updated to reflect the current state of the server.

## 2.11.8. Events

| ID   | Name                          | Priority | Quality | Access | Conformance |
|------|-------------------------------|----------|---------|--------|-------------|
| 0x00 | <b>SmokeAlarm</b>             | CRITICAL |         | V      | SMOKE       |
| 0x01 | <b>COAlarm</b>                | CRITICAL |         | V      | CO          |
| 0x02 | <b>LowBattery</b>             | INFO     |         | V      | M           |
| 0x03 | <b>Hardware-Fault</b>         | INFO     |         | V      | M           |
| 0x04 | <b>EndOfService</b>           | INFO     |         | V      | M           |
| 0x05 | <b>SelfTestComplete</b>       | INFO     |         | V      | M           |
| 0x06 | <b>AlarmMuted</b>             | INFO     |         | V      | O           |
| 0x07 | <b>MuteEnded</b>              | INFO     |         | V      | O           |
| 0x08 | <b>InterconnectSmokeAlarm</b> | CRITICAL |         | V      | [SMOKE]     |
| 0x09 | <b>InterconnectCOAlarm</b>    | CRITICAL |         | V      | [CO]        |
| 0x0A | <b>AllClear</b>               | INFO     |         | V      | M           |

### 2.11.8.1. SmokeAlarm Event

This event SHALL be generated when SmokeState attribute changes to either Warning or Critical state.

Page 218



The data of this event SHALL contain the following information:

| ID | Name               | Type           | Constraint | Quality | Fallback | Conformance |
|----|--------------------|----------------|------------|---------|----------|-------------|
| 0  | AlarmSeverityLevel | AlarmStateEnum | all        |         |          | M           |

#### 2.11.8.1.1. AlarmSeverityLevel Field

This field SHALL indicate the current value of the SmokeState attribute.

#### 2.11.8.2. COAlarm Event

This event SHALL be generated when COState attribute changes to either Warning or Critical state.

The data of this event SHALL contain the following information:

| ID | Name               | Type           | Constraint | Quality | Fallback | Conformance |
|----|--------------------|----------------|------------|---------|----------|-------------|
| 0  | AlarmSeverityLevel | AlarmStateEnum | all        |         |          | M           |

#### 2.11.8.2.1. AlarmSeverityLevel Field

This field SHALL indicate the current value of the COState attribute.

#### 2.11.8.3. LowBattery Event

This event SHALL be generated when BatteryAlert attribute changes to either Warning or Critical state.

The data of this event SHALL contain the following information:

| ID | Name               | Type           | Constraint | Quality | Fallback | Conformance |
|----|--------------------|----------------|------------|---------|----------|-------------|
| 0  | AlarmSeverityLevel | AlarmStateEnum | all        |         |          | M           |

#### 2.11.8.3.1. AlarmSeverityLevel Field

This field SHALL indicate the current value of the BatteryAlert attribute.

#### 2.11.8.4. HardwareFault Event

This event SHALL be generated when the device detects a hardware fault that leads to setting HardwareFaultAlert to True.




Page 219



#### 2.11.8.5. EndOfService Event

This event SHALL be generated when the EndOfServiceAlert is set to Expired.

#### 2.11.8.6. SelfTestComplete Event

This event SHALL be generated when the SelfTest completes, and the attribute TestInProgress changes to False.

#### 2.11.8.7. AlarmMuted Event

This event SHALL be generated when the DeviceMuted attribute changes to Muted.

#### 2.11.8.8. MuteEnded Event

This event SHALL be generated when DeviceMuted attribute changes to NotMuted.

#### 2.11.8.9. InterconnectSmokeAlarm Event

This event SHALL be generated when the device hosting the server receives a smoke alarm from an interconnected sensor.

The data of this event SHALL contain the following information:

| ID | Name               | Type           | Constraint | Quality | Fallback | Conformance |
|----|--------------------|----------------|------------|---------|----------|-------------|
| 0  | AlarmSeverityLevel | AlarmStateEnum | all        |         |          | M           |

##### 2.11.8.9.1. AlarmSeverityLevel Field

This field SHALL indicate the current value of the InterconnectSmokeAlarm attribute.

#### 2.11.8.10. InterconnectCOAlarm Event

This event SHALL be generated when the device hosting the server receives a CO alarm from an interconnected sensor.

The data of this event SHALL contain the following information:

| ID | Name               | Type           | Constraint | Quality | Fallback | Conformance |
|----|--------------------|----------------|------------|---------|----------|-------------|
| 0  | AlarmSeverityLevel | AlarmStateEnum | all        |         |          | M           |

##### 2.11.8.10.1. AlarmSeverityLevel Field

This field SHALL indicate the current value of the InterconnectCOAlarm attribute.

Page 220



### 2.11.8.11. AllClear Event

This event SHALL be generated when ExpressedState attribute returns to Normal state.

## 2.12. Electrical Energy Measurement Cluster

This cluster provides a mechanism for querying data about the electrical energy imported or provided by the server.

### 2.12.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                |
|----------|------------------------------------------------------------|
| 1        | Initial revision                                           |
| 2        | Added support for apparent and reactive energy measurement |

### 2.12.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | EEM       |

### 2.12.3. Cluster ID

| ID     | Name                          |
|--------|-------------------------------|
| 0x0091 | Electrical Energy Measurement |

### 2.12.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature          | Conformance | Summary                                      |
|-----|------|------------------|-------------|----------------------------------------------|
| 0   | IMPE | ImportedEnergy   | O.a+        | Measurement of energy imported by the server |
| 1   | EXPE | ExportedEnergy   | O.a+        | Measurement of energy provided by the server |
| 2   | CUME | CumulativeEnergy | O.b+        | Measurements are cumulative                  |
| 3   | PERE | PeriodicEnergy   | O.b+        | Measurements are periodic                    |




Page 221



| Bit | Code | Feature        | Conformance | Summary                             |
|-----|------|----------------|-------------|-------------------------------------|
| 4   | APPE | ApparentEnergy | P, O        | Measurements report apparent energy |
| 5   | REAE | ReactiveEnergy | P, O        | Measurements report reactive energy |

#### 2.12.4.1. ImportedEnergy Feature

The feature indicates the server is capable of measuring how much energy is imported by the server.

#### 2.12.4.2. ExportedEnergy Feature

The feature indicates the server is capable of measuring how much energy is exported by the server.

#### 2.12.4.3. CumulativeEnergy Feature

The feature indicates the server is capable of measuring how much energy has been imported or exported by the server over the device's lifetime. This measurement MAY start from when a device's firmware is updated to include this feature, when a device's firmware is updated to correct measurement errors, or when a device is factory reset.

#### 2.12.4.4. PeriodicEnergy Feature

The feature indicates the server is capable of measuring how much energy has been imported or exported by the server during a certain period of time. The start and end times for measurement periods SHALL be determined by the server, and MAY represent overlapping periods.

### 2.12.5. Data Types

#### 2.12.5.1. MeasurementTypeEnum Type

This data type is derived from enum16.

| Value | Name            | Summary                            | Conformance |
|-------|-----------------|------------------------------------|-------------|
| 0     | Unspecified     |                                    | M           |
| 1     | Voltage         | Voltage in millivolts (mV)         | M           |
| 2     | ActiveCurrent   | Active current in milliamps (mA)   | M           |
| 3     | ReactiveCurrent | Reactive current in milliamps (mA) | M           |

Page 222







| Value | Name                    | Summary                                                 | Conformance |
|-------|-------------------------|---------------------------------------------------------|-------------|
| 4     | <b>ApparentCurrent</b>  | Apparent current in milliamps (mA)                      | M           |
| 5     | <b>ActivePower</b>      | Active power in milliwatts (mW)                         | M           |
| 6     | <b>ReactivePower</b>    | Reactive power in milli-volt-amps reactive (mVAR)       | M           |
| 7     | <b>ApparentPower</b>    | Apparent power in millivolt-amps (mVA)                  | M           |
| 8     | <b>RMSVoltage</b>       | Root mean squared voltage in millivolts (mV)            | M           |
| 9     | <b>RMSCurrent</b>       | Root mean squared current in milliamps (mA)             | M           |
| 10    | <b>RMSPower</b>         | Root mean squared power in milliwatts (mW)              | M           |
| 11    | <b>Frequency</b>        | AC frequency in millihertz (mHz)                        | M           |
| 12    | <b>PowerFactor</b>      | Power Factor ratio in +/- 1/100ths of a percent.        | M           |
| 13    | <b>NeutralCurrent</b>   | AC neutral current in milliamps (mA)                    | M           |
| 14    | <b>ElectricalEnergy</b> | Electrical energy in milliwatt-hours (mWh)              | M           |
| 15    | <b>ReactiveEnergy</b>   | Reactive power in milli-volt-amp-hours reactive (mVARh) | M           |
| 16    | <b>ApparentEnergy</b>   | Apparent power in millivolt-amp-hours (mVAh)            | M           |

#### 2.12.5.1.1. MeasurementAccuracyRangeStruct Type

This struct represents the accuracy of a measurement for a range of measurement values. Accuracy SHALL be expressed as a maximum +/- percentage of the true value, a maximum +/- fixed value of the true value, or both.



Page 223



| ID | Name                  | Type          | Constraint               | Quality | Fallback | Access | Conformance  |
|----|-----------------------|---------------|--------------------------|---------|----------|--------|--------------|
| 0  | <b>RangeMin</b>       | int64         | $-2^{62}$ to $2^{62}$    |         |          |        | M            |
| 1  | <b>RangeMax</b>       | int64         | $-2^{62}$ to $2^{62}$    |         |          |        | M            |
| 2  | <b>PercentMax</b>     | percent100ths | all                      |         |          |        | O.a+         |
| 3  | <b>PercentMin</b>     | percent100ths | max PercentTypical       |         |          |        | [PercentMax] |
| 4  | <b>PercentTypical</b> | percent100ths | PercentMin to PercentMax |         |          |        | [PercentMin] |
| 5  | <b>FixedMax</b>       | uint64        | max $2^{62} - 1$         |         |          |        | O.a+         |
| 6  | <b>FixedMin</b>       | uint64        | max FixedMax             |         |          |        | [FixedMax]   |
| 7  | <b>FixedTypical</b>   | uint64        | FixedMin to FixedMax     |         |          |        | [FixedMin]   |

- If both [PercentMax](#) and [FixedMax](#) are indicated, then for a given true value in the range between [RangeMin](#) and [RangeMax](#),
  - the reported value SHALL be less than or equal to the sum of the true value, [FixedMax](#) and [PercentMax](#) percent of the true value.
  - the reported value SHALL be greater than or equal to the true value minus the sum of [FixedMax](#) and [PercentMax](#) percent of the true value.
- If only [PercentMax](#) is indicated, then for a given true value in the range between [RangeMin](#) and [RangeMax](#),
  - the reported value SHALL be less than or equal to the sum of the true value and [PercentMax](#) percent of the true value.
  - the reported value SHALL be greater than or equal to the true value minus [PercentMax](#) percent of the true value.
- If only [FixedMax](#) is indicated, then for a given true value in the range between [RangeMin](#) and [RangeMax](#),
  - the reported value SHALL be less than or equal to the sum of the true value and [FixedMax](#).
  - the reported value SHALL be greater than or equal to the true value minus [FixedMax](#).

#### 2.12.5.1.1.1. RangeMin Field

This field SHALL indicate the minimum measurement value for the specified level of accuracy.

The value of this field SHALL be greater than or equal to the value of the [MinMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

Page 224







The value of this field SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

#### **2.12.5.1.1.2. RangeMax Field**

This field SHALL indicate the maximum measurement value for the specified level of accuracy.

The value of this field SHALL be greater than the value of the [RangeMin](#) field.

The value of this field SHALL be greater than or equal to the value of the [MinMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

The value of this field SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

#### **2.12.5.1.1.3. PercentMax Field**

This field SHALL indicate the maximum +/- percentage accuracy for the associated measurement.

#### **2.12.5.1.1.4. PercentMin Field**

This field SHALL indicate the minimum +/- percentage accuracy for the associated measurement.

#### **2.12.5.1.1.5. PercentTypical Field**

This field SHALL indicate the typical +/- percentage accuracy for the associated measurement.

#### **2.12.5.1.1.6. FixedMax Field**

This field SHALL indicate the maximum +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

#### **2.12.5.1.1.7. FixedMin Field**

This field SHALL indicate the minimum +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

#### **2.12.5.1.1.8. FixedTypical Field**

This field SHALL indicate the typical +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

### **2.12.5.1.2. MeasurementAccuracyStruct Type**

This struct represents the set of accuracy ranges for a given measurement, the maximum and minimum values for the measurement, and whether the measurement is directly measured or just estimated from other information.



Page 225



| ID | Name             | Type                                 | Constraint            | Quality | Fallback | Access | Conformance |
|----|------------------|--------------------------------------|-----------------------|---------|----------|--------|-------------|
| 0  | MeasurementType  | MeasurementTypeEnum                  | all                   |         |          |        | M           |
| 1  | Measured         | bool                                 | all                   |         |          |        | M           |
| 2  | MinMeasuredValue | int64                                | $-2^{62}$ to $2^{62}$ |         |          |        | M           |
| 3  | MaxMeasuredValue | int64                                | $-2^{62}$ to $2^{62}$ |         |          |        | M           |
| 4  | AccuracyRanges   | list[MeasurementAccuracyRangeStruct] | min 1                 |         |          |        | M           |

#### 2.12.5.1.2.1. MeasurementType Field

This field SHALL indicate the type of measurement for the accuracy provided.

#### 2.12.5.1.2.2. Measured Field

This field SHALL indicate whether the associated measurement was directly measured. If this field is not set to true, then the associated measurement was estimated.

#### 2.12.5.1.2.3. MinMeasuredValue Attribute

This field SHALL indicate the minimum value that can be measured.

#### 2.12.5.1.2.4. MaxMeasuredValue Attribute

This field SHALL indicate the maximum value that can be measured.

#### 2.12.5.1.2.5. AccuracyRanges Field

This field SHALL indicate a list of measurement ranges and their associated accuracies.

The value of the `RangeMin` field on the first `MeasurementAccuracyRangeStruct` in this list SHALL be equal to the value of the `MinMeasuredValue` field.

The value of the `RangeMax` field on the last `MeasurementAccuracyRangeStruct` in this list SHALL be less than or equal to the value of the `MaxMeasuredValue` field.

The value of the `RangeMin` field on each `MeasurementAccuracyRangeStruct` in this list other than the first SHALL be one more the value of the `RangeMax` field on the previous `MeasurementAccuracyRangeStruct` in this list (i.e. there SHALL be no gaps in the accuracy ranges, and the ranges SHALL

Page 226



be in increasing order).

### 2.12.5.2. EnergyMeasurementStruct Type

This struct SHALL indicate the amount of energy measured during a given measurement period.

A server which does not have the ability to determine the time in UTC, or has not yet done so, SHALL use the system time fields to specify the measurement period and observation times.

A server which has determined the time in UTC SHALL use the timestamp fields to specify the measurement period. Such a server MAY also include the systime fields to indicate how many seconds had passed since boot for a given timestamp; this allows for client-side resolution of UTC time for previous reports that only included systime.

Elements using this data type SHALL indicate whether it represents cumulative or periodic energy, e.g. in the name or in the element description.

| ID | Name                  | Type         | Constraint               | Quality | Fallback | Access | Conformance |
|----|-----------------------|--------------|--------------------------|---------|----------|--------|-------------|
| 0  | <b>Energy</b>         | energy-mWh   | 0 to $2^{62}$            |         |          |        | M           |
| 1  | <b>StartTimeStamp</b> | epoch-s      |                          |         |          |        | desc        |
| 2  | <b>EndTimeStamp</b>   | epoch-s      | min (StartTimeStamp + 1) |         |          |        | desc        |
| 3  | <b>StartSystime</b>   | systime-ms   |                          |         |          |        | desc        |
| 4  | <b>EndSystime</b>     | systime-ms   | min (StartSystime + 1)   |         |          |        | desc        |
| 5  | <b>ApparentEnergy</b> | energy-mVAh  | 0 to $2^{62}$            |         |          |        | P, APPE     |
| 6  | <b>ReactiveEnergy</b> | energy-mVARh | 0 to $2^{62}$            |         |          |        | P, REAE     |

#### 2.12.5.2.1. Energy Field

This field SHALL be the reported energy.

If the [EnergyMeasurementStruct](#) represents cumulative energy, then this SHALL represent the cumulative energy recorded at either the value of the [EndTimeStamp](#) field or the value of the [EndSystime](#) field, or both.

If the [EnergyMeasurementStruct](#) represents periodic energy, then this SHALL represent the energy recorded during the period specified by either the [StartTimeStamp](#) and [EndTimeStamp](#) fields, the




Page 227



period specified by the [StartSystime](#) and [EndSystime](#) fields, or both.

#### 2.12.5.2.2. **StartTimestamp Field**

This field SHALL indicate the timestamp in UTC of the beginning of the period during which the value of the [Energy](#) field was measured.

If this [EnergyMeasurementStruct](#) represents cumulative energy, this field SHALL be omitted.

Otherwise, if the server had determined the time in UTC at or before the beginning of the measurement period, this field SHALL be indicated.

Otherwise, if the server had not yet determined the time in UTC at or before the beginning of the measurement period, or does not have the capability of determining the time in UTC, this field SHALL be omitted.

#### 2.12.5.2.3. **EndTimestamp Field**

This field SHALL indicate the timestamp in UTC of the end of the period during which the value of the [Energy](#) field was measured.

If the server had determined the time in UTC by the end of the measurement period, this field SHALL be indicated.

Otherwise, if the server had not yet determined the time in UTC by the end of the measurement period, or does not have the capability of determining the time in UTC, this field SHALL be omitted.

#### 2.12.5.2.4. **StartSystime Field**

This field SHALL indicate the time elapsed since boot at the beginning of the period during which the value of the [Energy](#) field was measured.

If this [EnergyMeasurementStruct](#) represents cumulative energy, this field SHALL be omitted.

Otherwise, if the server had not yet determined the time in UTC at the start of the measurement period, or does not have the capability of determining the time in UTC, this field SHALL be indicated.

Otherwise, if the server had determined the time in UTC at or before the beginning of the measurement period, this field MAY be omitted; if it is indicated, its value SHALL be the time elapsed since boot at the UTC time indicated in [StartTimestamp](#).

#### 2.12.5.2.5. **EndSystime Field**

This field SHALL indicate the time elapsed since boot at the end of the period during which the value of the [Energy](#) field was measured.

If the server had not yet determined the time in UTC by the end of the measurement period, or does not have the capability of determining the time in UTC, this field SHALL be indicated.

Otherwise, if the server had determined the time in UTC by the end of the measurement period, this field MAY be omitted; if it is indicated, its value SHALL be the time elapsed since boot at the UTC

Page 228







time indicated in [EndTimestamp](#).

#### 2.12.5.2.6. ApparentEnergy Field

This field SHALL indicate the reported apparent energy.

If the [EnergyMeasurementStruct](#) represents cumulative energy, then this SHALL represent the cumulative apparent energy recorded at either the value of the [EndTimestamp](#) field or the value of the [EndSystime](#) field, or both.

If the [EnergyMeasurementStruct](#) represents periodic energy, then this SHALL represent the apparent energy recorded during the period specified by either the [StartTimestamp](#) and [EndTimestamp](#) fields, the period specified by the [StartSystime](#) and [EndSystime](#) fields, or both.

#### 2.12.5.2.7. ReactiveEnergy Field

This field SHALL be the reported reactive energy.

If the [EnergyMeasurementStruct](#) represents cumulative energy, then this SHALL represent the cumulative reactive energy recorded at either the value of the [EndTimestamp](#) field or the value of the [EndSystime](#) field, or both.

If the [EnergyMeasurementStruct](#) represents periodic energy, then this SHALL represent the reactive energy recorded during the period specified by either the [StartTimestamp](#) and [EndTimestamp](#) fields, the period specified by the [StartSystime](#) and [EndSystime](#) fields, or both.

### 2.12.5.3. CumulativeEnergyResetStruct Type

This struct SHALL represent the times at which cumulative measurements were last zero, either due to initialization of the device, or an internal reset of the cumulative value.

| ID | Name                   | Type       | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|------------|------------|---------|----------|--------|-------------|
| 0  | ImportedResetTimestamp | epoch-s    |            | X       | null     |        | [IMPE]      |
| 1  | ExportedResetTimestamp | epoch-s    |            | X       | null     |        | [EXPE]      |
| 2  | ImportedResetSystime   | systime-ms |            | X       | null     |        | [IMPE]      |
| 3  | ExportedResetSystime   | systime-ms |            | X       | null     |        | [EXPE]      |




Page 229



#### 2.12.5.3.1. ImportedResetTimestamp Field

This field SHALL indicate the timestamp in UTC when the value of the [Energy](#) field on the [CumulativeEnergyImported](#) attribute was most recently zero.

If the server had determined the time in UTC when the value of the [Energy](#) field on the [CumulativeEnergyImported](#) attribute was most recently zero, this field SHALL be indicated.

Otherwise, if the server had not yet determined the time in UTC when the value of the [Energy](#) field on the [CumulativeEnergyImported](#) attribute was most recently zero, or does not have the capability of determining the time in UTC, this field SHALL be omitted.

If the timestamp in UTC when the value of the [Energy](#) field on the [CumulativeEnergyImported](#) attribute was most recently zero cannot currently be determined, a value of null SHALL be returned.

#### 2.12.5.3.2. ExportedResetTimestamp Field

This field SHALL indicate the timestamp in UTC when the value of the [Energy](#) field on the [CumulativeEnergyExported](#) attribute was most recently zero.

If the server had determined the time in UTC when the value of the [Energy](#) field on the [CumulativeEnergyExported](#) attribute was most recently zero, this field SHALL be indicated.

Otherwise, if the server had not yet determined the time in UTC when the value of the [Energy](#) field on the [CumulativeEnergyExported](#) attribute was most recently zero, or does not have the capability of determining the time in UTC, this field SHALL be omitted.

If the timestamp in UTC when the value of the [Energy](#) field on the [CumulativeEnergyExported](#) attribute was most recently zero cannot currently be determined, a value of null SHALL be returned.

#### 2.12.5.3.3. ImportedResetSystime Field

This field SHALL indicate the time elapsed since boot when the value of the [Energy](#) field on the [CumulativeEnergyImported](#) attribute was most recently zero.

If the server had not yet determined the time in UTC when the value of the [Energy](#) field on the [CumulativeEnergyImported](#) attribute was most recently zero, or does not have the capability of determining the time in UTC, this field SHALL be indicated.

Otherwise, if the server had determined the time in UTC when the value of the [Energy](#) field on the [CumulativeEnergyImported](#) attribute was most recently zero, this field MAY be omitted; if it is indicated, its value SHALL be the time elapsed since boot at the UTC time indicated in [ImportedResetTimestamp](#).

#### 2.12.5.3.4. ExportedResetSystime Field

This field SHALL indicate the time elapsed since boot when the value of the [Energy](#) field on the [CumulativeEnergyExported](#) attribute was most recently zero.

If the server had not yet determined the time in UTC when the value of the [Energy](#) field on the

Page 230







**CumulativeEnergyExported** attribute was most recently zero, or does not have the capability of determining the time in UTC, this field SHALL be indicated.

Otherwise, if the server had determined the time in UTC when the value of the [Energy](#) field on the [CumulativeEnergyExported](#) attribute was most recently zero, this field MAY be omitted; if it is indicated, its value SHALL be the time elapsed since boot at the UTC time indicated in [ImportedResetTimestamp](#).

## 2.12.6. Attributes

| ID     | Name                            | Type                        | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------------------------|-----------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Accuracy</b>                 | MeasurementAccuracyStruct   |            | F       |          | R V    | M           |
| 0x0001 | <b>CumulativeEnergyImported</b> | EnergyMeasurementStruct     |            | Q X     |          | R V    | IMPE & CUME |
| 0x0002 | <b>CumulativeEnergyExported</b> | EnergyMeasurementStruct     |            | Q X     |          | R V    | EXPE & CUME |
| 0x0003 | <b>PeriodicEnergyImported</b>   | EnergyMeasurementStruct     |            | Q X     |          | R V    | IMPE & PERE |
| 0x0004 | <b>PeriodicEnergyExported</b>   | EnergyMeasurementStruct     |            | Q X     |          | R V    | EXPE & PERE |
| 0x0005 | <b>CumulativeEnergyReset</b>    | CumulativeEnergyResetStruct |            | X       | null     | R V    | [CUME]      |

### 2.12.6.1. Accuracy Attribute

This attribute SHALL indicate the accuracy of energy measurement by this server. The value of the [MeasurementType](#) field on this [MeasurementAccuracyStruct](#) SHALL be [ElectricalEnergy](#).

### 2.12.6.2. CumulativeEnergyImported Attribute

This attribute SHALL indicate the most recent measurement of cumulative energy imported by the server over the lifetime of the device, and the timestamp of when the measurement was recorded.



Page 231



The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the cumulative energy imported cannot currently be determined, a value of null SHALL be returned.

#### **2.12.6.3. CumulativeEnergyExported Attribute**

This attribute SHALL indicate the most recent measurement of cumulative energy exported by the server over the lifetime of the device, and the timestamp of when the measurement was recorded.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the cumulative energy exported cannot currently be determined, a value of null SHALL be returned.

#### **2.12.6.4. PeriodicEnergyImported Attribute**

This attribute SHALL indicate the most recent measurement of energy imported by the server and the period during which it was measured.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the periodic energy imported cannot currently be determined, a value of null SHALL be returned.

#### **2.12.6.5. PeriodicEnergyExported Attribute**

This attribute SHALL indicate the most recent measurement of energy exported by the server and the period during which it was measured.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose

Page 232







to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the periodic energy exported cannot currently be determined, a value of null SHALL be returned.

#### 2.12.6.6. CumulativeEnergyReset Attribute

This attribute SHALL indicate when cumulative measurements were most recently zero.

### 2.12.7. Events

This cluster SHALL support these events:

| ID | Name                     | Priority | Quality | Access | Conformance |
|----|--------------------------|----------|---------|--------|-------------|
| 0  | CumulativeEnergyMeasured | INFO     |         | V      | CUME        |
| 1  | PeriodicEnergyMeasured   | INFO     |         | V      | PERE        |

#### 2.12.7.1. CumulativeEnergyMeasured Event

This event SHALL be generated when the server takes a snapshot of the cumulative energy imported by the server, exported from the server, or both, but not more frequently than the rate mentioned in the description above of the related attribute.

The data of this event SHALL contain the following information:

| ID | Name           | Type                    | Constraint | Quality | Fallback | Conformance |
|----|----------------|-------------------------|------------|---------|----------|-------------|
| 0  | EnergyImported | EnergyMeasurementStruct |            |         |          | CUME & IMPE |
| 1  | EnergyExported | EnergyMeasurementStruct |            |         |          | CUME & EXPE |

##### 2.12.7.1.1. EnergyImported Field

This field SHALL be the value of [CumulativeEnergyImported](#) attribute at the timestamp indicated in its [EndTimestamp](#) field, [EndSystime](#) field, or both.




Page 233



#### 2.12.7.1.2. EnergyExported Field

This field SHALL be the value of [CumulativeEnergyExported](#) attribute at the timestamp indicated in its [EndTimestamp](#) field, [EndSystime](#) field, or both.

#### 2.12.7.2. PeriodicEnergyMeasured Event

This event SHALL be generated when the server reaches the end of a reporting period for imported energy, exported energy, or both.

The data of this event SHALL contain the following information:

| ID | Name                  | Type                                    | Constraint | Quality | Fallback | Conformance |
|----|-----------------------|-----------------------------------------|------------|---------|----------|-------------|
| 0  | <b>EnergyImported</b> | <a href="#">EnergyMeasurementStruct</a> |            |         |          | PERE & IMPE |
| 1  | <b>EnergyExported</b> | <a href="#">EnergyMeasurementStruct</a> |            |         |          | PERE & EXPE |

##### 2.12.7.2.1. EnergyImported Field

This field SHALL be the value of [PeriodicEnergyImported](#) attribute at the timestamp indicated in its [EndTimestamp](#) field, [EndSystime](#) field, or both.

##### 2.12.7.2.2. EnergyExported Field

This field SHALL be the value of [PeriodicEnergyExported](#) attribute at the timestamp indicated in its [EndTimestamp](#) field, [EndSystime](#) field, or both.

### 2.13. Electrical Power Measurement Cluster

This cluster provides a mechanism for querying data about electrical power as measured by the server.

#### 2.13.1. Revision History

The global [ClusterRevision](#) attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                |
|----------|----------------------------------------------------------------------------|
| 1        | Initial revision                                                           |
| 2        | Changed reactive and apparent power fields to use new data types           |
| 3        | Changed range of apparent current field to allow negative apparent current |

Page 234







### 2.13.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | EPM       |

### 2.13.3. Cluster ID

| ID     | Name                         |
|--------|------------------------------|
| 0x0090 | Electrical Power Measurement |

### 2.13.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code        | Feature            | Conformance | Summary                                     |
|-----|-------------|--------------------|-------------|---------------------------------------------|
| 0   | <b>DIRC</b> | DirectCurrent      | O.a+        | Supports measurement of direct current      |
| 1   | <b>ALTC</b> | AlternatingCurrent | O.a+        | Supports measurement of alternating current |
| 2   | <b>POLY</b> | PolypasePower      | [ALTC]      | Supports polyphase measurements             |
| 3   | <b>HARM</b> | Harmonics          | [ALTC]      | Supports measurement of AC harmonics        |
| 4   | <b>PWRQ</b> | PowerQuality       | [ALTC]      | Supports measurement of AC harmonic phases  |

#### 2.13.4.1. DirectCurrent Feature

This feature indicates the cluster can measure a direct current.

#### 2.13.4.2. AlternatingCurrent Feature

This feature indicates the cluster can measure an alternating current.

#### 2.13.4.3. PolypasePower Feature

This feature indicates the cluster represents the collective measurements for a Polyphase power supply.




Page 235



#### 2.13.4.4. Harmonics Feature

This feature indicates the cluster can measure the harmonics of an alternating current.

#### 2.13.4.5. PowerQuality Feature

This feature indicates the cluster can measure the harmonic phases of an alternating current.

### 2.13.5. Data Types

#### 2.13.5.1. PowerModeEnum Type

This data type is derived from enum8.

| Value | Name    | Summary                                               | Conformance |
|-------|---------|-------------------------------------------------------|-------------|
| 0     | Unknown |                                                       | M           |
| 1     | DC      | Direct current                                        | M           |
| 2     | AC      | Alternating current, either single-phase or polyphase | M           |

#### 2.13.5.2. MeasurementTypeEnum Type

This data type is derived from enum16.

| Value | Name            | Summary                                          | Conformance |
|-------|-----------------|--------------------------------------------------|-------------|
| 0     | Unspecified     |                                                  | M           |
| 1     | Voltage         | Voltage in millivolts (mV)                       | M           |
| 2     | ActiveCurrent   | Active current in milliamps (mA)                 | M           |
| 3     | ReactiveCurrent | Reactive current in milliamps (mA)               | M           |
| 4     | ApparentCurrent | Apparent current in milliamps (mA)               | M           |
| 5     | ActivePower     | Active power in milliwatts (mW)                  | M           |
| 6     | ReactivePower   | Reactive power in millivolt-amps reactive (mVAR) | M           |
| 7     | ApparentPower   | Apparent power in millivolt-amps (mVA)           | M           |

Page 236



| Value | Name                    | Summary                                                | Conformance |
|-------|-------------------------|--------------------------------------------------------|-------------|
| 8     | <b>RMSVoltage</b>       | Root mean squared voltage in millivolts (mV)           | M           |
| 9     | <b>RMSCurrent</b>       | Root mean squared current in milliamps (mA)            | M           |
| 10    | <b>RMSPower</b>         | Root mean squared power in milliwatts (mW)             | M           |
| 11    | <b>Frequency</b>        | AC frequency in millihertz (mHz)                       | M           |
| 12    | <b>PowerFactor</b>      | Power Factor ratio in +/- 1/100ths of a percent.       | M           |
| 13    | <b>NeutralCurrent</b>   | AC neutral current in milliamps (mA)                   | M           |
| 14    | <b>ElectricalEnergy</b> | Electrical energy in milliwatt-hours (mWh)             | M           |
| 15    | <b>ReactiveEnergy</b>   | Reactive power in millivolt-amp-hours reactive (mVARh) | M           |
| 16    | <b>ApparentEnergy</b>   | Apparent power in millivolt-amp-hours (mVAh)           | M           |

#### 2.13.5.2.1. MeasurementAccuracyRangeStruct Type

This struct represents the accuracy of a measurement for a range of measurement values. Accuracy SHALL be expressed as a maximum +/- percentage of the true value, a maximum +/- fixed value of the true value, or both.

| ID | Name              | Type          | Constraint            | Quality | Fallback | Access | Conformance  |
|----|-------------------|---------------|-----------------------|---------|----------|--------|--------------|
| 0  | <b>RangeMin</b>   | int64         | $-2^{62}$ to $2^{62}$ |         |          |        | M            |
| 1  | <b>RangeMax</b>   | int64         | $-2^{62}$ to $2^{62}$ |         |          |        | M            |
| 2  | <b>PercentMax</b> | percent100ths | all                   |         |          |        | O.a+         |
| 3  | <b>PercentMin</b> | percent100ths | max PercentTypical    |         |          |        | [PercentMax] |



Page 237



| ID | Name                  | Type          | Constraint               | Quality | Fallback | Access | Conformance  |
|----|-----------------------|---------------|--------------------------|---------|----------|--------|--------------|
| 4  | <b>PercentTypical</b> | percent100ths | PercentMin to PercentMax |         |          |        | [PercentMin] |
| 5  | <b>FixedMax</b>       | uint64        | max $2^{62} - 1$         |         |          |        | O.a+         |
| 6  | <b>FixedMin</b>       | uint64        | max FixedMax             |         |          |        | [FixedMax]   |
| 7  | <b>FixedTypical</b>   | uint64        | FixedMin to FixedMax     |         |          |        | [FixedMin]   |

- If both [PercentMax](#) and [FixedMax](#) are indicated, then for a given true value in the range between [RangeMin](#) and [RangeMax](#),
  - the reported value SHALL be less than or equal to the sum of the true value, [FixedMax](#) and [PercentMax](#) percent of the true value.
  - the reported value SHALL be greater than or equal to the true value minus the sum of [FixedMax](#) and [PercentMax](#) percent of the true value.
- If only [PercentMax](#) is indicated, then for a given true value in the range between [RangeMin](#) and [RangeMax](#),
  - the reported value SHALL be less than or equal to the sum of the true value and [PercentMax](#) percent of the true value.
  - the reported value SHALL be greater than or equal to the true value minus [PercentMax](#) percent of the true value.
- If only [FixedMax](#) is indicated, then for a given true value in the range between [RangeMin](#) and [RangeMax](#),
  - the reported value SHALL be less than or equal to the sum of the true value and [FixedMax](#).
  - the reported value SHALL be greater than or equal to the true value minus [FixedMax](#).

#### 2.13.5.2.1.1. RangeMin Field

This field SHALL indicate the minimum measurement value for the specified level of accuracy.

The value of this field SHALL be greater than or equal to the value of the [MinMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

The value of this field SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

#### 2.13.5.2.1.2. RangeMax Field

This field SHALL indicate the maximum measurement value for the specified level of accuracy.

The value of this field SHALL be greater than the value of the [RangeMin](#) field.

Page 238







The value of this field SHALL be greater than or equal to the value of the [MinMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

The value of this field SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field on the encompassing [MeasurementAccuracyStruct](#).

#### 2.13.5.2.1.3. PercentMax Field

This field SHALL indicate the maximum +/- percentage accuracy for the associated measurement.

#### 2.13.5.2.1.4. PercentMin Field

This field SHALL indicate the minimum +/- percentage accuracy for the associated measurement.

#### 2.13.5.2.1.5. PercentTypical Field

This field SHALL indicate the typical +/- percentage accuracy for the associated measurement.

#### 2.13.5.2.1.6. FixedMax Field

This field SHALL indicate the maximum +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

#### 2.13.5.2.1.7. FixedMin Field

This field SHALL indicate the minimum +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

#### 2.13.5.2.1.8. FixedTypical Field

This field SHALL indicate the typical +/- fixed accuracy for the associated measurement, in the unit indicated by [MeasurementType](#).

### 2.13.5.2.2. MeasurementAccuracyStruct Type

This struct represents the set of accuracy ranges for a given measurement, the maximum and minimum values for the measurement, and whether the measurement is directly measured or just estimated from other information.

| ID | Name                    | Type                                | Constraint            | Quality | Fallback | Access | Conformance |
|----|-------------------------|-------------------------------------|-----------------------|---------|----------|--------|-------------|
| 0  | <b>MeasurementType</b>  | <a href="#">MeasurementTypeEnum</a> | all                   |         |          |        | M           |
| 1  | <b>Measured</b>         | bool                                | all                   |         |          |        | M           |
| 2  | <b>MinMeasuredValue</b> | int64                               | $-2^{62}$ to $2^{62}$ |         |          |        | M           |



Page 239



| ID | Name              | Type                                 | Constraint            | Quality | Fallback | Access | Conformance |
|----|-------------------|--------------------------------------|-----------------------|---------|----------|--------|-------------|
| 3  | MaxMeasured-Value | int64                                | $-2^{62}$ to $2^{62}$ |         |          |        | M           |
| 4  | AccuracyRanges    | list[MeasurementAccuracyRangeStruct] | min 1                 |         |          |        | M           |

#### 2.13.5.2.2.1. MeasurementType Field

This field SHALL indicate the type of measurement for the accuracy provided.

#### 2.13.5.2.2.2. Measured Field

This field SHALL indicate whether the associated measurement was directly measured. If this field is not set to true, then the associated measurement was estimated.

#### 2.13.5.2.2.3. MinMeasuredValue Attribute

This field SHALL indicate the minimum value that can be measured.

#### 2.13.5.2.2.4. MaxMeasuredValue Attribute

This field SHALL indicate the maximum value that can be measured.

#### 2.13.5.2.2.5. AccuracyRanges Field

This field SHALL indicate a list of measurement ranges and their associated accuracies.

The value of the [RangeMin](#) field on the first [MeasurementAccuracyRangeStruct](#) in this list SHALL be equal to the value of the [MinMeasuredValue](#) field.

The value of the [RangeMax](#) field on the last [MeasurementAccuracyRangeStruct](#) in this list SHALL be less than or equal to the value of the [MaxMeasuredValue](#) field.

The value of the [RangeMin](#) field on each [MeasurementAccuracyRangeStruct](#) in this list other than the first SHALL be one more the value of the [RangeMax](#) field on the previous [MeasurementAccuracyRangeStruct](#) in this list (i.e. there SHALL be no gaps in the accuracy ranges, and the ranges SHALL be in increasing order).

#### 2.13.5.3. MeasurementRangeStruct Type

This struct SHALL indicate the maximum and minimum values of a given [measurement type](#) during a measurement period, along with the observation times of these values.

A server which does not have the ability to determine the time in UTC, or has not yet done so,

Page 240







SHALL use the system time fields to specify the measurement period and observation times.

A server which has determined the time in UTC SHALL use the timestamp fields to specify the measurement period and observation times. Such a server MAY also include the systime fields to indicate how many seconds had passed since boot for a given timestamp; this allows for client-side resolution of UTC time for previous reports that only included systime.

| ID | Name                   | Type                | Constraint               | Quality | Fallback | Access | Conformance  |
|----|------------------------|---------------------|--------------------------|---------|----------|--------|--------------|
| 0  | <b>MeasurementType</b> | MeasurementTypeEnum |                          |         |          |        | M            |
| 1  | <b>Min</b>             | int64               | $-2^{62}$ to $2^{62}$    |         |          |        | M            |
| 2  | <b>Max</b>             | int64               | $-2^{62}$ to $2^{62}$    |         |          |        | M            |
| 3  | <b>StartTimestamp</b>  | epoch-s             |                          |         |          |        | EndTimestamp |
| 4  | <b>EndTimestamp</b>    | epoch-s             | min (StartTimestamp + 1) |         |          |        | desc         |
| 5  | <b>MinTimestamp</b>    | epoch-s             |                          |         |          |        | EndTimestamp |
| 6  | <b>MaxTimestamp</b>    | epoch-s             | min (MinTimestamp + 1)   |         |          |        | EndTimestamp |
| 7  | <b>StartSystime</b>    | systime-ms          |                          |         |          |        | EndSystime   |
| 8  | <b>EndSystime</b>      | systime-ms          | min (StartSystime + 1)   |         |          |        | desc         |
| 9  | <b>MinSystime</b>      | systime-ms          |                          |         |          |        | EndSystime   |
| 10 | <b>MaxSystime</b>      | systime-ms          | min (MinSystime + 1)     |         |          |        | EndSystime   |

#### 2.13.5.3.1. MeasurementType Field

This field SHALL be the type of measurement for the range provided.

#### 2.13.5.3.2. Min Field

This field SHALL be the smallest measured value for the associated measurement over either the period between **StartTimestamp** and **EndTimestamp**, or the period between **StartSystime** and **EndSystime**, or both.




Page 241



#### 2.13.5.3.3. Max Field

This field SHALL be the largest measured value for the associated measurement over the period between either [StartTimestamp](#) and [EndTimestamp](#) or the period between [StartSystime](#) and [EndSystime](#), or both.

#### 2.13.5.3.4. StartTimestamp Field

This field SHALL be the timestamp in UTC of the beginning of the measurement period.

If the server had not yet determined the time in UTC at or before the beginning of the measurement period, or does not have the capability of determining the time in UTC, this field SHALL be omitted.

#### 2.13.5.3.5. EndTimestamp Field

This field SHALL be the timestamp in UTC of the end of the measurement period.

If the server had not yet determined the time in UTC at or before the beginning of the measurement period, or does not have the capability of determining the time in UTC, this field SHALL be omitted.

#### 2.13.5.3.6. MinTimestamp Field

This field SHALL be the most recent timestamp in UTC that the value in the [Min](#) field was measured.

This field SHALL be greater than or equal to the value of the [StartTimestamp](#) field.

This field SHALL be less than or equal to the value of the [EndTimestamp](#) field.

#### 2.13.5.3.7. MaxTimestamp Field

This field SHALL be the most recent timestamp in UTC of the value in the [Max](#) field.

This field SHALL be greater than or equal to the value of the [StartTimestamp](#) field.

This field SHALL be less than or equal to the value of the [EndTimestamp](#) field.

#### 2.13.5.3.8. StartSystime Field

This field SHALL be the time since boot of the beginning of the measurement period.

If the server had determined the time in UTC at or before the start of the measurement period, this field MAY be omitted along with the [EndSystime](#), [MinSystime](#), and [MaxSystime](#) fields.

#### 2.13.5.3.9. EndSystime Field

This field SHALL be the time since boot of the end of the measurement period.

If the server had determined the time in UTC at the end of the measurement period, this field MAY be omitted along with the [StartSystime](#) field, [MinSystime](#), and [MaxSystime](#) fields.

Page 242







#### 2.13.5.3.10. MinSystime Field

This field SHALL be the measurement time since boot of the value in the [Min](#) field was measured.

This field SHALL be greater than or equal to the value of the [StartSystime](#) field.

This field SHALL be less than or equal to the value of the [EndSystime](#) field.

#### 2.13.5.3.11. MaxSystime Field

This field SHALL be the measurement time since boot of the value in the [Max](#) field.

This field SHALL be greater than or equal to the value of the [StartSystime](#) field.

This field SHALL be less than or equal to the value of the [EndSystime](#) field.

#### 2.13.5.4. HarmonicMeasurementStruct Type

| ID | Name               | Type  | Constraint            | Quality | Fallback | Access | Conformance |
|----|--------------------|-------|-----------------------|---------|----------|--------|-------------|
| 0  | <b>Order</b>       | uint8 | min 1                 |         |          |        | M           |
| 1  | <b>Measurement</b> | int64 | $-2^{62}$ to $2^{62}$ | X       |          |        | M           |

##### 2.13.5.4.1. Order Field

This field SHALL be the order of the harmonic being measured. Typically this is an odd number, but servers may choose to report even harmonics.

##### 2.13.5.4.2. Measurement Field

This field SHALL be the measured value for the given harmonic order.

For the [Harmonic Currents](#) attribute, this value is the most recently measured harmonic current reading in milliamps (mA). A positive value indicates that the measured harmonic current is positive, and a negative value indicates that the measured harmonic current is negative.

For the [Harmonic Phases](#) attribute, this value is the most recent phase of the given harmonic order in millidegrees (mDeg). A positive value indicates that the measured phase is leading, and a negative value indicates that the measured phase is lagging.

If this measurement is not currently available, a value of null SHALL be returned.

#### 2.13.6. Attributes

| ID     | Name              | Type                           | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------|--------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Power-Mode</b> | <a href="#">Power-ModeEnum</a> |            |         |          | RV     | M           |




Page 243



| ID     | Name                            | Type                                              | Constraint                    | Quality | Fallback | Access | Conformance |
|--------|---------------------------------|---------------------------------------------------|-------------------------------|---------|----------|--------|-------------|
| 0x0001 | <b>NumberOfMeasurementTypes</b> | uint8                                             | max 32                        | F       |          | R V    | M           |
| 0x0002 | <b>Accuracy</b>                 | list[ <a href="#">MeasurementAccuracyStruct</a> ] | 1 to NumberOfMeasurementTypes | F       |          | R V    | M           |
| 0x0003 | <b>Ranges</b>                   | list[ <a href="#">MeasurementRangeStruct</a> ]    | 0 to NumberOfMeasurementTypes | Q       | empty    | R V    | O           |
| 0x0004 | <b>Voltage</b>                  | voltage-mV                                        | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | O           |
| 0x0005 | <b>ActiveCurrent</b>            | amperage-mA                                       | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | O           |
| 0x0006 | <b>ReactiveCurrent</b>          | amperage-mA                                       | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | [ALTC]      |
| 0x0007 | <b>ApparentCurrent</b>          | amperage-mA                                       | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | [ALTC]      |
| 0x0008 | <b>ActivePower</b>              | power-mW                                          | $-2^{62}$ to $2^{62}$         | Q X     |          | R V    | M           |
| 0x0009 | <b>ReactivePower</b>            | power-mVAR                                        | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | [ALTC]      |
| 0x000A | <b>ApparentPower</b>            | power-mVA                                         | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | [ALTC]      |
| 0x000B | <b>RMSVoltage</b>               | voltage-mV                                        | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | [ALTC]      |
| 0x000C | <b>RMSCurrent</b>               | amperage-mA                                       | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | [ALTC]      |
| 0x000D | <b>RMSPower</b>                 | power-mW                                          | $-2^{62}$ to $2^{62}$         | Q X     | null     | R V    | [ALTC]      |
| 0x000E | <b>Frequency</b>                | int64                                             | 0 to 1000000                  | Q X     | null     | R V    | [ALTC]      |
| 0x000F | <b>HarmonicCurrents</b>         | list[ <a href="#">HarmonicMeasurementStruct</a> ] | max 25                        | Q X     |          | R V    | HARM        |

Page 244







| ID     | Name                  | Type                                              | Constraint            | Quality | Fallback | Access | Conformance |
|--------|-----------------------|---------------------------------------------------|-----------------------|---------|----------|--------|-------------|
| 0x0010 | <b>HarmonicPhases</b> | list[ <a href="#">HarmonicMeasurementStruct</a> ] | max 25                | Q X     |          | R V    | PWRQ        |
| 0x0011 | <b>PowerFactor</b>    | int64                                             | -10000 to 10000       | Q X     | null     | R V    | [ALTc]      |
| 0x0012 | <b>NeutralCurrent</b> | amperage-mA                                       | $-2^{62}$ to $2^{62}$ | Q X     | null     | R V    | [POLY]      |

#### 2.13.6.1. PowerMode Attribute

This SHALL indicate the current mode of the server. For some servers, such as an EV, this may change depending on the mode of charging or discharging.

#### 2.13.6.2. NumberOfMeasurementTypes Attribute

This SHALL indicate the maximum number of measurement types the server is capable of reporting.

#### 2.13.6.3. Accuracy Attribute

This SHALL indicate a list of [accuracy specifications](#) for the [measurement types](#) supported by the server. There SHALL be an entry for [ActivePower](#), as well as any other measurement types implemented by this server.

#### 2.13.6.4. Ranges Attribute

This SHALL indicate a list of [measured ranges](#) for different [measurement types](#). Each measurement type SHALL have at most one entry in this list, representing the range of measurements in the most recent measurement period.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

#### 2.13.6.5. Voltage Attribute

This SHALL indicate the most recent [Voltage](#) reading in millivolts (mV).

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.



Page 245



The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the voltage cannot be measured, a value of null SHALL be returned.

#### 2.13.6.6. ActiveCurrent Attribute

This SHALL indicate the most recent [ActiveCurrent](#) reading in milliamps (mA).

A positive value represents current flowing into the server, while a negative value represents current flowing out of the server.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the current cannot be measured, a value of null SHALL be returned.

#### 2.13.6.7. ReactiveCurrent Attribute

This SHALL indicate the most recent [ReactiveCurrent](#) reading in milliamps (mA).

A positive value represents current flowing into the server, while a negative value represents current flowing out of the server.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the current cannot be measured, a value of null SHALL be returned.

#### 2.13.6.8. ApparentCurrent Attribute

This SHALL indicate the most recent [ApparentCurrent](#) (square root sum of the squares of active and reactive currents) reading in milliamps (mA).

A positive value represents current flowing into the server, while a negative value represents current flowing out of the server.

Page 246







The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the active or reactive currents cannot be measured, a value of null SHALL be returned.

#### 2.13.6.9. ActivePower Attribute

This SHALL indicate the most recent [ActivePower](#) reading in milliwatts (mW). If the power cannot be measured, a value of null SHALL be returned.

A positive value represents power imported, while a negative value represents power exported.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the [Polyphase Power](#) feature is set, this value represents the combined active power imported or exported.

#### 2.13.6.10. ReactivePower Attribute

This SHALL indicate the most recent [ReactivePower](#) reading in millivolt-amps reactive (mVAR).

A positive value represents power imported, while a negative value represents power exported.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the reactive power cannot be measured, a value of null SHALL be returned.

If the [Polyphase Power](#) feature is supported, this value represents the combined reactive power imported or exported.




Page 247



### 2.13.6.11. ApparentPower Attribute

This SHALL indicate the most recent [ApparentPower](#) reading in millivolt-amps (mVA).

A positive value represents power imported, while a negative value represents power exported.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the apparent power cannot be measured, a value of null SHALL be returned.

### 2.13.6.12. RMSVoltage Attribute

This SHALL indicate the most recent [RMSVoltage](#) reading in millivolts (mV).

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the RMS voltage cannot be measured, a value of null SHALL be returned.

### 2.13.6.13. RMSCurrent Attribute

This SHALL indicate the most recent [RMSCurrent](#) reading in milliamps (mA).

A positive value represents current flowing into the server, while a negative value represents current flowing out of the server.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the RMS current cannot be measured, a value of null SHALL be returned.

Page 248







#### 2.13.6.14. RMSPower Attribute

This SHALL indicate the most recent [RMSPower](#) reading in milliwatts (mW).

A positive value represents power imported, while a negative value represents power exported.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the RMS power cannot be measured, a value of null SHALL be returned.

#### 2.13.6.15. Frequency Attribute

This SHALL indicate the most recent [Frequency](#) reading in millihertz (mHz).

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

If the frequency cannot be measured, a value of null SHALL be returned.

#### 2.13.6.16. HarmonicCurrents Attribute

This SHALL indicate a list of [HarmonicMeasurementStruct](#) values, with each [HarmonicMeasurementStruct](#) representing the harmonic current reading for the harmonic order specified by [Order](#).

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

#### 2.13.6.17. HarmonicPhases Attribute

This SHALL indicate a list of [HarmonicMeasurementStruct](#) values, with each [HarmonicMeasurementStruct](#) representing the most recent phase of the harmonic current reading for the harmonic order specified by [Order](#).



Page 249



The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

#### 2.13.6.18. PowerFactor Attribute

This SHALL indicate the Power Factor ratio in +/- 1/100ths of a percent.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

#### 2.13.6.19. NeutralCurrent Attribute

This SHALL indicate the most recent [NeutralCurrent](#) reading in milliamps (mA). Typically this is a derived value, taking the magnitude of the vector sum of phase currents.

If the neutral current cannot be measured or derived, a value of null SHALL be returned.

A positive value represents an imbalance between the phase currents when power is imported.

A negative value represents an imbalance between the phase currents when power is exported.

The reporting interval of this attribute SHALL be manufacturer dependent. The server MAY choose to omit publication of deltas considered not meaningful.

The server SHALL NOT mark this attribute ready for report if the last time this was done was more recently than 1 second ago.

The server MAY delay marking this attribute ready for report for longer periods if needed, however the server SHALL NOT delay marking this attribute as ready for report for longer than 60 seconds.

### 2.13.7. Events

This cluster SHALL support the following event:

| ID | Name                     | Priority | Quality | Access | Conformance            |
|----|--------------------------|----------|---------|--------|------------------------|
| 0  | Measurement-PeriodRanges | INFO     |         | V      | <a href="#">Ranges</a> |

Page 250







### 2.13.7.1. MeasurementPeriodRanges Event

If supported, this event SHALL be generated at the end of a measurement period. The start and end times for measurement periods SHALL be determined by the server, and MAY represent overlapping periods.

The data of this event SHALL contain the following information:

| ID | Name   | Type                                           | Constraint                                    | Quality | Fallback | Conformance |
|----|--------|------------------------------------------------|-----------------------------------------------|---------|----------|-------------|
| 0  | Ranges | list[ <a href="#">MeasurementRangeStruct</a> ] | 1 to <a href="#">NumberOfMeasurementTypes</a> |         |          | M           |

#### 2.13.7.1.1. Ranges Field

This SHALL indicate the value of the [Ranges](#) attribute at the time of event generation.

## 2.14. Zone Management Cluster

This cluster provides an interface to manage regions of interest, or Zones, which can be either manufacturer or user defined.

This cluster also defines a Trigger, which is a set of [conditions and timing](#) that apply to a Zone and allow for [events](#) to be generated or the triggering state to be used by other clusters such as [Push AV Stream Transport Cluster](#).

### 2.14.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                    |
|----------|------------------------------------------------|
| 1        | Initial version of the Zone Management cluster |

### 2.14.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | ZONEMGMT  |

### 2.14.3. Cluster ID

| ID     | Name            |
|--------|-----------------|
| 0x0550 | Zone Management |




Page 251



## 2.14.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code               | Feature                      | Conformance   | Summary                                  |
|-----|--------------------|------------------------------|---------------|------------------------------------------|
| 0   | <b>TWODCART</b>    | TwoDimensional-CartesianZone | 0             | Supports Two Dimensional Cartesian Zones |
| 1   | <b>PERZONESENS</b> | PerZoneSensitivity           | [TWODCART]    | Supports a sensitivity value per Zone    |
| 2   | <b>USERDEFINED</b> | UserDefined                  | [TWODCART]    | Supports user defined zones              |
| 3   | <b>FOCUSZONES</b>  | FocusZones                   | [USERDEFINED] | Supports user defined focus zones        |

### 2.14.4.1. TwoDimensionalCartesianZone Feature

When this feature is supported, Zones based on a 2 Dimensional Cartesian plane MAY be defined and SHALL be represented by a [TwoDCartesianZoneStruct](#). Within a [TwoDCartesianZoneStruct](#) the bounding of the zone SHALL be a polygon defined by a list of vertices comprising X (horizontal) and Y (vertical) coordinates, with each vertex defining the point where adjacent edges meet and an implicit connection between the last and first vertices in the list.

The origin (0,0) SHALL be located at the top left of the Cartesian plane, with positive X and Y values moving right and down across the Cartesian plane respectively.

### 2.14.4.2. PerZoneSensitivity Feature

When this feature is supported, the [ZoneTriggerControlStruct](#) SHALL be used for specifying a zone specific value for the sensitivity of that zone to trigger events. If not supported, only the [Sensitivity Attribute](#) SHALL be used.

### 2.14.4.3. UserDefined Feature

When this feature is supported, the device allows for creating and managing user defined zones via commands.

### 2.14.4.4. FocusZones Feature

When this feature is supported, the device allows for creating and managing user defined [Focus Value](#) zones via commands.

## 2.14.5. Data Types

Page 252







### 2.14.5.1. ZoneTypeEnum Type

This data type is derived from enum8.

| Value | Name                | Summary                                    | Conformance |
|-------|---------------------|--------------------------------------------|-------------|
| 0     | <b>TwoDCARTZone</b> | Indicates a Two Dimensional Cartesian Zone | M           |

### 2.14.5.2. ZoneUseEnum Type

This data type is derived from enum8, and is used to indicate intended Zone usage.

| Value | Name           | Summary                                       | Conformance |
|-------|----------------|-----------------------------------------------|-------------|
| 0     | <b>Motion</b>  | Indicates Zone is intended to detect Motion   | M           |
| 1     | <b>Privacy</b> | Indicates Zone is intended to protect privacy | M           |
| 2     | <b>Focus</b>   | Indicates Zone provides a focus area          | FOCUSZONES  |

#### 2.14.5.2.1. Motion Value

This value indicates the Zone is intended to be used for motion detection

#### 2.14.5.2.2. Privacy Value

This value indicates the Zone is intended to be used for privacy blocking. All pixels within Privacy Zones SHALL be replaced with black.

#### 2.14.5.2.3. Focus Value

This value indicates the Zone is intended to be a focal point for quality or analysis. Implementations MAY increase encoding quality within this type of Zone at the expense of other areas.

### 2.14.5.3. ZoneSourceEnum Type

This data type is derived from enum8.

| Value | Name        | Summary                                | Conformance |
|-------|-------------|----------------------------------------|-------------|
| 0     | <b>Mfg</b>  | Indicates a Manufacturer defined Zone. | M           |
| 1     | <b>User</b> | Indicates a User defined Zone.         | M           |




Page 253



#### 2.14.5.3.1. Mfg Value

This value indicates the Zone is built-in and provided by the manufacturer of the device. Zones of this type can't be created or modified using commands in this cluster.

#### 2.14.5.3.2. User Value

This value indicates the Zone was defined and created by a user. Zones of this type can be created, modified or deleted using commands in this cluster.

#### 2.14.5.4. ZoneEventTriggeredReasonEnum Type

This data type is derived from enum8.

| Value | Name          | Summary                                         | Conformance |
|-------|---------------|-------------------------------------------------|-------------|
| 0     | <b>Motion</b> | Zone event triggered because motion is detected | M           |

#### 2.14.5.5. ZoneEventStoppedReasonEnum Type

This data type is derived from enum8.

| Value | Name                 | Summary                                                                             | Conformance |
|-------|----------------------|-------------------------------------------------------------------------------------|-------------|
| 0     | <b>ActionStopped</b> | Indicates that whatever triggered the Zone event has stopped being detected.        | M           |
| 1     | <b>Timeout</b>       | Indicates that the max duration for detecting triggering activity has been reached. | M           |

#### 2.14.5.6. TwoDCartesianVertexStruct Type

This struct is used to encode a point on the 2 Dimensional Cartesian Plane for the [TwoDCartesian-Zone](#) feature.

| ID | Name     | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>X</b> | uint16 | all        |         |          |        | M           |
| 1  | <b>Y</b> | uint16 | all        |         |          |        | M           |

##### 2.14.5.6.1. X Field

This field SHALL represent the position of the vertex along the horizontal (x) axis.

Page 254



#### 2.14.5.6.2. Y Field

This field SHALL represent the position of the vertex along the vertical (y) axis.

#### 2.14.5.7. TwoDCartesianZoneStruct Type

This struct is used to encode all information needed to define a TwoDCartesianZone.

| ID | Name            | Type                                              | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|---------------------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Name</b>     | string                                            | max 32     |         |          |        | M           |
| 1  | <b>Use</b>      | <a href="#">ZoneUseEnum</a>                       |            |         |          |        | M           |
| 2  | <b>Vertices</b> | list[ <a href="#">TwoDCartesianVertexStruct</a> ] | 3 to 12    |         |          |        | M           |
| 3  | <b>Color</b>    | string                                            | 7, 9       |         |          |        | O           |

##### 2.14.5.7.1. Name Field

The Name field SHALL be a string representing the name of the Zone. This is not guaranteed to be unique.

##### 2.14.5.7.2. Use Field

The Use field SHALL be a [Zone Use Enum](#) representing the purpose of the Zone.

##### 2.14.5.7.3. Vertices Field

The Vertices field SHALL be a list of vertices of type [TwoDCartesianVertexStruct](#). These vertices define a simple polygon on the TwoD Cartesian plane, which represents the bounds of the TwoD Cartesian Zone with an implicit connection between the last and first list items.

##### 2.14.5.7.4. Color Field

This field SHALL indicate the color, in RGB or RGBA, used for attaching a color to the Zone definition and is a purely informational value to help in uniformly presenting Zones in User Interfaces and MAY be ignored. The value SHALL conform to the 6-digit or 8-digit format defined for [CSS sRGB hexadecimal color notation](#) [<https://www.w3.org/TR/css-color-4/#hex-notation>]. If a 6-digit format is used, then the alpha component SHALL assume the value of 0 meaning fully transparent interior.

Examples:

- #00FFFF for R=0x00, G=0xFF, B=0xFF, A absent - For a light-blue zone with full transparency.
- #00FFFF80 for R=0x00, G=0xFF, B=0xFF, A=0x80 - For a light-blue zone with partial interior transparency.
- #000000FF for R=0x00, G=0x00, B=0x00, A=0xFF - For a Privacy type zone that is black and fully




Page 255



opaque interior.

#### 2.14.5.8. ZoneInformationStruct Type

This struct is used to encode basic information about a Zone without containing the specifics of how the zone is defined.

| ID | Name                       | Type                                      | Constraint | Quality | Fallback | Access | Conformance                             |
|----|----------------------------|-------------------------------------------|------------|---------|----------|--------|-----------------------------------------|
| 0  | <b>ZoneID</b>              | <a href="#">ZoneID</a>                    | all        |         |          |        | M                                       |
| 1  | <b>ZoneType</b>            | <a href="#">ZoneType-Enum</a>             | all        |         |          |        | M                                       |
| 2  | <b>Zone-Source</b>         | <a href="#">Zone-SourceEnum</a>           | all        |         |          |        | M                                       |
| 3  | <b>TwoD-Cartesian-Zone</b> | <a href="#">TwoD-Cartesian-ZoneStruct</a> | all        |         |          |        | TWOD-CART & (ZoneType == TwoD-CARTZone) |

##### 2.14.5.8.1. ZoneID Field

This field SHALL indicate the unique ZoneID of the Zone.

##### 2.14.5.8.2. ZoneType Field

This field SHALL indicate the zone type which defines the Zone.

##### 2.14.5.8.3. ZoneSource Field

This field SHALL indicate the source of the Zone.

##### 2.14.5.8.4. TwoDCartesianZone Field

This field SHALL indicate the detailed information for the TwoDCartesianZone.

#### 2.14.5.9. ZoneTriggerControlStruct Type

This struct is used to encode a set of values for controlling the generation of [ZoneTriggered](#) and [ZoneStopped](#) events from the Node.

Zone events can be triggered due to many underlying reasons, such as a motion sensor on the device, and this is intended to be manufacturer-specific. When a triggering activity is initially detected, the Node SHALL generate a [ZoneTriggered](#) event.

This places the Node in a triggered state, at which point the Node SHALL internally track two values.

Page 256



### TimeSinceInitialTrigger

The time in seconds since the initial triggering activity.

### TriggerDetectedDuration

Initially set to the [InitialDuration](#) value.

If the TriggerDetectedDuration value is exceeded by the TimeSinceInitialTrigger, the Node SHALL generate a [ZoneStopped](#) event with the reason parameter set to [ActionStopped](#).

However, if additional triggering actions are detected during this period, the Node SHALL increase the TriggerDetectedDuration value by the [AugmentationDuration](#) value. This process can occur repeatedly but after the first increase of TriggerDetectedDuration the Node SHALL NOT increase the TriggerDetectedDuration value unless the previous TriggerDetectedDuration has been exceeded by the TimeSinceInitialTrigger.

If the TimeSinceInitialTrigger value exceeds the [MaxDuration](#) value, the Node SHALL generate a [ZoneStopped](#) with the reason parameter set to [Timeout](#).

Once a [ZoneStopped](#) event has been generated, the Node SHALL stop detecting the triggering activity for the period of the [BlindDuration](#) value.

| ID | Name                        | Type                   | Constraint          | Quality | Fallback | Access | Conformance  |
|----|-----------------------------|------------------------|---------------------|---------|----------|--------|--------------|
| 0  | <b>ZoneID</b>               | <a href="#">ZoneID</a> | all                 |         |          |        | M            |
| 1  | <b>InitialDuration</b>      | elapsed-s              | 1 to 65535          |         |          |        | M            |
| 2  | <b>AugmentationDuration</b> | elapsed-s              | max InitialDuration |         |          |        | M            |
| 3  | <b>MaxDuration</b>          | elapsed-s              | min InitialDuration |         |          |        | M            |
| 4  | <b>BlindDuration</b>        | elapsed-s              | all                 |         |          |        | M            |
| 5  | <b>Sensitivity</b>          | uint8                  | 1 to SensitivityMax |         |          |        | PERZONE-SENS |

#### 2.14.5.9.1. ZoneID Field

This field SHALL indicate the unique [ZoneID](#) of the Zone this Trigger applies to.

#### 2.14.5.9.2. InitialDuration Field

This field SHALL indicate the initial duration in seconds after triggering activity is first detected before the Node could generate a [ZoneStopped](#) event.




Page 257



#### 2.14.5.9.3. AugmentationDuration Field

This field SHALL indicate the duration in seconds that the [TriggerDetectedDuration](#) value is to be extended by if the triggering activity is still detected during this period.

#### 2.14.5.9.4. MaxDuration Field

This field SHALL indicate the maximum duration in seconds after the initial triggering activity detection that additional triggering activity will be detected.

#### 2.14.5.9.5. BlindDuration Field

This field SHALL indicate the duration in seconds after a [ZoneStopped](#) event is generated that the Node SHALL NOT generate any [ZoneTriggered](#) events.

#### 2.14.5.9.6. Sensitivity Field

This field SHALL indicate the per-zone sensitivity of the underlying zone triggering detection mechanism. The higher the value, the more sensitive the detection. The actual meaning of the values is implementation-specific.

#### 2.14.5.10. ZoneID Type

This data type is derived from uint16.

It represents a defined Zone. This value starts at 0 and monotonically increases by 1 with each new Zone provisioned by the Node or permanently created by the device maker. A value incremented past 65534 SHALL wrap to 0. The Node SHALL verify that the incremented ID does not match any other ID. If such a match is found, the ID SHALL be incremented until a unique ID is found.

A Node SHALL only store a single Zone for a particular ZoneID and that ID SHALL NOT change over the lifetime of the Zone.

### 2.14.6. Attributes

| ID     | Name                        | Type                                             | Constraint     | Quality | Fallback | Access | Conformance |
|--------|-----------------------------|--------------------------------------------------|----------------|---------|----------|--------|-------------|
| 0x0000 | <b>MaxUserDefined-Zones</b> | uint8                                            | min 5          | F       |          | R V    | USERDEFINED |
| 0x0001 | <b>MaxZones</b>             | uint8                                            | min 1          | F       |          | R V    | M           |
| 0x0002 | <b>Zones</b>                | list[ <a href="#">ZoneInformation-Struct</a> ]   | 0 to Max-Zones | N       |          | R V    | M           |
| 0x0003 | <b>Triggers</b>             | list[ <a href="#">ZoneTriggerControlStruct</a> ] | 0 to Max-Zones | N       |          | R V    | M           |

Page 258



| ID     | Name                      | Type                          | Constraint          | Quality | Fallback | Access | Conformance   |
|--------|---------------------------|-------------------------------|---------------------|---------|----------|--------|---------------|
| 0x0004 | <b>SensitivityMax</b>     | uint8                         | 2 to 10             | F       |          | RV     | M             |
| 0x0005 | <b>Sensitivity</b>        | uint8                         | 1 to SensitivityMax | N       |          | RW VO  | !PERZONE-SENS |
| 0x0006 | <b>TwoD-Cartesian-Max</b> | TwoD-Cartesian-Ver-textStruct |                     | F       |          | RV     | TWOD-CART     |

#### 2.14.6.1. MaxUserDefinedZones Attribute

This attribute SHALL specify the maximum number of user-defined zones that can be supported by the Node. This value is manufacturer-defined.

#### 2.14.6.2. MaxZones Attribute

This attribute SHALL specify the maximum number of zones allowed to be created. This value SHALL be the sum of the number of predefined [Mfg Zones](#), and [MaxUserDefinedZones](#), if supported. This value is manufacturer-defined.

#### 2.14.6.3. Zones Attribute

This attribute SHALL specify all currently defined zones as a list of [ZoneInformationStruct](#). Use the commands from this cluster to add, update or remove entries.

#### 2.14.6.4. Triggers Attribute

This attribute SHALL specify all currently defined triggers controlling the generation of [ZoneTriggered](#) and [ZoneStopped](#) events and SHALL be a list of [ZoneTriggerControlStruct](#). To add an entry use [CreateOrUpdateTrigger](#). To remove an entry use [RemoveTrigger](#).

#### 2.14.6.5. SensitivityMax Attribute

This attribute SHALL specify the hardware specific value for the number of supported sensitivity levels. This value is manufacturer defined. If the PerZoneSensitivity feature is supported, the value of this attribute determines valid values for the Sensitivity field in [ZoneTriggerControlStruct](#); if the PerZoneSensitivity feature is not supported, the value of this attribute determines valid values for the [Sensitivity Attribute](#). Implementations require two to ten levels of sensitivity control in order to ensure that there is some user-level customization of the Trigger.

#### 2.14.6.6. Sensitivity Attribute

This attribute SHALL specify the sensitivity of the underlying zone triggering detection mechanism if the PerZoneSensitivity features is not supported. The higher the value the more sensitive the detection. The actual meaning of the values is implementation specific.




Page 259



#### 2.14.6.7. TwoDCartesianMax Attribute

This attribute SHALL specify the maximum X and Y points that are allowed for TwoD Cartesian Zones. If this cluster is on the same endpoint as [Camera AV Stream Management Cluster](#), these values SHALL be equal to the value of `SensorWidth - 1` and `SensorHeight - 1` from the [VideoSensor-Params](#) attribute.

#### 2.14.7. Commands

| ID   | Name                                   | Direction                      | Response                        | Access | Quality | Conformance            |
|------|----------------------------------------|--------------------------------|---------------------------------|--------|---------|------------------------|
| 0x00 | <b>CreateTwoDCartesianZone</b>         | client $\Rightarrow$<br>server | CreateTwoDCartesianZoneResponse | M      |         | TWODCART & USERDEFINED |
| 0x01 | <b>CreateTwoDCartesianZoneResponse</b> | client $\Leftarrow$<br>server  | N                               |        |         | TWODCART & USERDEFINED |
| 0x02 | <b>UpdateTwoDCartesianZone</b>         | client $\Rightarrow$<br>server | Y                               | M      |         | TWODCART & USERDEFINED |
| 0x03 | <b>RemoveZone</b>                      | client $\Rightarrow$<br>server | Y                               | M      |         | USERDEFINED            |
| 0x04 | <b>CreateOrUpdateTrigger</b>           | client $\Rightarrow$<br>server | Y                               | M      |         | M                      |
| 0x05 | <b>RemoveTrigger</b>                   | client $\Rightarrow$<br>server | Y                               | M      |         | M                      |

##### 2.14.7.1. CreateTwoDCartesianZone Command

This command SHALL create and store a TwoD Cartesian Zone.

| ID | Name        | Type                                    | Constraint | Quality | Fallback | Conformance |
|----|-------------|-----------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Zone</b> | <a href="#">TwoDCartesianZoneStruct</a> |            |         |          | M           |

##### 2.14.7.1.1. Zone Field

The Zone field SHALL be a [TwoDCartesianZoneStruct](#) representing all information required to define the TwoD Cartesian Zone.

Page 260



### 2.14.7.1.2. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If the current number of UserDefined Zones within [Zones](#) equals [MaxUserDefinedZones](#):
  - Fail the command with the status code RESOURCE\_EXHAUSTED, and end processing with no other side effects.
- If the [Use](#) field of the passed in [Zone](#) is [Focus Value](#) and the device does not support [FocusZones](#):
  - Fail the command with the status code CONSTRAINT\_ERROR, and end processing with no other side effects.
- If any [X](#) or [Y](#) points, in the [Vertices](#) field, of the [TwoDCartesianZone](#) field, of the passed in [Zone](#), are greater than the corresponding point values in [TwoDCartesianMax](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If the [Vertices](#) and [Use](#) fields, of the [TwoDCartesianZone](#) field, of the passed in [Zone](#), exactly match the corresponding fields of any entry in the [Zones](#) attribute:
  - Fail the command with the status code ALREADY\_EXISTS, and end processing with no other side effects.
- If the resulting shape of the [Vertices](#) field, of the [TwoDCartesianZone](#) field, of the passed in [Zone](#), results in any self-intersecting lines:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- Create a new [ZoneID](#) as described in [ZoneID](#) within [Zones](#)
- Create a new [ZoneInformationStruct](#) setting [ZoneID](#) to the new [ZoneID](#), [ZoneSource](#) to [User](#), the passed in [Zone](#) as [TwoDCartesianZone](#), and [ZoneType](#) to [TwoDCARTZone](#).
- Add that [ZoneInformationStruct](#) as a new entry in [Zones](#).
- Return the new [ZoneID](#) in the corresponding [CreateTwoDCartesianZoneResponse](#) command.

### 2.14.7.2. CreateTwoDCartesianZoneResponse Command

This command SHALL be generated in response to a CreateTwoDCartesianZone command.

| ID | Name                   | Type                   | Constraint | Quality | Fallback | Conformance |
|----|------------------------|------------------------|------------|---------|----------|-------------|
| 0  | <a href="#">ZoneID</a> | <a href="#">ZoneID</a> |            |         |          | M           |

#### 2.14.7.2.1. ZoneID Field

The [ZoneID](#) field SHALL be an unsigned 16 bit integer representing the unique [ZoneID](#).

### 2.14.7.3. UpdateTwoDCartesianZone Command

The [UpdateTwoDCartesianZone](#) SHALL update a stored [TwoD Cartesian Zone](#).




Page 261



| ID | Name   | Type                    | Constraint | Quality | Fallback | Conformance |
|----|--------|-------------------------|------------|---------|----------|-------------|
| 0  | ZoneID | ZoneID                  |            |         |          | M           |
| 1  | Zone   | TwoDCartesianZoneStruct |            |         |          | M           |

#### 2.14.7.3.1. ZoneID Field

The ZoneID field SHALL be a [ZoneID](#) of the Zone to be updated.

#### 2.14.7.3.2. Zone Field

The Zone field SHALL be a [TwoDCartesianZoneStruct](#) representing updated Zone information.

#### 2.14.7.3.3. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If no entry can be found for the ZoneID in the [Zones](#) attribute:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the requested zone's [ZoneSource](#) is [Mfg](#):
  - Fail the command with the status code CONSTRAINT\_ERROR, and end processing with no other side effects.
- If the requested zone's [ZoneType](#) is not [TwoDCARTZone](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If any requested [X](#) or [Y](#) points in the vertices are greater than the corresponding point values in [TwoDCartesianMax](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If the requested zone's [Vertices](#) and [Use](#) fields exactly match any *other* existing Zone definition:
  - Fail the command with the status code ALREADY\_EXISTS, and end processing with no other side effects.
- If the provided vertices result in a self-intersecting shape:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- Update the Zone details for the ZoneID entry within [Zones](#).

#### 2.14.7.4. RemoveZone Command

This command SHALL remove the user-defined Zone indicated by ZoneID.

Page 262







| ID | Name   | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------|--------|------------|---------|----------|-------------|
| 0  | ZoneID | ZoneID |            |         |          | M           |

#### 2.14.7.4.1. ZoneID Field

The ZoneID field SHALL be a [ZoneID](#) of the Zone to be removed.

#### 2.14.7.4.2. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If no entry can be found for the passed in *ZoneID* in the [Zones](#) attribute:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the requested zone's [ZoneSource](#) is [Mfg](#):
  - Fail the command with the status code CONSTRAINT\_ERROR, and end processing with no other side effects.
- If the passed in *ZoneID* is found in the [ZoneID](#) field of any entry in the [Triggers](#) list:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- Remove the entry for the passed in *ZoneID* from the [Zones](#) list.

### 2.14.7.5. CreateOrUpdateTrigger Command

This command is used to create or update a Trigger for the specified motion Zone.

| ID | Name    | Type                     | Constraint | Quality | Fallback | Conformance |
|----|---------|--------------------------|------------|---------|----------|-------------|
| 0  | Trigger | ZoneTriggerControlStruct |            |         |          | M           |

#### 2.14.7.5.1. Trigger Field

This field SHALL be a [ZoneTriggerControlStruct](#) representing all information required to define the Trigger conditions.

#### 2.14.7.5.2. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If no entry can be found for the [ZoneID](#) field value of the passed in *Trigger*, in the [Zones](#) attribute:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.




Page 263



- If the [Zone use](#) for that entry is not [Motion Value](#):
  - Fail the command with the status code CONSTRAINT\_ERROR, and end processing with no other side effects.
- Add or update the passed in *Trigger* entry in the [Triggers](#) attribute.

#### 2.14.7.6. RemoveTrigger Command

This command SHALL remove the Trigger for the provided ZoneID.

| ID | Name                   | Type                   | Constraint | Quality | Fallback | Conformance |
|----|------------------------|------------------------|------------|---------|----------|-------------|
| 0  | <a href="#">ZoneID</a> | <a href="#">ZoneID</a> |            |         |          | M           |

##### 2.14.7.6.1. ZoneID Field

The ZoneID field SHALL be a [ZoneID](#) of the Zone Trigger to be removed.

##### 2.14.7.6.2. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If no entry can be found for the passed in *ZoneID* in the [Triggers](#) attribute:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- Remove the entry associated with *ZoneID* from the [Triggers](#) attribute.

#### 2.14.8. Events

| ID   | Name                          | Priority | Quality | Access | Conformance |
|------|-------------------------------|----------|---------|--------|-------------|
| 0x00 | <a href="#">ZoneTriggered</a> | INFO     |         | V      | M           |
| 0x01 | <a href="#">ZoneStopped</a>   | INFO     |         | V      | M           |

##### 2.14.8.1. ZoneTriggered Event

This event SHALL be generated when a Zone is first triggered.

| ID     | Name                   | Type                                         | Constraint | Quality | Fallback | Conformance |
|--------|------------------------|----------------------------------------------|------------|---------|----------|-------------|
| 0x0000 | <a href="#">Zone</a>   | <a href="#">ZoneID</a>                       | all        |         |          | M           |
| 0x0001 | <a href="#">Reason</a> | <a href="#">ZoneEventTriggeredReasonEnum</a> | all        |         |          | M           |

Page 264



#### 2.14.8.1.1. Zone Field

This field SHALL contain the [ZoneID](#) of the Zone that triggered.

#### 2.14.8.1.2. Reason Field

This field SHALL indicate why the zone was triggered.

#### 2.14.8.2. ZoneStopped Event

This event SHALL be generated when either the [TriggerDetectedDuration](#) value is exceeded by the [TimeSinceInitialTrigger](#) value or the [MaxDuration](#) value is exceeded by the [TimeSinceInitialTrigger](#) value, as described in [Section 2.14.5.9, “ZoneTriggerControlStruct”](#).

| ID     | Name          | Type                                       | Constraint | Quality | Fallback | Conformance |
|--------|---------------|--------------------------------------------|------------|---------|----------|-------------|
| 0x0000 | <b>Zone</b>   | <a href="#">ZoneID</a>                     | all        |         |          | M           |
| 0x0001 | <b>Reason</b> | <a href="#">ZoneEventStoppedReasonEnum</a> | all        |         |          | M           |

##### 2.14.8.2.1. Zone Field

This field SHALL contain the [ZoneID](#) of the Zone that stopped.

##### 2.14.8.2.2. Reason Field

This field SHALL indicate why the zone stopped triggering.

### 2.15. Soil Measurement Cluster

This cluster provides an interface to soil measurement functionality, including configuration and provision of notifications of soil measurements.

#### 2.15.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

#### 2.15.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | SOIL      |




Page 265



### 2.15.3. Cluster ID

| ID     | Name             |
|--------|------------------|
| 0x0430 | Soil Measurement |

### 2.15.4. Attributes

| ID     | Name                          | Type                      | Constraint                                                                                       | Quality | Fallback | Access | Conformance |
|--------|-------------------------------|---------------------------|--------------------------------------------------------------------------------------------------|---------|----------|--------|-------------|
| 0x0000 | SoilMoistureMeasurementLimits | MeasurementAccuracyStruct |                                                                                                  | F       |          | RV     | M           |
| 0x0001 | SoilMoistureMeasuredValue     | percent                   | SoilMoistureMeasurementLimits.MinMeasuredValue to SoilMoistureMeasurementLimits.MaxMeasuredValue | X       |          | RV     | M           |

#### 2.15.4.1. SoilMoistureMeasurementLimits Attribute

This attribute SHALL indicate the limits for the SoilMoistureMeasuredValue attribute.

Given the measurements are in percentage, the MinMeasuredValue field in the SoilMoistureMeasurementLimits attribute SHALL NOT be less than 0 and SHALL NOT be greater than 99. The MaxMeasuredValue field in the SoilMoistureMeasurementLimits attribute SHALL NOT be less than (SoilMoistureMinMeasurableValue + 1) and SHALL NOT be greater than 100. The MeasurementType field value SHALL be set to SoilMoisture.

There SHALL only be a single entry in the AccuracyRanges list of the SoilMoistureMeasurementLimits attribute. The entry SHALL cover the full measurement range, meaning that the value of the RangeMin field SHALL be equal to the value of the MinMeasuredValue field and the value of the RangeMax field SHALL be equal to the value of the MaxMeasuredValue field. The entry SHALL only indicate a PercentMax value and the value SHALL NOT be greater than 10.00 percent.

Page 266







**2.15.4.2. SoilMoistureMeasuredValue Attribute**

This attribute SHALL indicate the water content of the soil in percentage.

The null value indicates that the measurement is unknown e.g. no measurement has been performed yet.



Page 267



Page 268







# Chapter 3. Lighting

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter. References to external documents are contained in Chapter 1 and are made using *[Rn]* notation.

## 3.1. General Description

### 3.1.1. Introduction

The clusters specified in this document are for use typically in lighting applications, but MAY be used in any application domain.

### 3.1.2. Terms

**HSV**: Hue, Saturation, Value. A color space, also known as HSB (Hue, Saturation, Brightness). This is a well-known transformation of the RGB (Red, Green, Blue) color space. For more information see e.g., [http://en.wikipedia.org/wiki/HSV\\_color\\_space](http://en.wikipedia.org/wiki/HSV_color_space).

**Illuminance**: The density of incident luminous flux on a surface. Illuminance is the standard metric for lighting levels, and is measured in lux (lx).

### 3.1.3. The Dimming Light Curve

The dimming curve is recommended to be logarithmic, as defined by the following equation:

$$\%Light = 10 \left\{ \left( \frac{Level-1}{253} \right)^{\frac{1}{3}} \right\}^{-1}$$

Where: %Light is the percent light output of the ballast and Level is an 8-bit integer between 1 (0.1% light output) and 254 (100% output) that is adjusted for MinLevel and MaxLevel using the following equation:

$$Level = MinLevel + (MaxLevel - MinLevel) * (CurrentLevel - 1) / 253.$$

**NOTE** Value 255 is not used.

The table below gives a couple of examples of the dimming light curve for different values of MinLevel, MaxLevel and CurrentLevel.

*Table 6. Examples of The Dimming Light Curve*

| MinLevel | MaxLevel | CurrentLevel | Level | %Light |
|----------|----------|--------------|-------|--------|
| 1        | 254      | 1            | 1     | 0.10%  |
| 1        | 254      | 10           | 10    | 0.13%  |



Page 269



| MinLevel | MaxLevel | CurrentLevel | Level | %Light |
|----------|----------|--------------|-------|--------|
| 1        | 254      | 100          | 100   | 1.49%  |
| 1        | 254      | 254          | 254   | 100%   |
| 170      | 254      | 1            | 170   | 10.1%  |
| 170      | 254      | 10           | 173   | 11.0%  |
| 170      | 254      | 100          | 203   | 24.8%  |
| 170      | 254      | 254          | 254   | 100%   |
| 170      | 230      | 1            | 170   | 10.1%  |
| 170      | 230      | 10           | 172   | 10.7%  |
| 170      | 230      | 100          | 193   | 19.2%  |
| 170      | 230      | 254          | 230   | 51.9%  |

### 3.1.4. Cluster List

This section lists the lighting specific clusters as specified in this chapter.

*Table 7. Overview of the Lighting Clusters*

| Cluster ID | Cluster Name  | Description                                                                 |
|------------|---------------|-----------------------------------------------------------------------------|
| 0x0300     | Color Control | Attributes and commands for controlling the color of a color-capable light. |

## 3.2. Color Control Cluster

This cluster provides an interface for changing the color of a light. Color is specified according to the [CIE 1931 Color space](#). Color control is carried out in terms of x,y values, as defined by this specification.

Additionally, color MAY optionally be controlled in terms of color temperature, or as hue and saturation values based on optionally variable RGB and W color points. It is recommended that the hue and saturation are interpreted according to the HSV (a.k.a. HSB) color model.

Control over luminance is not included, as this is provided by means of the Level Control for Lighting cluster. It is recommended that the level provided by this cluster be interpreted as representing a proportion of the maximum intensity achievable at the current color.

### 3.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

Page 270







| Revision | Description                                                                                                                                                                                                                                                                           |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added; CCB 2028                                                                                                                                                                                                                            |
| 2        | Added Options attribute, CCB 2085 2104 2124 2230; ZLO 1.0                                                                                                                                                                                                                             |
| 3        | CCB 2501 2814 2839 2840 2843 2861                                                                                                                                                                                                                                                     |
| 4        | All Hubs changes                                                                                                                                                                                                                                                                      |
| 5        | New data model format and notation, FeatureMap support                                                                                                                                                                                                                                |
| 6        | Added clarifications to Scenes support for Matter                                                                                                                                                                                                                                     |
| 7        | Added Q quality for CurrentHue, CurrentSaturation, CurrentX, CurrentY, ColorTemperatureMireds, EnhancedCurrentHue and RemainingTime attributes. Added clarifications for behavior related to Step values. Added constraints on minimum acceptable color temperature values in mireds. |
| 8        | Change WhitePoint* and ColorPoint* attributes from RW to R (CCB 2490, TCR 11893)                                                                                                                                                                                                      |

### 3.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | CC        |

### 3.2.3. Cluster ID

| ID     | Name          |
|--------|---------------|
| 0x0300 | Color Control |

### 3.2.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature       | Conformance | Summary                                          |
|-----|------|---------------|-------------|--------------------------------------------------|
| 0   | HS   | HueSaturation | EHUE, O     | Supports color specification via hue/saturation. |
| 1   | EHUE | EnhancedHue   | CL, O       | Enhanced hue is supported.                       |




Page 271



| Bit | Code | Feature          | Conformance | Summary                                      |
|-----|------|------------------|-------------|----------------------------------------------|
| 2   | CL   | ColorLoop        | 0           | Color loop is supported.                     |
| 3   | XY   | XY               | 0           | Supports color specification via XY.         |
| 4   | CT   | ColorTemperature | 0           | Supports specification of color temperature. |

### 3.2.5. Dependencies

#### 3.2.5.1. Coupling color temperature to Level Control

If the Level Control for Lighting cluster identifier 0x0008 is supported on the same endpoint as the Color Control cluster and color temperature is supported, it is possible to couple changes in the current level to the color temperature.

The CoupleColorTempToLevel bit of the Options attribute of the Level Control cluster indicates whether the color temperature is to be linked with the CurrentLevel attribute in the Level Control cluster.

If the CoupleColorTempToLevel bit of the Options attribute of the Level Control cluster is equal to 1 and the ColorMode or EnhancedColorMode attribute is set to 2 (ColorTemperatureMireds) then a change in the CurrentLevel attribute SHALL affect the ColorTemperatureMireds attribute. This relationship is manufacturer specific, with the qualification that the maximum value of the CurrentLevel attribute SHALL correspond to a ColorTemperatureMired attribute value equal to the CoupleColorTempToLevelMinMireds attribute. This relationship is one-way so a change to the ColorTemperatureMireds attribute SHALL NOT have any effect on the CurrentLevel attribute.

In order to simulate the behavior of an incandescent bulb, a low value of the CurrentLevel attribute SHALL be associated with a high value of the ColorTemperatureMireds attribute (i.e., a low value of color temperature in kelvins).

If the CoupleColorTempToLevel bit of the Options attribute of the Level Control cluster is equal to 0, there SHALL be no link between color temperature and current level.

#### 3.2.5.2. Independent transition in hue and saturation

Various commands in this cluster can be used to start transitions in hue and/or saturation.

- When a transition in hue is in progress, and a command to change saturation (MoveSaturation (with MoveMode!=Stop), StepSaturation, MoveToSaturation) is received by the server, this latter command SHALL NOT interrupt the ongoing transition in hue.
- When a transition in saturation is in progress, and a command to change hue (MoveHue (with MoveMode!=Stop), EnhancedMoveHue (with MoveMode!=Stop) StepHue, EnhancedStepHue, MoveToHue, EnhancedMoveToHue) is received by the server, this latter command SHALL NOT

Page 272







interrupt the ongoing transition in saturation.

### 3.2.6. Data Types

#### 3.2.6.1. ColorCapabilitiesBitmap Type

This data type is derived from map16.

| Bit | Name                    | Summary                                             | Conformance |
|-----|-------------------------|-----------------------------------------------------|-------------|
| 0   | <b>HueSaturation</b>    | Supports color specification via hue/saturation.    | HS          |
| 1   | <b>EnhancedHue</b>      | Enhanced hue is supported.                          | EHUE        |
| 2   | <b>ColorLoop</b>        | Color loop is supported.                            | CL          |
| 3   | <b>XY</b>               | Supports color specification via XY.                | XY          |
| 4   | <b>ColorTemperature</b> | Supports color specification via color temperature. | CT          |

#### 3.2.6.2. OptionsBitmap Type

This data type is derived from map8.

| Bit | Name                | Summary                      | Conformance |
|-----|---------------------|------------------------------|-------------|
| 0   | <b>ExecuteIfOff</b> | Dependency on On/Off cluster | M           |

##### 3.2.6.2.1. ExecuteIfOff Bit

This bit SHALL indicate if this cluster server instance has a dependency with the On/Off cluster.

#### 3.2.6.3. UpdateFlagsBitmap Type

This data type is derived from map8 and is used in the ColorLoopSet command.

| Bit | Name                   | Summary                                            | Conformance |
|-----|------------------------|----------------------------------------------------|-------------|
| 0   | <b>UpdateAction</b>    | Device adheres to the associated action field.     | M           |
| 1   | <b>UpdateDirection</b> | Device updates the associated direction attribute. | M           |




Page 273



| Bit | Name                  | Summary                                            | Conformance |
|-----|-----------------------|----------------------------------------------------|-------------|
| 2   | <b>UpdateTime</b>     | Device updates the associated time attribute.      | M           |
| 3   | <b>UpdateStartHue</b> | Device updates the associated start hue attribute. | M           |

#### 3.2.6.3.1. UpdateAction Bit

This bit SHALL indicate whether the server adheres to the Action field in order to process the command.

- 0 = Device SHALL ignore the Action field.
- 1 = Device SHALL adhere to the Action field.

#### 3.2.6.3.2. UpdateDirection Bit

This bit SHALL indicate whether the device updates the ColorLoopDirection attribute with the Direction field.

- 0 = Device SHALL ignore the Direction field.
- 1 = Device SHALL update the ColorLoopDirection attribute with the value of the Direction field.

#### 3.2.6.3.3. UpdateTime Bit

This bit SHALL indicate whether the device updates the ColorLoopTime attribute with the Time field.

- 0 = Device SHALL ignore the Time field.
- 1 = Device SHALL update the value of the ColorLoopTime attribute with the value of the Time field.

#### 3.2.6.3.4. UpdateStartHue Bit

This bit SHALL indicate whether the device updates the ColorLoopStartEnhancedHue attribute with the value of the StartHue field.

- 0 = Device SHALL ignore the StartHue field.
- 1 = Device SHALL update the value of the ColorLoopStartEnhancedHue attribute with the value of the StartHue field.

#### 3.2.6.4. DriftCompensationEnum Type

This data type is derived from enum8.

Page 274







| Value | Name                                  | Summary                                                                 | Conformance |
|-------|---------------------------------------|-------------------------------------------------------------------------|-------------|
| 0     | None                                  | There is no compensation.                                               | M           |
| 1     | OtherOrUnknown                        | The compensation is based on other or unknown mechanism.                | M           |
| 2     | TemperatureMonitoring                 | The compensation is based on temperature monitoring.                    | M           |
| 3     | OpticalLuminanceMonitoringAndFeedback | The compensation is based on optical luminance monitoring and feedback. | M           |
| 4     | OpticalColorMonitoringAndFeedback     | The compensation is based on optical color monitoring and feedback.     | M           |

### 3.2.6.5. ColorModeEnum Type

This data type is derived from enum8.

| Value | Name                           | Summary                                                        | Conformance |
|-------|--------------------------------|----------------------------------------------------------------|-------------|
| 0     | CurrentHueAndCurrentSaturation | The current hue and saturation attributes determine the color. | M           |
| 1     | CurrentXAndCurrentY            | The current X and Y attributes determine the color.            | M           |
| 2     | ColorTemperatureMireds         | The color temperature attribute determines the color.          | M           |

### 3.2.6.6. EnhancedColorModeEnum Type

This data type is derived from enum8.

| Value | Name                           | Summary                                                        | Conformance |
|-------|--------------------------------|----------------------------------------------------------------|-------------|
| 0     | CurrentHueAndCurrentSaturation | The current hue and saturation attributes determine the color. | M           |
| 1     | CurrentXAndCurrentY            | The current X and Y attributes determine the color.            | M           |




Page 275



| Value | Name                                          | Summary                                                                 | Conformance |
|-------|-----------------------------------------------|-------------------------------------------------------------------------|-------------|
| 2     | <b>ColorTemperatureMireds</b>                 | The color temperature attribute determines the color.                   | M           |
| 3     | <b>EnhancedCurrentHueAndCurrentSaturation</b> | The enhanced current hue and saturation attributes determine the color. | M           |

### 3.2.6.7. DirectionEnum Type

This data type is derived from enum8.

| Value | Name            | Summary           | Conformance |
|-------|-----------------|-------------------|-------------|
| 0     | <b>Shortest</b> | Shortest distance | M           |
| 1     | <b>Longest</b>  | Longest distance  | M           |
| 2     | <b>Up</b>       | Up                | M           |
| 3     | <b>Down</b>     | Down              | M           |

### 3.2.6.8. MoveModeEnum Type

This data type is derived from enum8.

| Value | Name        | Summary                       | Conformance |
|-------|-------------|-------------------------------|-------------|
| 0     | <b>Stop</b> | Stop the movement             | M           |
| 1     | <b>Up</b>   | Move in an upwards direction  | M           |
| 3     | <b>Down</b> | Move in a downwards direction | M           |

### 3.2.6.9. StepModeEnum Type

This data type is derived from enum8.

| Value | Name        | Summary                       | Conformance |
|-------|-------------|-------------------------------|-------------|
| 1     | <b>Up</b>   | Step in an upwards direction  | M           |
| 3     | <b>Down</b> | Step in a downwards direction | M           |

### 3.2.6.10. ColorLoopActionEnum Type

This data type is derived from enum8.

Page 276



| Value | Name                                         | Summary                                                                        | Conformance |
|-------|----------------------------------------------|--------------------------------------------------------------------------------|-------------|
| 0     | <b>Deactivate</b>                            | De-activate the color loop.                                                    | M           |
| 1     | <b>ActivateFromColorLoopStartEnhancedHue</b> | Activate the color loop from the value in the ColorLoopStartEnhancedHue field. | M           |
| 2     | <b>ActivateFromEnhancedCurrentHue</b>        | Activate the color loop from the value of the EnhancedCurrentHue attribute.    | M           |

### 3.2.6.11. ColorLoopDirectionEnum Type

This data type is derived from enum8.

| Value | Name             | Summary                              | Conformance |
|-------|------------------|--------------------------------------|-------------|
| 0     | <b>Decrement</b> | Decrement the hue in the color loop. | M           |
| 1     | <b>Increment</b> | Increment the hue in the color loop. | M           |

### 3.2.7. Attributes

| ID     | Name                     | Type                  | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------|-----------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>CurrentHue</b>        | uint8                 | max 254    | N P Q   |          | R V    | HS          |
| 0x0001 | <b>CurrentSaturation</b> | uint8                 | max 254    | N P Q S |          | R V    | HS          |
| 0x0002 | <b>RemainingTime</b>     | uint16                | max 65534  | Q       | 0        | R V    | O           |
| 0x0003 | <b>CurrentX</b>          | uint16                | max 65279  | N P Q S |          | R V    | XY          |
| 0x0004 | <b>CurrentY</b>          | uint16                | max 65279  | N P Q S |          | R V    | XY          |
| 0x0005 | <b>DriftCompensation</b> | DriftCompensationEnum | all        |         | -        | R V    | O           |
| 0x0006 | <b>CompensationText</b>  | string                | max 254    |         | -        | R V    | O           |




Page 277



| ID     | Name                   | Type          | Constraint | Quality | Fallback | Access | Conformance              |
|--------|------------------------|---------------|------------|---------|----------|--------|--------------------------|
| 0x0007 | ColorTemperatureMireds | uint16        | max 65279  | N P Q S |          | R V    | CT                       |
| 0x0008 | ColorMode              | ColorModeEnum | all        | N       |          | R V    | M                        |
| 0x000F | Options                | OptionsBitmap | desc       |         |          | RW VO  | M                        |
| 0x0010 | NumberOfPrimaries      | uint8         | max 6      | F X     |          | R V    | M                        |
| 0x0011 | Primary1X              | uint16        | max 65279  | F       |          | R V    | NumberOfPrimaries > 0, O |
| 0x0012 | Primary1Y              | uint16        | max 65279  | F       |          | R V    | NumberOfPrimaries > 0, O |
| 0x0013 | Primary1Intensity      | uint8         | all        | F X     |          | R V    | NumberOfPrimaries > 0, O |
| 0x0015 | Primary2X              | uint16        | max 65279  | F       |          | R V    | NumberOfPrimaries > 1, O |
| 0x0016 | Primary2Y              | uint16        | max 65279  | F       |          | R V    | NumberOfPrimaries > 1, O |
| 0x0017 | Primary2Intensity      | uint8         | all        | F X     |          | R V    | NumberOfPrimaries > 1, O |
| 0x0019 | Primary3X              | uint16        | max 65279  | F       |          | R V    | NumberOfPrimaries > 2, O |
| 0x001A | Primary3Y              | uint16        | max 65279  | F       |          | R V    | NumberOfPrimaries > 2, O |
| 0x001B | Primary3Intensity      | uint8         | all        | F X     |          | R V    | NumberOfPrimaries > 2, O |

Page 278







| ID     | Name                        | Type   | Constraint | Quality | Fallback | Access | Conformance              |
|--------|-----------------------------|--------|------------|---------|----------|--------|--------------------------|
| 0x0020 | <b>Primary4X</b>            | uint16 | max 65279  | F       |          | R V    | NumberOfPrimaries > 3, O |
| 0x0021 | <b>Primary4Y</b>            | uint16 | max 65279  | F       |          | R V    | NumberOfPrimaries > 3, O |
| 0x0022 | <b>Primary4Intensity</b>    | uint8  | all        | F X     |          | R V    | NumberOfPrimaries > 3, O |
| 0x0024 | <b>Primary5X</b>            | uint16 | max 65279  | F       |          | R V    | NumberOfPrimaries > 4, O |
| 0x0025 | <b>Primary5Y</b>            | uint16 | max 65279  | F       |          | R V    | NumberOfPrimaries > 4, O |
| 0x0026 | <b>Primary5Intensity</b>    | uint8  | all        | F X     |          | R V    | NumberOfPrimaries > 4, O |
| 0x0028 | <b>Primary6X</b>            | uint16 | max 65279  | F       |          | R V    | NumberOfPrimaries > 5, O |
| 0x0029 | <b>Primary6Y</b>            | uint16 | max 65279  | F       |          | R V    | NumberOfPrimaries > 5, O |
| 0x002A | <b>Primary6Intensity</b>    | uint8  | all        | F X     |          | R V    | NumberOfPrimaries > 5, O |
| 0x0030 | <b>WhitePointX</b>          | uint16 | max 65279  |         |          | R V    | O                        |
| 0x0031 | <b>WhitePointY</b>          | uint16 | max 65279  |         |          | R V    | O                        |
| 0x0032 | <b>ColorPointRX</b>         | uint16 | max 65279  |         |          | R V    | O                        |
| 0x0033 | <b>ColorPointRY</b>         | uint16 | max 65279  |         |          | R V    | O                        |
| 0x0034 | <b>ColorPointRIntensity</b> | uint8  | all        | X       |          | R V    | O                        |



Page 279



| ID     | Name                         | Type                    | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------------|-------------------------|------------|---------|----------|--------|-------------|
| 0x0036 | Color-PointGX                | uint16                  | max 65279  |         |          | RV     | O           |
| 0x0037 | Color-PointGY                | uint16                  | max 65279  |         |          | RV     | O           |
| 0x0038 | Color-PointGIntensity        | uint8                   | all        | X       |          | RV     | O           |
| 0x003A | Color-PointBX                | uint16                  | max 65279  |         |          | RV     | O           |
| 0x003B | Color-PointBY                | uint16                  | max 65279  |         |          | RV     | O           |
| 0x003C | Color-PointBIntensity        | uint8                   | all        | X       |          | RV     | O           |
| 0x4000 | Enhanced-CurrentHue          | uint16                  | all        | N Q S   |          | RV     | EHUE        |
| 0x4001 | Enhanced-Color-Mode          | Enhanced-ColorModeEnum  | all        | N S     |          | RV     | M           |
| 0x4002 | Color-LoopActive             | uint8                   | max 1      | N S     |          | RV     | CL          |
| 0x4003 | Color-LoopDirection          | Color-LoopDirectionEnum | all        | N S     |          | RV     | CL          |
| 0x4004 | Color-LoopTime               | uint16                  | all        | N S     |          | RV     | CL          |
| 0x4005 | Color-Loop-StartEnhanced-Hue | uint16                  | all        |         |          | RV     | CL          |
| 0x4006 | Color-Loop-StoreEnhanced-Hue | uint16                  | all        |         |          | RV     | CL          |

Page 280







| ID     | Name                          | Type                     | Constraint                                       | Quality | Fallback | Access | Conformance |
|--------|-------------------------------|--------------------------|--------------------------------------------------|---------|----------|--------|-------------|
| 0x400A | ColorCapabilities             | ColorCapabilities-Bitmap | max 0x1F                                         |         |          | RV     | M           |
| 0x400B | ColorPhysicalMinMireds        | uint16                   | 1 to 65279                                       |         |          | RV     | CT          |
| 0x400C | ColorPhysicalMaxMireds        | uint16                   | max 65279                                        |         |          | RV     | CT          |
| 0x400D | CoupleColorTemperatureMireds  | uint16                   | ColorTemperatureMireds to ColorTemperatureMireds |         |          | RV     | CT          |
| 0x4010 | StartUpColorTemperatureMireds | uint16                   | 1 to 65279                                       | N X     |          | RW VM  | CT          |

### 3.2.7.1. Scene Table Extensions

If the Scenes Management server cluster is implemented on the same endpoint, the following attributes SHALL be part of the ExtensionFieldSetStruct of the Scene Table. If an attribute is not implemented, the value that will be used for it in the AttributeValuePairStruct is given in parentheses. If the implicit form of the ExtensionFieldSetStruct is used, the order of the attributes in the AttributeValueList is in the given order, i.e., the attribute listed as 1 is added first:

1. CurrentX (0)
2. CurrentY (0)
3. EnhancedCurrentHue (null)
4. CurrentSaturation (null)
5. ColorLoopActive (0)
6. ColorLoopDirection (Decrement)
7. ColorLoopTime (0)



Page 281



## 8. ColorTemperatureMireds (null)

## 9. EnhancedColorMode

Since there is a direct relation between ColorTemperatureMireds and XY, color temperature, if supported, is stored as XY in the scenes table.

Attributes in the scene table that are not supported by the device (according to the FeatureMap attribute) SHALL be present in the scene table but ignored.

If the Scenes Management cluster server is implemented on the same endpoint, and the cluster revision is 6 or above, then all extension fields in the list above, including up to EnhancedColorMode (item 9), SHALL be present in the extension fields set for a Scene to be considered valid. This disambiguates the color mode used within the Scene.

### 3.2.7.2. **CurrentHue Attribute**

The CurrentHue attribute contains the current hue value of the light. It is updated as fast as practical during commands that change the hue.

The hue in degrees SHALL be related to the CurrentHue attribute by the relationship:

$$\text{Hue} = \text{"CurrentHue"} \times 360 / 254$$

where CurrentHue is in the range from 0 to 254 inclusive.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second or
- At the end of the movement/transition.

### 3.2.7.3. **CurrentSaturation Attribute**

This attribute SHALL indicate the current saturation value of the light. It is updated as fast as practical during commands that change the saturation.

The saturation (on a scale from 0.0 to 1.0) SHALL be related to the CurrentSaturation attribute by the relationship:

$$\text{Saturation} = \text{"CurrentSaturation"} / 254$$

where CurrentSaturation is in the range from 0 to 254 inclusive.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second or
- At the end of the movement/transition.

Page 282







### 3.2.7.4. RemainingTime Attribute

This attribute SHALL indicate the time remaining, in 1/10ths of a second, until transitions due to the currently active command will be complete.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- When it changes from 0 to any value higher than 10, or
- When it changes, with a delta larger than 10, caused by the invoke of a command, or
- When it changes to 0.

For commands with a transition time or changes to the transition time less than 1 second, changes to this attribute SHALL NOT be reported.

As this attribute is not being reported during a regular countdown, clients SHOULD NOT rely on the reporting of this attribute in order to keep track of the remaining duration.

### 3.2.7.5. CurrentX Attribute

This attribute SHALL indicate the current value of the normalized chromaticity value  $x$ , as defined in the CIE xyY Color Space. It is updated as fast as practical during commands that change the color.

The value of  $x$  SHALL be related to the CurrentX attribute by the relationship

$$x = \text{"CurrentX"} / 65536$$

where CurrentX is in the range from 0 to 65279 inclusive.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second or
- At the end of the movement/transition.

### 3.2.7.6. CurrentY Attribute

This attribute SHALL indicate the current value of the normalized chromaticity value  $y$ , as defined in the CIE xyY Color Space. It is updated as fast as practical during commands that change the color.

The value of  $y$  SHALL be related to the CurrentY attribute by the relationship

$$y = \text{"CurrentY"} / 65536$$

where CurrentY is in the range from 0 to 65279 inclusive.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second or
- At the end of the movement/transition.



Page 283



### 3.2.7.7. DriftCompensation Attribute

This attribute SHALL indicate what mechanism, if any, is in use for compensation for color/intensity drift over time.

### 3.2.7.8. CompensationText Attribute

This attribute SHALL contain a textual indication of what mechanism, if any, is in use to compensate for color/intensity drift over time.

### 3.2.7.9. ColorTemperatureMireds Attribute

This attribute SHALL indicate a **scaled inverse** of the current value of the color temperature. The unit of ColorTemperatureMireds is the mired (micro reciprocal degree), a.k.a. mirek (micro reciprocal kelvin). It is updated as fast as practical during commands that change the color.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second or
- At the end of the movement/transition.

The color temperature value in kelvins SHALL be related to the ColorTemperatureMireds attribute in mired by the relationship

$$\text{"Color temperature [K]"} = \text{"1,000,000"} / \text{"ColorTemperatureMireds"}$$

where ColorTemperatureMireds is in the range from 1 to 65279 inclusive, giving a color temperature range from 1,000,000 K to 15.32 K.

If this attribute is implemented then the ColorMode attribute SHALL also be implemented.

### 3.2.7.10. ColorMode Attribute

This attribute SHALL indicate which attributes are currently determining the color of the device.

The value of the ColorMode attribute cannot be written directly - it is set upon reception of any command in section [Commands](#) to the appropriate mode for that command.

### 3.2.7.11. Options Attribute

This attribute SHALL indicate a bitmap that determines the default behavior of some cluster commands. Each command that is dependent on the Options attribute SHALL first construct a temporary Options bitmap that is in effect during the command processing. The temporary Options bitmap has the same format and meaning as the Options attribute, but includes any bits that may be overridden by command fields.

This attribute is meant to be changed only during commissioning.

Below is the format and description of the Options attribute and temporary Options bitmap and the effect on dependent commands.

Page 284







Command execution SHALL NOT continue beyond the Options processing if all of these criteria are true:

- The On/Off cluster exists on the same endpoint as this cluster.
- The OnOff attribute of the On/Off cluster, on this endpoint, is FALSE.
- The value of the ExecuteIfOff bit is 0.

#### 3.2.7.11.1. ExecuteIfOff Bit

- 0 = Do not execute command if the OnOff attribute in the On/Off cluster is FALSE.
- 1 = Execute command if the OnOff attribute in the On/Off cluster is FALSE.

#### 3.2.7.12. EnhancedCurrentHue Attribute

This attribute SHALL indicate the non-equidistant steps along the [CIE 1931 color triangle](#), and it provides 16-bits precision.

The upper 8 bits of this attribute SHALL be used as an index in the implementation specific XY lookup table to provide the non-equidistant steps. The lower 8 bits SHALL be used to interpolate between these steps in a linear way in order to provide color zoom for the user.

To provide compatibility with clients not supporting EHUE, the CurrentHue attribute SHALL contain a hue value in the range 0 to 254, calculated from the EnhancedCurrentHue attribute.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once per second or
- At the end of the movement/transition.

#### 3.2.7.13. EnhancedColorMode Attribute

This attribute SHALL indicate which attributes are currently determining the color of the device.

To provide compatibility with clients not supporting EHUE, the original ColorMode attribute SHALL indicate CurrentHue and CurrentSaturation when the light uses the EnhancedCurrentHue attribute. If the ColorMode attribute is changed, its new value SHALL be copied to the EnhancedColorMode attribute.

#### 3.2.7.14. ColorLoopActive Attribute

This attribute SHALL indicate the current active status of the color loop. If this attribute has the value 0, the color loop SHALL NOT be active. If this attribute has the value 1, the color loop SHALL be active.

#### 3.2.7.15. ColorLoopDirection Attribute

This attribute SHALL indicate the current direction of the color loop. If this attribute has the value Decrement, the EnhancedCurrentHue attribute SHALL be decremented. If this attribute has the value Increment, the EnhancedCurrentHue attribute SHALL be incremented.



Page 285



### 3.2.7.16. ColorLoopTime Attribute

This attribute SHALL indicate the number of seconds it SHALL take to perform a full color loop, i.e., to cycle all values of the EnhancedCurrentHue attribute (between 0 and 65534).

### 3.2.7.17. ColorLoopStartEnhancedHue Attribute

This attribute SHALL indicate the value of the EnhancedCurrentHue attribute from which the color loop SHALL be started.

### 3.2.7.18. ColorLoopStoredEnhancedHue Attribute

This attribute SHALL indicate the value of the EnhancedCurrentHue attribute before the color loop was started. Once the color loop is complete, the EnhancedCurrentHue attribute SHALL be restored to this value.

### 3.2.7.19. ColorCapabilities Attribute

This attribute SHALL indicate the color control capabilities of the device.

Bits 0-4 of the ColorCapabilities attribute SHALL have the same values as the corresponding bits of the FeatureMap attribute. All other bits in ColorCapabilities SHALL be 0.

### 3.2.7.20. ColorTempPhysicalMinMireds Attribute

This attribute SHALL indicate the minimum mired value supported by the hardware. ColorTempPhysicalMinMireds corresponds to the maximum color temperature in kelvins supported by the hardware.

$\text{ColorTempPhysicalMinMireds} \le \text{ColorTemperatureMireds}$ .

### 3.2.7.21. ColorTempPhysicalMaxMireds Attribute

This attribute SHALL indicate the maximum mired value supported by the hardware. ColorTempPhysicalMaxMireds corresponds to the minimum color temperature in kelvins supported by the hardware.

$\text{ColorTemperatureMireds} \le \text{ColorTempPhysicalMaxMireds}$ .

### 3.2.7.22. CoupleColorTempToLevelMinMireds Attribute

This attribute SHALL indicate a lower bound on the value of the ColorTemperatureMireds attribute for the purposes of coupling the ColorTemperatureMireds attribute to the CurrentLevel attribute when the CoupleColorTempToLevel bit of the Options attribute of the Level Control cluster is equal to 1. When coupling the ColorTemperatureMireds attribute to the CurrentLevel attribute, this value SHALL correspond to a CurrentLevel value of 254 (100%).

This attribute SHALL be set such that the following relationship exists:

$\text{ColorTempPhysicalMinMireds} \le \text{CoupleColorTempToLevelMinMireds} \le \text{ColorTemperatureMireds}$

Note that since this attribute is stored as a micro reciprocal degree (mired) value (i.e. color temperature in kelvins =  $1,000,000 / \text{CoupleColorTempToLevelMinMireds}$ ), the CoupleColorTempToLevelMinMireds attribute corresponds to an upper bound on the value of the color temperature

Page 286



in kelvins supported by the device.

### 3.2.7.23. StartUpColorTemperatureMireds Attribute

This attribute SHALL indicate the desired startup color temperature value the light SHALL use when it is supplied with power and this value SHALL be reflected in the ColorTemperatureMireds attribute. In addition, the ColorMode and EnhancedColorMode attributes SHALL be set to 2 (ColorTemperatureMireds). The values of the StartUpColorTemperatureMireds attribute are listed in the table below,

| Value      | Action on power up                                              |
|------------|-----------------------------------------------------------------|
| 1 to 65279 | Set the ColorTemperatureMireds attribute to this value.         |
| null       | Set the ColorTemperatureMireds attribute to its previous value. |

### 3.2.7.24. NumberOfPrimaries Attribute

This attribute SHALL indicate the number of color primaries implemented on this device. A value of null SHALL indicate that the number of primaries is unknown.

Where this attribute is implemented, the attributes below for indicating the “x” and “y” color values of the primaries SHALL also be implemented for each of the primaries from 1 to NumberOfPrimaries, without leaving gaps. Implementation of the Primary1Intensity attribute and subsequent intensity attributes is optional.

### 3.2.7.25. Primary1X Attribute

This attribute SHALL indicate the normalized chromaticity value x for this primary, as defined in the CIE xyY Color Space.

The value of x SHALL be related to the Primary1X attribute by the relationship

$$x = \text{Primary1X} / 65536 \text{ (Primary1X in the range 0 to 65279 inclusive)}$$

### 3.2.7.26. Primary1Y Attribute

This attribute SHALL indicate the normalized chromaticity value y for this primary, as defined in the CIE xyY Color Space.

The value of y SHALL be related to the Primary1Y attribute by the relationship

$$y = \text{Primary1Y} / 65536 \text{ (Primary1Y in the range 0 to 65279 inclusive)}$$

### 3.2.7.27. Primary1Intensity Attribute

This attribute SHALL indicate a representation of the maximum intensity of this primary as defined in [Section 3.1.3, “The Dimming Light Curve”](#), normalized such that the primary with the highest maximum intensity contains the value 254.



Page 287



A value of null SHALL indicate that this primary is not available.

### **3.2.7.28. Primary2X, Primary2Y, Primary2Intensity, Primary3X, Primary3Y, Primary3Intensity, Primary4X, Primary4Y, Primary4Intensity, Primary5X, Primary5Y, Primary5Intensity, Primary6X, Primary6Y and Primary6Intensity Attributes**

These attributes SHALL represent the capabilities of the 2<sup>nd</sup>, 3<sup>rd</sup>, 4<sup>th</sup>, 5<sup>th</sup> and 6<sup>th</sup> primaries, where present, in the same way as for the Primary1X, Primary1Y and Primary1Intensity attributes.

#### **3.2.7.29. WhitePointX Attribute**

This attribute SHALL indicate the normalized chromaticity value x, as defined in the CIE xyY Color Space, of the current white point of the device.

The value of x SHALL be related to the WhitePointX attribute by the relationship

$$x = \text{WhitePointX} / 65536 \text{ (WhitePointX in the range 0 to 65279 inclusive)}$$

#### **3.2.7.30. WhitePointY Attribute**

This attribute SHALL indicate the normalized chromaticity value y, as defined in the CIE xyY Color Space, of the current white point of the device.

The value of y SHALL be related to the WhitePointY attribute by the relationship

$$y = \text{WhitePointY} / 65536 \text{ (WhitePointY in the range 0 to 65279 inclusive)}$$

#### **3.2.7.31. ColorPointRX Attribute**

This attribute SHALL indicate the normalized chromaticity value x, as defined in the CIE xyY Color Space, of the red color point of the device.

The value of x SHALL be related to the ColorPointRX attribute by the relationship

$$x = \text{ColorPointRX} / 65536 \text{ (ColorPointRX in the range 0 to 65279 inclusive)}$$

#### **3.2.7.32. ColorPointRY Attribute**

This attribute SHALL indicate the normalized chromaticity value y, as defined in the CIE xyY Color Space, of the red color point of the device.

The value of y SHALL be related to the ColorPointRY attribute by the relationship

$$y = \text{ColorPointRY} / 65536 \text{ (ColorPointRY in the range 0 to 65279 inclusive)}$$

#### **3.2.7.33. ColorPointRIntensity Attribute**

This attribute SHALL indicate a representation of the relative intensity of the red color point as defined in [Section 3.1.3, “The Dimming Light Curve”](#), normalized such that the color point with the highest relative intensity contains the value 254.

A value of null SHALL indicate an invalid value.

Page 288







### 3.2.7.34. ColorPointGX, ColorPointGY, ColorPointGIntensity, ColorPointBX, ColorPointBY and ColorPointBIntensity Attributes

These attributes SHALL represent the chromaticity values and intensities of the green and blue color points, in the same way as for the ColorPointRX, ColorPointRY and ColorPointRIntensity attributes.

If any one of these red, green or blue color point attributes is implemented then they SHALL all be implemented.

### 3.2.8. Commands

| ID   | Name                                                    | Direction                   | Response | Access | Conformance |
|------|---------------------------------------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>MoveToHue</b>                                        | client $\Rightarrow$ server | Y        | 0      | HS          |
| 0x01 | <b>MoveHue</b>                                          | client $\Rightarrow$ server | Y        | 0      | HS          |
| 0x02 | <b>StepHue</b>                                          | client $\Rightarrow$ server | Y        | 0      | HS          |
| 0x03 | <b>MoveToSatur-<br/>ation</b>                           | client $\Rightarrow$ server | Y        | 0      | HS          |
| 0x04 | <b>MoveSatura-<br/>tion</b>                             | client $\Rightarrow$ server | Y        | 0      | HS          |
| 0x05 | <b>StepSatura-<br/>tion</b>                             | client $\Rightarrow$ server | Y        | 0      | HS          |
| 0x06 | <b>MoveToHue-<br/>AndSatura-<br/>tion</b>               | client $\Rightarrow$ server | Y        | 0      | HS          |
| 0x07 | <b>MoveToColor</b>                                      | client $\Rightarrow$ server | Y        | 0      | XY          |
| 0x08 | <b>MoveColor</b>                                        | client $\Rightarrow$ server | Y        | 0      | XY          |
| 0x09 | <b>StepColor</b>                                        | client $\Rightarrow$ server | Y        | 0      | XY          |
| 0x0A | <b>MoveToCol-<br/>orTempera-<br/>ture</b>               | client $\Rightarrow$ server | Y        | 0      | CT          |
| 0x40 | <b>Enhanced-<br/>MoveToHue</b>                          | client $\Rightarrow$ server | Y        | 0      | EHUE        |
| 0x41 | <b>Enhanced-<br/>MoveHue</b>                            | client $\Rightarrow$ server | Y        | 0      | EHUE        |
| 0x42 | <b>EnhancedSte-<br/>pHue</b>                            | client $\Rightarrow$ server | Y        | 0      | EHUE        |
| 0x43 | <b>Enhanced-<br/>MoveToHue-<br/>AndSatura-<br/>tion</b> | client $\Rightarrow$ server | Y        | 0      | EHUE        |
| 0x44 | <b>ColorLoopSet</b>                                     | client $\Rightarrow$ server | Y        | 0      | CL          |




Page 289



| ID   | Name                 | Direction                   | Response | Access | Conformance  |
|------|----------------------|-----------------------------|----------|--------|--------------|
| 0x47 | StopMoveStep         | client $\Rightarrow$ server | Y        | O      | HS   XY   CT |
| 0x4B | MoveColorTemperature | client $\Rightarrow$ server | Y        | O      | CT           |
| 0x4C | StepColorTemperature | client $\Rightarrow$ server | Y        | O      | CT           |

### 3.2.8.1. Generic Usage Notes

When asked to change color via one of these commands, the implementation SHALL select a color, within the limits of the hardware of the device, which is as close as possible to that requested. The determination as to the true representations of color is out of the scope of this specification. However, as long as the color data fields of the received command are within the permitted range of this specification and no error condition applies, the resulting status code SHALL be SUCCESS.

For example the MoveToColorTemperature command: if the target color temperature is not achievable by the hardware then the color temperature SHALL be clipped at the physical minimum or maximum achievable (depending on the direction of the color temperature transition) when the device reaches that color temperature (which MAY be before the requested transition time).

If a color loop is active (i.e., the ColorLoopActive attribute is equal to 1), it SHALL only be stopped by sending a specific ColorLoopSet command frame with a request to deactivate the color loop (i.e., the color loop SHALL NOT be stopped on receipt of another command which has a 'stop' semantic such as the EnhancedMoveToHue command with MoveMode=Stop, or the StopMoveStep command). In addition, while a color loop is active, a manufacturer MAY choose to ignore incoming color commands which affect a change in hue.

### 3.2.8.2. Note on Change of ColorMode

The first action taken when any one of these commands is received is to change the ColorMode attribute to the appropriate value for the command (see individual commands). Note that, when moving from one color mode to another (e.g., CurrentX/CurrentY to CurrentHue/CurrentSaturation), the starting color for the command is formed by calculating the values of the new attributes (in this case CurrentHue, CurrentSaturation) from those of the old attributes (in this case CurrentX and CurrentY).

When moving from a mode to another mode that has a more restricted color range (e.g., CurrentX/CurrentY to CurrentHue/CurrentSaturation, or CurrentHue/CurrentSaturation to ColorTemperatureMireds) it is possible for the current color value to have no equivalent in the new mode. The behavior in such cases is manufacturer dependent, and therefore it is recommended to avoid color mode changes of this kind during use.

### 3.2.8.3. Use of the OptionsMask and OptionsOverride Fields

The OptionsMask and OptionsOverride Fields SHALL both be present. Default values are provided to interpret missing fields from legacy devices. A temporary Options bitmap SHALL be created from

Page 290



the Options attribute, using the OptionsMask and OptionsOverride Fields. Each bit of the temporary Options bitmap SHALL be determined as follows:

Each bit in the Options attribute SHALL determine the corresponding bit in the temporary Options bitmap, unless the OptionsMask field is present and has the corresponding bit set to 1, in which case the corresponding bit in the OptionsOverride field SHALL determine the corresponding bit in the temporary Options bitmap.

The resulting temporary Options bitmap SHALL then be processed as defined in section [Options](#).

#### 3.2.8.4. MoveToHue Command

This command will move the device to the requested hue value using a transition.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | Hue             | uint8         | max 254    |         |          | M           |
| 1  | Direction       | DirectionEnum | all        |         |          | M           |
| 2  | TransitionTime  | uint16        | max 65534  |         |          | M           |
| 3  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 4  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

##### 3.2.8.4.1. Hue Field

This field SHALL indicate the hue to be moved to.

##### 3.2.8.4.2. Direction Field

This field SHALL indicate the movement direction.

##### 3.2.8.4.3. TransitionTime Field

This field SHALL indicate, in 1/10ths of a second, the time that SHALL be taken to move to the new hue.

##### 3.2.8.4.4. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

##### 3.2.8.4.5. Effect on Receipt

On receipt of this command, a device SHALL also set the ColorMode attribute to the value 0 and then SHALL move from its current hue to the value given in the Hue field.



Page 291



The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new hue SHALL be equal to the TransitionTime field.

As hue is effectively measured on a circle, the new hue MAY be moved to in either direction. The direction of hue change is given by the Direction field. If Direction is 'Shortest distance', the direction is taken that involves the shortest path round the circle. This case corresponds to expected normal usage. If Direction is 'Longest distance', the direction is taken that involves the longest path round the circle. This case can be used for 'rainbow effects'. In both cases, if both distances are the same, the Up direction SHALL be taken.

### 3.2.8.5. MoveHue Command

This command will move the device to the requested hue value using a step rate.

| ID | Name                   | Type                          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|-------------------------------|------------|---------|----------|-------------|
| 0  | <b>MoveMode</b>        | <a href="#">MoveModeEnum</a>  | all        |         |          | M           |
| 1  | <b>Rate</b>            | uint8                         | all        |         |          | M           |
| 2  | <b>OptionsMask</b>     | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |
| 3  | <b>OptionsOverride</b> | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |

#### 3.2.8.5.1. MoveMode Field

This field SHALL indicate the mode of movement.

#### 3.2.8.5.2. Rate Field

This field SHALL indicate the rate of movement in steps per second. A step is a change in the device's hue of one unit.

#### 3.2.8.5.3. OptionsMask and OptionsOverride field

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.5.4. Effect on Receipt

On receipt of this command,

- If the MoveMode field is set to 1 (Up) or 3 (Down):
  - If the Rate field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.
  - Otherwise, a device SHALL set the ColorMode attribute to the value 0 (CurrentHueAndCurrentSaturation) and SHALL then move from its current hue in an up or down direction in a continuous fashion, as detailed in the table.

Page 292







- If the MoveMode field is set to 0 (Stop), the Rate field SHALL be completely ignored.

| MoveMode | Action on Receipt                                                                                                                                                                 |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stop     | If moving, stop, else ignore the command (i.e., the command is accepted but has no effect). This SHALL stop any ongoing hue and/or saturation transition.                         |
| Up       | Increase the device's hue at the rate given in the Rate field. If the hue reaches the maximum allowed for the device, then wraparound and proceed from its minimum allowed value. |
| Down     | Decrease the device's hue at the rate given in the Rate field. If the hue reaches the minimum allowed for the device, then wraparound and proceed from its maximum allowed value. |

### 3.2.8.6. StepHue Command

This command will change the device to the requested hue value using a step and transition.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | StepMode        | StepModeEnum  | all        |         |          | M           |
| 1  | StepSize        | uint8         | all        |         |          | M           |
| 2  | TransitionTime  | uint8         | all        |         |          | M           |
| 3  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 4  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.6.1. StepMode Field

This field SHALL indicate the mode of the step to be performed.

#### 3.2.8.6.2. StepSize Field

This field SHALL indicate the change to be added to (or subtracted from) the current value of the device's hue.

#### 3.2.8.6.3. TransitionTime Field

This field SHALL indicate, in 1/10ths of a second, the time that SHALL be taken to perform the step. A step is a change in the device's hue of Step size units.




Page 293



**NOTE**

Here the TransitionTime data field is of data type uint8, where uint16 is more common for TransitionTime data fields in other clusters / commands.

#### 3.2.8.6.4. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.6.5. Effect on Receipt

On receipt of this command, if the StepSize field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.

Otherwise, a device SHALL set the ColorMode attribute to the value 0 (CurrentHueAndCurrentSaturation) and SHALL then move from its current hue in an up or down direction by one step, as detailed in the table.

| StepMode | Action on Receipt                                                                                                                                                      |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Up       | Increase the device's hue by one step, in a continuous fashion. If the hue value reaches the maximum value then wraparound and proceed from the minimum allowed value. |
| Down     | Decrease the device's hue by one step, in a continuous fashion. If the hue value reaches the minimum value then wraparound and proceed from the maximum allowed value. |

#### 3.2.8.7. MoveToSaturation Command

This command will move the device to the requested saturation value using a transition.

| ID | Name                   | Type                          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|-------------------------------|------------|---------|----------|-------------|
| 0  | <b>Saturation</b>      | uint8                         | max 254    |         |          | M           |
| 1  | <b>TransitionTime</b>  | uint16                        | max 65534  |         |          | M           |
| 2  | <b>OptionsMask</b>     | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |
| 3  | <b>OptionsOverride</b> | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |

##### 3.2.8.7.1. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

Page 294



### 3.2.8.7.2. Effect on Receipt

On receipt of this command, a device SHALL set the ColorMode attribute to the value 0 (CurrentHueAndCurrentSaturation) and SHALL then move from its current saturation to the value given in the Saturation field.

The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new saturation SHALL be equal to the TransitionTime field, in 1/10ths of a second.

### 3.2.8.8. MoveSaturation Command

This command will move the device to the requested saturation value using a rate.

| ID | Name                   | Type                          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|-------------------------------|------------|---------|----------|-------------|
| 0  | <b>MoveMode</b>        | <a href="#">MoveModeEnum</a>  | all        |         |          | M           |
| 1  | <b>Rate</b>            | uint8                         | all        |         |          | M           |
| 2  | <b>OptionsMask</b>     | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |
| 3  | <b>OptionsOverride</b> | <a href="#">OptionsBitmap</a> | desc       |         |          | M           |

#### 3.2.8.8.1. MoveMode Field

This field SHALL indicate the mode of movement, as described in the [MoveHue](#) command.

#### 3.2.8.8.2. Rate Field

This field SHALL indicate the rate of movement in steps per second. A step is a change in the device's saturation of one unit.

#### 3.2.8.8.3. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.8.4. Effect on Receipt

On receipt of this command,

- If the MoveMode field is set to 1 (Up) or 3 (Down)
  - If the Rate field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.
  - Otherwise, a device SHALL set the ColorMode attribute to the value 0 (CurrentHueAndCurrentSaturation) and SHALL then move from its current saturation in an up or down direction in a continuous fashion, as detailed in the table.
- If the MoveMode field is set to 0 (Stop), the Rate field SHALL be completely ignored.



Page 295



| MoveMode | Action on Receipt                                                                                                                                         |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stop     | If moving, stop, else ignore the command (i.e., the command is accepted but has no effect). This SHALL stop any ongoing hue and/or saturation transition. |
| Up       | Increase the device's saturation at the rate given in the Rate field. If the saturation reaches the maximum allowed for the device, stop.                 |
| Down     | Decrease the device's saturation at the rate given in the Rate field. If the saturation reaches the minimum allowed for the device, stop.                 |

### 3.2.8.9. StepSaturation Command

This command will change the device to the requested saturation value using a step transition.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | StepMode        | StepModeEnum  | all        |         |          | M           |
| 1  | StepSize        | uint8         | all        |         |          | M           |
| 2  | TransitionTime  | uint8         | all        |         |          | M           |
| 3  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 4  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.9.1. StepMode Field

This field SHALL indicate the mode of the step to be performed, as described in the [StepHue](#) command.

#### 3.2.8.9.2. StepSize Field

This field SHALL indicate the change to be added to (or subtracted from) the current value of the device's saturation.

#### 3.2.8.9.3. TransitionTime Field

This field SHALL indicate, in 1/10ths of a second, the time that SHALL be taken to perform the step. A step is a change in the device's saturation of Step size units.

#### NOTE

Here the TransitionTime data field is of data type uint8, where uint16 is more common for TransitionTime data fields in other clusters / commands.

Page 296







#### 3.2.8.9.4. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.9.5. Effect on Receipt

On receipt of this command, if the StepSize field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.

Otherwise, a device SHALL set the ColorMode attribute to the value 0 (CurrentHueAndCurrentSaturation) and SHALL then move from its current saturation in an up or down direction by one step.

| StepMode | Action on Receipt                                                                                                                                     |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| Up       | Increase the device's saturation by one step, in a continuous fashion. However, if the saturation value is already the maximum value then do nothing. |
| Down     | Decrease the device's saturation by one step, in a continuous fashion. However, if the saturation value is already the minimum value then do nothing. |

#### 3.2.8.10. MoveToHueAndSaturation Command

This command will move the device to the requested hue and saturation value using a transition.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | Hue             | uint8         | max 254    |         |          | M           |
| 1  | Saturation      | uint8         | max 254    |         |          | M           |
| 2  | TransitionTime  | uint16        | max 65534  |         |          | M           |
| 3  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 4  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

##### 3.2.8.10.1. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

##### 3.2.8.10.2. Effect on Receipt

On receipt of this command, a device SHALL set the ColorMode attribute to the value 0 (CurrentHueAndCurrentSaturation) and SHALL then move from its current hue and saturation to the val-



Page 297



ues given in the Hue and Saturation fields.

The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new color SHALL be equal to the TransitionTime field, in 1/10ths of a second.

The path through color space taken during the transition is not specified, but it is recommended that the shortest path is taken through color space, i.e., movement is 'in a straight line' across the CIE xyY Color Space.

### 3.2.8.11. MoveToColor Command

This command will move the device to the requested color value using a transition.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | ColorX          | uint16        | max 65279  |         |          | M           |
| 1  | ColorY          | uint16        | max 65279  |         |          | M           |
| 2  | TransitionTime  | uint16        | max 65534  |         |          | M           |
| 3  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 4  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.11.1. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.11.2. Effect on Receipt

On receipt of this command, a device SHALL set the value of the ColorMode attribute, where implemented, to 1 (CurrentXAndCurrentY), and SHALL then move from its current color to the color given in the ColorX and ColorY fields.

The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new color SHALL be equal to the TransitionTime field, in 1/10ths of a second.

The path through color space taken during the transition is not specified, but it is recommended that the shortest path is taken through color space, i.e., movement is 'in a straight line' across the CIE xyY Color Space.

### 3.2.8.12. MoveColor Command

This command will move the device to the requested color using a step rate.

Page 298







| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | RateX           | int16         | all        |         |          | M           |
| 1  | RateY           | int16         | all        |         |          | M           |
| 2  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 3  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.12.1. RateX Field

This field SHALL indicate the rate of movement in steps per second. A step is a change in the device's CurrentX attribute of one unit.

#### 3.2.8.12.2. RateY Field

This field SHALL indicate the rate of movement in steps per second. A step is a change in the device's CurrentY attribute of one unit.

#### 3.2.8.12.3. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.12.4. Effect on Receipt

On receipt of this command, if both the RateX and RateY fields contain a value of zero, no movement SHALL be carried out, and the command execution SHALL have no effect other than stopping the operation of any previously received command of this cluster. While this command (when used with both the RateX and RateY fields set to zero) can be used to stop any operation of this cluster, it is recommended to instead use the [StopMoveStep](#) command to achieve this goal.

Otherwise, a device SHALL set the value of the ColorMode attribute, where implemented, to 1 (CurrentXAndCurrentY), and SHALL then move from its current color in a continuous fashion according to the rates specified. This movement SHALL continue until the target color for the next step cannot be implemented on this device.

### 3.2.8.13. StepColor Command

This command will move the device to the requested color using a step transition.

| ID | Name           | Type   | Constraint | Quality | Fallback | Conformance |
|----|----------------|--------|------------|---------|----------|-------------|
| 0  | StepX          | int16  | all        |         |          | M           |
| 1  | StepY          | int16  | all        |         |          | M           |
| 2  | TransitionTime | uint16 | max 65534  |         |          | M           |




Page 299



| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 3  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 4  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.13.1. StepX and StepY Fields

These fields SHALL indicate the change to be added to the device's CurrentX attribute and CurrentY attribute respectively.

#### 3.2.8.13.2. TransitionTime Field

The field SHALL indicate, in 1/10ths of a second, the time that SHALL be taken to perform the color change.

#### 3.2.8.13.3. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.13.4. Effect on Receipt

On receipt of this command, if both the StepX and StepY fields contain a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.

Otherwise, a device SHALL set the value of the ColorMode attribute, where implemented, to 1 (CurrentXAndCurrentY), and SHALL then move from its current color by the color step indicated.

The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new color SHALL be equal to the TransitionTime field, in 1/10ths of a second.

The path through color space taken during the transition is not specified, but it is recommended that the shortest path is taken through color space, i.e., movement is 'in a straight line' across the CIE xyY Color Space.

Note also that if the required step is larger than can be represented by signed 16-bit integers then more than one step command SHOULD be issued.

### 3.2.8.14. MoveToColorTemperature Command

This command will move the device to the requested color temperature using a transition.

Page 300







| ID | Name                   | Type          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|---------------|------------|---------|----------|-------------|
| 0  | ColorTemperatureMireds | uint16        | max 65279  |         |          | M           |
| 1  | TransitionTime         | uint16        | max 65534  |         |          | M           |
| 2  | OptionsMask            | OptionsBitmap | desc       |         |          | M           |
| 3  | OptionsOverride        | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.14.1. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.14.2. Effect on Receipt

On receipt of this command, a device SHALL set the value of the ColorMode attribute, where implemented, to 2 (ColorTemperatureMireds), and SHALL then move from its current color to the color given by the ColorTemperatureMired field.

The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new color SHALL be equal to the TransitionTime field, in 1/10ths of a second.

By definition of this color mode, the path through color space taken during the transition is along the 'Black Body Line'.

If the ColorTemperatureMireds field is less than the value of the ColorTempPhysicalMinMireds attribute, the value of the ColorTempPhysicalMinMireds attribute SHALL be used as the final target for the ColorTemperatureMireds attribute.

If the ColorTemperatureMireds field is greater than the value of the ColorTempPhysicalMaxMireds attribute, the value of the ColorTempPhysicalMaxMireds attribute SHALL be used as the final target for the ColorTemperatureMireds attribute.

#### 3.2.8.15. EnhancedMoveToHue Command

This command allows the light to be moved in a smooth continuous transition from their current hue to a target hue.

| ID | Name        | Type   | Constraint | Quality | Fallback | Conformance |
|----|-------------|--------|------------|---------|----------|-------------|
| 0  | EnhancedHue | uint16 | all        |         |          | M           |




Page 301



| ID | Name                   | Type          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|---------------|------------|---------|----------|-------------|
| 1  | <b>Direction</b>       | DirectionEnum | all        |         |          | M           |
| 2  | <b>TransitionTime</b>  | uint16        | max 65534  |         |          | M           |
| 3  | <b>OptionsMask</b>     | OptionsBitmap | desc       |         |          | M           |
| 4  | <b>OptionsOverride</b> | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.15.1. EnhancedHue Field

This field SHALL indicate the target extended hue for the light.

#### 3.2.8.15.2. Direction Field

This field SHALL indicate the movement direction.

#### 3.2.8.15.3. TransitionTime Field

This field SHALL indicate the transition time, as described in the [MoveToHue](#) command.

#### 3.2.8.15.4. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.15.5. Effect on Receipt

On receipt of this command, a device SHALL set the ColorMode attribute to 0 (CurrentHueAndCurrentSaturation) and set the EnhancedColorMode attribute to the value 3 (EnhancedCurrentHueAndCurrentSaturation). The device SHALL then move from its current enhanced hue to the value given in the EnhancedHue field.

The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new enhanced hue SHALL be equal to the TransitionTime field.

### 3.2.8.16. EnhancedMoveHue Command

This command allows the light to start a continuous transition starting from their current hue.

| ID | Name            | Type         | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------------|------------|---------|----------|-------------|
| 0  | <b>MoveMode</b> | MoveModeEnum | desc       |         |          | M           |
| 1  | <b>Rate</b>     | uint16       | all        |         |          | M           |

Page 302







| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 2  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 3  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.16.1. MoveMode Field

This field SHALL indicate the mode of movement, as described in the [MoveHue](#) command.

#### 3.2.8.16.2. Rate field

This field SHALL indicate the rate of movement in steps per second. A step is a change in the extended hue of a device by one unit.

#### 3.2.8.16.3. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.16.4. Effect on receipt

On receipt of this command,

- If the MoveMode field is set to 1 (Up) or 3 (Down)
  - If the Rate field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.
  - Otherwise, a device SHALL set the ColorMode attribute to 0 (CurrentHueAndCurrentSaturation) and set the EnhancedColorMode attribute to the value 3 (EnhancedCurrentHueAndCurrentSaturation). The device SHALL then move from its current enhanced hue in an up or down direction in a continuous fashion, as detailed in the table.
- If the MoveMode field is set to 0 (Stop), the Rate field SHALL be completely ignored.

| MoveMode | Action on Receipt                                                                                                                                                                              |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stop     | If moving, stop, else ignore the command (i.e., the command is accepted but has no effect). This SHALL stop any ongoing hue and/or saturation transition.                                      |
| Up       | Increase the device's enhanced hue at the rate given in the Rate field. If the enhanced hue reaches the maximum allowed for the device, wraparound and proceed from its minimum allowed value. |




Page 303



| MoveMode | Action on Receipt                                                                                                                                                                     |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Down     | Decrease the device's enhanced hue at the rate given in the Rate field. If the hue reaches the minimum allowed for the device, wraparound and proceed from its maximum allowed value. |

### 3.2.8.17. EnhancedStepHue Command

This command allows the light to be moved in a stepped transition from their current hue, resulting in a linear transition through XY space.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | StepMode        | StepModeEnum  | desc       |         |          | M           |
| 1  | StepSize        | uint16        | all        |         |          | M           |
| 2  | TransitionTime  | uint16        | max 65534  |         |          | M           |
| 3  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 4  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.17.1. StepMode Field

This field SHALL indicate the mode of the step to be performed, as described in the [StepHue](#) command.

#### 3.2.8.17.2. StepSize Field

This field SHALL indicate the change to be added to (or subtracted from) the current value of the device's enhanced hue.

#### 3.2.8.17.3. TransitionTime Field

The field SHALL indicate, in units of 1/10ths of a second, the time that SHALL be taken to perform the step. A step is a change to the device's enhanced hue of a magnitude corresponding to the StepSize field.

#### NOTE

Here TransitionTime data field is of data type uint16, while the TransitionTime data field of the StepHue command is of data type uint8.

#### 3.2.8.17.4. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

Page 304







### 3.2.8.17.5. Effect on Receipt

On receipt of this command, if the StepSize field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.

Otherwise, a device SHALL set the ColorMode attribute to 0 (CurrentHueAndCurrentSaturation) and the EnhancedColorMode attribute to the value 3 (EnhancedCurrentHueAndCurrentSaturation). The device SHALL then move from its current enhanced hue in an up or down direction by one step, as detailed in the table.

| StepMode | Action on Receipt                                                                                                                                                      |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Up       | Increase the device's enhanced hue by one step. If the enhanced hue reaches the maximum allowed for the device, wraparound and proceed from its minimum allowed value. |
| Down     | Decrease the device's enhanced hue by one step. If the hue reaches the minimum allowed for the device, wraparound and proceed from its maximum allowed value.          |

### 3.2.8.18. EnhancedMoveToHueAndSaturation Command

This command allows the light to be moved in a smooth continuous transition from their current hue to a target hue and from their current saturation to a target saturation.

| ID | Name                   | Type                           | Constraint | Quality | Fallback | Conformance |
|----|------------------------|--------------------------------|------------|---------|----------|-------------|
| 0  | <b>Enhanced-Hue</b>    | uint16                         | all        |         |          | M           |
| 1  | <b>Saturation</b>      | uint8                          | max 254    |         |          | M           |
| 2  | <b>Transition-Time</b> | uint16                         | max 65534  |         |          | M           |
| 3  | <b>Options-Mask</b>    | <a href="#">Options-Bitmap</a> | desc       |         |          | M           |
| 4  | <b>OptionsOverride</b> | <a href="#">Options-Bitmap</a> | desc       |         |          | M           |

#### 3.2.8.18.1. EnhancedHue Field

This field SHALL indicate the target extended hue for the light.

#### 3.2.8.18.2. Saturation Field

This field SHALL indicate the saturation, as described in the [MoveToHueAndSaturation](#) command.




Page 305



### 3.2.8.18.3. TransitionTime Field

This field SHALL indicate the transition time, as described in the [MoveToHue](#) command.

### 3.2.8.18.4. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

### 3.2.8.18.5. Effect on Receipt

On receipt of this command, a device SHALL set the ColorMode attribute to the value 0 (CurrentHueAndCurrentSaturation) and set the EnhancedColorMode attribute to the value 3 (Enhanced-CurrentHueAndCurrentSaturation). The device SHALL then move from its current enhanced hue and saturation to the values given in the EnhancedHue and Saturation fields.

The movement SHALL be continuous, i.e., not a step function, and the time taken to move to the new color SHALL be equal to the TransitionTime field, in 1/10ths of a second.

The path through color space taken during the transition is not specified, but it is recommended that the shortest path is taken through color space, i.e., movement is 'in a straight line' across the CIE xyY Color Space.

## 3.2.8.19. ColorLoopSet Command

This command allows a color loop to be activated such that the color light cycles through its range of hues.

| ID | Name                   | Type                                   | Constraint | Quality | Fallback | Conformance |
|----|------------------------|----------------------------------------|------------|---------|----------|-------------|
| 0  | <b>UpdateFlags</b>     | <a href="#">UpdateFlagsBitmap</a>      | all        |         |          | M           |
| 1  | <b>Action</b>          | <a href="#">Color-LoopActionEnum</a>   | all        |         |          | M           |
| 2  | <b>Direction</b>       | <a href="#">ColorLoopDirectionEnum</a> | all        |         |          | M           |
| 3  | <b>Time</b>            | uint16                                 | all        |         |          | M           |
| 4  | <b>StartHue</b>        | uint16                                 | all        |         |          | M           |
| 5  | <b>OptionsMask</b>     | <a href="#">OptionsBitmap</a>          | desc       |         |          | M           |
| 6  | <b>OptionsOverride</b> | <a href="#">OptionsBitmap</a>          | desc       |         |          | M           |

### 3.2.8.19.1. UpdateFlags Field

This field SHALL indicate which color loop attributes to update (from the values supplied in the other fields, see field descriptions below) before the color loop is started.

Page 306



### 3.2.8.19.2. Action Field

This field SHALL indicate the action to take for the color loop.

### 3.2.8.19.3. Direction Field

This field SHALL indicate the direction for the color loop.

### 3.2.8.19.4. Time Field

This field SHALL indicate the number of seconds over which to perform a full color loop.

### 3.2.8.19.5. Start Hue Field

This field SHALL indicate the starting hue to use for the color loop.

### 3.2.8.19.6. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

### 3.2.8.19.7. Effect on Receipt

On receipt of this command, the device SHALL first update its color loop attributes according to the value of the UpdateFlags field, as follows.

- If the UpdateDirection sub-field is set to 1, the device SHALL set the ColorLoopDirection attribute to the value of the Direction field.
- If the UpdateTime sub-field is set to 1, the device SHALL set the ColorLoopTime attribute to the value of the Time field.
- If the UpdateStartHue sub-field is set to 1, the device SHALL set the ColorLoopStartEnhancedHue attribute to the value of the StartHue field.
- If the UpdateAction sub-field of the UpdateFlags field is set to 1, the device SHALL adhere to the action specified in the Action field, as follows.
  - If the value of the Action field is set to 0 and the color loop is active, i.e. the ColorLoopActive attribute is set to 1, the device SHALL de-active the color loop, set the ColorLoopActive attribute to 0 and set the EnhancedCurrentHue attribute to the value of the ColorLoopStoredEnhancedHue attribute.
  - If the value of the Action field is set to 0 and the color loop is inactive, i.e. the ColorLoopActive attribute is set to 0, the device SHALL ignore the action update component of the command, i.e. the EnhancedCurrentHue attribute SHALL NOT be updated (contrasting with the case described in the previous bullet).
  - If the value of the Action field is set to 1, the device SHALL set the ColorLoopStoredEnhancedHue attribute to the value of the EnhancedCurrentHue attribute, set the ColorLoopActive attribute to 1 and activate the color loop, starting from the value of the ColorLoopStartEnhancedHue attribute.
  - If the value of the Action field is set to 2, the device SHALL set the ColorLoopStoredEnhancedHue attribute to the value of the EnhancedCurrentHue attribute, set the Color-



Page 307



LoopActive attribute to 1 and activate the color loop, starting from the value of the EnhancedCurrentHue attribute.

If the color loop is active, the device SHALL cycle over the complete range of values of the EnhancedCurrentHue attribute in the direction of the ColorLoopDirection attribute over the time specified in the ColorLoopTime attribute. The level of increments/decrements is application specific.

If the color loop is active (and stays active), the device SHALL immediately react on updates of the ColorLoopDirection and ColorLoopTime attributes.

### 3.2.8.20. StopMoveStep Command

This command is provided to allow MoveTo and Step commands to be stopped.

**NOTE** This automatically provides symmetry to the Level Control cluster.

**NOTE** The StopMoveStep command has no effect on an active color loop.

| ID | Name            | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------|------------|---------|----------|-------------|
| 0  | OptionsMask     | OptionsBitmap | desc       |         |          | M           |
| 1  | OptionsOverride | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.20.1. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.20.2. Effect on Receipt

Upon receipt of this command, any MoveTo, Move or Step command currently in process SHALL be terminated. The values of the CurrentHue, EnhancedCurrentHue and CurrentSaturation attributes SHALL be left at their present value upon receipt of the StopMoveStep command, and the RemainingTime attribute SHALL be set to zero.

### 3.2.8.21. MoveColorTemperature Command

This command allows the color temperature of the light to be moved at a specified rate.

| ID | Name     | Type         | Constraint | Quality | Fallback | Conformance |
|----|----------|--------------|------------|---------|----------|-------------|
| 0  | MoveMode | MoveModeEnum | all        |         |          | M           |
| 1  | Rate     | uint16       | all        |         |          | M           |

Page 308



| ID | Name                          | Type          | Constraint | Quality | Fallback | Conformance |
|----|-------------------------------|---------------|------------|---------|----------|-------------|
| 2  | ColorTemperatureMinimumMireds | uint16        | max 65279  |         |          | M           |
| 3  | ColorTemperatureMaximumMireds | uint16        | max 65279  |         |          | M           |
| 4  | OptionsMask                   | OptionsBitmap | desc       |         |          | M           |
| 5  | OptionsOverride               | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.21.1. MoveMode Field

This field SHALL indicate the mode of movement, as described in the [MoveHue](#) command.

#### 3.2.8.21.2. Rate Field

This field SHALL indicate the rate of movement in steps per second. A step is a change in the color temperature of a device by one unit.

#### 3.2.8.21.3. ColorTemperatureMinimumMireds Field

This field SHALL indicate a lower bound on the ColorTemperatureMireds attribute (≡ an upper bound on the color temperature in kelvins) for the current move operation such that:

ColorTempPhysicalMinMireds  $\le$  ColorTemperatureMinimumMireds field  $\le$  ColorTemperatureMireds

As such if the move operation takes the ColorTemperatureMireds attribute towards the value of the ColorTemperatureMinimumMireds field it SHALL be clipped so that the above invariant is satisfied. If the ColorTemperatureMinimumMireds field is set to 0, ColorTempPhysicalMinMireds SHALL be used as the lower bound for the ColorTemperatureMireds attribute.

#### 3.2.8.21.4. ColorTemperatureMaximumMireds Field

This field SHALL indicate an upper bound on the ColorTemperatureMireds attribute (≡ a lower bound on the color temperature in kelvins) for the current move operation such that:

ColorTemperatureMireds  $\le$  ColorTemperatureMaximumMireds field  $\le$  ColorTempPhysicalMaxMireds

As such if the move operation takes the ColorTemperatureMireds attribute towards the value of the ColorTemperatureMaximumMireds field it SHALL be clipped so that the above invariant is satisfied. If the ColorTemperatureMaximumMireds field is set to 0, ColorTempPhysicalMaxMireds SHALL be used as the upper bound for the ColorTemperatureMireds attribute.




Page 309



### 3.2.8.21.5. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

#### 3.2.8.21.6. Effect on Receipt

On receipt of this command,

- If the MoveMode field is set to 1 (Up) or 3 (Down)
  - If the Rate field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.
  - Otherwise, a device SHALL set both the ColorMode and EnhancedColorMode attributes to 2 (ColorTemperatureMireds) The device SHALL then move from its current color temperature in an up or down direction in a continuous fashion, as detailed in the table.
- If the MoveMode field is set to 0 (Stop), the Rate field SHALL be completely ignored.

| MoveMode | Action on Receipt                                                                                                                                                                                                                                                                                                                                          |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stop     | If moving, stop the operation, else ignore the command (i.e., the command is accepted but has no effect).                                                                                                                                                                                                                                                  |
| Up       | Increase the ColorTemperatureMireds attribute (≈ decrease the color temperature in kelvins) at the rate given in the Rate field. If the ColorTemperatureMireds attribute reaches the maximum allowed for the device (via either the ColorTemperatureMaximumMireds field or the ColorTempPhysicalMaxMireds attribute), the move operation SHALL be stopped. |
| Down     | Decrease the ColorTemperatureMireds attribute (≈ increase the color temperature in kelvins) at the rate given in the Rate field. If the ColorTemperatureMireds attribute reaches the minimum allowed for the device (via either the ColorTemperatureMinimumMireds field or the ColorTempPhysicalMinMireds attribute), the move operation SHALL be stopped. |

### 3.2.8.22. StepColorTemperature Command

This command allows the color temperature of the light to be stepped with a specified step size.

| ID | Name     | Type         | Constraint | Quality | Fallback | Conformance |
|----|----------|--------------|------------|---------|----------|-------------|
| 0  | StepMode | StepModeEnum | all        |         |          | M           |

Page 310



| ID | Name                          | Type          | Constraint | Quality | Fallback | Conformance |
|----|-------------------------------|---------------|------------|---------|----------|-------------|
| 1  | StepSize                      | uint16        | all        |         |          | M           |
| 2  | TransitionTime                | uint16        | max 65534  |         |          | M           |
| 3  | ColorTemperatureMinimumMireds | uint16        | max 65279  |         |          | M           |
| 4  | ColorTemperatureMaximumMireds | uint16        | max 65279  |         |          | M           |
| 5  | OptionsMask                   | OptionsBitmap | desc       |         |          | M           |
| 6  | OptionsOverride               | OptionsBitmap | desc       |         |          | M           |

#### 3.2.8.22.1. StepMode Field

This field SHALL indicate the mode of the step to be performed, as described in the [StepHue](#) command.

#### 3.2.8.22.2. StepSize Field

This field SHALL indicate the change to be added to (or subtracted from) the current value of the device's color temperature.

#### 3.2.8.22.3. TransitionTime Field

This field SHALL indicate, in units of 1/10ths of a second, the time that SHALL be taken to perform the step. A step is a change to the device's color temperature of a magnitude corresponding to the StepSize field.

#### 3.2.8.22.4. ColorTemperatureMinimumMireds Field

This field SHALL indicate a lower bound on the ColorTemperatureMireds attribute (≡ an upper bound on the color temperature in kelvins) for the current step operation such that:

$\text{ColorTempPhysicalMinMireds} \le \text{ColorTemperatureMinimumMireds} \text{ field} \le \text{ColorTemperatureMireds}$

As such if the step operation takes the ColorTemperatureMireds attribute towards the value of the ColorTemperatureMinimumMireds field it SHALL be clipped so that the above invariant is satisfied. If the ColorTemperatureMinimumMireds field is set to 0, ColorTempPhysicalMinMireds SHALL be used as the lower bound for the ColorTemperatureMireds attribute.




Page 311



### 3.2.8.22.5. ColorTemperatureMaximumMireds Field

This field SHALL indicate an upper bound on the ColorTemperatureMireds attribute (≈ a lower bound on the color temperature in kelvins) for the current step operation such that:

$$\text{ColorTemperatureMireds} \le \text{ColorTemperatureMaximumMireds} \quad \text{field} \le \text{ColorTempPhysicalMaxMireds}$$

As such if the step operation takes the ColorTemperatureMireds attribute towards the value of the ColorTemperatureMaximumMireds field it SHALL be clipped so that the above invariant is satisfied. If the ColorTemperatureMaximumMireds field is set to 0, ColorTempPhysicalMaxMireds SHALL be used as the upper bound for the ColorTemperatureMireds attribute.

### 3.2.8.22.6. OptionsMask and OptionsOverride Fields

These fields SHALL be processed according to section [Use of the OptionsMask and OptionsOverride Fields](#).

### 3.2.8.22.7. Effect on Receipt

On receipt of this command, if the StepSize field has a value of zero, the command has no effect and a response SHALL be returned with the status code set to INVALID\_COMMAND.

Otherwise, a device SHALL set both the ColorMode and EnhancedColorMode attributes to 2 (ColorTemperatureMireds). The device SHALL then move from its current color temperature in an up or down direction by one step, as detailed in the table.

| StepMode | Action on Receipt                                                                                                                                                                                                                                                                                                                  |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Up       | Increase the ColorTemperatureMireds attribute (≈ decrease the color temperature in kelvins) by one step. If the ColorTemperatureMireds attribute reaches the maximum allowed for the device (via either the ColorTemperatureMaximumMireds field or the ColorTempPhysicalMaxMireds attribute), the step operation SHALL be stopped. |
| Down     | Decrease the ColorTemperatureMireds attribute (≈ increase the color temperature in kelvins) by one step. If the ColorTemperatureMireds attribute reaches the minimum allowed for the device (via either the ColorTemperatureMinimumMireds field or the ColorTempPhysicalMinMireds attribute), the step operation SHALL be stopped. |

Page 312



## Chapter 4. HVAC

The Cluster Library is made of individual chapters such as this one. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter.

### 4.1. General Description

#### 4.1.1. Introduction

The clusters specified in this document are for use typically in HVAC applications, but MAY be used in any application domain.

#### 4.1.2. Terms

**Precooling:** Cooling a building in the early (cooler) part of the day, so that the thermal mass of the building decreases cooling needs in the later (hotter) part of the day.

#### 4.1.3. Cluster List

This section lists the HVAC specific clusters as specified in this chapter.

*Table 8. Overview of the HVAC Clusters*

| Cluster ID | Cluster Name                                            | Description                                                                                               |
|------------|---------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| 0x0200     | <a href="#">Pump Configuration and Control</a>          | An interface for configuring and controlling pumps.                                                       |
| 0x0201     | <a href="#">Thermostat</a>                              | An interface for configuring and controlling the functionality of a thermostat                            |
| 0x0202     | <a href="#">Fan Control</a>                             | An interface for controlling a fan                                                                        |
| 0x0204     | <a href="#">Thermostat User Interface Configuration</a> | An interface for configuring the user interface of a thermostat (which MAY be remote from the thermostat) |
| 0x0081     | <a href="#">Valve Configuration and Control</a>         | An interface for configuring and controlling the functionality of a valve                                 |

## 4.2. Pump Configuration and Control Cluster

The Pump Configuration and Control cluster provides an interface for the setup and control of pump devices, and the automatic reporting of pump status information. Note that control of pump speed is not included – speed is controlled by the On/Off and Level Control clusters.



Page 313



![Diagram illustrating the typical usage of the Pump Configuration and Control Cluster. A Pump controller (Client) interacts with a Pump (Server) through three clusters: Pump configuration and control, Level control, and On/Off. A legend below defines C as Client and S as Server.](ac7340407ee3301097694475a14340f4_img.jpg)

The diagram shows two main components: a 'Pump controller' on the left and a 'Pump' on the right. The Pump controller contains three 'C' (Client) boxes, and the Pump contains three 'S' (Server) boxes. Lines connect the 'Pump configuration and control' cluster (C to S), the 'Level control' cluster (C to S), and the 'On/Off' cluster (C to S). Below the diagram is a legend: a box containing 'C' is labeled '= Client' and a box containing 'S' is labeled '= Server'.

Diagram illustrating the typical usage of the Pump Configuration and Control Cluster. A Pump controller (Client) interacts with a Pump (Server) through three clusters: Pump configuration and control, Level control, and On/Off. A legend below defines C as Client and S as Server.

*Note: Device names are examples for illustration purposes only*

Figure 14. Typical Usage of Pump Configuration and Control Cluster

#### 4.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                 |
|----------|-------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added            |
| 2        | All Hubs changes                                            |
| 3        | New data model format and notation, added additional events |
| 4        | Added feature map                                           |

#### 4.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | PCC       |

#### 4.2.3. Cluster ID

| ID     | Name                           |
|--------|--------------------------------|
| 0x0200 | Pump Configuration and Control |

#### 4.2.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

Page 314



| Bit | Code     | Feature             | Conformance | Summary                                         |
|-----|----------|---------------------|-------------|-------------------------------------------------|
| 0   | PRSCONST | ConstantPressure    | O.a+        | Supports operating in constant pressure mode    |
| 1   | PRSCOMP  | CompensatedPressure | O.a+        | Supports operating in compensated pressure mode |
| 2   | FLW      | ConstantFlow        | O.a+        | Supports operating in constant flow mode        |
| 3   | SPD      | ConstantSpeed       | O.a+        | Supports operating in constant speed mode       |
| 4   | TEMP     | ConstantTemperature | O.a+        | Supports operating in constant temperature mode |
| 5   | AUTO     | Automatic           | O           | Supports operating in automatic mode            |
| 6   | LOCAL    | LocalOperation      | O           | Supports operating using local settings         |

#### 4.2.5. Dependencies

Where external pressure, flow, and temperature measurements are processed by this cluster (see [ControlMode Attribute](#)), these are provided by a Pressure Measurement cluster, a Flow Measurement cluster, and a Temperature Measurement client cluster, respectively. These 3 client clusters are used for connection to a remote sensor device. The pump is able to use the sensor measurement provided by a remote sensor for regulation of the pump speed.

Note that control of the pump setpoint is not included in this cluster – the On/Off and Level Control clusters (see [Typical Usage of Pump Configuration and Control Cluster](#)) MAY be used by a pump device to turn it on and off and control its setpoint. Note that the Pump Configuration and Control cluster MAY override on/off/setpoint settings for specific operation modes (see [OperationMode Attribute](#) for detailed description of the operation and control of the pump.).

#### 4.2.6. Data Types

##### 4.2.6.1. PumpStatusBitmap Type

This data type is derived from map16.




Page 315



| Bit | Name                     | Summary                                                                                       | Conformance |
|-----|--------------------------|-----------------------------------------------------------------------------------------------|-------------|
| 0   | <b>DeviceFault</b>       | A fault related to the system or pump device is detected.                                     | M           |
| 1   | <b>SupplyFault</b>       | A fault related to the supply to the pump is detected.                                        | M           |
| 2   | <b>SpeedLow</b>          | Setpoint is too low to achieve.                                                               | M           |
| 3   | <b>SpeedHigh</b>         | Setpoint is too high to achieve.                                                              | M           |
| 4   | <b>LocalOverride</b>     | Device control is overridden by hardware, such as an external STOP button or via a local HMI. | M           |
| 5   | <b>Running</b>           | Pump is currently running                                                                     | M           |
| 6   | <b>RemotePressure</b>    | A remote pressure sensor is used as the sensor for the regulation of the pump.                | M           |
| 7   | <b>RemoteFlow</b>        | A remote flow sensor is used as the sensor for the regulation of the pump.                    | M           |
| 8   | <b>RemoteTemperature</b> | A remote temperature sensor is used as the sensor for the regulation of the pump.             | M           |

#### 4.2.6.1.1. DeviceFault Bit

If this bit is set, it MAY correspond to an event in the range 2-16, see [Events](#).

#### 4.2.6.1.2. SupplyFault Bit

If this bit is set, it MAY correspond to an event in the range 0-1 or 13, see [Events](#).

#### 4.2.6.1.3. LocalOverride Bit

While this bit is set, the EffectiveOperationMode is adjusted to Local. Any request changing OperationMode SHALL generate a FAILURE error status until LocalOverride is cleared on the physical device. When LocalOverride is cleared, the device SHALL return to the operation mode set in OperationMode.

Page 316



#### 4.2.6.1.4. RemotePressure Bit

If this bit is set, EffectiveControlMode is ConstantPressure and the setpoint for the pump is interpreted as a percentage of the range of the remote sensor ([MinMeasuredValue – MaxMeasuredValue]).

#### 4.2.6.1.5. RemoteFlow Bit

If this bit is set, EffectiveControlMode is ConstantFlow, and the setpoint for the pump is interpreted as a percentage of the range of the remote sensor ([MinMeasuredValue – MaxMeasuredValue]).

#### 4.2.6.1.6. RemoteTemperature Bit

If this bit is set, EffectiveControlMode is ConstantTemperature, and the setpoint for the pump is interpreted as a percentage of the range of the remote sensor ([MinMeasuredValue – MaxMeasuredValue]).

### 4.2.6.2. OperationModeEnum Type

This data type is derived from enum8.

| Value | Name           | Summary                                                                                                        | Conformance |
|-------|----------------|----------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>Normal</b>  | The pump is controlled by a setpoint, as defined by a connected remote sensor or by the ControlMode attribute. | M           |
| 1     | <b>Minimum</b> | This value sets the pump to run at the minimum possible speed it can without being stopped.                    | SPD         |
| 2     | <b>Maximum</b> | This value sets the pump to run at its maximum possible speed.                                                 | SPD         |
| 3     | <b>Local</b>   | This value sets the pump to run with the local settings of the pump, regardless of what these are.             | LOCAL       |

#### 4.2.6.2.1. Normal Value

If the pump is running in this operation mode the setpoint is an internal variable which MAY be controlled between 0% and 100%, e.g., by means of the Level Control cluster




Page 317



#### 4.2.6.3. ControlModeEnum Type

This data type is derived from `enum8`.

| Value | Name                        | Summary                                                                                                                                   | Conformance |
|-------|-----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>ConstantSpeed</b>        | The pump is running at a constant speed.                                                                                                  | SPD         |
| 1     | <b>ConstantPressure</b>     | The pump will regulate its speed to maintain a constant differential pressure over its flanges.                                           | PRSCONST    |
| 2     | <b>ProportionalPressure</b> | The pump will regulate its speed to maintain a constant differential pressure over its flanges.                                           | PRSCOMP     |
| 3     | <b>ConstantFlow</b>         | The pump will regulate its speed to maintain a constant flow through the pump.                                                            | FLW         |
| 5     | <b>ConstantTemperature</b>  | The pump will regulate its speed to maintain a constant temperature.                                                                      | TEMP        |
| 7     | <b>Automatic</b>            | The operation of the pump is automatically optimized to provide the most suitable performance with respect to comfort and energy savings. | AUTO        |

##### 4.2.6.3.1. ConstantSpeed Value

The setpoint is interpreted as a percentage of the range derived from the `[MinConstSpeed – MaxConstSpeed]` attributes.

##### 4.2.6.3.2. ConstantPressure Value

The setpoint is interpreted as a percentage of the range of the sensor used for this control mode. In case of the internal pressure sensor, this will be the range derived from the `[MinConstPressure – MaxConstPressure]` attributes. In case of a remote pressure sensor, this will be the range derived from the `[MinMeasuredValue – MaxMeasuredValue]` attributes of the remote pressure sensor.

##### 4.2.6.3.3. ProportionalPressure Value

The setpoint is interpreted as a percentage of the range derived of the `[MinCompPressure – Max-`

Page 318



CompPressure] attributes. The internal setpoint will be lowered (compensated) dependent on the flow in the pump (lower flow  $\Rightarrow$  lower internal setpoint).

#### 4.2.6.3.4. ConstantFlow Value

The setpoint is interpreted as a percentage of the range of the sensor used for this control mode. In case of the internal flow sensor, this will be the range derived from the [MinConstFlow – MaxConstFlow] attributes. In case of a remote flow sensor, this will be the range derived from the [MinMeasuredValue – MaxMeasuredValue] attributes of the remote flow sensor.

#### 4.2.6.3.5. ConstantTemperature Value

The setpoint is interpreted as a percentage of the range of the sensor used for this control mode. In case of the internal temperature sensor, this will be the range derived from the [MinConstTemp – MaxConstTemp] attributes. In case of a remote temperature sensor, this will be the range derived from the [MinMeasuredValue – MaxMeasuredValue] attributes of the remote temperature sensor.

#### 4.2.6.3.6. Automatic Value

This behavior is manufacturer defined. The pump can be stopped by setting the setpoint of the level control cluster to 0, or by using the On/Off cluster. If the pump is started (at any setpoint), the speed of the pump is entirely determined by the pump.

### 4.2.7. Attributes

| ID     | Name                    | Type   | Constraint | Quality | Fallback | Access | Conformance      |
|--------|-------------------------|--------|------------|---------|----------|--------|------------------|
| 0x0000 | <b>MaxPressure</b>      | int16  | all        | F X     | null     | R V    | M                |
| 0x0001 | <b>MaxSpeed</b>         | uint16 | all        | F X     | null     | R V    | M                |
| 0x0002 | <b>MaxFlow</b>          | uint16 | all        | F X     | null     | R V    | M                |
| 0x0003 | <b>MinConstPressure</b> | int16  | all        | F X     | null     | R V    | PRSCONST, [AUTO] |
| 0x0004 | <b>MaxConstPressure</b> | int16  | all        | F X     | null     | R V    | PRSCONST, [AUTO] |
| 0x0005 | <b>MinCompPressure</b>  | int16  | all        | F X     | null     | R V    | PRSCOMP, [AUTO]  |
| 0x0006 | <b>MaxCompPressure</b>  | int16  | all        | F X     | null     | R V    | PRSCOMP, [AUTO]  |
| 0x0007 | <b>MinConstSpeed</b>    | uint16 | all        | F X     | null     | R V    | SPD, [AUTO]      |
| 0x0008 | <b>MaxConstSpeed</b>    | uint16 | all        | F X     | null     | R V    | SPD, [AUTO]      |
| 0x0009 | <b>MinConstFlow</b>     | uint16 | all        | F X     | null     | R V    | FLW, [AUTO]      |



Page 319



| ID     | Name                          | Type                              | Constraint | Quality | Fallback | Access | Conformance  |
|--------|-------------------------------|-----------------------------------|------------|---------|----------|--------|--------------|
| 0x000A | <b>MaxConstFlow</b>           | uint16                            | all        | F X     | null     | R V    | FLW, [AUTO]  |
| 0x000B | <b>MinConstTemp</b>           | int16                             | min -27315 | F X     | null     | R V    | TEMP, [AUTO] |
| 0x000C | <b>MaxConstTemp</b>           | int16                             | min -27315 | F X     | null     | R V    | TEMP, [AUTO] |
| 0x0010 | <b>PumpStatus</b>             | <a href="#">PumpStatusBitmap</a>  | desc       | P       | 0        | R V    | O            |
| 0x0011 | <b>EffectiveOperationMode</b> | <a href="#">OperationModeEnum</a> | desc       | N       | desc     | R V    | M            |
| 0x0012 | <b>EffectiveControlMode</b>   | <a href="#">ControlModeEnum</a>   | desc       | N       | desc     | R V    | M            |
| 0x0013 | <b>Capacity</b>               | int16                             | all        | P X     | null     | R V    | M            |
| 0x0014 | <b>Speed</b>                  | uint16                            | all        | X       | null     | R V    | O            |
| 0x0015 | <b>LifetimeRunningHours</b>   | uint24                            | all        | N X     | 0        | RW VM  | O            |
| 0x0016 | <b>Power</b>                  | uint24                            | all        | X       | null     | R V    | O            |
| 0x0017 | <b>LifetimeEnergyConsumed</b> | uint32                            | all        | N X     | 0        | RW VM  | O            |
| 0x0020 | <b>OperationMode</b>          | <a href="#">OperationModeEnum</a> | desc       | N       | 0        | RW VM  | M            |
| 0x0021 | <b>ControlMode</b>            | <a href="#">ControlModeEnum</a>   | desc       | N       | 0        | RW VM  | O            |
| 0x0022 | <b>AlarmMask</b>              |                                   |            |         |          |        | D            |

#### 4.2.7.1. MaxPressure Attribute

This attribute specifies the maximum pressure the pump can achieve. It is a physical limit, and does not apply to any specific control mode or operation mode.

Valid range is -3,276.7 kPa to 3,276.7 kPa (steps of 0.1 kPa).

This attribute SHALL be null if the value is invalid.

Page 320







#### 4.2.7.2. MaxSpeed Attribute

This attribute specifies the maximum speed the pump can achieve. It is a physical limit, and does not apply to any specific control mode or operation mode.

Valid range is 0 to 65,534 RPM (steps of 1 RPM).

This attribute SHALL be null if the value is invalid.

#### 4.2.7.3. MaxFlow Attribute

This attribute specifies the maximum flow the pump can achieve. It is a physical limit, and does not apply to any specific control mode or operation mode.

Valid range is 0 m<sup>3</sup>/h to 6,553.4 m<sup>3</sup>/h (steps of 0.1 m<sup>3</sup>/h).

This attribute SHALL be null if the value is invalid.

#### 4.2.7.4. MinConstPressure Attribute

This attribute specifies the minimum pressure the pump can achieve when it is working with the ControlMode attribute set to ConstantPressure.

Valid range is -3,276.7 kPa to 3,276.7 kPa (steps of 0.1 kPa).

This attribute SHALL be null if the value is invalid.

#### 4.2.7.5. MaxConstPressure Attribute

This attribute specifies the maximum pressure the pump can achieve when it is working with the ControlMode attribute set to ConstantPressure.

Valid range is -3,276.7 kPa to 3,276.7 kPa (steps of 0.1 kPa).

This attribute SHALL be null if the value is invalid.

#### 4.2.7.6. MinCompPressure Attribute

This attribute specifies the minimum compensated pressure the pump can achieve when it is working with the ControlMode attribute set to ProportionalPressure.

Valid range is -3,276.7 kPa to 3,276.7 kPa (steps of 0.1 kPa).

This attribute SHALL be null if the value is invalid.

#### 4.2.7.7. MaxCompPressure Attribute

This attribute specifies the maximum compensated pressure the pump can achieve when it is working with the ControlMode attribute set to ProportionalPressure.

Valid range is -3,276.7 kPa to 3,276.7 kPa (steps of 0.1 kPa).

This attribute SHALL be null if the value is invalid.

#### 4.2.7.8. MinConstSpeed Attribute

This attribute specifies the minimum speed the pump can achieve when it is working with the Con-



Page 321



ControlMode attribute set to ConstantSpeed.

Valid range is 0 to 65,534 RPM (steps of 1 RPM).  
This attribute SHALL be null if the value is invalid.

#### 4.2.7.9. MaxConstSpeed Attribute

This attribute specifies the maximum speed the pump can achieve when it is working with the ControlMode attribute set to ConstantSpeed.

Valid range is 0 to 65,534 RPM (steps of 1 RPM).  
This attribute SHALL be null if the value is invalid.

#### 4.2.7.10. MinConstFlow Attribute

This attribute specifies the minimum flow the pump can achieve when it is working with the ControlMode attribute set to ConstantFlow.

Valid range is 0 m<sup>3</sup>/h to 6,553.4 m<sup>3</sup>/h (steps of 0.1 m<sup>3</sup>/h).  
This attribute SHALL be null if the value is invalid.

#### 4.2.7.11. MaxConstFlow Attribute

This attribute specifies the maximum flow the pump can achieve when it is working with the ControlMode attribute set to ConstantFlow.

Valid range is 0 m<sup>3</sup>/h to 6,553.4 m<sup>3</sup>/h (steps of 0.1 m<sup>3</sup>/h).  
This attribute SHALL be null if the value is invalid.

#### 4.2.7.12. MinConstTemp Attribute

This attribute specifies the minimum temperature the pump can maintain in the system when it is working with the ControlMode attribute set to ConstantTemperature.

Valid range is -273.15 °C to 327.67 °C (steps of 0.01 °C).  
This attribute SHALL be null if the value is invalid.

#### 4.2.7.13. MaxConstTemp Attribute

This attribute specifies the maximum temperature the pump can maintain in the system when it is working with the ControlMode attribute set to ConstantTemperature.

MaxConstTemp SHALL be greater than or equal to MinConstTemp

Valid range is -273.15 °C to 327.67 °C (steps of 0.01 °C).  
This attribute SHALL be null if the value is invalid.

#### 4.2.7.14. PumpStatus Attribute

This attribute specifies the activity status of the pump functions as listed in [PumpStatusBitmap](#). Where a pump controller function is active, the corresponding bit SHALL be set to 1. Where a pump

Page 322







controller function is not active, the corresponding bit SHALL be set to 0.

#### 4.2.7.15. **EffectiveOperationMode Attribute**

This attribute specifies current effective operation mode of the pump as defined in [OperationModeEnum](#).

The value of the EffectiveOperationMode attribute is the same as the OperationMode attribute, unless one of the following points are true:

- The pump is physically set to run with the local settings
- The LocalOverride bit in the PumpStatus attribute is set,

See [OperationMode Attribute](#) and [ControlMode Attribute](#) for a detailed description of the operation and control of the pump.

#### 4.2.7.16. **EffectiveControlMode Attribute**

This attribute specifies the current effective control mode of the pump as defined in [ControlModeEnum](#).

This attribute contains the control mode that currently applies to the pump. It will have the value of the ControlMode attribute, unless one of the following points are true:

- The ControlMode attribute is set to Automatic. In this case, the value of the EffectiveControlMode SHALL match the behavior of the pump.
- A remote sensor is used as the sensor for regulation of the pump. In this case, EffectiveControlMode will display ConstantPressure, ConstantFlow or ConstantTemperature if the remote sensor is a pressure sensor, a flow sensor or a temperature sensor respectively, regardless of the value of the ControlMode attribute.

In case the ControlMode attribute is not included on the device and no remote sensors are connected, the value of the EffectiveControlMode SHALL match the vendor-specific behavior of the pump.

See [OperationMode Attribute](#) and [ControlMode Attribute](#) for detailed a description of the operation and control of the pump.

#### 4.2.7.17. **Capacity Attribute**

This attribute specifies the actual capacity of the pump as a percentage of the effective maximum setpoint value. It is updated dynamically as the speed of the pump changes.

If the value is not available (the measurement or estimation of the speed is done in the pump), this attribute will indicate the null value.

Valid range is 0 % to 163.835% (0.005 % granularity). Although this attribute is a signed value, values of capacity less than zero have no physical meaning.



Page 323



#### 4.2.7.18. Speed Attribute

This attribute specifies the actual speed of the pump measured in RPM. It is updated dynamically as the speed of the pump changes.

If the value is not available (the measurement or estimation of the speed is done in the pump), this attribute will indicate the null value.

Valid range is 0 to 65,534 RPM.

#### 4.2.7.19. LifetimeRunningHours Attribute

This attribute specifies the accumulated number of hours that the pump has been powered and the motor has been running. It is updated dynamically as it increases. It is preserved over power cycles of the pump. If LifeTimeRunningHours rises above maximum value it “rolls over” and starts at 0 (zero).

This attribute is writeable, in order to allow setting to an appropriate value after maintenance. If the value is not available, this attribute will indicate the null value.

Valid range is 0 to 16,777,214 hrs.

#### 4.2.7.20. Power Attribute

This attribute specifies the actual power consumption of the pump in Watts. The value of this attribute is updated dynamically as the power consumption of the pump changes.

This attribute is read only. If the value is not available (the measurement of power consumption is not done in the pump), this attribute will indicate the null value.

Valid range is 0 to 16,777,214 Watts.

#### 4.2.7.21. LifetimeEnergyConsumed Attribute

This attribute specifies the accumulated energy consumption of the pump through the entire lifetime of the pump in kWh. The value of the LifetimeEnergyConsumed attribute is updated dynamically as the energy consumption of the pump increases. If LifetimeEnergyConsumed rises above maximum value it “rolls over” and starts at 0 (zero).

This attribute is writeable, in order to allow setting to an appropriate value after maintenance.

Valid range is 0 kWh to 4,294,967,294 kWh.

This attribute SHALL be null if the value is unknown.

#### 4.2.7.22. OperationMode Attribute

This attribute specifies the operation mode of the pump as defined in [OperationModeEnum](#).

The actual operating mode of the pump is a result of the setting of the attributes OperationMode, ControlMode and the optional connection of a remote sensor. The operation and control is prioritized as shown in the scheme below:

Page 324



*Priority Scheme of Pump Operation and Control*![Flowchart for Pump Operation and Control Priority Scheme](9b33f26612e373d186f5199dc2c83400_img.jpg)

```

graph TD
    A{OperationMode  
is Maximum, Minimum  
or Local ?} -- YES --> B[Pump runs as defined by  
OperationMode (Maximum,  
Minimum or the Local  
setting)]
    A -- NO --> C{A remote sensor  
is connected ?}
    C -- YES --> D[Pump runs in the control mode as  
per the type of the remote sensor]
    C -- NO --> E[Pump runs as defined by  
ControlMode]
  
```

The flowchart illustrates the priority scheme for pump operation and control. It starts with a decision diamond: "OperationMode is Maximum, Minimum or Local ?". If "YES", the pump runs as defined by the OperationMode (Maximum, Minimum, or Local setting). If "NO", it proceeds to another decision diamond: "A remote sensor is connected ?". If "YES", the pump runs in the control mode as per the type of the remote sensor. If "NO", the pump runs as defined by the ControlMode attribute.

Flowchart for Pump Operation and Control Priority Scheme

If this attribute is Maximum, Minimum or Local, the OperationMode attribute decides how the pump is operated.

If this attribute is Normal and a remote sensor is connected to the pump, the type of the remote sensor decides the control mode of the pump. A connected remote pressure sensor will make the pump run in control mode Constant pressure and vice versa for flow and temperature type sensors. This is regardless of the setting of the ControlMode attribute.

If this attribute is Normal and no remote sensor is connected, the control mode of the pump is decided by the ControlMode attribute.

OperationMode MAY be changed at any time, even when the pump is running. The behavior of the pump at the point of changing the value of this attribute is vendor-specific.

In the case a device does not support a specific operation mode, the write interaction to this attribute with an unsupported operation mode value SHALL be ignored and a response containing the status of CONSTRAINT\_ERROR SHALL be returned.

#### 4.2.7.23. ControlMode Attribute

This attribute specifies the control mode of the pump as defined in [ControlModeEnum](#).



Page 325



See [OperationMode Attribute](#) for a detailed description of the operation and control of the pump.

ControlMode MAY be changed at any time, even when the pump is running. The behavior of the pump at the point of changing is vendor-specific.

In the case a device does not support a specific control mode, the write interaction to this attribute with an unsupported control mode value SHALL be ignored and a response containing the status of CONSTRAINT\_ERROR SHALL be returned.

#### 4.2.8. Events

| ID   | Name                             | Priority | Quality | Access | Conformance |
|------|----------------------------------|----------|---------|--------|-------------|
| 0x00 | <b>SupplyVoltageLow</b>          | INFO     |         | V      | 0           |
| 0x01 | <b>SupplyVoltageHigh</b>         | INFO     |         | V      | 0           |
| 0x02 | <b>PowerMissingPhase</b>         | INFO     |         | V      | 0           |
| 0x03 | <b>SystemPressureLow</b>         | INFO     |         | V      | 0           |
| 0x04 | <b>SystemPressureHigh</b>        | INFO     |         | V      | 0           |
| 0x05 | <b>DryRunning</b>                | CRITICAL |         | V      | 0           |
| 0x06 | <b>MotorTemperatureHigh</b>      | INFO     |         | V      | 0           |
| 0x07 | <b>PumpMotorFatalFailure</b>     | CRITICAL |         | V      | 0           |
| 0x08 | <b>ElectronicTemperatureHigh</b> | INFO     |         | V      | 0           |
| 0x09 | <b>PumpBlocked</b>               | CRITICAL |         | V      | 0           |
| 0x0A | <b>SensorFailure</b>             | INFO     |         | V      | 0           |
| 0x0B | <b>ElectronicNonFatalFailure</b> | INFO     |         | V      | 0           |
| 0x0C | <b>ElectronicFatalFailure</b>    | CRITICAL |         | V      | 0           |
| 0x0D | <b>GeneralFault</b>              | INFO     |         | V      | 0           |
| 0x0E | <b>Leakage</b>                   | INFO     |         | V      | 0           |
| 0x0F | <b>AirDetection</b>              | INFO     |         | V      | 0           |

Page 326







| ID   | Name                    | Priority | Quality | Access | Conformance |
|------|-------------------------|----------|---------|--------|-------------|
| 0x10 | <b>TurbineOperation</b> | INFO     |         | V      | O           |

## 4.3. Thermostat Cluster

This cluster provides an interface to the functionality of a thermostat.

![Diagram illustrating the example usage of the Thermostat and Related Clusters. It shows three main components: a Heating / cooling control panel, a Thermostat, and a Heating / cooling device (e.g., indoor air handler). The control panel contains a Server (S) and two Clients (C). The Thermostat contains a Server (S), two Clients (C), and one Server (S). The heating / cooling device contains a Server (S) and a Client (C). Arrows indicate data flow: 'Thermostat user interface configuration' from a 'Configuration tool' to the control panel's S; 'Dehumidification configuration' from the control panel's C to the thermostat's S; 'Thermostat configuration' from the control panel's C to the thermostat's S; 'Dehumidification notification' from optional sensors to the thermostat's S; 'Fan control' from the thermostat's C to the device's S; and 'Thermostat notification' from the thermostat's S to the device's C. A legend at the bottom defines C as Client and S as Server.](75828e84dc75cbd60c7b01121bf16181_img.jpg)

**Legend:**  
C = Client      S = Server

Diagram illustrating the example usage of the Thermostat and Related Clusters. It shows three main components: a Heating / cooling control panel, a Thermostat, and a Heating / cooling device (e.g., indoor air handler). The control panel contains a Server (S) and two Clients (C). The Thermostat contains a Server (S), two Clients (C), and one Server (S). The heating / cooling device contains a Server (S) and a Client (C). Arrows indicate data flow: 'Thermostat user interface configuration' from a 'Configuration tool' to the control panel's S; 'Dehumidification configuration' from the control panel's C to the thermostat's S; 'Thermostat configuration' from the control panel's C to the thermostat's S; 'Dehumidification notification' from optional sensors to the thermostat's S; 'Fan control' from the thermostat's C to the device's S; and 'Thermostat notification' from the thermostat's S to the device's C. A legend at the bottom defines C as Client and S as Server.

*Note: Device names are examples for illustration purposes only*

Figure 15. Example Usage of the Thermostat and Related Clusters"

### 4.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                           |
|----------|---------------------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added; fixed some defaults; CCB 1823, 1480 |
| 2        | CCB 1981 2186 2249 2250 2251; NFR Thermostat Setback                                  |
| 3        | CCB 2477 2560 2773 2777 2815 2816 3029                                                |
| 4        | All Hubs changes                                                                      |



Page 327



| Revision | Description                                                                                                                                                                            |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5        | New data model format and notation, added FeatureMap, collapsed attribute sets, clarified edge cases around limits, default value of xxxSetpointLimit now respects AbsxxxSetpointLimit |
| 6        | Introduced the LTNE feature and adapted text (spec issue #5778)                                                                                                                        |
| 7        | Update constraints on local temperature calibration and minimum setpoint deadband and introduced Presets and MatterScheduleConfiguration features                                      |
| 8        | Added comment regarding writing to ControlSequenceOfOperation.                                                                                                                         |
| 9        | Removed AlarmMask attribute and Alarm-CodeBitmap Type.                                                                                                                                 |

#### 4.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | TSTAT     |

#### 4.3.3. Cluster ID

| ID     | Name       |
|--------|------------|
| 0x0201 | Thermostat |

#### 4.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature   | Conformance | Summary                                            |
|-----|------|-----------|-------------|----------------------------------------------------|
| 0   | HEAT | Heating   | AUTO, O.a+  | Thermostat is capable of managing a heating device |
| 1   | COOL | Cooling   | AUTO, O.a+  | Thermostat is capable of managing a cooling device |
| 2   | OCC  | Occupancy | 0           | Supports Occupied and Unoccupied setpoints         |

Page 328







| Bit | Code | Feature                     | Conformance | Summary                                                                                 |
|-----|------|-----------------------------|-------------|-----------------------------------------------------------------------------------------|
| 3   | SCH  | ScheduleConfiguration       | D           | Supports remote configuration of a weekly schedule of setpoint transitions              |
| 4   | SB   | Setback                     | O           | Supports configurable setback (or span)                                                 |
| 5   | AUTO | AutoMode                    | O           | Supports a System Mode of Auto                                                          |
| 6   | LTNE | LocalTemperatureNotExposed  | O           | Thermostat does not expose the LocalTemperature Value in the LocalTemperature attribute |
| 7   | MSCH | MatterScheduleConfiguration | O           | Supports enhanced schedules                                                             |
| 8   | PRES | Presets                     | O           | Thermostat supports setpoint presets                                                    |

#### 4.3.4.1. LocalTemperatureNotExposed Feature

This feature indicates that the [Calculated Local Temperature](#) used internally is unavailable to report externally, for example due to the temperature control being done by a separate subsystem which does not offer a view into the currently measured temperature, but allows setpoints to be provided.

#### 4.3.4.2. MatterScheduleConfiguration Feature

This feature indicates that the thermostat is capable of schedules. If this feature is supported, the thermostat SHALL support a mechanism to do time synchronization.

### 4.3.5. Units of Temperature

Temperatures within this cluster are represented by types using units of degree Celsius.

The temperature data type used throughout this cluster is defined in the Derived Data Types section of the Data Model.

The following temperature-related data types are also defined in and used throughout this cluster:

- [TemperatureDifference](#)



Page 329



- [SignedTemperature](#)
- [UnsignedTemperature](#)

While temperature values SHALL be transferred over the air using these types, this does not limit how Thermostats may display or store temperature values. Thermostats which display temperature values SHOULD follow the recommendations in [Conversion of Temperature Values for Display](#).

### CAUTION

*Calculations with temperature attributes*

Where calculations or comparisons are performed, attribute values must be converted to a common type. In many cases, it is not sufficient to simply use the integer representation as the scaling from °C to integer value differs.

## 4.3.6. Setpoint Limits

There are a number of attributes which impose limits on setpoint values. This imposes constraints which SHALL be maintained by any mechanism which modifies a limit or setpoint. Individual attribute descriptions detail the actions to be taken should a conflict arise while modifying the value.

User configurable limits must be within device limits:

- [AbsMinHeatSetpointLimit](#)  $\le$  [MinHeatSetpointLimit](#)  $\le$  [MaxHeatSetpointLimit](#)  $\le$  [AbsMaxHeatSetpointLimit](#)
- [AbsMinCoolSetpointLimit](#)  $\le$  [MinCoolSetpointLimit](#)  $\le$  [MaxCoolSetpointLimit](#)  $\le$  [AbsMaxCoolSetpointLimit](#)

Setpoints must be within user configurable limits:

- [MinHeatSetpointLimit](#)  $\le$  [OccupiedHeatingSetpoint](#)  $\le$  [MaxHeatSetpointLimit](#)
- [MinCoolSetpointLimit](#)  $\le$  [OccupiedCoolingSetpoint](#)  $\le$  [MaxCoolSetpointLimit](#)
- [MinHeatSetpointLimit](#)  $\le$  [UnoccupiedHeatingSetpoint](#)  $\le$  [MaxHeatSetpointLimit](#)
- [MinCoolSetpointLimit](#)  $\le$  [UnoccupiedCoolingSetpoint](#)  $\le$  [MaxCoolSetpointLimit](#)

If, and only if, the AUTO feature is supported, a deadband must be maintained between Heating and Cooling setpoints and limits:

- [AbsMinHeatSetpointLimit](#)  $\le$  ([AbsMinCoolSetpointLimit](#) - [MinSetpointDeadBand](#))
- [AbsMaxHeatSetpointLimit](#)  $\le$  ([AbsMaxCoolSetpointLimit](#) - [MinSetpointDeadBand](#))
- [MinHeatSetpointLimit](#)  $\le$  ([MinCoolSetpointLimit](#) - [MinSetpointDeadBand](#))
- [MaxHeatSetpointLimit](#)  $\le$  ([MaxCoolSetpointLimit](#) - [MinSetpointDeadBand](#))
- [OccupiedHeatingSetpoint](#)  $\le$  ([OccupiedCoolingSetpoint](#) - [MinSetpointDeadBand](#))
- [UnoccupiedHeatingSetpoint](#)  $\le$  ([UnoccupiedCoolingSetpoint](#) - [MinSetpointDeadBand](#))

Page 330



### 4.3.7. Dependencies

For remote temperature sensing, the Temperature Measurement client cluster MAY be included on the same endpoint.

For occupancy sensing, the Occupancy Sensing client cluster MAY be included on the same endpoint.

### 4.3.8. Data Types

#### 4.3.8.1. ACErrorCodeBitmap Type

This data type is derived from map32.

| Bit | Name                     | Summary                                   | Conformance |
|-----|--------------------------|-------------------------------------------|-------------|
| 0   | <b>CompressorFail</b>    | Compressor Failure or Refrigerant Leakage | M           |
| 1   | <b>RoomSensorFail</b>    | Room Temperature Sensor Failure           | M           |
| 2   | <b>OutdoorSensorFail</b> | Outdoor Temperature Sensor Failure        | M           |
| 3   | <b>CoilSensorFail</b>    | Indoor Coil Temperature Sensor Failure    | M           |
| 4   | <b>FanFail</b>           | Fan Failure                               | M           |

#### 4.3.8.2. HVACSystemTypeBitmap Type

This data type is derived from map8.

| Bit  | Name                     | Summary                                    | Conformance |
|------|--------------------------|--------------------------------------------|-------------|
| 1..0 | <b>CoolingStage</b>      | Stage of cooling the HVAC system is using. | M           |
| 3..2 | <b>HeatingStage</b>      | Stage of heating the HVAC system is using. | M           |
| 4    | <b>HeatingIsHeatPump</b> | Is the heating type Heat Pump.             | M           |
| 5    | <b>HeatingUsesFuel</b>   | Does the HVAC system use fuel.             | M           |

##### 4.3.8.2.1. CoolingStage Bits

These bits SHALL indicate what stage of cooling the HVAC system is using.

- 00 = Cool Stage 1
- 01 = Cool Stage 2



Page 331



- 10 = Cool Stage 3
- 11 = Reserved

#### 4.3.8.2.2. HeatingStage Bits

These bits SHALL indicate what stage of heating the HVAC system is using.

- 00 = Heat Stage 1
- 01 = Heat Stage 2
- 10 = Heat Stage 3
- 11 = Reserved

#### 4.3.8.2.3. HeatingIsHeatPump Bit

This bit SHALL indicate whether the HVAC system is conventional or a heat pump.

- 0 = Conventional
- 1 = Heat Pump

#### 4.3.8.2.4. HeatingUsesFuel Bit

This bit SHALL indicate whether the HVAC system uses fuel.

- 0 = Does not use fuel
- 1 = Uses fuel

### 4.3.8.3. OccupancyBitmap Type

This data type is derived from map8.

| Bit | Name            | Summary                       | Conformance |
|-----|-----------------|-------------------------------|-------------|
| 0   | <b>Occupied</b> | Indicates the occupancy state | M           |

#### 4.3.8.3.1. Occupied Bit

If this bit is set, it SHALL indicate the occupied state else if the bit is not set, it SHALL indicate the unoccupied state.

### 4.3.8.4. PresetTypeFeaturesBitmap Type

This data type is derived from map16.

| Bit | Name             | Summary                                                 | Conformance |
|-----|------------------|---------------------------------------------------------|-------------|
| 0   | <b>Automatic</b> | Preset may be automatically activated by the thermostat | M           |

Page 332



| Bit | Name                 | Summary                             | Conformance |
|-----|----------------------|-------------------------------------|-------------|
| 1   | <b>SupportsNames</b> | Preset supports user-provided names | M           |

#### 4.3.8.5. ProgrammingOperationModeBitmap Type

This data type is derived from map8.

| Bit | Name                  | Summary                                                                                | Conformance |
|-----|-----------------------|----------------------------------------------------------------------------------------|-------------|
| 0   | <b>ScheduleActive</b> | Schedule programming mode. This enables any programmed weekly schedule configurations. | M           |
| 1   | <b>AutoRecovery</b>   | Auto/recovery mode                                                                     | M           |
| 2   | <b>Economy</b>        | Economy/EnergyStar mode                                                                | M           |

#### 4.3.8.6. RelayStateBitmap Type

This data type is derived from map16.

| Bit | Name              | Summary                       | Conformance |
|-----|-------------------|-------------------------------|-------------|
| 0   | <b>Heat</b>       | Heat Stage On                 | M           |
| 1   | <b>Cool</b>       | Cool Stage On                 | M           |
| 2   | <b>Fan</b>        | Fan Stage On                  | M           |
| 3   | <b>HeatStage2</b> | Heat 2 <sup>nd</sup> Stage On | M           |
| 4   | <b>CoolStage2</b> | Cool 2 <sup>nd</sup> Stage On | M           |
| 5   | <b>FanStage2</b>  | Fan 2 <sup>nd</sup> Stage On  | M           |
| 6   | <b>FanStage3</b>  | Fan 3 <sup>rd</sup> Stage On  | M           |

#### 4.3.8.7. RemoteSensingBitmap Type

This data type is derived from map8.

| Bit | Name                      | Summary                                                                    | Conformance                        |
|-----|---------------------------|----------------------------------------------------------------------------|------------------------------------|
| 0   | <b>LocalTemperature</b>   | <a href="#">Calculated Local Temperature</a> is derived from a remote node | M                                  |
| 1   | <b>OutdoorTemperature</b> | OutdoorTemperature is derived from a remote node                           | <a href="#">OutdoorTemperature</a> |



Page 333



| Bit | Name             | Summary                                 | Conformance |
|-----|------------------|-----------------------------------------|-------------|
| 2   | <b>Occupancy</b> | Occupancy is derived from a remote node | OCC         |

#### 4.3.8.8. ScheduleTypeFeaturesBitmap Type

This data type is derived from map16.

| Bit | Name                     | Summary                                 | Conformance |
|-----|--------------------------|-----------------------------------------|-------------|
| 0   | <b>SupportsPresets</b>   | Supports presets                        | [PRES].b+   |
| 1   | <b>SupportsSetpoints</b> | Supports setpoints                      | O.b+        |
| 2   | <b>SupportsNames</b>     | Supports user-provided names            | O           |
| 3   | <b>SupportsOff</b>       | Supports transitioning to SystemModeOff | O           |

##### 4.3.8.8.1. SupportsPresets Bit

This bit SHALL indicate that any [ScheduleStruct](#) with a [SystemMode](#) field whose value matches the [SystemMode](#) field on the encompassing [ScheduleTypeStruct](#) supports specifying presets on [ScheduleTransitionStructs](#) contained in its [Transitions](#) field.

##### 4.3.8.8.2. SupportsSetpoints Bit

This bit SHALL indicate that any [ScheduleStruct](#) with a [SystemMode](#) field whose value matches the [SystemMode](#) field on the encompassing [ScheduleTypeStruct](#) supports specifying setpoints on [ScheduleTransitionStructs](#) contained in its [Transitions](#) field.

##### 4.3.8.8.3. SupportsNames Bit

This bit SHALL indicate that any [ScheduleStruct](#) with a [SystemMode](#) field whose value matches the [SystemMode](#) field on the encompassing [ScheduleTypeStruct](#) supports setting the value of the [Name](#) field.

##### 4.3.8.8.4. SupportsOff Bit

This bit SHALL indicate that any [ScheduleStruct](#) with a [SystemMode](#) field whose value matches the [SystemMode](#) field on the encompassing [ScheduleTypeStruct](#) supports setting its [SystemMode](#) field to Off.

#### 4.3.8.9. ScheduleDayOfWeekBitmap Type

This data type is derived from map8.

| Bit | Name          | Summary | Conformance |
|-----|---------------|---------|-------------|
| 0   | <b>Sunday</b> | Sunday  | M           |
| 1   | <b>Monday</b> | Monday  | M           |

Page 334



| <b>Bit</b> | <b>Name</b>      | <b>Summary</b>   | <b>Conformance</b> |
|------------|------------------|------------------|--------------------|
| 2          | <b>Tuesday</b>   | Tuesday          | M                  |
| 3          | <b>Wednesday</b> | Wednesday        | M                  |
| 4          | <b>Thursday</b>  | Thursday         | M                  |
| 5          | <b>Friday</b>    | Friday           | M                  |
| 6          | <b>Saturday</b>  | Saturday         | M                  |
| 7          | <b>Away</b>      | Away or Vacation | M                  |

#### 4.3.8.10. ScheduleModeBitmap Type

This data type is derived from map8.

| <b>Bit</b> | <b>Name</b>                | <b>Summary</b>       | <b>Conformance</b> |
|------------|----------------------------|----------------------|--------------------|
| 0          | <b>HeatSetpointPresent</b> | Adjust Heat Setpoint | M                  |
| 1          | <b>CoolSetpointPresent</b> | Adjust Cool Setpoint | M                  |

#### 4.3.8.11. ACCapacityFormatEnum Type

This data type is derived from enum8.

| <b>Value</b> | <b>Name</b> | <b>Summary</b>                | <b>Conformance</b> |
|--------------|-------------|-------------------------------|--------------------|
| 0            | <b>BTUh</b> | British Thermal Unit per Hour | O                  |

#### 4.3.8.12. ACCompressorTypeEnum Type

This data type is derived from enum8.

| <b>Value</b> | <b>Name</b>    | <b>Summary</b>            | <b>Conformance</b> |
|--------------|----------------|---------------------------|--------------------|
| 0            | <b>Unknown</b> | Unknown compressor type   | O                  |
| 1            | <b>T1</b>      | Max working ambient 43 °C | O                  |
| 2            | <b>T2</b>      | Max working ambient 35 °C | O                  |
| 3            | <b>T3</b>      | Max working ambient 52 °C | O                  |

#### 4.3.8.13. ACLouverPositionEnum Type

This data type is derived from enum8.




Page 335



| Value | Name                 | Summary             | Conformance |
|-------|----------------------|---------------------|-------------|
| 1     | <b>Closed</b>        | Fully Closed        | 0           |
| 2     | <b>Open</b>          | Fully Open          | 0           |
| 3     | <b>Quarter</b>       | Quarter Open        | 0           |
| 4     | <b>Half</b>          | Half Open           | 0           |
| 5     | <b>ThreeQuarters</b> | Three Quarters Open | 0           |

#### 4.3.8.14. ACRefrigerantTypeEnum Type

This data type is derived from enum8.

| Value | Name           | Summary                  | Conformance |
|-------|----------------|--------------------------|-------------|
| 0     | <b>Unknown</b> | Unknown Refrigerant Type | 0           |
| 1     | <b>R22</b>     | R22 Refrigerant          | 0           |
| 2     | <b>R410a</b>   | R410a Refrigerant        | 0           |
| 3     | <b>R407c</b>   | R407c Refrigerant        | 0           |

#### 4.3.8.15. ACTTypeEnum Type

This data type is derived from enum8.

| Value | Name                    | Summary                   | Conformance |
|-------|-------------------------|---------------------------|-------------|
| 0     | <b>Unknown</b>          | Unknown AC Type           | 0           |
| 1     | <b>CoolingFixed</b>     | Cooling and Fixed Speed   | 0           |
| 2     | <b>HeatPumpFixed</b>    | Heat Pump and Fixed Speed | 0           |
| 3     | <b>CoolingInverter</b>  | Cooling and Inverter      | 0           |
| 4     | <b>HeatPumpInverter</b> | Heat Pump and Inverter    | 0           |

#### 4.3.8.16. SetpointRaiseLowerModeEnum Type

This data type is derived from enum8.

| Value | Name        | Summary                                | Conformance |
|-------|-------------|----------------------------------------|-------------|
| 0     | <b>Heat</b> | Adjust Heat Setpoint                   | HEAT        |
| 1     | <b>Cool</b> | Adjust Cool Setpoint                   | COOL        |
| 2     | <b>Both</b> | Adjust Heat Setpoint and Cool Setpoint | HEAT   COOL |

Page 336



#### 4.3.8.17. ControlSequenceOfOperationEnum Type

This data type is derived from enum8.

| Value | Name                               | Summary                                                           | Conformance   |
|-------|------------------------------------|-------------------------------------------------------------------|---------------|
| 0     | <b>CoolingOnly</b>                 | Heat and Emergency are not possible                               | [COOL]        |
| 1     | <b>CoolingWithReheat</b>           | Heat and Emergency are not possible                               | [COOL]        |
| 2     | <b>HeatingOnly</b>                 | Cool and precooling (see <a href="#">Terms</a> ) are not possible | [HEAT]        |
| 3     | <b>HeatingWithReheat</b>           | Cool and precooling are not possible                              | [HEAT]        |
| 4     | <b>CoolingAndHeating</b>           | All modes are possible                                            | [HEAT & COOL] |
| 5     | <b>CoolingAndHeatingWithReheat</b> | All modes are possible                                            | [HEAT & COOL] |

#### NOTE

##### *CoolingAndHeating*

A thermostat indicating it supports CoolingAndHeating (or CoolingAndHeatingWithReheat) SHOULD be able to request heating or cooling on demand and will usually support the Auto SystemMode.

Systems which support cooling **or** heating, requiring external intervention to change modes or where the whole building must be in the same mode, SHOULD report CoolingOnly or HeatingOnly based on the current capability.

#### 4.3.8.18. PresetScenarioEnum Type

This data type is derived from enum8.

| Value | Name              | Summary                                      | Conformance |
|-------|-------------------|----------------------------------------------|-------------|
| 1     | <b>Occupied</b>   | The thermostat-controlled area is occupied   | M           |
| 2     | <b>Unoccupied</b> | The thermostat-controlled area is unoccupied | M           |
| 3     | <b>Sleep</b>      | Users are likely to be sleeping              | M           |
| 4     | <b>Wake</b>       | Users are likely to be waking up             | M           |
| 5     | <b>Vacation</b>   | Users are on vacation                        | M           |



Page 337



| Value | Name                | Summary                               | Conformance |
|-------|---------------------|---------------------------------------|-------------|
| 6     | <b>GoingToSleep</b> | Users are likely to be going to sleep | M           |
| 254   | <b>UserDefined</b>  | Custom presets                        | M           |

#### 4.3.8.18.1. Undefined Value

This value SHALL have no specified scenario.

#### 4.3.8.18.2. Occupied Value

This value SHALL indicate the preset for periods when the thermostat's temperature-controlled area is occupied. It is intended for thermostats that can automatically determine occupancy.

#### 4.3.8.18.3. Unoccupied Value

This value SHALL indicate the preset for periods when the thermostat's temperature-controlled area is unoccupied. It is intended for thermostats that can automatically determine occupancy.

#### 4.3.8.18.4. Sleep Value

This value SHALL indicate the preset for periods when users are likely to be asleep.

#### 4.3.8.18.5. Wake Value

This value SHALL indicate the preset for periods when users are likely to be waking up.

#### 4.3.8.18.6. Vacation Value

This value SHALL indicate the preset for periods when users are on vacation, or otherwise out-of-home for extended periods of time.

#### 4.3.8.18.7. GoingToSleep Value

This value SHALL indicate the preset for periods when users are likely to be going to sleep.

#### 4.3.8.18.8. UserDefined Value

This value SHALL indicate a free-form preset; when set, the Name field on [PresetStruct](#) SHALL NOT be null.

### 4.3.8.19. SetpointChangeSourceEnum Type

This data type is derived from enum8.

| Value | Name          | Summary                                                   | Conformance |
|-------|---------------|-----------------------------------------------------------|-------------|
| 0     | <b>Manual</b> | Manual, user-initiated setpoint change via the thermostat | O           |

Page 338







| Value | Name            | Summary                                                                             | Conformance  |
|-------|-----------------|-------------------------------------------------------------------------------------|--------------|
| 1     | <b>Schedule</b> | Schedule/internal programming-initiated set-point change                            | [SCH   MSCH] |
| 2     | <b>External</b> | Externally-initiated set-point change (e.g., DRLC cluster command, attribute write) | O            |

#### 4.3.8.20. StartOfWeekEnum Type

This data type is derived from enum8.

| Value | Name             | Summary | Conformance |
|-------|------------------|---------|-------------|
| 0     | <b>Sunday</b>    |         | M           |
| 1     | <b>Monday</b>    |         | M           |
| 2     | <b>Tuesday</b>   |         | M           |
| 3     | <b>Wednesday</b> |         | M           |
| 4     | <b>Thursday</b>  |         | M           |
| 5     | <b>Friday</b>    |         | M           |
| 6     | <b>Saturday</b>  |         | M           |

#### 4.3.8.21. SystemModeEnum Type

This data type is derived from enum8.

| Value | Name                 | Summary                                                                | Conformance |
|-------|----------------------|------------------------------------------------------------------------|-------------|
| 0     | <b>Off</b>           | The Thermostat does not generate demand for Cooling or Heating         | O           |
| 1     | <b>Auto</b>          | Demand is generated for either Cooling or Heating, as required         | AUTO        |
| 3     | <b>Cool</b>          | Demand is only generated for Cooling                                   | [COOL]      |
| 4     | <b>Heat</b>          | Demand is only generated for Heating                                   | [HEAT]      |
| 5     | <b>EmergencyHeat</b> | 2 <sup>nd</sup> stage heating is in use to achieve desired temperature | [HEAT]      |
| 6     | <b>Precooling</b>    | (see <a href="#">Terms</a> )                                           | [COOL]      |



Page 339



| Value | Name           | Summary | Conformance |
|-------|----------------|---------|-------------|
| 7     | <b>FanOnly</b> |         | O           |
| 8     | <b>Dry</b>     |         | O           |
| 9     | <b>Sleep</b>   |         | O           |

Table 9. Interpretation of Heat, Cool and Auto [\*SystemModeEnum\*](#) Values

| Attribute Values | Temperature Below Heat Setpoint | Temperature Between Heat Setpoint and Cool Setpoint | Temperature Above Cool Setpoint |
|------------------|---------------------------------|-----------------------------------------------------|---------------------------------|
| Heat             | Temperature below target        | Temperature on target                               | Temperature on target           |
| Cool             | Temperature on target           | Temperature on target                               | Temperature above target        |
| Auto             | Temperature below target        | Temperature on target                               | Temperature above target        |

#### 4.3.8.22. ThermostatRunningModeEnum Type

This data type is derived from enum8.

| Value | Name        | Summary                                                        | Conformance |
|-------|-------------|----------------------------------------------------------------|-------------|
| 0     | <b>Off</b>  | The Thermostat does not generate demand for Cooling or Heating | O           |
| 3     | <b>Cool</b> | Demand is only generated for Cooling                           | [COOL]      |
| 4     | <b>Heat</b> | Demand is only generated for Heating                           | [HEAT]      |

#### 4.3.8.23. TemperatureSetpointHoldEnum Type

This data type is derived from enum8.

| Value | Name                   | Summary                                                       | Conformance |
|-------|------------------------|---------------------------------------------------------------|-------------|
| 0     | <b>SetpointHoldOff</b> | Follow scheduling program                                     | M           |
| 1     | <b>SetpointHoldOn</b>  | Maintain current setpoint, regardless of schedule transitions | M           |

#### 4.3.8.24. PresetStruct Type

Page 340



| ID | Name                   | Type                               | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Pre-setHandle</b>   | octstr                             | max 16     | X       |          |        | M           |
| 1  | <b>PresetScenario</b>  | <a href="#">PresetScenarioEnum</a> | all        |         |          |        | M           |
| 2  | <b>Name</b>            | string                             | max 64     | X       | null     |        | O           |
| 3  | <b>CoolingSetpoint</b> | temperature                        | desc       |         | 26°C     |        | COOL        |
| 4  | <b>HeatingSetpoint</b> | temperature                        | desc       |         | 20°C     |        | HEAT        |
| 5  | <b>BuiltIn</b>         | bool                               | all        | X       | false    |        | M           |

#### 4.3.8.24.1. PresetHandle Field

This field SHALL indicate a device generated identifier for this preset. It SHALL be unique on the device, and SHALL NOT be reused after the associated preset has been deleted.

This field SHALL only be null when the encompassing [PresetStruct](#) is appended to the [Presets](#) attribute for the purpose of creating a new Preset. Refer to [Presets](#) for the creation of Preset handles.

#### 4.3.8.24.2. PresetScenario Field

This field SHALL indicate the associated [PresetScenarioEnum](#) value for this preset.

#### 4.3.8.24.3. Name Field

This field SHALL indicate a name provided by a user. The null value SHALL indicate no name.

Within each subset of presets sharing the same PresetScenario field value, there SHALL NOT be any presets with the same value, including null as a value, in the Name field.

#### 4.3.8.24.4. CoolingSetpoint Field

This field SHALL indicate the cooling setpoint for the preset. Refer to [Setpoint Limits](#) for value constraints.

#### 4.3.8.24.5. HeatingSetpoint Field

This field SHALL indicate the heating setpoint for the preset. Refer to [Setpoint Limits](#) for value constraints.

#### 4.3.8.24.6. BuiltIn Field

This field SHALL indicate whether the preset is marked as "built-in", meaning that it can be modi-



Page 341



fied, but it cannot be deleted.

#### 4.3.8.25. PresetTypeStruct Type

| ID | Name                      | Type                                      | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------------|-------------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>PresetScenario</b>     | <a href="#">PresetScenarioEnum</a>        | all        |         |          |        | M           |
| 1  | <b>NumberOfPresets</b>    | uint8                                     | all        |         | 0        |        | M           |
| 2  | <b>PresetTypeFeatures</b> | <a href="#">PresetTypeFeatures-Bitmap</a> | all        |         | 0        |        | M           |

##### 4.3.8.25.1. PresetScenario Field

This field SHALL specify a [PresetScenarioEnum](#) value supported by this thermostat.

##### 4.3.8.25.2. NumberOfPresets Field

This field SHALL specify a limit for the number of presets for this [PresetScenarioEnum](#).

##### 4.3.8.25.3. PresetTypeFeatures Field

This field SHALL specify a bitmap of features for this [PresetTypeStruct](#).

#### 4.3.8.26. WeeklyScheduleTransitionStruct Type

This represents a single transition in a Thermostat schedule

| ID | Name                  | Type        | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------|-------------|------------|---------|----------|--------|-------------|
| 0  | <b>TransitionTime</b> | uint16      | max 1439   |         |          |        | M           |
| 1  | <b>HeatSetpoint</b>   | temperature | all        | X       |          |        | M           |
| 2  | <b>CoolSetpoint</b>   | temperature | all        | X       |          |        | M           |

##### 4.3.8.26.1. TransitionTime Field

This field SHALL represent the start time of the schedule transition during the associated day. The time will be represented by a 16 bits unsigned integer to designate the minutes since midnight. For example, 6am will be represented by 360 minutes since midnight and 11:30pm will be represented by 1410 minutes since midnight.

Page 342



#### 4.3.8.26.2. HeatSetpoint Field

This field SHALL represent the heat setpoint to be applied at this associated transition start time.

#### 4.3.8.26.3. CoolSetpoint Field

This field SHALL represent the cool setpoint to be applied at this associated transition start time.

#### 4.3.8.27. ScheduleStruct Type

| ID | Name                  | Type                           | Constraint                       | Quality | Fallback | Access | Conformance |
|----|-----------------------|--------------------------------|----------------------------------|---------|----------|--------|-------------|
| 0  | <b>ScheduleHandle</b> | octstr                         | max 16                           | X       |          |        | M           |
| 1  | <b>SystemMode</b>     | SystemModeEnum                 | desc                             |         |          |        | M           |
| 2  | <b>Name</b>           | string                         | max 64                           |         |          |        | O           |
| 3  | <b>PresetHandle</b>   | octstr                         | max 16                           |         |          |        | O           |
| 4  | <b>Transitions</b>    | list[ScheduleTransitionStruct] | 1 to NumberOfScheduleTransitions |         | empty    |        | M           |
| 5  | <b>BuiltIn</b>        | bool                           | all                              | X       | false    |        | M           |

##### 4.3.8.27.1. ScheduleHandle Field

This field SHALL indicate a device generated identifier for this schedule. It SHALL be unique on the device, and SHALL NOT be reused after the associated schedule has been deleted.

This field SHALL only be null when the encompassing [ScheduleStruct](#) is appended to the [Schedules](#) attribute for the purpose of creating a new Schedule. Refer to [Schedules](#) for the creation of Schedule handles.

##### 4.3.8.27.2. SystemMode Field

This field SHALL specify the default thermostat system mode for [transitions](#) in this schedule. The only valid values for this field SHALL be Auto, Heat, and Cool.

##### 4.3.8.27.3. Name Field

This field SHALL specify a name for the [ScheduleStruct](#).

##### 4.3.8.27.4. PresetHandle Field

This field SHALL indicate the default [PresetHandle](#) value for [transitions](#) in this schedule.




Page 343



#### 4.3.8.27.5. Transitions Field

This field SHALL specify a list of transitions for the schedule.

This field SHALL NOT contain more than one [ScheduleStruct](#) with the same [TransitionTime](#) field and overlapping [DayOfWeek](#) fields; i.e. there SHALL be no duplicate transitions.

If the [NumberOfScheduleTransitionPerDay](#) attribute is not null, then for each bit in [ScheduleDayOfWeekBitmap](#), the number of transitions with that bit set in [DayOfWeek](#) SHALL NOT be greater than the value of the [NumberOfScheduleTransitionPerDay](#) attribute.

For the purposes of determining which [ScheduleStruct](#) in this list is currently active, the current time SHALL be the number of minutes past midnight in the display value of the current time, not the actual number of minutes that have elapsed since midnight. On days which transition into or out of daylight saving time, certain values may repeat or not occur during the transition period.

A [ScheduleTransitionStruct](#) in this list SHALL be active if the current day of the week matches its [DayOfWeek](#) field and the current time is greater than or equal to the [TransitionTime](#), but less than the [TransitionTime](#) on any other [ScheduleTransitionStruct](#) in the [Transitions](#) field whose [DayOfWeek](#) field also matches the current day of the week.

If the current time is less than every [ScheduleTransitionStruct](#) whose [DayOfWeek](#) field also matches the current day of the week, the server SHALL attempt the same process to identify the active [ScheduleTransitionStruct](#) for the day preceding the previously attempted day of the week, repeating until an active [ScheduleTransitionStruct](#) is found or the attempted day is the current day of the week again. If no active [ScheduleTransitionStruct](#) is found, then the active [ScheduleTransitionStruct](#) SHALL be the [ScheduleTransitionStruct](#) with the largest [TransitionTime](#) field from the set of [ScheduleTransitionStructs](#) whose [DayOfWeek](#) field matches the current day of the week.

#### 4.3.8.27.6. BuiltIn Field

This field SHALL indicate whether the schedule is marked as "built-in", meaning that it can be modified, but it cannot be deleted.

#### 4.3.8.28. ScheduleTransitionStruct Type

| ID | Name                  | Type                                    | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------|-----------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>DayOfWeek</b>      | <a href="#">ScheduleDayOfWeekBitmap</a> | desc       |         |          |        | M           |
| 1  | <b>TransitionTime</b> | uint16                                  | max 1439   |         |          |        | M           |
| 2  | <b>Pre-setHandle</b>  | octstr                                  | max 16     |         |          |        | [PRES]      |

Page 344







| ID | Name                   | Type            | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|-----------------|------------|---------|----------|--------|-------------|
| 3  | <b>System-Mode</b>     | System-ModeEnum | desc       |         |          |        | 0           |
| 4  | <b>CoolingSetpoint</b> | temperature     | desc       |         |          |        | [COOL]      |
| 5  | <b>HeatingSetpoint</b> | temperature     | desc       |         |          |        | [HEAT]      |

This struct provides a time of day and a set of days of the week for a state transition within a schedule. The thermostat SHALL use the following order of precedence for determining a new setpoint at the time of transition:

1. If the [PresetHandle](#) field is provided, then the setpoint for the [PresetStruct](#) in the [Presets](#) attribute with that identifier SHALL be used
2. If either the [HeatingSetpoint](#) or [CoolingSetpoint](#) is provided, then it SHALL be used
  - a. If the [SystemMode](#) field is provided, the [HeatingSetpoint](#) and [CoolingSetpoint](#) fields SHALL be interpreted using the [SystemMode](#) field
  - b. If the [SystemMode](#) field is not provided, the [HeatingSetpoint](#) and [CoolingSetpoint](#) fields SHALL be interpreted using the [SystemMode](#) field on the parent [ScheduleStruct](#)
3. If neither the [PresetHandle](#) field or any Setpoint field is provided, then the [PresetHandle](#) field on the parent [ScheduleStruct](#) SHALL be used to determine the active [PresetStruct](#)
4. If the [PresetHandle](#) is not indicated and no setpoint is provided for the current [SystemMode](#), the server SHALL use a default value for the current [SystemMode](#).

If the setpoint was derived from a preset, then the [ActivePresetHandle](#) SHALL be set to the [PresetHandle](#) of that preset.

If a [CoolingSetpoint](#) was used to determine the cooling setpoint:

- If the server supports the OCC feature, and the Occupied bit is not set on the [Occupancy](#) attribute, then the [UnoccupiedCoolingSetpoint](#) attribute SHALL be set to the [CoolingSetpoint](#)
- Otherwise, the [OccupiedCoolingSetpoint](#) attribute SHALL be set to the [CoolingSetpoint](#)

If a [HeatingSetpoint](#) was used to determine the heating setpoint:

- If the server supports the OCC feature, and the Occupied bit is not set on the [Occupancy](#) attribute, then the [UnoccupiedHeatingSetpoint](#) attribute SHALL be set to the [HeatingSetpoint](#)
- Otherwise, the [OccupiedHeatingSetpoint](#) attribute SHALL be set to the [HeatingSetpoint](#)

The [ScheduleTransitionStruct](#) SHALL be invalid if all the following are true:

- The [HeatingSetpoint](#) field is not provided



Page 345



- The [PresetHandle](#) field is not provided
- The [PresetHandle](#) field on the encompassing [ScheduleStruct](#) is not provided
- The [SystemMode](#) field is provided and has the value Heat or Auto, or the [SystemMode](#) field on the parent [ScheduleStruct](#) has the value Heat or Auto

The [ScheduleTransitionStruct](#) SHALL be invalid if all the following are true:

- The [CoolingSetpoint](#) field is not provided
- The [PresetHandle](#) field is not provided
- The [PresetHandle](#) field on the encompassing [ScheduleStruct](#) is not provided
- The [SystemMode](#) field is provided and has the value Cool or Auto, or the [SystemMode](#) field on the parent [ScheduleStruct](#) has the value Cool or Auto

#### 4.3.8.28.1. DayOfWeek Field

This field SHALL specify a bitmask of days of the week that the transition applies to. The Vacation bit SHALL NOT be set; vacation schedules SHALL be set via the vacation preset.

#### 4.3.8.28.2. TransitionTime Field

This SHALL specify the time of day at which the transition becomes active, in terms of minutes within the day representing the wall clock, where 0 is 00:00:00, 1 is 00:01:00 and 1439 is 23:59:00.

Handling of transitions during the changeover of Daylight Saving Time is implementation-dependent.

#### 4.3.8.28.3. PresetHandle Field

This field SHALL specify the preset used at the [TransitionTime](#). If this field is provided, then the [SystemMode](#), [CoolingSetpoint](#) and [HeatingSetpoint](#) fields SHALL NOT be provided.

#### 4.3.8.28.4. SystemMode Field

This SHALL specify the default mode to which the thermostat will switch for this transition, overriding the default for the schedule. The only valid values for this field SHALL be Auto, Heat, Cool and Off. This field SHALL only be included when the required system mode differs from the schedule's default [SystemMode](#).

#### 4.3.8.28.5. CoolingSetpoint Field

This field SHALL specify the cooling setpoint for the transition. If [PresetHandle](#) is set, this field SHALL NOT be included. Refer to [Setpoint Limits](#) for value constraints.

#### 4.3.8.28.6. HeatingSetpoint Field

This field SHALL specify the cooling setpoint for the transition. If [PresetHandle](#) is set, this field SHALL NOT be included. Refer to [Setpoint Limits](#) for value constraints.

Page 346







#### 4.3.8.29. ScheduleTypeStruct Type

| ID | Name                        | Type                                        | Constraint                            | Quality | Fallback | Access | Conformance |
|----|-----------------------------|---------------------------------------------|---------------------------------------|---------|----------|--------|-------------|
| 0  | <b>System-Mode</b>          | <a href="#">System-ModeEnum</a>             | desc                                  |         |          |        | M           |
| 1  | <b>NumberOfSchedules</b>    | uint8                                       | max <a href="#">NumberOfSchedules</a> |         | 0        |        | M           |
| 2  | <b>ScheduleTypeFeatures</b> | <a href="#">ScheduleTypeFeatures-Bitmap</a> | desc                                  |         | 0        |        | M           |

##### 4.3.8.29.1. SystemMode Field

This field SHALL specify a [SystemModeEnum](#) supported by this thermostat for Schedules. The only valid values for this field SHALL be Auto, Heat, and Cool.

##### 4.3.8.29.2. NumberOfSchedules Field

This field SHALL specify a limit for the number of Schedules for this SystemMode.

##### 4.3.8.29.3. ScheduleTypeFeatures Field

This field SHALL specify a bitmap of features for this schedule entry. At least one of SupportsPresets and SupportsSetpoints SHALL be set.

#### 4.3.8.30. TemperatureDifference Type

This data type is derived from int16 and represents a temperature difference with a resolution of 0.01°C.

- *value* = (*temperature in °C*) × 100

- -4°C ⇒ -400
- 123.45°C ⇒ 12345

The full (non-null) range of -327.67°C to 327.67°C may be used.

#### 4.3.8.31. SignedTemperature Type

This data type is derived from int8 and represents a temperature from -12.7°C to 12.7°C with a resolution of 0.1°C.

- *value* = (*temperature in °C*) × 10




Page 347



- $-4^{\circ}\text{C} \Rightarrow -40$
- $12.3^{\circ}\text{C} \Rightarrow 123$

This type is employed where compactness of representation is important and where the resolution and range are still satisfactory.

#### 4.3.8.32. UnsignedTemperature Type

This data type is derived from uint8 and represents a temperature from  $0^{\circ}\text{C}$  to  $25.5^{\circ}\text{C}$  with a resolution of  $0.1^{\circ}\text{C}$ .

- $value = (temperature\ in\ ^{\circ}\text{C}) \times 10$

- $4^{\circ}\text{C} \Rightarrow 40$
- $12.3^{\circ}\text{C} \Rightarrow 123$

This type is employed where compactness of representation is important and where the resolution and range are still satisfactory.

#### 4.3.9. Attributes

| ID     | Name                           | Type            | Constraint | Quality | Fallback             | Access | Conformance |
|--------|--------------------------------|-----------------|------------|---------|----------------------|--------|-------------|
| 0x0000 | <b>LocalTemperature</b>        | temperature     | all        | P X     |                      | R V    | M           |
| 0x0001 | <b>OutdoorTemperature</b>      | temperature     | all        | X       | null                 | R V    | O           |
| 0x0002 | <b>Occupancy</b>               | OccupancyBitmap | all        |         |                      | R V    | OCC         |
| 0x0003 | <b>AbsMinHeatSetpointLimit</b> | temperature     | desc       | F       | $7^{\circ}\text{C}$  | R V    | [HEAT]      |
| 0x0004 | <b>AbsMaxHeatSetpointLimit</b> | temperature     | desc       | F       | $30^{\circ}\text{C}$ | R V    | [HEAT]      |
| 0x0005 | <b>AbsMinCoolSetpointLimit</b> | temperature     | desc       | F       | $16^{\circ}\text{C}$ | R V    | [COOL]      |
| 0x0006 | <b>AbsMaxCoolSetpointLimit</b> | temperature     | desc       | F       | $32^{\circ}\text{C}$ | R V    | [COOL]      |

Page 348







| ID     | Name                               | Type                 | Constraint | Quality | Fallback                | Access  | Conformance |
|--------|------------------------------------|----------------------|------------|---------|-------------------------|---------|-------------|
| 0x0007 | <b>PICoolingDemand</b>             | uint8                | 0% to 100% | P       | -                       | R V     | [COOL]      |
| 0x0008 | <b>PIHeatingDemand</b>             | uint8                | 0% to 100% | P       | -                       | R V     | [HEAT]      |
| 0x0009 | <b>HVACSystemTypeConfiguration</b> | HVACSystemTypeBitmap | desc       | N       | 0                       | R[W] VM | D           |
| 0x0010 | <b>LocalTemperatureCalibration</b> | SignedTemperature    | all        | N       | 0°C                     | RW VM   | [!LTNE]     |
| 0x0011 | <b>OccupiedCoolingSetpoint</b>     | temperature          | desc       | N       | 26°C                    | RW VO   | COOL        |
| 0x0012 | <b>OccupiedHeatingSetpoint</b>     | temperature          | desc       | N       | 20°C                    | RW VO   | HEAT        |
| 0x0013 | <b>UnoccupiedCoolingSetpoint</b>   | temperature          | desc       | N       | 26°C                    | RW VO   | COOL & OCC  |
| 0x0014 | <b>UnoccupiedHeatingSetpoint</b>   | temperature          | desc       | N       | 20°C                    | RW VO   | HEAT & OCC  |
| 0x0015 | <b>MinHeatSetpointLimit</b>        | temperature          | desc       | N       | AbsMinHeatSetpointLimit | RW VM   | [HEAT]      |
| 0x0016 | <b>MaxHeatSetpointLimit</b>        | temperature          | desc       | N       | AbsMaxHeatSetpointLimit | RW VM   | [HEAT]      |
| 0x0017 | <b>MinCoolSetpointLimit</b>        | temperature          | desc       | N       | AbsMinCoolSetpointLimit | RW VM   | [COOL]      |



Page 349



| ID     | Name                              | Type                            | Constraint  | Quality | Fallback                  | Access  | Conformance |
|--------|-----------------------------------|---------------------------------|-------------|---------|---------------------------|---------|-------------|
| 0x0018 | Max-CoolSet-pointLimit            | temperature                     | desc        | N       | AbsMax-CoolSet-pointLimit | RW VM   | [COOL]      |
| 0x0019 | MinSet-point-DeadBand             | SignedTemperature               | 0 to 12.7°C | N       | 2°C                       | R[W] VM | AUTO        |
| 0x001A | Remote-Sensing                    | Remote-Sensing-Bitmap           | all         | N       | 0                         | RW VM   | O           |
| 0x001B | ControlSequenceOf-Operation       | ControlSequenceOf-OperationEnum | desc        | N       |                           | RW VM   | M           |
| 0x001C | System-Mode                       | System-ModeEnum                 | desc        | N       |                           | RW VM   | M           |
| 0x001E | ThermostatRunning-Mode            | ThermostatRunning-ModeEnum      | desc        |         | 0                         | R V     | [AUTO]      |
| 0x0020 | StartOfWeek                       | StartOfWeekEnum                 | desc        | F       |                           | R V     | SCH         |
| 0x0021 | NumberOfWeeklyTransitions         | uint8                           | all         | F       |                           | R V     | SCH         |
| 0x0022 | NumberOfDailyTransitions          | uint8                           | all         | F       |                           | R V     | SCH         |
| 0x0023 | TemperatureSet-pointHold          | TemperatureSet-pointHold-Enum   | desc        | N       | 0                         | RW VM   | O           |
| 0x0024 | TemperatureSet-pointHold-Duration | uint16                          | max 1440    | N X     | null                      | RW VM   | O           |

Page 350







| ID     | Name                                      | Type                           | Constraint                                   | Quality | Fallback | Access | Conformance |
|--------|-------------------------------------------|--------------------------------|----------------------------------------------|---------|----------|--------|-------------|
| 0x0025 | <b>ThermostatProgrammingOperationMode</b> | ProgrammingOperationModeBitmap | desc                                         | P       | 0        | RW VM  | O           |
| 0x0029 | <b>ThermostatRunningState</b>             | RelayStateBitmap               | desc                                         |         | -        | RV     | O           |
| 0x0030 | <b>SetpointChangeSource</b>               | SetpointChangeSourceEnum       | desc                                         |         | 0        | RV     | O           |
| 0x0031 | <b>SetpointChangeAmount</b>               | TemperatureDifference          | all                                          | X       | null     | RV     | O           |
| 0x0032 | <b>SetpointChangeSourceTimeStamp</b>      | epoch-s                        | all                                          |         | MS       | RV     | O           |
| 0x0034 | <b>OccupiedSetback</b>                    | UnsignedTemperature            | OccupiedSetbackMin to OccupiedSetbackMax     | N X     |          | RW VM  | SB          |
| 0x0035 | <b>OccupiedSetbackMin</b>                 | UnsignedTemperature            | max OccupiedSetbackMax                       | F X     |          | RV     | SB          |
| 0x0036 | <b>OccupiedSetbackMax</b>                 | UnsignedTemperature            | OccupiedSetbackMin to 25.4°C                 | F X     |          | RV     | SB          |
| 0x0037 | <b>UnoccupiedSetback</b>                  | UnsignedTemperature            | UnoccupiedSetbackMin to UnoccupiedSetbackMax | N X     |          | RW VM  | SB & OCC    |



Page 351



| ID     | Name                         | Type                      | Constraint                      | Quality | Fallback | Access | Conformance |
|--------|------------------------------|---------------------------|---------------------------------|---------|----------|--------|-------------|
| 0x0038 | <b>UnoccupiedSet-backMin</b> | UnsignedTemperature       | max UnoccupiedSet-backMax       | F X     |          | R V    | SB & OCC    |
| 0x0039 | <b>UnoccupiedSet-backMax</b> | UnsignedTemperature       | UnoccupiedSet-backMin to 25.4°C | F X     |          | R V    | SB & OCC    |
| 0x003A | <b>EmergencyHeat-Delta</b>   | UnsignedTemperature       | all                             | N       | 25.5°C   | RW VM  | O           |
| 0x0040 | <b>ACType</b>                | ACType-Enum               | desc                            | N       | 0        | RW VM  | O           |
| 0x0041 | <b>ACCapacity</b>            | uint16                    | all                             | N       | 0        | RW VM  | O           |
| 0x0042 | <b>ACRefrigerantType</b>     | ACRefrigerantType-Enum    | desc                            | N       | 0        | RW VM  | O           |
| 0x0043 | <b>ACCompressorType</b>      | ACCompressorType-Enum     | desc                            | N       | 0        | RW VM  | O           |
| 0x0044 | <b>ACErrorCode</b>           | ACErrorCodeBitmap         | all                             |         | 0        | RW VM  | O           |
| 0x0045 | <b>ACLouver-Position</b>     | ACLouver-PositionEnum     | desc                            | N       | 0        | RW VM  | O           |
| 0x0046 | <b>ACCoil-Temperature</b>    | temperature               | all                             | X       | null     | R V    | O           |
| 0x0047 | <b>ACCapacityFormat</b>      | ACCapacityFormatEnum      | desc                            | N       | 0        | RW VM  | O           |
| 0x0048 | <b>Preset-Types</b>          | list[PresetType-Struct]   | 1 to 7                          | F       |          | R V    | PRES        |
| 0x0049 | <b>Schedule-Types</b>        | list[ScheduleType-Struct] | 1 to 3                          | F       |          | R V    | MSCH        |

Page 352







| ID     | Name                             | Type                 | Constraint            | Quality | Fallback | Access | Conformance |
|--------|----------------------------------|----------------------|-----------------------|---------|----------|--------|-------------|
| 0x004A | NumberOfPresets                  | uint8                | min 1                 | F       |          | R V    | PRES        |
| 0x004B | NumberOfSchedules                | uint8                | min 1                 | F       |          | R V    | MSCH        |
| 0x004C | NumberOfScheduleTransitions      | uint8                | min 1                 | F       |          | R V    | MSCH        |
| 0x004D | NumberOfScheduleTransitionPerDay | uint8                | min 1                 | F X     |          | R V    | MSCH        |
| 0x004E | ActivePresetHandle               | octstr               | max 16                | N X     |          | R V    | PRES        |
| 0x004F | ActiveScheduleHandle             | octstr               | max 16                | N X     |          | R V    | MSCH        |
| 0x0050 | Presets                          | list[PresetStruct]   | max NumberOfPresets   | N T     |          | RW VM  | PRES        |
| 0x0051 | Schedules                        | list[ScheduleStruct] | max NumberOfSchedules | N T     |          | RW VM  | MSCH        |
| 0x0052 | SetpointHoldExpiryTimestamp      | epoch-s              | all                   | XN      | null     | R V    | O           |

#### 4.3.9.1. Calculated Local Temperature

The local temperature SHALL be calculated from the *measured temperature*, including any adjustments applied by [LocalTemperatureCalibration](#) attribute (if any) as follows:

**Calculated Local Temperature** = (*measured temperature*) + [LocalTemperatureCalibration](#)



Page 353



The *measured temperature* value may be local, or remote, depending on the value of the [Remote-Sensing](#) attribute when supported.

All setpoint attributes in the Thermostat cluster SHALL be triggered based off this calculated value (i.e., measured temperature and any calibration offset).

If the LocalTemperatureNotExposed feature is present, the behavior of the thermostat SHALL be that the equipment's temperature control uses the calculated local temperature even if that value is not reported in the [LocalTemperature](#) attribute.

#### 4.3.9.2. LocalTemperature Attribute

This attribute SHALL indicate the current [Calculated Local Temperature](#), when available.

- If the LTNE feature is not supported:
  - If the [LocalTemperatureCalibration](#) is invalid or currently unavailable, the attribute SHALL report null.
  - If the [LocalTemperatureCalibration](#) is valid, the attribute SHALL report that value.
- Otherwise, if the LTNE feature is supported, there is no feedback externally available for the [LocalTemperatureCalibration](#). In that case, the LocalTemperature attribute SHALL always report null.

#### 4.3.9.3. OutdoorTemperature Attribute

This attribute SHALL indicate the outdoor temperature, as measured locally or remotely (over the network).

#### 4.3.9.4. Occupancy Attribute

This attribute SHALL indicate whether the heated/cooled space is occupied or not, as measured locally or remotely (over the network).

#### 4.3.9.5. AbsMinHeatSetpointLimit Attribute

This attribute SHALL indicate the absolute minimum level that the heating setpoint MAY be set to. This is a limitation imposed by the manufacturer.

Refer to [Setpoint Limits](#) for constraints

#### 4.3.9.6. AbsMaxHeatSetpointLimit Attribute

This attribute SHALL indicate the absolute maximum level that the heating setpoint MAY be set to. This is a limitation imposed by the manufacturer.

Refer to [Setpoint Limits](#) for constraints

#### 4.3.9.7. AbsMinCoolSetpointLimit Attribute

This attribute SHALL indicate the absolute minimum level that the cooling setpoint MAY be set to. This is a limitation imposed by the manufacturer.

Page 354



Refer to [Setpoint Limits](#) for constraints

#### 4.3.9.8. **AbsMaxCoolSetpointLimit** Attribute

This attribute SHALL indicate the absolute maximum level that the cooling setpoint MAY be set to. This is a limitation imposed by the manufacturer.

Refer to [Setpoint Limits](#) for constraints

#### 4.3.9.9. **PICoolingDemand** Attribute

This attribute SHALL indicate the level of cooling demanded by the PI (proportional integral) control loop in use by the thermostat (if any), in percent. This value is 0 when the thermostat is in “off” or “heating” mode.

This attribute is reported regularly and MAY be used to control a cooling device.

#### 4.3.9.10. **PIHeatingDemand** Attribute

This attribute SHALL indicate the level of heating demanded by the PI loop in percent. This value is 0 when the thermostat is in “off” or “cooling” mode.

This attribute is reported regularly and MAY be used to control a heating device.

#### 4.3.9.11. **HVACSystemTypeConfiguration** Attribute

This attribute SHALL indicate the HVAC system type controlled by the thermostat. If the thermostat uses physical DIP switches to set these parameters, this information SHALL be available read-only from the DIP switches. If these parameters are set via software, there SHALL be read/write access in order to provide remote programming capability.

#### 4.3.9.12. **LocalTemperatureCalibration** Attribute

This attribute SHALL indicate the offset the Thermostat server SHALL make to the measured temperature (locally or remotely) to adjust the [Calculated Local Temperature](#) prior to using, displaying or reporting it.

The purpose of this attribute is to adjust the calibration of the Thermostat server per the user's preferences (e.g., to match if there are multiple servers displaying different values for the same HVAC area) or compensate for variability amongst temperature sensors.

If a Thermostat client attempts to write [LocalTemperatureCalibration](#) attribute to an unsupported value (e.g., out of the range supported by the Thermostat server), the Thermostat server SHALL respond with a status of SUCCESS and set the value of [LocalTemperatureCalibration](#) to the upper or lower limit reached.

##### NOTE

Prior to revision 8 of this cluster specification the value of this attribute was constrained to a range of -2.5°C to 2.5°C.



Page 355



#### 4.3.9.13. OccupiedCoolingSetpoint Attribute

This attribute SHALL indicate the cooling mode setpoint when the room is occupied.

Refer to [Setpoint Limits](#) for constraints.

If an attempt is made to set this attribute to a value greater than [MaxCoolSetpointLimit](#) or less than [MinCoolSetpointLimit](#), a response with the status code CONSTRAINT\_ERROR SHALL be returned.

If this attribute is set to a value that is less than ([OccupiedHeatingSetpoint](#) + [MinSetpointDeadBand](#)), the value of [OccupiedHeatingSetpoint](#) SHALL be adjusted to ([OccupiedCoolingSetpoint](#) - [MinSetpointDeadBand](#)).

If the occupancy status of the room is unknown, this attribute SHALL be used as the cooling mode setpoint.

If a client changes the value of this attribute, the server supports the PRES feature, and the server either does not support the OCC feature or the Occupied bit is set on the [Occupancy](#) attribute, the value of the [ActivePresetHandle](#) attribute SHALL be set to null.

#### 4.3.9.14. OccupiedHeatingSetpoint Attribute

This attribute SHALL indicate the heating mode setpoint when the room is occupied.

Refer to [Setpoint Limits](#) for constraints.

If an attempt is made to set this attribute to a value greater than [MaxHeatSetpointLimit](#) or less than [MinHeatSetpointLimit](#), a response with the status code CONSTRAINT\_ERROR SHALL be returned.

If this attribute is set to a value that is greater than ([OccupiedCoolingSetpoint](#) - [MinSetpointDeadBand](#)), the value of [OccupiedCoolingSetpoint](#) SHALL be adjusted to ([OccupiedHeatingSetpoint](#) + [MinSetpointDeadBand](#)).

If the occupancy status of the room is unknown, this attribute SHALL be used as the heating mode setpoint.

If a client changes the value of this attribute, the server supports the PRES feature, and the server either does not support the OCC feature or the Occupied bit is set on the [Occupancy](#) attribute, the value of the [ActivePresetHandle](#) attribute SHALL be set to null.

#### 4.3.9.15. UnoccupiedCoolingSetpoint Attribute

This attribute SHALL indicate the cooling mode setpoint when the room is unoccupied.

Refer to [Setpoint Limits](#) for constraints.

If an attempt is made to set this attribute to a value greater than [MaxCoolSetpointLimit](#) or less than [MinCoolSetpointLimit](#), a response with the status code CONSTRAINT\_ERROR SHALL be returned.

If this attribute is set to a value that is less than ([UnoccupiedHeatingSetpoint](#) + [MinSetpointDeadBand](#)), the value of [UnoccupiedHeatingSetpoint](#) SHALL be adjusted to ([UnoccupiedCoolingSetpoint](#) - [MinSetpointDeadBand](#)).

Page 356







If the occupancy status of the room is unknown, this attribute SHALL NOT be used.

If a client changes the value of this attribute, the server supports the PRES and OCC features, and the Occupied bit is not set on the [Occupancy](#) attribute, the value of the [ActivePresetHandle](#) attribute SHALL be set to null.

#### 4.3.9.16. UnoccupiedHeatingSetpoint Attribute

This attribute SHALL indicate the heating mode setpoint when the room is unoccupied.

Refer to [Setpoint Limits](#) for constraints.

If an attempt is made to set this attribute to a value greater than [MaxHeatSetpointLimit](#) or less than [MinHeatSetpointLimit](#), a response with the status code CONSTRAINT\_ERROR SHALL be returned.

If this attribute is set to a value that is greater than ([UnoccupiedCoolingSetpoint](#) - [MinSetpointDeadBand](#)), the value of [UnoccupiedCoolingSetpoint](#) SHALL be adjusted to ([UnoccupiedHeatingSetpoint](#) + [MinSetpointDeadBand](#)).

If the occupancy status of the room is unknown, this attribute SHALL NOT be used.

If a client changes the value of this attribute, the server supports the PRES and OCC features, and the Occupied bit is not set on the [Occupancy](#) attribute, the value of the [ActivePresetHandle](#) attribute SHALL be set to null.

#### 4.3.9.17. MinHeatSetpointLimit Attribute

This attribute SHALL indicate the minimum level that the heating setpoint MAY be set to.

This attribute, and the following three attributes, allow the user to define setpoint limits more constrictive than the manufacturer imposed ones. Limiting users (e.g., in a commercial building) to such setpoint limits can help conserve power.

Refer to [Setpoint Limits](#) for constraints. If an attempt is made to set this attribute to a value which conflicts with setpoint values then those setpoints SHALL be adjusted by the minimum amount to permit this attribute to be set to the desired value. If an attempt is made to set this attribute to a value which is not consistent with the constraints and cannot be resolved by modifying setpoints then a response with the status code CONSTRAINT\_ERROR SHALL be returned.

#### 4.3.9.18. MaxHeatSetpointLimit Attribute

This attribute SHALL indicate the maximum level that the heating setpoint MAY be set to.

Refer to [Setpoint Limits](#) for constraints. If an attempt is made to set this attribute to a value which conflicts with setpoint values then those setpoints SHALL be adjusted by the minimum amount to permit this attribute to be set to the desired value. If an attempt is made to set this attribute to a value which is not consistent with the constraints and cannot be resolved by modifying setpoints then a response with the status code CONSTRAINT\_ERROR SHALL be returned.



Page 357



#### 4.3.9.19. MinCoolSetpointLimit Attribute

This attribute SHALL indicate the minimum level that the cooling setpoint MAY be set to.

Refer to [Setpoint Limits](#) for constraints. If an attempt is made to set this attribute to a value which conflicts with setpoint values then those setpoints SHALL be adjusted by the minimum amount to permit this attribute to be set to the desired value. If an attempt is made to set this attribute to a value which is not consistent with the constraints and cannot be resolved by modifying setpoints then a response with the status code CONSTRAINT\_ERROR SHALL be returned.

#### 4.3.9.20. MaxCoolSetpointLimit Attribute

This attribute SHALL indicate the maximum level that the cooling setpoint MAY be set to.

Refer to [Setpoint Limits](#) for constraints. If an attempt is made to set this attribute to a value which conflicts with setpoint values then those setpoints SHALL be adjusted by the minimum amount to permit this attribute to be set to the desired value. If an attempt is made to set this attribute to a value which is not consistent with the constraints and cannot be resolved by modifying setpoints then a response with the status code CONSTRAINT\_ERROR SHALL be returned.

#### 4.3.9.21. MinSetpointDeadBand Attribute

On devices which support the AUTO feature, this attribute SHALL indicate the minimum difference between the Heat Setpoint and the Cool Setpoint.

Refer to [Setpoint Limits](#) for constraints.

|             |                                                                                                                                      |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | Prior to revision 8 of this cluster specification the value of this attribute was constrained to a range of 0°C to 2.5°C.            |
| <b>NOTE</b> | For backwards compatibility, this attribute is optionally writeable. However any writes to this attribute SHALL be silently ignored. |

#### 4.3.9.22. RemoteSensing Attribute

This attribute SHALL indicate when the local temperature, outdoor temperature and occupancy are being sensed by remote networked sensors, rather than internal sensors.

If the LTNE feature is present in the server, the LocalTemperature RemoteSensing bit value SHALL always report a value of 0.

If the LocalTemperature RemoteSensing bit is written with a value of 1 when the LTNE feature is present, the write SHALL fail and the server SHALL report a CONSTRAINT\_ERROR.

#### 4.3.9.23. ControlSequenceOfOperation Attribute

This attribute SHALL indicate the overall operating environment of the thermostat, and thus the possible system modes that the thermostat can operate in.

If an attempt is made to write to this attribute, the server SHALL silently ignore the write and the

Page 358







value of this attribute SHALL remain unchanged. This behavior is in place for backwards compatibility with existing thermostats.

#### 4.3.9.24. **SystemMode Attribute**

This attribute SHALL indicate the current operating mode of the thermostat. Its value SHALL be limited by the [ControlSequenceOfOperation](#) attribute.

#### 4.3.9.25. **ThermostatRunningMode Attribute**

This attribute SHALL indicate the running mode of the thermostat. This attribute uses the same values as [SystemModeEnum](#) but can only be Off, Cool or Heat. This attribute is intended to provide additional information when the thermostat's system mode is in auto mode.

#### 4.3.9.26. **StartOfWeek Attribute**

This attribute SHALL indicate the day of the week that this thermostat considers to be the start of week for weekly setpoint scheduling.

This attribute MAY be able to be used as the base to determine if the device supports weekly scheduling by reading the attribute. Successful response means that the weekly scheduling is supported.

#### 4.3.9.27. **NumberOfWeeklyTransitions Attribute**

This attribute SHALL indicate how many weekly schedule transitions the thermostat is capable of handling.

#### 4.3.9.28. **NumberOfDailyTransitions Attribute**

This attribute SHALL indicate how many daily schedule transitions the thermostat is capable of handling.

#### 4.3.9.29. **TemperatureSetpointHold Attribute**

This attribute SHALL indicate the temperature hold status on the thermostat. If hold status is on, the thermostat SHOULD maintain the temperature setpoint for the current mode until a system mode change. If hold status is off, the thermostat SHOULD follow the setpoint transitions specified by its internal scheduling program. If the thermostat supports setpoint hold for a specific duration, it SHOULD also implement the [TemperatureSetpointHoldDuration](#) attribute.

If the server supports a setpoint hold for a specific duration, it SHOULD also implement the [SetpointHoldExpiryTimestamp](#) attribute.

If this attribute is updated to SetpointHoldOn and the [TemperatureSetpointHoldDuration](#) has a non-null value and the [SetpointHoldExpiryTimestamp](#) is supported, the server SHALL update the [SetpointHoldExpiryTimestamp](#) with a value of current UTC timestamp, in seconds, plus the value in [TemperatureSetpointHoldDuration](#) multiplied by 60.

If this attribute is updated to SetpointHoldOff and the [SetpointHoldExpiryTimestamp](#) is supported, the server SHALL set the [SetpointHoldExpiryTimestamp](#) to null.



Page 359



#### 4.3.9.30. TemperatureSetpointHoldDuration Attribute

This attribute SHALL indicate the period in minutes for which a setpoint hold is active. Thermostats that support hold for a specified duration SHOULD implement this attribute. The null value indicates the field is unused. All other values are reserved.

If this attribute is updated to a non-null value and the [TemperatureSetpointHold](#) is set to `SetpointHoldOn` and the [SetpointHoldExpiryTimestamp](#) is supported, the server SHALL update [SetpointHoldExpiryTimestamp](#) with a value of current UTC timestamp, in seconds, plus the new value of this attribute multiplied by 60.

If this attribute is set to null and the [SetpointHoldExpiryTimestamp](#) is supported, the server SHALL set the [SetpointHoldExpiryTimestamp](#) to null.

#### 4.3.9.31. ThermostatProgrammingOperationMode Attribute

This attribute SHALL indicate the operational state of the thermostat's programming. The thermostat SHALL modify its programming operation when this attribute is modified by a client and update this attribute when its programming operation is modified locally by a user. The thermostat MAY support more than one active [ProgrammingOperationModeBitmap](#). For example, the thermostat MAY operate simultaneously in Schedule Programming Mode and Recovery Mode.

Thermostats which contain a schedule MAY use this attribute to control how that schedule is used, even if they do not support the [ScheduleConfiguration](#) feature.

When [ScheduleActive](#) is not set, the setpoint is altered only by manual up/down changes at the thermostat or remotely, not by internal schedule programming.

**NOTE**

Modifying the [ScheduleActive](#) bit does not clear or delete previous weekly schedule programming configurations.

#### 4.3.9.32. ThermostatRunningState Attribute

This attribute SHALL indicate the current relay state of the heat, cool, and fan relays.

Unimplemented outputs SHALL be treated as if they were Off.

#### 4.3.9.33. SetpointChangeSource Attribute

This attribute SHALL indicate the source of the current active [OccupiedCoolingSetpoint](#) or [OccupiedHeatingSetpoint](#) (i.e., who or what determined the current setpoint).

This attribute enables service providers to determine whether changes to setpoints were initiated due to occupant comfort, scheduled programming or some other source (e.g., electric utility or other service provider). Because automation services MAY initiate frequent setpoint changes, this attribute clearly differentiates the source of setpoint changes made at the thermostat.

#### 4.3.9.34. SetpointChangeAmount Attribute

This attribute SHALL indicate the delta between the current active [OccupiedCoolingSetpoint](#) or [OccupiedHeatingSetpoint](#) and the previous active setpoint. This attribute is meant to accompany

Page 360







the [SetpointChangeSource](#) attribute; devices implementing [SetpointChangeAmount](#) SHOULD also implement [SetpointChangeSource](#).

The null value indicates that the previous setpoint was unknown.

#### 4.3.9.35. **SetpointChangeSourceTimestamp** Attribute

This attribute SHALL indicate the time in UTC at which the [SetpointChangeAmount](#) attribute change was recorded.

#### 4.3.9.36. **OccupiedSetback** Attribute

This attribute SHALL indicate the amount that the Thermostat server will allow the [Calculated Local Temperature](#) to float above the [OccupiedCoolingSetpoint](#) (i.e., [OccupiedCoolingSetpoint](#) + [OccupiedSetback](#)) or below the [OccupiedHeatingSetpoint](#) setpoint (i.e., [OccupiedHeatingSetpoint](#) – [OccupiedSetback](#)) before initiating a state change to bring the temperature back to the user's desired setpoint. This attribute is sometimes also referred to as the "span."

The purpose of this attribute is to allow remote configuration of the span between the desired setpoint and the measured temperature to help prevent over-cycling and reduce energy bills, though this may result in lower comfort on the part of some users.

The null value indicates the attribute is unused.

If the Thermostat client attempts to write [OccupiedSetback](#) to a value greater than [OccupiedSetbackMax](#), the Thermostat server SHALL set its [OccupiedSetback](#) value to [OccupiedSetbackMax](#) and SHALL send a Write Attribute Response command with a Status Code field enumeration of SUCCESS response.

If the Thermostat client attempts to write [OccupiedSetback](#) to a value less than [OccupiedSetbackMin](#), the Thermostat server SHALL set its [OccupiedSetback](#) value to [OccupiedSetbackMin](#) and SHALL send a Write Attribute Response command with a Status Code field enumeration of SUCCESS response.

#### 4.3.9.37. **OccupiedSetbackMin** Attribute

This attribute SHALL indicate the minimum value that the Thermostat server will allow the [OccupiedSetback](#) attribute to be configured by a user.

The null value indicates the attribute is unused.

#### 4.3.9.38. **OccupiedSetbackMax** Attribute

This attribute SHALL indicate the maximum value that the Thermostat server will allow the [OccupiedSetback](#) attribute to be configured by a user.

The null value indicates the attribute is unused.

#### 4.3.9.39. **UnoccupiedSetback** Attribute

This attribute SHALL indicate the amount that the Thermostat server will allow the [Calculated](#)



Page 361



Local Temperature to float above the [UnoccupiedCoolingSetpoint](#) (i.e.,  $\text{UnoccupiedCoolingSetpoint} + \text{UnoccupiedSetback}$ ) or below the [UnoccupiedHeatingSetpoint](#) setpoint (i.e.,  $\text{UnoccupiedHeatingSetpoint} - \text{UnoccupiedSetback}$ ) before initiating a state change to bring the temperature back to the user's desired setpoint. This attribute is sometimes also referred to as the "span."

The purpose of this attribute is to allow remote configuration of the span between the desired setpoint and the measured temperature to help prevent over-cycling and reduce energy bills, though this may result in lower comfort on the part of some users.

The null value indicates the attribute is unused.

If the Thermostat client attempts to write [UnoccupiedSetback](#) to a value greater than [UnoccupiedSetbackMax](#), the Thermostat server SHALL set its [UnoccupiedSetback](#) value to [UnoccupiedSetbackMax](#) and SHALL send a Write Attribute Response command with a Status Code field enumeration of SUCCESS response.

If the Thermostat client attempts to write [UnoccupiedSetback](#) to a value less than [UnoccupiedSetbackMin](#), the Thermostat server SHALL set its [UnoccupiedSetback](#) value to [UnoccupiedSetbackMin](#) and SHALL send a Write Attribute Response command with a Status Code field enumeration of SUCCESS response.

#### 4.3.9.40. [UnoccupiedSetbackMin](#) Attribute

This attribute SHALL indicate the minimum value that the Thermostat server will allow the [UnoccupiedSetback](#) attribute to be configured by a user.

The null value indicates the attribute is unused.

#### 4.3.9.41. [UnoccupiedSetbackMax](#) Attribute

This attribute SHALL indicate the maximum value that the Thermostat server will allow the [UnoccupiedSetback](#) attribute to be configured by a user.

The null value indicates the attribute is unused.

#### 4.3.9.42. [EmergencyHeatDelta](#) Attribute

This attribute SHALL indicate the delta between the [Calculated Local Temperature](#) and the [OccupiedHeatingSetpoint](#) or [UnoccupiedHeatingSetpoint](#) attributes at which the Thermostat server will operate in emergency heat mode.

If the difference between the [Calculated Local Temperature](#) and [OccupiedCoolingSetpoint](#) or [UnoccupiedCoolingSetpoint](#) is greater than or equal to the [EmergencyHeatDelta](#) and the Thermostat server's [SystemMode](#) attribute is in a heating-related mode, then the Thermostat server SHALL immediately switch to the [SystemMode](#) attribute value that provides the highest stage of heating (e.g., emergency heat) and continue operating in that running state until the [OccupiedHeatingSetpoint](#) value is reached. For example:

- [Calculated Local Temperature](#) = 10.0°C

Page 362



- `OccupiedHeatingSetpoint` = 16.0°C
  - `EmergencyHeatDelta` = 2.0°C
- ⇒ `OccupiedHeatingSetpoint` - `Calculated Local Temperature` ≥? `EmergencyHeatDelta`
- ⇒ 16°C - 10°C ≥? 2°C
- ⇒ TRUE >>> Thermostat server changes its `SystemMode` to operate in 2<sup>nd</sup> stage or emergency heat mode

The purpose of this attribute is to provide Thermostat clients the ability to configure rapid heating when a setpoint is of a specified amount greater than the measured temperature. This allows the heated space to be quickly heated to the desired level set by the user.

#### 4.3.9.43. **ACType Attribute**

This attribute SHALL indicate the type of Mini Split `ACTypeEnum` of Mini Split AC is defined depending on how Cooling and Heating condition is achieved by Mini Split AC.

#### 4.3.9.44. **ACCapacity Attribute**

This attribute SHALL indicate capacity of Mini Split AC in terms of the format defined by the `ACCapacityFormat` attribute

#### 4.3.9.45. **ACRefrigerantType Attribute**

This attribute SHALL indicate type of refrigerant used within the Mini Split AC.

#### 4.3.9.46. **ACCompressorType Attribute**

This attribute SHALL indicate the type of compressor used within the Mini Split AC.

#### 4.3.9.47. **ACErrorCode Attribute**

This attribute SHALL indicate the type of errors encountered within the Mini Split AC.

#### 4.3.9.48. **ACLouverPosition Attribute**

This attribute SHALL indicate the position of Louver on the AC.

#### 4.3.9.49. **ACCoilTemperature Attribute**

This attribute SHALL indicate the temperature of the AC coil, as measured locally or remotely (over the network).

#### 4.3.9.50. **ACCapacityFormat Attribute**

This attribute SHALL indicate the format for the `ACCapacity` attribute.



Page 363



#### 4.3.9.51. PresetTypes Attribute

This attribute SHALL indicate the supported [PresetScenarioEnum](#) values, limits on how many presets can be created for each [PresetScenarioEnum](#), and whether or not a thermostat can transition automatically to a given scenario.

The list SHALL contain at least one entry.

The list SHALL NOT be larger than the number of supported [PresetScenarioEnum](#) values (maximum 7).

The list SHALL NOT contain any [PresetTypeStruct](#) entries with duplicate [PresetScenarioEnum](#) values.

#### 4.3.9.52. ScheduleTypes Attribute

This attribute SHALL indicate the supported SystemMode values for Schedules, limits on how many schedules can be created for each SystemMode value, and whether or not a given SystemMode value supports transitions to Presets, target setpoints, or both.

The list SHALL contain at least one entry.

The list SHALL NOT be larger than the number of supported schedule SystemMode values (maximum 3, since the data type only allows Auto, Heat and Cool).

The list SHALL NOT contain any [ScheduleTypeStruct](#) entries with duplicate [SystemModeEnum](#) values.

#### 4.3.9.53. NumberOfPresets Attribute

This attribute SHALL indicate the maximum number of [entries](#) supported by the Presets attribute.

#### 4.3.9.54. NumberOfSchedules Attribute

This attribute SHALL indicate the maximum number of [entries](#) supported by the Schedules attribute.

#### 4.3.9.55. NumberOfScheduleTransitions Attribute

This attribute SHALL indicate the maximum number of [transitions](#) per [Schedules](#) attribute entry.

#### 4.3.9.56. NumberOfScheduleTransitionPerDay Attribute

This attribute SHALL indicate the maximum number of [transitions](#) per day of the week supported by each Schedules attribute entry. If this value is null, there is no limit on the number of transitions per day.

#### 4.3.9.57. ActivePresetHandle Attribute

This attribute SHALL indicate the [PresetHandle](#) of the active preset. If this attribute is null, then there is no active preset.

#### 4.3.9.58. ActiveScheduleHandle Attribute

This attribute SHALL indicate the [ScheduleHandle](#) of the active schedule. A null value in this

Page 364



attribute indicates that there is no active schedule.

#### 4.3.9.59. Presets Attribute

This attribute SHALL contain the current list of configured [presets](#).

On receipt of a write request:

1. If the [PresetHandle](#) field is null, the [PresetStruct](#) SHALL be treated as an added preset, and the device SHALL create a new unique value for the [PresetHandle](#) field.
  - a. If the [BuiltIn](#) field is true, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
2. If the [PresetHandle](#) field is not null, the [PresetStruct](#) SHALL be treated as a modification of an existing preset.
  - a. If the value of the [PresetHandle](#) field does not match any of the existing [presets](#), a response with the status code NOT\_FOUND SHALL be returned.
  - b. If the value of the [PresetHandle](#) field is duplicated on multiple [presets](#) in the updated list, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
  - c. If the [BuiltIn](#) field is true, and the [PresetStruct](#) in the current value with a matching [PresetHandle](#) field has a [BuiltIn](#) field set to false, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
  - d. If the [BuiltIn](#) field is false, and the [PresetStruct](#) in the current value with a matching [PresetHandle](#) field has a [BuiltIn](#) field set to true, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
3. If the specified [PresetScenarioEnum](#) value does not exist in [PresetTypes](#), a response with the status code CONSTRAINT\_ERROR SHALL be returned.
4. If the [Name](#) is set, but the associated [PresetTypeStruct](#) does not have the [SupportsNames](#) bit set, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
5. If appending the received [PresetStruct](#) to the pending list of Presets would cause the total number of pending [presets](#) to exceed the value of the [NumberOfPresets](#) attribute, a response with the status code RESOURCE\_EXHAUSTED SHALL be returned.
6. If appending the received [PresetStruct](#) to the pending list of Presets would cause the total number of pending [presets](#) whose [PresetScenario](#) field matches the appended preset's [PresetScenario](#) field to exceed the value of the [NumberOfPresets](#) field on the [PresetTypeStruct](#) whose [PresetScenario](#) matches the appended preset's [PresetScenario](#) field, a response with the status code RESOURCE\_EXHAUSTED SHALL be returned.
7. Otherwise, the write SHALL be pended until receipt of a commit request, and the status code SUCCESS SHALL be returned.
  - a. If the [BuiltIn](#) field is null:
    - i. If there is a [PresetStruct](#) in the current value with a matching [PresetHandle](#) field, the [BuiltIn](#) field on the pending [PresetStruct](#) SHALL be set to the value of the [BuiltIn](#) on the matching [PresetStruct](#).
    - ii. Otherwise, the [BuiltIn](#) field on the pending [PresetStruct](#) SHALL be set to false.



Page 365



On an attempt to commit, the status of this attribute SHALL be determined as follows:

1. For all existing **presets**:

- a. If, after applying all pending changes, the updated value of the **Presets** attribute would not contain a **PresetStruct** with a matching **PresetHandle** field, indicating the removal of the **PresetStruct**, the server SHALL check for invalid removal of the **PresetStruct**:
  - i. If the **BuiltIn** field is true on the removed **PresetStruct**, the attribute status SHALL be CONSTRAINT\_ERROR.
  - ii. If the MSCH feature is supported and the removed **PresetHandle** would be referenced by any **PresetHandle** on any **ScheduleTransitionStruct** on any **ScheduleStruct** in the updated value of the **Schedules** attribute, the attribute status SHALL be INVALID\_IN\_STATE.
  - iii. If the removed **PresetHandle** is equal to the value of the **ActivePresetHandle** attribute, the attribute status SHALL be INVALID\_IN\_STATE.
2. Otherwise, the attribute status SHALL be SUCCESS.

#### 4.3.9.60. Schedules Attribute

This attribute SHALL contain a list of **ScheduleStructs**.

On receipt of a write request:

1. For all **schedules** in the write request:

- a. If the **ScheduleHandle** field is null, the **ScheduleStruct** SHALL be treated as an added schedule, and the device SHALL create a new unique value for the **ScheduleHandle** field.
  - i. If the **BuiltIn** field is true, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
- b. Otherwise, if the **ScheduleHandle** field is not null, the **ScheduleStruct** SHALL be treated as a modification of an existing schedule.
  - i. If the value of the **ScheduleHandle** field does not match any of the existing **schedules**, a response with the status code NOT\_FOUND SHALL be returned.
  - ii. If the **BuiltIn** field is true, and the **ScheduleStruct** in the current value with a matching **ScheduleHandle** field has a **BuiltIn** field set to false, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
  - iii. If the **BuiltIn** field is false, and the **ScheduleStruct** in the current value with a matching **ScheduleHandle** field has a **BuiltIn** field set to true, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
- c. If the specified **SystemMode** does not exist in **ScheduleTypes**, a response with the status code CONSTRAINT\_ERROR SHALL be returned.
- d. If the number of **transitions** exceeds the **NumberOfScheduleTransitions** value, a response with the status code RESOURCE\_EXHAUSTED SHALL be returned.
- e. If the value of the **NumberOfScheduleTransitionPerDay** attribute is not null, and the number of **transitions** on any single day of the week exceeds the **NumberOfScheduleTransitionPerDay** value, a response with the status code RESOURCE\_EXHAUSTED SHALL be returned.

Page 366







- f. If the `PresetHandle` field is present, but the associated `ScheduleTypeStruct` does not have the `SupportsPresets` bit set, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
  - g. If the `PresetHandle` field is present, but after applying all pending changes, the `Presets` attribute would not contain a `PresetStruct` whose `PresetHandle` field matches the value of the `PresetHandle` field, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
  - h. If the `Name` is set, but the associated `ScheduleTypeStruct` does not have the `SupportsNames` bit set, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
  - i. For all `transitions` in all `schedules` in the write request:
    - i. If the `PresetHandle` field is present, but the `ScheduleTypeStruct` matching the value of the `SystemMode` field on the encompassing `ScheduleStruct` does not have the `SupportsPresets` bit set, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
  - j. If the `PresetHandle` field is present, but after applying all pending changes, the `Presets` attribute would not contain a `PresetStruct` whose `PresetHandle` field matches the value of the `PresetHandle` field, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
    - i. If the `SystemMode` field is present, but the `ScheduleTypeStruct` matching the value of the `SystemMode` field on the encompassing `ScheduleStruct` does not have the `SupportsSetpoints` bit set, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
    - ii. If the `SystemMode` field is has a value of `SystemModeOff`, but the `ScheduleTypeStruct` matching the value of the `SystemMode` field on the encompassing `ScheduleStruct` does not have the `SupportsOff` bit set, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
  - k. If the `HeatingSetpoint` field is present, but the `ScheduleTypeStruct` matching the value of the `SystemMode` field on the encompassing `ScheduleStruct` does not have the `SupportsSetpoints` bit set, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
  - l. If the `CoolingSetpoint` field is present, but the `ScheduleTypeStruct` matching the value of the `SystemMode` field on the encompassing `ScheduleStruct` does not have the `SupportsSetpoints` bit set, a response with the status code `CONSTRAINT_ERROR` SHALL be returned.
2. If appending the received `ScheduleStruct` to the pending list of Schedules would cause the total number of pending `schedules` to exceed the value of the `NumberOfSchedules` attribute, a response with the status code `RESOURCE_EXHAUSTED` SHALL be returned.
3. If appending the received `ScheduleStruct` to the pending list of Schedules would cause the total number of pending `schedules` whose `SystemMode` field matches the appended schedule's `SystemMode` field to exceed the value of the `NumberOfSchedules` field on the `ScheduleTypeStruct` whose `SystemMode` field matches the appended schedule's `SystemMode` field, a response with the status code `RESOURCE_EXHAUSTED` SHALL be returned.
4. Otherwise, the write SHALL be pended until receipt of a commit request, and the attribute status SHALL be `SUCCESS`.
- a. If the `BuiltIn` field is null:
    - i. If there is a `ScheduleStruct` in the current value with a matching `ScheduleHandle` field,




Page 367



the [BuiltIn](#) field on the pending [ScheduleStruct](#) SHALL be set to the value of the [BuiltIn](#) on the matching [ScheduleStruct](#).

- ii. Otherwise, the [BuiltIn](#) field on the pending [ScheduleStruct](#) SHALL be set to false.

On an attempt to commit, the status of this attribute SHALL be determined as follows:

1. For all existing [schedules](#):

- a. If, after applying all pending changes, the updated value of the [Schedules](#) attribute would not contain a [ScheduleStruct](#) with a matching [ScheduleHandle](#) field, indicating the removal of the [ScheduleStruct](#), the server SHALL check for invalid removal of the [ScheduleStruct](#):

- i. If the [BuiltIn](#) field is true on the removed [ScheduleStruct](#), the attribute status SHALL be `CONSTRAINT_ERROR`.
- ii. If the removed [ScheduleHandle](#) is equal to the value of the [ActiveScheduleHandle](#) attribute, the attribute status SHALL be `INVALID_IN_STATE`.

2. Otherwise, the attribute status SHALL be `SUCCESS`.

#### 4.3.9.61. [SetpointHoldExpiryTimestamp](#) Attribute

If there is a known time when the [TemperatureSetpointHold](#) SHALL be cleared, this attribute SHALL contain the timestamp in UTC indicating when that will happen. If there is no such known time, this attribute SHALL be null.

If the [TemperatureSetpointHold](#) is set to [SetpointHoldOn](#) and the [TemperatureSetpointHoldDuration](#) is set to null, this attribute SHALL be set to null indicating there is a hold on the Thermostat without a duration.

If the [TemperatureSetpointHold](#) is set to [SetpointHoldOff](#), this attribute SHALL be set to null indicating there is no hold on the Thermostat.

#### 4.3.10. Commands

| ID   | Name                                                 | Direction                   | Response                                       | Access | Conformance |
|------|------------------------------------------------------|-----------------------------|------------------------------------------------|--------|-------------|
| 0x00 | <a href="#">Set-<br/>pointRaiseLo<br/>wer</a>        | client $\Rightarrow$ server | Y                                              | O      | M           |
| 0x01 | <a href="#">SetWeeklySch<br/>edule</a>               | client $\Rightarrow$ server | Y                                              | M      | SCH         |
| 0x02 | <a href="#">GetWeeklySch<br/>edule</a>               | client $\Rightarrow$ server | <a href="#">GetWeeklySche<br/>duleResponse</a> | O      | SCH         |
| 0x00 | <a href="#">GetWeeklySch<br/>eduleRe-<br/>sponse</a> | client $\Leftarrow$ server  | N                                              |        | SCH         |
| 0x03 | <a href="#">Clear-<br/>WeeklySch-<br/>edule</a>      | client $\Rightarrow$ server | Y                                              | M      | SCH         |

Page 368



| ID   | Name                            | Direction                   | Response | Access | Conformance |
|------|---------------------------------|-----------------------------|----------|--------|-------------|
| 0x05 | <b>SetActiveScheduleRequest</b> | client $\Rightarrow$ server | Y        | O      | MSCH        |
| 0x06 | <b>SetActivePre-setRequest</b>  | client $\Rightarrow$ server | Y        | O      | PRES        |

#### 4.3.10.1. SetpointRaiseLower Command

This command will raise or lower the setpoint based on the provided values.

| ID | Name          | Type                        | Constraint | Quality | Fallback | Conformance |
|----|---------------|-----------------------------|------------|---------|----------|-------------|
| 0  | <b>Mode</b>   | Set-pointRaiseLowerModeEnum | desc       |         |          | M           |
| 1  | <b>Amount</b> | int8                        | all        |         |          | M           |

##### 4.3.10.1.1. Mode Field

The field SHALL specify which setpoints are to be adjusted.

##### 4.3.10.1.1.1. Heat Value

If the server does not support the HEAT feature then it SHALL respond with INVALID\_COMMAND. If the server supports the AUTO feature and the resulting setpoint would be invalid solely due to [MinSetpointDeadBand](#) then the Cooling setpoint SHALL be increased sufficiently to maintain the deadband.

##### 4.3.10.1.1.2. Cool Value

If the server does not support the COOL feature then it SHALL respond with INVALID\_COMMAND. If the server supports the AUTO feature and the resulting setpoint would be invalid solely due to [MinSetpointDeadBand](#) then the Heating setpoint SHALL be decreased sufficiently to maintain the deadband.

##### 4.3.10.1.1.3. Both Value

The client MAY indicate Both regardless of the server feature support. The server SHALL only adjust the setpoint that it supports and not respond with an error.

##### 4.3.10.1.2. Amount Field

This field SHALL indicate the amount (possibly negative) that should be added to the setpoint(s), in steps of 0.1°C.



Page 369



#### 4.3.10.1.3. Effect on Receipt

Upon receipt, the attributes for the indicated setpoint(s) SHALL have the amount specified in the Amount field added to them. If the resulting value is outside the limits imposed by [MinCoolSetpointLimit](#), [MaxCoolSetpointLimit](#), [MinHeatSetpointLimit](#) and [MaxHeatSetpointLimit](#), the value is clamped to those limits. This is not considered an error condition.

#### 4.3.10.2. SetWeeklySchedule Command

This command is used to update the thermostat weekly setpoint schedule from a management system. If the thermostat already has a weekly setpoint schedule programmed, then it SHOULD replace each daily setpoint set as it receives the updates from the management system. For example, if the thermostat has 4 setpoints for every day of the week and is sent a SetWeeklySchedule command with one setpoint for Saturday then the thermostat SHOULD remove all 4 setpoints for Saturday and replace those with the updated setpoint but leave all other days unchanged. If the schedule is larger than what fits in one frame or contains more than 10 transitions, the schedule SHALL then be sent using multiple SetWeeklySchedule Commands.

| ID | Name                           | Type                                   | Constraint | Quality | Fallback | Conformance |
|----|--------------------------------|----------------------------------------|------------|---------|----------|-------------|
| 0  | NumberOfTransitionsForSequence | uint8                                  | all        |         |          | M           |
| 1  | DayOfWeekForSequence           | Schedule-DayOfWeek-Bitmap              | desc       |         |          | M           |
| 2  | ModeForSequence                | Schedule-ModeBitmap                    | desc       |         |          | M           |
| 3  | Transitions                    | list[WeeklySchedule-Transition-Struct] | max 10     |         |          | M           |

##### 4.3.10.2.1. NumberOfTransitionsForSequence Field

This field SHALL indicate how many individual transitions to expect for this sequence of commands. If a device supports more than 10 transitions in its schedule they can send this by sending more than 1 “Set Weekly Schedule” command, each containing the separate information that the device needs to set.

##### 4.3.10.2.2. DayOfWeekForSequence Field

This field SHALL represent the day of the week at which all the transitions within the payload of the command SHOULD be associated to. This field is a bitmap and therefore the associated setpoint could overlap onto multiple days (you could set one transition time for all “week days” or whatever combination of days the implementation requests).

Page 370







Each setpoint transition will begin with the day of week for this transition. There can be up to 10 transitions for each command.

#### 4.3.10.2.3. ModeForSequence Field

This field SHALL indicate how the application decodes the setpoint fields of each transition in the Transitions list.

If the HeatSetpointPresent bit is On, the HeatSetpoint field SHALL NOT be null in **every** entry of the Transitions list.

If the HeatSetpointPresent bit is Off, the HeatSetpoint field SHALL be null in **every** entry of the Transitions list.

If the CoolSetpointPresent bit is On, the CoolSetpoint field SHALL NOT be null in **every** entry of the Transitions list.

If the CoolSetpointPresent bit is Off, the CoolSetpoint field SHALL be null in **every** entry of the Transitions list.

At least one of the bits in the Mode For Sequence byte SHALL be on.

Both bits must be respected, even if the HEAT or COOL feature is not supported, to ensure the command is decoded and handled correctly.

#### 4.3.10.2.4. Transitions Field

This field SHALL contain the list of setpoint transitions used to update the specified daily schedules

#### 4.3.10.2.5. Effect on Receipt

Upon receipt, the weekly schedule for updating setpoints SHALL be stored in the thermostat and SHOULD begin at the time of receipt. A status code SHALL be sent in response.

When a command is received that requires a total number of transitions greater than the device supports, the status of the response SHALL be INSUFFICIENT\_SPACE.

When any of the setpoints sent in the sequence is out of range (AbsMin/MaxSetPointLimit), or when the Mode for Sequence field includes a mode not supported by the device, the status of the response SHALL be CONSTRAINT\_ERROR and no setpoints from the entire sequence SHOULD be used.

When an overlapping transition is detected, the status of the response SHALL be FAILURE.

When a device which does not support multiple days in a command receives a command with more than one bit set in the DayOfWeekForSequence field, or when a device which does not support multiple modes in a command receives a command with more than one bit set in the ModeForSequence field, or when the contents of the Transitions field does not agree with NumberOfTransitionsForSequence, DayOfWeekForSequence or ModeForSequence, the status of the response SHALL be INVALID\_COMMAND.

When the transitions could be added successfully, the status of the response SHALL be SUCCESS.




Page 371



#### 4.3.10.3. GetWeeklySchedule Command

This command will return the weekly schedule for the values provided.

| ID | Name         | Type                      | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------------|------------|---------|----------|-------------|
| 0  | DaysToReturn | Schedule-DayOfWeek-Bitmap | desc       |         |          | M           |
| 1  | ModeToReturn | Schedule-ModeBitmap       | desc       |         |          | M           |

##### 4.3.10.3.1. DaysToReturn Field

This field SHALL indicate the number of days the client would like to return the setpoint values for and could be any combination of single days or the entire week.

##### 4.3.10.3.2. ModeToReturn Field

This field SHALL indicate the mode the client would like to return the set point values for and could be any combination of heat only, cool only or heat & cool.

##### 4.3.10.3.3. Effect on Receipt

Upon receipt, the unit SHOULD send in return the Get Weekly Schedule Response command. The Days to Return and Mode to Return fields are defined as bitmask for the flexibility to support multiple days and multiple modes within one command. If thermostat cannot handle incoming command with multiple days and/or multiple modes within one command, it SHALL send default response of INVALID\_COMMAND in return.

#### 4.3.10.4. GetWeeklyScheduleResponse Command

This command has the same payload format as the Set Weekly Schedule.

| ID | Name                            | Type                      | Constraint | Quality | Fallback | Conformance |
|----|---------------------------------|---------------------------|------------|---------|----------|-------------|
| 0  | NumberOfTransitions-ForSequence | uint8                     | all        |         |          | M           |
| 1  | DayOfWeek-ForSequence           | Schedule-DayOfWeek-Bitmap | desc       |         |          | M           |
| 2  | ModeForSequence                 | Schedule-ModeBitmap       | desc       |         |          | M           |

Page 372



| ID | Name        | Type                                   | Constraint | Quality | Fallback | Conformance |
|----|-------------|----------------------------------------|------------|---------|----------|-------------|
| 3  | Transitions | list[WeeklySchedule-Transition-Struct] | max 10     |         |          | M           |

#### 4.3.10.5. ClearWeeklySchedule Command

This command is used to clear the weekly schedule. The Clear weekly schedule has no payload.

Upon receipt, all transitions currently stored SHALL be cleared and a default response of SUCCESS SHALL be sent in response. There are no error responses to this command.

#### 4.3.10.6. SetActiveScheduleRequest Command

This command will set the active schedule to the provided schedule handle.

| ID | Name            | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------|------------|---------|----------|-------------|
| 0  | Schedule-Handle | octstr | max 16     |         |          | M           |

##### 4.3.10.6.1. ScheduleHandle Field

This field SHALL specify the value of the [ScheduleHandle](#) field on the [ScheduleStruct](#) to be made active.

##### 4.3.10.6.2. Effect on Receipt

Upon receipt, if the [Schedules](#) attribute contains a [ScheduleStruct](#) whose [ScheduleHandle](#) field matches the value of the [ScheduleHandle](#) field, the server SHALL set the thermostat's [ActiveScheduleHandle](#) attribute to the value of the [ScheduleHandle](#) field.

Otherwise, the server SHALL return a status code of INVALID\_COMMAND.

#### 4.3.10.7. SetActivePresetRequest Command

This command will set the active preset to the provided preset handle.

| ID | Name          | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------------|--------|------------|---------|----------|-------------|
| 0  | Pre-setHandle | octstr | max 16     | X       |          | M           |

##### 4.3.10.7.1. PresetHandle Field

This field SHALL specify the value of the [PresetHandle](#) field on the [PresetStruct](#) to be made active. If the field is set to null, that indicates there should be no active preset.



Page 373



#### 4.3.10.7.2. Effect on Receipt

Upon receipt of this command,

1. If the [PresetHandle](#) field is null, the server SHALL clear the [ActivePresetHandle](#) attribute by setting it to null.
2. Otherwise,
  - a. If this command is received with a [PresetHandle](#) such that the [Presets](#) attribute does not contain a [PresetStruct](#) whose [PresetHandle](#) field matches the value of the [PresetHandle](#), the server SHALL return a status code of INVALID\_COMMAND.
  - b. The server SHALL set the [ActivePresetHandle](#) attribute to the value of the [PresetHandle](#) field.
3. The server SHALL return a status code of SUCCESS.

## 4.4. Fan Control Cluster

This cluster specifies an interface to control the speed of a fan.

### 4.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                             |
|----------|-----------------------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added                                        |
| 2        | New data model format and notation; Percent, speed and motion settings; General cleanup |
| 3        | Addition of AirflowDirection and Step command                                           |
| 4        | Change conformance for FanModeSequenceEnum                                              |
| 5        | Clarified attribute usage, added conformance column                                     |

### 4.4.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | FAN       |

### 4.4.3. Cluster ID

| ID     | Name        |
|--------|-------------|
| 0x0202 | Fan Control |

Page 374







#### 4.4.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature          | Conformance | Summary                                  |
|-----|------|------------------|-------------|------------------------------------------|
| 0   | SPD  | MultiSpeed       | 0           | 0-SpeedMax Fan Speeds                    |
| 1   | AUT  | Auto             | 0           | Automatic mode supported for fan speed   |
| 2   | RCK  | Rocking          | 0           | Rocking movement supported               |
| 3   | WND  | Wind             | 0           | Wind emulation supported                 |
| 4   | STEP | Step             | 0           | Step command supported                   |
| 5   | DIR  | AirflowDirection | 0           | Airflow Direction attribute is supported |

##### 4.4.4.1. MultiSpeed Feature

Legacy Fan Control cluster revision 0-1 defined 3 speeds (low, medium and high) plus automatic speed control but left it up to the implementer to decide what was supported. Therefore, it is assumed that legacy client implementations are capable of determining, from the server, the number of speeds supported between 1, 2, or 3, and whether automatic speed control is supported.

The [MultiSpeed](#) feature includes attributes that support a running fan speed value from 0 to SpeedMax.

See [Section 4.4.6.6.1, “Speed Rules”](#) for more details.

#### 4.4.5. Data Types

##### 4.4.5.1. RockBitmap Type

This data type is derived from map8.

| Bit | Name                 | Summary                     | Conformance |
|-----|----------------------|-----------------------------|-------------|
| 0   | <b>RockLeftRight</b> | Indicate rock left to right | M           |
| 1   | <b>RockUpDown</b>    | Indicate rock up and down   | M           |
| 2   | <b>RockRound</b>     | Indicate rock around        | M           |



Page 375



#### 4.4.5.2. WindBitmap Type

This data type is derived from map8.

| Bit | Name        | Summary               | Conformance |
|-----|-------------|-----------------------|-------------|
| 0   | SleepWind   | Indicate sleep wind   | M           |
| 1   | NaturalWind | Indicate natural wind | M           |

##### 4.4.5.2.1. SleepWind Bit

The fan speed, based on current settings, SHALL gradually slow down to a final minimum speed. For this process, the sequence, speeds and duration are MS.

##### 4.4.5.2.2. NaturalWind Bit

The fan speed SHALL vary to emulate natural wind. For this setting, the sequence, speeds and duration are MS.

#### 4.4.5.3. StepDirectionEnum Type

This data type is derived from enum8.

| Value | Name     | Summary                            | Conformance |
|-------|----------|------------------------------------|-------------|
| 0     | Increase | Step moves in increasing direction | M           |
| 1     | Decrease | Step moves in decreasing direction | M           |

#### 4.4.5.4. AirflowDirectionEnum Type

This data type is derived from enum8.

| Value | Name    | Summary                             | Conformance |
|-------|---------|-------------------------------------|-------------|
| 0     | Forward | Airflow is in the forward direction | M           |
| 1     | Reverse | Airflow is in the reverse direction | M           |

#### 4.4.5.5. FanModeEnum Type

This data type is derived from enum8.

| Value | Name | Summary             | Conformance |
|-------|------|---------------------|-------------|
| 0     | Off  | Fan is off          | M           |
| 1     | Low  | Fan using low speed | O           |

Page 376



| Value | Name          | Summary                 | Conformance |
|-------|---------------|-------------------------|-------------|
| 2     | <b>Medium</b> | Fan using medium speed  | [Low]       |
| 3     | <b>High</b>   | Fan using high speed    | M           |
| 4     | <b>On</b>     |                         | D           |
| 5     | <b>Auto</b>   | Fan is using auto mode  | AUT         |
| 6     | <b>Smart</b>  | Fan is using smart mode | D           |

#### 4.4.5.6. FanModeSequenceEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                                 | Conformance |
|-------|--------------------------|---------------------------------------------------------|-------------|
| 0     | <b>OffLowMedHigh</b>     | Fan is capable of off, low, medium and high modes       | ![AUT].a    |
| 1     | <b>OffLowHigh</b>        | Fan is capable of off, low and high modes               | ![AUT].a    |
| 2     | <b>OffLowMedHighAuto</b> | Fan is capable of off, low, medium, high and auto modes | [AUT].b     |
| 3     | <b>OffLowHighAuto</b>    | Fan is capable of off, low, high and auto modes         | [AUT].b     |
| 4     | <b>OffHighAuto</b>       | Fan is capable of off, high and auto modes              | [AUT].b     |
| 5     | <b>OffHigh</b>           | Fan is capable of off and high modes                    | ![AUT].a    |

#### 4.4.6. Attributes

| ID     | Name                   | Type                                | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------|-------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>FanMode</b>         | <a href="#">FanModeEnum</a>         | desc       | N       |          | RW VO  | M           |
| 0x0001 | <b>FanModeSequence</b> | <a href="#">FanModeSequenceEnum</a> | all        | F       |          | R V    | M           |




Page 377



| ID     | Name                    | Type                                 | Constraint   | Quality | Fallback | Access | Conformance |
|--------|-------------------------|--------------------------------------|--------------|---------|----------|--------|-------------|
| 0x0002 | <b>PercentSetting</b>   | percent                              | max 100      | X       |          | RW VO  | M           |
| 0x0003 | <b>PercentCurrent</b>   | percent                              | max 100      |         |          | R V    | M           |
| 0x0004 | <b>SpeedMax</b>         | uint8                                | 1 to 100     | F       |          | R V    | SPD         |
| 0x0005 | <b>SpeedSetting</b>     | uint8                                | max SpeedMax | X       |          | RW VO  | SPD         |
| 0x0006 | <b>SpeedCurrent</b>     | uint8                                | max SpeedMax | P       |          | R V    | SPD         |
| 0x0007 | <b>RockSupport</b>      | <a href="#">Rock-Bitmap</a>          | min 1        | F       |          | R V    | RCK         |
| 0x0008 | <b>RockSetting</b>      | <a href="#">Rock-Bitmap</a>          | desc         | P       |          | RW VO  | RCK         |
| 0x0009 | <b>WindSupport</b>      | <a href="#">Wind-Bitmap</a>          | min 1        | F       |          | R V    | WND         |
| 0x000A | <b>WindSetting</b>      | <a href="#">Wind-Bitmap</a>          | desc         | P       |          | RW VO  | WND         |
| 0x000B | <b>AirflowDirection</b> | <a href="#">AirflowDirectionEnum</a> | all          | P       |          | RW VO  | DIR         |

#### 4.4.6.1. FanMode Attribute

This attribute SHALL indicate the current speed mode of the fan.

This attribute SHALL be set to one of the values in [FanModeEnum](#) supported by the server as indicated in the [FanModeSequence](#) attribute. The Low value SHALL be supported if and only if the [FanModeSequence](#) attribute value is less than 4. The Medium value SHALL be supported if and only if the [FanModeSequence](#) attribute value is 0 or 2.

This attribute MAY be written by a client to request a different fan mode. The server SHALL return `INVALID_IN_STATE` to indicate that the fan is not in a state where this attribute can be changed to the requested value.

The server MAY have values that this attribute can never be set to or that will be ignored by the server. For example, where this cluster appears on the same or another endpoint as other clusters with a system dependency, for example the Thermostat cluster, attempting to set this attribute to Off may not be allowed by the system.

If an attempt is made to set this attribute to a value not supported by the server as indicated in the [FanModeSequence](#) attribute, the server SHALL respond with `CONSTRAINT_ERROR`.

Page 378



When this attribute is successfully written to, the [PercentSetting](#) and [SpeedSetting](#) (if present) attributes SHALL be set to appropriate values, as defined by [Section 4.4.6.3.1, “Percent Rules”](#) and [Section 4.4.6.6.1, “Speed Rules”](#) respectively, unless otherwise specified below.

When this attribute is set to any valid value, the [PercentCurrent](#) and [SpeedCurrent](#) (if present) attributes SHALL indicate the actual currently operating fan speed, unless otherwise specified below.

#### 4.4.6.1.1. Off Value

Successfully setting the attribute value to Off SHALL set the values of these attributes to 0 (zero):

- [PercentSetting](#)
- [PercentCurrent](#)
- [SpeedSetting](#) (if present)
- [SpeedCurrent](#) (if present)

#### 4.4.6.1.2. Auto Value

Successfully setting the attribute value to Auto SHALL set the values of these attributes to null:

- [PercentSetting](#)
- [SpeedSetting](#) (if present)

These attributes SHALL continue to indicate the current state of the fan while this attribute value is Auto:

- [PercentCurrent](#)
- [SpeedCurrent](#) (if present)

#### 4.4.6.1.3. On Value

If a client attempts to write a value of On, the attribute SHALL be set to High.

#### 4.4.6.1.4. Smart Value

If a client attempts to write a value of Smart, this attribute SHALL be set to Auto if the AUT feature is supported, otherwise the attribute SHALL be set to High.

### 4.4.6.2. FanModeSequence Attribute

This attribute indicates the fan speed ranges that SHALL be supported by the server.

### 4.4.6.3. PercentSetting Attribute

This attribute SHALL indicate the speed setting for the fan with a value of 0 indicating that the fan is off and a value of 100 indicating that the fan is set to run at its maximum speed. If the [FanMode](#) attribute is set to Auto, the value of this attribute SHALL be set to null.

This attribute MAY be written to by a client to indicate a new fan speed. If a client writes null to this



Page 379



attribute, the attribute value SHALL NOT change. If the fan is in a state where this attribute cannot be changed to the requested value, the server SHALL return INVALID\_IN\_STATE.

When this attribute is successfully written, the server SHALL set the value of the [FanMode](#) and [SpeedSetting](#) (if present) attributes to values that abide by the mapping requirements listed below.

#### 4.4.6.3.1. Percent Rules

It is up to the server implementation to map between ranges of the [PercentSetting](#) attribute, the [SpeedSetting](#) (if present) attribute, and the [FanMode](#) attribute enumerated values that are supported as indicated in the [FanModeSequence](#) attribute per the requirements below.

There SHALL be a mapping between the values of the [FanMode](#) attribute and the values of this attribute by dividing the domain of values of this attribute into ranges as follows:

- The ranges SHALL be non-overlapping, contiguous, and in ascending order.
- Every value from 0 to 100 SHALL be in exactly 1 range.
- Every value in a lower range shall be less than every value in any higher range.
- The value 0 (zero) in this attribute SHALL be in a range by itself. This range SHALL map to Off.
- If Auto is supported by the server, the null value SHALL be in a range by itself. This range SHALL map to Auto.
- There shall be a one-to-one mapping between each range and each value in [FanMode](#).
- Every range SHALL map to a greater value in the [FanMode](#) attribute than all lower-valued ranges.

The following table illustrates an example of such a mapping. The actual mapping provided by the server is determined by the manufacturer subject to the rules mandated in this specification. Note that the values in this example are contiguous, non-overlapping and span from 0 to 100 with no missing values. Note also that each range appears in an ascending order, 0 appears by itself in a range that maps to Off, and null appears by itself in a range that maps to Auto.

| Attribute      | Values |         |          |           |      |
|----------------|--------|---------|----------|-----------|------|
| FanMode        | Off    | Low     | Medium   | High      | Auto |
| PercentSetting | 0      | 1 to 33 | 34 to 66 | 67 to 100 | null |

If a client successfully sets the [FanMode](#) attribute, the server SHALL set the [PercentSetting](#) attribute to some value within the range which maps to the [FanMode](#) setting. If no such value exists, the attribute value SHALL NOT change. If a client successfully sets the [PercentSetting](#) attribute, the server SHALL set the [FanMode](#) attribute to the value of the corresponding range, and the [SpeedSetting](#) attribute (if present) according to the equation below. If a client successfully sets the [PercentSetting](#) attribute to 0, the server SHALL set the [FanMode](#) attribute to Off and the [SpeedSetting](#) (if present) attribute to 0.

If the [MultiSpeed](#) feature is supported, the value of the [SpeedSetting](#) and [SpeedCurrent](#) (speed) attributes SHALL be calculated from the [PercentSetting](#) or [PercentCurrent](#) (percent) attributes respectively using the following formula:

Page 380



- $\text{speed} = \text{ceil}(\text{SpeedMax} * (\text{percent} * 0.01))$

For example: If the SpeedMax attribute is 42 (42 speed fan) and PercentSetting is changed to 25, then [SpeedSetting](#) and [SpeedCurrent](#) become 11 (rounding up 10.5).

#### 4.4.6.4. PercentCurrent Attribute

This attribute SHALL indicate the actual currently operating fan speed, or zero to indicate that the fan is off. There MAY be a temporary mismatch between the value of this attribute and the value of the [PercentSetting](#) attribute due to other system requirements or constraints that would not allow the fan to operate at the requested setting.

For example, if the value of this attribute is currently 50%, and the [PercentSetting](#) attribute is newly set to 25%, the value of this attribute MAY stay above 25% for a period necessary to dissipate internal heat, maintain product operational safety, etc.

When the value of the [FanMode](#) attribute is AUTO, the value of this attribute MAY vary across the range over time.

See [Section 4.4.6.3.1, “Percent Rules”](#) for more details.

#### 4.4.6.5. SpeedMax Attribute

This attribute SHALL indicate the maximum value to which the [SpeedSetting](#) attribute can be set.

#### 4.4.6.6. SpeedSetting Attribute

This attribute SHALL indicate the speed setting for the fan. This attribute MAY be written by a client to indicate a new fan speed. If the [FanMode](#) attribute is set to Auto, the value of this attribute SHALL be set to null.

The server SHALL support all values between 0 and [SpeedMax](#).

If a client writes null to this attribute, the attribute value SHALL NOT change. If the fan is in a state where this attribute cannot be changed to the requested value, the server SHALL return `INVALID_IN_STATE`.

When this attribute is successfully written to, the server SHALL set the value of the [FanMode](#) and [PercentSetting](#) attributes to values that abide by the mapping requirements listed below.

##### 4.4.6.6.1. Speed Rules

It is up to the server implementation to map between ranges of the [SpeedSetting](#) attribute, the [PercentSetting](#) attribute, and the [FanMode](#) attribute enumerated values that are supported as indicated in the [FanModeSequence](#) attribute per the requirements below.

There SHALL be a mapping between the values of the [FanMode](#) attribute and the values of this attribute by dividing the domain of values of this attribute into ranges as follows:

- The ranges SHALL be non-overlapping, contiguous, and in ascending order.



Page 381



- Every value from 0 to SpeedMax SHALL be in exactly 1 range.
- Every value in any lower range shall be less than every value in any higher range.
- The value 0 (zero) in this attribute SHALL be in a range by itself. This range SHALL map to Off.
- If Auto is supported by the server, the null value SHALL be in a range by itself. This range SHALL map to Auto.
- There shall be a one-to-one mapping between each range and each value in [FanMode](#).
- Every range SHALL map to a greater value in the [FanMode](#) attribute than all lower-valued ranges.

If a client successfully sets the [FanMode](#) attribute, the server SHALL set the [SpeedSetting](#) attribute to some value within the range which maps to the [FanMode](#) setting, as well as the [PercentSetting](#) attribute according to the equation below. If no such value exists, the attribute value SHALL NOT change.

If a client successfully sets the [SpeedSetting](#) attribute to 0, the server SHALL set the [FanMode](#) attribute to Off and the [PercentSetting](#) attribute to 0.

The following table illustrates an example of such a mapping with a value of 6 for the [SpeedMax](#) attribute. The actual mapping provided by the server is determined by the manufacturer subject to the rules mandated in this specification. Note that the values in this example are contiguous, non-overlapping and span from 0 to 6 with no missing values. Note also that each range appears in an ascending order, 0 appears by itself in a range that maps to Off, and null appears by itself in a range that maps to Auto.

| Attribute    | Values |        |        |        |      |
|--------------|--------|--------|--------|--------|------|
| FanMode      | Off    | Low    | Medium | High   | Auto |
| SpeedSetting | 0      | 1 to 2 | 3 to 4 | 5 to 6 | null |

The value of the [PercentSetting](#) and [PercentCurrent](#) (percent) attributes SHALL be calculated from the [SpeedSetting](#) and [SpeedCurrent](#) (speed) attributes respectively using the following formula:

- $\text{percent} = \text{floor}(\text{speed}/\text{SpeedMax} * 100)$

For example: If the SpeedMax attribute is 42 (42 speed fan) and [SpeedSetting](#) attribute is changed to 11, then [PercentSetting](#) and [PercentCurrent](#) become 26.

#### 4.4.6.7. SpeedCurrent Attribute

This attribute SHALL indicate the actual currently operating fan speed, or zero to indicate that the fan is off. There MAY be a temporary mismatch between the value of this attribute and the value of the [SpeedSetting](#) attribute due to other system requirements or constraints that would not allow the fan to operate at the requested setting.

For example, if the value of this attribute is currently 5, and the [SpeedSetting](#) attribute is newly set to 2, the value of this attribute MAY stay above 2 for a period necessary to dissipate internal heat,

Page 382







maintain product operational safety, etc.

When the value of the [FanMode](#) attribute is AUTO, the value of this attribute MAY vary across the range over time.

See [Section 4.4.6.6.1, “Speed Rules”](#) for more details.

#### 4.4.6.8. RockSupport Attribute

This attribute is a bitmap that indicates the rocking motions that are supported by the server.

If this attribute is supported by the server, at least one bit SHALL be set in this attribute.

#### 4.4.6.9. RockSetting Attribute

This attribute is a bitmap that indicates the currently active fan rocking motion setting. Each bit SHALL only be set to 1, if the corresponding bit in the RockSupport attribute is set to 1, otherwise a status code of CONSTRAINT\_ERROR SHALL be returned.

If a combination of supported bits is set by a client, and the server does not support the combination, the lowest supported single bit in the combination SHALL be set and active, and all other bits SHALL indicate zero.

For example: If RockUpDown and RockRound are both set, but this combination is not possible, then only RockUpDown becomes active.

#### 4.4.6.10. WindSupport Attribute

This attribute is a bitmap that indicates what wind modes are supported by the server.

If this attribute is supported by the server, at least one bit SHALL be set in this attribute.

#### 4.4.6.11. WindSetting Attribute

This attribute is a bitmap that indicates the current active fan wind feature settings. Each bit SHALL only be set to 1, if the corresponding bit in the WindSupport attribute is set to 1, otherwise a status code of CONSTRAINT\_ERROR SHALL be returned.

If a combination of supported bits is set by a client, and the server does not support the combination, the lowest supported single bit in the combination SHALL be set and active, and all other bits SHALL indicate zero.

For example: If Sleep Wind and Natural Wind are set, but this combination is not possible, then only Sleep Wind becomes active.

#### 4.4.6.12. AirflowDirection Attribute

This attribute SHALL indicate the current airflow direction of the fan. This attribute MAY be writ-



Page 383



ten by a client to indicate a new airflow direction for the fan. This attribute SHALL be set to one of the values in the [AirflowDirectionEnum](#) table.

#### 4.4.7. Commands

| ID   | Name | Direction                   | Response | Access | Conformance |
|------|------|-----------------------------|----------|--------|-------------|
| 0x00 | Step | client $\Rightarrow$ server | Y        | O      | STEP        |

##### 4.4.7.1. Step Command

This command indirectly changes the speed-oriented attributes of the fan in steps rather than using the speed-oriented attributes, [FanMode](#), [PercentSetting](#), or [SpeedSetting](#), directly. This command supports, for example, a user-operated and wall-mounted toggle switch that can be used to increase or decrease the speed of the fan by pressing the toggle switch up or down until the desired fan speed is reached. How this command is interpreted by the server and how it affects the values of the speed-oriented attributes is implementation specific.

For example, a fan supports this command, and the value of the [FanModeSequence](#) attribute is 0. The current value of the [FanMode](#) attribute is 2, or Medium. This command is received with the [Direction](#) field set to [Increase](#). As per it's specific implementation, the server reacts to the command by setting the value of the [FanMode](#) attribute to 3, or High, which in turn sets the [PercentSetting](#) and [SpeedSetting](#) (if present) attributes to appropriate values, as defined by [Section 4.4.6.3.1, “Percent Rules”](#) and [Section 4.4.6.6.1, “Speed Rules”](#) respectively.

This command supports these fields:

| ID | Name      | Type                              | Constraint | Quality | Fallback | Conformance |
|----|-----------|-----------------------------------|------------|---------|----------|-------------|
| 0  | Direction | <a href="#">StepDirectionEnum</a> |            |         |          | M           |
| 1  | Wrap      | bool                              |            |         | false    | O           |
| 2  | LowestOff | bool                              |            |         | true     | O           |

##### 4.4.7.1.1. Direction Field

This field SHALL indicate whether the speed-oriented attributes increase or decrease to the next step value.

##### 4.4.7.1.2. Wrap Field

This field SHALL indicate if the speed-oriented attributes wrap between highest and lowest step value.

##### 4.4.7.1.3. LowestOff Field

This field SHALL indicate that the fan being off ([FanMode](#) = Off, [PercentSetting](#) = 0, or [SpeedSetting](#)

Page 384







= 0) is included as a step value.

#### 4.4.7.1.4. When Generated

A client sends this command to change the speed-oriented attributes up or down in a step by step fashion.

#### 4.4.7.1.5. Effect Upon Receipt

The successful receipt of this command could result in one or more of the speed-oriented attributes, FanMode, PercentSetting, or SpeedSetting, to change.

- This command SHALL be executed even if the speed-oriented attributes are not currently at an implemented step value.
- If the Direction field is Increase,
  - If the speed-oriented attributes are lower than the highest step value, the speed-oriented attributes SHALL change to the lowest step value that is higher than the current speed-oriented attributes.
  - Else if Wrap is TRUE, the speed-oriented attributes SHALL change to the lowest step value.
  - Else the speed-oriented attributes SHALL change to (or remain at) the highest step value.
- If the Direction field is Decrease,
  - If the speed-oriented attributes are higher than the lowest step value, the speed-oriented attributes SHALL change to the highest step value that is lower than the current speed-oriented attributes.
  - Else if Wrap is TRUE, the speed-oriented attributes SHALL change to the highest step value.
  - Else the speed-oriented attributes SHALL change to (or remain at) the lowest step value.
- Although the effect of the Step command is implementation specific, the effect on receipt of the Step command SHALL adhere to the conformance of the affected attributes.

## 4.5. Thermostat User Interface Configuration Cluster

This cluster provides an interface to allow configuration of the user interface for a thermostat, or a thermostat controller device, that supports a keypad and LCD screen.

### 4.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                      |
|----------|--------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added |



Page 385



| Revision | Description                                                                                      |
|----------|--------------------------------------------------------------------------------------------------|
| 2        | New data model format and notation, added "Conversion of Temperature Values for Display" section |

#### 4.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | TSUIC     |

#### 4.5.3. Cluster ID

| ID     | Name                                    |
|--------|-----------------------------------------|
| 0x0204 | Thermostat User Interface Configuration |

#### 4.5.4. Conversion of Temperature Values for Display

See the Temperature Conversion section in the Data Model for unit conversion between Fahrenheit and Celsius.

#### 4.5.5. Data Types

##### 4.5.5.1. TemperatureDisplayModeEnum Type

This data type is derived from enum8.

| Value | Name       | Summary                     | Conformance |
|-------|------------|-----------------------------|-------------|
| 0     | Celsius    | Temperature displayed in °C | M           |
| 1     | Fahrenheit | Temperature displayed in °F | M           |

##### 4.5.5.2. KeypadLockoutEnum Type

This data type is derived from enum8.

| Value | Name      | Summary                                 | Conformance |
|-------|-----------|-----------------------------------------|-------------|
| 0     | NoLockout | All functionality available to the user | M           |
| 1     | Lockout1  | Level 1 reduced functionality           | M           |
| 2     | Lockout2  | Level 2 reduced functionality           | M           |

Page 386







| Value | Name            | Summary                                   | Conformance |
|-------|-----------------|-------------------------------------------|-------------|
| 3     | <b>Lockout3</b> | Level 3 reduced functionality             | M           |
| 4     | <b>Lockout4</b> | Level 4 reduced functionality             | M           |
| 5     | <b>Lockout5</b> | Least functionality available to the user | M           |

The interpretation of the various levels is device-dependent.

#### 4.5.5.3. ScheduleProgrammingVisibilityEnum Type

This data type is derived from enum8.

| Value | Name                                      | Summary                                                                | Conformance |
|-------|-------------------------------------------|------------------------------------------------------------------------|-------------|
| 0     | <b>ScheduleProgram-<br/>mingPermitted</b> | Local schedule programming functionality is enabled at the thermostat  | M           |
| 1     | <b>ScheduleProgram-<br/>mingDenied</b>    | Local schedule programming functionality is disabled at the thermostat | M           |

#### 4.5.6. Attributes

| ID     | Name                                                         | Type                                                                      | Constraint | Quality | Fallback                                    | Access | Conformance |
|--------|--------------------------------------------------------------|---------------------------------------------------------------------------|------------|---------|---------------------------------------------|--------|-------------|
| 0x0000 | <b>Tempera-<br/>tureDis-<br/>playMode</b>                    | <a href="#">Tempera-<br/>tureDis-<br/>playMod-<br/>eEnum</a>              | all        |         |                                             | RW VO  | M           |
| 0x0001 | <b>Keypad-<br/>Lockout</b>                                   | <a href="#">Keypad-<br/>Lock-<br/>outEnum</a>                             | all        |         |                                             | RW VM  | M           |
| 0x0002 | <b>Sched-<br/>ulePro-<br/>gram-<br/>mingVisi-<br/>bility</b> | <a href="#">Sched-<br/>ulePro-<br/>gram-<br/>mingVisi-<br/>bilityEnum</a> | all        |         | Sched-<br>ulePro-<br>gramming-<br>Permitted | RW VM  | O           |

##### 4.5.6.1. TemperatureDisplayMode Attribute

This attribute SHALL indicate the units of the temperature displayed on the thermostat screen.




Page 387



#### 4.5.6.2. KeypadLockout Attribute

This attribute SHALL indicate the level of functionality that is available to the user via the keypad.

#### 4.5.6.3. ScheduleProgrammingVisibility Attribute

This attribute is used to hide the weekly schedule programming functionality or menu on a thermostat from a user to prevent local user programming of the weekly schedule. The schedule programming MAY still be performed via a remote interface, and the thermostat MAY operate in schedule programming mode.

This attribute is designed to prevent local tampering with or disabling of schedules that MAY have been programmed by users or service providers via a more capable remote interface. The programming schedule SHALL continue to run even though it is not visible to the user locally at the thermostat.

### 4.6. Valve Configuration and Control Cluster

This cluster is used to configure a valve.

#### 4.6.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

#### 4.6.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | VALCC     |

#### 4.6.3. Cluster ID

| ID     | Name                            |
|--------|---------------------------------|
| 0x0081 | Valve Configuration and Control |

#### 4.6.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature  | Conformance | Summary                               |
|-----|------|----------|-------------|---------------------------------------|
| 0   | TS   | TimeSync | desc        | UTC time is used for time indications |

Page 388







| Bit | Code | Feature | Conformance | Summary                                                    |
|-----|------|---------|-------------|------------------------------------------------------------|
| 1   | LVL  | Level   | 0           | Device supports setting the specific position of the valve |

#### 4.6.4.1. TimeSync Feature

This feature SHALL indicate that the valve uses Time Synchronization and UTC time to indicate duration and auto close time.

This feature SHALL NOT be supported unless the device supports the Time Synchronization cluster.

#### 4.6.4.2. Level Feature

This feature SHALL indicate that the valve is capable of being adjusted to a specific position, as a percentage, of its full range of motion.

### 4.6.5. Data Types

#### 4.6.5.1. ValveFaultBitmap Type

This data type is derived from map16.

| Bit | Name                   | Summary                                 | Conformance |
|-----|------------------------|-----------------------------------------|-------------|
| 0   | <b>GeneralFault</b>    | Unspecified fault detected              | M           |
| 1   | <b>Blocked</b>         | Valve is blocked                        | M           |
| 2   | <b>Leaking</b>         | Valve has detected a leak               | M           |
| 3   | <b>NotConnected</b>    | No valve is connected to controller     | M           |
| 4   | <b>ShortCircuit</b>    | Short circuit is detected               | M           |
| 5   | <b>CurrentExceeded</b> | The available current has been exceeded | M           |

#### 4.6.5.2. ValveStateEnum Type

This data type is derived from enum8.

| Value | Name          | Summary                     | Conformance |
|-------|---------------|-----------------------------|-------------|
| 0     | <b>Closed</b> | Valve is in closed position | M           |
| 1     | <b>Open</b>   | Valve is in open position   | M           |




Page 389



| Value | Name                 | Summary                                                                    | Conformance |
|-------|----------------------|----------------------------------------------------------------------------|-------------|
| 2     | <b>Transitioning</b> | Valve is transitioning between closed and open positions or between levels | M           |

#### 4.6.6. Status Codes

##### 4.6.6.1. StatusCodeEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                                                  | Conformance |
|-------|--------------------------|--------------------------------------------------------------------------|-------------|
| 0x02  | <b>FailureDueToFault</b> | The requested action could not be performed due to a fault on the valve. | M           |

#### 4.6.7. Attributes

| ID     | Name                         | Type           | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------------|----------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Open-Duration</b>         | elapsed-s      | min 1      | X       |          | R V    | M           |
| 0x0001 | <b>Default-Open-Duration</b> | elapsed-s      | min 1      | N X     |          | RW VO  | M           |
| 0x0002 | <b>AutoCloseTime</b>         | epoch-us       | all        | X       |          | R V    | TS          |
| 0x0003 | <b>RemainingDuration</b>     | elapsed-s      | all        | Q X     |          | R V    | M           |
| 0x0004 | <b>CurrentState</b>          | ValveStateEnum | all        | X       |          | R V    | M           |
| 0x0005 | <b>TargetState</b>           | ValveStateEnum | all        | X       |          | R V    | M           |
| 0x0006 | <b>CurrentLevel</b>          | percent        | all        | X       |          | R V    | LVL         |
| 0x0007 | <b>TargetLevel</b>           | percent        | all        | X       |          | R V    | LVL         |
| 0x0008 | <b>Default-OpenLevel</b>     | percent        | 1 to 100   | N       | 100      | RW VO  | [LVL]       |

Page 390







| ID     | Name              | Type              | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------|-------------------|------------|---------|----------|--------|-------------|
| 0x0009 | <b>ValveFault</b> | ValveFault-Bitmap | all        |         | 0        | RV     | O           |
| 0x000A | <b>LevelStep</b>  | uint8             | 1 to 50    | F       | 1        | RV     | [LVL]       |

#### 4.6.7.1. OpenDuration Attribute

This attribute SHALL indicate the total duration, in seconds, for which the valve will remain open for this current opening.

A value of null SHALL indicate the duration is not set, meaning that the valve will remain open until closed by the user or some other automation.

#### 4.6.7.2. DefaultOpenDuration Attribute

This attribute SHALL indicate the default duration, in seconds, for which the valve will remain open, if the OpenDuration field is not present in the [Open](#) command.

A value of null SHALL indicate the duration is not set, meaning that the valve will remain open until closed by the user or some other automation.

#### 4.6.7.3. AutoCloseTime Attribute

This attribute SHALL indicate the UTC time when the valve will close, depending on value of the [OpenDuration](#) attribute.

This attribute SHALL be null:

- When [OpenDuration](#) is null, or
- When the valve does not have a synchronized UTCTime in the Time Synchronization cluster, or
- When the valve is closed.

When the value of this attribute is earlier or equal to the current UTC time, the valve SHALL automatically transition to its closed position. The behavior of transitioning to the closed position, SHALL match the behavior described in the [Close](#) command.

If this attribute is not null and the Time Synchronization cluster receives a SetUTCTime command, modifying the current UTC time of the device, the value of this attribute SHALL be adjusted to match the new UTC time plus the value of the [RemainingDuration](#) attribute.

#### 4.6.7.4. RemainingDuration Attribute

This attribute SHALL indicate the remaining duration, in seconds, until the valve closes.

This attribute SHALL be null:

- When [OpenDuration](#) is null, or
- When the valve is closed.



Page 391



The value of this attribute SHALL only be reported in the following cases:

- When it changes from null to any other value and vice versa, or
- When it changes to 0, or
- When it increases, or
- When the closing time changes.

Meaning that clients SHOULD NOT rely on the reporting of this attribute in order to keep track of the remaining duration, due to this attribute not being reported during regular countdown.

When reading this attribute it SHALL return the remaining duration, in seconds, until the valve closes.

When the value of this attribute counts down to 0, the valve SHALL automatically transition to its closed position. The behavior of transitioning to the closed position SHALL match the behavior described in the [Close](#) command.

#### 4.6.7.5. **CurrentState Attribute**

This attribute SHALL indicate the current state of the valve.

A value of null SHALL indicate that the current state is not known.

#### 4.6.7.6. **TargetState Attribute**

This attribute SHALL indicate the target state, while changing the state, of the valve.

A value of null SHALL indicate that no target position is set, since the change in state is either done or failed.

#### 4.6.7.7. **CurrentLevel Attribute**

This attribute SHALL indicate the current level of the valve as a percentage value, between fully closed and fully open. During a transition from one level to another level, the valve SHOULD keep this attribute updated to the best of its ability, in order to represent the actual level of the valve during the movement.

A value of 100 percent SHALL indicate the fully open position.

A value of 0 percent SHALL indicate the fully closed position.

A value of null SHALL indicate that the current state is not known.

#### 4.6.7.8. **TargetLevel Attribute**

This attribute SHALL indicate the target level of the valve as a percentage value, between fully closed and fully open.

The interpretation of the percentage value is the same as for the [CurrentLevel](#) attribute.

Page 392







A value of null SHALL indicate that no target position is set, since the change of level is either done or failed.

#### 4.6.7.9. DefaultOpenLevel Attribute

This attribute SHALL indicate the default value used for the [TargetLevel](#) attribute, when a valve transitions from the closed to the open state, caused by an [Open](#) command, if a TargetLevel field is not present in the [Open](#) command.

If the [LevelStep](#) attribute is present and the value of a write interaction to this attribute field is not 100, the value SHALL be a supported value as defined by the [LevelStep](#) attribute, such that (Value received in the write interaction) % (Value of [LevelStep](#) attribute) equals 0. If the resulting value is not 0, the requested DefaultOpenLevel value is considered an unsupported value and a CONSTRAINT\_ERROR status SHALL be returned.

#### 4.6.7.10. ValveFault Attribute

This attribute SHALL indicate any faults registered by the valve.

#### 4.6.7.11. LevelStep Attribute

This attribute SHALL indicate the step size the valve can support.

The step size defined by this attribute is counted from 0 and the final step towards 100 MAY be different than what is defined in this attribute. For example, if the value of this attribute is 15, it results in these target values being supported; 0, 15, 30, 45, 60, 75, 90 and 100.

The values of 0 and 100 SHALL always be supported, regardless of the value of this attribute.

### 4.6.8. Commands

| ID   | Name         | Direction                   | Response | Access | Conformance |
|------|--------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>Open</b>  | client $\Rightarrow$ server | Y        | O      | M           |
| 0x01 | <b>Close</b> | client $\Rightarrow$ server | Y        | O      | M           |

#### 4.6.8.1. Open Command

This command is used to set the valve to its open position.

| ID | Name                | Type      | Constraint | Quality | Fallback | Conformance |
|----|---------------------|-----------|------------|---------|----------|-------------|
| 0  | <b>OpenDuration</b> | elapsed-s | min 1      | X       |          | O           |
| 1  | <b>TargetLevel</b>  | percent   | min 1      |         |          | [LVL]       |

##### 4.6.8.1.1. OpenDuration Field

This field SHALL indicate the duration that the valve will remain open for this specific Open com-



Page 393



mand.

A value of null SHALL indicate the duration is not set, meaning that the valve will remain open until closed by the user or some other automation.

#### 4.6.8.1.2. TargetLevel Field

This field SHALL indicate the target level used for this specific Open command.

#### 4.6.8.1.3. Effect on Receipt

If the device has registered a fault, that prevents it from performing the requested action, the command SHALL be ignored and a FailureDueToFault status SHALL be returned.

The device SHALL set the [TargetState](#) attribute to the Open value and set the [CurrentState](#) attribute to the Transitioning value.

If the [OpenDuration](#) field is present, the value of the [OpenDuration](#) attribute SHALL be set to the value of the [OpenDuration](#) field.

If the [OpenDuration](#) field is not present, the value of [OpenDuration](#) attribute SHALL be set to the value of the [DefaultOpenDuration](#) attribute.

If the [OpenDuration](#) attribute is null, it SHALL indicate that there is no auto close defined for the current Open action and the device SHALL set the [RemainingDuration](#) attribute to null. If the device supports the TimeSync feature, the device SHALL set the [AutoCloseTime](#) attribute to null.

If the [OpenDuration](#) attribute is not null, it indicates that an auto close duration is defined for the current open action and the device SHALL set the value of the [RemainingDuration](#) attribute equal to the value of the [OpenDuration](#) attribute. If the device supports the TimeSync feature, the device SHALL set the [AutoCloseTime](#) attribute to the UTC value of the time when command was received plus the value of the [OpenDuration](#) attribute.

If the [LevelStep](#) attribute and the [TargetLevel](#) field are both present and the value of the [TargetLevel](#) field is not 100, the value of the [TargetLevel](#) field SHALL be a supported value as defined by the [LevelStep](#) attribute, such that (Value of [TargetLevel](#) field) % (Value of [LevelStep](#) attribute) equals 0. If the resulting value is not 0, the requested [TargetLevel](#) value is considered an unsupported value and a CONSTRAINT\_ERROR status SHALL be returned.

If the device supports the Level feature, the [TargetLevel](#) attribute SHALL be set to the value of the [TargetLevel](#) field, if present. If the [TargetLevel](#) field is not present, the [TargetLevel](#) attribute SHALL be set to the value of the [DefaultOpenLevel](#) attribute, if implemented. If the [DefaultOpenLevel](#) attribute is not present, the [TargetLevel](#) attribute SHALL be set to 100.

When the relevant target and duration attributes have been set, the device SHALL start the movement towards the target value and start the countdown of the [RemainingDuration](#) attribute. If the device supports the Level feature, the device SHALL update the [CurrentLevel](#) attribute at the start of the movement, and SHOULD update it as appropriate during movement, especially if it is slow. When the movement is complete, the device SHALL set the [CurrentState](#) attribute to the Open value.

Page 394







#### 4.6.8.2. Close Command

This command is used to set the valve to its closed position.

##### 4.6.8.2.1. Effect on Receipt

If the device has registered a fault that causes it to prevent the valve to perform the requested action, the command SHALL be ignored and a `FailureDueToFault` status SHALL be returned.

The `OpenDuration` and `RemainingDuration` attribute SHALL be set to null.

If the device supports the `TimeSync` feature, the `AutoCloseTime` attribute SHALL be set to null.

The device SHALL set the `TargetState` attribute to the Closed value and set the `CurrentState` attribute to the Transitioning value.

If the device supports the `Level` feature, it SHALL set the `TargetLevel` attribute to 0.

When the relevant target attributes have been set, the device SHALL start the movement towards the target value. If the device supports the `Level` feature, the device SHALL update the `CurrentLevel` attribute, accordingly during the movement. When the movement is complete, the device SHALL set the `CurrentState` attribute to the Closed value.

#### 4.6.9. Events

| ID   | Name                           | Priority | Quality | Access | Conformance |
|------|--------------------------------|----------|---------|--------|-------------|
| 0x00 | <code>ValveStateChanged</code> | INFO     |         | V      | O           |
| 0x01 | <code>ValveFault</code>        | INFO     |         | V      | O           |

##### 4.6.9.1. ValveStateChanged Event

This event SHALL be generated when the valve state changed. For level changes, after the end of movement, for state changes when the new state has been reached.

| ID | Name                    | Type                        | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|-----------------------------|------------|---------|----------|-------------|
| 0  | <code>ValveState</code> | <code>ValveStateEnum</code> | all        |         |          | M           |
| 1  | <code>ValveLevel</code> | percent                     | all        |         |          | LVL         |

###### 4.6.9.1.1. ValveState Field

This field SHALL indicate the new state of the valve.

###### 4.6.9.1.2. ValveLevel Field

This field SHALL indicate the new level of the valve.




Page 395



#### 4.6.9.2. ValveFault Event

This event SHALL be generated when the valve registers or clears a fault, e.g. not being able to transition to the requested target level or state.

| ID | Name              | Type                              | Constraint | Quality | Fallback | Conformance |
|----|-------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <b>ValveFault</b> | <a href="#">ValveFault-Bitmap</a> | all        |         |          | M           |

##### 4.6.9.2.1. ValveFault Field

This field SHALL indicate the value of the [ValveFault](#) attribute, at the time this event is generated.

Page 396







# Chapter 5. Entry Control

The Cluster Library is made of individual chapters such as this one. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter.

## 5.1. General Description

### 5.1.1. Introduction

The clusters specified in this section are for use in applications involving "entry control" for people or elements (light, air, etc.), for example shades, windows, doors, cabinets, door locks, but MAY be used in any application domain.

### 5.1.2. Cluster List

This section lists the closures specific clusters as specified in this chapter.

*Table 10. Overview of the Closures Clusters*

| Cluster ID | Cluster Name                      | Description                                               |
|------------|-----------------------------------|-----------------------------------------------------------|
| 0x0101     | <a href="#">Door Lock</a>         | An interface to a generic way to secure a door            |
| 0x0102     | <a href="#">Window Covering</a>   | Commands and attributes for controlling a window covering |
| 0x0104     | <a href="#">Closure Control</a>   | An interface for controlling a closure device             |
| 0x0105     | <a href="#">Closure Dimension</a> | An interface for controlling a ClosurePanel device        |

## 5.2. Door Lock Cluster

The door lock cluster provides an interface to a generic way to secure a door. The physical object that provides the locking functionality is abstracted from the cluster. The cluster has a small list of mandatory attributes and functions and a list of optional features.



Page 397



![Diagram illustrating the typical usage of the Door Lock Cluster. A 'Door lock control' device (Client, labeled 'C') is connected to a 'Door lock' device (Server, labeled 'S') via a 'Door lock' cluster. A legend below the diagram defines 'C' as 'Client' and 'S' as 'Server'.](59106265f2a3a048408a2587277b80f5_img.jpg)

The diagram shows two devices: 'Door lock control' on the left and 'Door lock' on the right. Each device is represented by a large rounded rectangle containing a smaller square. The left square contains the letter 'C' and is labeled 'Door lock control' above it. The right square contains the letter 'S' and is labeled 'Door lock' above it. A horizontal line connects the two small squares, labeled 'Door lock' above the line. Below the diagram is a legend box containing two entries: a square with 'C' followed by '= Client' and a square with 'S' followed by '= Server'.

Diagram illustrating the typical usage of the Door Lock Cluster. A 'Door lock control' device (Client, labeled 'C') is connected to a 'Door lock' device (Server, labeled 'S') via a 'Door lock' cluster. A legend below the diagram defines 'C' as 'Client' and 'S' as 'Server'.

*Note: Device names are examples for illustration purposes only*

Figure 16. Typical Usage of the Door Lock Cluster

### 5.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                                          |
|----------|--------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added; CCB 1811 1812 1821                                                                 |
| 2        | CCB 2430                                                                                                                             |
| 3        | CCB 2629 2630                                                                                                                        |
| 4        | All Hubs changes and added feature map                                                                                               |
| 5        | CCB 3472 3474 3338                                                                                                                   |
| 6        | New data model format and notation. Added User features. General cleanup of functionality                                            |
| 7        | Added support for European door locks (unbolt feature)                                                                               |
| 8        | Removed LOG and NOT feature, fixed constraints on NumberOf*Schedules attributes. and added support for Aliro credential provisioning |
| 9        | Removed AlarmMask attribute                                                                                                          |

### 5.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | DRLK      |

### 5.2.3. Cluster ID

| ID     | Name      |
|--------|-----------|
| 0x0101 | Door Lock |

Page 398



## 5.2.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code  | Feature                    | Conformance                       | Summary                                                                         |
|-----|-------|----------------------------|-----------------------------------|---------------------------------------------------------------------------------|
| 0   | PIN   | PINCredential              | O                                 | Lock supports PIN credentials (via keypad, or over-the-air)                     |
| 1   | RID   | RFIDCredential             | O                                 | Lock supports RFID credentials                                                  |
| 2   | FGP   | FingerCredentials          | P, O                              | Lock supports finger related credentials (fingerprint, finger vein)             |
| 4   | WDSCH | WeekDayAccessSchedules     | O                                 | Lock supports week day user access schedules                                    |
| 5   | DPS   | DoorPositionSensor         | O                                 | Lock supports a door position sensor that indicates door's state                |
| 6   | FACE  | FaceCredentials            | P, O                              | Lock supports face related credentials (face, iris, retina)                     |
| 7   | COTA  | CredentialOverTheAirAccess | O                                 | PIN codes over-the-air supported for lock/unlock operations                     |
| 8   | USR   | User                       | ALIRO, [ PIN   RID   FGP   FACE ] | Lock supports the user commands and database                                    |
| 10  | YDSCH | YearDayAccessSchedules     | O                                 | Lock supports year day user access schedules                                    |
| 11  | HDSCH | HolidaySchedules           | O                                 | Lock supports holiday schedules                                                 |
| 12  | UBOLT | Unbolting                  | O                                 | Lock supports unboltng                                                          |
| 13  | ALIRO | AliroProvisioning          | O                                 | Lock supports Aliro credential provisioning as defined in <a href="#">Aliro</a> |



Page 399



| Bit | Code | Feature     | Conformance | Summary                                                                                      |
|-----|------|-------------|-------------|----------------------------------------------------------------------------------------------|
| 14  | ALBU | AliroBLEUWB | [ALIRO]     | Lock supports the Bluetooth LE + UWB Access Control Flow as defined in <a href="#">Aliro</a> |

#### 5.2.4.1. PINCredential Feature

If the User Feature is also supported then any PIN Code stored in the lock SHALL be associated with a User.

A lock MAY support multiple credential types so if the User feature is supported the UserType, UserStatus and Schedules are all associated with a User index and not directly with a PIN index. A User index may have several credentials associated with it.

#### 5.2.4.2. RFIDCredential Feature

If the User Feature is also supported then any RFID credential stored in the lock SHALL be associated with a User.

A lock MAY support multiple credential types so if the User feature is supported the UserType, UserStatus and Schedules are all associated with a User index and not directly with a RFID index. A User Index may have several credentials associated with it.

#### 5.2.4.3. FingerCredentials Feature

Currently the cluster only defines the metadata format for notifications when a fingerprint/ finger vein credential is used to access the lock and doesn't describe how to create fingerprint/finger vein credentials. If the Users feature is also supported then the User that a fingerprint/finger vein is associated with can also have its UserType, UserStatus and Schedule modified.

A lock MAY support multiple credential types so if the User feature is supported the UserType, UserStatus and Schedules are all associated with a User index and not directly with a Finger index. A User Index may have several credentials associated with it.

#### 5.2.4.4. WeekDayAccessSchedules Feature

If the User feature is supported then Week Day Schedules are applied to a User and not a credential.

Week Day Schedules are used to restrict access to a specified time window on certain days of the week. The schedule is repeated each week.

The lock MAY automatically adjust the UserType when a schedule is created or cleared.

Support for WeekDayAccessSchedules requires that the lock has the capability of keeping track of local time.

Page 400



#### 5.2.4.5. DoorPositionSensor Feature

If this feature is supported this indicates that the lock has the ability to determine the position of the door which is separate from the state of the lock.

#### 5.2.4.6. FaceCredentials Feature

Currently the cluster only defines the metadata format for notifications when a face recognition, iris, or retina credential is used to access the lock and doesn't describe how to create face recognition, iris, or retina credentials. If the Users feature is also supported then the User that a face recognition, iris, or retina credential is associated with can also have its UserType, UserStatus and Schedule modified.

A lock MAY support multiple credential types so if the User feature is supported the UserType, UserStatus and Schedules are all associated with a User and not directly with a credential.

#### 5.2.4.7. CredentialOverTheAirAccess Feature

If this feature is supported then the lock supports the ability to verify a credential provided in a lock/unlock command. Currently the cluster only supports providing the PIN credential to the lock/unlock commands. If this feature is supported then the PIN Credential feature SHALL also be supported.

#### 5.2.4.8. User Feature

If the User Feature is supported then a lock employs a User database. A User within the User database is used to associate credentials and schedules to single user record within the lock. This also means the UserType and UserStatus fields are associated with a User and not a credential.

#### 5.2.4.9. YearDayAccessSchedules Feature

If the User feature is supported then Year Day Schedules are applied to a User and not a credential.

Year Day Schedules are used to restrict access to a specified date and time window.

The lock MAY automatically adjust the UserType when a schedule is created or cleared.

Support for YearDayAccessSchedules requires that the lock has the capability of keeping track of local time.

#### 5.2.4.10. HolidaySchedules Feature

This feature is used to setup Holiday Schedule in the lock device. A Holiday Schedule sets a start and stop end date/time for the lock to use the specified operating mode set by the Holiday Schedule.

Support for HolidaySchedules requires that the lock has the capability of keeping track of local time.

#### 5.2.4.11. Unbolting Feature

Locks that support this feature differentiate between unbolt and unlock. The Unbolt Door



Page 401



command retracts the bolt without pulling the latch. The Unlock Door command fully unlocks the door by retracting the bolt and briefly pulling the latch. While the latch is pulled, the lock state changes to Unlatched. Locks without unboltng support don't differentiate between unboltng and unlocking and perform the same operation for both commands.

#### 5.2.4.12. AliroProvisioning Feature

Locks that support this feature implement the Aliro specification as defined in [\[Aliro\]](#) and support Matter as a method for provisioning Aliro credentials.

#### 5.2.4.13. AliroBLEUWB Feature

Locks that support this feature implement the Bluetooth LE + UWB Access Control Flow as defined in [\[Aliro\]](#).

### 5.2.5. Recommended steps for creating a new User

It is RECOMMENDED that the Administrator query the door lock for what users already exist in its database to find an available UserIndex for creating a new User (see [Section 5.2.10.33, "GetUser Command"](#)).

1. Use [SetUser](#) command with an available UserIndex to set the user record fields as applicable.
2. Use [SetCredential](#) command with same UserIndex to add one or more credentials as applicable.
3. Use [SetWeekDaySchedule](#) command or [SetYearDaySchedule](#) command with same UserIndex to add one or more schedule restrictions as applicable.

### 5.2.6. Data Types

#### 5.2.6.1. DaysMaskBitmap Type

This data type is derived from map8.

This bitmap SHALL indicate the days of the week the Week Day schedule applies for.

| Bit | Name             | Summary                          | Conformance |
|-----|------------------|----------------------------------|-------------|
| 0   | <b>Sunday</b>    | Schedule is applied on Sunday    | M           |
| 1   | <b>Monday</b>    | Schedule is applied on Monday    | M           |
| 2   | <b>Tuesday</b>   | Schedule is applied on Tuesday   | M           |
| 3   | <b>Wednesday</b> | Schedule is applied on Wednesday | M           |
| 4   | <b>Thursday</b>  | Schedule is applied on Thursday  | M           |

Page 402



| Bit | Name            | Summary                         | Conformance |
|-----|-----------------|---------------------------------|-------------|
| 5   | <b>Friday</b>   | Schedule is applied on Friday   | M           |
| 6   | <b>Saturday</b> | Schedule is applied on Saturday | M           |

#### 5.2.6.2. CredentialRulesBitmap Type

This data type is derived from map8.

| Bit | Name          | Summary                                               | Conformance |
|-----|---------------|-------------------------------------------------------|-------------|
| 0   | <b>Single</b> | Only one credential is required for lock operation    | M           |
| 1   | <b>Dual</b>   | Any two credentials are required for lock operation   | M           |
| 2   | <b>Tri</b>    | Any three credentials are required for lock operation | M           |

#### 5.2.6.3. OperatingModesBitmap Type

This data type is derived from map16.

| Bit | Name                      | Summary                                  | Conformance |
|-----|---------------------------|------------------------------------------|-------------|
| 0   | <b>Normal</b>             | Normal operation mode                    | M           |
| 1   | <b>Vacation</b>           | Vacation operation mode                  | O           |
| 2   | <b>Privacy</b>            | Privacy operation mode                   | O           |
| 3   | <b>NoRemoteLockUnlock</b> | No remote lock and unlock operation mode | M           |
| 4   | <b>Passage</b>            | Passage operation mode                   | O           |

#### WARNING

For the OperatingModesBitmap, a bit SET indicates that the operating mode IS NOT supported. A bit CLEAR indicates that the operating mode IS supported. This is the inverse of most bitmaps in this specification, and it is RECOMMENDED that clients carefully take this into consideration. See [SupportedOperatingModes](#).



Page 403



#### 5.2.6.4. ConfigurationRegisterBitmap Type

This data type is derived from map16.

| Bit | Name                    | Summary                                      | Conformance |
|-----|-------------------------|----------------------------------------------|-------------|
| 0   | <b>LocalProgramming</b> | The state of local programming functionality | M           |
| 1   | <b>KeypadInterface</b>  | The state of the keypad interface            | M           |
| 2   | <b>RemoteInterface</b>  | The state of the remote interface            | M           |
| 5   | <b>SoundVolume</b>      | Sound volume is set to Silent value          | M           |
| 6   | <b>AutoRelockTime</b>   | Auto relock time it set to 0                 | M           |
| 7   | <b>LEDSettings</b>      | LEDs is disabled                             | M           |

##### 5.2.6.4.1. LocalProgramming Bit

This bit SHALL indicate the state related to local programming:

- 0 = Local programming is disabled
- 1 = Local programming is enabled

##### 5.2.6.4.2. KeypadInterface Bit

This bit SHALL indicate the state related to keypad interface:

- 0 = Keypad interface is disabled
- 1 = Keypad interface is enabled

##### 5.2.6.4.3. RemoteInterface Bit

This bit SHALL indicate the state related to remote interface:

- 0 = Remote interface is disabled
- 1 = Remote interface is enabled

##### 5.2.6.4.4. SoundVolume Bit

This bit SHALL indicate the state related to sound volume:

- 0 = Sound volume value is 0 (Silent)
- 1 = Sound volume value is equal to something other than 0

Page 404



#### 5.2.6.4.5. AutoRelockTime Bit

This bit SHALL indicate the state related to auto relock time:

- 0 = Auto relock time value is 0
- 1 = Auto relock time value is equal to something other than 0

#### 5.2.6.4.6. LEDSettings Bit

This bit SHALL indicate the state related to LED settings:

- 0 = LED settings value is 0 (NoLEDSignal)
- 1 = LED settings value is equal to something other than 0

### 5.2.6.5. LocalProgrammingFeaturesBitmap Type

This data type is derived from map8.

| Bit | Name                                   | Summary                                                                          | Conformance |
|-----|----------------------------------------|----------------------------------------------------------------------------------|-------------|
| 0   | <b>AddUsersCredentialsSchedules</b>    | The state of the ability to add users, credentials or schedules on the device    | M           |
| 1   | <b>ModifyUsersCredentialsSchedules</b> | The state of the ability to modify users, credentials or schedules on the device | M           |
| 2   | <b>ClearUsersCredentialsSchedules</b>  | The state of the ability to clear users, credentials or schedules on the device  | M           |
| 3   | <b>AdjustSettings</b>                  | The state of the ability to adjust settings on the device                        | M           |

#### 5.2.6.5.1. AddUsersCredentialsSchedules Bit

This bit SHALL indicate whether the door lock is able to add Users/Credentials/Schedules locally:

- 0 = This ability is disabled
- 1 = This ability is enabled

#### 5.2.6.5.2. ModifyUsersCredentialsSchedules Bit

This bit SHALL indicate whether the door lock is able to modify Users/Credentials/Schedules locally:

- 0 = This ability is disabled
- 1 = This ability is enabled




Page 405



#### 5.2.6.5.3. ClearUsersCredentialsSchedules Bit

This bit SHALL indicate whether the door lock is able to clear Users/Credentials/Schedules locally:

- 0 = This ability is disabled
- 1 = This ability is enabled

#### 5.2.6.5.4. AdjustSettings Bit

This bit SHALL indicate whether the door lock is able to adjust lock settings locally:

- 0 = This ability is disabled
- 1 = This ability is enabled

#### 5.2.6.6. AlarmMaskBitmap Type

This data type is derived from map16.

| Bit | Name                          | Summary                                           | Conformance |
|-----|-------------------------------|---------------------------------------------------|-------------|
| 0   | <b>LockJammed</b>             | Locking Mechanism Jammed                          | M           |
| 1   | <b>LockFactoryReset</b>       | Lock Reset to Factory Defaults                    | O           |
| 3   | <b>LockRadioPowerCycled</b>   | RF Module Power Cycled                            | O           |
| 4   | <b>WrongCodeEntryLimit</b>    | Tamper Alarm - wrong code entry limit             | PIN   RID   |
| 5   | <b>FrontEscutcheonRemoved</b> | Tamper Alarm - front escutcheon removed from main | O           |
| 6   | <b>DoorForcedOpen</b>         | Forced Door Open under Door Locked Condition      | O           |

#### 5.2.6.7. AlarmCodeEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the alarm type.

| Value | Name                    | Summary                        | Conformance |
|-------|-------------------------|--------------------------------|-------------|
| 0     | <b>LockJammed</b>       | Locking Mechanism Jammed       | M           |
| 1     | <b>LockFactoryReset</b> | Lock Reset to Factory Defaults | O           |

Page 406



| Value | Name                           | Summary                                           | Conformance |
|-------|--------------------------------|---------------------------------------------------|-------------|
| 3     | <b>LockRadioPowerCycled</b>    | Lock Radio Power Cycled                           | O           |
| 4     | <b>WrongCodeEntryLimit</b>     | Tamper Alarm - wrong code entry limit             | [USR]       |
| 5     | <b>FrontEsceutcheonRemoved</b> | Tamper Alarm - front escutcheon removed from main | O           |
| 6     | <b>DoorForcedOpen</b>          | Forced Door Open under Door Locked Condition      | [DPS]       |
| 7     | <b>DoorAjar</b>                | Door ajar                                         | [DPS]       |
| 8     | <b>ForcedUser</b>              | Force User SOS alarm                              | [USR]       |

#### 5.2.6.8. CredentialRuleEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the credential rule that can be applied to a particular user.

| Value | Name          | Summary                                               | Conformance |
|-------|---------------|-------------------------------------------------------|-------------|
| 0     | <b>Single</b> | Only one credential is required for lock operation    | USR         |
| 1     | <b>Dual</b>   | Any two credentials are required for lock operation   | [USR]       |
| 2     | <b>Tri</b>    | Any three credentials are required for lock operation | [USR]       |

#### 5.2.6.9. CredentialTypeEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the credential type.

| Value | Name                  | Summary                              | Conformance |
|-------|-----------------------|--------------------------------------|-------------|
| 0     | <b>ProgrammingPIN</b> | Programming PIN code credential type | O           |
| 1     | <b>PIN</b>            | PIN code credential type             | PIN         |




Page 407



| Value | Name                                | Summary                                                                                                                        | Conformance |
|-------|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|-------------|
| 2     | <b>RFID</b>                         | RFID identifier credential type                                                                                                | RID         |
| 3     | <b>Fingerprint</b>                  | Fingerprint identifier credential type                                                                                         | FGP         |
| 4     | <b>FingerVein</b>                   | Finger vein identifier credential type                                                                                         | FGP         |
| 5     | <b>Face</b>                         | Face identifier credential type                                                                                                | FACE        |
| 6     | <b>AliroCredentialIssuerKey</b>     | A Credential Issuer public key as defined in <a href="#">Aliro</a>                                                             | ALIRO       |
| 7     | <b>AliroEvictableEndpointKey</b>    | An Endpoint public key as defined in <a href="#">Aliro</a> which can be evicted if space is needed for another endpoint key    | ALIRO       |
| 8     | <b>AliroNonEvictableEndpointKey</b> | An Endpoint public key as defined in <a href="#">Aliro</a> which cannot be evicted if space is needed for another endpoint key | ALIRO       |

#### 5.2.6.9.1. AliroCredentialIssuerKey Value

Credentials of this type SHALL be 65-byte uncompressed elliptic curve public keys as defined in section 2.3.3 of [SEC 1](#).

Credentials of this type SHALL NOT be used to allow operating the lock. They SHALL be used, as defined in [\[Aliro\]](#), to create new credentials of type [AliroEvictableEndpointKey](#) via a step-up transaction.

When performing the step-up transaction, the lock SHALL request the data element with identifier "matter1", and SHALL attempt to create a new credential of type [AliroEvictableEndpointKey](#) if and only if the data element is returned and the Access Credential can be validated using the AliroCredentialIssuerKey.

When a new credential of type AliroEvictableEndpointKey is added in this manner, it SHALL be associated with the same user record as the AliroCredentialIssuerKey credential that allowed the new credential to be added.

If there are no available credential slots to add a new AliroEvictableEndpointKey credential (i.e. either the NumberOfCredentialsSupportedPerUser or the NumberOfAliroEndpointKeysSupported limit has been reached) but there exist credentials of type AliroEvictableEndpointKey associated with the user record, the server SHALL remove one of those credentials using the same procedure

Page 408



it would follow for the ClearCredential command before adding the new credential.

If there are no available credential slots to add a new AliroEvictableEndpointKey credential (i.e. either the NumberOfCredentialsSupportedPerUser or the NumberOfAliroEndpointKeysSupported limit has been reached) and there do not exist credentials of type AliroEvictableEndpointKey associated with the user record, a new AliroEvictableEndpointKey credential SHALL NOT be created.

If the step-up process results in addition of new credentials, the corresponding LockUserChange event SHALL have OperationSource set to [Aliro](#).

If the step-up process results in the lock state changing (e.g. locking or unlocking), the credential associated with those changes in the LockOperation events SHALL be the newly provisioned AliroEvictableEndpointKey credential if one was created. If no new AliroEvictableEndpointKey credential was created, the credential associated with the changes in the LockOperation events SHALL be the AliroCredentialIssuerKey credential used for the step-up.

#### 5.2.6.9.2. AliroEvictableEndpointKey Value

Credentials of this type SHALL be 65-byte uncompressed elliptic curve public keys as defined in section 2.3.3 of [SEC 1](#).

#### 5.2.6.9.3. AliroNonEvictableEndpointKey Value

Credentials of this type SHALL be 65-byte uncompressed elliptic curve public keys as defined in section 2.3.3 of [SEC 1](#).

#### 5.2.6.10. DataOperationTypeEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the data operation performed.

| Value | Name          | Summary                                | Conformance |
|-------|---------------|----------------------------------------|-------------|
| 0     | <b>Add</b>    | Data is being added or was added       | M           |
| 1     | <b>Clear</b>  | Data is being cleared or was cleared   | M           |
| 2     | <b>Modify</b> | Data is being modified or was modified | M           |

#### 5.2.6.11. DoorStateEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the current door state.

| Value | Name            | Summary            | Conformance |
|-------|-----------------|--------------------|-------------|
| 0     | <b>DoorOpen</b> | Door state is open | DPS         |



Page 409



| Value | Name                        | Summary                                      | Conformance |
|-------|-----------------------------|----------------------------------------------|-------------|
| 1     | <b>DoorClosed</b>           | Door state is closed                         | DPS         |
| 2     | <b>DoorJammed</b>           | Door state is jammed                         | [DPS]       |
| 3     | <b>DoorForcedOpen</b>       | Door state is currently forced open          | [DPS]       |
| 4     | <b>DoorUnspecifiedError</b> | Door state is invalid for unspecified reason | [DPS]       |
| 5     | <b>DoorAjar</b>             | Door state is ajar                           | [DPS]       |

#### 5.2.6.12. LockDataTypeEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the data type that is being or has changed.

| Value | Name                   | Summary                                                                          | Conformance |
|-------|------------------------|----------------------------------------------------------------------------------|-------------|
| 0     | <b>Unspecified</b>     | Unspecified or manufacturer specific lock user data added, cleared, or modified. | O           |
| 1     | <b>ProgrammingCode</b> | Lock programming PIN code was added, cleared, or modified.                       | O           |
| 2     | <b>UserIndex</b>       | Lock user index was added, cleared, or modified.                                 | M           |
| 3     | <b>WeekDaySchedule</b> | Lock user week day schedule was added, cleared, or modified.                     | WDSCH       |
| 4     | <b>YearDaySchedule</b> | Lock user year day schedule was added, cleared, or modified.                     | YDSCH       |
| 5     | <b>HolidaySchedule</b> | Lock holiday schedule was added, cleared, or modified.                           | HDSCH       |
| 6     | <b>PIN</b>             | Lock user PIN code was added, cleared, or modified.                              | PIN         |
| 7     | <b>RFID</b>            | Lock user RFID code was added, cleared, or modified.                             | RID         |

Page 410



| Value | Name                                | Summary                                                                                   | Conformance |
|-------|-------------------------------------|-------------------------------------------------------------------------------------------|-------------|
| 8     | <b>Fingerprint</b>                  | Lock user fingerprint was added, cleared, or modified.                                    | FGP         |
| 9     | <b>FingerVein</b>                   | Lock user finger-vein information was added, cleared, or modified.                        | FGP         |
| 10    | <b>Face</b>                         | Lock user face information was added, cleared, or modified.                               | FACE        |
| 11    | <b>AliroCredentialIssuerKey</b>     | An Aliro credential issuer key credential was added, cleared, or modified.                | ALIRO       |
| 12    | <b>AliroEvictableEndpointKey</b>    | An Aliro endpoint key credential which can be evicted was added, cleared, or modified.    | ALIRO       |
| 13    | <b>AliroNonEvictableEndpointKey</b> | An Aliro endpoint key credential which cannot be evicted was added, cleared, or modified. | ALIRO       |

#### 5.2.6.13. LockOperationTypeEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the type of Lock operation performed.

| Value | Name                      | Summary                                                                  | Conformance |
|-------|---------------------------|--------------------------------------------------------------------------|-------------|
| 0     | <b>Lock</b>               | Lock operation                                                           | M           |
| 1     | <b>Unlock</b>             | Unlock operation                                                         | M           |
| 2     | <b>NonAccessUserEvent</b> | Triggered by keypad entry for user with User Type set to Non Access User | O           |
| 3     | <b>ForcedUserEvent</b>    | Triggered by using a user with UserType set to Forced User               | O           |
| 4     | <b>Unlatch</b>            | Unlatch operation                                                        | M           |



Page 411



#### 5.2.6.14. OperationErrorEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the error cause of the Lock/Unlock operation performed.

| Value | Name                       | Summary                                                                                | Conformance   |
|-------|----------------------------|----------------------------------------------------------------------------------------|---------------|
| 0     | <b>Unspecified</b>         | Lock/unlock error caused by unknown or unspecified source                              | O             |
| 1     | <b>InvalidCredential</b>   | Lock/unlock error caused by invalid PIN, RFID, fingerprint or other credential         | USR           |
| 2     | <b>DisabledUserDenied</b>  | Lock/unlock error caused by disabled USER or credential                                | M             |
| 3     | <b>Restricted</b>          | Lock/unlock error caused by schedule restriction                                       | WDSCH   YDSCH |
| 4     | <b>InsufficientBattery</b> | Lock/unlock error caused by insufficient battery power left to safely actuate the lock | O             |

#### 5.2.6.15. OperatingModeEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate the lock operating mode.

| Value | Name                      | Summary | Conformance |
|-------|---------------------------|---------|-------------|
| 0     | <b>Normal</b>             |         | M           |
| 1     | <b>Vacation</b>           |         | O           |
| 2     | <b>Privacy</b>            |         | O           |
| 3     | <b>NoRemoteLockUnlock</b> |         | M           |
| 4     | <b>Passage</b>            |         | O           |

The table below shows the operating mode and which interfaces are enabled, if supported, for each mode.

| Name            | Keypad* | Remote* | RFID* |
|-----------------|---------|---------|-------|
| <b>Normal</b>   | Y       | Y       | Y     |
| <b>Vacation</b> | N       | Y       | N     |

Page 412



| Name               | Keypad* | Remote* | RFID* |
|--------------------|---------|---------|-------|
| Privacy            | N       | N       | N     |
| NoRemoteLockUnlock | Y       | N       | Y     |
| Passage            | N/A     | N/A     | N/A   |

\* Interface Operational: Yes, No or N/A

**NOTE**

For modes that disable the remote interface, the door lock SHALL respond to Lock, Unlock, Toggle, and Unlock with Timeout commands with a response status Failure and not take the action requested by those commands. The door lock SHALL NOT disable the radio or otherwise unbind or leave the network. It SHALL still respond to all other commands and requests.

**5.2.6.15.1. Normal Value**

The lock operates normally. All interfaces are enabled.

**5.2.6.15.2. Vacation Value**

Only remote interaction is enabled. The keypad SHALL only be operable by the master user.

**5.2.6.15.3. Privacy Value**

This mode is only possible if the door is locked. Manual unlocking changes the mode to Normal operating mode. All external interaction with the door lock is disabled. This mode is intended to be used so that users, presumably inside the property, will have control over the entrance.

**5.2.6.15.4. NoRemoteLockUnlock Value**

This mode only disables remote interaction with the lock. This does not apply to any remote proprietary means of communication. It specifically applies to the Lock, Unlock, Toggle, and Unlock with Timeout Commands.

**5.2.6.15.5. Passage Value**

The lock is open or can be opened or closed at will without the use of a Keypad or other means of user validation (e.g. a lock for a business during work hours).

**5.2.6.16. OperationSourceEnum Type**

This data type is derived from enum8.

This enumeration SHALL indicate the source of the Lock/Unlock or user change operation performed.




Page 413



| Value | Name                     | Summary                                                                                                                                                                              | Conformance |
|-------|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>Unspecified</b>       | Lock/unlock operation came from unspecified source                                                                                                                                   | O           |
| 1     | <b>Manual</b>            | Lock/unlock operation came from manual operation (key, thumb-turn, handle, etc).                                                                                                     | O           |
| 2     | <b>ProprietaryRemote</b> | Lock/unlock operation came from proprietary remote source (e.g. vendor app/cloud)                                                                                                    | O           |
| 3     | <b>Keypad</b>            | Lock/unlock operation came from keypad                                                                                                                                               | O           |
| 4     | <b>Auto</b>              | Lock/unlock operation came from lock automatically (e.g. relock timer)                                                                                                               | O           |
| 5     | <b>Button</b>            | Lock/unlock operation came from lock button (e.g. one touch or button)                                                                                                               | O           |
| 6     | <b>Schedule</b>          | Lock/unlock operation came from lock due to a schedule                                                                                                                               | HDSCH       |
| 7     | <b>Remote</b>            | Lock/unlock operation came from remote node                                                                                                                                          | M           |
| 8     | <b>RFID</b>              | Lock/unlock operation came from RFID card                                                                                                                                            | RID         |
| 9     | <b>Biometric</b>         | Lock/unlock operation came from biometric source (e.g. face, fingerprint/finger vein)                                                                                                | [USR]       |
| 10    | <b>Aliro</b>             | Lock/unlock operation came from an interaction defined in <a href="#">Aliro</a> , or user change operation was a step-up credential provisioning as defined in <a href="#">Aliro</a> | ALIRO       |

Page 414







### 5.2.6.17. UserStatusEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate what the status is for a specific user ID.

| Value | Name                    | Summary                              | Conformance |
|-------|-------------------------|--------------------------------------|-------------|
| 0     | <b>Available</b>        | The user ID is available             | M           |
| 1     | <b>OccupiedEnabled</b>  | The user ID is occupied and enabled  | M           |
| 3     | <b>OccupiedDisabled</b> | The user ID is occupied and disabled | O           |

### 5.2.6.18. UserTypeEnum Type

This data type is derived from enum8.

This enumeration SHALL indicate what the type is for a specific user ID.

| Value | Name                          | Summary                                 | Conformance      |
|-------|-------------------------------|-----------------------------------------|------------------|
| 0     | <b>UnrestrictedUser</b>       | The user ID type is unrestricted        | M                |
| 1     | <b>YearDayScheduleUser</b>    | The user ID type is schedule            | O                |
| 2     | <b>WeekDayScheduleUser</b>    | The user ID type is schedule            | O                |
| 3     | <b>ProgrammingUser</b>        | The user ID type is programming         | O                |
| 4     | <b>NonAccessUser</b>          | The user ID type is non access          | O                |
| 5     | <b>ForcedUser</b>             | The user ID type is forced              | [USR]            |
| 6     | <b>DisposableUser</b>         | The user ID type is disposable          | [USR]            |
| 7     | <b>ExpiringUser</b>           | The user ID type is expiring            | [USR]            |
| 8     | <b>ScheduleRestrictedUser</b> | The user ID type is schedule restricted | WDSCH   YDSCH    |
| 9     | <b>RemoteOnlyUser</b>         | The user ID type is remote only         | USR & COTA & PIN |

#### 5.2.6.18.1. UnrestrictedUser Value

This value SHALL indicate the user has access 24/7 provided proper PIN or RFID is supplied (e.g.,




Page 415



owner).

#### 5.2.6.18.2. **YearDayScheduleUser Value**

This value SHALL indicate the user has the ability to open lock within a specific time period (e.g., guest).

When UserType is set to YearDayScheduleUser, user access SHALL be restricted as follows:

- If no YearDaySchedules are set for the user, then access SHALL be denied
- If one or more YearDaySchedules are set, user access SHALL be granted if and only if the current time falls within at least one of the YearDaySchedules. If current time is not known, user access SHALL NOT be granted.

#### 5.2.6.18.3. **WeekDayScheduleUser Value**

This value SHALL indicate the user has the ability to open lock based on specific time period within a reoccurring weekly schedule (e.g., cleaning worker).

When UserType is set to WeekDayScheduleUser, user access SHALL be restricted as follows:

- If no WeekDaySchedules are set for the user, then access SHALL be denied
- If one or more WeekDaySchedules are set, user access SHALL be granted if and only if the current time falls within at least one of the WeekDaySchedules. If current time is not known, user access SHALL NOT be granted.

#### 5.2.6.18.4. **ProgrammingUser Value**

This value SHALL indicate the user has the ability to both program and operate the door lock. This user can manage the users and user schedules. In all other respects this user matches the unrestricted (default) user. ProgrammingUser is the only user that can disable the user interface (keypad, remote, etc...).

#### 5.2.6.18.5. **NonAccessUser Value**

This value SHALL indicate the user is recognized by the lock but does not have the ability to open the lock. This user will only cause the lock to generate the appropriate event notification to any bound devices.

#### 5.2.6.18.6. **ForcedUser Value**

This value SHALL indicate the user has the ability to open lock but a ForcedUser LockOperationType and ForcedUser silent alarm will be emitted to allow a notified Node to alert emergency services or contacts on the user account when used.

#### 5.2.6.18.7. **DisposableUser Value**

This value SHALL indicate the user has the ability to open lock once after which the lock SHALL change the corresponding user record UserStatus value to OccupiedDisabled automatically.

Page 416







#### 5.2.6.18.8. ExpiringUser Value

This value SHALL indicate the user has the ability to open lock for ExpiringUserTimeout attribute minutes after the first use of the PIN code, RFID code, Fingerprint, or other credential. After ExpiringUserTimeout minutes the corresponding user record UserStatus value SHALL be set to OccupiedDisabled automatically by the lock. The lock SHALL persist the timeout across reboots such that the ExpiringUserTimeout is honored.

#### 5.2.6.18.9. ScheduleRestrictedUser Value

This value SHALL indicate the user access is restricted by Week Day and/or Year Day schedule.

When UserType is set to ScheduleRestrictedUser, user access SHALL be restricted as follows:

- If no WeekDaySchedules and no YearDaySchedules are set for the user, then access SHALL be denied
- If one or more WeekDaySchedules are set, but no YearDaySchedules are set for the user, then user access SHALL be equivalent to the WeekDayScheduleUser UserType
- If one or more YearDaySchedules are set, but no WeekDaySchedules are set for the user, then user access SHALL be equivalent to the YearDayScheduleUser UserType
- If one or WeekDaySchedules are set AND one or more YearDaySchedules are set, then user access SHALL be granted if and only if the current time falls within at least one of the WeekDaySchedules AND the current time falls within at least one of the YearDaySchedules.

#### 5.2.6.18.10. RemoteOnlyUser Value

This value SHALL indicate the user access and PIN code is restricted to remote lock/unlock commands only. This type of user might be useful for regular delivery services or voice assistant unlocking operations to prevent a PIN code credential created for them from being used at the keypad. The PIN code credential would only be provided over-the-air for the lock/unlock commands.

#### 5.2.6.19. LockStateEnum Type

This data type is derived from enum8.

| Value | Name                  | Summary                                              | Conformance |
|-------|-----------------------|------------------------------------------------------|-------------|
| 0     | <b>NotFullyLocked</b> | Lock state is not fully locked                       | M           |
| 1     | <b>Locked</b>         | Lock state is fully locked                           | M           |
| 2     | <b>Unlocked</b>       | Lock state is fully unlocked                         | M           |
| 3     | <b>Unlatched</b>      | Lock state is fully unlocked and the latch is pulled | O           |




Page 417



**5.2.6.20. LockTypeEnum Type**

This data type is derived from enum8.

| Value | Name                      | Summary                                   | Conformance |
|-------|---------------------------|-------------------------------------------|-------------|
| 0     | <b>DeadBolt</b>           | Physical lock type is dead bolt           | M           |
| 1     | <b>Magnetic</b>           | Physical lock type is magnetic            | M           |
| 2     | <b>Other</b>              | Physical lock type is other               | M           |
| 3     | <b>Mortise</b>            | Physical lock type is mortise             | M           |
| 4     | <b>Rim</b>                | Physical lock type is rim                 | M           |
| 5     | <b>LatchBolt</b>          | Physical lock type is latch bolt          | M           |
| 6     | <b>CylindricalLock</b>    | Physical lock type is cylindrical lock    | M           |
| 7     | <b>TubularLock</b>        | Physical lock type is tubular lock        | M           |
| 8     | <b>InterconnectedLock</b> | Physical lock type is interconnected lock | M           |
| 9     | <b>DeadLatch</b>          | Physical lock type is dead latch          | M           |
| 10    | <b>DoorFurniture</b>      | Physical lock type is door furniture      | M           |
| 11    | <b>Eurocylinder</b>       | Physical lock type is euro cylinder       | M           |

**5.2.6.21. LEDSettingEnum Type**

This data type is derived from enum8.

| Value | Name                            | Summary                                                | Conformance |
|-------|---------------------------------|--------------------------------------------------------|-------------|
| 0     | <b>NoLEDSignal</b>              | Never use LED for signalization                        | M           |
| 1     | <b>NoLEDSignalAccessAllowed</b> | Use LED signalization except for access allowed events | M           |
| 2     | <b>LEDSignalAll</b>             | Use LED signalization for all events                   | M           |

Page 418



### 5.2.6.22. SoundVolumeEnum Type

This data type is derived from enum8.

| Value | Name          | Summary       | Conformance |
|-------|---------------|---------------|-------------|
| 0     | <b>Silent</b> | Silent Mode   | M           |
| 1     | <b>Low</b>    | Low Volume    | M           |
| 2     | <b>High</b>   | High Volume   | M           |
| 3     | <b>Medium</b> | Medium Volume | M           |

### 5.2.6.23. EventTypeEnum Type

This data type is derived from enum8.

| Value | Name               | Summary                   | Conformance |
|-------|--------------------|---------------------------|-------------|
| 0     | <b>Operation</b>   | Event type is operation   | M           |
| 1     | <b>Programming</b> | Event type is programming | M           |
| 2     | <b>Alarm</b>       | Event type is alarm       | M           |

### 5.2.6.24. CredentialStruct Type

This struct SHALL indicate the credential types and their corresponding indices (if any) for the event or user record.

| ID | Name                   | Type                               | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>CredentialType</b>  | <a href="#">CredentialTypeEnum</a> | all        |         |          |        | M           |
| 1  | <b>CredentialIndex</b> | uint16                             | all        |         |          |        | M           |

#### 5.2.6.24.1. CredentialType Field

This field SHALL indicate the credential field used to authorize the lock operation.

#### 5.2.6.24.2. CredentialIndex Field

This field SHALL indicate the index of the specific credential used to authorize the lock operation in the list of credentials identified by CredentialType (e.g. PIN, RFID, etc.). This field SHALL be set to 0 if CredentialType is ProgrammingPIN or does not correspond to a list that can be indexed into.

## 5.2.7. Status Codes




Page 419



### 5.2.7.1. StatusCodeEnum Type

This data type is derived from enum8.

| Value | Name             | Summary                                      | Conformance |
|-------|------------------|----------------------------------------------|-------------|
| 0x02  | <b>DUPLICATE</b> | Entry would cause a duplicate credential/ID. | M           |
| 0x03  | <b>OCCUPIED</b>  | Entry would replace an occupied slot.        | M           |

#### 5.2.7.2. DUPLICATE Code

The provided User ID, PIN or RFID code or other credential is a duplicate of an existing entry.

#### 5.2.7.3. OCCUPIED Code

The provided User ID, Credential ID, or entry location is already occupied. The entry might need to be deleted or a different ID or location chosen.

### 5.2.8. PIN/RFID Code Format

The PIN/RFID codes defined in this specification are all octet strings.

All value in the PIN/RFID code SHALL be ASCII encoded regardless if the PIN/RFID codes are number or characters. For example, code of “1, 2, 3, 4” SHALL be represented as 0x31, 0x32, 0x33, 0x34.

### 5.2.9. Attributes

| ID     | Name                     | Type                          | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------|-------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>LockState</b>         | <a href="#">LockStateEnum</a> | desc       | P X     |          | R V    | M           |
| 0x0001 | <b>LockType</b>          | <a href="#">LockTypeEnum</a>  | desc       |         |          | R V    | M           |
| 0x0002 | <b>ActuatorEnabled</b>   | bool                          | all        |         |          | R V    | M           |
| 0x0003 | <b>DoorState</b>         | <a href="#">DoorStateEnum</a> | desc       | P X     |          | R V    | DPS         |
| 0x0004 | <b>DoorOpenEvents</b>    | uint32                        | all        |         |          | RW VM  | [DPS]       |
| 0x0005 | <b>Door-ClosedEvents</b> | uint32                        | all        |         |          | RW VM  | [DPS]       |

Page 420







| ID     | Name                                            | Type   | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------------------------------------|--------|------------|---------|----------|--------|-------------|
| 0x0006 | <b>OpenPeriod</b>                               | uint16 | all        |         |          | RW VM  | [DPS]       |
| 0x0011 | <b>NumberOfTotalUsersSupported</b>              | uint16 | all        | F       |          | R V    | USR         |
| 0x0012 | <b>NumberOfPINUsersSupported</b>                | uint16 | all        | F       |          | R V    | PIN         |
| 0x0013 | <b>NumberOfRFIDUsersSupported</b>               | uint16 | all        | F       |          | R V    | RID         |
| 0x0014 | <b>NumberOfWeekDaySchedulesSupportedPerUser</b> | uint8  | max 0xFD   | F       |          | R V    | WDSCH       |
| 0x0015 | <b>NumberOfYearDaySchedulesSupportedPerUser</b> | uint8  | max 0xFD   | F       |          | R V    | YDSCH       |
| 0x0016 | <b>NumberOfHolidaySchedulesSupported</b>        | uint8  | max 0xFD   | F       |          | R V    | HDSCH       |
| 0x0017 | <b>MaxPINCodeLength</b>                         | uint8  | all        | F       |          | R V    | PIN         |
| 0x0018 | <b>MinPINCodeLength</b>                         | uint8  | all        | F       |          | R V    | PIN         |
| 0x0019 | <b>MaxRFIDCodeLength</b>                        | uint8  | all        | F       |          | R V    | RID         |



Page 421



| ID     | Name                                | Type                        | Constraint | Quality | Fallback | Access  | Conformance |
|--------|-------------------------------------|-----------------------------|------------|---------|----------|---------|-------------|
| 0x001A | MinRFID-Code-Length                 | uint8                       | all        | F       |          | R V     | RID         |
| 0x001B | CredentialRulesSupport              | Credential-Rules-Bitmap     | all        | F       |          | R V     | USR         |
| 0x001C | NumberOfCredentialsSupportedPerUser | uint8                       | all        | F       |          | R V     | USR         |
| 0x0021 | Language                            | string                      | max 3      | P       | MS       | R[W] VM | O           |
| 0x0022 | LEDSettings                         | LEDSettingsEnum             | all        | P       | 0        | R[W] VM | O           |
| 0x0023 | AutoRe-lockTime                     | uint32                      | all        | P       | MS       | R[W] VM | O           |
| 0x0024 | SoundVolume                         | SoundVolumeEnum             | all        | P       | 0        | R[W] VM | O           |
| 0x0025 | Operating-Mode                      | Operating-ModeEnum          | desc       | P       |          | R[W] VM | M           |
| 0x0026 | SupportedOperatingModes             | Operating-Modes-Bitmap      | all        | F       |          | R V     | M           |
| 0x0027 | Default-ConfigurationRegister       | ConfigurationRegisterBitmap | all        | P       | 0        | R V     | O           |
| 0x0028 | EnableLocalProgramming              | bool                        | all        | P       | 1        | R[W] VA | O           |
| 0x0029 | EnableOn-e-TouchLocking             | bool                        | all        | P       | 0        | RW VM   | O           |
| 0x002A | EnableInsideStatusLED               | bool                        | all        | P       | 0        | RW VM   | O           |

Page 422







| ID     | Name                          | Type                            | Constraint | Quality | Fallback | Access  | Conformance  |
|--------|-------------------------------|---------------------------------|------------|---------|----------|---------|--------------|
| 0x002B | EnablePrivacyModeButton       | bool                            | all        | P       | 0        | RW VM   | O            |
| 0x002C | LocalProgrammingFeatures      | LocalProgrammingFeatures-Bitmap | all        | P       | 0        | R[W] VA | O            |
| 0x0030 | WrongCodeEntryLimit           | uint8                           | 1 to 255   | P       |          | R[W] VA | PIN   RID    |
| 0x0031 | UserCodeTemporaryDisableTime  | uint8                           | 1 to 255   | P       |          | R[W] VA | PIN   RID    |
| 0x0032 | SendPINOverTheAir             | bool                            | all        | P       | 0        | R[W] VA | [!USR & PIN] |
| 0x0033 | RequirePINforRemoteOperation  | bool                            | all        | P       |          | R[W] VA | COTA & PIN   |
| 0x0034 | SecurityLevel                 |                                 |            |         | 0        | R V     | D            |
| 0x0035 | ExpiringUserTimeout           | uint16                          | 1 to 2880  | P       | MS       | R[W] VA | [USR]        |
| 0x0080 | AliroReaderVerificationKey    | octstr                          | 65         | X       |          | R A     | ALIRO        |
| 0x0081 | AliroReaderGroupIdentifier    | octstr                          | 16         | X       |          | R A     | ALIRO        |
| 0x0082 | AliroReaderGroupSubIdentifier | octstr                          | 16         | F       |          | R A     | ALIRO        |



Page 423



| ID     | Name                                                      | Type         | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------------------------------------------|--------------|------------|---------|----------|--------|-------------|
| 0x0083 | <b>AliroExpeditedTransactionSupportedProtocolVersions</b> | list[octstr] | max 16[2]  | F       |          | R A    | ALIRO       |
| 0x0084 | <b>AliroGroupResolvingKey</b>                             | octstr       | 16         | X       |          | R A    | ALBU        |
| 0x0085 | <b>AliroSupportedBLEUWBProtocolVersions</b>               | list[octstr] | max 16[2]  | F       |          | R A    | ALBU        |
| 0x0086 | <b>AliroBLEAdvertisingVersion</b>                         | uint8        | all        | F       |          | R A    | ALBU        |
| 0x0087 | <b>NumberOfAliroCredentialIssuerKeysSupported</b>         | uint16       | all        | F       |          | R V    | ALIRO       |
| 0x0088 | <b>NumberOfAliroEndpointKeysSupported</b>                 | uint16       | all        | F       |          | R V    | ALIRO       |

#### 5.2.9.1. LockState Attribute

This attribute may be NULL if the lock hardware does not currently know the status of the locking mechanism. For example, a lock may not know the LockState status after a power cycle until the first lock actuation is completed.

The Not Fully Locked value is used by a lock to indicate that the state of the lock is somewhere between Locked and Unlocked so it is only partially secured. For example, a deadbolt could be partially extended and not in a dead latched state.

#### 5.2.9.2. LockType Attribute

This attribute SHALL indicate the type of door lock as defined in [LockTypeEnum](#).

Page 424







### 5.2.9.3. ActuatorEnabled Attribute

This attribute SHALL indicate if the lock is currently able to (Enabled) or not able to (Disabled) process remote Lock, Unlock, or Unlock with Timeout commands.

This attribute has the following possible values:

| Boolean Value | Summary  |
|---------------|----------|
| 0             | Disabled |
| 1             | Enabled  |

### 5.2.9.4. DoorState Attribute

This attribute SHALL indicate the current door state as defined in [DoorStateEnum](#).

This attribute SHALL be null only if an internal error prevents the retrieval of the current door state.

### 5.2.9.5. DoorOpenEvents Attribute

This attribute SHALL hold the number of door open events that have occurred since it was last zeroed.

### 5.2.9.6. DoorClosedEvents Attribute

This attribute SHALL hold the number of door closed events that have occurred since it was last zeroed.

### 5.2.9.7. OpenPeriod Attribute

This attribute SHALL hold the number of minutes the door has been open since the last time it transitioned from closed to open.

### 5.2.9.8. NumberOfTotalUsersSupported Attribute

This attribute SHALL indicate the number of total users supported by the lock.

### 5.2.9.9. NumberOfPINUsersSupported Attribute

This attribute SHALL indicate the number of PIN users supported.

### 5.2.9.10. NumberOfRFIDUsersSupported Attribute

This attribute SHALL indicate the number of RFID users supported.

### 5.2.9.11. NumberOfWeekDaySchedulesSupportedPerUser Attribute

This attribute SHALL indicate the number of configurable week day schedule supported per user.



Page 425



#### 5.2.9.12. NumberOfYearDaySchedulesSupportedPerUser Attribute

This attribute SHALL indicate the number of configurable year day schedule supported per user.

#### 5.2.9.13. NumberOfHolidaySchedulesSupported Attribute

This attribute SHALL indicate the number of holiday schedules supported for the entire door lock device.

#### 5.2.9.14. MaxPINCodeLength Attribute

This attribute SHALL indicate the maximum length in bytes of a PIN Code on this device.

#### 5.2.9.15. MinPINCodeLength Attribute

This attribute SHALL indicate the minimum length in bytes of a PIN Code on this device.

#### 5.2.9.16. MaxRFIDCodeLength Attribute

This attribute SHALL indicate the maximum length in bytes of a RFID Code on this device. The value depends on the RFID code range specified by the manufacturer, if media anti-collision identifiers (UID) are used as RFID code, a value of 20 (equals 10 Byte ISO 14443A UID) is recommended.

#### 5.2.9.17. MinRFIDCodeLength Attribute

This attribute SHALL indicate the minimum length in bytes of a RFID Code on this device. The value depends on the RFID code range specified by the manufacturer, if media anti-collision identifiers (UID) are used as RFID code, a value of 8 (equals 4 Byte ISO 14443A UID) is recommended.

#### 5.2.9.18. CredentialRulesSupport Attribute

This attribute SHALL contain a bitmap with the bits set for the values of [CredentialRuleEnum](#) supported on this device.

#### 5.2.9.19. NumberOfCredentialsSupportedPerUser Attribute

This attribute SHALL indicate the number of credentials that could be assigned for each user.

Depending on the value of NumberOfRFIDUsersSupported and NumberOfPINUsersSupported it may not be possible to assign that number of credentials for a user.

For example, if the device supports only PIN and RFID credential types, NumberOfCredentialsSupportedPerUser is set to 10, NumberOfPINUsersSupported is set to 5 and NumberOfRFIDUsersSupported is set to 3, it will not be possible to actually assign 10 credentials for a user because maximum number of credentials in the database is 8.

#### 5.2.9.20. Language Attribute

This attribute SHALL indicate the language for the on-screen or audible user interface using a 2-byte language code from ISO-639-1.

Page 426



### 5.2.9.21. LEDSettings Attribute

This attribute SHALL indicate the settings for the LED support, as defined by [LEDSettingEnum](#).

### 5.2.9.22. AutoRelockTime Attribute

This attribute SHALL indicate the number of seconds to wait after unlocking a lock before it automatically locks again. 0=disabled. If set, unlock operations from any source will be timed. For one time unlock with timeout use the specific command.

### 5.2.9.23. SoundVolume Attribute

This attribute SHALL indicate the sound volume on a door lock as defined by [SoundVolumeEnum](#).

### 5.2.9.24. OperatingMode Attribute

This attribute SHALL indicate the current operating mode of the lock as defined in [OperatingModeEnum](#).

### 5.2.9.25. SupportedOperatingModes Attribute

This attribute SHALL contain a bitmap with all operating bits of the OperatingMode attribute supported by the lock.

A bit position set to zero SHALL indicate that the mode is supported. A bit position set to one SHALL indicate that the mode is not supported.

Any bit that is not yet defined in [OperatingModesBitmap](#) SHALL be set to 1.

The values considered valid to read or write in the OperatingMode attribute SHALL be the enum values from [DoorLockOperatingModeEnum](#) whose equivalent same-named bit from [OperatingModesBitmap](#) is set to zero in this attribute. WARNING: This is the opposite of most other semantically similar bitmaps in this specification.

### 5.2.9.26. DefaultConfigurationRegister Attribute

This attribute SHALL represent the default configurations as they are physically set on the device (example: hardware dip switch setting, etc...) and represents the default setting for some of the attributes within this cluster (for example: LED, Auto Lock, Sound Volume, and Operating Mode attributes).

This is a read-only attribute and is intended to allow clients to determine what changes MAY need to be made without having to query all the included attributes. It MAY be beneficial for the clients to know what the device's original settings were in the event that the device needs to be restored to factory default settings.

If the Client device would like to query and modify the door lock server's operating settings, it SHOULD send read and write attribute requests to the specific attributes.

For example, the Sound Volume attribute default value is Silent Mode. However, it is possible that the current Sound Volume is High Volume. Therefore, if the client wants to query/modify the cur-




Page 427



rent Sound Volume setting on the server, the client SHOULD read/write to the Sound Volume attribute.

#### 5.2.9.26.1. LocalProgramming Bit

This bit SHALL indicate the default value of the EnableLocalProgramming attribute.

#### 5.2.9.26.2. KeypadInterface Bit

This bit SHALL indicate the default state of the keypad interface.

#### 5.2.9.26.3. RemoteInterface Bit

This bit SHALL indicate the default state of the remote interface.

#### 5.2.9.26.4. SoundVolume Bit

This bit SHALL indicate the default value of SoundVolume attribute.

#### 5.2.9.26.5. AutoRelockTime Bit

This bit SHALL indicate the default value of AutoRelockTime attribute.

#### 5.2.9.26.6. LEDSettings Bit

This bit SHALL indicate the default value of LEDSettings attribute.

### 5.2.9.27. EnableLocalProgramming Attribute

This attribute SHALL enable/disable local programming on the door lock of certain features (see LocalProgrammingFeatures attribute). If this value is set to TRUE then local programming is enabled on the door lock for all features. If it is set to FALSE then local programming is disabled on the door lock for those features whose bit is set to 0 in the LocalProgrammingFeatures attribute. Local programming SHALL be enabled by default.

### 5.2.9.28. EnableOneTouchLocking Attribute

This attribute SHALL enable/disable the ability to lock the door lock with a single touch on the door lock.

### 5.2.9.29. EnableInsideStatusLED Attribute

This attribute SHALL enable/disable an inside LED that allows the user to see at a glance if the door is locked.

### 5.2.9.30. EnablePrivacyModeButton Attribute

This attribute SHALL enable/disable a button inside the door that is used to put the lock into privacy mode. When the lock is in privacy mode it cannot be manipulated from the outside.

Page 428







### 5.2.9.31. LocalProgrammingFeatures Attribute

This attribute SHALL indicate the local programming features that will be disabled when EnableLocalProgramming attribute is set to False. If a door lock doesn't support disabling one aspect of local programming it SHALL return CONSTRAINT\_ERROR during a write operation of this attribute. If the EnableLocalProgramming attribute is set to True then all local programming features SHALL be enabled regardless of the bits set to 0 in this attribute.

The features that can be disabled from local programming are defined in [LocalProgrammingFeaturesBitmap](#).

### 5.2.9.32. WrongCodeEntryLimit Attribute

This attribute SHALL indicate the number of incorrect Pin codes or RFID presentation attempts a user is allowed to enter before the lock will enter a lockout state. The value of this attribute is compared to all failing forms of credential presentation, including Pin codes used in an Unlock Command when RequirePINforRemoteOperation is set to true. Valid range is 1-255 incorrect attempts. The lockout state will be for the duration of UserCodeTemporaryDisableTime. If the attribute accepts writes and an attempt to write the value 0 is made, the device SHALL respond with CONSTRAINT\_ERROR.

The lock MAY reset the counter used to track incorrect credential presentations as required by internal logic, environmental events, or other reasons. The lock SHALL reset the counter if a valid credential is presented.

### 5.2.9.33. UserCodeTemporaryDisableTime Attribute

This attribute SHALL indicate the number of seconds that the lock shuts down following wrong code entry. Valid range is 1-255 seconds. Device can shut down to lock user out for specified amount of time. (Makes it difficult to try and guess a PIN for the device.) If the attribute accepts writes and an attempt to write the attribute to 0 is made, the device SHALL respond with CONSTRAINT\_ERROR.

### 5.2.9.34. SendPINOverTheAir Attribute

This attribute SHALL indicate the door locks ability to send PINs over the air. If the attribute is True it is ok for the door lock server to send PINs over the air. This attribute determines the behavior of the server's TX operation. If it is false, then it is not ok for the device to send PIN in any messages over the air.

The PIN field within any door lock cluster message SHALL keep the first octet unchanged and masks the actual code by replacing with 0xFF. For example (PIN "1234" ): If the attribute value is True, 0x04 0x31 0x32 0x33 0x34 SHALL be used in the PIN field in any door lock cluster message payload. If the attribute value is False, 0x04 0xFF 0xFF 0xFF 0xFF SHALL be used.

### 5.2.9.35. RequirePINForRemoteOperation Attribute

This attribute SHALL indicate if the door lock requires an optional PIN. If this attribute is set to True, the door lock server requires that an optional PINs be included in the payload of remote lock operation events like Lock, Unlock, Unlock with Timeout and Toggle in order to function.




Page 429



### 5.2.9.36. ExpiringUserTimeout Attribute

This attribute SHALL indicate the number of minutes a PIN, RFID, Fingerprint, or other credential associated with a user of type ExpiringUser SHALL remain valid after its first use before expiring. When the credential expires the UserStatus for the corresponding user record SHALL be set to OccupiedDisabled.

| Alarm Code Value | AlarmMaskBitmap Bit |
|------------------|---------------------|
| 0                | 0                   |
| 1                | 1                   |
| 2                | 2                   |
| 3                | 3                   |
| 4                | 4                   |
| 5                | 5                   |
| 6                | 6                   |

### 5.2.9.37. AliroReaderVerificationKey Attribute

This attribute SHALL indicate the verification key component of the Reader's key pair as defined in [Aliro]. The value, if not null, SHALL be an uncompressed elliptic curve public key as defined in section 2.3.3 of [SEC 1](#).

This attribute SHALL be null if no Reader key pair has been configured on the lock. See [Section 5.2.10.42, "SetAliroReaderConfig Command"](#).

### 5.2.9.38. AliroReaderGroupIdentifier Attribute

This attribute SHALL indicate the reader\_group\_identifier as defined in [Aliro].

This attribute SHALL be null if no reader\_group\_identifier has been configured on the lock. See [Section 5.2.10.42, "SetAliroReaderConfig Command"](#).

### 5.2.9.39. AliroReaderGroupSubIdentifier Attribute

This attribute SHALL indicate the reader\_group\_sub\_identifier as defined in [Aliro].

### 5.2.9.40. AliroExpeditedTransactionSupportedProtocolVersions Attribute

This attribute SHALL indicate the list of protocol versions supported for expedited transactions as defined in [Aliro].

### 5.2.9.41. AliroGroupResolvingKey Attribute

This attribute SHALL indicate the Group Resolving Key as defined in [Aliro].

This attribute SHALL be null if no group resolving key has been configured on the lock. See [Section 5.2.10.42, "SetAliroReaderConfig Command"](#).

Page 430







#### 5.2.9.42. AliroSupportedBLEUWBProtocolVersions Attribute

This attribute SHALL indicate the list of protocol versions supported for the Bluetooth LE + UWB Access Control Flow as defined in [\[Aliro\]](#).

#### 5.2.9.43. AliroBLEAdvertisingVersion Attribute

This attribute SHALL indicate the version of the Bluetooth LE advertisement as defined in [\[Aliro\]](#).

#### 5.2.9.44. NumberOfAliroCredentialIssuerKeysSupported

This attribute SHALL indicate the maximum number of [AliroCredentialIssuerKey](#) credentials that can be stored on the lock.

#### 5.2.9.45. NumberOfAliroEndpointKeysSupported

This attribute SHALL indicate the maximum number of endpoint key credentials that can be stored on the lock. This limit applies to the sum of the number of [AliroEvictableEndpointKey](#) credentials and the number of [AliroNonEvictableEndpointKey](#) credentials.

**NOTE**

The credential indices used for these two credential types are independent of each other, similar to all other credential types. As long as NumberOfAliroEndpointKeysSupported is at least 2 a client could add a credential of type AliroEvictableEndpointKey at any index from 1 to NumberOfAliroEndpointKeysSupported and also add a credential of type AliroNonEvictableEndpointKey at the same index, and both credentials would exist on the server.

### 5.2.10. Commands

| ID   | Name                       | Direction                   | Response           | Access | Conformance              |
|------|----------------------------|-----------------------------|--------------------|--------|--------------------------|
| 0x00 | <b>LockDoor</b>            | client $\Rightarrow$ server | Y                  | O T    | M                        |
| 0x01 | <b>UnlockDoor</b>          | client $\Rightarrow$ server | Y                  | O T    | M                        |
| 0x02 | <b>Toggle</b>              | client $\Rightarrow$ server | Y                  | O T    | X                        |
| 0x03 | <b>UnlockWith-Timeout</b>  | client $\Rightarrow$ server | Y                  | O T    | O                        |
| 0x05 | <b>SetPINCode</b>          | client $\Rightarrow$ server | Y                  | A T    | !USR & PIN               |
| 0x06 | <b>GetPINCode</b>          | client $\Rightarrow$ server | GetPINCodeResponse | A      | !USR & PIN               |
| 0x06 | <b>GetPIN-CodeResponse</b> | client $\Leftarrow$ server  | N                  |        | !USR & PIN               |
| 0x07 | <b>ClearPINCode</b>        | client $\Rightarrow$ server | Y                  | A T    | !USR & PIN               |
| 0x08 | <b>ClearAllPIN-Codes</b>   | client $\Rightarrow$ server | Y                  | A T    | !USR & PIN               |
| 0x09 | <b>SetUserStatus</b>       | client $\Rightarrow$ server | Y                  | A      | !USR & (PIN   RID   FGP) |




Page 431



| ID   | Name                               | Direction                   | Response                    | Access | Conformance              |
|------|------------------------------------|-----------------------------|-----------------------------|--------|--------------------------|
| 0x0A | <b>GetUserStatus</b>               | client $\Rightarrow$ server | GetUserStatus-Response      | A      | !USR & (PIN   RID   FGP) |
| 0x0A | <b>GetUserStatusResponse</b>       | client $\Leftarrow$ server  | N                           |        | !USR                     |
| 0x0B | <b>SetWeek-DaySchedule</b>         | client $\Rightarrow$ server | Y                           | A      | WDSCH                    |
| 0x0C | <b>GetWeek-DaySchedule</b>         | client $\Rightarrow$ server | GetWeek-DayScheduleResponse | A      | WDSCH                    |
| 0x0C | <b>GetWeek-DayScheduleResponse</b> | client $\Leftarrow$ server  | N                           |        | WDSCH                    |
| 0x0D | <b>ClearWeek-DaySchedule</b>       | client $\Rightarrow$ server | Y                           | A      | WDSCH                    |
| 0x0E | <b>SetYear-DaySchedule</b>         | client $\Rightarrow$ server | Y                           | A      | YDSCH                    |
| 0x0F | <b>GetYear-DaySchedule</b>         | client $\Rightarrow$ server | GetYear-DayScheduleResponse | A      | YDSCH                    |
| 0x0F | <b>GetYear-DayScheduleResponse</b> | client $\Leftarrow$ server  | N                           |        | YDSCH                    |
| 0x10 | <b>ClearYear-DaySchedule</b>       | client $\Rightarrow$ server | Y                           | A      | YDSCH                    |
| 0x11 | <b>SetHolidaySchedule</b>          | client $\Rightarrow$ server | Y                           | A      | HDSCH                    |
| 0x12 | <b>GetHolidaySchedule</b>          | client $\Rightarrow$ server | GetHolidayScheduleResponse  | A      | HDSCH                    |
| 0x12 | <b>GetHolidayScheduleResponse</b>  | client $\Leftarrow$ server  | N                           |        | HDSCH                    |
| 0x13 | <b>ClearHolidaySchedule</b>        | client $\Rightarrow$ server | Y                           | A      | HDSCH                    |
| 0x14 | <b>SetUserType</b>                 | client $\Rightarrow$ server | Y                           | A      | !USR & (PIN   RID   FGP) |
| 0x15 | <b>GetUserType</b>                 | client $\Rightarrow$ server | GetUserTypeResponse         | A      | !USR & (PIN   RID   FGP) |
| 0x15 | <b>GetUserTypeResponse</b>         | client $\Leftarrow$ server  | N                           |        | !USR                     |

Page 432







| ID   | Name                                           | Direction                   | Response                         | Access | Conformance |
|------|------------------------------------------------|-----------------------------|----------------------------------|--------|-------------|
| 0x16 | <b>SetRFIDCode</b>                             | client $\Rightarrow$ server | Y                                | A T    | !USR & RID  |
| 0x17 | <b>GetRFIDCode</b>                             | client $\Rightarrow$ server | GetRFID-<br>CodeResponse         | A      | !USR & RID  |
| 0x17 | <b>GetRFID-<br/>CodeResponse</b>               | client $\Leftarrow$ server  | N                                |        | !USR & RID  |
| 0x18 | <b>ClearRFID-<br/>Code</b>                     | client $\Rightarrow$ server | Y                                | A T    | !USR & RID  |
| 0x19 | <b>ClearAllRFID-<br/>Codes</b>                 | client $\Rightarrow$ server | Y                                | A T    | !USR & RID  |
| 0x1A | <b>SetUser</b>                                 | client $\Rightarrow$ server | Y                                | A T    | USR         |
| 0x1B | <b>GetUser</b>                                 | client $\Rightarrow$ server | GetUserRe-<br>sponse             | A      | USR         |
| 0x1C | <b>GetUserRe-<br/>sponse</b>                   | client $\Leftarrow$ server  | N                                |        | USR         |
| 0x1D | <b>ClearUser</b>                               | client $\Rightarrow$ server | Y                                | A T    | USR         |
| 0x22 | <b>SetCredential</b>                           | client $\Rightarrow$ server | SetCredential-<br>Response       | A T    | USR         |
| 0x23 | <b>SetCredential-<br/>Response</b>             | client $\Leftarrow$ server  | N                                |        | USR         |
| 0x24 | <b>GetCredential-<br/>Status</b>               | client $\Rightarrow$ server | GetCredential-<br>StatusResponse | A      | USR         |
| 0x25 | <b>GetCredential-<br/>StatusRe-<br/>sponse</b> | client $\Leftarrow$ server  | N                                |        | USR         |
| 0x26 | <b>ClearCreden-<br/>tial</b>                   | client $\Rightarrow$ server | Y                                | A T    | USR         |
| 0x27 | <b>UnboltDoor</b>                              | client $\Rightarrow$ server | Y                                | O T    | UBOLT       |
| 0x28 | <b>SetAliroRead-<br/>erConfig</b>              | client $\Rightarrow$ server | Y                                | A T    | ALIRO       |
| 0x29 | <b>ClearAliroRe-<br/>aderConfig</b>            | client $\Rightarrow$ server | Y                                | A T    | ALIRO       |

#### 5.2.10.1. LockDoor Command

This command causes the lock device to lock the door. This command includes an optional code for the lock. The door lock MAY require a PIN depending on the value of the [RequirePINForRemoteOperation](#) attribute.



Page 433



| ID | Name    | Type   | Constraint | Quality | Fallback | Conformance  |
|----|---------|--------|------------|---------|----------|--------------|
| 0  | PINCode | octstr |            |         |          | [COTA & PIN] |

#### 5.2.10.1.1. PINCode Field

If the RequirePINforRemoteOperation attribute is True then PINCode field SHALL be provided and the door lock SHALL NOT grant access if it is not provided.

If the PINCode field is provided, the door lock SHALL verify PINCode before granting access regardless of the value of RequirePINForRemoteOperation attribute.

When the PINCode field is provided an invalid PIN will count towards the WrongCodeEntryLimit and the UserCodeTemporaryDisableTime will be triggered if the WrongCodeEntryLimit is exceeded. The lock SHALL ignore any attempts to lock/unlock the door until the UserCodeTemporaryDisableTime expires.

#### 5.2.10.2. UnlockDoor Command

This command causes the lock device to unlock the door. This command includes an optional code for the lock. The door lock MAY require a code depending on the value of the [RequirePINForRemoteOperation](#) attribute.

##### NOTE

If the attribute AutoRelockTime is supported the lock will transition to the locked state when the auto relock time has expired.

| ID | Name    | Type   | Constraint | Quality | Fallback | Conformance  |
|----|---------|--------|------------|---------|----------|--------------|
| 0  | PINCode | octstr |            |         |          | [COTA & PIN] |

#### 5.2.10.2.1. PINCode Field

See [Section 5.2.10.1.1, “PINCode Field”](#).

#### 5.2.10.3. UnlockWithTimeout Command

This command causes the lock device to unlock the door with a timeout parameter. After the time in seconds specified in the timeout field, the lock device will relock itself automatically. This timeout parameter is only temporary for this message transition and overrides the default relock time as specified in the AutoRelockTime attribute. If the door lock device is not capable of or does not want to support temporary Relock Timeout, it SHOULD NOT support this optional command.

| ID | Name    | Type   | Constraint | Quality | Fallback | Conformance  |
|----|---------|--------|------------|---------|----------|--------------|
| 0  | Timeout | uint16 |            |         |          | M            |
| 1  | PINCode | octstr |            |         |          | [COTA & PIN] |

Page 434







#### 5.2.10.3.1. Timeout Field

This field SHALL indicate the timeout in seconds to wait before relocking the door lock. This value is independent of the AutoRelockTime attribute value.

#### 5.2.10.3.2. PINCode Field

See [Section 5.2.10.1.1, “PINCode Field”](#).

#### 5.2.10.4. SetPINCode Command

Set a PIN Code into the lock.

| ID | Name       | Type           | Constraint | Quality | Fallback | Conformance |
|----|------------|----------------|------------|---------|----------|-------------|
| 0  | UserID     | uint16         | desc       |         |          | M           |
| 1  | UserStatus | UserStatusEnum | desc       | X       |          | M           |
| 2  | UserType   | UserTypeEnum   | all        | X       |          | M           |
| 3  | PIN        | octstr         |            |         |          | M           |

Return status is a global status code or a cluster-specific status code from the [Status Codes](#) table and SHALL be one of the following values:

| Name             | Summary                                                               |
|------------------|-----------------------------------------------------------------------|
| SUCCESS          | Setting PIN code was successful.                                      |
| FAILURE          | Setting PIN code failed.                                              |
| CONSTRAINT_ERROR | Setting PIN code failed because User ID requested was out of range.   |
| DUPLICATE        | Setting PIN code failed because it would create a duplicate PIN code. |

#### 5.2.10.4.1. UserID Field

This field SHALL indicate the user ID. The value of the UserID field SHALL be between 0 and the value of the NumberOfPINUsersSupported attribute.

#### 5.2.10.4.2. UserStatus Field

This field SHALL indicate the user status. Only the values 1 (Occupied/Enabled) and 3 (Occupied/Disabled) are allowed for UserStatus.

#### 5.2.10.5. GetPINCode Command

Retrieve a PIN Code.



Page 435



| ID | Name   | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------|--------|------------|---------|----------|-------------|
| 0  | UserID | uint16 | desc       |         |          | M           |

#### 5.2.10.5.1. UserID Field

This field SHALL indicate the user ID. The value of the UserID field SHALL be between 0 and the value of the NumberOfPINUsersSupported attribute.

#### 5.2.10.6. GetPINCodeResponse Command

Returns the PIN for the specified user ID.

| ID | Name       | Type           | Constraint | Quality | Fallback | Conformance |
|----|------------|----------------|------------|---------|----------|-------------|
| 0  | UserID     | uint16         | desc       |         |          | M           |
| 1  | UserStatus | UserStatusEnum | desc       | X       |          | M           |
| 2  | UserType   | UserTypeEnum   | desc       | X       |          | M           |
| 3  | PINCode    | octstr         |            | X       |          | M           |

If the requested UserID is valid and the Code doesn't exist, Get RFID Code Response SHALL have the following format:

UserID = requested User ID

UserStatus = 0 (Available)

UserType = Null (Not supported)

PINCode = 0 (zero length)

If the requested UserID is invalid, send Default Response with an error status. The error status SHALL be equal to CONSTRAINT\_ERROR when User\_ID is less than the max number of users supported, and NOT\_FOUND if greater than or equal to the max number of users supported.

#### 5.2.10.7. ClearPINCode Command

Clear a PIN code or all PIN codes.

Page 436







| ID | Name                | Type   | Constraint                                 | Quality | Fallback | Conformance |
|----|---------------------|--------|--------------------------------------------|---------|----------|-------------|
| 0  | <b>PINSlotIndex</b> | uint16 | 1 to NumberOfPINUsersSupported,<br>0xFFFFE |         |          | M           |

For each PIN Code cleared whose user doesn't have a RFID Code or other credential type, then corresponding user record's UserStatus value SHALL be set to Available, and UserType value SHALL be set to UnrestrictedUser and all schedules SHALL be cleared.

#### 5.2.10.7.1. PINSlotIndex Field

This field SHALL specify a valid PIN code slot index or 0xFFFFE to indicate all PIN code slots SHALL be cleared.

#### 5.2.10.8. ClearAllPINCodes Command

Clear out all PINs on the lock.

|             |                                                                                                                                                                             |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | On the server, the clear all PIN codes command SHOULD have the same effect as the ClearPINCode command with respect to the setting of user status, user type and schedules. |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

#### 5.2.10.9. SetUserStatus Command

Set the status of a user ID.

| ID | Name              | Type           | Constraint | Quality | Fallback | Conformance |
|----|-------------------|----------------|------------|---------|----------|-------------|
| 0  | <b>UserID</b>     | uint16         | desc       |         |          | M           |
| 1  | <b>UserStatus</b> | UserStatusEnum | desc       |         |          | M           |

##### 5.2.10.9.1. UserID Field

This field SHALL indicate the user ID. The value of the UserID field SHALL be between 0 and the value of the NumberOfPINUsersSupported attribute.

##### 5.2.10.9.2. UserStatus Field

UserStatus value of Available is not allowed. In order to clear a user id, the ClearUser Command SHALL be used. For user status value please refer to [UserStatusEnum](#).

#### 5.2.10.10. GetUserStatus Command

Get the status of a user.




Page 437



| ID | Name   | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------|--------|------------|---------|----------|-------------|
| 0  | UserID | uint16 | desc       |         |          | M           |

#### 5.2.10.10.1. UserID Field

This field SHALL indicate the user ID. The value of the UserID field SHALL be between 0 and the value of the NumberOfPINUsersSupported attribute.

#### 5.2.10.11. GetUserStatusResponse Command

Returns the user status for the specified user ID.

| ID | Name       | Type           | Constraint | Quality | Fallback | Conformance |
|----|------------|----------------|------------|---------|----------|-------------|
| 0  | UserID     | uint16         | desc       |         |          | M           |
| 1  | UserStatus | UserStatusEnum | all        |         |          | M           |

##### 5.2.10.11.1. UserID Field

This field SHALL indicate the user ID provided in the request.

##### 5.2.10.11.2. UserStatus Field

This field SHALL indicate the current status of the requested user ID.

#### 5.2.10.12. SetWeekDaySchedule Command

Set a weekly repeating schedule for a specified user.

| ID | Name         | Type           | Constraint                                    | Quality | Fallback | Conformance |
|----|--------------|----------------|-----------------------------------------------|---------|----------|-------------|
| 0  | WeekDayIndex | uint8          | 1 to NumberOfWeekDaySchedulesSupportedPerUser |         |          | M           |
| 1  | UserIndex    | uint16         | 1 to NumberOfTotalUsersSupported              |         |          | M           |
| 2  | DaysMask     | DaysMaskBitmap |                                               |         |          | M           |
| 3  | StartHour    | uint8          | max 23                                        |         |          | M           |
| 4  | StartMinute  | uint8          | max 59                                        |         |          | M           |

Page 438



| ID | Name             | Type  | Constraint | Quality | Fallback | Conformance |
|----|------------------|-------|------------|---------|----------|-------------|
| 5  | <b>EndHour</b>   | uint8 | max 23     |         |          | M           |
| 6  | <b>EndMinute</b> | uint8 | max 59     |         |          | M           |

The associated UserType MAY be changed to ScheduleRestrictedUser by the lock when a Week Day schedule is set.

Return status SHALL be one of the following values:

| Name            | Summary                                                            |
|-----------------|--------------------------------------------------------------------|
| SUCCESS         | Setting Week Day schedule was successful.                          |
| FAILURE         | Some unexpected internal error occurred setting Week Day schedule. |
| INVALID_COMMAND | One or more fields violates constraints or is invalid.             |

#### 5.2.10.12.1. WeekDayIndex Field

This field SHALL indicate the index of the Week Day schedule.

#### 5.2.10.12.2. UserIndex Field

This field SHALL indicate the user ID.

#### 5.2.10.12.3. DaysMask Field

This field SHALL indicate which week days the schedule is active.

#### 5.2.10.12.4. StartHour Field

This field SHALL indicate the starting hour for the Week Day schedule.

#### 5.2.10.12.5. StartMinute Field

This field SHALL indicate the starting minute for the Week Day schedule.

#### 5.2.10.12.6. EndHour Field

This field SHALL indicate the ending hour for the Week Day schedule. EndHour SHALL be equal to or greater than StartHour.

#### 5.2.10.12.7. EndMinute Field

This field SHALL indicate the ending minute for the Week Day schedule. If EndHour is equal to StartHour then EndMinute SHALL be greater than StartMinute.

If the EndHour is equal to 23 and the EndMinute is equal to 59 the Lock SHALL grant access to the user up until 23:59:59.



Page 439



### 5.2.10.13. GetWeekDaySchedule Command

Retrieve the specific weekly schedule for the specific user.

| ID | Name                | Type   | Constraint                                    | Quality | Fallback | Conformance |
|----|---------------------|--------|-----------------------------------------------|---------|----------|-------------|
| 0  | <b>WeekDayIndex</b> | uint8  | 1 to NumberOfWeekDaySchedulesSupportedPerUser |         |          | M           |
| 1  | <b>UserIndex</b>    | uint16 | 1 to NumberOfTotalUsersSupported              |         |          | M           |

### 5.2.10.14. GetWeekDayScheduleResponse Command

Returns the weekly repeating schedule data for the specified schedule index.

| ID | Name                | Type                           | Constraint                                    | Quality | Fallback | Conformance |
|----|---------------------|--------------------------------|-----------------------------------------------|---------|----------|-------------|
| 0  | <b>WeekDayIndex</b> | uint8                          | 1 to NumberOfWeekDaySchedulesSupportedPerUser |         |          | M           |
| 1  | <b>UserIndex</b>    | uint16                         | 1 to NumberOfTotalUsersSupported              |         |          | M           |
| 2  | <b>Status</b>       | enum8                          | desc                                          |         |          | M           |
| 3  | <b>DaysMask</b>     | <a href="#">DaysMaskBitmap</a> |                                               |         |          | O           |
| 4  | <b>StartHour</b>    | uint8                          | max 23                                        |         |          | O           |
| 5  | <b>StartMinute</b>  | uint8                          | max 59                                        |         |          | O           |
| 6  | <b>EndHour</b>      | uint8                          | max 23                                        |         |          | O           |
| 7  | <b>EndMinute</b>    | uint8                          | max 59                                        |         |          | O           |

#### 5.2.10.14.1. WeekDayIndex Field

This field SHALL indicate the index of the Week Day schedule.

Page 440



#### 5.2.10.14.2. UserIndex Field

This field SHALL indicate the user ID.

#### 5.2.10.14.3. Status Field

Status SHALL be one of the following values:

- SUCCESS if both WeekDayIndex and UserIndex are valid and there is a corresponding schedule entry.
- INVALID\_COMMAND if either WeekDayIndex and/or UserIndex values are not within valid range
- NOT\_FOUND if no corresponding schedule entry found for WeekDayIndex.
- NOT\_FOUND if no corresponding user entry found for UserIndex.

If this field is SUCCESS, the optional fields for this command SHALL be present. For other (error) status values, only the fields up to the status field SHALL be present.

#### 5.2.10.14.4. StartHour Field

This field SHALL indicate the starting hour for the Week Day schedule.

#### 5.2.10.14.5. StartMinute Field

This field SHALL indicate the starting minute for the Week Day schedule.

#### 5.2.10.14.6. EndHour Field

This field SHALL indicate the ending hour for the Week Day schedule. EndHour SHALL be equal to or greater than StartHour.

#### 5.2.10.14.7. EndMinute Field

This field SHALL indicate the ending minute for the Week Day schedule. If EndHour is equal to StartHour then EndMinute SHALL be greater than StartMinute.

### 5.2.10.15. ClearWeekDaySchedule Command

Clear the specific weekly schedule or all weekly schedules for the specific user.

| ID | Name                | Type  | Constraint                                          | Quality | Fallback | Conformance |
|----|---------------------|-------|-----------------------------------------------------|---------|----------|-------------|
| 0  | <b>WeekDayIndex</b> | uint8 | 1 to NumberOfWeekDaySchedulesSupportedPerUser, 0xFE |         |          | M           |




Page 441



| ID | Name      | Type   | Constraint                       | Quality | Fallback | Conformance |
|----|-----------|--------|----------------------------------|---------|----------|-------------|
| 1  | UserIndex | uint16 | 1 to NumberOfTotalUsersSupported |         |          | M           |

Return status SHALL be one of the following values:

| Name            | Summary                                                             |
|-----------------|---------------------------------------------------------------------|
| SUCCESS         | Clearing the requested WeekDaySchedule was successful.              |
| FAILURE         | Some unexpected internal error occurred clearing Week Day schedule. |
| INVALID_COMMAND | One or more fields violates constraints or is invalid.              |

#### 5.2.10.15.1. WeekDayIndex Field

This field SHALL indicate the Week Day schedule index to clear or 0xFE to clear all Week Day schedules for the specified user.

#### 5.2.10.15.2. UserIndex Field

This field SHALL indicate the user ID.

#### 5.2.10.16. SetYearDaySchedule Command

Set a time-specific schedule ID for a specified user.

| ID | Name           | Type    | Constraint                                    | Quality | Fallback | Conformance |
|----|----------------|---------|-----------------------------------------------|---------|----------|-------------|
| 0  | YearDayIndex   | uint8   | 1 to NumberOfYearDaySchedulesSupportedPerUser |         |          | M           |
| 1  | UserIndex      | uint16  | 1 to NumberOfTotalUsersSupported              |         |          | M           |
| 2  | LocalStartTime | epoch-s | all                                           |         |          | M           |
| 3  | LocalEndTime   | epoch-s | all                                           |         |          | M           |

Page 442







The associated UserType MAY be changed to ScheduleRestrictedUser by the lock when a Year Day schedule is set.

Return status SHALL be one of the following values:

| <b>Name</b>     | <b>Summary</b>                                                     |
|-----------------|--------------------------------------------------------------------|
| SUCCESS         | Setting Year Day schedule was successful.                          |
| FAILURE         | Some unexpected internal error occurred setting Year Day schedule. |
| INVALID_COMMAND | One or more fields violates constraints or is invalid.             |

#### 5.2.10.16.1. YearDayIndex Field

This field SHALL indicate the index of the Year Day schedule.

#### 5.2.10.16.2. UserIndex Field

This field SHALL indicate the user ID.

#### 5.2.10.16.3. LocalStartTime Field

This field SHALL indicate the starting time for the Year Day schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value.

#### 5.2.10.16.4. LocalEndTime Field

This field SHALL indicate the ending time for the Year Day schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value. LocalEndTime SHALL be greater than LocalStartTime.

### 5.2.10.17. GetYearDaySchedule Command

Retrieve the specific year day schedule for the specific schedule and user indexes.

| <b>ID</b> | <b>Name</b>         | <b>Type</b> | <b>Constraint</b>                             | <b>Quality</b> | <b>Fallback</b> | <b>Conformance</b> |
|-----------|---------------------|-------------|-----------------------------------------------|----------------|-----------------|--------------------|
| 0         | <b>YearDayIndex</b> | uint8       | 1 to NumberOfYearDaySchedulesSupportedPerUser |                |                 | M                  |
| 1         | <b>UserIndex</b>    | uint16      | 1 to NumberOfTotalUsersSupported              |                |                 | M                  |




Page 443



### 5.2.10.18. GetYearDayScheduleResponse Command

Returns the year day schedule data for the specified schedule and user indexes.

| ID | Name                  | Type    | Constraint                                    | Quality | Fallback | Conformance |
|----|-----------------------|---------|-----------------------------------------------|---------|----------|-------------|
| 0  | <b>YearDayIndex</b>   | uint8   | 1 to NumberOfYearDaySchedulesSupportedPerUser |         |          | M           |
| 1  | <b>UserIndex</b>      | uint16  | 1 to NumberOfTotalUsersSupported              |         |          | M           |
| 2  | <b>Status</b>         | enum8   | desc                                          |         |          | M           |
| 3  | <b>LocalStartTime</b> | epoch-s | all                                           |         |          | O           |
| 4  | <b>LocalEndTime</b>   | epoch-s | all                                           |         |          | O           |

#### 5.2.10.18.1. YearDayIndex Field

This field SHALL indicate the index of the Year Day schedule.

#### 5.2.10.18.2. UserIndex Field

This field SHALL indicate the user ID.

#### 5.2.10.18.3. Status Field

Status SHALL be one of the following values:

- SUCCESS if both YearDayIndex and UserIndex are valid and there is a corresponding schedule entry.
- INVALID\_COMMAND if either YearDayIndex and/or UserIndex values are not within valid range
- NOT\_FOUND if no corresponding schedule entry found for YearDayIndex.
- NOT\_FOUND if no corresponding user entry found for UserIndex.

If this field is SUCCESS, the optional fields for this command SHALL be present. For other (error) status values, only the fields up to the status field SHALL be present.

#### 5.2.10.18.4. LocalStartTime Field

This field SHALL indicate the starting time for the Year Day schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value. This SHALL be null if the schedule is not set for the YearDayIndex and UserIndex provided.

Page 444







#### 5.2.10.18.5. LocalEndTime Field

This field SHALL indicate the ending time for the Year Day schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value. LocalEndTime SHALL be greater than LocalStartTime. This SHALL be null if the schedule is not set for the YearDayIndex and UserIndex provided.

#### 5.2.10.19. ClearYearDaySchedule Command

Clears the specific year day schedule or all year day schedules for the specific user.

| ID | Name                | Type   | Constraint                                           | Quality | Fallback | Conformance |
|----|---------------------|--------|------------------------------------------------------|---------|----------|-------------|
| 0  | <b>YearDayIndex</b> | uint8  | 1 to NumberOfYearDaySchedulesSupportedPerUser, 0xFFE |         |          | M           |
| 1  | <b>UserIndex</b>    | uint16 | 1 to NumberOfTotalUsersSupported                     |         |          | M           |

Return status SHALL be one of the following values:

| Name            | Summary                                                             |
|-----------------|---------------------------------------------------------------------|
| SUCCESS         | Clearing the requested YearDaySchedule was successful.              |
| FAILURE         | Some unexpected internal error occurred clearing Year Day schedule. |
| INVALID_COMMAND | One or more fields violates constraints or is invalid.              |

##### 5.2.10.19.1. YearDayIndex Field

This field SHALL indicate the Year Day schedule index to clear or 0xFFE to clear all Year Day schedules for the specified user.

##### 5.2.10.19.2. UserIndex Field

This field SHALL indicate the user ID.

#### 5.2.10.20. SetHolidaySchedule Command

Set the holiday Schedule by specifying local start time and local end time with respect to any Lock Operating Mode.



Page 445



| ID | Name                  | Type              | Constraint                             | Quality | Fallback | Conformance |
|----|-----------------------|-------------------|----------------------------------------|---------|----------|-------------|
| 0  | <b>HolidayIndex</b>   | uint8             | 1 to NumberOfHolidaySchedulesSupported |         |          | M           |
| 1  | <b>LocalStartTime</b> | epoch-s           | all                                    |         |          | M           |
| 2  | <b>LocalEndTime</b>   | epoch-s           | all                                    |         |          | M           |
| 3  | <b>OperatingMode</b>  | OperatingModeEnum | all                                    |         |          | M           |

Return status SHALL be one of the following values:

| Name            | Summary                                                           |
|-----------------|-------------------------------------------------------------------|
| SUCCESS         | Setting Holiday schedule was successful.                          |
| FAILURE         | Some unexpected internal error occurred setting Holiday schedule. |
| INVALID_COMMAND | One or more fields violates constraints or is invalid.            |

#### 5.2.10.20.1. HolidayIndex Field

This field SHALL indicate the index of the Holiday schedule.

#### 5.2.10.20.2. LocalStartTime Field

This field SHALL indicate the starting time for the Holiday Day schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value.

#### 5.2.10.20.3. LocalEndTime Field

This field SHALL indicate the ending time for the Holiday Day schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value. LocalEndTime SHALL be greater than LocalStartTime.

#### 5.2.10.20.4. OperatingMode Field

This field SHALL indicate the operating mode to use during this Holiday schedule start/end time.

### 5.2.10.21. GetHolidaySchedule Command

Get the holiday schedule for the specified index.

Page 446



| ID | Name                | Type  | Constraint                             | Quality | Fallback | Conformance |
|----|---------------------|-------|----------------------------------------|---------|----------|-------------|
| 0  | <b>HolidayIndex</b> | uint8 | 1 to NumberOfHolidaySchedulesSupported |         |          | M           |

### 5.2.10.22. GetHolidayScheduleResponse Command

Returns the Holiday Schedule Entry for the specified Holiday ID.

| ID | Name                  | Type               | Constraint                             | Quality | Fallback | Conformance |
|----|-----------------------|--------------------|----------------------------------------|---------|----------|-------------|
| 0  | <b>HolidayIndex</b>   | uint8              | 1 to NumberOfHolidaySchedulesSupported |         |          | M           |
| 1  | <b>Status</b>         | enum8              | desc                                   |         |          | M           |
| 2  | <b>LocalStartTime</b> | epoch-s            | all                                    | X       |          | O           |
| 3  | <b>Local End Time</b> | epoch-s            | all                                    | X       |          | O           |
| 4  | <b>Operating-Mode</b> | Operating-ModeEnum | all                                    | X       |          | O           |

#### 5.2.10.22.1. HolidayIndex Field

This field SHALL indicate the index of the Holiday schedule.

#### 5.2.10.22.2. Status Field

Status SHALL be one of the following values:

- FAILURE if the attribute NumberOfHolidaySchedulesSupported is zero.
- SUCCESS if the HolidayIndex is valid and there is a corresponding schedule entry.
- INVALID\_COMMAND if the HolidayIndex is not within valid range
- NOT\_FOUND if the HolidayIndex is within the valid range, however, there is not corresponding schedule entry found.

If this field is SUCCESS, the optional fields for this command SHALL be present. For other (error) status values, only the fields up to the status field SHALL be present.

#### 5.2.10.22.3. LocalStartTime Field

This field SHALL indicate the starting time for the Holiday schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value.




Page 447



This SHALL be null if the schedule is not set for the HolidayIndex provided.

#### 5.2.10.22.4. LocalEndTime Field

This field SHALL indicate the ending time for the Holiday schedule in Epoch Time in Seconds with local time offset based on the local timezone and DST offset on the day represented by the value. LocalEndTime SHALL be greater than LocalStartTime. This SHALL be null if the schedule is not set for the HolidayIndex provided.

#### 5.2.10.22.5. OperatingMode Field

This field SHALL indicate the operating mode to use during this Holiday schedule start/end time. This SHALL be null if the schedule is not set for the HolidayIndex provided.

### 5.2.10.23. ClearHolidaySchedule Command

Clears the holiday schedule or all holiday schedules.

| ID | Name                | Type  | Constraint                                   | Quality | Fallback | Conformance |
|----|---------------------|-------|----------------------------------------------|---------|----------|-------------|
| 0  | <b>HolidayIndex</b> | uint8 | 1 to NumberOfHolidaySchedulesSupported, 0xFE |         |          | M           |

#### 5.2.10.23.1. HolidayIndex Field

This field SHALL indicate the Holiday schedule index to clear or 0xFE to clear all Holiday schedules.

### 5.2.10.24. SetUserType Command

Set the user type for a specified user.

For user type value please refer to User Type Value.

| ID | Name            | Type         | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------------|------------|---------|----------|-------------|
| 0  | <b>UserID</b>   | uint16       | desc       |         |          | M           |
| 1  | <b>UserType</b> | UserTypeEnum | all        |         |          | M           |

Return status SHALL be one of the following values:

| Name    | Summary                                                    |
|---------|------------------------------------------------------------|
| SUCCESS | Setting User Type was successful.                          |
| FAILURE | Some unexpected internal error occurred setting User Type. |

Page 448







| <b>Name</b>     | <b>Summary</b>                                                                                                                                                         |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| INVALID_COMMAND | One or more fields violates constraints or is invalid.<br>Door lock is unable to switch from restricted to unrestricted user (e.g. need to clear schedules to switch). |

#### 5.2.10.24.1. UserID Field

This field SHALL indicate the user ID.

#### 5.2.10.24.2. UserType Field

This field SHALL indicate the user type.

#### 5.2.10.25. GetUserType Command

Retrieve the user type for a specific user.

| <b>ID</b> | <b>Name</b>   | <b>Type</b> | <b>Constraint</b> | <b>Quality</b> | <b>Fallback</b> | <b>Conformance</b> |
|-----------|---------------|-------------|-------------------|----------------|-----------------|--------------------|
| 0         | <b>UserID</b> | uint16      | desc              |                |                 | M                  |

#### 5.2.10.26. GetUserTypeResponse Command

Returns the user type for the specified user ID. If the requested User ID is invalid, send Default Response with an error status equal to FAILURE.

| <b>ID</b> | <b>Name</b>     | <b>Type</b>   | <b>Constraint</b> | <b>Quality</b> | <b>Fallback</b> | <b>Conformance</b> |
|-----------|-----------------|---------------|-------------------|----------------|-----------------|--------------------|
| 0         | <b>UserID</b>   | uint16        | desc              |                |                 | M                  |
| 1         | <b>UserType</b> | UserType-Enum | all               |                |                 | M                  |

#### 5.2.10.27. SetRFIDCode Command

Set an ID for RFID access into the lock.

| <b>ID</b> | <b>Name</b>       | <b>Type</b>    | <b>Constraint</b> | <b>Quality</b> | <b>Fallback</b> | <b>Conformance</b> |
|-----------|-------------------|----------------|-------------------|----------------|-----------------|--------------------|
| 0         | <b>UserID</b>     | uint16         | desc              |                |                 | M                  |
| 1         | <b>UserStatus</b> | UserStatusEnum | desc              | X              |                 | M                  |
| 2         | <b>UserType</b>   | UserType-Enum  | desc              | X              |                 | M                  |
| 3         | <b>RFIDCode</b>   | octstr         |                   |                |                 | M                  |



Page 449



Return status is a global status code or a cluster-specific status code from the [Status Codes](#) table and SHALL be one of the following values:

| Name             | Summary                                                                 |
|------------------|-------------------------------------------------------------------------|
| SUCCESS          | Setting RFID code was successful.                                       |
| FAILURE          | Setting RFID code failed.                                               |
| CONSTRAINT_ERROR | Setting RFID code failed because User ID requested was out of range.    |
| DUPLICATE        | Setting RFID code failed because it would create a duplicate RFID code. |

#### 5.2.10.27.1. UserID Field

This field SHALL indicate the user ID.

The value of the UserID field SHALL be between 0 and the value of the NumberOfRFIDUsersSupported attribute.

#### 5.2.10.27.2. UserStatus Field

This field SHALL indicate what the status is for a specific user ID. The values are according to “Set PIN” while not all are supported.

Only the values 1 (Occupied/Enabled) and 3 (Occupied/Disabled) are allowed for UserStatus.

#### 5.2.10.27.3. UserType Field

The values are the same as used for SetPINCode command.

### 5.2.10.28. GetRFIDCode Command

Retrieve an RFID code.

| ID | Name   | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------|--------|------------|---------|----------|-------------|
| 0  | UserID | uint16 | desc       |         |          | M           |

#### 5.2.10.28.1. UserID Field

This field SHALL indicate the user ID.

The value of the UserID field SHALL be between 0 and the value of the NumberOfRFIDUsersSupported attribute.

### 5.2.10.29. GetRFIDCodeResponse Command

Returns the RFID code for the specified user ID.

Page 450







| ID | Name        | Type           | Constraint | Quality | Fallback | Conformance |
|----|-------------|----------------|------------|---------|----------|-------------|
| 0  | User ID     | uint16         | desc       |         |          | M           |
| 1  | User Status | UserStatusEnum | desc       | X       |          | M           |
| 2  | User Type   | UserTypeEnum   | desc       | X       |          | M           |
| 3  | RFID Code   | octstr         |            | X       |          | M           |

If the requested User ID is valid and the Code doesn't exist, Get RFID Code Response SHALL have the following format:

User ID = requested User ID

User Status = 0 (available)

User Type = 0xFF (not supported)

RFID Code = 0 (zero length)

If requested User ID is invalid, send Default Response with an error status. The error status SHALL be equal to CONSTRAINT\_ERROR when User\_ID is less than the max number of users supported, and NOT\_FOUND if greater than or equal to the max number of users supported.

#### 5.2.10.30. ClearRFIDCode Command

Clear an RFID code or all RFID codes.

| ID | Name            | Type   | Constraint                                  | Quality | Fallback | Conformance |
|----|-----------------|--------|---------------------------------------------|---------|----------|-------------|
| 0  | RFID Slot Index | uint16 | 1 to NumberOfRFIDUsersSupported,<br>0xFFFFE |         |          | M           |

For each RFID Code cleared whose user doesn't have a PIN Code or other credential type, then the corresponding user record's UserStatus value SHALL be set to Available, and UserType value SHALL be set to UnrestrictedUser and all schedules SHALL be cleared.

##### 5.2.10.30.1. RFIDSlotIndex Field

This field SHALL indicate a valid RFID code slot index or 0xFFFFE to indicate all RFID code slots SHALL be cleared.

#### 5.2.10.31. ClearAllRFIDCodes Command

Clear out all RFIDs on the lock. If you clear all RFID codes and this user didn't have a PIN code, the




Page 451



user status has to be set to "0 Available", the user type has to be set to the default value, and all schedules which are supported have to be set to the default values.

#### 5.2.10.32. SetUser Command

Set user into the lock.

| ID | Name                  | Type                  | Constraint                                                                                                        | Quality | Fallback | Conformance |
|----|-----------------------|-----------------------|-------------------------------------------------------------------------------------------------------------------|---------|----------|-------------|
| 0  | <b>OperationType</b>  | DataOperationTypeEnum | Add, Modify                                                                                                       |         |          | M           |
| 1  | <b>UserIndex</b>      | uint16                | 1 to NumberOfTotalUsersSupported                                                                                  |         |          | M           |
| 2  | <b>UserName</b>       | string                | max 10                                                                                                            | X       |          | M           |
| 3  | <b>UserUnique ID</b>  | uint32                | all                                                                                                               | X       |          | M           |
| 4  | <b>UserStatus</b>     | UserStatusEnum        | OccupiedEnabled, OccupiedDisabled                                                                                 | X       |          | M           |
| 5  | <b>UserType</b>       | UserTypeEnum          | UnrestrictedUser, NonAccessUser, ForcedUser, DisposableUser, ExpiringUser, ScheduleRestrictedUser, RemoteOnlyUser | X       |          | M           |
| 6  | <b>CredentialRule</b> | CredentialRuleEnum    |                                                                                                                   | X       |          | M           |

Fields used for different use cases:

Page 452







| Use Case                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Create a new user record | <ul style="list-style-type: none"> <li>• OperationType SHALL be set to Add.</li> <li>• UserIndex value SHALL be set to a user record with UserType set to Available.</li> <li>• UserName MAY be null causing new user record to use empty string for UserName otherwise UserName SHALL be set to the value provided in the new user record.</li> <li>• UserUniqueID MAY be null causing new user record to use 0xFFFFFFFF for UserUniqueID otherwise UserUniqueID SHALL be set to the value provided in the new user record.</li> <li>• UserStatus MAY be null causing new user record to use OccupiedEnabled for UserStatus otherwise UserStatus SHALL be set to the value provided in the new user record.</li> <li>• UserType MAY be null causing new user record to use UnrestrictedUser for UserType otherwise UserType SHALL be set to the value provided in the new user record.</li> <li>• CredentialRule MAY be null causing new user record to use Single for CredentialRule otherwise CredentialRule SHALL be set to the value provided in the new user record.</li> </ul> <p>CreatorFabricIndex and LastModifiedFabricIndex in the new user record SHALL be set to the accessing fabric index.</p> <p>A LockUserChange event SHALL be generated after successfully creating a new user.</p> |



Page 453



| Use Case                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Modify an existing user record | <ul style="list-style-type: none"> <li>• OperationType SHALL be set to Modify.</li> <li>• UserIndex value SHALL be set for a user record with UserType NOT set to Available.</li> <li>• UserName SHALL be null if modifying a user record that was not created by the accessing fabric.</li> <li>• INVALID_COMMAND SHALL be returned if UserName is not null and the accessing fabric index doesn't match the CreatorFabricIndex in the user record otherwise UserName SHALL be set to the value provided in the user record.</li> <li>• UserUniqueID SHALL be null if modifying the user record that was not created by the accessing fabric.</li> <li>• INVALID_COMMAND SHALL be returned if UserUniqueID is not null and the accessing fabric index doesn't match the CreatorFabricIndex in the user record otherwise UserUniqueID SHALL be set to the value provided in the user record.</li> <li>• UserStatus MAY be null causing no change to UserStatus in user record otherwise UserStatus SHALL be set to the value provided in the user record.</li> <li>• UserType MAY be null causing no change to UserType in user record otherwise UserType SHALL be set to the value provided in the user record.</li> <li>• CredentialRule MAY be null causing no change to CredentialRule in user record otherwise CredentialRule SHALL be set to the value provided in the user record.</li> </ul> <p>CreatorFabricIndex SHALL NOT be changed in the user record. LastModifiedFabricIndex in the new user record SHALL be set to the accessing fabric index.</p> <p>A LockUserChange event SHALL be generated after successfully modifying a user.</p> |

Return status is a global status code or a cluster-specific status code from the [Status Codes](#) table and

Page 454






SHALL be one of the following values:

- SUCCESS, if setting User was successful.
- FAILURE, if some unexpected internal error occurred setting User.
- OCCUPIED, if OperationType is Add and UserIndex points to an occupied slot.
- INVALID\_COMMAND, if one or more fields violate constraints or are invalid or if OperationType is Modify and UserIndex points to an available slot.

#### 5.2.10.32.1. OperationType Field

This field SHALL indicate the type of operation.

#### 5.2.10.32.2. UserIndex Field

This field SHALL indicate the user ID.

#### 5.2.10.32.3. UserName Field

This field SHALL contain a string to use as a human readable identifier for the user.

If UserName is null then:

- If the OperationType is Add, the UserName in the resulting user record SHALL be set to an empty string.
- If the OperationType is Modify, the UserName in the user record SHALL NOT be changed from the current value.

If UserName is not null, the UserName in the user record SHALL be set to the provided value.

#### 5.2.10.32.4. UserUniqueID Field

This field SHALL indicate the fabric assigned number to use for connecting this user to other users on other devices from the fabric's perspective.

If UserUniqueID is null then:

- If the OperationType is Add, the UserUniqueID in the resulting user record SHALL be set to default value specified above.
- If the OperationType is Modify, the UserUniqueID in the user record SHALL NOT be changed from the current value.

If UserUniqueID is not null, the UserUniqueID in the user record SHALL be set to the provided value.

#### 5.2.10.32.5. UserStatus Field

This field SHALL indicate the UserStatus to assign to this user when created or modified.

If UserStatus is null then:



Page 455



- If the OperationType is Add, the UserStatus in the resulting user record SHALL be set to default value specified above.
- If the OperationType is Modify, the UserStatus in the user record SHALL NOT be changed from the current value.

If UserStatus is not null, the UserStatus in the user record SHALL be set to the provided value.

#### 5.2.10.32.6. UserType Field

This field SHALL indicate the UserType to assign to this user when created or modified.

If UserType is null then:

- If the OperationType is Add, the UserType in the resulting user record SHALL be set to default value specified above.
- If the OperationType is Modify, the UserType in the user record SHALL NOT be changed from the current value.

If UserType is not null, the UserType in the user record SHALL be set to the provided value.

#### 5.2.10.32.7. CredentialRule Field

This field SHALL indicate the CredentialRule to use for this user.

The valid CredentialRule enumeration values depends on the bits in the [CredentialRulesBitmap](#) map. Each bit in the map identifies a valid CredentialRule that can be used.

If CredentialRule is null then:

- If the OperationType is Add, the CredentialRule in the resulting user record SHALL be set to default value specified above.
- If the OperationType is Modify, the CredentialRule in the user record SHALL NOT be changed from the current value.

If CredentialRule is not null, the CredentialRule in the user record SHALL be set to the provided value.

#### 5.2.10.33. GetUser Command

Retrieve user.

| ID | Name      | Type   | Constraint                             | Quality | Fallback | Conformance |
|----|-----------|--------|----------------------------------------|---------|----------|-------------|
| 0  | UserIndex | uint16 | 1 to NumberOfTypeOfTotalUsersSupported |         |          | M           |

An InvokeResponse command SHALL be sent with an appropriate error (e.g. FAILURE, INVALID\_-

Page 456







COMMAND, etc.) as needed otherwise the [GetUserResponse Command](#) SHALL be sent implying a status of SUCCESS.

#### 5.2.10.34. GetUserResponse Command

Returns the user for the specified UserIndex.

| ID | Name                    | Type                   | Constraint                               | Quality | Fallback | Conformance |
|----|-------------------------|------------------------|------------------------------------------|---------|----------|-------------|
| 0  | UserIndex               | uint16                 | 1 to NumberOfTotalUsersSupported         |         |          | M           |
| 1  | UserName                | string                 | max 10                                   | X       |          | M           |
| 2  | UserUniqueID            | uint32                 | all                                      | X       |          | M           |
| 3  | UserStatus              | UserStatusEnum         | all                                      | X       |          | M           |
| 4  | UserType                | UserTypeEnum           | all                                      | X       |          | M           |
| 5  | CredentialRule          | CredentialRuleEnum     | desc                                     | X       |          | M           |
| 6  | Credentials             | list[CredentialStruct] | 0 to NumberOfCredentialsSupportedPerUser | X       |          | M           |
| 7  | CreatorFabricIndex      | fabric-idx             | all                                      | X       |          | M           |
| 8  | LastModifiedFabricIndex | fabric-idx             | all                                      | X       |          | M           |
| 9  | NextUserIndex           | uint16                 | 1 to NumberOfTotalUsersSupported         | X       |          | M           |

If the requested UserIndex is valid and the UserStatus is Available for the requested UserIndex then UserName, UserUniqueID, UserStatus, UserType, CredentialRule, Credentials, CreatorFabricIndex, and LastModifiedFabricIndex SHALL all be null in the response.

##### 5.2.10.34.1. UserIndex Field

This field SHALL indicate the user ID.




Page 457



#### 5.2.10.34.2. UserName Field

This field SHALL contain a string to use as a human readable identifier for the user.

#### 5.2.10.34.3. UserUniqueID Field

See [UserUniqueID](#).

#### 5.2.10.34.4. UserStatus Field

This field SHALL indicate the UserStatus assigned to the user when created or modified.

#### 5.2.10.34.5. UserType Field

This field SHALL indicate the UserType assigned to this user when created or modified.

#### 5.2.10.34.6. CredentialRule Field

This field SHALL indicate the CredentialRule set for this user.

#### 5.2.10.34.7. Credentials Field

This field SHALL contain a list of credentials for this user.

#### 5.2.10.34.8. CreatorFabricIndex Field

This field SHALL indicate the user's creator fabric index. CreatorFabricIndex SHALL be null if UserStatus is set to Available or when the creator fabric cannot be determined (for example, when user was created outside the Interaction Model) and SHALL NOT be null otherwise. This value SHALL be set to 0 if the original creator fabric was deleted.

#### 5.2.10.34.9. LastModifiedFabricIndex Field

This field SHALL indicate the user's last modifier fabric index. LastModifiedFabricIndex SHALL be null if UserStatus is set to Available or when the modifier fabric cannot be determined (for example, when user was modified outside the Interaction Model) and SHALL NOT be null otherwise. This value SHALL be set to 0 if the last modifier fabric was deleted.

#### 5.2.10.34.10. NextUserIndex Field

This field SHALL indicate the next occupied UserIndex in the database which is useful for quickly identifying occupied user slots in the database. This SHALL NOT be null if there is at least one occupied entry after the requested UserIndex in the User database and SHALL be null if there are no more occupied entries.

#### 5.2.10.35. ClearUser Command

Clears a user or all Users.

Page 458



| ID | Name      | Type   | Constraint                                   | Quality | Fallback | Conformance |
|----|-----------|--------|----------------------------------------------|---------|----------|-------------|
| 0  | UserIndex | uint16 | 1 to NumberOfTotalUsersSupported,<br>0xFFFFE |         |          | M           |

For each user to clear, all associated credentials (e.g. PIN, RFID, fingerprint, etc.) SHALL be cleared and the user entry values SHALL be reset to their default values (e.g. UserStatus SHALL be Available, UserType SHALL be UnrestrictedUser) and all associated schedules SHALL be cleared.

A LockUserChange event with the provided UserIndex SHALL be generated after successfully clearing users.

#### 5.2.10.35.1. UserIndex Field

This field SHALL specify a valid User index or 0xFFFFE to indicate all user slots SHALL be cleared.

#### 5.2.10.36. SetCredential Command

Set a credential (e.g. PIN, RFID, Fingerprint, etc.) into the lock for a new user, existing user, or ProgrammingUser.

| ID | Name            | Type                  | Constraint                        | Quality | Fallback | Conformance |
|----|-----------------|-----------------------|-----------------------------------|---------|----------|-------------|
| 0  | OperationType   | DataOperationTypeEnum | Add, Modify                       |         |          | M           |
| 1  | Credential      | Credential-Struct     |                                   |         |          | M           |
| 2  | Credential-Data | octstr                | desc                              |         |          | M           |
| 3  | UserIndex       | uint16                | 1 to NumberOfTotalUsersSupported  | X       |          | M           |
| 4  | UserStatus      | UserStatusEnum        | OccupiedEnabled, OccupiedDisabled | X       |          | M           |




Page 459



| ID | Name     | Type         | Constraint                                                                                                                       | Quality | Fallback | Conformance |
|----|----------|--------------|----------------------------------------------------------------------------------------------------------------------------------|---------|----------|-------------|
| 5  | UserType | UserTypeEnum | UnrestrictedUser,<br>ProgrammingUser,<br>NonAccessUser,<br>ForcedUser,<br>DisposableUser,<br>ExpiringUser<br>,<br>RemoteOnlyUser | X       |          | M           |

Fields used for different use cases:

Page 460



| Use Case                                      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Create a new credential and a new user record | <ul style="list-style-type: none"> <li>• OperationType SHALL be set to Add.</li> <li>• UserIndex SHALL be set to null and the lock will find a user record with a UserStatus value of Available and associate its UserIndex with the CredentialIndex in CredentialStruct provided.</li> <li>• CredentialIndex in CredentialStruct SHALL be for an unoccupied credential slot.</li> <li>• UserStatus MAY be null. If it is null, the new user record SHALL have UserStatus set to OccupiedEnabled. Otherwise the new user record SHALL have UserStatus set to the provided value.</li> <li>• UserType MAY be null. If it is null, the new user record SHALL have UserType set to UnrestrictedUser. Otherwise the new user record SHALL have UserType set to the provided value.</li> <li>• UserType SHALL NOT be set to ProgrammingUser for this use case.</li> </ul> <p>CreatorFabricIndex and LastModifiedFabricIndex in new user and credential records SHALL be set to the accessing fabric index.</p> <p>A LockUserChange event SHALL be generated after successfully creating a new credential and a new user. The UserIndex of this LockUserChange event SHALL be the UserIndex that was used to create the user. The DataIndex of this LockUserChange event SHALL be the CredentialIndex that was used to create the credential.</p> |



Page 461



| Use Case                                     | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Add a new credential to existing user record | <ul style="list-style-type: none"> <li>OperationType SHALL be set to Add.</li> <li>UserIndex SHALL NOT be null and SHALL NOT already be associated with the CredentialIndex in CredentialStruct provided otherwise INVALID_COMMAND status response SHALL be returned.</li> <li>INVALID_COMMAND SHALL be returned if the accessing fabric index doesn't match the CreatorFabricIndex in the user record pointed to by UserIndex.</li> <li>CredentialIndex in CredentialStruct provided SHALL be for an available credential slot.</li> <li>UserStatus SHALL be null.</li> <li>UserType SHALL be null.</li> </ul> <p>CreatorFabricIndex SHALL NOT be changed in the user record. LastModifiedFabricIndex in the user record SHALL be set to the accessing fabric index.</p> <p>CreatorFabricIndex and LastModifiedFabricIndex in the new credential record SHALL be set to the accessing fabric index.</p> <p>A LockUserChange event SHALL be generated after successfully adding a new credential.</p> |

Page 462







| Use Case                                      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-----------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Modify credential for an existing user record | <ul style="list-style-type: none"> <li>• OperationType SHALL be set to Modify.</li> <li>• UserIndex value SHALL already be associated with the CredentialIndex in CredentialStruct provided otherwise INVALID_COMMAND status response SHALL be returned.</li> <li>• INVALID_COMMAND SHALL be returned if the accessing fabric index doesn't match the CreatorFabricIndex in the user record pointed to by UserIndex.</li> <li>• INVALID_COMMAND SHALL be returned if the accessing fabric index doesn't match the CreatorFabricIndex in the credential record pointed to by the CredentialIndex field value of the Credential parameter.</li> <li>• CredentialIndex in CredentialStruct provided SHALL be for an occupied credential slot</li> <li>• UserStatus SHALL be null.</li> <li>• UserType SHALL be null.</li> </ul> <p>CreatorFabricIndex SHALL NOT be changed in user and credential records. LastModifiedFabricIndex in user and credential records SHALL be set to the accessing fabric index.</p> <p>A LockUserChange event SHALL be generated after successfully modifying a credential.</p> |



Page 463



| Use Case                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Modify credential for a Programming User | <ul style="list-style-type: none"> <li>• OperationType SHALL be set to Modify.</li> <li>• UserIndex SHALL be null.</li> <li>• INVALID_COMMAND SHALL be returned if the accessing fabric index doesn't match the CreatorFabricIndex in the credential record pointed to by the CredentialIndex field value of the Credential parameter.</li> <li>• CredentialType in CredentialStruct SHALL be set to ProgrammingPIN.</li> <li>• CredentialIndex in CredentialStruct SHALL be 0.</li> <li>• UserStatus SHALL be null.</li> <li>• UserType SHALL be set to ProgrammingUser.</li> </ul> <p>CreatorFabricIndex SHALL NOT be changed in the credential record. LastModifiedFabricIndex in the credential record SHALL be set to the accessing fabric index.</p> <p>A LockUserChange event SHALL be generated after successfully modifying a ProgrammingUser PIN code.</p> |

#### 5.2.10.36.1. OperationType Field

This field SHALL indicate the set credential operation type requested.

#### 5.2.10.36.2. Credential Field

This field SHALL contain a credential structure that contains the [CredentialTypeEnum](#) and the credential index (if applicable or 0 if not) to set.

#### 5.2.10.36.3. CredentialData Field

This field SHALL indicate the credential data to set for the credential being added or modified. The length of the credential data SHALL conform to the limits of the CredentialType specified in the Credential structure otherwise an INVALID\_COMMAND status SHALL be returned in the [SetCredentialResponse](#) command.

#### 5.2.10.36.4. UserIndex Field

This field SHALL indicate the user index to the user record that corresponds to the credential being added or modified. This SHALL be null if OperationType is add and a new credential and user is being added at the same time.

Page 464







#### 5.2.10.36.5. UserStatus Field

This field SHALL indicate the user status to use in the new user record if a new user is being created. This SHALL be null if OperationType is Modify. This MAY be null when adding a new credential and user.

#### 5.2.10.36.6. UserType Field

This field SHALL indicate the user type to use in the new user record if a new user is being created. This SHALL be null if OperationType is Modify. This MAY be null when adding a new credential and user.

### 5.2.10.37. SetCredentialResponse Command

Returns the status for setting the specified credential.

| ID | Name                       | Type   | Constraint                       | Quality | Fallback | Conformance |
|----|----------------------------|--------|----------------------------------|---------|----------|-------------|
| 0  | <b>Status</b>              | status | desc                             |         |          | M           |
| 1  | <b>UserIndex</b>           | uint16 | 1 to NumberOfTotalUsersSupported | X       |          | M           |
| 2  | <b>NextCredentialIndex</b> | uint16 | desc                             | X       |          | O           |

#### 5.2.10.37.1. Status Field

Status comes from the [Status Codes](#) table and SHALL be one of the following values:

- SUCCESS, if setting user credential was successful.
- FAILURE, if some unexpected internal error occurred setting user credential.
- OCCUPIED, if OperationType is Add and CredentialIndex in Credential structure points to an occupied slot.
- OCCUPIED, if OperationType is Modify and CredentialIndex in Credential structure does not match the CredentialIndex that is already associated with the provided UserIndex.
- DUPLICATE, if CredentialData provided is a duplicate of another credential with the same CredentialType (e.g. duplicate PIN code).
- RESOURCE\_EXHAUSTED, if OperationType is Add and the new credential cannot be added due to resource constraints such as:
  - The user referred to by UserIndex already has NumberOfCredentialsSupportedPerUser credentials associated.
  - The credential is of type [AliroEvictableEndpointKey](#) or [AliroNonEvictableEndpointKey](#), and adding it would cause the total number of credentials of those two types to exceed [NumberOfAliroEndpointKeysSupported](#).



Page 465



- INVALID\_COMMAND, if one or more fields violate constraints or are invalid.
- INVALID\_COMMAND, if the CredentialIndex in the Credential provided exceeds the number of credentials of the provided CredentialType supported by the lock.
- INVALID\_COMMAND, if OperationType is Modify and UserIndex points to an available slot.

#### 5.2.10.37.2. UserIndex Field

This field SHALL indicate the user index that was created with the new credential. If the status being returned is not success then this SHALL be null. This SHALL be null if OperationType was Modify; if the OperationType was Add and a new User was created this SHALL NOT be null and SHALL provide the UserIndex created. If the OperationType was Add and an existing User was associated with the new credential then this SHALL be null.

#### 5.2.10.37.3. NextCredentialIndex Field

This field SHALL indicate the next available index in the database for the credential type set, which is useful for quickly identifying available credential slots in the database. This SHALL NOT be null if there is at least one available entry after the requested credential index in the corresponding database and SHALL be null if there are no more available entries. The NextCredentialIndex reported SHALL NOT exceed the maximum number of credentials for a particular credential type.

#### 5.2.10.38. GetCredentialStatus Command

Retrieve the status of a particular credential (e.g. PIN, RFID, Fingerprint, etc.) by index.

| ID | Name              | Type                              | Constraint | Quality | Fallback | Conformance |
|----|-------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <b>Credential</b> | <a href="#">Credential-Struct</a> |            |         |          | M           |

An InvokeResponse command SHALL be sent with an appropriate error (e.g. FAILURE, INVALID\_COMMAND, etc.) as needed otherwise the [GetCredentialStatusResponse](#) command SHALL be sent implying a status of SUCCESS.

##### 5.2.10.38.1. Credential Field

This field SHALL contain a credential structure that contains the [CredentialTypeEnum](#) and the credential index (if applicable or 0 if not) to retrieve the status for.

#### 5.2.10.39. GetCredentialStatusResponse Command

Returns the status for the specified credential.

| ID | Name                    | Type | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|------|------------|---------|----------|-------------|
| 0  | <b>CredentialExists</b> | bool | all        |         |          | M           |

Page 466







| ID | Name                    | Type       | Constraint                       | Quality | Fallback | Conformance |
|----|-------------------------|------------|----------------------------------|---------|----------|-------------|
| 1  | UserIndex               | uint16     | 1 to NumberOfTotalUsersSupported | X       |          | M           |
| 2  | CreatorFabricIndex      | fabric-idx | all                              | X       |          | M           |
| 3  | LastModifiedFabricIndex | fabric-idx | all                              | X       |          | M           |
| 4  | NextCredentialIndex     | uint16     | desc                             | X       |          | O           |
| 5  | CredentialData          | octstr     | desc                             | X       |          | [ALIRO]     |

#### 5.2.10.39.1. CredentialExists Field

This field SHALL indicate if the requested credential type and index exists and is populated for the requested user index.

#### 5.2.10.39.2. UserIndex Field

This field SHALL indicate the credential's corresponding user index value if the credential exists. If CredentialType requested was ProgrammingPIN then UserIndex SHALL be null; otherwise, UserIndex SHALL be null if CredentialExists is set to False and SHALL NOT be null if CredentialExists is set to True.

#### 5.2.10.39.3. CreatorFabricIndex Field

This field SHALL indicate the credential's creator fabric index. CreatorFabricIndex SHALL be null if CredentialExists is set to False or when the creator fabric cannot be determined (for example, when credential was created outside the Interaction Model) and SHALL NOT be null otherwise. This value SHALL be set to 0 if the original creator fabric was deleted.

#### 5.2.10.39.4. LastModifiedFabricIndex Field

This field SHALL indicate the credential's last modifier fabric index. LastModifiedFabricIndex SHALL be null if CredentialExists is set to False or when the modifier fabric cannot be determined (for example, when credential was modified outside the Interaction Model) and SHALL NOT be null otherwise. This value SHALL be set to 0 if the last modifier fabric was deleted.

#### 5.2.10.39.5. NextCredentialIndex Field

This field SHALL indicate the next occupied index in the database for the credential type requested, which is useful for quickly identifying occupied credential slots in the database. This SHALL NOT be null if there is at least one occupied entry after the requested credential index in the corresponding




Page 467



database and SHALL be null if there are no more occupied entries. The NextCredentialIndex reported SHALL NOT exceed the maximum number of credentials for a particular credential type.

#### 5.2.10.39.6. CredentialData Field

This field SHALL indicate the credential data for the requested user index.

If the CredentialType in the GetCredentialStatus command was not AliroCredentialIssuerKey, AliroEvictableEndpointKey, or AliroNonEvictableEndpointKey, this field SHALL NOT be included.

Otherwise, if CredentialExists is false this field SHALL be null.

Otherwise, the value of this field SHALL be the value of the relevant credential, as a 65-byte uncompressed elliptic curve public key as defined in section 2.3.3 of [SEC 1](#).

|             |                                                                                                                                                                                  |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | Since the Aliro credentials are public keys, there is no security risk in allowing them to be read. Possession of the credential octet string does not allow operating the lock. |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

#### 5.2.10.40. ClearCredential Command

Clear one, one type, or all credentials except ProgrammingPIN credential.

| ID | Name              | Type                              | Constraint | Quality | Fallback | Conformance |
|----|-------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <b>Credential</b> | <a href="#">Credential-Struct</a> | desc       | X       |          | M           |

Fields used for different use cases:

| Use Case                  | Description                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Clear a single credential | <ul style="list-style-type: none"> <li>CredentialType in Credential structure SHALL be set to the credential type to be cleared.</li> <li>CredentialType in Credential structure SHALL NOT be set to ProgrammingPIN.</li> <li>CredentialIndex in Credential structure SHALL be set to the credential index to be cleared.</li> </ul> <p>A LockUserChange event SHALL be generated after successfully clearing a credential.</p> |

Page 468







| Use Case                           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Clear all credentials of one type  | <ul style="list-style-type: none"> <li>• CredentialType in Credential structure SHALL be set to the credential type to be cleared.</li> <li>• CredentialType in Credential structure SHALL NOT be set to ProgrammingPIN.</li> <li>• CredentialIndex in Credential structure SHALL be set to 0xFFFF to indicate all credentials of that type SHALL be cleared.</li> </ul> <p>A single LockUserChange event SHALL be generated after successfully clearing credentials. This event SHALL have DataIndex set to the CredentialIndex in the Credential structure.</p> |
| Clear all credentials of all types | <ul style="list-style-type: none"> <li>• Credential field SHALL be null.</li> </ul> <p>The ProgrammingPIN credential SHALL NOT be cleared.</p> <p>For each credential type cleared, a LockUserChange event with the corresponding LockDataType SHALL be generated. This event SHALL have DataIndex set to 0xFFFF.</p>                                                                                                                                                                                                                                             |

For each credential cleared whose user doesn't have another valid credential, the corresponding user record SHALL be reset back to default values and its UserStatus value SHALL be set to Available and UserType value SHALL be set to UnrestrictedUser and all schedules SHALL be cleared. In this case a LockUserChange event SHALL be generated for the user being cleared.

Return status SHALL be one of the following values:

| Name            | Summary                                                                    |
|-----------------|----------------------------------------------------------------------------|
| SUCCESS         | Clearing the requested credential was successful.                          |
| FAILURE         | Some unexpected internal error occurred clearing the requested credential. |
| INVALID_COMMAND | One or more fields violate constraints or are invalid.                     |

#### 5.2.10.40.1. Credential Field

This field SHALL contain a credential structure that contains the [CredentialTypeEnum](#) and the credential index (0xFFFF for all credentials or 0 if not applicable) to clear. This SHALL be null if clearing all credential types otherwise it SHALL NOT be null.



Page 469



#### 5.2.10.41. UnboltDoor Command

This command causes the lock device to unlock the door without pulling the latch. This command includes an optional code for the lock. The door lock MAY require a code depending on the value of the [RequirePINForRemoteOperation](#) attribute.

**NOTE**

If the attribute `AutoRelockTime` is supported, the lock will transition to the locked state when the auto relock time has expired.

| ID | Name    | Type   | Constraint | Quality | Fallback | Conformance  |
|----|---------|--------|------------|---------|----------|--------------|
| 0  | PINCode | octstr |            |         |          | [COTA & PIN] |

##### 5.2.10.41.1. PINCode Field

See [Section 5.2.10.1.1, “PINCode Field”](#).

#### 5.2.10.42. SetAliroReaderConfig Command

This command allows communicating an Aliro Reader configuration, as defined in [\[Aliro\]](#), to the lock.

| ID | Name                     | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------------------------|--------|------------|---------|----------|-------------|
| 0  | <b>SigningKey</b>        | octstr | 32         |         |          | M           |
| 1  | <b>VerificationKey</b>   | octstr | 65         |         |          | M           |
| 2  | <b>GroupIdentifier</b>   | octstr | 16         |         |          | M           |
| 3  | <b>GroupResolvingKey</b> | octstr | 16         |         |          | ALBU        |

##### 5.2.10.42.1. SigningKey Field

This field SHALL indicate the signing key component of the Reader's key pair.

##### 5.2.10.42.2. VerificationKey Field

This field SHALL indicate the verification key component of the Reader's key pair. This SHALL be an uncompressed elliptic curve public key as defined in section 2.3.3 of [SEC 1](#).

##### 5.2.10.42.3. GroupIdentifier Field

This field SHALL indicate the reader group identifier for the lock.

##### 5.2.10.42.4. GroupResolvingKey Field

This field SHALL indicate the group resolving key for the lock.

Page 470







#### 5.2.10.42.5. Effect on Receipt

1. If the lock already has an Aliro Reader configuration defined, (i.e. the AliroReaderVerificationKey attribute is not null), the response SHALL be INVALID\_IN\_STATE.

**NOTE**

This avoids accidentally overwriting values that were just set by a different administrator. If overwriting those is desired, they should be explicitly cleared with the [ClearAliroReaderConfig](#) command.

2. Otherwise:

- a. The door lock server SHALL save the SigningKey internally.
- b. The AliroReaderVerificationKey attribute SHALL be set to the value of VerificationKey.
- c. The AliroReaderGroupIdentifier attribute SHALL be set to the value of GroupIdentifier.
- d. If the AliroBLEUWB feature is supported, the AliroGroupResolvingKey attribute SHALL be set to the value of GroupResolvingKey.
- e. The response SHALL be SUCCESS.

#### 5.2.10.43. ClearAliroReaderConfig Command

This command allows clearing an existing Aliro Reader configuration for the lock.

Administrators SHALL NOT clear an Aliro Reader configuration without explicit user permission.

**NOTE**

Using this command will revoke the ability of all existing Aliro user devices that have the old verification key to interact with the lock. This effect is not restricted to a single fabric or otherwise scoped in any way.

##### 5.2.10.43.1. Effect on Receipt

On receipt of this command:

1. The door lock server SHALL clear out the stored SigningKey.
2. The AliroReaderVerificationKey and AliroReaderGroupIdentifier attributes SHALL be set to null.
3. If the AliroBLEUWB feature is supported, the AliroGroupResolvingKey attribute SHALL be set to null.

#### 5.2.11. Events

This cluster SHALL support these events:

| ID   | Name             | Priority | Quality | Access | Conformance |
|------|------------------|----------|---------|--------|-------------|
| 0x00 | DoorLock-Alarm   | CRITICAL |         | V      | M           |
| 0x01 | DoorState-Change | desc     |         | V      | DPS         |




Page 471



| ID   | Name               | Priority | Quality | Access | Conformance |
|------|--------------------|----------|---------|--------|-------------|
| 0x02 | LockOperation      | desc     |         | V      | M           |
| 0x03 | LockOperationError | desc     |         | V      | M           |
| 0x04 | LockUserChange     | INFO     |         | V      | USR         |

The Events specified in this cluster are not intended to define the user experience. The events are only intended to define the metadata format used to notify any nodes that have subscribed for updates.

If the DoorState reported in the DoorStateChange event is not DoorClosed then the priority SHALL be CRITICAL; otherwise it MAY be INFO.

If the LockOperationType reported in the LockOperation event is Unlock or ForcedUserEvent then the priority SHALL be CRITICAL; otherwise it MAY be INFO.

If the OperationError reported in the LockOperationError event is DisabledUserDenied or the LockOperationType is Lock the priority SHALL be CRITICAL; otherwise it MAY be INFO.

#### 5.2.11.1. DoorLockAlarm Event

The door lock server provides several alarms which can be sent when there is a critical state on the door lock. The alarms available for the door lock server are listed in [AlarmCodeEnum](#).

The data of this event SHALL contain the following information:

| ID | Name      | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------|---------------|------------|---------|----------|-------------|
| 0  | AlarmCode | AlarmCodeEnum | all        |         |          | M           |

##### 5.2.11.1.1. AlarmCode Field

This field SHALL indicate the alarm code of the event that has happened.

#### 5.2.11.2. DoorStateChange Event

The door lock server sends out a DoorStateChange event when the door lock door state changes.

The data of this event SHALL contain the following information:

| ID | Name      | Type          | Constraint | Quality | Fallback | Conformance |
|----|-----------|---------------|------------|---------|----------|-------------|
| 0  | DoorState | DoorStateEnum | all        |         |          | M           |

Page 472







### 5.2.11.2.1. DoorState Field

This field SHALL indicate the new door state for this door event.

### 5.2.11.3. LockOperation Event

The door lock server sends out a LockOperation event when the event is triggered by the various lock operation sources.

The data of this event SHALL contain the following information:

| ID | Name                     | Type                                     | Constraint                               | Quality | Fallback | Conformance |
|----|--------------------------|------------------------------------------|------------------------------------------|---------|----------|-------------|
| 0  | <b>LockOperationType</b> | <a href="#">LockOperationType-Enum</a>   | all                                      |         |          | M           |
| 1  | <b>OperationSource</b>   | <a href="#">OperationSourceEnum</a>      | all                                      |         |          | M           |
| 2  | <b>UserIndex</b>         | uint16                                   | all                                      | X       |          | M           |
| 3  | <b>FabricIndex</b>       | fabric-idx                               | all                                      | X       |          | M           |
| 4  | <b>SourceNode</b>        | node-id                                  | all                                      | X       |          | M           |
| 5  | <b>Credentials</b>       | list[ <a href="#">CredentialStruct</a> ] | 1 to NumberOfCredentialsSupportedPerUser | X       |          | [USR]       |

- If the door lock server supports the [Unbolt Door](#) command, it SHALL generate a LockOperation event with LockOperationType set to Unlock after an Unbolt Door command succeeds.
- If the door lock server supports the [Unbolting](#) feature and an Unlock Door command is performed, it SHALL generate a LockOperation event with LockOperationType set to Unlatch when the unlatched state is reached and a LockOperation event with LockOperationType set to Unlock when the lock successfully completes the unlock → hold latch → release latch and return to unlock state operation.
- If the command fails during holding or releasing the latch but after passing the unlocked state, the door lock server SHALL generate a LockOperationError event with LockOperationType set to Unlatch and a LockOperation event with LockOperationType set to Unlock.
  - If it fails before reaching the unlocked state, the door lock server SHALL generate only a LockOperationError event with LockOperationType set to Unlock.
- Upon manual actuation, a door lock server that supports the [Unbolting](#) feature:
  - SHALL generate a LockOperation event of LockOperationType Unlatch when it is actuated from the outside.
  - MAY generate a LockOperation event of LockOperationType Unlatch when it is actuated




Page 473



from the inside.

#### 5.2.11.3.1. LockOperationType Field

This field SHALL indicate the type of the lock operation that was performed.

#### 5.2.11.3.2. OperationSource Field

This field SHALL indicate the source of the lock operation that was performed.

#### 5.2.11.3.3. UserIndex Field

This field SHALL indicate the UserIndex who performed the lock operation. This SHALL be null if there is no user index that can be determined for the given operation source. This SHALL NOT be null if a user index can be determined. In particular, this SHALL NOT be null if the operation was associated with a valid credential.

#### 5.2.11.3.4. FabricIndex Field

This field SHALL indicate the fabric index of the fabric that performed the lock operation. This SHALL be null if there is no fabric that can be determined for the given operation source. This SHALL NOT be null if the operation source is "Remote".

#### 5.2.11.3.5. SourceNode Field

This field SHALL indicate the Node ID of the node that performed the lock operation. This SHALL be null if there is no Node associated with the given operation source. This SHALL NOT be null if the operation source is "Remote".

#### 5.2.11.3.6. Credentials Field

This field SHALL indicate the list of credentials used in performing the lock operation. This SHALL be null if no credentials were involved.

### 5.2.11.4. LockOperationError Event

The door lock server sends out a LockOperationError event when a lock operation fails for various reasons.

The data of this event SHALL contain the following information:

| ID | Name              | Type                  | Constraint | Quality | Fallback | Conformance |
|----|-------------------|-----------------------|------------|---------|----------|-------------|
| 0  | LockOperationType | LockOperationTypeEnum | all        |         |          | M           |
| 1  | OperationSource   | OperationSourceEnum   | all        |         |          | M           |

Page 474







| ID | Name                  | Type                   | Constraint                               | Quality | Fallback | Conformance |
|----|-----------------------|------------------------|------------------------------------------|---------|----------|-------------|
| 2  | <b>OperationError</b> | OperationErrorEnum     | all                                      |         |          | M           |
| 3  | <b>UserIndex</b>      | uint16                 | all                                      | X       |          | M           |
| 4  | <b>FabricIndex</b>    | fabric-idx             | all                                      | X       |          | M           |
| 5  | <b>SourceNode</b>     | node-id                | all                                      | X       |          | M           |
| 6  | <b>Credentials</b>    | list[CredentialStruct] | 1 to NumberOfCredentialsSupportedPerUser | X       |          | [USR]       |

#### 5.2.11.4.1. LockOperationType Field

This field SHALL indicate the type of the lock operation that was performed.

#### 5.2.11.4.2. OperationSource Field

This field SHALL indicate the source of the lock operation that was performed.

#### 5.2.11.4.3. OperationError Field

This field SHALL indicate the lock operation error triggered when the operation was performed.

#### 5.2.11.4.4. UserIndex Field

This field SHALL indicate the lock UserIndex who performed the lock operation. This SHALL be null if there is no user id that can be determined for the given operation source.

#### 5.2.11.4.5. FabricIndex Field

This field SHALL indicate the fabric index of the fabric that performed the lock operation. This SHALL be null if there is no fabric that can be determined for the given operation source. This SHALL NOT be null if the operation source is "Remote".

#### 5.2.11.4.6. SourceNode Field

This field SHALL indicate the Node ID of the node that performed the lock operation. This SHALL be null if there is no Node associated with the given operation source. This SHALL NOT be null if the operation source is "Remote".

#### 5.2.11.4.7. Credentials Field

This field SHALL indicate the list of credentials used in performing the lock operation. This SHALL be null if no credentials were involved.




Page 475



### 5.2.11.5. LockUserChange Event

The door lock server sends out a LockUserChange event when a lock user, schedule, or credential change has occurred.

The data of this event SHALL contain the following information:

| ID | Name                     | Type                  | Constraint                         | Quality | Fallback | Conformance |
|----|--------------------------|-----------------------|------------------------------------|---------|----------|-------------|
| 0  | <b>LockDataType</b>      | LockDataTypeEnum      | all                                |         |          | M           |
| 1  | <b>DataOperationType</b> | DataOperationTypeEnum | all                                |         |          | M           |
| 2  | <b>OperationSource</b>   | OperationSourceEnum   | Aliro, Unspecified, Keypad, Remote |         |          | M           |
| 3  | <b>UserIndex</b>         | uint16                | all                                | X       |          | M           |
| 4  | <b>FabricIndex</b>       | fabric-idx            | all                                | X       |          | M           |
| 5  | <b>SourceNode</b>        | node-id               | all                                | X       |          | M           |
| 6  | <b>DataIndex</b>         | uint16                | all                                | X       |          | M           |

#### 5.2.11.5.1. LockDataType Field

This field SHALL indicate the lock data type that was changed.

#### 5.2.11.5.2. DataOperationType Field

This field SHALL indicate the data operation performed on the lock data type changed.

#### 5.2.11.5.3. OperationSource Field

This field SHALL indicate the source of the user data change.

#### 5.2.11.5.4. UserIndex Field

This field SHALL indicate the lock UserIndex associated with the change (if any). This SHALL be null if there is no specific user associated with the data operation. This SHALL be 0xFFFF if all users are affected (e.g. Clear Users).

#### 5.2.11.5.5. FabricIndex Field

This field SHALL indicate the fabric index of the fabric that performed the change (if any). This SHALL be null if there is no fabric that can be determined to have caused the change. This SHALL NOT be null if the operation source is "Remote".

Page 476







#### 5.2.11.5.6. SourceNode Field

This field SHALL indicate the Node ID that performed the change (if any). The Node ID of the node that performed the change. This SHALL be null if there was no Node involved in the change. This SHALL NOT be null if the operation source is "Remote".

#### 5.2.11.5.7. DataIndex Field

This field SHALL indicate the index of the specific item that was changed (e.g. schedule, PIN, RFID, etc.) in the list of items identified by LockDataType. This SHALL be null if the LockDataType does not correspond to a list that can be indexed into (e.g. ProgrammingUser). This SHALL be 0xFFFF if all indices are affected (e.g. ClearPINCode, ClearRFIDCode, ClearWeekDaySchedule, ClearYearDaySchedule, etc.).

### 5.3. Window Covering Cluster

The window covering cluster provides an interface for controlling and adjusting automatic window coverings such as drapery motors, automatic shades, curtains and blinds.

#### 5.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                                               |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added; CCB 1994 1995 1996 1997 2086 2094 2095 2096 2097                                        |
| 2        | CCB 2328                                                                                                                                  |
| 3        | CCB 2477 2555 2845 3028                                                                                                                   |
| 4        | All Hubs changes with FeatureMap & OperationalStatus attribute                                                                            |
| 5        | New data model format and notation. Created plus clarified PositionAware and AbsolutePosition features. General cleanup of functionality. |
| 6        | Marked AbsolutePosition feature and associated elements provisional.                                                                      |
| 7        | Removed ABS feature and all associated elements from the cluster since it is disallowed by the Window Covering Device Type.               |

#### 5.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | WNCV      |




Page 477



### 5.3.3. Cluster ID

| ID     | Name            |
|--------|-----------------|
| 0x0102 | Window Covering |

### 5.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code  | Feature           | Conformance | Summary                                                        |
|-----|-------|-------------------|-------------|----------------------------------------------------------------|
| 0   | LF    | Lift              | O.a+        | Lift control and behavior for lifting/sliding window coverings |
| 1   | TL    | Tilt              | O.a+        | Tilt control and behavior for tilting window coverings         |
| 2   | PA_LF | PositionAwareLift | [LF]        | Position aware lift control is supported.                      |
| 4   | PA_TL | PositionAwareTilt | [TL]        | Position aware tilt control is supported.                      |

Due to backward compatibility reasons this feature map SHALL match the advertised Type Attribute Supported Features.

#### 5.3.4.1. Lift Feature

The Lift feature applies to window coverings that lift up and down (e.g. for a roller shade, Up and Down is lift Open and Close) or slide left to right (e.g. for a sliding curtain, Left and Right is lift Open and Close).

#### 5.3.4.2. Tilt Feature

The Tilt feature applies to window coverings with vertical or horizontal strips.

#### 5.3.4.3. PositionAware Features

Relative positioning with *percent100ths* (min step 0.01%) attribute is mandatory, e.g. Max 10000 equals 100.00% and relative positioning with *percent* (min step 1%) attribute is for backward compatibility.

The *CurrentPosition* attributes SHALL always reflects the physical position of an actuator and the *TargetPosition* attribute SHALL reflect the requested position of an actuator once a positioning command is received.

Page 478







#### 5.3.4.3.1. PositionAwareLift Feature

Relative positioning for lift attributes and commands.

#### 5.3.4.3.2. PositionAwareTilt Feature

Relative positioning for tilt attributes and commands.

#### 5.3.4.4. AbsolutePosition Feature

The percentage attributes SHALL indicate the position as a percentage between the InstalledOpenLimits and InstalledClosedLimits attributes of the window covering starting at the open (0.00%).

As a general rule, absolute positioning (in centimeters or tenth of a degrees) SHOULD NOT be supported for new implementations.

### 5.3.5. Data Types

#### 5.3.5.1. ConfigStatusBitmap Type

This data type is derived from map8.

| Bit | Name                         | Summary                                          | Conformance |
|-----|------------------------------|--------------------------------------------------|-------------|
| 0   | <b>Operational</b>           | Device is operational.                           | M           |
| 1   | <b>OnlineReserved</b>        |                                                  | D           |
| 2   | <b>LiftMovementReversed</b>  | The lift movement is reversed.                   | LF          |
| 3   | <b>LiftPositionAware</b>     | Supports the Position-AwareLift feature (PA_LF). | PA_LF       |
| 4   | <b>TiltPositionAware</b>     | Supports the Position-AwareTilt feature (PA_TL). | PA_TL       |
| 5   | <b>LiftEncoderControlled</b> | Uses an encoder for lift.                        | PA_LF       |
| 6   | <b>TiltEncoderControlled</b> | Uses an encoder for tilt.                        | PA_TL       |

##### 5.3.5.1.1. Operational Bit

This bit SHALL indicate whether the window covering is operational for regular use:

- 0 = Not Operational
- 1 = Operational

##### 5.3.5.1.2. LiftMovementReversed Bit

This bit SHALL indicate whether the lift movement is reversed:



Page 479



- 0 = Lift movement is normal
- 1 = Lift movement is reversed

#### 5.3.5.1.3. LiftPositionAware Bit

This bit SHALL indicate whether the window covering supports the PositionAwareLift feature:

- 0 = Lift control is not position aware
- 1 = Lift control is position aware (PA\_LF)

#### 5.3.5.1.4. TiltPositionAware Bit

This bit SHALL indicate whether the window covering supports the PositionAwareTilt feature:

- 0 = Tilt control is not position aware
- 1 = Tilt control is position aware (PA\_TL)

#### 5.3.5.1.5. LiftEncoderControlled Bit

This bit SHALL indicate whether a position aware controlled window covering is employing an encoder for positioning the height of the window covering:

- 0 = Timer Controlled
- 1 = Encoder Controlled

#### 5.3.5.1.6. TiltEncoderControlled Bit

This bit SHALL indicate whether a position aware controlled window covering is employing an encoder for tilting the window covering:

- 0 = Timer Controlled
- 1 = Encoder Controlled

### 5.3.5.2. ModeBitmap Type

This data type is derived from map8.

| Bit | Name                          | Summary                             | Conformance |
|-----|-------------------------------|-------------------------------------|-------------|
| 0   | <b>MotorDirectionReversed</b> | Reverse the lift direction.         | M           |
| 1   | <b>CalibrationMode</b>        | Perform a calibration.              | M           |
| 2   | <b>MaintenanceMode</b>        | Freeze all motions for maintenance. | M           |
| 3   | <b>LedFeedback</b>            | Control the LEDs feedback.          | M           |

Page 480







#### 5.3.5.2.1. MotorDirectionReversed Bit

This bit SHALL control the motor direction:

- 0 = Lift movement is normal
- 1 = Lift movement is reversed

#### 5.3.5.2.2. CalibrationMode Bit

This bit SHALL set the window covering into calibration mode:

- 0 = Normal mode
- 1 = Calibration mode

#### 5.3.5.2.3. MaintenanceMode Bit

This bit SHALL set the window covering into maintenance mode:

- 0 = Normal mode
- 1 = Maintenance mode

#### 5.3.5.2.4. LedFeedback Bit

This bit SHALL control feedback LEDs:

- 0 = LEDs are off
- 1 = LEDs will display feedback

### 5.3.5.3. OperationalStatusBitmap Type

This data type is derived from map8.

| Bit  | Name   | Summary                   | Conformance |
|------|--------|---------------------------|-------------|
| 1..0 | Global | Global operational state. | M           |
| 3..2 | Lift   | Lift operational state.   | LF          |
| 5..4 | Tilt   | Tilt operational state.   | TL          |

The [OperationalStatusBitmap](#) is using several internal operational state fields (composed of 2 bits) following this definition:

- 00b = Currently not moving
- 01b = Currently opening (e.g. moving from closed to open).
- 10b = Currently closing (e.g. moving from open to closed).
- 11b = Reserved



Page 481



#### 5.3.5.3.1. Global Bits

These bits SHALL indicate in which direction the covering is currently moving or if it has stopped. Global operational state SHALL always reflect the overall motion of the device.

#### 5.3.5.3.2. Lift Bits

These bits SHALL indicate in which direction the covering's lift is currently moving or if it has stopped.

#### 5.3.5.3.3. Tilt Bits

These bits SHALL indicate in which direction the covering's tilt is currently moving or if it has stopped.

#### 5.3.5.4. SafetyStatusBitmap Type

This data type is derived from map16.

| Bit | Name                       | Summary                                                                                                                           | Conformance |
|-----|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0   | <b>RemoteLockout</b>       | Movement commands are ignored (locked out). e.g. not granted authorization, outside some time/date range.                         | M           |
| 1   | <b>TamperDetection</b>     | Tampering detected on sensors or any other safety equipment. Ex: a device has been forcibly moved without its actuator(s).        | M           |
| 2   | <b>FailedCommunication</b> | Communication failure to sensors or other safety equipment.                                                                       | M           |
| 3   | <b>PositionFailure</b>     | Device has failed to reach the desired position. e.g. with position aware device, time expired before Target-Position is reached. | M           |
| 4   | <b>ThermalProtection</b>   | Motor(s) and/or electric circuit thermal protection activated.                                                                    | M           |
| 5   | <b>ObstacleDetected</b>    | An obstacle is preventing actuator movement.                                                                                      | M           |

Page 482



| Bit | Name                   | Summary                                                                                                                                                  | Conformance |
|-----|------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 6   | <b>Power</b>           | Device has power related issue or limitation e.g. device is running w/ the help of a backup battery or power might not be fully available at the moment. | M           |
| 7   | <b>StopInput</b>       | Local safety sensor (not a direct obstacle) is preventing movements (e.g. Safety EU Standard EN60335).                                                   | M           |
| 8   | <b>MotorJammed</b>     | Mechanical problem related to the motor(s) detected.                                                                                                     | M           |
| 9   | <b>HardwareFailure</b> | PCB, fuse and other electrics problems.                                                                                                                  | M           |
| 10  | <b>ManualOperation</b> | Actuator is manually operated and is preventing actuator movement (e.g. actuator is disengaged/decoupled).                                               | M           |
| 11  | <b>Protection</b>      | Protection is activated.                                                                                                                                 | M           |

### 5.3.5.5. TypeEnum Type

This data type is derived from enum8.

| Value | Name                             | Summary                          | Conformance |
|-------|----------------------------------|----------------------------------|-------------|
| 0     | <b>RollerShade</b>               | RollerShade                      | M           |
| 1     | <b>RollerShade2Motor</b>         | RollerShade - 2 Motor            | M           |
| 2     | <b>RollerShadeExterior</b>       | RollerShade - Exterior           | M           |
| 3     | <b>RollerShadeExterior2Motor</b> | RollerShade - Exterior - 2 Motor | M           |
| 4     | <b>Drapery</b>                   | Drapery (curtain)                | M           |
| 5     | <b>Awning</b>                    | Awning                           | M           |
| 6     | <b>Shutter</b>                   | Shutter                          | M           |
| 7     | <b>TiltBlindTiltOnly</b>         | Tilt Blind - Tilt Only           | M           |
| 8     | <b>TiltBlindLiftAndTilt</b>      | Tilt Blind - Lift & Tilt         | M           |



Page 483



| Value | Name                   | Summary          | Conformance |
|-------|------------------------|------------------|-------------|
| 9     | <b>ProjectorScreen</b> | Projector Screen | M           |
| 255   | <b>Unknown</b>         | Unknown          | M           |

### 5.3.5.6. EndProductTypeEnum Type

This data type is derived from enum8.

| Value | Name                             | Summary                       | Conformance |
|-------|----------------------------------|-------------------------------|-------------|
| 0     | <b>RollerShade</b>               | Simple Roller Shade           | M           |
| 1     | <b>RomanShade</b>                | Roman Shade                   | M           |
| 2     | <b>BalloonShade</b>              | Balloon Shade                 | M           |
| 3     | <b>WovenWood</b>                 | Woven Wood                    | M           |
| 4     | <b>PleatedShade</b>              | Pleated Shade                 | M           |
| 5     | <b>CellularShade</b>             | Cellular Shade                | M           |
| 6     | <b>LayeredShade</b>              | Layered Shade                 | M           |
| 7     | <b>LayeredShade2D</b>            | Layered Shade 2D              | M           |
| 8     | <b>SheerShade</b>                | Sheer Shade                   | M           |
| 9     | <b>TiltOnlyInteriorBlind</b>     | Tilt Only Interior Blind      | M           |
| 10    | <b>InteriorBlind</b>             | Interior Blind                | M           |
| 11    | <b>VerticalBlindStripCurtain</b> | Vertical Blind, Strip Curtain | M           |
| 12    | <b>InteriorVenetianBlind</b>     | Interior Venetian Blind       | M           |
| 13    | <b>ExteriorVenetianBlind</b>     | Exterior Venetian Blind       | M           |
| 14    | <b>LateralLeftCurtain</b>        | Lateral Left Curtain          | M           |
| 15    | <b>LateralRightCurtain</b>       | Lateral Right Curtain         | M           |
| 16    | <b>CentralCurtain</b>            | Central Curtain               | M           |
| 17    | <b>RollerShutter</b>             | Roller Shutter                | M           |
| 18    | <b>ExteriorVerticalScreen</b>    | Exterior Vertical Screen      | M           |
| 19    | <b>AwningTerracePatio</b>        | Awning Terrace (Patio)        | M           |
| 20    | <b>AwningVerticalScreen</b>      | Awning Vertical Screen        | M           |
| 21    | <b>TiltOnlyPergola</b>           | Tilt Only Pergola             | M           |
| 22    | <b>SwingingShutter</b>           | Swinging Shutter              | M           |
| 23    | <b>SlidingShutter</b>            | Sliding Shutter               | M           |
| 255   | <b>Unknown</b>                   | Unknown                       | M           |

Page 484



## 5.3.6. Attributes

| ID     | Name                                          | Type                    | Constraint | Quality | Fallback | Access | Conformance  |
|--------|-----------------------------------------------|-------------------------|------------|---------|----------|--------|--------------|
| 0x0000 | Type                                          | TypeEnum                | desc       | F       | 0        | R V    | M            |
| 0x0005 | NumberOfActuationsLift                        | uint16                  | all        | N       | 0        | R V    | [LF]         |
| 0x0006 | NumberO-fActuationsTilt                       | uint16                  | all        | N       | 0        | R V    | [TL]         |
| 0x0007 | ConfigStatus                                  | ConfigStatusBitmap      | desc       | N       | desc     | R V    | M            |
| 0x0008 | Current-Position-LiftPercentage <sup>1</sup>  | percent                 |            | N P X   | null     | R V    | [LF & PA_LF] |
| 0x0009 | Current-Position-TiltPercentage <sup>1</sup>  | percent                 | all        | N P X   | null     | R V    | [TL & PA_TL] |
| 0x000A | OperationalStatus                             | OperationalStatusBitmap | max 63     | P       | 0        | R V    | M            |
| 0x000B | TargetPositionLift-Percent100ths <sub>2</sub> | per-cent100ths          |            | P X     | null     | R V    | LF & PA_LF   |
| 0x000C | TargetPositionTilt-Percent100ths <sub>2</sub> | per-cent100ths          |            | P X     | null     | R V    | TL & PA_TL   |
| 0x000D | EndProductType                                | EndProductTypeEnum      | desc       | F       | 0        | R V    | M            |
| 0x000E | Current-Position-LiftPercent100ths            | per-cent100ths          | max 10000  | N P X   | null     | R V    | LF & PA_LF   |



Page 485



| ID     | Name                                      | Type               | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------------------------------|--------------------|------------|---------|----------|--------|-------------|
| 0x000F | <b>Current-Position-TiltPercent100ths</b> | percent100ths      | max 10000  | N P X   | null     | R V    | TL & PA_TL  |
| 0x0017 | <b>Mode</b>                               | ModeBitmap         | max 15     | N       | 0        | RW VM  | M           |
| 0x001A | <b>SafetyStatus</b>                       | SafetyStatusBitmap | desc       | P       | 0        | R V    | O           |

|             |                                                                                                   |
|-------------|---------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | <i>Nullable positions</i>                                                                         |
|             | 1 - The null value indicates that the current position is unknown, e.g. calibration is needed.    |
|             | 2 - The null value indicates that the value is unavailable, e.g. no target position has been set. |

#### 5.3.6.1. Type Attribute

This attribute SHALL identify the type of window covering.

If the window covering supports the LF feature and not the TL feature, the following types SHALL be used as the constraint for this attribute:

| Value | Name                             |
|-------|----------------------------------|
| 0     | <b>RollerShade</b>               |
| 1     | <b>RollerShade2Motor</b>         |
| 2     | <b>RollerShadeExterior</b>       |
| 3     | <b>RollerShadeExterior2Motor</b> |
| 4     | <b>Drapery</b>                   |
| 5     | <b>Awning</b>                    |
| 6     | <b>Shutter</b>                   |
| 9     | <b>ProjectorScreen</b>           |
| 255   | <b>Unknown</b>                   |

If the window covering supports the TL feature and not the LF feature, the following types SHALL be used as the constraint for this attribute:

| Value | Name                     |
|-------|--------------------------|
| 6     | <b>Shutter</b>           |
| 7     | <b>TiltBlindTiltOnly</b> |

Page 486







| Value | Name    |
|-------|---------|
| 255   | Unknown |

If the window covering supports both the LF and TL features, the following types are allowed to be used:

| Value | Name                 |
|-------|----------------------|
| 8     | TiltBlindLiftAndTilt |
| 255   | Unknown              |

#### 5.3.6.2. NumberOfActuationsLift Attribute

This attribute SHALL indicate the total number of lift/slide actuations applied to the window covering since the device was installed.

#### 5.3.6.3. NumberOfActuationsTilt Attribute

This attribute SHALL indicate the total number of tilt actuations applied to the window covering since the device was installed.

#### 5.3.6.4. ConfigStatus Attribute

This attribute specifies the configuration and status information of the window covering.

To change settings, devices SHALL write to the Mode attribute. The behavior causing the setting or clearing of each bit is vendor specific.

##### 5.3.6.4.1. Operational Bit

The [SafetyStatus](#) & [Mode](#) attributes might affect this bit state.

##### 5.3.6.4.2. LiftMovementReversed Bit

This bit identifies if the directions of the lift/slide movements have been reversed in order for commands (e.g: Open, Close, GoTos) to match the physical installation conditions

This bit can be adjusted by setting the [MotorDirectionReversed](#) bit in the [Mode](#) attribute.

##### 5.3.6.4.3. LiftEncoderControlled Bit

This bit is ignored if the device does not support the PositionAwareLift feature (PA\_LF).

##### 5.3.6.4.4. TiltEncoderControlled Bit

This bit is ignored if the device does not support the PositionAwareTilt feature (PA\_TL).

#### 5.3.6.5. CurrentPositionLiftPercent100ths Attribute

This attribute SHALL indicate the actual position as a percentage with a minimal step of 0.01%. E.g Max 10000 equals 100.00%.



Page 487



#### 5.3.6.6. CurrentPositionTiltPercent100ths Attribute

This attribute SHALL indicate the actual position as a percentage with a minimal step of 0.01%. E.g Max 10000 equals 100.00%.

#### 5.3.6.7. CurrentPositionLiftPercentage Attribute

This attribute SHALL indicate the actual position as a percentage from 0% to 100% with 1% default step. This attribute is equal to CurrentPositionLiftPercent100ths attribute divided by 100.

#### 5.3.6.8. CurrentPositionTiltPercentage Attribute

This attribute SHALL indicate the actual position as a percentage from 0% to 100% with 1% default step. This attribute is equal to CurrentPositionTiltPercent100ths attribute divided by 100.

#### 5.3.6.9. TargetPositionLiftPercent100ths Attribute

This attribute SHALL indicate the position where the window covering lift will go or is moving to as a percentage (Unit 0.01%).

#### 5.3.6.10. TargetPositionTiltPercent100ths Attribute

This attribute SHALL indicate the position where the window covering tilt will go or is moving to as a percentage (Unit 0.01%).

#### 5.3.6.11. OperationalStatus Attribute

This attribute SHALL indicate the currently ongoing operations and applies to all type of devices.

#### 5.3.6.12. EndProductType Attribute

This attribute SHOULD provide more detail about the product type than can be determined from the main category indicated by the Type attribute.

If the window covering supports the LF feature and not the TL feature, the following types SHALL be used as the constraint for this attribute:

| Value | Name               |
|-------|--------------------|
| 0     | RollerShade        |
| 1     | RomanShade         |
| 2     | BalloonShade       |
| 3     | WovenWood          |
| 4     | PleatedShade       |
| 5     | CellularShade      |
| 6     | LayeredShade       |
| 7     | LayeredShade2D     |
| 14    | LateralLeftCurtain |

Page 488



| <b>Value</b> | <b>Name</b>                   |
|--------------|-------------------------------|
| 15           | <b>LateralRightCurtain</b>    |
| 16           | <b>CentralCurtain</b>         |
| 17           | <b>RollerShutter</b>          |
| 18           | <b>ExteriorVerticalScreen</b> |
| 19           | <b>AwningTerracePatio</b>     |
| 20           | <b>AwningVerticalScreen</b>   |
| 21           | <b>TiltOnlyPergola</b>        |
| 22           | <b>SwingingShutter</b>        |
| 23           | <b>SlidingShutter</b>         |
| 255          | <b>Unknown</b>                |

If the window covering supports the TL feature and not the LF feature, the following types SHALL be used as the constraint for this attribute:

| <b>Value</b> | <b>Name</b>                  |
|--------------|------------------------------|
| 9            | <b>TiltOnlyInteriorBlind</b> |
| 21           | <b>TiltOnlyPergola</b>       |
| 22           | <b>SwingingShutter</b>       |
| 23           | <b>SlidingShutter</b>        |
| 255          | <b>Unknown</b>               |

If the window covering supports both the LF and TL features, the following types are allowed to be used:

| <b>Value</b> | <b>Name</b>                      |
|--------------|----------------------------------|
| 8            | <b>SheerShade</b>                |
| 10           | <b>InteriorBlind</b>             |
| 11           | <b>VerticalBlindStripCurtain</b> |
| 12           | <b>InteriorVenetianBlind</b>     |
| 13           | <b>ExteriorVenetianBlind</b>     |
| 255          | <b>Unknown</b>                   |

The table below helps to match the [EndProductType](#) attribute with the [Type](#) attribute.

| <b>Value</b> | <b>Name</b>        | <b>Indoor Outdoor</b> | <b>Indicative Dimension</b> | <b>Recommended Type Attribute</b> |
|--------------|--------------------|-----------------------|-----------------------------|-----------------------------------|
| 0            | <b>RollerShade</b> | I                     | 1D                          | RollerShade                       |
| 1            | <b>RomanShade</b>  | I                     | 1D                          | RollerShade                       |



Page 489



| Value | Name                       | Indoor Outdoor | Indicative Dimension | Recommended Type Attribute |
|-------|----------------------------|----------------|----------------------|----------------------------|
| 2     | BalloonShade               | I              | 1D                   | RollerShade                |
| 3     | WovenWood                  | I              | 1D                   | RollerShade                |
| 4     | PleatedShade               | I              | 1D                   | RollerShade                |
| 5     | CellularShade              | I              | 1D                   | RollerShade                |
| 6     | LayeredShade               | I              | 1D                   | RollerShade                |
| 7     | LayeredShade2D             | I              | 2D                   | RollerShade2Motor          |
| 8     | SheerShade                 | I              | 2D                   | TiltBlindLiftAndTilt       |
| 9     | TiltOnlyInteriorBlind      | I              | 1D                   | TiltBlindTiltOnly          |
| 10    | InteriorBlind              | I              | 2D                   | TiltBlindLiftAndTilt       |
| 11    | VerticalBlind-StripCurtain | I              | 2D                   | TiltBlindLiftAndTilt       |
| 12    | InteriorVenetianBlind      | I              | 2D                   | TiltBlindLiftAndTilt       |
| 13    | ExteriorVenetianBlind      | O              | 2D                   | TiltBlindLiftAndTilt       |
| 14    | LateralLeftCurtain         | I              | 1D                   | Drapery                    |
| 15    | LateralRightCurtain        | I              | 1D                   | Drapery                    |
| 16    | CentralCurtain             | I              | 1D                   | Drapery                    |
| 17    | RollerShutter              | O              | 1D                   | RollerShadeExterior        |
| 18    | ExteriorVerticalScreen     | O              | 1D                   | RollerShadeExterior        |
| 19    | AwningsTerracePatio        | O              | 1D                   | Awnings                    |
| 20    | AwningsVerticalScreen      | O              | 1D                   | Awnings                    |
| 21    | TiltOnlyPergola            | O              | 1D                   | Shutter                    |
| 22    | SwingingShutter            | O              | 1D                   | Shutter                    |
| 23    | SlidingShutter             | O              | 1D                   | Shutter                    |
| 255   | Unknown                    |                |                      | Unknown                    |

Page 490







### 5.3.6.13. Mode Attribute

The Mode attribute allows configuration of the window covering, such as: reversing the motor direction, placing the window covering into calibration mode, placing the motor into maintenance mode, disabling the network, and disabling status LEDs.

In the case a device does not support or implement a specific mode, e.g. the device has a specific installation method and reversal is not relevant or the device does not include a maintenance mode, any write interaction to the Mode attribute, with an unsupported mode bit or any out of bounds bits set, must be ignored and a response containing the status of CONSTRAINT\_ERROR will be returned.

#### 5.3.6.13.1. MotorDirectionReversed Bit

This bit SHALL control the [LiftMovementReversed](#) bit in the [ConfigStatus](#) attribute.

#### 5.3.6.13.2. CalibrationMode Bit

If in calibration mode, all commands (e.g: UpOrOpen, DownOrClose, GoTos) that can result in movement, could be accepted and result in a self-calibration being initiated before the command is executed.

In case the window covering does not have the ability or is not able to perform a self-calibration, the command SHOULD be ignored and a FAILURE status SHOULD be returned.

In a write interaction, setting this bit to 0, while the device is in calibration mode, is not allowed and SHALL generate a FAILURE error status. In order to leave calibration mode, the device must perform its calibration routine, either as a self-calibration or assisted by external tool(s), depending on the device/manufacturer implementation.

A manufacturer might choose to set the [Operational](#) bit of the [ConfigStatus](#) attribute to its not operational value, if applicable during calibration mode.

#### 5.3.6.13.3. MaintenanceMode Bit

While in maintenance mode, all commands (e.g: UpOrOpen, DownOrClose, GoTos) or local inputs that can result in movement, must be ignored and respond with a BUSY status. Additionally, the [Operational](#) bit of the [ConfigStatus](#) attribute should be set to its not operational value.

### 5.3.6.14. SafetyStatus Attribute

The SafetyStatus attribute reflects the state of the safety sensors and the common issues preventing movements. By default for nominal operation all flags are cleared (0). A device might support none, one or several bit flags from this attribute (all optional).

## 5.3.7. Commands

| ID   | Name                        | Direction                   | Response | Access | Conformance |
|------|-----------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <a href="#">UpOrOpen</a>    | client $\Rightarrow$ server | Y        | O      | M           |
| 0x01 | <a href="#">DownOrClose</a> | client $\Rightarrow$ server | Y        | O      | M           |



Page 491



| ID   | Name               | Direction                   | Response | Access | Conformance           |
|------|--------------------|-----------------------------|----------|--------|-----------------------|
| 0x02 | StopMotion         | client $\Rightarrow$ server | Y        | O      | M                     |
| 0x05 | GoToLiftPercentage | client $\Rightarrow$ server | Y        | O      | (LF & PA_LF),<br>[LF] |
| 0x08 | GoToTiltPercentage | client $\Rightarrow$ server | Y        | O      | (TL & PA_TL),<br>[TL] |

### 5.3.7.1. UpOrOpen Command

Upon receipt of this command, the window covering will adjust its position so the physical lift/slide and tilt is at the maximum open/up position. This will happen as fast as possible. The server attributes SHALL be updated as follows:

if the PositionAware feature is supported:

- TargetPositionLiftPercent100ths attribute SHALL be set to 0.00%.
- TargetPositionTiltPercent100ths attribute SHALL be set to 0.00%.

The server positioning attributes will follow the movements, once the movement has successfully finished, the server attributes SHALL be updated as follows:

if the PositionAware feature is supported:

- CurrentPositionLiftPercent100ths attribute SHALL be 0.00%.
- CurrentPositionLiftPercentage attribute SHALL be 0%.
- CurrentPositionTiltPercent100ths attribute SHALL be 0.00%.
- CurrentPositionTiltPercentage attribute SHALL be 0%.

if the AbsolutePosition feature is supported:

- CurrentPositionLift attribute SHALL be equal to the InstalledOpenLimitLift attribute.
- CurrentPositionTilt attribute SHALL be equal to the InstalledOpenLimitTilt attribute.

### 5.3.7.2. DownOrClose Command

Upon receipt of this command, the window covering will adjust its position so the physical lift/slide and tilt is at the maximum closed/down position. This will happen as fast as possible. The server attributes supported SHALL be updated as follows:

if the PositionAware feature is supported:

- TargetPositionLiftPercent100ths attribute SHALL be set to 100.00%.
- TargetPositionTiltPercent100ths attribute SHALL be set to 100.00%.

The server positioning attributes will follow the movements, once the movement has successfully finished, the server attributes SHALL be updated as follows:

Page 492



if the PositionAware feature is supported:

- CurrentPositionLiftPercent100ths attribute SHALL be 100.00%.
- CurrentPositionLiftPercentage attribute SHALL be 100%.
- CurrentPositionTiltPercent100ths attribute SHALL be 100.00%.
- CurrentPositionTiltPercentage attribute SHALL be 100%.

if the AbsolutePosition feature is supported:

- CurrentPositionLift attribute SHALL be equal to the InstalledClosedLimitLift attribute.
- CurrentPositionTilt attribute SHALL be equal to the InstalledClosedLimitTilt attribute.

### 5.3.7.3. StopMotion Command

Upon receipt of this command, the window covering will stop any adjusting to the physical tilt and lift/slide that is currently occurring. The server attributes supported SHALL be updated as follows:

- TargetPositionLiftPercent100ths attribute will be set to CurrentPositionLiftPercent100ths attribute value.
- TargetPositionTiltPercent100ths attribute will be set to CurrentPositionTiltPercent100ths attribute value.

### 5.3.7.4. GoToLiftPercentage Command

This command is used to set the target lift position of the window covering to the percentage value specified in the command.

| ID | Name                   | Type          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|---------------|------------|---------|----------|-------------|
| 0  | LiftPercent100thsValue | percent100ths | desc       |         |          | M           |

Upon receipt of this command, the server will adjust the window covering to the lift/slide percentage specified in the payload of this command.

If the command includes LiftPercent100thsValue, then TargetPositionLiftPercent100ths attribute SHALL be set to LiftPercent100thsValue. Otherwise the TargetPositionLiftPercent100ths attribute SHALL be set to LiftPercentageValue \* 100.

If a client includes LiftPercent100thsValue in the command, the LiftPercentageValue SHALL be set to LiftPercent100thsValue / 100, so a legacy server which only supports LiftPercentageValue (not LiftPercent100thsValue) has a value to set the target position.

If the server does not support the PositionAware feature, then a zero percentage SHALL be treated as a UpOrOpen command and a non-zero percentage SHALL be treated as an DownOrClose command. If the device is only a tilt control device, then the command SHOULD be ignored and a UNSUPPORTED\_COMMAND status SHOULD be returned.




Page 493



### 5.3.7.5. GoToTiltPercentage Command

This command is used to set the target tilt position of the window covering to the percentage value specified in the command.

| ID | Name                   | Type          | Constraint | Quality | Fallback | Conformance |
|----|------------------------|---------------|------------|---------|----------|-------------|
| 0  | TiltPercent100thsValue | percent100ths | desc       |         |          | M           |

Upon receipt of this command, the server will adjust the window covering to the tilt percentage specified in the payload of this command.

If the command includes TiltPercent100thsValue, then TargetPositionTiltPercent100ths attribute SHALL be set to TiltPercent100thsValue. Otherwise the TargetPositionTiltPercent100ths attribute SHALL be set to TiltPercentageValue \* 100.

If a client includes TiltPercent100thsValue in the command, the TiltPercentageValue SHALL be set to TiltPercent100thsValue / 100, so a legacy server which only supports TiltPercentageValue (not TiltPercent100thsValue) has a value to set the target position.

If the server does not support the PositionAware feature, then a zero percentage SHALL be treated as a UpOrOpen command and a non-zero percentage SHALL be treated as an DownOrClose command. If the device is only a tilt control device, then the command SHOULD be ignored and a UNSUPPORTED\_COMMAND status SHOULD be returned.

## 5.4. Closure Control Cluster

This cluster provides an interface for controlling a Closure.

### 5.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Rev | Description      |
|-----|------------------|
| 1   | Initial revision |

### 5.4.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | CLCTRL    |

### 5.4.3. Cluster ID

Page 494







| ID     | Name            |
|--------|-----------------|
| 0x0104 | Closure Control |

#### 5.4.4. Association Between Closure Control and Closure Dimension Clusters

Some device types MAY define that a Closure Dimension cluster instance is associated with a Closure Control cluster instance on the same device. In such cases, the Closure Control cluster acts as the supervisory and coordination logic for the closure system. Where this association is specified, commands originating from Closure Dimension cluster instances MAY impact the operational logic and state management of the associated Closure Control cluster. Implementers SHALL ensure that, where such an association exists, all relevant behaviors governed by the Closure Control cluster are maintained, and that interactions initiated by Closure Dimension cluster commands are properly integrated and reflected in the Closure Control cluster's logic.

#### 5.4.5. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature        | Conformance | Summary                                                                                         |
|-----|------|----------------|-------------|-------------------------------------------------------------------------------------------------|
| 0   | PS   | Positioning    | O.a+        | Supports Positioning with at least Fully Opened (0%) and Fully Closed (100%) discrete positions |
| 1   | LT   | MotionLatching | O.a+        | Supports a latch (securing a position, or a state)                                              |
| 2   | IS   | Instantaneous  | O           | Supports the Instantaneous feature                                                              |
| 3   | SP   | Speed          | [PS & !IS]  | Supports Speed motion throttling                                                                |
| 4   | VT   | Ventilation    | [PS]        | Supports Ventilation discrete state                                                             |
| 5   | PD   | Pedestrian     | [PS]        | Supports Pedestrian discrete state                                                              |
| 6   | CL   | Calibration    | [PS]        | Supports the Calibration feature                                                                |
| 7   | PT   | Protection     | O           | Supports the Protection feature                                                                 |



Page 495



| Bit | Code | Feature          | Conformance | Summary                               |
|-----|------|------------------|-------------|---------------------------------------|
| 8   | MO   | ManuallyOperable | 0           | Supports the manual operation feature |

#### 5.4.5.1. Positioning Feature

This feature SHALL indicate that the closure can be set to discrete positions, including at minimum the FullyOpen and FullyClosed positions.

#### 5.4.5.2. MotionLatching Feature

This feature SHALL indicate that the closure can be latched and unlatched. When latched, the feature secures an axis, preventing associated actuators from moving components along that axis.

#### 5.4.5.3. Instantaneous Feature

This feature SHALL indicate that the closure is capable of changing its position or state instantaneously. As a result, the Speed feature is not applicable, and the [Stop](#) command is not usable. In such closures, the OverallCurrentState attribute SHALL immediately follow the OverallTargetState attribute. The state transition diagram remains applicable, however, transitions involving the Stop state SHALL be omitted.

#### 5.4.5.4. Speed Feature

This feature SHALL indicate that the closure supports configurable speed during motion toward a target position. The feature uses the values in ThreeLevelAutoEnum to set the supported speed levels.

##### 5.4.5.4.1. Low Value

This setting prioritizes quiet operation and is typically used in silent mode. It minimizes noise from the closure product, making it ideal for environments where discretion or minimal disturbance is important, such as during nighttime operation or in quiet settings.

##### 5.4.5.4.2. Medium Value

The most commonly used speed for everyday use. It offers a balanced performance with reliable operation and moderate noise levels, suitable for general tasks in typical working conditions.

##### 5.4.5.4.3. High Value

Designed for time-critical situations, this setting allows the closure to open or close as quickly as possible. It prioritizes speed over noise or smoothness, ensuring rapid response when urgent access or sealing is needed.

##### 5.4.5.4.4. Auto Value

In auto the speed of the movement is entirely determined by the closure. The behavior when using this value is manufacturer specific.

Page 496



**NOTE**

The server might not support three different speed values. The meaning of Low, Medium and High speeds is manufacturer-specific, as long as **Low <= Medium <= High** in terms of actual speed of motion. The Speed Feature requires at least two distinct speeds to be supported.

**5.4.5.5. Ventilation Feature**

This feature SHALL indicate that the closure can be set to a designated Ventilation position (e.g., partially open).

**5.4.5.6. Pedestrian Feature**

This feature SHALL indicate that the closure can be set to a dedicated Pedestrian position. The Pedestrian position provides a clear walkway through the closure.

**5.4.5.7. Calibration Feature**

This feature SHALL indicate the capability to trigger a calibration procedure. The calibration can either be fully automated, or require manual steps not described in this specification.

**5.4.5.8. Protection Feature**

This feature SHALL indicate that the closure is capable of activating a form of protection, such as protection against wind. A protection is manufacturer-specific, and it could be a simple software limitation, or a mechanical system deployed by the closure.

**5.4.5.9. ManuallyOperable Feature**

This feature SHALL indicate that the closure can be operated manually by a user, such as to open a window.

**5.4.6. Data Types****5.4.6.1. CurrentPositionEnum Type**

This data type is derived from enum8.

| Value | Name                        | Summary                                                                 | Conformance |
|-------|-----------------------------|-------------------------------------------------------------------------|-------------|
| 0     | <b>FullyClosed</b>          | Fully closed state                                                      | M           |
| 1     | <b>FullyOpened</b>          | Fully opened state                                                      | M           |
| 2     | <b>PartiallyOpened</b>      | Partially opened state<br>(closure is not fully opened or fully closed) | M           |
| 3     | <b>OpenedForPedestrian</b>  | Closure is in the Pedestrian position                                   | PD          |
| 4     | <b>OpenedForVentilation</b> | Closure is in the Ventilation position                                  | VT          |




Page 497



| Value | Name                     | Summary                                | Conformance |
|-------|--------------------------|----------------------------------------|-------------|
| 5     | <b>OpenedAtSignature</b> | Closure is in its "Signature position" | M           |

#### 5.4.6.1.1. OpenedAtSignature Value

The Signature allows a pre-recorded manufacturer- or installer-defined position to be reached.

This Signature position depends on the closure type. Some examples include:

- Gate, Garage Door → Pedestrian and pets, or one leaf only.
- Venetian Blind → Lowered down with flat slats.
- Door → Position to open for a person or someone in a wheelchair.
- Window → Position to 10% for tilt position.
- Roller Shutter → Closed with maximum gap between the slats.
- By default the Signature position MAY apply the same outcome as PartiallyOpened.

If no such separately defined position exists on the closure, the Signature value SHALL have the same position meaning as FullyOpened.

#### 5.4.6.2. TargetPositionEnum Type

This data type is derived from enum8.

| Value | Name                             | Summary                          | Conformance |
|-------|----------------------------------|----------------------------------|-------------|
| 0     | <b>MoveToFullyClosed</b>         | Move to a fully closed state     | M           |
| 1     | <b>MoveToFullyOpen</b>           | Move to a fully open state       | M           |
| 2     | <b>MoveToPedestrianPosition</b>  | Move to the Pedestrian position  | PD          |
| 3     | <b>MoveToVentilationPosition</b> | Move to the Ventilation position | VT          |
| 4     | <b>MoveToSignaturePosition</b>   | Move to the Signature position   | M           |

#### 5.4.6.3. MainStateEnum Type

This data type is derived from enum8.

| Value | Name           | Summary                    | Conformance |
|-------|----------------|----------------------------|-------------|
| 0     | <b>Stopped</b> | Closure is stopped         | M           |
| 1     | <b>Moving</b>  | Closure is actively moving | M           |

Page 498



| Value | Name                    | Summary                                                                                                          | Conformance |
|-------|-------------------------|------------------------------------------------------------------------------------------------------------------|-------------|
| 2     | <b>WaitingForMotion</b> | Closure is waiting before a motion (e.g. pre-heat, pre-check)                                                    | M           |
| 3     | <b>Error</b>            | Closure is in an error state                                                                                     | M           |
| 4     | <b>Calibrating</b>      | Closure is currently calibrating its Opened and Closed limits to determine effective physical range              | CL          |
| 5     | <b>Protected</b>        | Some protective measures are activated to prevent damage to the closure. Commands MAY be rejected.               | PT          |
| 6     | <b>Disengaged</b>       | Closure has a disengaged element preventing any actuator movements                                               | MO          |
| 7     | <b>SetupRequired</b>    | Movement commands are ignored since the closure is not operational and requires further setup and/or calibration | M           |

#### 5.4.6.4. ClosureErrorEnum Type

This data type is derived from enum8.

The following ranges are reserved for general and manufacturer specified closure errors.

| Value        | Name                     | Summary                                               |
|--------------|--------------------------|-------------------------------------------------------|
| 0x00 to 0x7F | <b>GeneralErrors</b>     | Generally applicable values for error, defined herein |
| 0x80 to 0xBF | <b>ManufacturerError</b> | Vendor specific errors                                |

The manufacturer-specific error definitions SHALL NOT duplicate the general error definitions. Such manufacturer-specific error definitions SHALL be scoped in the context of the Vendor ID present in the Basic Information cluster.

The general closure error values are defined in the table below.



Page 499



| Value | Name                        | Summary                                                                                                                    | Conformance |
|-------|-----------------------------|----------------------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>PhysicallyBlocked</b>    | An obstacle is blocking the closure movement                                                                               | M           |
| 1     | <b>BlockedBySensor</b>      | The closure is unsafe to move, as determined by a sensor (e.g. photoelectric sensor) before attempting movement            | M           |
| 2     | <b>TemperatureLimited</b>   | A warning raised by the closure that indicates an over-temperature, e.g. due to excessive drive or stall current           | M           |
| 3     | <b>MaintenanceRequired</b>  | Some malfunctions that are not easily recoverable are detected, or urgent servicing is needed                              | M           |
| 4     | <b>InternalInterference</b> | An internal element is prohibiting motion, e.g. an integrated door within a bigger garage door is open and prevents motion | M           |

#### 5.4.6.5. OverallCurrentStateStruct Type

| ID | Name               | Type                | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------|---------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Position</b>    | CurrentPositionEnum | desc       | X       | null     |        | PS          |
| 1  | <b>Latch</b>       | bool                | desc       | X       | null     |        | LT          |
| 2  | <b>Speed</b>       | ThreeLevelAutoEnum  | desc       |         | MS       |        | SP          |
| 3  | <b>SecureState</b> | bool                | desc       | X       | null     |        | M           |

##### 5.4.6.5.1. Position field

This field SHALL indicate the current Position state of the closure, as defined in the [CurrentPositionEnum](#).

When the Positioning (PS) feature flag is set, the rules for setting the value of the Position field are:

Page 500







- If the closure doesn't know accurately its current state the value null SHALL be used.
- Otherwise, the most appropriate supported value SHALL be used.

Clients which only consider the binary opened/closed states of a closure SHOULD consider the closure to be closed if the value of this field is *FullyClosed*. Otherwise those clients SHOULD consider the closure opened (non-closed).

#### 5.4.6.5.2. Latch field

This field SHALL indicate the current latching state of the closure.

When the MotionLatching (LT) feature flag is set, the rules for setting the value of the Latch field are:

- If the closure doesn't know its current state, the value SHALL be null.
- Else, if the closure is partially latched or not latched, the value SHALL be false.
- Otherwise, if the closure is fully latched, the value SHALL be true.

|             |                                                                                                                                                                                                                                         |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | Some products exposing the MotionLatching (LT) feature might not be able to drive an actuator to achieve a latched state. Such products are built with springs or similar mechanisms to unlatch but require the user to latch manually. |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

#### 5.4.6.5.3. Speed field

This field SHALL indicate the current speed of the closure, as defined in the `ThreeLevelAutoEnum`.

When the Speed (SP) feature flag is set, the rules for setting the value of the Speed field are:

If the closure's `MainState` attribute is currently either in *WaitingForMotion* or *Moving* state, the closure's most accurate current overall speed SHALL be used. Otherwise, the value used SHALL be the most appropriate default supported speed value.

#### 5.4.6.5.4. SecureState field

This field SHALL indicate the current secure state of the closure.

A secure state requires the closure to meet all of the following conditions defined by the `OverallCurrentState` Struct based on feature support:

- If the Positioning feature is supported, then the `Position` field of `OverallCurrentState` is *FullyClosed*.
- If the MotionLatching feature is supported, then the `Latch` field of `OverallCurrentState` is *True*.

The rules for setting the value of the SecureState field SHALL be:

- *True* if the closure meets the required conditions for a secure state, preventing unauthorized or undetectable access.
- *False* if the closure does not meet these conditions and unauthorized or undetectable access is possible.



Page 501



- null if the closure's current secure state is unknown.

This field provides no additional details regarding mechanical properties of the closure mechanism. It is intended only as supplementary information and not as a replacement for a comprehensive security system. It is primarily useful for closures on the outer shell of objects, such as garage doors, windows, or doors.

#### 5.4.6.6. OverallTargetStateStruct Type

| ID | Name            | Type               | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|--------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Position</b> | TargetPositionEnum | all        | X       | null     |        | PS          |
| 1  | <b>Latch</b>    | bool               | all        | X       | null     |        | LT          |
| 2  | <b>Speed</b>    | ThreeLevelAutoEnum | all        |         | MS       |        | SP          |

##### 5.4.6.6.1. Position field

This field SHALL indicate the target position that the closure is moving to. It SHALL be null if there is no target position.

##### 5.4.6.6.2. Latch field

This field SHALL indicate the desired latching state of the closure. It SHALL be null if there is no desired latching state.

##### 5.4.6.6.3. Speed field

This field SHALL indicate the desired speed at which the closure should perform the movement toward the target position. If no speed value has yet been set, the server SHALL select and set one of the speed values defined in the ThreeLevelAutoEnum.

#### 5.4.6.7. LatchControlModesBitmap Type

This data type is derived from map8.

| Bit | Name                    | Summary                      | Conformance |
|-----|-------------------------|------------------------------|-------------|
| 0   | <b>RemoteLatching</b>   | Remote latching capability   | LT          |
| 1   | <b>RemoteUnlatching</b> | Remote unlatching capability | LT          |

##### 5.4.6.7.1. RemoteLatching Bit

This bit SHALL indicate whether the latch supports remote latching or not:

- 0 = the latch can only be latched through manual, physical operation.

Page 502







- 1 = the latch can be latched via remote control (e.g., electronic or remote actuation).

#### 5.4.6.7.2. RemoteUnlatching Bit

This bit SHALL indicate whether the latch supports remote unlatching or not:

- 0 = the latch can only be unlatched through manual, physical operation.
- 1 = the latch can be unlatched via remote control (e.g., electronic or remote actuation).

### 5.4.7. Attributes

| ID     | Name                | Type                      | Constraint  | Quality | Fallback | Access | Conformance |
|--------|---------------------|---------------------------|-------------|---------|----------|--------|-------------|
| 0x0000 | CountdownTime       | elapsed-s                 | max 259200  | Q X     | null     | R V    | [PS & IIS]  |
| 0x0001 | MainState           | MainStateEnum             | all         |         |          | R V    | M           |
| 0x0002 | CurrentErrorList    | list[ClosureErrorEnum]    | max 10[all] |         |          | R V    | M           |
| 0x0003 | OverallCurrentState | OverallCurrentStateStruct | all         | X       | null     | R V    | M           |
| 0x0004 | OverallTargetState  | OverallTargetStateStruct  | all         | X       | null     | R V    | M           |
| 0x0005 | LatchControlModes   | LatchControlModesBitmap   | all         | F       |          | R V    | LT          |

#### 5.4.7.1. CountdownTime Attribute

This attribute SHALL indicate the estimated time left before the operation is completed, in seconds.

A value of 0 (zero) means that the operation has completed.

A value of null indicates that there is no time currently defined until operation completion. This MAY happen because the completion time is unknown.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- If the tracked operation has changed due to a change in the MainState attribute, or
- When it changes from 0 to any other value and vice versa, or
- When it changes from null to any other value and vice versa, or
- When it increases, or



Page 503



- When there is any increase or decrease in the estimated time remaining that was due to progressing insight of the server's control logic.

Changes to this attribute merely due to the normal passage of time with no other dynamic change of closure state SHALL NOT be reported.

As this attribute is not being reported during a regular countdown, clients SHOULD NOT rely on the reporting of this attribute in order to keep track of the remaining duration.

#### 5.4.7.2. MainState Attribute

This attribute SHALL indicate the current operational state of the closure associated with the server.

**NOTE**

The MainState diagram is provided exclusively for informational purposes only and is an exemplary design of the internals of a closure implementation to help illustrate the aspects of function that are considered by the cluster's normative text.

##### 5.4.7.2.1. MainState Diagram

![State diagram for Closure Control's MainState. The diagram shows a complex state machine with several states: BOOT, SETUP REQUIRED, STOPPED, WAITING FOR MOTION, MOVING, CALIBRATING, PROTECTED, and ERROR. Transitions are triggered by events like Setup required?, MoveTo(), Calibrate(), Stop(), and Error. The STOPPED state is central, with transitions to other states based on conditions like [Disengaged], [OneProtectionIsRaised], [AllProtectionsAreDropped], [Setup OK], [Calibration ended], [NoErrorAnymore], [Still Error ?], [Motion Needed ?], [Ready to move ?], [EndOfMoving], and [Error].](e94abd228b88882c51bf04955101331e_img.jpg)

```

stateDiagram-v2
    [*] --> BOOT
    BOOT --> SetupRequired
    SetupRequired --> STOPPED : [Setup OK]
    SetupRequired --> STOPPED : [Error]
    STOPPED --> Disengaged : [Disengaged]
    STOPPED --> Protected : [OneProtectionIsRaised]
    STOPPED --> Calibrating : [Calibration ended]
    STOPPED --> Moving : [Moving]
    STOPPED --> WaitingForMotion : [Motion Needed ?]
    STOPPED --> Error : [Error]
    Disengaged --> STOPPED : [Engaged]
    Protected --> STOPPED : [AllProtectionsAreDropped]
    Calibrating --> STOPPED : [NoErrorAnymore]
    Calibrating --> Error : [Error]
    Moving --> STOPPED : [EndOfMoving]
    Moving --> Error : [Error]
    WaitingForMotion --> STOPPED : [Ready to move]
    WaitingForMotion --> Error : [Error]
    Error --> STOPPED : [NoErrorAnymore]
    Error --> Calibrating : [Calibration ended]
    Error --> Error : [Error]
    
```

State diagram for Closure Control's MainState. The diagram shows a complex state machine with several states: BOOT, SETUP REQUIRED, STOPPED, WAITING FOR MOTION, MOVING, CALIBRATING, PROTECTED, and ERROR. Transitions are triggered by events like Setup required?, MoveTo(), Calibrate(), Stop(), and Error. The STOPPED state is central, with transitions to other states based on conditions like [Disengaged], [OneProtectionIsRaised], [AllProtectionsAreDropped], [Setup OK], [Calibration ended], [NoErrorAnymore], [Still Error ?], [Motion Needed ?], [Ready to move ?], [EndOfMoving], and [Error].

Figure 17. State diagram for Closure Control's MainState

**NOTE**

The Calibrating state is exited upon completion of the calibration routine (whether through self-calibration or assisted by external tools, depending on the closure or manufacturer implementation), or if an error occurs, or if a stop command is received.

Page 504







![Legend diagram showing state types: Motion State (green), Prohibitive State (orange), and a transition arrow for clsAction().](a90cc72434b69e725628336d49844211_img.jpg)

**Legend**

→ `clsAction()` Implemented Closure Control...  
internal closure a...

States handling motion commands are in green

**Motion State**

States prohibiting some motion commands are in orange

**Prohibitive State**

Legend diagram showing state types: Motion State (green), Prohibitive State (orange), and a transition arrow for clsAction().

*Figure 18. Legend*

#### 5.4.7.3. **CurrentErrorList** Attribute

This attribute SHALL indicate the currently active errors.

An empty list SHALL indicate that there are no active errors.

There SHALL NOT be duplicate values of `ClosureErrorEnum` within the `CurrentErrorList`.

#### 5.4.7.4. **OverallCurrentState** Attribute

This attribute SHALL indicate the current Position, Latch and/or Speed states, whichever are applicable according to the feature flags set.

This attribute SHALL be null, if the state is unknown. Examples could be, but are not limited to:

- The state of Position/Latch is not known yet because the closure is not calibrated.
- The product has lost its Position/Latch state after manual motion during a shutdown.

The values of the different fields within the structure of this attribute depend on:

- The effects of `MoveTo` commands.
- The effects of `SetTarget` and `Step` commands in a `Closure Dimension Cluster` associated with this




Page 505



cluster, as described in [Section 5.4.4, “Association Between Closure Control and Closure Dimension Clusters”](#).

- The Stop command.

#### 5.4.7.5. OverallTargetState Attribute

This attribute SHALL indicate the TargetPosition, TargetLatch and/or TargetSpeed values, whichever are applicable according to the feature flags set.

This attribute SHALL be null, if the state is unknown. For example after a reboot.

#### 5.4.7.6. LatchControlModes Attribute

This attribute SHALL specify whether the latch mechanism can be latched or unlatched remotely.

### 5.4.8. Commands

The table below lists the changes relative to the Operational State cluster for the commands. A blank field indicates no change.

| ID   | Name      | Direction                   | Response | Access | Conformance |
|------|-----------|-----------------------------|----------|--------|-------------|
| 0x00 | Stop      | client $\Rightarrow$ server | Y        | O      | !IS         |
| 0x01 | MoveTo    | client $\Rightarrow$ server | Y        | O T    | M           |
| 0x02 | Calibrate | client $\Rightarrow$ server | Y        | M T    | CL          |

#### 5.4.8.1. Stop Command

On receipt of this command, the closure SHALL stop its movement as fast as the closure is able too.

If the server's [MainState](#) attribute has one of the following values:

- Moving
- WaitingForMotion
- Calibrating

then any motions SHALL be stopped and the [MainState](#) attribute SHALL be set to Stopped.

A status code of SUCCESS SHALL always be returned, regardless of the value of the [MainState](#) attribute when this command is received.

#### 5.4.8.2. MoveTo Command

On receipt of this command, the closure SHALL operate to update its position, latch state and/or motion speed.

Page 506



| ID | Name     | Type               | Constraint | Quality | Fallback | Conformance |
|----|----------|--------------------|------------|---------|----------|-------------|
| 0  | Position | TargetPositionEnum |            |         | desc     | O.a+        |
| 1  | Latch    | bool               |            |         | desc     | O.a+        |
| 2  | Speed    | ThreeLevelAutoEnum |            |         | Auto     | O.a+        |

The rationale behind defining the conformance as being purely optional in the table above is to ensure that commands containing one or more fields related to unsupported features are still accepted, rather than being rejected outright. For example, if a simple client, which is not able to determine the capabilities of the server, invokes a command that includes both position and speed, a server that does not support the speed feature would simply ignore the speed field while still adjusting its position as requested.

#### 5.4.8.2.1. Position Field

This field SHALL indicate the position where the closure is moving to, as defined in the [TargetPositionEnum](#).

If the field is present but its value is not within constraints, then:

- If the Positioning (PS) feature is not supported, the value of this field SHALL be ignored.
- If the Positioning (PS) feature is supported, a status code of CONSTRAINT\_ERROR SHALL be returned.

If the Positioning (PS) feature is supported and the Position field is not present, the closure SHALL use the value of the Position field in the OverallTargetState attribute as the fallback. If the Position field in the OverallTargetState attribute is NULL, the position is unknown and the fallback is not applicable; in this case the field SHALL be ignored and the closure SHALL NOT change its position.

#### 5.4.8.2.2. Latch Field

This field SHALL indicate the desired latching state of the closure, as defined in the [OverallCurrentStateStruct Latch Field](#).

If the field is present but its value is not within constraints, then:

- If the MotionLatching (LT) feature is not supported, the value of this field SHALL be ignored.
- If the MotionLatching (LT) feature is supported, a status code of CONSTRAINT\_ERROR SHALL be returned.

If the MotionLatching (LT) feature is supported and the Latch field is not present, the closure SHALL use the value of the Latch field in the OverallTargetState attribute as the fallback. If the Latch field in the OverallTargetState attribute is NULL, the latch state is unknown and the fallback is not applicable, in this case, the field SHALL be ignored and the closure SHALL NOT change its latch state.




Page 507



If the closure supports the MotionLatching (LT) feature, it SHALL either fulfill the latch request and update `OverallTargetState.Latch` or, if the `"LatchControlModes"` attribute specifies that manual intervention is required to latch - respond with `INVALID_IN_STATE` and remain in its current state.

#### 5.4.8.2.3. Speed Field

This field SHALL indicate a desired overall speed of motion, as defined in the `ThreeLevelAutoEnum`.

If the field is present but its value is not within constraints, then:

- If the `Speed(SP)` feature is not supported, the value of this field SHALL be ignored.
- If the `Speed(SP)` feature is supported, a status code of `CONSTRAINT_ERROR` SHALL be returned.

If the closure supports the `Speed(SP)` feature, it SHALL set the `Speed` field of the `OverallCurrentState` attribute to the new speed.

#### 5.4.8.2.4. Effect on Receipt

If this command is received in any state other than `Moving`, `WaitingForMotion`, or `Stopped`, a status code of `INVALID_IN_STATE` SHALL be returned.

If a field is present in the command, but its associated feature is not supported, that field SHALL be treated as absent for the purposes of command processing. Specifically:

- If the `Position` field is present but the `Positioning (PS)` feature is not supported, the `Position` field SHALL be ignored and have no effect.
- If the `Latch` field is present but the `MotionLatching (LT)` feature is not supported, the `Latch` field SHALL be ignored and have no effect.
- If the `Speed` field is present but the `Speed (SP)` feature is not supported, the `Speed` field SHALL be ignored and have no effect.

In all such cases, the presence of an unsupported field SHALL NOT trigger errors or state changes.

If this command requests a position change while the `Latch` field of the `OverallCurrentState` attribute is `True` (Latched), and the `Latch` field of this command is not set to `False` (Unlatched), a status code of `INVALID_IN_STATE` SHALL be returned.

Otherwise, on success:

- A status code of `SUCCESS` SHALL be returned.
- The `OverallTargetState` Attribute SHALL be updated with the requested values for `Position`, `Latch` and/or `Speed`.
- If all field values in the command match the corresponding field values in `OverallCurrentState` Attribute, the `MainState` Attribute SHALL be set to `Stopped`, and no further action SHALL be taken.
- If the closure is not able to move e.g. due to power limitation, the `MainState` attribute SHALL be set to `WaitingForMotion`, else the `MainState` Attribute SHALL be set to `Moving`.

Page 508







#### 5.4.8.3. Calibrate Command

This command is used to trigger a calibration of the closure.

##### 5.4.8.3.1. Effect on Receipt

Upon receipt, this SHALL initiate a calibration of the closure.

Procedures of how to achieve the calibration are manufacturer-specific.

If this command is received when already in the *Calibrating* state, the server SHALL respond with a status code of SUCCESS. Else, if this command is invoked in any state other than *Stopped* or *SetupRequired*, the server SHALL respond with INVALID\_IN\_STATE and there SHALL be no other effect.

Otherwise:

- The MainState attribute SHALL be set to *Calibrating*.
- The server SHALL respond with a status code equal to SUCCESS.

#### 5.4.9. Events

| ID   | Name                      | Priority | Quality | Access | Conformance |
|------|---------------------------|----------|---------|--------|-------------|
| 0x00 | <b>OperationalError</b>   | CRITICAL |         | V      | M           |
| 0x01 | <b>MovementCompleted</b>  | INFO     |         | V      | !IS         |
| 0x02 | <b>EngageStateChanged</b> | INFO     |         | V      | MO          |
| 0x03 | <b>SecureStateChanged</b> | INFO     |         | V      | M           |

##### 5.4.9.1. OperationalError Event

This event SHALL be generated when a reportable error condition is detected. A closure that generates this event SHALL also set the MainState attribute to Error, indicating an error condition.

This event SHALL contain the following fields:

| ID | Name       | Type                   | Constraint   | Quality | Fallback | Conformance |
|----|------------|------------------------|--------------|---------|----------|-------------|
| 0  | ErrorState | list[ClosureErrorEnum] | 1 to 10[all] |         |          | M           |

##### 5.4.9.2. MovementCompleted Event

This event, if supported, SHALL be generated when the overall operation ends, either successfully or otherwise. For example, the event is sent upon the completion of a movement operation in a



Page 509



blind.

#### 5.4.9.3. EngageStateChanged Event

This event, if supported, SHALL be generated when the MainStateEnum attribute changes state to and from disengaged, indicating if the actuator is Engaged or Disengaged.

This event SHALL contain the following fields:

| ID | Name        | Type | Constraint | Quality | Fallback | Conformance |
|----|-------------|------|------------|---------|----------|-------------|
| 0  | EngageValue | bool | all        |         |          | M           |

- *True*, when the actuator is in a Engaged state, actuator movements possible.
- *False*, when the actuator is in a Disengaged state, preventing any actuator movements.

#### 5.4.9.4. SecureStateChanged Event

This event, if supported, SHALL be generated when the SecureState field in the OverallCurrentState attribute changes. It is used to indicate whether a closure is securing a space against possible unauthorized entry.

This event SHALL contain the following fields:

| ID | Name        | Type | Constraint | Quality | Fallback | Conformance |
|----|-------------|------|------------|---------|----------|-------------|
| 0  | SecureValue | bool | all        |         |          | M           |

- *True*, when the closure is in a secure state, e.g. unauthorized/undetectable access is not possible.
- *False*, when the closure is in an insecure state, e.g. unauthorized/undetectable access is possible.

### 5.5. Closure Dimension Cluster

This cluster provides an interface for controlling a single degree of freedom (also referred to as a "dimension" or an "axis" below) of a composed closure. This could be a degree of freedom in a 6-axis framework for the overall closure or a panel in the closure, or some other degree of freedom.

An instance of this cluster may represent position along a single axis, as specified by the FeatureMap, which can be one of:

- Translation : panel translates along one axis
- Rotation : panel rotates around an axis of rotation
- Modulation : panel modifies its aspect to modulate a flow

This cluster may also be used to latch or anchor a panel in a position, if the panel supports that.

Page 510







### 5.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 5.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | CLDIM     |

### 5.5.3. Cluster ID

| ID     | Name              |
|--------|-------------------|
| 0x0105 | Closure Dimension |

### 5.5.4. Association Between Closure Control and Closure Dimension Clusters

Some device types MAY define that a Closure Dimension cluster instance is associated with a corresponding Closure Control cluster instance on the same device. In such cases, the Closure Dimension cluster does not operate independently, rather, it relies on the Closure Control cluster for supervisory logic, coordination, and overall state management of the closure system. Where this association is specified, implementers SHALL ensure that the behaviors, commands, and states of each Closure Dimension cluster are properly integrated with and governed by the logic of the associated Closure Control cluster.

### 5.5.5. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature        | Conformance | Summary                                                       |
|-----|------|----------------|-------------|---------------------------------------------------------------|
| 0   | PS   | Positioning    | O.a+        | Supports Positioning in the range from 0.00% to 100.00%       |
| 1   | LT   | MotionLatching | O.a+        | Supports a latch to secure the closure to a position or state |




Page 511



| Bit | Code | Feature     | Conformance | Summary                                                                     |
|-----|------|-------------|-------------|-----------------------------------------------------------------------------|
| 2   | UT   | Unit        | [PS]        | Specifies the relevant unit and range for this dimension (mm, degrees etc.) |
| 3   | LM   | Limitation  | [PS]        | Supports limitation of the operating range                                  |
| 4   | SP   | Speed       | [PS]        | Supports speed motion throttling.                                           |
| 5   | TR   | Translation | [PS].b      | Drives a translation motion                                                 |
| 6   | RO   | Rotation    | [PS].b      | Drives a rotation motion                                                    |
| 7   | MD   | Modulation  | [PS].b      | Modulates a particular flow level (light, air, privacy ...)                 |

#### 5.5.5.1. Positioning Feature

This feature SHALL indicate support for position percentage over the range of 0.00% to 100.00%, with a resolution of 0.01%.

**NOTE**

In most of the products 0.00% = fully opened and 100.00% = fully closed but this is not always the case. For example, if the Modulation feature is supported and the ModulationType is SlatsOrientation or StripesAlignment, the panel can be fully closed at 0.00% and 100.00%, and be fully opened at 50.00%.

#### 5.5.5.2. MotionLatching Feature

This feature SHALL indicate that the closure can be latched and unlatched. An axis with the Motion-Latching feature has capabilities that will prevent actuators from moving along parts of that axis if the dimension is latched.

#### 5.5.5.3. Unit Feature

This feature SHALL indicate additional information about the closure dimension's possible range of movement.

#### 5.5.5.4. Limitation Feature

This feature SHALL indicate that the closure dimension supports degradation of its functioning. Reachable Position range MAY be limited compared to full scope of a nominal behavior.

Page 512



### 5.5.5.5. Speed Feature

This feature SHALL indicate that the closure dimension can be driven at different speed levels: Low, Medium, and High. Please refer to [Section 5.4.5.4, “Speed Feature”](#) for more details.

**NOTE**

The server might not support three different speed values. The manufacturer SHALL select speed values linked to Low, Medium and High such that **Low <= Medium <= High**.

### 5.5.5.6. Translation Feature

This feature SHALL indicate that the panel can move along a single axis. The possible directions include downward, upward, leftward, rightward, forward, and backward. The Translation feature is used to control the position of the panel along the specified axis.

### 5.5.5.7. Rotation Feature

This feature SHALL indicate that the panel can rotate around a single axis. The possible axes include left, right, top, bottom, centered vertical, and centered horizontal. The Rotation feature is used to control the orientation of the panel around the specified axis.

### 5.5.5.8. Modulation Feature

This feature SHALL indicate that the panel can modify its aspect to control a particular flow, such as light, air, or privacy. The possible modulation types include slats orientation, slats openwork, stripes alignment, opacity, and ventilation. The Modulation feature is used to adjust the panel's properties to achieve the desired effect.

## 5.5.6. Data Types

### 5.5.6.1. TranslationDirectionEnum Type

This data type is derived from `enum8`.

| Value | Name                    | Summary                       | Conformance |
|-------|-------------------------|-------------------------------|-------------|
| 0     | <b>Downward</b>         | Downward translation          | M           |
| 1     | <b>Upward</b>           | Upward translation            | M           |
| 2     | <b>VerticalMask</b>     | Vertical mask translation     | M           |
| 3     | <b>VerticalSymmetry</b> | Vertical symmetry translation | M           |
| 4     | <b>Leftward</b>         | Leftward translation          | M           |
| 5     | <b>Rightward</b>        | Rightward translation         | M           |
| 6     | <b>HorizontalMask</b>   | Horizontal mask translation   | M           |




Page 513



| Value | Name               | Summary                         | Conformance |
|-------|--------------------|---------------------------------|-------------|
| 7     | HorizontalSymmetry | Horizontal symmetry translation | M           |
| 8     | Forward            | Forward translation             | M           |
| 9     | Backward           | Backward translation            | M           |
| 10    | DepthMask          | Depth mask translation          | M           |
| 11    | DepthSymmetry      | Depth symmetry translation      | M           |

The following table provides a graphical representation detailing the enumeration values:

| Value | Name               | Axes | Drawing                                                                                                                                                                                                                                                                                        |
|-------|--------------------|------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0     | Downward           | Y    | <img alt="Downward translation diagram: 0% shows a blue arrow pointing down in a white box; 50% shows a blue arrow pointing down in a blue box; 100% shows a blue arrow pointing down in a blue box." data-bbox="1124 707 1430 781" src="e401fa1d8334cf2b5a0deeab5c530cca_img.jpg"/>           |
| 1     | Upward             | Y    | <img alt="Upward translation diagram: 0% shows a blue arrow pointing up in a white box; 50% shows a blue arrow pointing up in a blue box; 100% shows a blue arrow pointing up in a blue box." data-bbox="1124 792 1430 866" src="c5c49d81e455e0fd0e6c262fca85f1db_img.jpg"/>                   |
| 2     | VerticalMask       | Y    | <img alt="Vertical mask diagram: 0% shows a blue arrow pointing down in a white box; 50% shows a blue arrow pointing down in a blue box; 100% shows a blue arrow pointing down in a blue box." data-bbox="1124 878 1430 952" src="9f80cdb6fd0234c23d0becb8d122a27e_img.jpg"/>                  |
| 3     | VerticalSymmetry   | Y    | <img alt="Vertical symmetry diagram: 0% shows a blue arrow pointing down in a white box; 50% shows a blue arrow pointing down in a blue box; 100% shows a blue arrow pointing down in a blue box." data-bbox="1124 963 1430 1037" src="45b66b36437e47c7ea187e79f07f5892_img.jpg"/>             |
| 4     | RightToLeft        | X    | <img alt="Right to left translation diagram: 0% shows a blue arrow pointing left in a white box; 50% shows a blue arrow pointing left in a blue box; 100% shows a blue arrow pointing left in a blue box." data-bbox="1124 1048 1430 1123" src="e84ec5df83ded4207f8b7b5402839d36_img.jpg"/>    |
| 5     | LeftToRight        | X    | <img alt="Left to right translation diagram: 0% shows a blue arrow pointing right in a white box; 50% shows a blue arrow pointing right in a blue box; 100% shows a blue arrow pointing right in a blue box." data-bbox="1124 1134 1430 1208" src="2061f0573e4ddd52ff0a4cbc86399d54_img.jpg"/> |
| 6     | HorizontalMask     | X    | <img alt="Horizontal mask diagram: 0% shows a blue arrow pointing left in a white box; 50% shows a blue arrow pointing left in a blue box; 100% shows a blue arrow pointing left in a blue box." data-bbox="1124 1219 1430 1293" src="387bf113a9af31028ba37cb3f507a177_img.jpg"/>              |
| 7     | HorizontalSymmetry | X    | <img alt="Horizontal symmetry diagram: 0% shows a blue arrow pointing left in a white box; 50% shows a blue arrow pointing left in a blue box; 100% shows a blue arrow pointing left in a blue box." data-bbox="1124 1304 1430 1379" src="bcf8c553a349ccff0c7830d3444c1b0d_img.jpg"/>          |
| 8     | FrontToBack        | Z    | <img alt="Front to back translation diagram: 0% shows a blue arrow pointing back in a white box; 50% shows a blue arrow pointing back in a blue box; 100% shows a blue arrow pointing back in a blue box." data-bbox="1124 1390 1430 1464" src="8392897f11743ae4ea660ad613902d32_img.jpg"/>    |
| 9     | BackToFront        | Z    | <img alt="Back to front translation diagram: 0% shows a blue arrow pointing front in a white box; 50% shows a blue arrow pointing front in a blue box; 100% shows a blue arrow pointing front in a blue box." data-bbox="1124 1475 1430 1549" src="5c6041b29fe6c6b950b219158461e2d9_img.jpg"/> |
| 10    | DepthMask          | Z    | <img alt="Depth mask diagram: 0% shows a blue arrow pointing back in a white box; 50% shows a blue arrow pointing back in a blue box; 100% shows a blue arrow pointing back in a blue box." data-bbox="1124 1560 1430 1635" src="fd3776357f6f2126a9b5a2630357b20e_img.jpg"/>                   |
| 11    | DepthSymmetry      | Z    | <img alt="Depth symmetry diagram: 0% shows a blue arrow pointing back in a white box; 50% shows a blue arrow pointing back in a blue box; 100% shows a blue arrow pointing back in a blue box." data-bbox="1124 1646 1430 1720" src="9c88c836f59033a2f2dc3123481384a6_img.jpg"/>               |

Legend:  Open  Closed

### 5.5.6.2. RotationAxisEnum Type

This data type is derived from enum8.

Page 514







| Value | Name                        | Summary                                                                                  | Conformance |
|-------|-----------------------------|------------------------------------------------------------------------------------------|-------------|
| 0     | <b>Left</b>                 | The panel rotates around a vertical axis located on the left side of the panel           | M           |
| 1     | <b>CenteredVertical</b>     | The panel rotates around a vertical axis located in the center of the panel              | M           |
| 2     | <b>LeftAndRight</b>         | The panels rotates around vertical axes located on the left and right sides of the panel | M           |
| 3     | <b>Right</b>                | The panel rotates around a vertical axis located on the right side of the panel          | M           |
| 4     | <b>Top</b>                  | The panel rotates around a horizontal axis located on the top of the panel               | M           |
| 5     | <b>CenteredHorizontal</b>   | The panel rotates around a horizontal axis located in the center of the panel            | M           |
| 6     | <b>TopAndBottom</b>         | The panels rotates around horizontal axes located on the top and bottom of the panel     | M           |
| 7     | <b>Bottom</b>               | The panel rotates around a horizontal axis located on the bottom of the panel            | M           |
| 8     | <b>LeftBarrier</b>          | The barrier tilts around an axis located at the left end of the barrier                  | M           |
| 9     | <b>LeftAndRightBarriers</b> | The dual barriers tilt around axes located at each side of the composite barrier         | M           |
| 10    | <b>RightBarrier</b>         | The barrier tilts around an axis located at the right end of the barrier                 | M           |



Page 515



The following table provides a graphical representation detailing the enumeration values:

| Value | Name                 | Axes         | Drawing                                                                                       |
|-------|----------------------|--------------|-----------------------------------------------------------------------------------------------|
| 0     | Left                 | Y            | <p>Image: Diagram for Left barrier: 0% (open), 50% (open), 100% (closed).</p>                 |
| 1     | CenteredVertical     | Y            | <p>Image: Diagram for CenteredVertical barrier: 0% (open), 50% (open), 100% (closed).</p>     |
| 2     | LeftAndRight         | Y            | <p>Image: Diagram for LeftAndRight barrier: 0% (open), 50% (open), 100% (closed).</p>         |
| 3     | Right                | Y            | <p>Image: Diagram for Right barrier: 0% (open), 50% (open), 100% (closed).</p>                |
| 4     | Top                  | X            | <p>Image: Diagram for Top barrier: 0% (open), 50% (open), 100% (closed).</p>                  |
| 5     | CenteredHorizontal   | X            | <p>Image: Diagram for CenteredHorizontal barrier: 0% (open), 50% (open), 100% (closed).</p>   |
| 6     | TopAndBottom         | X            | <p>Image: Diagram for TopAndBottom barrier: 0% (open), 50% (open), 100% (closed).</p>         |
| 7     | Bottom               | X            | <p>Image: Diagram for Bottom barrier: 0% (open), 50% (open), 100% (closed).</p>               |
| 8     | LeftBarrier          | Z (CW)       | <p>Image: Diagram for LeftBarrier barrier: 0% (open), 50% (open), 100% (closed).</p>          |
| 9     | LeftAndRightBarriers | Z (CW + CCW) | <p>Image: Diagram for LeftAndRightBarriers barrier: 0% (open), 50% (open), 100% (closed).</p> |
| 10    | RightBarrier         | Z (CCW)      | <p>Image: Diagram for RightBarrier barrier: 0% (open), 50% (open), 100% (closed).</p>         |

Legend:   Open   Closed

### 5.5.6.3. OverflowEnum Type

This data type is derived from enum8.

| Value | Name          | Summary                 | Conformance |
|-------|---------------|-------------------------|-------------|
| 0     | NoOverflow    | No overflow             | M           |
| 1     | Inside        | Inside overflow         | M           |
| 2     | Outside       | Outside overflow        | M           |
| 3     | TopInside     | Top inside overflow     | M           |
| 4     | TopOutside    | Top outside overflow    | M           |
| 5     | BottomInside  | Bottom inside overflow  | M           |
| 6     | BottomOutside | Bottom outside overflow | M           |
| 7     | LeftInside    | Left inside overflow    | M           |
| 8     | LeftOutside   | Left outside overflow   | M           |

Page 516







| Value | Name                | Summary                | Conformance |
|-------|---------------------|------------------------|-------------|
| 9     | <b>RightInside</b>  | Right inside overflow  | M           |
| 10    | <b>RightOutside</b> | Right outside overflow | M           |

The following table provides a description detailing the enumeration values:

| Value | Name                 | Description                                                                                 |
|-------|----------------------|---------------------------------------------------------------------------------------------|
| 1     | <b>Inside</b>        | The panel opens inward, pivoting from the outside toward the interior side.                 |
| 2     | <b>Outside</b>       | The panel opens outward, pivoting from the inside away from the interior side.              |
| 3     | <b>TopInside</b>     | The panel pivots along its top edge, opening inward towards the interior of the room.       |
| 4     | <b>TopOutside</b>    | The panel pivots along its top edge, opening outward away from the interior of the room.    |
| 5     | <b>BottomInside</b>  | The panel pivots along its bottom edge, opening inward towards the interior of the room.    |
| 6     | <b>BottomOutside</b> | The panel pivots along its bottom edge, opening outward away from the interior of the room. |
| 7     | <b>LeftInside</b>    | The left-hung panel opens inward, pivoting from the right towards the interior of the room. |
| 8     | <b>LeftOutside</b>   | The panel opens outward, pivoting from the right towards the exterior of the building.      |
| 9     | <b>RightInside</b>   | The right-hung panel opens inward, pivoting from the left towards the interior of the room. |
| 10    | <b>RightOutside</b>  | The panel opens outward, pivoting from the left towards the exterior of the building.       |



Page 517



#### 5.5.6.4. ModulationTypeEnum Type

This data type is derived from enum8.

| Value | Name                    | Summary                            | Conformance |
|-------|-------------------------|------------------------------------|-------------|
| 0     | <b>SlatsOrientation</b> | Orientation of the slats           | M           |
| 1     | <b>SlatsOpenwork</b>    | Aperture of the slats              | M           |
| 2     | <b>StripesAlignment</b> | Alignment of blind stripes (Zebra) | M           |
| 3     | <b>Opacity</b>          | Opacity of a surface               | M           |
| 4     | <b>Ventilation</b>      | Ventilation control                | M           |

#### 5.5.6.5. ClosureUnitEnum Type

This data type is derived from enum8.

| Value | Name              | Summary                 | Conformance |
|-------|-------------------|-------------------------|-------------|
| 0     | <b>Millimeter</b> | Millimeter used as unit | M           |
| 1     | <b>Degree</b>     | Degree used as unit     | M           |

#### 5.5.6.6. StepDirectionEnum Type

This data type is derived from enum8 and used for the Step command to indicate the direction of the steps.

| Value | Name            | Summary                  | Conformance |
|-------|-----------------|--------------------------|-------------|
| 0     | <b>Decrease</b> | Decrease towards 0.00%   | M           |
| 1     | <b>Increase</b> | Increase towards 100.00% | M           |

#### 5.5.6.7. RangePercent100thsStruct Type

| ID | Name       | Type           | Constraint     | Quality | Fallback | Access | Conformance |
|----|------------|----------------|----------------|---------|----------|--------|-------------|
| 0  | <b>Min</b> | per-cent100ths | all            |         |          |        | M           |
| 1  | <b>Max</b> | per-cent100ths | Min to 100.00% |         |          |        | M           |

#### 5.5.6.8. UnitRangeStruct Type

Page 518



| ID | Name       | Type  | Constraint   | Quality | Fallback | Access | Conformance |
|----|------------|-------|--------------|---------|----------|--------|-------------|
| 0  | <b>Min</b> | int16 | all          |         |          |        | M           |
| 1  | <b>Max</b> | int16 | Min to 32767 |         |          |        | M           |

#### 5.5.6.9. DimensionStateStruct Type

| ID | Name            | Type               | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|--------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Position</b> | percent100ths      | desc       | X       | null     |        | PS          |
| 1  | <b>Latch</b>    | bool               | desc       | X       | null     |        | LT          |
| 2  | <b>Speed</b>    | ThreeLevelAutoEnum | desc       |         | MS       |        | SP          |

##### 5.5.6.9.1. Position Field

This field SHALL indicate the position of the closure, expressed as a percentage from 0.00% to 100.00%.

A null value indicates that the position is not known or is not set.

##### 5.5.6.9.2. Latch Field

This field SHALL indicate the latching state of the closure, as defined in the [OverallCurrentStateStruct Latch Field](#).

A null value indicates that the latch is not known or is not set.

##### 5.5.6.9.3. Speed Field

This field SHALL indicate the current speed of the closure, as defined in the ThreeLevelAutoEnum.

If no speed value has yet been set, the server SHALL select and set one of the speed values defined in the ThreeLevelAutoEnum.

#### 5.5.6.10. LatchControlModesBitmap Type

This data type is derived from map8.

| Bit | Name                    | Summary                      | Conformance |
|-----|-------------------------|------------------------------|-------------|
| 0   | <b>RemoteLatching</b>   | Remote latching capability   | LT          |
| 1   | <b>RemoteUnlatching</b> | Remote unlatching capability | LT          |



Page 519



**5.5.6.10.1. RemoteLatching Bit**

This bit SHALL indicate whether the latch supports remote latching or not:

- 0 = the latch can only be latched through manual, physical operation.
- 1 = the latch can be latched via remote control (e.g., electronic or remote actuation).

**5.5.6.10.2. RemoteUnlatching Bit**

This bit SHALL indicate whether the latch supports remote unlatching or not:

- 0 = the latch can only be unlatched through manual, physical operation.
- 1 = the latch can be unlatched via remote control (e.g., electronic or remote actuation).

**5.5.7. Attributes**

| ID     | Name                        | Type                     | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------------|--------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>CurrentState</b>         | DimensionStateStruct     | desc       | Q X     | null     | R V    | M           |
| 0x0001 | <b>TargetState</b>          | DimensionStateStruct     | desc       | X       | null     | R V    | M           |
| 0x0002 | <b>Resolution</b>           | percent100ths            | min 0.01%  | F       | 0.01%    | R V    | PS          |
| 0x0003 | <b>StepValue</b>            | percent100ths            | min 0.01%  | F       | 0.01%    | R V    | PS          |
| 0x0004 | <b>Unit</b>                 | ClosureUnitEnum          | all        | F       |          | R V    | UT          |
| 0x0005 | <b>UnitRange</b>            | UnitRangeStruct          | desc       | X       | null     | R V    | UT          |
| 0x0006 | <b>LimitRange</b>           | RangePercent100thsStruct | desc       |         |          | R V    | LM          |
| 0x0007 | <b>TranslationDirection</b> | TranslationDirectionEnum | all        | F       |          | R V    | TR          |
| 0x0008 | <b>RotationAxis</b>         | RotationAxisEnum         | all        | F       |          | R V    | RO          |
| 0x0009 | <b>Overflow</b>             | OverflowEnum             | all        | F       |          | R V    | RO          |

Page 520



| ID     | Name                     | Type                    | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------|-------------------------|------------|---------|----------|--------|-------------|
| 0x000A | <b>ModulationType</b>    | ModulationTypeEnum      | all        | F       |          | RV     | MD          |
| 0x000B | <b>LatchControlModes</b> | LatchControlModesBitmap | all        | F       |          | RV     | LT          |

#### 5.5.7.1. **CurrentState** Attribute

This attribute SHALL indicate the current Position, Latching and/or Speed, based on the feature flags set.

A value of null SHALL indicate that:

- The position and latching state are both not known yet because the closure is not calibrated, or
- The product has lost its position and latching state after manual motion during a shutdown.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- When the attribute changes from null to any other value and vice versa, or
- When the Position changes from null to any other value and vice versa, or
- At most once every 5 seconds when the Position changes from one non-null value to another non-null value, or
- When **TargetState.Position** is reached, or
- When **CurrentState.Speed** changes, or
- When **CurrentState.Latch** changes.

The value of the different fields within the structure of this attribute depends on:

- The last SetTarget or Step commands.
- The impact of a MoveTo command received on the [Closure Control Cluster](#) instance associated with this cluster, if such a Closure Control instance exists, as described in [Section 5.5.4, “Association Between Closure Control and Closure Dimension Clusters”](#).

#### 5.5.7.2. **TargetState** Attribute

This attribute SHALL indicate the target Position, Latching and/or Speed, based on the feature flags set.

A value of null SHALL indicate that the TargetState fields are unknown (typically after a reboot, no target has been yet requested).

Each field SHALL be present only when its corresponding feature is supported. If the feature is not supported the field SHALL NOT be present.




Page 521



The value of **TargetState.Position** SHALL be set to a value that is an integer multiple of the **Resolution** attribute.

The value of the different fields within the structure of this attribute depends on:

- The last SetTarget or Step commands.
- The impact of a MoveTo command received on the **Closure Control Cluster** instance associated with this cluster, if such a Closure Control instance exists, as described in [Section 5.5.4, “Association Between Closure Control and Closure Dimension Clusters”](#).

#### 5.5.7.3. Resolution Attribute

This attribute SHALL indicate the minimal acceptable change to the Position field of the TargetState and CurrentState attributes.

Resolution should not be confused with an accuracy, such as  $\text{Current} = \text{Target} \pm \text{Accuracy}$ . This cluster does not provide accuracy.

Resolution gives a collection of valid Current position points over a linear ruler.

|             |                                                                                                                                        |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | A resolution of <b>100%</b> means that the associated dimension cannot be placed in an intermediate position - its position is binary. |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------|

#### 5.5.7.4. StepValue Attribute

This attribute SHALL indicate the size of a single step, expressed in percent100ths. When the **Step** command is used, each step changes the position by this amount. The value of this attribute SHALL be an integer multiple of the **Resolution** attribute.

|             |                                                                                                                                 |
|-------------|---------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | The StepValue should be large enough to cause a visible change in the closure's position when a <b>Step</b> command is invoked. |
|-------------|---------------------------------------------------------------------------------------------------------------------------------|

#### 5.5.7.5. Unit Attribute

This attribute SHALL indicate the unit related to the Position.

#### 5.5.7.6. UnitRange Attribute

This attribute SHALL indicate the minimum and the maximum values expressed by Position following the unit indicated by "**Unit**".

The value of this attribute MAY be null if the product has not been set up.

##### 5.5.7.6.1. Constraint for values in Millimeters

Range values SHALL contain unsigned values from 0 to 32767 only.

##### 5.5.7.6.2. Constraint for values in Degrees

The maximum span range is 360 degrees.

Page 522







Some examples to express the 360 degrees range:

- 0 to 359 degrees
- -180 to 179 degrees
- -90 to 269 degrees

Values in degrees can also be used to express the orientation range of slats even if slats filter a vertical closure such as vertical blinds or a horizontal closure such as a bioclimatic pergola or venetian blinds. The 0° value orientation is the value corresponding to the perpendicular axis to the Closure panel and means that all slats are parallel and offer the maximum opening.

Horizontal Slats:

- Negative values indicate that the user-facing edge is higher than the opposing edge.
- Positive values indicate that the user-facing edge is lower than the opposing edge.

Vertical Slats:

- Negative values indicate that the user-facing edge is to the left of the opposing edge.
- Positive values indicate that the user-facing edge is to the right of the opposing edge.

For example :

| Slats travel range    | Min Value | Max Value |
|-----------------------|-----------|-----------|
| 0°/90° slats travel   | 0         | 90        |
| -90°/90° slats travel | -90       | 90        |
| -30°/90° slats travel | -30       | 90        |

#### 5.5.7.7. **LimitRange** Attribute

This attribute SHALL indicate the range of possible values for the Position field in the [CurrentState](#) attribute.

This range MAY evolve dynamically.

[LimitRange.Min](#) and [LimitRange.Max](#) SHALL be equal to an integer multiple of the Resolution attribute.

#### 5.5.7.8. **TranslationDirection** Attribute

This attribute SHALL indicate the direction of the translation.

A properly configured closure dimension SHOULD reflect as best as possible the translation as seen by the user. This attribute is not supposed to change once the installation is finalized.

#### 5.5.7.9. **RotationAxis** Attribute

This attribute SHALL indicate the axis of the rotation.



Page 523



A properly configured closure dimension SHOULD reflect as best as possible the rotation axis as perceived by the user. This attribute is not supposed to change once the installation is finalized.

#### 5.5.7.10. Overflow Attribute

This attribute SHALL indicate the overflow related to Rotation(RO).

A closure that rotates following an axis (with Rotation(RO) feature declared in FeatureMap), could overflow Inside and/or Outside. If the axis is centered, one part goes Outside and the other part goes Inside. In this case, this attribute SHALL use Top/Bottom/Left/Right Inside or Top/Bottom/Left/Right Outside enumerated value.

#### 5.5.7.11. ModulationType Attribute

This attribute SHALL indicate the modulation type related to Modulation(MD).

The server SHOULD reflect, as best as possible, the modulation type as perceived by the user. This attribute is not supposed to change once the installation is finalized.

#### 5.5.7.12. LatchControlModes Attribute

This attribute SHALL specify whether the latch mechanism can be latched or unlatched remotely.

### 5.5.8. Commands

| ID   | Name             | Direction                   | Response | Access | Conformance |
|------|------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>SetTarget</b> | client $\Rightarrow$ server | Y        | O T    | M           |
| 0x01 | <b>Step</b>      | client $\Rightarrow$ server | Y        | O T    | PS          |

#### 5.5.8.1. SetTarget Command

This command is used to move a dimension of the closure to a target position.

| ID | Name            | Type               | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------------------|------------|---------|----------|-------------|
| 0  | <b>Position</b> | percent100ths      |            |         | desc     | O.a+        |
| 1  | <b>Latch</b>    | bool               |            |         | desc     | O.a+        |
| 2  | <b>Speed</b>    | ThreeLevelAutoEnum |            |         | Auto     | O.a+        |

The rationale behind defining the conformance as being purely optional in the table above is to ensure that commands containing one or more fields related to unsupported features are still accepted, rather than being rejected outright. For example, if a simple client, which is not able to determine the capabilities of the server, invokes a command that includes both position and speed, a server that does not support the speed feature would simply ignore the speed field while still adjusting its position as requested.

Page 524







#### 5.5.8.1.1. Position Field

This field SHALL indicate the position where the closure is moving to.

If the field is present but its value is not within constraints, then:

- If the Positioning (PS) feature is not supported, the value of this field SHALL be ignored.
- If the Positioning (PS) feature is supported, a status code of CONSTRAINT\_ERROR SHALL be returned.

If the Positioning (PS) feature is supported and the Position field is not present, the closure SHALL use the value of the Position field in the TargetState attribute as the fallback. If the Position field in the TargetState attribute is NULL, the position is unknown and the fallback is not applicable, in this case the field SHALL be ignored and the closure SHALL NOT change its position.

When the closure supports the Positioning(PS) feature:

If a new position value is requested, the closure SHALL set the Position field of the [TargetState](#) attribute to the nearest valid position (an integer multiple of the Resolution attribute), whether by rounding the requested value or using it directly if already valid, and then initiate the motion procedure.

#### 5.5.8.1.2. Latch Field

This field SHALL indicate the desired latching state of the closure, as defined in the [OverallCurrentStateStruct Latch Field](#).

If the field is present but its value is not within constraints, then:

- If the MotionLatching (LT) feature is not supported, the value of this field SHALL be ignored.
- If the MotionLatching (LT) feature is supported, a status code of CONSTRAINT\_ERROR SHALL be returned.

If the MotionLatching (LT) feature is supported and the Latch field is not present, the closure SHALL use the value of the Latch field in the TargetState attribute as the fallback. If the Latch field in the TargetState attribute is NULL, the latch state is unknown and the fallback is not applicable, in this case, the field SHALL be ignored and the closure SHALL NOT change its latch state.

If the server supports the MotionLatching (LT) feature, it SHALL either fulfill the latch request and update [TargetState.Latch](#), or - if the ["LatchControlModes"](#) attribute specifies that manual intervention is required to latch - respond with INVALID\_IN\_STATE and remain in its current state.

#### 5.5.8.1.3. Speed Field

This field SHALL indicate a desired overall speed of motion, as defined in the [ThreeLevelAutoEnum](#).

If the field is present but its value is not within constraints, then:

- If the Speed(SP) feature is not supported, the value of this field SHALL be ignored.
- If the Speed(SP) feature is supported, a status code of CONSTRAINT\_ERROR SHALL be returned.



Page 525



If the Speed (SP) feature is supported, the `TargetState.Speed` attribute SHALL be updated with the value of the Speed field.

A closure dimension SHOULD attempt to follow the indicated Speed value as closely as possible (meant to override its default speed).

If a SetTarget command is sent with only the Speed field:

- It SHOULD adjust the speed of the ongoing motion of the closure (i.e., allow speed change on the fly).

**NOTE**

The internal default speed SHALL not be affected by this command field. The priorities and cross capabilities to achieve, skip or ignore Position + Latch + Speed combinations are product/manufacturer specific. If the Limitation feature is supported, the closure will automatically offset the `TargetState.Position` value to fit within `LimitRange.Min` and `LimitRange.Max`.

#### 5.5.8.1.4. Effect on Receipt

If this command is received while the MainState attribute of the [Closure Control Cluster](#) that is [associated](#) with this cluster has any of the following values:

- Disengaged
- Protected
- Calibrating
- SetupRequired
- Error

then a status code of `INVALID_IN_STATE` SHALL be returned.

If a field is present in the command, but its associated feature is not supported, that field SHALL be treated as absent for the purposes of command processing. Specifically:

- If the Position field is present but the Positioning (PS) feature is not supported, the Position field SHALL be ignored and have no effect.
- If the Latch field is present but the MotionLatching (LT) feature is not supported, the Latch field SHALL be ignored and have no effect.
- If the Speed field is present but the Speed (SP) feature is not supported, the Speed field SHALL be ignored and have no effect.

In all such cases, the presence of an unsupported field SHALL NOT trigger errors or state changes.

If the Positioning (PS) feature and the MotionLatching (LT) feature are supported, and the command requests a position change, then:

- If the Latch field of the `CurrentState` attribute is True (Latched), and
- The Latch field in this command is either not present or not explicitly set to False (Unlatched),

Page 526







the command SHALL return a status code of INVALID\_IN\_STATE.

If all field values in the command match the corresponding field values in [CurrentState](#), the command SHALL have no effect.

Otherwise, the [TargetState](#) attribute SHALL be updated with the new values for Position, Latch and/or Speed, and a status code of SUCCESS SHALL be returned.

#### 5.5.8.1.5. Impact of Unit(UT) feature

The Unit (UT) feature defines the relationship between the physical unit range (e.g., millimeters, degrees) and the normalized percent100ths value. This allows clients to convert native unit values into percentage values for commands and attribute updates.

The mapping is as follows:

- The Min field of the "[Range](#)" attribute corresponds to 0.00%.
- The Max field of the "[Range](#)" attribute corresponds to 100.00%.

The formulas below show how to perform this conversion.

##### 5.5.8.1.5.1. Specific case of Degrees

In case of Slat orientation with range -90°/90°, both 0.00% and 100.00% target value create a Closed Position. This is the only accepted exception.

Example of Closure Dimension used for Modulation feature with Slats orientation type for different types of range.

| Min in degrees | Max in degrees | Needed value in degrees | Request Target value in % |
|----------------|----------------|-------------------------|---------------------------|
| 0°             | 90°            | 0°                      | 0%                        |
|                |                | 45°                     | 50%                       |
|                |                | 90°                     | 100%                      |
| -90°           | 90°            | -90°                    | 0%                        |
|                |                | -45°                    | 25%                       |
|                |                | 0°                      | 50%                       |
|                |                | 45°                     | 75%                       |
|                |                | 90°                     | 100%                      |
|                |                | -30°                    | 0%                        |
| -30°           | 90°            | 0°                      | 25%                       |
|                |                | 30°                     | 50%                       |
|                |                | 60°                     | 75%                       |
|                |                | 90°                     | 100%                      |
|                |                | -30°                    | 0%                        |




Page 527



### 5.5.8.2. Step Command

This command is used to move a dimension of the closure to a target position by a number of steps.

| ID | Name                 | Type               | Constraint | Quality | Fallback | Conformance |
|----|----------------------|--------------------|------------|---------|----------|-------------|
| 0  | <b>Direction</b>     | StepDirectionEnum  |            |         |          | M           |
| 1  | <b>NumberOfSteps</b> | uint16             | min 1      |         |          | M           |
| 2  | <b>Speed</b>         | ThreeLevelAutoEnum | desc       |         | Auto     | [SP]        |

#### 5.5.8.2.1. Direction Field

This field SHALL indicate whether the Position field of the [TargetState](#) attribute must be:

- Increased toward 100.00%.
- Decreased toward 0.00%.

#### 5.5.8.2.2. NumberOfSteps Field

This field SHALL indicate the number of steps by which the position should be changed. The size of one step, expressed in percent100ths, is determined by the ["StepValue"](#) attribute.

#### 5.5.8.2.3. Speed Field

This field SHALL indicate the desired speed of motion.

#### 5.5.8.2.4. Effect on Receipt

Upon receipt of this command:

- If this command is received while the Latch field of the [CurrentState](#) attribute is True (Latched), a status code of [INVALID\\_IN\\_STATE](#) SHALL be returned.
- If this command is received while the [MainState](#) attribute of the [Closure Control Cluster](#) that is [associated](#) with this cluster has any of the following values:
  - Disengaged
  - Protected
  - Calibrating
  - SetupRequired
  - Error

then a status code of [INVALID\\_IN\\_STATE](#) SHALL be returned.

- Otherwise, the server SHALL respond with a status code of [SUCCESS](#) and the [TargetState](#) attribute value SHALL be changed as follows:

Page 528







- If the Direction field is set to Decrease, the Position field of the TargetState attribute SHALL be set to:  $\text{TargetState.Position} = \text{CurrentState.Position} - \text{NumberOfSteps} * \text{StepValue}$  and the value SHALL be clamped to 0.00% if the Limitation feature is not supported or `LimitRange.Min` if the Limitation feature is supported.
- If the Direction field is set to Increase, the Position field of the TargetState attribute SHALL be set to:  $\text{TargetState.Position} = \text{CurrentState.Position} + \text{NumberOfSteps} * \text{StepValue}$  and the value SHALL be clamped to 100.00% if the Limitation feature is not supported or `LimitRange.Max` if the Limitation feature is supported.
- If the Speed field of the command is present, the Speed field of the TargetState attribute SHALL be set to the Speed field of the command, otherwise the Speed field of the TargetState attribute SHALL remain unchanged.





Page 529



Page 530







## Chapter 6. Media

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter. References to external documents are contained in Chapter 1 and are made using [Rn] notation.

### 6.1. General Description

#### 6.1.1. Introduction

The clusters specified in this document are for use typically in applications involving media (e.g., Video Players, Content Apps, Speakers), but MAY be used in any application domain.

#### 6.1.2. Cluster List

This section lists the media specific clusters as specified in this chapter.

*Table 11. Overview of the Media Clusters*

| Cluster ID | Cluster Name                         | Description                                                                                                          |
|------------|--------------------------------------|----------------------------------------------------------------------------------------------------------------------|
| 0x050E     | <a href="#">Account Login</a>        | This cluster provides an interface for facilitating user account login on an application or a node.                  |
| 0x050D     | <a href="#">Application Basic</a>    | Provides information about a Content App running on a Video Player device which is represented as an endpoint.       |
| 0x050C     | <a href="#">Application Launcher</a> | This cluster provides an interface for launching content on a Video Player device.                                   |
| 0x050B     | <a href="#">Audio Output</a>         | This cluster provides an interface for controlling the Output on a Video Player device.                              |
| 0x0504     | <a href="#">Channel</a>              | This cluster provides an interface for controlling the current Channel on an endpoint.                               |
| 0x0510     | <a href="#">Content App Observer</a> | This cluster provides an interface for sending targeted messages from a Content App to a Client of that Content App. |




Page 531



| Cluster ID | Cluster Name     | Description                                                                                                                                  |
|------------|------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| 0x050A     | Content Launcher | This cluster provides an interface for launching content on a Video Player device or a Content App.                                          |
| 0x0509     | Keypad Input     | This cluster provides an interface for controlling a Video Player or a Content App using action commands such as UP, DOWN, and SELECT.       |
| 0x0507     | Media Input      | This cluster provides an interface for controlling the Input Selector on a Video Player device.                                              |
| 0x0506     | Media Playback   | This cluster provides an interface for controlling Media Playback (PLAY, PAUSE, etc) on a Video Player device.                               |
| 0x0505     | Target Navigator | This cluster provides an interface for UX navigation within a set of targets on a Video Player device or Content App endpoint.               |
| 0x050F     | Content Control  | This cluster provides an interface for controlling Content controls such as turning on/off Content Control feature on a Video Player device. |

*Example Usage of the Media Clusters*

Page 532



![Diagram of a Smart TV Device Node showing its endpoints and clusters.](7a6f1cd99277d1762e1426ed23d12ba9_img.jpg)

The diagram illustrates the structure of a Smart TV Device Node, which consists of several endpoints, each containing specific clusters:

- Endpoint 0: Node**
  - Cluster: Descriptor (Device Type: TV, Parts: EP 1, 2, 21, 31, 41)
  - Cluster: [standard ep0 clusters]
- Endpoint 1: Video Player**
  - Cluster: Descriptor (Device Type: Video Player)
  - Cluster: OnOff
  - Cluster: Media Playback
  - Cluster: TV Channel
  - Cluster: Media Input
  - Cluster: Audio Output
  - Cluster: Low Power
  - Cluster: Keypad Input
  - Cluster: Content Launcher
  - Cluster: Application Launcher (As Application Platform)
- Endpoint 2: Speaker (Volume)**
  - Cluster: Descriptor (Device Type: Speaker)
  - Cluster: OnOff
  - Cluster: Level Control
- Endpoint 21: Content App (App 1)**
  - Cluster: Descriptor (Device Type: Content App)
  - Cluster: Application Basic
  - Cluster: Keypad Input
  - Cluster: TV Channel
  - Cluster: Content Launcher
  - Cluster: Application Launcher
- Endpoint 31: Content App (App 2)**
  - Cluster: Descriptor (Device Type: Content App)
  - Cluster: Application Basic
  - Cluster: Keypad Input
  - Cluster: Account Login
  - Cluster: Media Playback
  - Cluster: Target Navigator
  - Cluster: Application Launcher
- Endpoint 41: Content App (App 3)**
  - Cluster: Descriptor (Device Type: Content App)
  - Cluster: Application Basic
  - Cluster: Keypad Input
  - Cluster: Content Launcher
  - Cluster: Application Launcher

Diagram of a Smart TV Device Node showing its endpoints and clusters.

## 6.2. Account Login Cluster

This cluster provides commands that facilitate user account login on a Content App or a node. For example, a Content App running on a Video Player device, which is represented as an endpoint (see Device Type Library document), can use this cluster to help make the user account on the Content App match the user account on the Client.

Often a fabric administrator will facilitate commissioning of a Client (such as a Casting Video Client), and invoke commands on the AccountLogin cluster on the Content App associated with that client. Specifically:

1. GetSetupPIN in order to attempt to obtain the Passcode for commissioning.
2. Login in order to let the Content App know that commissioning has completed. The Content App can use information provided in this command in order to determine the user account associated with the client, and potentially assume that user account.
3. Logout in order to let the Content App know that client access has been removed, and potentially clear the current user account.

The cluster server for this cluster may be supported on each endpoint that represents a Content App on a Video Player device.

See Device Type Library document for details of how a Content App, represented as an endpoint on



Page 533



the Video Player device, may implement the cluster server for this cluster to simplify account login for its users.

### 6.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                             |
|----------|-------------------------------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                                        |
| 2        | Add support for 8 character Passcode in GetSetupPIN and Login, Add Node to Login, Logout commands. Add LoggedOut event. |

### 6.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | ALOGIN    |

### 6.2.3. Cluster ID

| ID     | Name          |
|--------|---------------|
| 0x050E | Account Login |

### 6.2.4. Commands

| ID   | Name                        | Direction                   | Response             | Access | Conformance |
|------|-----------------------------|-----------------------------|----------------------|--------|-------------|
| 0x00 | <b>GetSetupPIN</b>          | client $\Rightarrow$ server | GetSetupPIN-Response | A F T  | M           |
| 0x01 | <b>GetSetupPIN-Response</b> | client $\Leftarrow$ server  | N                    | F      | M           |
| 0x02 | <b>Login</b>                | client $\Rightarrow$ server | Y                    | A F T  | M           |
| 0x03 | <b>Logout</b>               | client $\Rightarrow$ server | Y                    | O F T  | M           |

#### 6.2.4.1. GetSetupPIN Command

The purpose of this command is to determine if the active user account of the given Content App matches the active user account of a given Commissioner, and when it does, return a Setup PIN which can be used for password-authenticated session establishment (PASE) with the Commissioner.

For example, a Video Player with a Content App Platform may invoke this command on one of its Content App endpoints to facilitate commissioning of a Phone App made by the same vendor as the Content App. If the accounts match, then the Content App may return a Setup PIN that can be used

Page 534



by the Video Player to commission the Phone App without requiring the user to physically input a Setup PIN.

The account match is determined by the Content App using a method which is outside the scope of this specification and will typically involve a central service which is in communication with both the Content App and the Commissioner. The GetSetupPIN command is needed in order to provide the Commissioner/Admin with a Setup PIN when this Commissioner/Admin is operated by a different vendor from the Content App.

This method is used to facilitate Setup PIN exchange (for PASE) between Commissioner and Commissioner when the same user account is active on both nodes. With this method, the Content App satisfies proof of possession related to commissioning by requiring the same user account to be active on both Commissioner and Content App, while the Commissioner/Admin ensures user consent by prompting the user prior to invocation of the command.

Upon receipt of this command, the Content App checks if the account associated with the Temporary Account Identifier sent by the client is the same account that is active on itself. If the accounts are the same, then the Content App returns the GetSetupPIN Response which includes a Setup PIN that may be used for PASE with the Commissioner.

The Temporary Account Identifier for a Commissioner may be populated with the Rotating ID field of the client's commissionable node advertisement (see Rotating Device Identifier section in [\[MatterCore\]](#)) encoded as an octet string where the octets of the Rotating Device Identifier are encoded as 2-character sequences by representing each octet's value as a 2-digit hexadecimal number, using uppercase letters.

The Setup PIN is a character string so that it can accommodate different future formats, including alpha-numeric encodings. For a Commissioner it SHALL be populated with the Manual Pairing Code (see Manual Pairing Code section in [\[MatterCore\]](#)) encoded as a string (11 characters) or the Passcode portion of the Manual Pairing Code (when less than 11 characters).

The server SHALL implement rate limiting to prevent brute force attacks. No more than 10 unique requests in a 10 minute period SHALL be allowed; a command response status of FAILURE should be sent for additional commands received within the 10 minute period. Because access to this command is limited to nodes with Admin-level access, and the user is prompted for consent prior to Commissioning, there are in place multiple obstacles to successfully mounting a brute force attack. A Content App that supports this command SHALL ensure that the Temporary Account Identifier used by its clients is not valid for more than 10 minutes.

| ID | Name                  | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------------------|--------|------------|---------|----------|-------------|
| 0  | TempAccountIdentifier | string | 16 to 100  |         |          | M           |

#### 6.2.4.1.1. TempAccountIdentifier Field

This field SHALL specify the client's Temporary Account Identifier. The length of this field SHALL be at least 16 characters to protect the account holder against password guessing attacks.



Page 535



#### 6.2.4.2. GetSetupPINResponse Command

This message is sent in response to the GetSetupPIN command, and contains the Setup PIN, or null when the account identified in the request does not match the active account of the running Content App.

| ID | Name            | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------|------------|---------|----------|-------------|
| 0  | <b>SetupPIN</b> | string | desc       |         |          | M           |

##### 6.2.4.2.1. SetupPIN Field

This field SHALL provide the Setup PIN as a text string at least 8 characters in length or empty string to indicate that the accounts do not match.

**NOTE**

Newer cluster clients should be aware that AccountLogin cluster version 1 specified an 11 digit minimum length.

#### 6.2.4.3. Login Command

The purpose of this command is to allow the Content App to assume the user account of a given Commissioner by leveraging the Setup PIN input by the user during the commissioning process.

For example, a Video Player with a Content App Platform may invoke this command on one of its Content App endpoints after the commissioning has completed of a Phone App made by the same vendor as the Content App. The Content App may determine whether the Temporary Account Identifier maps to an account with a corresponding Setup PIN and, if so, it may automatically login to the account for the corresponding user. The end result is that a user performs commissioning of a Phone App to a Video Player by inputting the Setup PIN for the Phone App into the Video Player UX. Once commissioning has completed, the Video Player invokes this command to allow the corresponding Content App to assume the same user account as the Phone App.

The verification of Setup PIN for the given Temporary Account Identifier is determined by the Content App using a method which is outside the scope of this specification and will typically involve a central service which is in communication with both the Content App and the Commissioner. Implementations of such a service should impose aggressive time outs for any mapping of Temporary Account Identifier to Setup PIN in order to prevent accidental login due to delayed invocation.

Upon receipt, the Content App checks if the account associated with the client's Temp Account Identifier has a current active Setup PIN with the given value. If the Setup PIN is valid for the user account associated with the Temp Account Identifier, then the Content App MAY make that user account active.

The Temporary Account Identifier for a Commissioner may be populated with the Rotating ID field of the client's commissionable node advertisement encoded as an octet string where the octets of the Rotating Device Identifier are encoded as 2-character sequences by representing each octet's value as a 2-digit hexadecimal number, using uppercase letters.

The Setup PIN for a Commissioner may be populated with the Manual Pairing Code encoded as a

Page 536







string of decimal numbers (11 characters) or the Passcode portion of the Manual Pairing Code encoded as a string of decimal numbers (8 characters).

The server SHALL implement rate limiting to prevent brute force attacks. No more than 10 unique requests in a 10 minute period SHALL be allowed; a command response status of FAILURE should be sent for additional commands received within the 10 minute period. Because access to this command is limited to nodes with Admin-level access, and the user is involved when obtaining the Setup PIN, there are in place multiple obstacles to successfully mounting a brute force attack. A Content App that supports this command SHALL ensure that the Temporary Account Identifier used by its clients is not valid for more than 10 minutes.

| ID | Name                         | Type    | Constraint | Quality | Fallback | Conformance |
|----|------------------------------|---------|------------|---------|----------|-------------|
| 0  | <b>TempAccountIdentifier</b> | string  | 16 to 100  |         |          | M           |
| 1  | <b>SetupPIN</b>              | string  | min 8      |         |          | M           |
| 2  | <b>Node</b>                  | node-id |            |         |          | O           |

#### 6.2.4.3.1. TempAccountIdentifier Field

This field SHALL specify the client's temporary account identifier.

#### 6.2.4.3.2. SetupPIN Field

This field SHALL provide the Setup PIN as a text string at least 8 characters in length.

**NOTE**

Newer cluster clients should be aware that AccountLogin cluster revision 1 specified an 11 digit minimum length.

#### 6.2.4.3.3. Node Field

This optional field SHALL provide the Node ID of the Client. This field can be used by the Content App to keep track of Nodes which currently have access to it.

### 6.2.4.4. Logout Command

The purpose of this command is to instruct the Content App to clear the current user account. This command SHOULD be used by clients of a Content App to indicate the end of a user session.

| ID | Name        | Type    | Constraint | Quality | Fallback | Conformance |
|----|-------------|---------|------------|---------|----------|-------------|
| 0  | <b>Node</b> | node-id |            |         |          | O           |

#### 6.2.4.4.1. Node Field

This optional field SHALL provide the Node ID of the Client. This field can be used by the Content App to keep track of Nodes which currently have access to it.




Page 537



## 6.2.5. Events

| ID | Name      | Priority | Access | Conformance |
|----|-----------|----------|--------|-------------|
| 0  | LoggedOut | CRITICAL | A S    | O           |

### 6.2.5.1. LoggedOut Event

This event can be used by the Content App to indicate that the current user has logged out. In response to this event, the Fabric Admin SHALL remove access to this Content App by the specified Node. If no Node is provided, then the Fabric Admin SHALL remove access to all non-Admin Nodes.

The data of this event SHALL contain the following information:

| ID | Name | Type    | Constraint | Quality | Fallback | Conformance |
|----|------|---------|------------|---------|----------|-------------|
| 0  | Node | node-id | all        |         |          | O           |

#### 6.2.5.1.1. Node

This field SHALL provide the Node ID corresponding to the user account that has logged out, if that Node ID is available. If it is NOT available, this field SHALL NOT be present in the event.

## 6.3. Application Basic Cluster

This cluster provides information about a Content App running on a Video Player device which is represented as an endpoint (see Device Type Library document).

The cluster server for this cluster should be supported on each endpoint that represents a Content App on a Video Player device. This cluster provides identification information about the Content App such as vendor and product.

### 6.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 6.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | APBSC     |

Page 538



### 6.3.3. Cluster ID

| ID     | Name              |
|--------|-------------------|
| 0x050D | Application Basic |

### 6.3.4. Data Types

#### 6.3.4.1. ApplicationStatusEnum Type

This data type is derived from enum8.

| Value | Name                         | Summary                                                                             | Conformance |
|-------|------------------------------|-------------------------------------------------------------------------------------|-------------|
| 0     | <b>Stopped</b>               | Application is not running.                                                         | M           |
| 1     | <b>ActiveVisibleFocus</b>    | Application is running, is visible to the user, and is the active target for input. | M           |
| 2     | <b>ActiveHidden</b>          | Application is running but not visible to the user.                                 | M           |
| 3     | <b>ActiveVisibleNotFocus</b> | Application is running and visible, but is not the active target for input.         | M           |

#### 6.3.4.2. ApplicationStruct Type

This indicates a global identifier for an Application given a catalog.

| ID | Name                   | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>CatalogVendorID</b> | uint16 | all        |         |          |        | M           |
| 1  | <b>ApplicationID</b>   | string | all        |         |          |        | M           |

##### 6.3.4.2.1. CatalogVendorID Field

This field SHALL indicate the Connectivity Standards Alliance issued vendor ID for the catalog. The DIAL registry SHALL use value 0x0000.

It is assumed that Content App Platform providers (see Video Player Architecture section in [\[Matter-DevLib\]](#)) will have their own catalog vendor ID (set to their own Vendor ID) and will assign an ApplicationID to each Content App.




Page 539



#### 6.3.4.2.2. ApplicationID Field

This field SHALL indicate the application identifier, expressed as a string, such as "123456-5433", "PruneVideo" or "Company X". This field SHALL be unique within a catalog.

For the DIAL registry catalog, this value SHALL be the DIAL prefix.

### 6.3.5. Attributes

| ID     | Name                        | Type                    | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------------|-------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Vendor-Name</b>          | string                  | max 32     | F       | empty    | R V    | O           |
| 0x0001 | <b>VendorID</b>             | vendor-id               | all        | F       |          | R V    | O           |
| 0x0002 | <b>Applica-tionName</b>     | string                  | max 256    | F       |          | R V    | M           |
| 0x0003 | <b>ProductID</b>            | uint16                  | all        | F       |          | R V    | O           |
| 0x0004 | <b>Applica-tion</b>         | Applica-tionStruct      | desc       | F       |          | R V    | M           |
| 0x0005 | <b>Status</b>               | Applica-tionSta-tusEnum | desc       |         | MS       | R V    | M           |
| 0x0006 | <b>Applica-tionVer-sion</b> | string                  | max 32     | F       |          | R V    | M           |
| 0x0007 | <b>Allowed-Ven-dorList</b>  | list[ven-dor-id]        |            | F       |          | R A    | M           |

#### 6.3.5.1. VendorName Attribute

This attribute SHALL specify a human readable (displayable) name of the vendor for the Content App.

#### 6.3.5.2. VendorID Attribute

This attribute, if present, SHALL specify the Connectivity Standards Alliance assigned Vendor ID for the Content App.

#### 6.3.5.3. ApplicationName Attribute

This attribute SHALL specify a human readable (displayable) name of the Content App assigned by the vendor. For example, "NPR On Demand".

Page 540







#### 6.3.5.4. ProductID Attribute

This attribute, if present, SHALL specify a numeric ID assigned by the vendor to identify a specific Content App made by them. If the Content App is certified by the Connectivity Standards Alliance, then this would be the Product ID as specified by the vendor for the certification.

#### 6.3.5.5. Application Attribute

This attribute SHALL specify a Content App which consists of an Application ID using a specified catalog.

#### 6.3.5.6. Status Attribute

This attribute SHALL specify the current running status of the application.

#### 6.3.5.7. ApplicationVersion Attribute

This attribute SHALL specify a human readable (displayable) version of the Content App assigned by the vendor.

#### 6.3.5.8. AllowedVendorList Attribute

This attribute is a list of vendor IDs. Each entry is a vendor-id.

### 6.4. Application Launcher Cluster

This cluster provides an interface for launching applications on a Video Player device such as a TV.

This cluster is supported on endpoints that can launch Applications, such as a Casting Video Player device with a Content App Platform. It supports identifying an Application by global identifier from a given catalog, and launching it. It also supports tracking the currently in-focus Application.

Depending on the support for the Application Platform feature, the cluster can either support launching the application corresponding to the endpoint on which the cluster is supported (AP feature not supported) or it can support launching any application (AP feature supported).

#### 6.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                          |
|----------|--------------------------------------|
| 1        | Initial revision                     |
| 2        | Addition of new states to StatusEnum |

#### 6.4.2. Classification



Page 541



| Hierarchy | Role        | Scope    | PICS Code   |
|-----------|-------------|----------|-------------|
| Base      | Application | Endpoint | APPLAUNCHER |

### 6.4.3. Cluster ID

| ID     | Name                 |
|--------|----------------------|
| 0x050C | Application Launcher |

### 6.4.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature             | Summary                                                                                                                                  |
|-----|------|---------------------|------------------------------------------------------------------------------------------------------------------------------------------|
| 0   | AP   | ApplicationPlatform | Support for attributes and commands required for endpoint to support launching any application within the supported application catalogs |

### 6.4.5. Data Types

#### 6.4.5.1. StatusEnum Type

This data type is derived from enum8.

| Value | Name                       | Summary                                   | Conformance |
|-------|----------------------------|-------------------------------------------|-------------|
| 0     | <b>Success</b>             | Command succeeded                         | M           |
| 1     | <b>AppNotAvailable</b>     | Requested app is not available            | M           |
| 2     | <b>SystemBusy</b>          | Video platform unable to honor command    | M           |
| 3     | <b>PendingUserApproval</b> | User approval for app download is pending | M           |
| 4     | <b>Downloading</b>         | Downloading the requested app             | M           |
| 5     | <b>Installing</b>          | Installing the requested app              | M           |

#### 6.4.5.2. ApplicationStruct Type

This indicates a global identifier for an Application given a catalog.

Page 542







| ID | Name            | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|--------|------------|---------|----------|--------|-------------|
| 0  | CatalogVendorID | uint16 | all        |         |          |        | M           |
| 1  | ApplicationID   | string | all        |         |          |        | M           |

#### 6.4.5.2.1. CatalogVendorID Field

This field SHALL indicate the Connectivity Standards Alliance-issued vendor ID for the catalog. The DIAL registry SHALL use value 0x0000.

Content App Platform providers will have their own catalog vendor ID (set to their own Vendor ID) and will assign an ApplicationID to each Content App.

#### 6.4.5.2.2. ApplicationID Field

This field SHALL indicate the application identifier, expressed as a string, such as "PruneVideo" or "Company X". This field SHALL be unique within a catalog.

For the DIAL registry catalog, this value SHALL be the DIAL prefix (see [\[DIAL Registry\]](#)).

#### 6.4.5.3. ApplicationEPStruct Type

This specifies an app along with its corresponding endpoint.

| ID | Name        | Type              | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------|-------------------|------------|---------|----------|--------|-------------|
| 0  | Application | ApplicationStruct | all        |         |          |        | M           |
| 1  | Endpoint    | endpoint-no       | all        |         | MS       |        | O           |

### 6.4.6. Attributes

| ID     | Name        | Type                 | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------|----------------------|------------|---------|----------|--------|-------------|
| 0x0000 | CatalogList | list[uint16]         |            | N       |          | R V    | AP          |
| 0x0001 | CurrentApp  | ApplicationEP-Struct | desc       | X       | null     | R V    | O           |



Page 543



#### 6.4.6.1. CatalogList Attribute

This attribute SHALL specify the list of supported application catalogs, where each entry in the list is the Connectivity Standards Alliance-issued vendor ID for the catalog. The DIAL registry (see [DIAL Registry]) SHALL use value 0x0000.

It is expected that Content App Platform providers will have their own catalog vendor ID (set to their own Vendor ID) and will assign an ApplicationID to each Content App.

#### 6.4.6.2. CurrentApp Attribute

This attribute SHALL specify the current in-focus application, identified using an Application ID, catalog vendor ID and the corresponding endpoint number when the application is represented by a Content App endpoint. A null SHALL be used to indicate there is no current in-focus application.

### 6.4.7. Commands

| ID   | Name                    | Direction                   | Response         | Access | Conformance |
|------|-------------------------|-----------------------------|------------------|--------|-------------|
| 0x00 | <b>LaunchApp</b>        | client $\Rightarrow$ server | LauncherResponse | O      | M           |
| 0x01 | <b>StopApp</b>          | client $\Rightarrow$ server | LauncherResponse | O      | M           |
| 0x02 | <b>HideApp</b>          | client $\Rightarrow$ server | LauncherResponse | O      | M           |
| 0x03 | <b>LauncherResponse</b> | client $\Leftarrow$ server  | N                |        | M           |

#### 6.4.7.1. LaunchApp Command

Upon receipt of this command, the server SHALL launch the application with optional data. The application SHALL be either

- the specified application, if the Application Platform feature is supported;
- otherwise the application corresponding to the endpoint.

The endpoint SHALL launch and bring to foreground the requisite application if the application is not already launched and in foreground. The Status attribute SHALL be updated to ActiveVisibleFocus on the Application Basic cluster of the Endpoint corresponding to the launched application. The Status attribute SHALL be updated on any other application whose Status MAY have changed as a result of this command. The CurrentApp attribute, if supported, SHALL be updated to reflect the new application in the foreground.

This command returns a Launcher Response.

Page 544



| ID | Name        | Type               | Constraint | Quality | Fallback | Conformance |
|----|-------------|--------------------|------------|---------|----------|-------------|
| 0  | Application | Application-Struct | desc       |         |          | AP          |
| 1  | Data        | octstr             |            |         | MS       | O           |

#### 6.4.7.1.1. Application Field

This field SHALL specify the Application to launch.

#### 6.4.7.1.2. Data Field

This field SHALL specify optional app-specific data to be sent to the app.

**NOTE** This format and meaning of this value is proprietary and outside the specification. It provides a transition path for device makers that use other protocols (like DIAL) which allow for proprietary data. Apps that are not yet Matter aware can be launched via Matter, while retaining the existing ability to launch with proprietary data.

### 6.4.7.2. StopApp Command

Upon receipt of this command, the server SHALL stop the application if it is running. The application SHALL be either

- the specified application, if the Application Platform feature is supported;
- otherwise the application corresponding to the endpoint.

The Status attribute SHALL be updated to Stopped on the Application Basic cluster of the Endpoint corresponding to the stopped application. The Status attribute SHALL be updated on any other application whose Status MAY have changed as a result of this command.

This command returns a Launcher Response.

| ID | Name        | Type               | Constraint | Quality | Fallback | Conformance |
|----|-------------|--------------------|------------|---------|----------|-------------|
| 0  | Application | Application-Struct | desc       |         | MS       | AP          |

#### 6.4.7.2.1. Application Field

This field SHALL specify the Application to stop.

### 6.4.7.3. HideApp Command

Upon receipt of this command, the server SHALL hide the application. The application SHALL be either




Page 545



- the specified application, if the Application Platform feature is supported;
- otherwise the application corresponding to the endpoint.

The endpoint MAY decide to stop the application based on manufacturer specific behavior or resource constraints if any. The Status attribute SHALL be updated to ActiveHidden or Stopped, depending on the action taken, on the Application Basic cluster of the Endpoint corresponding to the application on which the action was taken. The Status attribute SHALL be updated on any other application whose Status MAY have changed as a result of this command.

This command returns a Launcher Response.

| ID | Name        | Type               | Constraint | Quality | Fallback | Conformance |
|----|-------------|--------------------|------------|---------|----------|-------------|
| 0  | Application | Application-Struct | desc       |         | MS       | AP          |

#### 6.4.7.3.1. Application Field

This field SHALL specify the Application to hide.

#### 6.4.7.4. LauncherResponse Command

This command SHALL be generated in response to LaunchApp/StopApp/HideApp commands.

| ID | Name   | Type       | Constraint | Quality | Fallback | Conformance |
|----|--------|------------|------------|---------|----------|-------------|
| 0  | Status | StatusEnum | all        |         |          | M           |
| 1  | Data   | octstr     |            |         | MS       | O           |

##### 6.4.7.4.1. Status Field

This field SHALL indicate the status of the command which resulted in this response.

##### 6.4.7.4.2. Data Field

This field SHALL specify Optional app-specific data.

## 6.5. Audio Output Cluster

This cluster provides an interface for controlling the Output on a Video Player device such as a TV.

This cluster would be supported on a device with audio outputs like a Video Player device (Smart TV, TV Setup Top Box, Smart Speaker, etc).

This cluster provides the list of available outputs and provides commands for selecting and renaming them.

The cluster server for Audio Output is implemented by a device that has configurable audio output.

Page 546







### 6.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 6.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code   |
|-----------|-------------|----------|-------------|
| Base      | Application | Endpoint | AUDIOOUTPUT |

### 6.5.3. Cluster ID

| ID     | Name         |
|--------|--------------|
| 0x050B | Audio Output |

### 6.5.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature     | Summary                          |
|-----|------|-------------|----------------------------------|
| 0   | NU   | NameUpdates | Supports updates to output names |

### 6.5.5. Data Types

#### 6.5.5.1. OutputTypeEnum Type

This data type is derived from enum8.

The type of output, expressed as an enum, with the following values:

| Value | Name      | Summary | Conformance |
|-------|-----------|---------|-------------|
| 0     | HDMI      | HDMI    | M           |
| 1     | BT        |         | M           |
| 2     | Optical   |         | M           |
| 3     | Headphone |         | M           |
| 4     | Internal  |         | M           |
| 5     | Other     |         | M           |



Page 547



### 6.5.5.2. OutputInfoStruct Type

This contains information about an output.

| ID | Name       | Type           | Constraint | Quality | Fallback | Conformance |
|----|------------|----------------|------------|---------|----------|-------------|
| 0  | Index      | uint8          | all        |         |          | M           |
| 1  | OutputType | OutputTypeEnum | desc       |         |          | M           |
| 2  | Name       | string         | all        |         |          | M           |

#### 6.5.5.2.1. Index Field

This field SHALL indicate the unique index into the list of outputs.

#### 6.5.5.2.2. OutputType Field

This field SHALL indicate the type of output.

#### 6.5.5.2.3. Name Field

The device defined and user editable output name, such as “Soundbar”, “Speakers”. This field may be blank, but SHOULD be provided when known.

### 6.5.6. Attributes

| ID     | Name          | Type                   | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------|------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | OutputList    | list[OutputInfoStruct] |            |         |          | R V    | M           |
| 0x0001 | CurrentOutput | uint8                  | all        |         |          | R V    | M           |

#### 6.5.6.1. OutputList Attribute

This attribute provides the list of outputs supported by the device.

#### 6.5.6.2. CurrentOutput Attribute

This attribute contains the value of the index field of the currently selected [OutputInfoStruct](#).

### 6.5.7. Commands

| ID   | Name         | Direction       | Response | Access | Conformance |
|------|--------------|-----------------|----------|--------|-------------|
| 0x00 | SelectOutput | client ⇒ server | Y        | O      | M           |

Page 548







| ID   | Name                | Direction                   | Response | Access | Conformance |
|------|---------------------|-----------------------------|----------|--------|-------------|
| 0x01 | <b>RenameOutput</b> | client $\Rightarrow$ server | Y        | M      | NU          |

### 6.5.7.1. SelectOutput Command

Upon receipt, this SHALL change the output on the device to the output at a specific index in the Output List.

Note that when the current output is set to an output of type HDMI, adjustments to volume via a Speaker endpoint on the same node MAY cause HDMI volume up/down commands to be sent to the given HDMI output.

| ID | Name         | Type  | Constraint | Quality | Fallback | Conformance |
|----|--------------|-------|------------|---------|----------|-------------|
| 0  | <b>Index</b> | uint8 | all        |         |          | M           |

#### 6.5.7.1.1. Index Field

This SHALL indicate the index field of the [OutputInfoStruct](#) from the OutputList attribute in which to change to.

### 6.5.7.2. RenameOutput Command

Upon receipt, this SHALL rename the output at a specific index in the Output List.

Updates to the output name SHALL appear in the device's settings menus. Name updates MAY automatically be sent to the actual device to which the output connects.

| ID | Name         | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------------|--------|------------|---------|----------|-------------|
| 0  | <b>Index</b> | uint8  | all        |         |          | M           |
| 1  | <b>Name</b>  | string | all        |         |          | M           |

## 6.6. Channel Cluster

This cluster provides an interface for controlling the current Channel on a device or endpoint.

This cluster server would be supported on Video Player devices or endpoints that allow Channel control such as a Content App. This cluster provides a list of available channels and provides commands for absolute and relative channel changes. Some of these commands and/or their responses MAY be large (see Large Message Quality under Data Model section in [\[MatterCore\]](#)), but they do not have the Large quality indicator (L) because they can also be transferred over MRP (see Message Reliability Protocol in [\[MatterCore\]](#)) in pages that fit within the MRP MTU limit. However, an implementation MAY leverage a transport like TCP that allows large payloads, if available, to minimize the number of messages required to transfer the corresponding payload.




Page 549



The cluster server for Channel is implemented by an endpoint that controls the current Channel.

### 6.6.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                         |
|----------|-----------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                    |
| 2        | Add EG and RP features, Identifier and Type to Channel Info for Over-the-Top (OTT) channel support. |

### 6.6.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | CHANNEL   |

### 6.6.3. Cluster ID

| ID     | Name    |
|--------|---------|
| 0x0504 | Channel |

### 6.6.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature         | Summary                                                                                 |
|-----|------|-----------------|-----------------------------------------------------------------------------------------|
| 0   | CL   | ChannelList     | Provides list of available channels.                                                    |
| 1   | LI   | LineupInfo      | Provides lineup info, which is a reference to an external source of lineup information. |
| 2   | EG   | ElectronicGuide | Provides electronic program guide information.                                          |
| 3   | RP   | RecordProgram   | Provides ability to record program.                                                     |

### 6.6.5. Data Types

Page 550







### 6.6.5.1. RecordingFlagBitmap Type

This data type is derived from map8.

| Bit | Name                | Summary                                             | Conformance |
|-----|---------------------|-----------------------------------------------------|-------------|
| 0   | <b>Scheduled</b>    | The program is scheduled for recording.             | M           |
| 1   | <b>RecordSeries</b> | The program series is scheduled for recording.      | M           |
| 2   | <b>Recorded</b>     | The program is recorded and available to be played. | M           |

### 6.6.5.2. LineupInfoTypeEnum Type

This data type is derived from enum8.

| Value | Name       | Summary               | Conformance |
|-------|------------|-----------------------|-------------|
| 0     | <b>MSO</b> | Multi System Operator | M           |

### 6.6.5.3. StatusEnum Type

This data type is derived from enum8.

| Value | Name                   | Summary                                                        | Conformance |
|-------|------------------------|----------------------------------------------------------------|-------------|
| 0     | <b>Success</b>         | Command succeeded                                              | M           |
| 1     | <b>MultipleMatches</b> | More than one equal match for the ChannelInfoStruct passed in. | M           |
| 2     | <b>NoMatches</b>       | No matches for the ChannelInfoStruct passed in.                | M           |

### 6.6.5.4. ChannelTypeEnum Type

This data type is derived from enum8.

| Value | Name             | Summary                                           | Conformance |
|-------|------------------|---------------------------------------------------|-------------|
| 0     | <b>Satellite</b> | The channel is sourced from a satellite provider. | M           |
| 1     | <b>Cable</b>     | The channel is sourced from a cable provider.     | M           |




Page 551



| Value | Name               | Summary                                             | Conformance |
|-------|--------------------|-----------------------------------------------------|-------------|
| 2     | <b>Terrestrial</b> | The channel is sourced from a terrestrial provider. | M           |
| 3     | <b>OTT</b>         | The channel is sourced from an OTT provider.        | M           |

#### 6.6.5.5. ChannelInfoStruct Type

This indicates a channel in a channel lineup.

While the major and minor numbers in the ChannelInfoStruct support use of ATSC channel format, a lineup MAY use other formats which can map into these numeric values.

| ID | Name                      | Type             | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------------|------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Major-Number</b>       | uint16           | all        |         |          |        | M           |
| 1  | <b>Minor-Number</b>       | uint16           | all        |         |          |        | M           |
| 2  | <b>Name</b>               | string           |            |         | empty    |        | O           |
| 3  | <b>CallSign</b>           | string           |            |         | empty    |        | O           |
| 4  | <b>Affiliate-CallSign</b> | string           |            |         | empty    |        | O           |
| 5  | <b>Identifier</b>         | string           |            |         | empty    |        | O           |
| 6  | <b>Type</b>               | Channel-TypeEnum |            |         | empty    |        | O           |

##### 6.6.5.5.1. MajorNumber Field

This field SHALL indicate the channel major number value (for example, using ATSC format). When the channel number is expressed as a string, such as "13.1" or "256", the major number would be 13 or 256, respectively. This field is required but SHALL be set to 0 for channels such as over-the-top channels that are not represented by a major or minor number.

##### 6.6.5.5.2. MinorNumber Field

This field SHALL indicate the channel minor number value (for example, using ATSC format). When the channel number is expressed as a string, such as "13.1" or "256", the minor number would be 1 or 0, respectively. This field is required but SHALL be set to 0 for channels such as over-the-top channels that are not represented by a major or minor number.

##### 6.6.5.5.3. Name Field

This field SHALL indicate the marketing name for the channel, such as "The CW" or "Comedy Central". This field is optional, but SHOULD be provided when known.

Page 552



#### 6.6.5.5.4. CallSign Field

This field SHALL indicate the call sign of the channel, such as "PBS". This field is optional, but SHOULD be provided when known.

#### 6.6.5.5.5. AffiliateCallSign Field

This field SHALL indicate the local affiliate call sign, such as "KCTS". This field is optional, but SHOULD be provided when known.

#### 6.6.5.5.6. Identifier Field

This SHALL indicate the unique identifier for a specific channel. This field is optional, but SHOULD be provided when MajorNumber and MinorNumber are not available.

#### 6.6.5.5.7. Type Field

This SHALL indicate the type or grouping of a specific channel. This field is optional, but SHOULD be provided when known.

### 6.6.5.6. LineupInfoStruct Type

The Lineup Info allows references to external lineup sources like Gracenote. The combination of OperatorName, LineupName, and PostalCode SHALL uniquely identify a lineup.

| ID | Name           | Type                               | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------|------------------------------------|------------|---------|----------|--------|-------------|
| 0  | Operator-Name  | string                             |            |         |          |        | M           |
| 1  | Lineup-Name    | string                             |            |         | empty    |        | O           |
| 2  | PostalCode     | string                             |            |         | empty    |        | O           |
| 3  | LineupInfoType | <a href="#">LineupInfoTypeEnum</a> | desc       |         |          |        | M           |

#### 6.6.5.6.1. OperatorName Field

This field SHALL indicate the name of the operator, for example "Comcast".

#### 6.6.5.6.2. LineupName Field

This field SHALL indicate the name of the provider lineup, for example "Comcast King County". This field is optional, but SHOULD be provided when known.

#### 6.6.5.6.3. PostalCode Field

This field SHALL indicate the postal code (zip code) for the location of the device, such as "98052". This field is optional, but SHOULD be provided when known.



Page 553



#### 6.6.5.6.4. LineupInfoType Field

This field SHALL indicate the type of lineup. This field is optional, but SHOULD be provided when known.

#### 6.6.5.7. ProgramStruct Type

This indicates a program within an electronic program guide (EPG).

| ID | Name                        | Type                        | Constraint     | Quality | Fallback | Access | Conformance |
|----|-----------------------------|-----------------------------|----------------|---------|----------|--------|-------------|
| 0  | <b>Identifier</b>           | string                      | max 255        |         |          |        | M           |
| 1  | <b>Channel</b>              | ChannelInfoStruct           |                |         |          |        | M           |
| 2  | <b>StartTime</b>            | epoch-s                     |                |         |          |        | M           |
| 3  | <b>EndTime</b>              | epoch-s                     |                |         |          |        | M           |
| 4  | <b>Title</b>                | string                      | max 255        |         |          |        | M           |
| 5  | <b>Subtitle</b>             | string                      | max 255        |         | empty    |        | O           |
| 6  | <b>Description</b>          | string                      | max 8192       |         | empty    |        | O           |
| 7  | <b>AudioLanguages</b>       | list[string]                | max 10[max 50] |         | empty    |        | O           |
| 8  | <b>Ratings</b>              | list[string]                | max 255        |         | empty    |        | O           |
| 9  | <b>ThumbnailUrl</b>         | string                      | max 8192       |         | empty    |        | O           |
| 10 | <b>PosterArtUrl</b>         | string                      | max 8192       |         | empty    |        | O           |
| 11 | <b>DvbiUrl</b>              | string                      | max 8192       |         | empty    |        | O           |
| 12 | <b>ReleaseDate</b>          | string                      | max 30         |         | empty    |        | O           |
| 13 | <b>ParentalGuidanceText</b> | string                      | max 255        |         | empty    |        | O           |
| 14 | <b>RecordingFlag</b>        | RecordingFlagBitmap         |                |         |          |        | RP          |
| 15 | <b>SeriesInfo</b>           | SeriesInfoStruct            |                | X       | null     |        | O           |
| 16 | <b>CategoryList</b>         | list[ProgramCategoryStruct] | max 255        |         | empty    |        | O           |

Page 554







| ID | Name           | Type                                         | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------|----------------------------------------------|------------|---------|----------|--------|-------------|
| 17 | CastList       | list[ <a href="#">ProgramCast-Struct</a> ]   | max 255    |         | empty    |        | 0           |
| 18 | ExternalIDList | list[ <a href="#">AdditionalInfoStruct</a> ] | max 255    |         | empty    |        | 0           |

#### 6.6.5.7.1. Identifier Field

This field SHALL indicate a unique identifier for a program within an electronic program guide list. The identifier SHALL be unique across multiple channels.

#### 6.6.5.7.2. Channel Field

This field SHALL indicate the channel associated to the program.

#### 6.6.5.7.3. StartTime Field

This field SHALL indicate an epoch time in seconds indicating the start time of a program, as a UTC time. This field can represent a past or future value.

#### 6.6.5.7.4. EndTime Field

This field SHALL indicate an epoch time in seconds indicating the end time of a program, as a UTC time. This field can represent a past or future value but SHALL be greater than the StartTime.

#### 6.6.5.7.5. Title Field

This field SHALL indicate the title or name for the specific program. For example, "MCIS: Los Angeles".

#### 6.6.5.7.6. Subtitle Field

This field SHALL indicate the subtitle for the specific program. For example, "Maybe Today" which is an episode name for "MCIS: Los Angeles". This field is optional but SHALL be provided if applicable and known.

#### 6.6.5.7.7. Description Field

This field SHALL indicate the brief description for the specific program. For example, a description of an episode. This field is optional but SHALL be provided if known.

#### 6.6.5.7.8. AudioLanguages Field

This field SHALL indicate the audio language for the specific program. The value is a string containing one of the standard Tags for Identifying Languages [RFC 5646](#). This field is optional but SHALL be provided if known.



Page 555



#### 6.6.5.7.9. Ratings Field

This field SHALL be used for indicating the level of parental guidance recommended for of a particular program. This can be any rating system used in the country or region where the program is broadcast. For example, in the United States “TV-PG” may contain material that parents can find not suitable for younger children but can be accepted in general for older children. This field is optional but SHALL be provided if known.

#### 6.6.5.7.10. ThumbnailUrl Field

This field SHALL represent a URL of a thumbnail that clients can use to render an image for the program. The syntax of this field SHALL follow the syntax as specified in [RFC 1738](#) and SHALL use the [https](#) scheme.

#### 6.6.5.7.11. PosterArtUrl Field

This field SHALL represent a URL of a poster that clients can use to render an image for the program on the detail view. The syntax of this field SHALL follow the syntax as specified in [RFC 1738](#) and SHALL use the [https](#) scheme.

#### 6.6.5.7.12. DvbiUrl Field

This field SHALL represent the DVB-I URL associated to the program. The syntax of this field SHALL follow the syntax as specified in [RFC 1738](#) and SHALL use the [https](#) scheme.

#### 6.6.5.7.13. ReleaseDate Field

This field SHALL be a string, in [ISO 8601](#) format, representing the date on which the program was released. This field is optional but when provided, the year SHALL be provided as part of the string.

#### 6.6.5.7.14. ParentalGuidanceText Field

This field SHALL represent a string providing additional information on the parental guidance. This field is optional.

#### 6.6.5.7.15. RecordingFlag Field

This field SHALL represent the recording status of the program. This field is required if the Record-Program feature is set.

#### 6.6.5.7.16. SeriesInfo Field

This field SHALL represent the information of a series such as season and episode number. This field is optional but SHOULD be provided if the program represents a series and this information is available.

#### 6.6.5.7.17. CategoryList Field

This field SHALL represent the category of a particular program. This field is optional but SHALL be provided if known.

Page 556







#### 6.6.5.7.18. CastList Field

This field SHALL represent a list of the cast or the crew on the program. A single cast member may have more than one role. This field is optional but SHALL be provided if known.

#### 6.6.5.7.19. ExternalIDList Field

This field SHALL indicate the list of additional external content identifiers.

### 6.6.5.8. ProgramCategoryStruct Type

This object defines the category associated to a program.

| ID | Name        | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------|--------|------------|---------|----------|--------|-------------|
| 0  | Category    | string | max 256    |         |          |        | M           |
| 1  | SubCategory | string | max 256    |         | empty    |        | O           |

#### 6.6.5.8.1. Category Field

This field SHALL represent the category or genre of the program. Ex. News.

#### 6.6.5.8.2. SubCategory Field

This field SHALL represent the sub-category or sub-genre of the program. Ex. Local.

### 6.6.5.9. SeriesInfoStruct Type

This object provides the episode information related to a program.

| ID | Name    | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|---------|--------|------------|---------|----------|--------|-------------|
| 0  | Season  | string | max 256    |         |          |        | M           |
| 1  | Episode | string | max 256    |         |          |        | M           |

#### 6.6.5.9.1. Season Field

This field SHALL represent the season of the series associated to the program.

#### 6.6.5.9.2. Episode Field

This field SHALL represent the episode of the program.

### 6.6.5.10. ProgramCastStruct Type

This object provides the cast information related to a program.




Page 557



| ID | Name        | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>Name</b> | string | max 256    |         |          |        | M           |
| 1  | <b>Role</b> | string | max 256    |         |          |        | M           |

#### 6.6.5.10.1. Name Field

This field SHALL represent the name of the cast member.

#### 6.6.5.10.2. Role Field

This field SHALL represent the role of the cast member. Ex. Actor, Director.

### 6.6.5.11. PageTokenStruct Type

This object defines the pagination structure.

| ID | Name          | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>Limit</b>  | uint16 | all        |         | 0        |        | 0           |
| 1  | <b>After</b>  | string | max 8192   |         | empty    |        | 0           |
| 2  | <b>Before</b> | string | max 8192   |         | empty    |        | 0           |

#### 6.6.5.11.1. Limit Field

This field SHALL indicate the maximum number of entries that should be retrieved from the program guide in a single response. It allows clients to specify the size of the paginated result set based on their needs.

#### 6.6.5.11.2. After Field

This field SHALL indicate the cursor that pinpoints the start of the upcoming data page. In a Cursor-based pagination system, the field acts as a reference point, ensuring the set of results corresponds directly to the data following the specified cursor. In a Offset-based pagination system, the field, along with limit, indicate the offset from which entries in the program guide will be retrieved.

#### 6.6.5.11.3. Before Field

This field SHALL indicate the cursor that pinpoints the end of the upcoming data page. In a Cursor-based pagination system, the field acts as a reference point, ensuring the set of results corresponds directly to the data preceding the specified cursor. In a Offset-based pagination system, the field, along with limit, indicate the offset from which entries in the program guide will be retrieved.

### 6.6.5.12. ChannelPagingStruct Type

This object defines the paging structure that includes the previous and next pagination tokens.

Page 558







| ID | Name                  | Type             | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------|------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Previous-Token</b> | PageToken-Struct |            | X       | null     |        | O           |
| 1  | <b>NextToken</b>      | PageToken-Struct |            | X       | null     |        | O           |

#### 6.6.5.12.1. PreviousToken Field

This field SHALL indicate the token to retrieve the preceding page. Absence of this field denotes the response as the initial page.

#### 6.6.5.12.2. NextToken Field

This field SHALL indicate the token to retrieve the next page. Absence of this field denotes the response as the last page.

### 6.6.6. Attributes

| ID     | Name                  | Type                    | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------|-------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Channel-List</b>   | list[ChannelInfoStruct] |            |         | empty    | RV     | CL          |
| 0x0001 | <b>Lineup</b>         | LineupInfoStruct        | desc       | X       | null     | RV     | LI          |
| 0x0002 | <b>CurrentChannel</b> | ChannelInfoStruct       | desc       | X       | null     | RV     | O           |

#### 6.6.6.1. ChannelList Attribute

This attribute SHALL provide the list of supported channels.

#### 6.6.6.2. Lineup Attribute

This attribute SHALL identify the channel lineup using external data sources.

#### 6.6.6.3. CurrentChannel Attribute

This attribute SHALL contain the current channel. When supported but a channel is not currently tuned to (if a content application is in foreground), the value of the field SHALL be null.

### 6.6.7. Commands



Page 559



| ID   | Name                         | Direction          | Response              | Access | Quality | Conformance |
|------|------------------------------|--------------------|-----------------------|--------|---------|-------------|
| 0x00 | <b>ChangeChannel</b>         | client ⇒<br>server | ChangeChannelResponse | O      |         | CL   LI     |
| 0x01 | <b>ChangeChannelResponse</b> | client ⇐<br>server | N                     |        |         | CL   LI     |
| 0x02 | <b>ChangeChannelByNumber</b> | client ⇒<br>server | Y                     | O      |         | M           |
| 0x03 | <b>SkipChannel</b>           | client ⇒<br>server | Y                     | O      |         | M           |
| 0x04 | <b>GetProgramGuide</b>       | client ⇒<br>server | ProgramGuideResponse  | O      |         | EG          |
| 0x05 | <b>ProgramGuideResponse</b>  | client ⇐<br>server | N                     |        |         | EG          |
| 0x06 | <b>RecordProgram</b>         | client ⇒<br>server | Y                     | O      |         | RP & EG     |
| 0x07 | <b>CancelRecordProgram</b>   | client ⇒<br>server | Y                     | O      |         | RP & EG     |

#### 6.6.7.1. ChangeChannel Command

Change the channel to the channel case-insensitive exact matching the value passed as an argument.

The match priority order SHALL be: Identifier, AffiliateCallSign, CallSign, Name, Number. In the match string, the Channel number should be presented in the **Major.Minor** format, such as **13.1**.

Upon receipt, this SHALL generate a ChangeChannelResponse command.

Upon success, the CurrentChannel attribute, if supported, SHALL be updated to reflect the change.

| ID | Name         | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------------|--------|------------|---------|----------|-------------|
| 0  | <b>Match</b> | string |            |         |          | M           |

##### 6.6.7.1.1. Match Field

This field SHALL contain a user-input string to match in order to identify the target channel.

Page 560







### 6.6.7.2. ChangeChannelResponse Command

This command SHALL be generated in response to a ChangeChannel command.

| ID | Name   | Type       | Constraint | Quality | Fallback | Conformance |
|----|--------|------------|------------|---------|----------|-------------|
| 0  | Status | StatusEnum | desc       |         |          | M           |
| 1  | Data   | string     | any        |         |          | O           |

#### 6.6.7.2.1. Status Field

This field SHALL indicate the status of the command which resulted in this response.

#### 6.6.7.2.2. Data Field

This field SHALL indicate Optional app-specific data.

### 6.6.7.3. ChangeChannelByNumber Command

Change the channel to the channel with the given Number in the *ChannelList* attribute.

| ID | Name        | Type   | Constraint | Quality | Fallback | Conformance |
|----|-------------|--------|------------|---------|----------|-------------|
| 0  | MajorNumber | uint16 | all        |         |          | M           |
| 1  | MinorNumber | uint16 | all        |         |          | M           |

#### 6.6.7.3.1. MajorNumber Field

This field SHALL indicate the channel major number value (ATSC format) to which the channel should change.

#### 6.6.7.3.2. MinorNumber Field

This field SHALL indicate the channel minor number value (ATSC format) to which the channel should change.

### 6.6.7.4. SkipChannel Command

This command provides channel up and channel down functionality, but allows channel index jumps of size *Count*.

Jumps are relative to the available list of channels. For example, when the current channel is 100.0 and the list of available channels is [100.0, 200.0, 201.0, 305.1], a SkipChannel command with jump value of 2 SHALL change the channel to 201.0.

When the value of the increase or decrease is larger than the number of channels remaining in the given direction, then the behavior SHALL be to return to the beginning (or end) of the channel list




Page 561



and continue. For example, if the current channel is at index 0 and count value of -1 is given, then the current channel should change to the last channel.

| ID | Name  | Type  | Constraint | Quality | Fallback | Conformance |
|----|-------|-------|------------|---------|----------|-------------|
| 0  | Count | int16 | all        |         |          | M           |

#### 6.6.7.4.1. Count Field

This field SHALL indicate the number of steps to increase (Count is positive) or decrease (Count is negative) the current channel.

#### 6.6.7.5. GetProgramGuide Command

This command retrieves the program guide. It accepts several filter parameters to return specific schedule and program information from a content app. The command shall receive in response a ProgramGuideResponse. Standard error codes SHALL be used when arguments provided are not valid. For example, if StartTime is greater than EndTime, the status code INVALID\_ACTION SHALL be returned.

| ID | Name           | Type                       | Constraint | Quality | Fallback | Conformance |
|----|----------------|----------------------------|------------|---------|----------|-------------|
| 0  | StartTime      | epoch-s                    |            |         |          | M           |
| 1  | EndTime        | epoch-s                    |            |         |          | M           |
| 2  | ChannelList    | list[ChannelInfoStruct]    | max 255    |         | empty    | O           |
| 3  | PageToken      | PageToken-Struct           |            | X       | null     | O           |
| 5  | RecordingFlag  | RecordingFlag-Bitmap       |            | X       | null     | O           |
| 6  | ExternalIDList | list[AdditionalInfoStruct] | max 255    |         | empty    | O           |
| 7  | Data           | octstr                     | max 8092   |         | MS       | O           |

##### 6.6.7.5.1. StartTime Field

This field SHALL indicate the beginning of the time window for which program guide entries are to be retrieved, as a UTC time. Entries with a start time on or after this value will be included in the results.

##### 6.6.7.5.2. EndTime Field

This field SHALL indicate the end of the time window for which program guide entries are to be retrieved, as a UTC time. Entries with an end time on or before this value will be included in the

Page 562







results. This field can represent a past or future value but SHALL be greater than the StartTime.

#### 6.6.7.5.3. ChannelList Field

This field SHALL indicate the set of channels for which program guide entries should be fetched. By providing a list of channels in this field, the response will only include entries corresponding to the specified channels.

#### 6.6.7.5.4. PageToken Field

This field SHALL indicate the pagination token used for managing pagination progression.

#### 6.6.7.5.5. RecordingFlag Field

This field SHALL indicate the flags of the programs for which entries should be fetched.

#### 6.6.7.5.6. ExternalIDList Field

This field SHALL indicate the list of additional external content identifiers.

#### 6.6.7.5.7. Data Field

This field SHALL indicate Optional app-specific data.

### 6.6.7.6. ProgramGuideResponse Command

This command is a response to the GetProgramGuide command.

| ID | Name                | Type                 | Constraint | Quality | Fallback | Conformance |
|----|---------------------|----------------------|------------|---------|----------|-------------|
| 0  | <b>Paging</b>       | ChannelPagingStruct  |            |         |          | M           |
| 1  | <b>Program-List</b> | list[Program-Struct] |            |         | empty    | M           |

#### 6.6.7.6.1. Paging Field

This field SHALL indicate the necessary pagination attributes that define information for both the succeeding and preceding data pages.

#### 6.6.7.6.2. ProgramList Field

This field SHALL indicate the list of programs.

### 6.6.7.7. RecordProgram Command

Record a specific program or series when it goes live. This functionality enables DVR recording features.



Page 563



| ID | Name                      | Type                                         | Constraint | Quality | Fallback | Conformance |
|----|---------------------------|----------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>ProgramIdentifier</b>  | string                                       | max 255    |         |          | M           |
| 1  | <b>ShouldRecordSeries</b> | bool                                         |            |         |          | M           |
| 2  | <b>ExternalIDList</b>     | list[ <a href="#">AdditionalInfoStruct</a> ] | max 255    |         | empty    | O           |
| 3  | <b>Data</b>               | octstr                                       | max 8092   |         | MS       | O           |

#### 6.6.7.7.1. ProgramIdentifier Field

This field SHALL indicate the program identifier for the program that should be recorded. This value is provided by the identifier field in [ProgramStruct](#).

#### 6.6.7.7.2. ShouldRecordSeries Field

This field SHALL indicate whether the whole series associated to the program should be recorded. For example, invoking record program on an episode with that flag set to true, the target should schedule record the whole series.

#### 6.6.7.7.3. ExternalIDList Field

This field, if present, SHALL indicate the list of additional external content identifiers.

#### 6.6.7.7.4. Data Field

This field, if present, SHALL indicate app-specific data.

### 6.6.7.8. CancelRecordProgram Command

Cancel recording for a specific program or series.

| ID | Name                      | Type                                         | Constraint | Quality | Fallback | Conformance |
|----|---------------------------|----------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>ProgramIdentifier</b>  | string                                       | max 255    |         |          | M           |
| 1  | <b>ShouldRecordSeries</b> | bool                                         |            |         |          | M           |
| 2  | <b>ExternalIDList</b>     | list[ <a href="#">AdditionalInfoStruct</a> ] | max 255    |         | empty    | O           |
| 3  | <b>Data</b>               | octstr                                       | max 8092   |         | MS       | O           |

Page 564







#### 6.6.7.8.1. ProgramIdentifier Field

This field SHALL indicate the program identifier for the program that should be cancelled from recording. This value is provided by the identifier field in [ProgramStruct](#).

#### 6.6.7.8.2. ShouldRecordSeries Field

This field SHALL indicate whether the whole series associated to the program should be cancelled from recording. For example, invoking record program on an episode with that flag set to true, the target should schedule record the whole series.

#### 6.6.7.8.3. ExternalIDList Field

This field, if present, SHALL indicate the list of additional external content identifiers.

#### 6.6.7.8.4. Data Field

This field, if present, SHALL indicate app-specific data.

### 6.7. Content Launcher Cluster

This cluster provides an interface for launching content on a Video Player device such as a Streaming Media Player, Smart TV or Smart Screen.

This cluster would be supported on a Video Player device or devices that can playback content, such as a Streaming Media Player, Smart TV or Smart Screen. This cluster supports playing back content referenced by URL. It supports finding content by type and global identifier, and either playing the content or displaying the search results.

The cluster server for Content Launcher is implemented by an endpoint that can launch content, such as a Video Player, or an endpoint representing a Content App on such a device.

When this cluster is implemented for a Content App Endpoint (Endpoint with type “Content App” and having an Application Basic cluster), the Video Player device SHALL launch the application when a client invokes the LaunchContent or LaunchURL commands.

#### 6.7.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                            |
|----------|------------------------------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                                       |
| 2        | Add Seasons, Episode, Any and CurrentContext to search, Added Text/Audio tracks support with PlaybackPreferences field |



Page 565



### 6.7.2. Classification

| Hierarchy | Role        | Scope    | PICS Code       |
|-----------|-------------|----------|-----------------|
| Base      | Application | Endpoint | CONTENTLAUNCHER |

### 6.7.3. Cluster ID

| ID     | Name             |
|--------|------------------|
| 0x050A | Content Launcher |

### 6.7.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature       | Summary                                                                                                                      |
|-----|------|---------------|------------------------------------------------------------------------------------------------------------------------------|
| 0   | CS   | ContentSearch | Device supports content search (non-app specific)                                                                            |
| 1   | UP   | URLPlayback   | Device supports basic URL-based file playback                                                                                |
| 2   | AS   | AdvancedSeek  | Enables clients to implement more advanced media seeking behavior in their user interface, such as for example a "seek bar". |
| 3   | TT   | TextTracks    | Device or app supports Text Tracks.                                                                                          |
| 4   | AT   | AudioTracks   | Device or app supports Audio Tracks.                                                                                         |

### 6.7.5. Data Types

#### 6.7.5.1. SupportedProtocolsBitmap Type

This data type is derived from map32.

| Bit | Name | Summary                                                     | Conformance |
|-----|------|-------------------------------------------------------------|-------------|
| 0   | DASH | Device supports Dynamic Adaptive Streaming over HTTP (DASH) | M           |

Page 566







| Bit | Name | Summary                                   | Conformance |
|-----|------|-------------------------------------------|-------------|
| 1   | HLS  | Device supports HTTP Live Streaming (HLS) | M           |

#### 6.7.5.2. StatusEnum Type

This data type is derived from enum8.

| Value | Name                          | Summary                                                      | Conformance |
|-------|-------------------------------|--------------------------------------------------------------|-------------|
| 0     | <b>Success</b>                | Command succeeded                                            | M           |
| 1     | <b>URLNotAvailable</b>        | Requested URL could not be reached by device.                | M           |
| 2     | <b>AuthFailed</b>             | Requested URL returned 401 error code.                       | M           |
| 3     | <b>TextTrackNotAvailable</b>  | Requested Text Track (in PlaybackPreferences) not available  | TT          |
| 4     | <b>AudioTrackNotAvailable</b> | Requested Audio Track (in PlaybackPreferences) not available | AT          |

#### 6.7.5.3. ParameterEnum Type

This data type is derived from enum8.

| Value | Name             | Summary                                                                                | Conformance |
|-------|------------------|----------------------------------------------------------------------------------------|-------------|
| 0     | <b>Actor</b>     | Actor represents an actor credited in video media content; for example, "Gaby Hoffman" | M           |
| 1     | <b>Channel</b>   | Channel represents the identifying data for a television channel; for example, "PBS"   | M           |
| 2     | <b>Character</b> | A character represented in video media content; for example, "Snow White"              | M           |
| 3     | <b>Director</b>  | A director of the video media content; for example, "Spike Lee"                        | M           |




Page 567



| Value | Name             | Summary                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Conformance |
|-------|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 4     | <b>Event</b>     | An event is a reference to a type of event; examples would include sports, music, or other types of events. For example, searching for "Football games" would search for a 'game' event entity and a 'football' sport entity.                                                                                                                                                                                                                                                                                            | M           |
| 5     | <b>Franchise</b> | A franchise is a video entity which can represent a number of video entities, like movies or TV shows. For example, take the fictional franchise "Intergalactic Wars" which represents a collection of movie trilogies, as well as animated and live action TV shows. This entity type was introduced to account for requests by customers such as "Find Intergalactic Wars movies", which would search for all 'Intergalactic Wars' programs of the MOVIE MediaType, rather than attempting to match to a single title. | M           |
| 6     | <b>Genre</b>     | Genre represents the genre of video media content such as action, drama or comedy.                                                                                                                                                                                                                                                                                                                                                                                                                                       | M           |
| 7     | <b>League</b>    | League represents the categorical information for a sporting league; for example, "NCAA"                                                                                                                                                                                                                                                                                                                                                                                                                                 | M           |

Page 568







| Value | Name              | Summary                                                                                                                                                            | Conformance |
|-------|-------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 8     | <b>Popularity</b> | Popularity indicates whether the user asks for popular content.                                                                                                    | M           |
| 9     | <b>Provider</b>   | The provider (MSP) the user wants this media to be played on; for example, "Netflix".                                                                              | M           |
| 10    | <b>Sport</b>      | Sport represents the categorical information of a sport; for example, football                                                                                     | M           |
| 11    | <b>SportsTeam</b> | SportsTeam represents the categorical information of a professional sports team; for example, "University of Washington Huskies"                                   | M           |
| 12    | <b>Type</b>       | The type of content requested. Supported types are "Movie", "MovieSeries", "TVSeries", "TVSeason", "TVEpisode", "Trailer", "SportsEvent", "LiveEvent", and "Video" | M           |
| 13    | <b>Video</b>      | Video represents the identifying data for a specific piece of video content; for example, "Manchester by the Sea".                                                 | M           |
| 14    | <b>Season</b>     | Season represents the specific season number within a TV series.                                                                                                   | O           |
| 15    | <b>Episode</b>    | Episode represents a specific episode number within a Season in a TV series.                                                                                       | O           |



Page 569



| Value | Name | Summary                                                                                                | Conformance |
|-------|------|--------------------------------------------------------------------------------------------------------|-------------|
| 16    | Any  | Represents a search text input across many parameter types or even outside of the defined param types. | O           |

#### 6.7.5.4. MetricTypeEnum Type

This data type is derived from enum8.

| Value | Name       | Summary                                  | Conformance |
|-------|------------|------------------------------------------|-------------|
| 0     | Pixels     | Dimensions defined in a number of Pixels | M           |
| 1     | Percentage | Dimensions defined as a percentage       | M           |

##### 6.7.5.4.1. Pixels Value

This value is used for dimensions defined in a number of Pixels.

##### 6.7.5.4.2. Percentage Value

This value is for dimensions defined as a percentage of the overall display dimensions. For example, if using a Percentage Metric type for a Width measurement of 50.0, against a display width of 1920 pixels, then the resulting value used would be 960 pixels (50.0% of 1920) for that dimension. Whenever a measurement uses this Metric type, the resulting values SHALL be rounded ("floored") towards 0 if the measurement requires an integer final value.

#### 6.7.5.5. AdditionalInfoStruct Type

This object defines additional name=value pairs that can be used for identifying content.

| ID | Name  | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------|--------|------------|---------|----------|--------|-------------|
| 0  | Name  | string | max 256    |         |          |        | M           |
| 1  | Value | string | max 8192   |         |          |        | M           |

##### 6.7.5.5.1. Name Field

This field SHALL indicate the name of external id, ex. "musicbrainz".

##### 6.7.5.5.2. Value Field

This field SHALL indicate the value for external id, ex. "ST000000066661".

Page 570



### 6.7.5.6. ParameterStruct Type

This object defines inputs to a search for content for display or playback.

| ID | Name           | Type                       | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------|----------------------------|------------|---------|----------|--------|-------------|
| 0  | Type           | ParameterEnum              | all        |         |          |        | M           |
| 1  | Value          | string                     | max 1024   |         |          |        | M           |
| 2  | ExternalIDList | list[AdditionalInfoStruct] | all        |         | empty    |        | O           |

#### 6.7.5.6.1. Type Field

This field SHALL indicate the entity type.

#### 6.7.5.6.2. Value Field

This field SHALL indicate the entity value, which is a search string, ex. “Manchester by the Sea”.

#### 6.7.5.6.3. ExternalIDList Field

This field SHALL indicate the list of additional external content identifiers.

### 6.7.5.7. ContentSearchStruct Type

This object defines inputs to a search for content for display or playback.

| ID | Name          | Type                  | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------|-----------------------|------------|---------|----------|--------|-------------|
| 0  | ParameterList | list[ParameterStruct] | all        |         | 0        |        | M           |

#### 6.7.5.7.1. ParameterList Field

This field SHALL indicate the list of parameters comprising the search. If multiple parameters are provided, the search parameters SHALL be joined with 'AND' logic. e.g. action movies with Tom Cruise will be represented as [{Actor: 'Tom Cruise'}, {Type: 'Movie'}, {Genre: 'Action'}]

### 6.7.5.8. DimensionStruct Type

This object defines dimension which can be used for defining Size of background images.

| ID | Name  | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------|--------|------------|---------|----------|--------|-------------|
| 0  | Width | double |            |         | MS       |        | M           |




Page 571



| ID | Name   | Type            | Constraint | Quality | Fallback | Access | Conformance |
|----|--------|-----------------|------------|---------|----------|--------|-------------|
| 1  | Height | double          |            |         | MS       |        | M           |
| 2  | Metric | Metric-TypeEnum |            |         |          |        | M           |

#### 6.7.5.8.1. Width Field

This field SHALL indicate the width using the metric defined in Metric

#### 6.7.5.8.2. Height Field

This field SHALL indicate the height using the metric defined in Metric

#### 6.7.5.8.3. Metric Field

This field SHALL indicate metric used for defining Height/Width.

### 6.7.5.9. StyleInformationStruct Type

This object defines style information which can be used by content providers to change the Media Player's style related properties.

| ID | Name     | Type            | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|-----------------|------------|---------|----------|--------|-------------|
| 0  | ImageURL | string          | max 8192   |         | MS       |        | O           |
| 1  | Color    | string          | 7, 9       |         | MS       |        | O           |
| 2  | Size     | DimensionStruct |            |         | MS       |        | O           |

#### 6.7.5.9.1. ImageURL Field

This field SHALL indicate the URL of image used for Styling different Video Player sections like Logo, Watermark etc. The syntax of this field SHALL follow the syntax as specified in [RFC 1738](#) and SHALL use the [https](#) scheme.

#### 6.7.5.9.2. Color Field

This field SHALL indicate the color, in RGB or RGBA, used for styling different Video Player sections like Logo, Watermark, etc. The value SHALL conform to the 6-digit or 8-digit format defined for [CSS sRGB hexadecimal color notation](#) [<https://www.w3.org/TR/css-color-4/#hex-notation>]. Examples:

- #76DE19 for R=0x76, G=0xDE, B=0x19, A absent
- #76DE1980 for R=0x76, G=0xDE, B=0x19, A=0x80

#### 6.7.5.9.3. Size Field

This field SHALL indicate the size of the image used for Styling different Video Player sections like

Page 572



Logo, Watermark etc.

#### 6.7.5.10. BrandingInformationStruct Type

This object defines Branding Information which can be provided by the client in order to customize the skin of the Video Player during playback.

| ID | Name                 | Type                    | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------|-------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Provider-Name</b> | string                  | max 256    |         |          |        | M           |
| 1  | <b>Background</b>    | StyleInformation-Struct |            |         | MS       |        | O           |
| 2  | <b>Logo</b>          | StyleInformation-Struct |            |         | MS       |        | O           |
| 3  | <b>Progress-Bar</b>  | StyleInformation-Struct |            |         | MS       |        | O           |
| 4  | <b>Splash</b>        | StyleInformation-Struct |            |         | MS       |        | O           |
| 5  | <b>Water-Mark</b>    | StyleInformation-Struct |            |         | MS       |        | O           |

##### 6.7.5.10.1. ProviderName Field

This field SHALL indicate name of the provider for the given content.

##### 6.7.5.10.2. Background Field

This field SHALL indicate background of the Video Player while content launch request is being processed by it. This background information MAY also be used by the Video Player when it is in idle state.

##### 6.7.5.10.3. Logo Field

This field SHALL indicate the logo shown when the Video Player is launching. This is also used when the Video Player is in the idle state and Splash field is not available.

##### 6.7.5.10.4. ProgressBar Field

This field SHALL indicate the style of progress bar for media playback.




Page 573



#### 6.7.5.10.5. Splash Field

This field SHALL indicate the screen shown when the Video Player is in an idle state. If this property is not populated, the Video Player SHALL default to logo or the provider name.

#### 6.7.5.10.6. Watermark Field

This field SHALL indicate watermark shown when the media is playing.

#### 6.7.5.11. PlaybackPreferencesStruct Type

PlaybackPreferencesStruct defines the preferences sent by the client to the receiver in the Content-Launcher LaunchURL or LaunchContent commands.

| ID | Name                    | Type                        | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------------|-----------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>PlaybackPosition</b> | uint64                      |            | X       |          |        | AS          |
| 1  | <b>TextTrack</b>        | TrackPreferenceStruct       |            | X       |          |        | TT          |
| 2  | <b>AudioTracks</b>      | list[TrackPreferenceStruct] |            | X       |          |        | AT          |

##### 6.7.5.11.1. PlaybackPosition Field

This field SHALL indicate the preferred position (in milliseconds) in the media to launch playback from. In case the position falls in the middle of a frame, the server SHALL set the position to the beginning of that frame and set the **SampledPosition** attribute on the MediaPlayback cluster accordingly. A value of null SHALL indicate that playback position is not applicable for the current state of the media playback. (For example : Live media with no known duration and where seek is not supported).

##### 6.7.5.11.2. TextTrack Field

This field SHALL indicate the user's preferred Text Track. A value of null SHALL indicate that the user did not specify a preferred Text Track on the client. In such a case, the decision to display and select a Text Track is up to the server.

##### 6.7.5.11.3. AudioTracks Field

This field SHALL indicate the list of the user's preferred Audio Tracks. If the list contains multiple values, each AudioTrack must also specify a unique audioOutputIndex to play the track on. A value of null SHALL indicate that the user did not specify a preferred Audio Track on the client. In such a case, the decision to play and select an Audio Track is up to the server.

Page 574



### 6.7.5.12. TrackPreferenceStruct Type

This structure defines Text/Audio Track preferences.

| ID | Name             | Type                     | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------|--------------------------|------------|---------|----------|--------|-------------|
| 0  | LanguageCode     | string                   | max 32     |         |          |        | M           |
| 1  | Characteristics  | list[CharacteristicEnum] |            | X       | null     |        | O           |
| 2  | AudioOutputIndex | uint8                    |            | X       |          |        | AT          |

#### 6.7.5.12.1. LanguageCode Field

This field SHALL contain one of the standard Tags for Identifying Languages [RFC 5646](#), which identifies the primary language used in the Track.

#### 6.7.5.12.2. Characteristics Field

This field SHALL contain a list of enumerated CharacteristicEnum values that indicate a purpose, trait or feature associated with the Track. A value of null SHALL indicate that there are no Characteristics corresponding to the Track.

#### 6.7.5.12.3. AudioOutputIndex Field

This field if present SHALL indicate the index of the OutputInfoStruct from the OutputList attribute (from the AudioOutput cluster) and indicates which audio output the Audio Track should be played on.

This field SHALL NOT be present if the track is not an audio track.

If the track is an audio track, this field SHALL be present. A value of null SHALL indicate that the server can choose the audio output(s) to play the Audio Track on.

## 6.7.6. Attributes

| ID     | Name                              | Type                       | Constraint        | Quality | Fallback | Access | Conformance |
|--------|-----------------------------------|----------------------------|-------------------|---------|----------|--------|-------------|
| 0x0000 | Accept-Header                     | list[string]               | max 100[max 1024] | N       | empty    | R V    | UP          |
| 0x0001 | SupportedStreamingProtocolsBitmap | Supported-Protocols-Bitmap |                   | N       | 0        | R V    | UP          |




Page 575



#### 6.7.6.1. AcceptHeader Attribute

This attribute SHALL provide a list of content types supported by the Video Player or Content App in the form of entries in the HTTP "Accept" request header.

#### 6.7.6.2. SupportedStreamingProtocols Attribute

This attribute SHALL provide information about supported streaming protocols.

### 6.7.7. Commands

| ID   | Name                    | Direction                   | Response         | Access | Conformance |
|------|-------------------------|-----------------------------|------------------|--------|-------------|
| 0x00 | <b>LaunchContent</b>    | client $\Rightarrow$ server | LauncherResponse | O      | CS          |
| 0x01 | <b>LaunchURL</b>        | client $\Rightarrow$ server | LauncherResponse | O      | UP          |
| 0x02 | <b>LauncherResponse</b> | client $\Leftarrow$ server  | N                |        | CS   UP     |

#### 6.7.7.1. LaunchContent Command

Upon receipt, this SHALL launch the specified content with optional search criteria.

This command returns a Launch Response.

| ID | Name                       | Type                      | Constraint | Quality | Fallback | Conformance |
|----|----------------------------|---------------------------|------------|---------|----------|-------------|
| 0  | <b>Search</b>              | ContentSearchStruct       | desc       |         |          | M           |
| 1  | <b>AutoPlay</b>            | bool                      | desc       |         |          | M           |
| 2  | <b>Data</b>                | string                    |            |         | MS       | O           |
| 3  | <b>PlaybackPreferences</b> | PlaybackPreferencesStruct | all        |         | MS       | O           |
| 4  | <b>UseCurrentContext</b>   | bool                      | desc       |         | TRUE     | O           |

##### 6.7.7.1.1. Search Field

This field SHALL indicate the content to launch.

##### 6.7.7.1.2. AutoPlay Field

This field SHALL indicate whether to automatically start playing content, where:

- TRUE means best match should start playing automatically.

Page 576



- FALSE means matches should be displayed on screen for user selection.

#### 6.7.7.1.3. Data Field

This field, if present, SHALL indicate app-specific data.

#### 6.7.7.1.4. PlaybackPreferences Field

This field, if present, SHALL indicate the user's preferred Text/AudioTracks and playbackPosition for the media, sent from the client to the server. If the server does not find an available track for the title being played exactly matching a Track requested here, in the list of available tracks, it may default to picking another track that closely matches the requested track. Alternately, it may go with user preferences set on the server side (it will use this option if these PlaybackPreferences are not specified). In the case of text tracks, that may mean that the subtitle text is not displayed at all. In the cases where the preferred Text/AudioTracks are not available, the server SHALL return the TextTrackNotAvailable and/or AudioTrackNotAvailable Status(es) in the LauncherResponse.

#### 6.7.7.1.5. UseCurrentContext Field

This field, if present, SHALL indicate whether to consider the context of current ongoing activity on the receiver to fulfill the request. For example if the request only includes data in ContentSearch that specifies an Episode number, and UseCurrentContent is set to TRUE, if there is a TV series on going, the request refers to the specific episode of the ongoing season of the TV series. TRUE means current activity context MAY be considered FALSE means current activity context SHALL NOT be considered

### 6.7.7.2. LaunchURL Command

Upon receipt, this SHALL launch content from the specified URL.

The content types supported include those identified in the AcceptHeader and SupportedStreaming-Protocols attributes.

A check SHALL be made to ensure the URL is secure (uses HTTPS).

When playing a video stream in response to this command, an indication (ex. visual) of the identity of the origin node of the video stream SHALL be provided. This could be in the form of a friendly name label which uniquely identifies the node to the user. This friendly name label is typically assigned by the Matter Admin (ex. TV) at the time of commissioning and, when it's a device, is often editable by the user. It might be a combination of a company name and friendly name, for example, "Acme" or "Acme Streaming Service on Alice's Phone".

This command returns a Launch Response.

| ID | Name          | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------------|--------|------------|---------|----------|-------------|
| 0  | ContentURL    | string | any        |         |          | M           |
| 1  | DisplayString | string | any        |         | MS       | O           |




Page 577



| ID | Name                       | Type                      | Constraint | Quality | Fallback | Conformance |
|----|----------------------------|---------------------------|------------|---------|----------|-------------|
| 2  | <b>BrandingInformation</b> | BrandingInformationStruct | any        |         | MS       | O           |
| 3  | <b>PlaybackPreferences</b> | PlaybackPreferencesStruct | any        |         | MS       | O           |

#### 6.7.7.2.1. ContentURL Field

This field SHALL indicate the URL of content to launch. The syntax of this field SHALL follow the syntax as specified in [RFC 1738](#) and SHALL use the [https](#) scheme.

#### 6.7.7.2.2. DisplayString Field

This field, if present, SHALL provide a string that MAY be used to describe the content being accessed at the given URL.

#### 6.7.7.2.3. BrandingInformation Field

This field, if present, SHALL indicate the branding information that MAY be displayed when playing back the given content.

#### 6.7.7.2.4. PlaybackPreferences Field

This field, if present, SHALL indicate the user's preferred Text/AudioTracks and playbackPosition for the media, sent from the client to the server. If the server does not find an available track for the title being played exactly matching a Track requested here, in the list of available tracks, it may default to picking another track that closely matches the requested track. Alternately, it may go with user preferences set on the server side (it will use this option if these PlaybackPreferences are not specified). In the case of text tracks, that may mean that the subtitle text is not displayed at all. In the cases where the preferred Text/AudioTracks are not available, the server SHALL return the TextTrackNotAvailable and/or AudioTrackNotAvailable Status(es) in the LauncherResponse.

### 6.7.7.3. LauncherResponse Command

This command SHALL be generated in response to LaunchContent and LaunchURL commands.

| ID | Name          | Type       | Constraint | Quality | Fallback | Conformance |
|----|---------------|------------|------------|---------|----------|-------------|
| 0  | <b>Status</b> | StatusEnum | all        |         |          | M           |
| 1  | <b>Data</b>   | string     |            |         | MS       | O           |

#### 6.7.7.3.1. Status Field

This field SHALL indicate the status of the command which resulted in this response.

Page 578



#### 6.7.7.3.2. Data Field

This field SHALL indicate Optional app-specific data.

## 6.8. Keypad Input Cluster

This cluster provides an interface for key code based input and control on a device like a Video Player or an endpoint like a Content App. This may include text or action commands such as UP, DOWN, and SELECT.

This cluster would be supported on Video Player devices as well as devices that support remote control input from a keypad or remote. This cluster provides the list of supported keypad inputs and provides a command for sending them.

The cluster server for Keypad Input is implemented by a device that can receive keypad input, such as a Video Player, or an endpoint that can receive keypad input, such as a Content App.

The key codes used are those defined in the HDMI CEC specification (see [HDMI](#)).

Devices MAY understand a subset of these key codes. Feature flags are used to indicate a specific subset that is supported. Device MAY support additional codes beyond what is indicated in feature flags.

### 6.8.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 6.8.2. Classification

| Hierarchy | Role        | Scope    | PICS Code   |
|-----------|-------------|----------|-------------|
| Base      | Application | Endpoint | KEYPADINPUT |

### 6.8.3. Cluster ID

| ID     | Name         |
|--------|--------------|
| 0x0509 | Keypad Input |

### 6.8.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.




Page 579



| Bit | Code | Feature            | Summary                                                  |
|-----|------|--------------------|----------------------------------------------------------|
| 0   | NV   | NavigationKeyCodes | Supports UP, DOWN, LEFT, RIGHT, SELECT, BACK, EXIT, MENU |
| 1   | LK   | LocationKeys       | Supports CEC keys 0x0A (Settings) and 0x09 (Home)        |
| 2   | NK   | NumberKeys         | Supports numeric input 0..9                              |

## 6.8.5. Data Types

### 6.8.5.1. StatusEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                                                        | Conformance |
|-------|--------------------------|--------------------------------------------------------------------------------|-------------|
| 0     | Success                  | Succeeded                                                                      | M           |
| 1     | UnsupportedKey           | Key code is not supported.                                                     | M           |
| 2     | InvalidKeyInCurrentState | Requested key code is invalid in the context of the responder's current state. | M           |

### 6.8.5.2. CecKeyCodeEnum Type

This data type is derived from enum8.

| Value | Name      | Conformance |
|-------|-----------|-------------|
| 0x00  | Select    | M           |
| 0x01  | Up        | M           |
| 0x02  | Down      | M           |
| 0x03  | Left      | M           |
| 0x04  | Right     | M           |
| 0x05  | RightUp   | M           |
| 0x06  | RightDown | M           |
| 0x07  | LeftUp    | M           |
| 0x08  | LeftDown  | M           |
| 0x09  | RootMenu  | M           |
| 0x0A  | SetupMenu | M           |

Page 580



| Value | Name                      | Conformance |
|-------|---------------------------|-------------|
| 0x0B  | ContentsMenu              | M           |
| 0x0C  | FavoriteMenu              | M           |
| 0x0D  | Exit                      | M           |
| 0x10  | MediaTopMenu              | M           |
| 0x11  | MediaContextSensitiveMenu | M           |
| 0x1D  | NumberEntryMode           | M           |
| 0x1E  | Number11                  | M           |
| 0x1F  | Number12                  | M           |
| 0x20  | Number00rNumber10         | M           |
| 0x21  | Numbers1                  | M           |
| 0x22  | Numbers2                  | M           |
| 0x23  | Numbers3                  | M           |
| 0x24  | Numbers4                  | M           |
| 0x25  | Numbers5                  | M           |
| 0x26  | Numbers6                  | M           |
| 0x27  | Numbers7                  | M           |
| 0x28  | Numbers8                  | M           |
| 0x29  | Numbers9                  | M           |
| 0x2A  | Dot                       | M           |
| 0x2B  | Enter                     | M           |
| 0x2C  | Clear                     | M           |
| 0x2F  | NextFavorite              | M           |
| 0x30  | ChannelUp                 | M           |
| 0x31  | ChannelDown               | M           |
| 0x32  | PreviousChannel           | M           |
| 0x33  | SoundSelect               | M           |
| 0x34  | InputSelect               | M           |
| 0x35  | DisplayInformation        | M           |
| 0x36  | Help                      | M           |
| 0x37  | PageUp                    | M           |
| 0x38  | PageDown                  | M           |
| 0x40  | Power                     | M           |
| 0x41  | VolumeUp                  | M           |



Page 581



| Value | Name                     | Conformance |
|-------|--------------------------|-------------|
| 0x42  | VolumeDown               | M           |
| 0x43  | Mute                     | M           |
| 0x44  | Play                     | M           |
| 0x45  | Stop                     | M           |
| 0x46  | Pause                    | M           |
| 0x47  | Record                   | M           |
| 0x48  | Rewind                   | M           |
| 0x49  | FastForward              | M           |
| 0x4A  | Eject                    | M           |
| 0x4B  | Forward                  | M           |
| 0x4C  | Backward                 | M           |
| 0x4D  | StopRecord               | M           |
| 0x4E  | PauseRecord              | M           |
| 0x4F  | Reserved                 | M           |
| 0x50  | Angle                    | M           |
| 0x51  | SubPicture               | M           |
| 0x52  | VideoOnDemand            | M           |
| 0x53  | ElectronicProgramGuide   | M           |
| 0x54  | TimerProgramming         | M           |
| 0x55  | InitialConfiguration     | M           |
| 0x56  | SelectBroadcastType      | M           |
| 0x57  | SelectSoundPresentation  | M           |
| 0x60  | PlayFunction             | M           |
| 0x61  | PausePlayFunction        | M           |
| 0x62  | RecordFunction           | M           |
| 0x63  | PauseRecordFunction      | M           |
| 0x64  | StopFunction             | M           |
| 0x65  | MuteFunction             | M           |
| 0x66  | RestoreVolumeFunction    | M           |
| 0x67  | TuneFunction             | M           |
| 0x68  | SelectMediaFunction      | M           |
| 0x69  | SelectAvInputFunction    | M           |
| 0x6A  | SelectAudioInputFunction | M           |

Page 582



| Value | Name                | Conformance |
|-------|---------------------|-------------|
| 0x6B  | PowerToggleFunction | M           |
| 0x6C  | PowerOffFunction    | M           |
| 0x6D  | PowerOnFunction     | M           |
| 0x71  | F1Blue              | M           |
| 0x72  | F2Red               | M           |
| 0x73  | F3Green             | M           |
| 0x74  | F4Yellow            | M           |
| 0x75  | F5                  | M           |
| 0x76  | Data                | M           |

## 6.8.6. Commands

| ID   | Name            | Direction                   | Response        | Access | Conformance |
|------|-----------------|-----------------------------|-----------------|--------|-------------|
| 0x00 | SendKey         | client $\Rightarrow$ server | SendKeyResponse | O      | M           |
| 0x01 | SendKeyResponse | client $\Leftarrow$ server  | N               |        | M           |

### 6.8.6.1. SendKey Command

Upon receipt, this SHALL process a keycode as input to the media endpoint.

If a device has multiple media endpoints implementing this cluster, such as a casting video player endpoint with one or more content app endpoints, then only the endpoint receiving the command SHALL process the keycode as input. In other words, a specific content app endpoint SHALL NOT process a keycode received by a different content app endpoint.

If a second SendKey request with the same KeyCode value is received within 200 ms, then the endpoint will consider the first key press to be a press and hold. When such a repeat KeyCode value is not received within 200 ms, then the endpoint will consider the last key press to be a release.

| ID | Name    | Type           | Constraint | Quality | Fallback | Conformance |
|----|---------|----------------|------------|---------|----------|-------------|
| 0  | KeyCode | CecKeyCodeEnum | all        |         |          | M           |

#### 6.8.6.1.1. KeyCode Field

This field SHALL indicate the key code to process.

### 6.8.6.2. SendKeyResponse Command

This command SHALL be generated in response to a SendKey command. The data for this com-



Page 583



mand SHALL be as follows:

| ID | Name   | Type       | Constraint | Quality | Fallback | Conformance |
|----|--------|------------|------------|---------|----------|-------------|
| 0  | Status | StatusEnum | all        |         |          | M           |

#### 6.8.6.2.1. Status Field

This field SHALL indicate the status of the request.

## 6.9. Media Input Cluster

This cluster provides an interface for controlling the Input Selector on a media device such as a Video Player.

This cluster would be implemented on TV and other media streaming devices, as well as devices that provide input to or output from such devices.

This cluster provides the list of available inputs and provides commands for selecting and renaming them.

The cluster server for Media Input is implemented by a device that has selectable input, such as a Video Player device.

### 6.9.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 6.9.2. Classification

| Hierarchy | Role        | Scope    | PICS Code  |
|-----------|-------------|----------|------------|
| Base      | Application | Endpoint | MEDIAINPUT |

### 6.9.3. Cluster ID

| ID     | Name        |
|--------|-------------|
| 0x0507 | Media Input |

### 6.9.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

Page 584



| Bit | Code | Feature     | Summary                             |
|-----|------|-------------|-------------------------------------|
| 0   | NU   | NameUpdates | Supports updates to the input names |

## 6.9.5. Data Types

### 6.9.5.1. InputTypeEnum Type

This data type is derived from enum8.

| Value | Name             | Summary                                             | Conformance |
|-------|------------------|-----------------------------------------------------|-------------|
| 0     | <b>Internal</b>  | Indicates content not coming from a physical input. | M           |
| 1     | <b>Aux</b>       |                                                     | M           |
| 2     | <b>Coax</b>      |                                                     | M           |
| 3     | <b>Composite</b> |                                                     | M           |
| 4     | <b>HDMI</b>      |                                                     | M           |
| 5     | <b>Input</b>     |                                                     | M           |
| 6     | <b>Line</b>      |                                                     | M           |
| 7     | <b>Optical</b>   |                                                     | M           |
| 8     | <b>Video</b>     |                                                     | M           |
| 9     | <b>SCART</b>     |                                                     | M           |
| 10    | <b>USB</b>       |                                                     | M           |
| 11    | <b>Other</b>     |                                                     | M           |

### 6.9.5.2. InputInfoStruct Type

This contains information about an input.

| ID | Name               | Type          | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------|---------------|------------|---------|----------|--------|-------------|
| 0  | <b>Index</b>       | uint8         | all        |         |          |        | M           |
| 1  | <b>InputType</b>   | InputTypeEnum | desc       |         |          |        | M           |
| 2  | <b>Name</b>        | string        |            |         |          |        | M           |
| 3  | <b>Description</b> | string        |            |         |          |        | M           |




Page 585



#### 6.9.5.2.1. Index Field

This field SHALL indicate the unique index into the list of Inputs.

#### 6.9.5.2.2. InputType Field

This field SHALL indicate the type of input

#### 6.9.5.2.3. Name Field

This field SHALL indicate the input name, such as “HDMI 1”. This field may be blank, but SHOULD be provided when known.

#### 6.9.5.2.4. Description Field

This field SHALL indicate the user editable input description, such as “Living room Playstation”. This field may be blank, but SHOULD be provided when known.

### 6.9.6. Attributes

| ID     | Name                | Type                                    | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------------|-----------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>InputList</b>    | list[ <a href="#">InputInfoStruct</a> ] |            |         |          | R V    | M           |
| 0x0001 | <b>CurrentInput</b> | uint8                                   | all        |         |          | R V    | M           |

#### 6.9.6.1. InputList Attribute

This attribute SHALL provide a list of the media inputs supported by the device.

#### 6.9.6.2. CurrentInput Attribute

This attribute SHALL contain the value of the index field of the currently selected [InputInfoStruct](#).

### 6.9.7. Commands

| ID   | Name                   | Direction                   | Response | Access | Conformance |
|------|------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>SelectInput</b>     | client $\Rightarrow$ server | Y        | O      | M           |
| 0x01 | <b>ShowInputStatus</b> | client $\Rightarrow$ server | Y        | O      | M           |
| 0x02 | <b>HideInputStatus</b> | client $\Rightarrow$ server | Y        | O      | M           |
| 0x03 | <b>RenameInput</b>     | client $\Rightarrow$ server | Y        | M      | NU          |

#### 6.9.7.1. SelectInput Command

Upon receipt, this command SHALL change the media input on the device to the input at a specific

Page 586







index in the Input List.

| ID | Name  | Type  | Constraint | Quality | Fallback | Conformance |
|----|-------|-------|------------|---------|----------|-------------|
| 0  | Index | uint8 | all        |         |          | M           |

#### 6.9.7.1.1. Index Field

This field SHALL indicate the index field of the [InputInfoStruct](#) from the InputList attribute in which to change to.

#### 6.9.7.2. ShowInputStatus Command

Upon receipt, this command SHALL display the active status of the input list on screen.

#### 6.9.7.3. HideInputStatus Command

Upon receipt, this command SHALL hide the input list from the screen.

#### 6.9.7.4. RenameInput Command

Upon receipt, this command SHALL rename the input at a specific index in the Input List.

Updates to the input name SHALL appear in the device's settings menus.

| ID | Name  | Type   | Constraint | Quality | Fallback | Conformance |
|----|-------|--------|------------|---------|----------|-------------|
| 0  | Index | uint8  | all        |         |          | M           |
| 1  | Name  | string | all        |         |          | M           |

## 6.10. Media Playback Cluster

This cluster provides an interface for controlling Media Playback (PLAY, PAUSE, etc) on a media device such as a TV, Set-top Box, or Smart Speaker.

This cluster server would be supported on Video Player devices or endpoints that provide media playback, such as a Content App. This cluster provides an interface for controlling Media Playback.

### 6.10.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                             |
|----------|-----------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                        |
| 2        | Added Text/Audio tracks support, Audio-while-advancing (AA) feature, StateChanged event |




Page 587



### 6.10.2. Classification

| Hierarchy | Role        | Scope    | PICS Code     |
|-----------|-------------|----------|---------------|
| Base      | Application | Endpoint | MEDIAPLAYBACK |

### 6.10.3. Cluster ID

| ID     | Name           |
|--------|----------------|
| 0x0506 | Media Playback |

### 6.10.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature       | Summary                                             |
|-----|------|---------------|-----------------------------------------------------|
| 0   | AS   | AdvancedSeek  | Advanced media seeking                              |
| 1   | VS   | VariableSpeed | Variable speed playback                             |
| 2   | TT   | TextTracks    | Text Tracks                                         |
| 3   | AT   | AudioTracks   | Audio Tracks                                        |
| 4   | AA   | AudioAdvance  | Can play audio during fast and slow playback speeds |

#### 6.10.4.1. AdvancedSeek Feature

This feature provides access to the time offset location within current playback media and allows for jumping to a specific location using time offsets. This enables clients to implement more advanced media seeking behavior in their user interface, for instance a "seek bar".

#### 6.10.4.2. VariableSpeed Feature

This feature is for a device which supports variable speed playback on media that supports it.

#### 6.10.4.3. TextTracks Feature

This feature is for a device or app that supports Text Tracks.

#### 6.10.4.4. AudioTracks Feature

This feature is for a device or app that supports Audio Tracks.

#### 6.10.4.5. AudioAdvance Feature

This feature is for a device or app that supports playing audio during fast and slow advance and

Page 588



rewind (e.g., while playback speed is not 1). A device that supports this feature MAY only support playing audio during certain speeds.

A cluster implementing AA SHALL implement AS.

## 6.10.5. Data Types

### 6.10.5.1. PlaybackStateEnum Type

This data type is derived from enum8.

| Value | Name              | Summary                                                                              | Conformance |
|-------|-------------------|--------------------------------------------------------------------------------------|-------------|
| 0     | <b>Playing</b>    | Media is currently playing (includes FF and REW)                                     | M           |
| 1     | <b>Paused</b>     | Media is currently paused                                                            | M           |
| 2     | <b>NotPlaying</b> | Media is not currently playing                                                       | M           |
| 3     | <b>Buffering</b>  | Media is not currently buffering and playback will start when buffer has been filled | M           |

### 6.10.5.2. StatusEnum Type

Status Data Type is derived from enum8.

| Value | Name                          | Summary                                                                                                                                                       | Conformance |
|-------|-------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>Success</b>                | Succeeded                                                                                                                                                     | M           |
| 1     | <b>InvalidStateForCommand</b> | Requested playback command is invalid in the current playback state.                                                                                          | M           |
| 2     | <b>NotAllowed</b>             | Requested playback command is not allowed in the current playback state. For example, attempting to fast-forward during a commercial might return NotAllowed. | M           |
| 3     | <b>NotActive</b>              | This endpoint is not active for playback.                                                                                                                     | M           |




Page 589



| Value | Name                   | Summary                                                                                                                                                      | Conformance |
|-------|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 4     | <b>SpeedOutOfRange</b> | The FastForward or Rewind Command was issued but the media is already playing back at the fastest speed supported by the server in the respective direction. | VS          |
| 5     | <b>SeekOutOfRange</b>  | The Seek Command was issued with a value of position outside of the allowed seek range of the media.                                                         | AS          |

### 6.10.5.3. CharacteristicEnum Type

This data type is derived from enum8.

| Value | Name                   | Summary                                                                                                                                                                                                                                        | Conformance |
|-------|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>ForcedSubtitles</b> | Textual information meant for display when no other text representation is selected. It is used to clarify dialogue, alternate languages, texted graphics or location/person IDs that are not otherwise covered in the dubbed/localized audio. | M           |
| 1     | <b>DescribesVideo</b>  | Textual or audio media component containing a textual description (intended for audio synthesis) or an audio description describing a visual component                                                                                         | M           |
| 2     | <b>EasyToRead</b>      | Simplified or reduced captions as specified in [United States Code Title 47 CFR 79.103(c)(9)].                                                                                                                                                 | M           |

Page 590







| Value | Name                        | Summary                                                                                                                                                  | Conformance |
|-------|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 3     | <b>FrameBased</b>           | A media characteristic that indicates that a track selection option includes frame-based content.                                                        | M           |
| 4     | <b>MainProgram</b>          | Main media component(s) which is/are intended for presentation if no other information is provided                                                       | M           |
| 5     | <b>OriginalContent</b>      | A media characteristic that indicates that a track or media selection option contains original content.                                                  | M           |
| 6     | <b>VoiceOverTranslation</b> | A media characteristic that indicates that a track or media selection option contains a language translation and verbal interpretation of spoken dialog. | M           |
| 7     | <b>Caption</b>              | Textual media component containing transcriptions of spoken dialog and auditory cues such as sound effects and music for the hearing impaired.           | M           |
| 8     | <b>Subtitle</b>             | Textual transcriptions of spoken dialog.                                                                                                                 | M           |
| 9     | <b>Alternate</b>            | Textual media component containing transcriptions of spoken dialog and auditory cues such as sound effects and music for the hearing impaired.           | M           |



Page 591



| Value | Name                                | Summary                                                                                                                                                | Conformance |
|-------|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 10    | <b>Supplementary</b>                | Media content component that is supplementary to a media content component of a different media component type.                                        | M           |
| 11    | <b>Commentary</b>                   | Experience that contains a commentary (e.g. director's commentary) (typically audio)                                                                   | M           |
| 12    | <b>DubbedTranslation</b>            | Experience that contains an element that is presented in a different language from the original (e.g. dubbed audio, translated captions)               | M           |
| 13    | <b>Description</b>                  | Textual or audio media component containing a textual description (intended for audio synthesis) or an audio description describing a visual component | M           |
| 14    | <b>Metadata</b>                     | Media component containing information intended to be processed by application specific elements.                                                      | M           |
| 15    | <b>EnhancedAudioIntelligibility</b> | Experience containing an element for improved intelligibility of the dialogue.                                                                         | M           |

Page 592







| Value | Name             | Summary                                                                                                                                                                                                                                              | Conformance |
|-------|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 16    | <b>Emergency</b> | Experience that provides information, about a current emergency, that is intended to enable the protection of life, health, safety, and property, and may also include critical details regarding the emergency and how to respond to the emergency. | M           |
| 17    | <b>Karaoke</b>   | Textual representation of a songs' lyrics, usually in the same language as the associated song as specified in [SMPTE ST 2067-2].                                                                                                                    | M           |

#### 6.10.5.4. PlaybackPositionStruct Type

This structure defines a playback position within a media stream being played.

| ID | Name             | Type     | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------|----------|------------|---------|----------|--------|-------------|
| 0  | <b>UpdatedAt</b> | epoch-us | all        |         |          |        | M           |
| 1  | <b>Position</b>  | uint64   | all        | X       |          |        | M           |

##### 6.10.5.4.1. UpdatedAt Field

This field SHALL indicate the time when the position was last updated.

##### 6.10.5.4.2. Position Field

This field SHALL indicate the associated discrete position within the media stream, in milliseconds from the beginning of the stream, being associated with the time indicated by the UpdatedAt field. The Position SHALL NOT be greater than the duration of the media if duration is specified. The Position SHALL NOT be greater than the time difference between current time and start time of the media when start time is specified.

A value of null SHALL indicate that playback position is not applicable for the current state of the media playback (For example : Live media with no known duration and where seek is not supported).




Page 593



### 6.10.5.5. TrackStruct Type

This structure defines a uniquely identifiable Text Track or Audio Track.

| ID | Name            | Type                  | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|-----------------------|------------|---------|----------|--------|-------------|
| 0  | ID              | string                | max 32     |         |          |        | M           |
| 1  | TrackAttributes | TrackAttributesStruct | all        |         |          |        | M           |

#### 6.10.5.5.1. ID Field

This field SHALL indicate the Identifier for the Track which is unique within the Track catalog. The Track catalog contains all the Text/Audio tracks corresponding to the main media content.

#### 6.10.5.5.2. TrackAttributes Field

This field SHALL indicate the Attributes associated to the Track, like languageCode.

### 6.10.5.6. TrackAttributesStruct Type

This structure includes the attributes associated with a Text/Audio Track

| ID | Name            | Type                     | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|--------------------------|------------|---------|----------|--------|-------------|
| 0  | LanguageCode    | string                   | max 32     |         |          |        | M           |
| 1  | Characteristics | list[CharacteristicEnum] | all        | X       | null     |        | O           |
| 2  | DisplayName     | string                   | max 256    | X       | null     |        | O           |

#### 6.10.5.6.1. LanguageCode Field

The value is a String containing one of the standard Tags for Identifying Languages [RFC 5646](#), which identifies the primary language used in the Track.

#### 6.10.5.6.2. Characteristics Field

This is a list of enumerated [CharacteristicEnum](#) values that indicate a purpose, trait or feature associated with the Track. A value of null SHALL indicate that there are no Characteristics corresponding to the Track.

#### 6.10.5.6.3. DisplayName Field

The value is a String containing a user displayable name for the Track. A value of null SHALL indicate that there is no DisplayName corresponding to the Track.

Page 594



## 6.10.6. Attributes

| ID     | Name                        | Type                   | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------------|------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>CurrentState</b>         | PlaybackStateEnum      | desc       |         |          | RV     | M           |
| 0x0001 | <b>StartTime</b>            | epoch-us               | desc       | X       | null     | RV     | AS          |
| 0x0002 | <b>Duration</b>             | uint64                 | desc       | X       | null     | RV     | AS          |
| 0x0003 | <b>Sampled-Position</b>     | PlaybackPositionStruct | desc       | X       | null     | RV     | AS          |
| 0x0004 | <b>Playback-Speed</b>       | single                 | desc       |         | 0        | RV     | AS          |
| 0x0005 | <b>SeekRangeEnd</b>         | uint64                 | desc       | X       | null     | RV     | AS          |
| 0x0006 | <b>SeekRangeStart</b>       | uint64                 | desc       | X       | null     | RV     | AS          |
| 0x0007 | <b>ActiveAudioTrack</b>     | TrackStruct            | desc       | X       | null     | RV     | AT          |
| 0x0008 | <b>AvailableAudioTracks</b> | list[TrackStruct]      | desc       | X       | null     | RV     | AT          |
| 0x0009 | <b>ActiveTextTrack</b>      | TrackStruct            | desc       | X       | null     | RV     | TT          |
| 0x000A | <b>AvailableTextTracks</b>  | list[TrackStruct]      | desc       | X       | null     | RV     | TT          |

### 6.10.6.1. CurrentState Attribute

This attribute SHALL indicate the current playback state of media.

During fast-forward, rewind, and other seek operations; this attribute SHALL be set to PLAYING.

### 6.10.6.2. StartTime Attribute

This attribute SHALL indicate the start time of the media, in case the media has a fixed start time (for example, live stream or television broadcast), or null when start time does not apply to the current media (for example, video-on-demand). This time is a UTC time. The client needs to handle conversion to local time, as required, taking in account time zone and possible local DST offset.

### 6.10.6.3. Duration Attribute

This attribute SHALL indicate the duration, in milliseconds, of the current media being played back



Page 595



or null when duration is not applicable (for example, in live streaming content with no known duration). This attribute SHALL never be 0.

#### 6.10.6.4. SampledPosition Attribute

This attribute SHALL indicate the position of playback (Position field) at the time (UpdateAt field) specified in the attribute. The client MAY use the SampledPosition attribute to compute the current position within the media stream based on the PlaybackSpeed, PlaybackPositionStruct.UpdatedAt and PlaybackPositionStruct.Position fields. To enable this, the SampledPosition attribute SHALL be updated whenever a change in either the playback speed or the playback position is triggered outside the normal playback of the media. The events which MAY cause this to happen include:

- Starting or resumption of playback
- Seeking
- Skipping forward or backward
- Fast-forwarding or rewinding
- Updating of playback speed as a result of explicit request, or as a result of buffering events

#### 6.10.6.5. PlaybackSpeed Attribute

This attribute SHALL indicate the speed at which the current media is being played. The new PlaybackSpeed SHALL be reflected in this attribute whenever any of the following occurs:

- Starting of playback
- Resuming of playback
- Fast-forwarding
- Rewinding

The PlaybackSpeed SHALL reflect the ratio of time elapsed in the media to the actual time taken for the playback assuming no changes to media playback (for example buffering events or requests to pause/rewind/forward).

- A value for PlaybackSpeed of 1 SHALL indicate normal playback where, for example, playback for 1 second causes the media to advance by 1 second within the duration of the media.
- A value for PlaybackSpeed which is greater than 0 SHALL indicate that as playback is happening the media is currently advancing in time within the duration of the media.
- A value for PlaybackSpeed which is less than 0 SHALL indicate that as playback is happening the media is currently going back in time within the duration of the media.
- A value for PlaybackSpeed of 0 SHALL indicate that the media is currently not playing back. When the CurrentState attribute has the value of PAUSED, NOT\_PLAYING or BUFFERING, the PlaybackSpeed SHALL be set to 0 to reflect that the media is not playing.

Following examples illustrate the PlaybackSpeed attribute values in various conditions.

Page 596







| Seconds of Media Played | Actual Time Taken in Seconds | Direction of playback | PlaybackSpeed |
|-------------------------|------------------------------|-----------------------|---------------|
| 2                       | 2                            | Forward               | 1.0           |
| 2                       | 1                            | Forward               | 2.0           |
| 1                       | 2                            | Forward               | 0.5           |
| 2                       | 2                            | Reverse               | -1.0          |
| 2                       | 1                            | Reverse               | -2.0          |
| 1                       | 2                            | Reverse               | -0.5          |

#### 6.10.6.6. SeekRangeStart Attribute

This attribute SHALL indicate the earliest valid position to which a client MAY seek back, in milliseconds from start of the media. A value of NULL SHALL indicate that seeking backwards is not allowed.

#### 6.10.6.7. SeekRangeEnd Attribute

This attribute SHALL indicate the furthest forward valid position to which a client MAY seek forward, in milliseconds from the start of the media. When the media has an associated StartTime, a value of null SHALL indicate that a seek forward is valid only until the current time within the media, using a position computed from the difference between the current time offset and StartTime, in milliseconds from start of the media, truncating fractional milliseconds towards 0. A value of NULL when StartTime is not specified SHALL indicate that seeking forward is not allowed.

#### 6.10.6.8. ActiveAudioTrack Attribute

ActiveTrack refers to the Audio track currently set and being used for the streaming media. A value of null SHALL indicate that no Audio Track corresponding to the current media is currently being played.

#### 6.10.6.9. AvailableAudioTracks Attribute

AvailableAudioTracks refers to the list of Audio tracks available for the current title being played. A value of null SHALL indicate that no Audio Tracks corresponding to the current media are selectable by the client.

#### 6.10.6.10. ActiveTextTrack Attribute

ActiveTrack refers to the Text track currently set and being used for the streaming media. This can be nil. A value of null SHALL indicate that no Text Track corresponding to the current media is currently being displayed.

#### 6.10.6.11. AvailableTextTracks Attribute

AvailableTextTracks refers to the list of Text tracks available for the current title being played. This can be an empty list. A value of null SHALL indicate that no Text Tracks corresponding to the current media are selectable by the client.




Page 597



### 6.10.7. Commands

| ID   | Name                       | Direction                   | Response         | Access | Conformance |
|------|----------------------------|-----------------------------|------------------|--------|-------------|
| 0x00 | <b>Play</b>                | client $\Rightarrow$ server | PlaybackResponse | O      | M           |
| 0x01 | <b>Pause</b>               | client $\Rightarrow$ server | PlaybackResponse | O      | M           |
| 0x02 | <b>Stop</b>                | client $\Rightarrow$ server | PlaybackResponse | O      | M           |
| 0x03 | <b>StartOver</b>           | client $\Rightarrow$ server | PlaybackResponse | O      | O           |
| 0x04 | <b>Previous</b>            | client $\Rightarrow$ server | PlaybackResponse | O      | O           |
| 0x05 | <b>Next</b>                | client $\Rightarrow$ server | PlaybackResponse | O      | O           |
| 0x06 | <b>Rewind</b>              | client $\Rightarrow$ server | PlaybackResponse | O      | VS          |
| 0x07 | <b>FastForward</b>         | client $\Rightarrow$ server | PlaybackResponse | O      | VS          |
| 0x08 | <b>SkipForward</b>         | client $\Rightarrow$ server | PlaybackResponse | O      | O           |
| 0x09 | <b>SkipBackward</b>        | client $\Rightarrow$ server | PlaybackResponse | O      | O           |
| 0x0A | <b>PlaybackResponse</b>    | client $\Leftarrow$ server  | N                |        | M           |
| 0x0B | <b>Seek</b>                | client $\Rightarrow$ server | PlaybackResponse | O      | AS          |
| 0x0C | <b>ActivateAudioTrack</b>  | client $\Rightarrow$ server | Y                | O      | AT          |
| 0x0D | <b>ActivateTextTrack</b>   | client $\Rightarrow$ server | Y                | O      | TT          |
| 0x0E | <b>DeactivateTextTrack</b> | client $\Rightarrow$ server | Y                | O      | TT          |

#### 6.10.7.1. Play Command

This command is used to start playback of the media.

Upon receipt, this SHALL play media. If content is currently in a FastForward or Rewind state. Play SHALL return media to normal playback speed.

Page 598







#### 6.10.7.2. Pause Command

This command is used to pause playback of the media.

Upon receipt, this SHALL pause playback of the media.

#### 6.10.7.3. Stop Command

This command is used to stop playback of the media.

Upon receipt, this SHALL stop playback of the media. User-visible outcome is context-specific. This MAY navigate the user back to the location from where the media was originally launched.

#### 6.10.7.4. StartOver Command

This command is used to start playback of the media from the beginning.

Upon receipt, this SHALL Start Over with the current media playback item.

#### 6.10.7.5. Previous Command

This command is used to go back to the previous media playback item.

Upon receipt, this SHALL cause the handler to be invoked for "Previous". User experience is context-specific. This will often Go back to the previous media playback item.

#### 6.10.7.6. Next Command

This command is used to go to the next media playback item.

Upon receipt, this SHALL cause the handler to be invoked for "Next". User experience is context-specific. This will often Go forward to the next media playback item.

#### 6.10.7.7. Rewind Command

This command is used to rewind the media.

Upon receipt, this SHALL start playback of the media backward in case the media is currently playing in the forward direction or is not playing. If the playback is already happening in the backwards direction receipt of this command SHALL increase the speed of the media playback backwards.

Different "rewind" speeds MAY be reflected on the media playback device based upon the number of sequential calls to this function and the capability of the device. This is to avoid needing to define every speed (multiple fast, slow motion, etc). If the PlaybackSpeed attribute is supported it SHALL be updated to reflect the new speed of playback. If the playback speed cannot be changed for the media being played(for example, in live streaming content not supporting seek), the status of NOT\_ALLOWED SHALL be returned. If the playback speed has reached the maximum supported speed for media playing backwards, the status of SPEED\_OUT\_OF\_RANGE SHALL be returned.



Page 599



| ID | Name                       | Type | Constraint | Quality | Fallback | Conformance |
|----|----------------------------|------|------------|---------|----------|-------------|
| 0  | <b>AudioAdvanceUnmuted</b> | bool | all        |         | false    | AA          |

#### 6.10.7.7.1. AudioAdvanceUnmuted Field

This field SHALL indicate whether audio should be unmuted by the player during rewind.

A value of true does not guarantee that audio can be heard by the user since the speaker may be muted, turned down to a low level and/or unplugged.

#### 6.10.7.8. FastForward Command

This command is used to fast forward the media.

Upon receipt, this SHALL start playback of the media in the forward direction in case the media is currently playing in the backward direction or is not playing. If the playback is already happening in the forward direction receipt of this command SHALL increase the speed of the media playback.

Different "fast-forward" speeds MAY be reflected on the media playback device based upon the number of sequential calls to this function and the capability of the device. This is to avoid needing to define every speed (multiple fast, slow motion, etc). If the PlaybackSpeed attribute is supported it SHALL be updated to reflect the new speed of playback. If the playback speed cannot be changed for the media being played(for example, in live streaming content not supporting seek), the status of NOT\_ALLOWED SHALL be returned. If the playback speed has reached the maximum supported speed for media playing forward, the status of SPEED\_OUT\_OF\_RANGE SHALL be returned.

| ID | Name                       | Type | Constraint | Quality | Fallback | Conformance |
|----|----------------------------|------|------------|---------|----------|-------------|
| 0  | <b>AudioAdvanceUnmuted</b> | bool | all        |         | false    | AA          |

#### 6.10.7.8.1. AudioAdvanceUnmuted Field

This field SHALL indicate whether audio should be unmuted by the player during fast forward.

A value of true does not guarantee that audio can be heard by the user since the speaker may be muted, turned down to a low level and/or unplugged.

#### 6.10.7.9. SkipForward Command

This command is used to skip forward in the media.

Upon receipt, this SHALL Skip forward in the media by the given number of milliseconds, using the data as follows:

Page 600



| ID | Name                             | Type   | Constraint | Quality | Fallback | Conformance |
|----|----------------------------------|--------|------------|---------|----------|-------------|
| 0  | <b>DeltaPositionMilliseconds</b> | uint64 | all        |         |          | M           |

#### 6.10.7.9.1. DeltaPositionMilliseconds Field

This field SHALL indicate the duration of the time span to skip forward in the media, in milliseconds. In case the resulting position falls in the middle of a frame, the server SHALL set the position to the beginning of that frame and set the SampledPosition attribute on the cluster accordingly. If the resultant position falls beyond the furthest valid position in the media the client MAY seek forward to, the position should be set to that furthest valid position. If the SampledPosition attribute is supported it SHALL be updated on the cluster accordingly.

#### 6.10.7.10. SkipBackward Command

This command is used to skip backward in the media.

Upon receipt, this SHALL Skip backward in the media by the given number of milliseconds, using the data as follows:

| ID | Name                             | Type   | Constraint | Quality | Fallback | Conformance |
|----|----------------------------------|--------|------------|---------|----------|-------------|
| 0  | <b>DeltaPositionMilliseconds</b> | uint64 | all        |         |          | M           |

#### 6.10.7.10.1. DeltaPositionMilliseconds Field

This field SHALL indicate the duration of the time span to skip backward in the media, in milliseconds. In case the resulting position falls in the middle of a frame, the server SHALL set the position to the beginning of that frame and set the SampledPosition attribute on the cluster accordingly. If the resultant position falls before the earliest valid position to which a client MAY seek back to, the position should be set to that earliest valid position. If the SampledPosition attribute is supported it SHALL be updated on the cluster accordingly.

#### 6.10.7.11. Seek Command

This command is used to seek to a specific position in the media.

Upon receipt, this SHALL change the playback position in the media to the given position using data as follows:

| ID | Name            | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------|------------|---------|----------|-------------|
| 0  | <b>Position</b> | uint64 | all        |         |          | M           |



Page 601



#### 6.10.7.11.1. Position Field

This field SHALL indicate the position (in milliseconds) in the media to seek to. In case the position falls in the middle of a frame, the server SHALL set the position to the beginning of that frame and set the SampledPosition attribute on the cluster accordingly. If the position falls before the earliest valid position or beyond the furthest valid position to which a client MAY seek back or forward to respectively, the status of SEEK\_OUT\_OF\_RANGE SHALL be returned and no change SHALL be made to the position of the playback.

#### 6.10.7.12. PlaybackResponse Command

This command is used to indicate the status of the command that was issued by the client.

This command SHALL be generated in response to various Playback Commands. The data for this command SHALL be as follows:

| ID | Name   | Type       | Constraint | Quality | Fallback | Conformance |
|----|--------|------------|------------|---------|----------|-------------|
| 0  | Status | StatusEnum | desc       |         |          | M           |
| 1  | Data   | string     | any        |         |          | O           |

##### 6.10.7.12.1. Status Field

This field SHALL indicate the status of the command which resulted in this response.

##### 6.10.7.12.2. Data Field

This field SHALL indicate Optional app-specific data.

#### 6.10.7.13. ActivateAudioTrack Command

This command is used to activate a specific Audio Track for the media being played.

Upon receipt, the server SHALL set the active Audio Track to the one identified by the TrackID in the Track catalog for the streaming media. If the TrackID does not exist in the Track catalog, OR does not correspond to the streaming media OR no media is being streamed at the time of receipt of this command, the server will return an error status of INVALID\_ARGUMENT.

| ID | Name             | Type   | Constraint | Quality | Fallback | Conformance |
|----|------------------|--------|------------|---------|----------|-------------|
| 0  | TrackID          | string | max 32     |         |          | M           |
| 1  | AudioOutputIndex | uint8  | all        | X       |          | AT          |

##### 6.10.7.13.1. TrackID Field

This field SHALL indicate the Audio Track to activate.

Page 602







#### 6.10.7.13.2. AudioOutputIndex Field

This value is the index field of the OutputInfoStruct from the OutputList attribute (from the AudioOutput cluster) and indicates which audio output the Audio Track should be played on. This field is absent for Text Tracks and only present for Audio Tracks. A value of null SHALL indicate that the server can choose the audio output(s) to play the Audio Track on.

#### 6.10.7.14. ActivateTextTrack Command

This command is used to activate a specific Text Track for the media being played.

Upon receipt, the server SHALL set the active Text Track to the one identified by the TrackID in the Track catalog for the streaming media. If the TrackID does not exist in the Track catalog, OR does not correspond to the streaming media OR no media is being streamed at the time of receipt of this command, the server SHALL return an error status of INVALID\_ARGUMENT.

| ID | Name    | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------|--------|------------|---------|----------|-------------|
| 0  | TrackID | string | max 32     |         |          | M           |

##### 6.10.7.14.1. TrackID Field

This field SHALL indicate the Text Track to activate.

#### 6.10.7.15. DeactivateTextTrack Command

This command is used to deactivate a specific Text Track for the media being played.

If a Text Track is active (i.e. being displayed), upon receipt of this command, the server SHALL stop displaying it.

### 6.10.8. Events

| ID   | Name         | Priority | Access | Conformance |
|------|--------------|----------|--------|-------------|
| 0x00 | StateChanged | INFO     | V      | O           |

#### 6.10.8.1. StateChanged Event

If supported, this event SHALL be generated when there is a change in any of the supported attributes of the Media Playback cluster. This event SHALL have the following data fields:

| ID     | Name         | Type              | Constraint | Quality | Fallback | Conformance |
|--------|--------------|-------------------|------------|---------|----------|-------------|
| 0x0000 | CurrentState | PlaybackStateEnum | desc       |         |          | M           |
| 0x0001 | StartTime    | epoch-us          | desc       |         |          | AS          |
| 0x0002 | Duration     | uint64            | desc       |         |          | AS          |



Page 603



| ID     | Name                       | Type                   | Constraint | Quality | Fallback | Conformance |
|--------|----------------------------|------------------------|------------|---------|----------|-------------|
| 0x0003 | <b>SampledPosition</b>     | PlaybackPositionStruct | desc       |         |          | AS          |
| 0x0004 | <b>PlaybackSpeed</b>       | single                 | desc       |         |          | AS          |
| 0x0005 | <b>SeekRangeEnd</b>        | uint64                 | desc       |         |          | AS          |
| 0x0006 | <b>SeekRangeStart</b>      | uint64                 | desc       |         |          | AS          |
| 0x0007 | <b>Data</b>                | octstr                 | max 900    |         |          | O           |
| 0x0008 | <b>AudioAdvanceUnmuted</b> | bool                   | desc       |         | false    | AA          |

#### 6.10.8.1.1. CurrentState Field

This field SHALL indicate the updated playback state as defined by the CurrentState attribute, and has the same constraint as that attribute.

#### 6.10.8.1.2. StartTime Field

This field SHALL indicate the updated start time as defined by the StartTime attribute, and has the same constraint as that attribute.

This field value SHALL be 0 when the value of the StartTime attribute is NULL.

#### 6.10.8.1.3. Duration Field

This field SHALL indicate the updated duration as defined by the Duration attribute, and has the same constraint as that attribute.

This field value SHALL be 0 when the value of the Duration attribute is NULL.

#### 6.10.8.1.4. SampledPosition Field

This field SHALL indicate the updated position of playback as defined by the SampledPosition attribute, and has the same constraint as that attribute.

The UpdatedAt field value of the [PlaybackPositionStruct](#) SHALL be 0, and the Position field value of the [PlaybackPositionStruct](#) SHALL be NULL, when the value of the SampledPosition attribute is NULL.

#### 6.10.8.1.5. PlaybackSpeed Field

This field SHALL indicate the updated speed at which the current media is being played as defined by the PlaybackSpeed attribute, and has the same constraint as that attribute.

Page 604







#### 6.10.8.1.6. SeekRangeStart Field

This field SHALL indicate the updated start of the seek range start as defined by the SeekRangeStart attribute, and has the same constraint as that attribute.

This field value SHALL be 0 when the value of the SeekRangeStart attribute is NULL.

#### 6.10.8.1.7. SeekRangeEnd Field

This field SHALL indicate the updated start of the seek range end as defined by the SeekRangeEnd attribute, and has the same constraint as that attribute.

This field value SHALL be 0 when the value of the SeekRangeEnd attribute is NULL.

#### 6.10.8.1.8. Data Field

This field SHALL indicate Optional app-specific data.

#### 6.10.8.1.9. AudioAdvanceUnmuted Field

This field SHALL indicate whether audio is unmuted by the player due to a FF or REW command. This field is only meaningful when the PlaybackSpeed is present and not equal to 0 (paused) or 1 (normal playback). Typically the value will be false (muted), however, some players will play audio during certain fast forward and rewind speeds, and in these cases, the value will be true (not muted).

A value of true does not guarantee that audio can be heard by the user since the speaker may be muted, turned down to a low level and/or unplugged.

## 6.11. Target Navigator Cluster

This cluster provides an interface for UX navigation within a set of targets on a device or endpoint.

This cluster would be supported on Video Player devices or devices with navigable user interfaces. This cluster would also be supported on endpoints with navigable user interfaces such as a Content App. It supports listing a set of navigation targets, tracking and changing the current target.

The cluster server for Target Navigator is implemented by endpoints on a device that support UX navigation.

When this cluster is implemented for a Content App endpoint, the Video Player device containing the endpoint SHALL launch the Content App when a client invokes the NavigateTarget command.

### 6.11.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |




Page 605



| Revision | Description             |
|----------|-------------------------|
| 2        | Add TargetUpdated event |

### 6.11.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | TGTNAV    |

### 6.11.3. Cluster ID

| ID     | Name             |
|--------|------------------|
| 0x0505 | Target Navigator |

### 6.11.4. Data Types

#### 6.11.4.1. StatusEnum Type

This data type is derived from enum8.

| Value | Name           | Summary                                          | Conformance |
|-------|----------------|--------------------------------------------------|-------------|
| 0     | Success        | Command succeeded                                | M           |
| 1     | TargetNotFound | Requested target was not found in the TargetList | M           |
| 2     | NotAllowed     | Target request is not allowed in current state.  | M           |

#### 6.11.4.2. TargetInfoStruct Type

This indicates an object describing the navigable target.

| ID | Name       | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|------------|--------|------------|---------|----------|--------|-------------|
| 0  | Identifier | uint8  | max 254    |         |          |        | M           |
| 1  | Name       | string |            |         |          |        | M           |

##### 6.11.4.2.1. Identifier Field

This field SHALL contain a unique id within the TargetList.

##### 6.11.4.2.2. Name Field

This field SHALL contain a name string for the TargetInfoStruct.

Page 606







### 6.11.5. Attributes

| ID     | Name          | Type                                     | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------|------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | TargetList    | list[ <a href="#">TargetInfoStruct</a> ] |            |         |          | R V    | M           |
| 0x0001 | CurrentTarget | uint8                                    | desc       |         | 0xFF     | R V    | O           |

#### 6.11.5.1. TargetList Attribute

This attribute SHALL represent a list of targets that can be navigated to within the experience presented to the user by the Endpoint (Video Player or Content App). The list SHALL NOT contain any entries with the same Identifier in the TargetInfoStruct object.

#### 6.11.5.2. CurrentTarget Attribute

This attribute SHALL represent the Identifier for the target which is currently in foreground on the corresponding Endpoint (Video Player or Content App), or 0xFF to indicate that no target is in the foreground.

When not 0xFF, the CurrentTarget SHALL be an Identifier value contained within one of the TargetInfoStruct objects in the TargetList attribute.

### 6.11.6. Commands

| ID   | Name                   | Direction                   | Response               | Access | Conformance |
|------|------------------------|-----------------------------|------------------------|--------|-------------|
| 0x00 | NavigateTarget         | client $\Rightarrow$ server | NavigateTargetResponse | O      | M           |
| 0x01 | NavigateTargetResponse | client $\Leftarrow$ server  | N                      |        | M           |

#### 6.11.6.1. NavigateTarget Command

Upon receipt, this SHALL navigation the UX to the target identified.

| ID | Field  | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------|--------|------------|---------|----------|-------------|
| 0  | Target | uint8  | all        |         |          | M           |
| 1  | Data   | string |            |         | MS       | O           |

##### 6.11.6.1.1. Target Field

This field SHALL indicate the Identifier for the target for UX navigation. The Target SHALL be an Identifier value contained within one of the TargetInfoStruct objects in the TargetList attribute.




Page 607



#### 6.11.6.1.2. Data Field

This field SHALL indicate Optional app-specific data.

#### 6.11.6.2. NavigateTargetResponse Command

This command SHALL be generated in response to NavigateTarget command.

| ID | Field  | Type       | Constraint | Quality | Fallback | Conformance |
|----|--------|------------|------------|---------|----------|-------------|
| 0  | Status | StatusEnum | all        |         |          | M           |
| 1  | Data   | string     | any        |         | MS       | O           |

##### 6.11.6.2.1. Status Field

This field SHALL indicate the of the command.

##### 6.11.6.2.2. Data Field

This field SHALL indicate Optional app-specific data.

### 6.11.7. Events

| ID   | Name          | Priority | Access | Conformance |
|------|---------------|----------|--------|-------------|
| 0x00 | TargetUpdated | INFO     | V      | O           |

#### 6.11.7.1. TargetUpdated Event

This event SHALL be generated when there is a change in either the active target or the list of available targets or both. This event SHALL have the following data fields:

| ID | Name          | Type                    | Constraint | Quality | Fallback | Conformance |
|----|---------------|-------------------------|------------|---------|----------|-------------|
| 0  | TargetList    | list[Target-InfoStruct] |            |         |          | O           |
| 1  | CurrentTarget | uint8                   | desc       |         | 0xFF     | O           |
| 2  | Data          | octstr                  | max 900    |         |          | O           |

##### 6.11.7.2. TargetList Field

This field SHALL indicate the updated target list as defined by the TargetList attribute if there is a change in the list of targets. Otherwise this field can be omitted from the event.

##### 6.11.7.3. CurrentTarget Field

This field SHALL indicate the updated target that is in foreground as defined by the CurrentTarget attribute if supported (see CurrentTarget attribute for constraints).

Page 608



#### 6.11.7.4. Data Field

This field SHALL indicate Optional app-specific data.

### 6.12. Content App Observer Cluster

This cluster provides an interface for sending targeted commands to an Observer of a Content App on a Video Player device such as a Streaming Media Player, Smart TV or Smart Screen.

The cluster server for Content App Observer is implemented by an endpoint that communicates with a Content App, such as a Casting Video Client.

The cluster client for Content App Observer is implemented by a Content App endpoint.

A Content App is informed of the NodeId of an Observer when a binding is set on the Content App. For a Content App Platform, the binding is set by the platform when a CastingVideoClient is granted access to the Content App, and the CastingVideoClient supports the Content App Observer cluster. The Content App can then send the ContentAppMessage to the Observer (server cluster), and the Observer responds with a ContentAppMessageResponse.

The Data and EncodingHint fields of the ContentAppMessage and ContentAppMessageResponse contain content app-specific values, the format and interpretation of which is defined by the Content App vendor, analogous to the custom message features offered by other popular casting protocols. Standardized cluster and commands are used here rather than manufacturer-specific cluster and commands because of the role that the Content App Platform plays in creating the ACLs and Bindings on both sides of the communication between the Content App Observer endpoint and the Content App endpoint.

By using standard cluster and commands:

1. The Content App Platform is able to easily determine that a binding is needed on the Content App endpoint because it can recognize the Content App Observer cluster implemented by a client node.
2. The Content App Platform is able to easily identify commands that are allowed to be sent by the Content App to a client node because those commands use the Content App Observer cluster.
3. The Content App is able to easily determine that a node supports the Content App Observer cluster because it has received a binding which specifies the Content App Observer cluster.
4. The Casting Video Client is able to support a single cluster for receiving commands from any Content App and does not need to explicitly list every Content App it understands.

A Content App Observer SHOULD ignore the Data and EncodingHint field values in commands from a Content App it does not recognize. A Content App SHOULD ignore the Data field values in responses when the EncodingHint value is blank or not recognized.

#### 6.12.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.



Page 609



| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 6.12.2. Classification

| Hierarchy | Role        | Scope    | PICS Code   |
|-----------|-------------|----------|-------------|
| Base      | Application | Endpoint | APPOBSERVER |

### 6.12.3. Cluster ID

| ID     | Name                 |
|--------|----------------------|
| 0x0510 | Content App Observer |

### 6.12.4. Data Types

#### 6.12.4.1. StatusEnum Type

This data type is derived from enum8.

| Value | Name           | Summary                                                  | Conformance |
|-------|----------------|----------------------------------------------------------|-------------|
| 0     | Success        | Command succeeded                                        | M           |
| 1     | UnexpectedData | Data field in command was not understood by the Observer | M           |

### 6.12.5. Commands

| ID   | Name                      | Direction                   | Response                  | Access | Conformance |
|------|---------------------------|-----------------------------|---------------------------|--------|-------------|
| 0x00 | ContentAppMessage         | client $\Rightarrow$ server | ContentAppMessageResponse | O      | M           |
| 0x01 | ContentAppMessageResponse | client $\Leftarrow$ server  | N                         |        | M           |

#### 6.12.5.1. ContentAppMessage Command

Upon receipt, the data field MAY be parsed and interpreted. Message encoding is specific to the Content App. A Content App MAY when possible read attributes from the Basic Information Cluster on the Observer and use this to determine the Message encoding.

This command returns a ContentAppMessage Response.

Page 610







| ID | Name         | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------------|--------|------------|---------|----------|-------------|
| 0  | Data         | string | max 500    |         |          | M           |
| 1  | EncodingHint | string | max 100    |         |          | O           |

#### 6.12.5.1.1. Data Field

This field SHALL indicate content app-specific data.

#### 6.12.5.1.2. EncodingHint Field

This optional field SHALL indicate a content app-specific hint to the encoding of the data.

### 6.12.5.2. ContentAppMessageResponse Command

This command SHALL be generated in response to ContentAppMessage command.

| ID | Name         | Type       | Constraint | Quality | Fallback | Conformance |
|----|--------------|------------|------------|---------|----------|-------------|
| 0  | Status       | StatusEnum | all        |         |          | M           |
| 1  | Data         | string     | max 500    |         |          | O           |
| 2  | EncodingHint | string     | max 100    |         |          | O           |

#### 6.12.5.2.1. Status Field

This field SHALL indicate the status of the command which resulted in this response.

#### 6.12.5.2.2. Data Field

This optional field SHALL indicate content app-specific data.

#### 6.12.5.2.3. EncodingHint Field

This optional field SHALL indicate a content app-specific hint to the encoding of the data.

## 6.13. Content Control Cluster

This cluster is used for managing the content control (including "parental control") settings on a media device such as a TV, or Set-top Box.

This cluster allows to configure content control settings by clients with the Management privilege. It is responsibility of the end product to enforce appropriate right access (for example, to prevent a child from disabling this feature).

**NOTE** Support for Content Control cluster is provisional.




Page 611



### 6.13.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 6.13.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | CONCON    |

### 6.13.3. Cluster ID

| ID     | Name            | Conformance |
|--------|-----------------|-------------|
| 0x050F | Content Control | P           |

### 6.13.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature                | Summary                                                                                             |
|-----|------|------------------------|-----------------------------------------------------------------------------------------------------|
| 0   | ST   | ScreenTime             | Supports managing screen time limits.                                                               |
| 1   | PM   | PINManagement          | Supports managing a PIN code which is used for restricting access to configuration of this feature. |
| 2   | BU   | BlockUnrated           | Supports managing content controls for unrated content.                                             |
| 3   | OCR  | OnDemandContentRating  | Supports managing content controls based upon rating threshold for on demand content.               |
| 4   | SCR  | ScheduledContentRating | Supports managing content controls based upon rating threshold for scheduled content.               |
| 5   | BC   | BlockChannels          | Supports managing a set of channels that are prohibited.                                            |

Page 612







| Bit | Code | Feature                | Summary                                                                                                                    |
|-----|------|------------------------|----------------------------------------------------------------------------------------------------------------------------|
| 6   | BA   | BlockApplications      | Supports managing a set of applications that are prohibited.                                                               |
| 7   | BTW  | BlockContentTimeWindow | Supports managing content controls based upon setting time window in which all contents and applications SHALL be blocked. |

### 6.13.5. Data Types

#### 6.13.5.1. DayOfWeekBitmap type

This data type is derived from map8.

| Bit | Name             | Summary   |
|-----|------------------|-----------|
| 0   | <b>Sunday</b>    | Sunday    |
| 1   | <b>Monday</b>    | Monday    |
| 2   | <b>Tuesday</b>   | Tuesday   |
| 3   | <b>Wednesday</b> | Wednesday |
| 4   | <b>Thursday</b>  | Thursday  |
| 5   | <b>Friday</b>    | Friday    |
| 6   | <b>Saturday</b>  | Saturday  |

#### 6.13.5.2. RatingNameStruct Type

| ID | Name                   | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>Rating-Name</b>     | string | max 8      |         |          |        | M           |
| 1  | <b>Rating-NameDesc</b> | string | max 64     |         |          |        | O           |

##### 6.13.5.2.1. RatingName Field

This field SHALL indicate the name of the rating level of the applied rating system. The applied rating system is dependent upon the region or country where the Node has been provisioned, and may vary from one country to another.

##### 6.13.5.2.2. RatingNameDesc Field

This field SHALL specify a human readable (displayable) description for RatingName.



Page 613



### 6.13.5.3. BlockChannelStruct Type

| ID | Name              | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------|--------|------------|---------|----------|--------|-------------|
| 0  | BlockChannelIndex | uint16 | all        | X       |          |        | M           |
| 1  | Major-Number      | uint16 | all        |         |          |        | M           |
| 2  | Minor-Number      | uint16 | all        |         |          |        | M           |
| 3  | Identifier        | string | all        |         |          |        | O           |

#### 6.13.5.3.1. BlockChannelIndex Field

This field SHALL indicate a unique index value for a blocked channel. This value may be used to indicate one selected channel which will be removed from BlockChannelList attribute.

#### 6.13.5.3.2. MajorNumber Field

This field SHALL indicate the channel major number value (for example, using ATSC format). When the channel number is expressed as a string, such as "13.1" or "256", the major number would be 13 or 256, respectively. This field is required but SHALL be set to 0 for channels such as over-the-top channels that are not represented by a major or minor number.

#### 6.13.5.3.3. MinorNumber Field

This field SHALL indicate the channel minor number value (for example, using ATSC format). When the channel number is expressed as a string, such as "13.1" or "256", the minor number would be 1 or 0, respectively. This field is required but SHALL be set to 0 for channels such as over-the-top channels that are not represented by a major or minor number.

#### 6.13.5.3.4. Identifier

This field SHALL indicate the unique identifier for a specific channel. This field is optional, but SHOULD be provided when MajorNumber and MinorNumber are not available.

### 6.13.5.4. AppInfoStruct Type

| ID | Name            | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|--------|------------|---------|----------|--------|-------------|
| 0  | CatalogVendorID | uint16 | all        |         |          |        | M           |
| 1  | ApplicationID   | string | all        |         |          |        | M           |

Page 614



#### 6.13.5.4.1. CatalogVendorID Field

This field SHALL indicate the Connectivity Standards Alliance-issued vendor ID for the catalog. The DIAL registry SHALL use value 0x0000.

Content App Platform providers will have their own catalog vendor ID (set to their own Vendor ID) and will assign an ApplicationID to each Content App.

#### 6.13.5.4.2. ApplicationID field

This field SHALL indicate the application identifier, expressed as a string, such as "PruneVideo" or "Company X". This field SHALL be unique within a catalog.

### 6.13.5.5. TimeWindowStruct Type

| ID | Name            | Type                   | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|------------------------|------------|---------|----------|--------|-------------|
| 0  | TimeWindowIndex | uint16                 | all        | X       |          |        | M           |
| 1  | DayOfWeek       | DayOfWeekBitmap        | desc       |         |          |        | M           |
| 2  | TimePeriod      | list[TimePeriodStruct] | desc       |         |          |        | M           |

#### 6.13.5.5.1. TimeWindowIndex Field

This field SHALL indicate a unique index of a specific time window. This value may be used to indicate a selected time window which will be removed from the BlockContentTimeWindow attribute.

#### 6.13.5.5.2. DayOfWeek Field

This field SHALL indicate a day of week.

#### 6.13.5.5.3. TimePeriod Field

This field SHALL indicate one or more discrete time periods.

### 6.13.5.6. TimePeriodStruct type

| ID | Name         | Type  | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------|-------|------------|---------|----------|--------|-------------|
| 0  | StartHour    | uint8 | 0 to 23    |         |          |        | M           |
| 1  | Start-Minute | uint8 | 0 to 59    |         |          |        | M           |
| 2  | EndHour      | uint8 | 0 to 23    |         |          |        | M           |



Page 615



| ID | Name              | Type  | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------|-------|------------|---------|----------|--------|-------------|
| 3  | <b>End-Minute</b> | uint8 | 0 to 59    |         |          |        | M           |

#### 6.13.5.6.1. StartHour Field

This field SHALL indicate the starting hour.

#### 6.13.5.6.2. StartMinute Field

This field SHALL indicate the starting minute.

#### 6.13.5.6.3. EndHour Field

This field SHALL indicate the ending hour. EndHour SHALL be equal to or greater than StartHour

#### 6.13.5.6.4. EndMinute Field

This field SHALL indicate the ending minute. If EndHour is equal to StartHour then EndMinute SHALL be greater than StartMinute. If the EndHour is equal to 23 and the EndMinute is equal to 59, all contents SHALL be blocked until 23:59:59.

### 6.13.6. Status Codes

#### 6.13.6.1. StatusCodeEnum Type

This data type is derived from enum8.

| Value | Name                             | Summary                                                           |
|-------|----------------------------------|-------------------------------------------------------------------|
| 0x02  | <b>InvalidPINCode</b>            | Provided PIN Code does not match the current PIN code.            |
| 0x03  | <b>InvalidRating</b>             | Provided Rating is out of scope of the corresponding Rating list. |
| 0x04  | <b>InvalidChannel</b>            | Provided Channel(s) is invalid.                                   |
| 0x05  | <b>ChannelAlreadyExist</b>       | Provided Channel(s) already exists.                               |
| 0x06  | <b>ChannelNotExist</b>           | Provided Channel(s) doesn't exist in BlockChannelList attribute.  |
| 0x07  | <b>UnidentifiableApplication</b> | Provided Application(s) is not identified.                        |
| 0x08  | <b>ApplicationAlreadyExist</b>   | Provided Application(s) already exists.                           |

Page 616







| Value | Name                          | Summary                                                                  |
|-------|-------------------------------|--------------------------------------------------------------------------|
| 0x09  | <b>ApplicationNotExist</b>    | Provided Application(s) doesn't exist in BlockApplicationList attribute. |
| 0x0A  | <b>TimeWindowAlreadyExist</b> | Provided time Window already exists in BlockContentTimeWindow attribute. |
| 0x0B  | <b>TimeWindowNotExist</b>     | Provided time window doesn't exist in BlockContentTimeWindow attribute.  |

### 6.13.7. Attributes

| ID     | Name                                   | Type                      | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------------------------------|---------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Enabled</b>                         | bool                      | all        |         |          | R V    | M           |
| 0x0001 | <b>OnDemandRatings</b>                 | list[Rating-NameStruct]   | all        |         |          | R V    | OCR         |
| 0x0002 | <b>OnDemandRatingThreshold</b>         | string                    | max 8      |         |          | R V    | OCR         |
| 0x0003 | <b>ScheduledContentRatings</b>         | list[Rating-NameStruct]   | all        |         |          | R V    | SCR         |
| 0x0004 | <b>ScheduledContentRatingThreshold</b> | string                    | max 8      |         |          | R V    | SCR         |
| 0x0005 | <b>ScreenDaillyTime</b>                | elapsed-s                 | max 86400  |         |          | R V    | ST          |
| 0x0006 | <b>RemainingScreenTime</b>             | elapsed-s                 | max 86400  |         |          | R V    | ST          |
| 0x0007 | <b>BlockUnrated</b>                    | bool                      | all        |         |          | R V    | BU          |
| 0x0008 | <b>BlockChannelList</b>                | list[BlockChannel-Struct] | all        |         |          | R V    | BC          |



Page 617



| ID     | Name                          | Type                                     | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------------------|------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0009 | <b>BlockApplicationList</b>   | list[ <a href="#">AppInfoStruct</a> ]    | all        |         |          | R V    | BA          |
| 0x000A | <b>BlockContentTimeWindow</b> | list[ <a href="#">TimeWindowStruct</a> ] | max 7      |         |          | R V    | BTW         |

#### 6.13.7.1. Enabled Attribute

This attribute SHALL indicate whether the Content Control feature implemented on a media device is turned off (FALSE) or turned on (TRUE).

#### 6.13.7.2. OnDemandRatings Attribute

This attribute SHALL provide the collection of ratings that are currently valid for this media device. The items should honor the metadata of the on-demand content (e.g. Movie) rating system for one country or region where the media device has been provisioned. For example, for the MPAA system, RatingName may be one value out of "G", "PG", "PG-13", "R", "NC-17".

The media device SHALL have a way to determine which rating system applies for the on-demand content and then populate this attribute. For example, it can do it through examining the Location attribute in the Basic Information cluster, and then determining which rating system applies.

The ratings in this collection SHALL be in order from a rating for the youngest viewers to the one for the oldest viewers. Each rating in the list SHALL be unique.

#### 6.13.7.3. OnDemandRatingThreshold Attribute

This attribute SHALL indicate a threshold rating as a content filter which is compared with the rating for on-demand content. For example, if the on-demand content rating is greater than or equal to OnDemandRatingThreshold, for a rating system that is ordered from lower viewer age to higher viewer age, then on-demand content is not appropriate for the User and the Node SHALL prevent the playback of content.

This attribute SHALL be set to one of the values present in the OnDemandRatings attribute.

When this attribute changes, the device SHOULD make the user aware of any limits of this feature. For example, if the feature does not control content within apps, then the device should make this clear to the user when the attribute changes.

#### 6.13.7.4. ScheduledContentRatings Attribute

This attribute SHALL indicate a collection of ratings which ScheduledContentRatingThreshold can be set to. The items should honor metadata of the scheduled content rating system for the country or region where the media device has been provisioned.

Page 618







The media device SHALL have a way to determine which scheduled content rating system applies and then populate this attribute. For example, this can be done by examining the Location attribute in Basic Information cluster, and then determining which rating system applies.

The ratings in this collection SHALL be in order from a rating for the youngest viewers to the one for the oldest viewers. Each rating in the list SHALL be unique.

#### **6.13.7.5. ScheduledContentRatingThreshold Attribute**

This attribute SHALL indicate a threshold rating as a content filter which is used to compare with the rating for scheduled content. For example, if the scheduled content rating is greater than or equal to ScheduledContentRatingThreshold for a rating system that is ordered from lower viewer age to higher viewer age, then the scheduled content is not appropriate for the User and SHALL be blocked.

This attribute SHALL be set to one of the values present in the ScheduledContentRatings attribute.

When this attribute changes, the device SHOULD make the user aware of any limits of this feature. For example, if the feature does not control content within apps, then the device should make this clear to the user when the attribute changes.

#### **6.13.7.6. ScreenDailyTime Attribute**

This attribute SHALL indicate the amount of time (in seconds) which the User is allowed to spend watching TV within one day when the Content Control feature is activated.

#### **6.13.7.7. RemainingScreenTime Attribute**

This attribute SHALL indicate the remaining screen time (in seconds) which the User is allowed to spend watching TV for the current day when the Content Control feature is activated. When this value equals 0, the media device SHALL terminate the playback of content.

This attribute SHALL be updated when the AddBonusTime command is received and processed successfully (with the correct PIN).

#### **6.13.7.8. BlockUnrated Attribute**

This attribute SHALL indicate whether the playback of unrated content is allowed when the Content Control feature is activated. If this attribute equals FALSE, then playback of unrated content SHALL be permitted. Otherwise, the media device SHALL prevent the playback of unrated content.

When this attribute changes, the device SHOULD make the user aware of any limits of this feature. For example, if the feature does not control content within apps, then the device should make this clear to the user when the attribute changes.

#### **6.13.7.9. BlockChannelList Attribute**

This attribute SHALL indicate a set of channels that SHALL be blocked when the Content Control feature is activated.



Page 619



### 6.13.7.10. BlockApplicationList Attribute

This attribute SHALL indicate a set of applications that SHALL be blocked when the Content Control feature is activated.

### 6.13.7.11. BlockContentTimeWindow Attribute

This attribute SHALL indicate a set of periods during which the playback of content on media device SHALL be blocked when the Content Control feature is activated. The media device SHALL reject any request to play content during one period of this attribute. If it is entering any one period of this attribute, the media device SHALL block content which is playing and generate an event EnteringBlockContentTimeWindow. There SHALL NOT be multiple entries in this attribute list for the same day of week.

### 6.13.8. Commands

| ID   | Name                               | Direction                   | Response         | Access | Conformance |
|------|------------------------------------|-----------------------------|------------------|--------|-------------|
| 0x00 | UpdatePIN                          | client $\Rightarrow$ server | Y                | M T    | PM          |
| 0x01 | ResetPIN                           | client $\Rightarrow$ server | ResetPINResponse | A T    | PM          |
| 0x02 | ResetPINResponse                   | client $\Leftarrow$ server  | N                |        | PM          |
| 0x03 | Enable                             | client $\Rightarrow$ server | Y                | M T    | M           |
| 0x04 | Disable                            | client $\Rightarrow$ server | Y                | M T    | M           |
| 0x05 | AddBonusTime                       | client $\Rightarrow$ server | Y                | O      | ST          |
| 0x06 | SetScreenDailyTime                 | client $\Rightarrow$ server | Y                | M      | ST          |
| 0x07 | BlockUnratedContent                | client $\Rightarrow$ server | Y                | M      | BU          |
| 0x08 | UnblockUnratedContent              | client $\Rightarrow$ server | Y                | M      | BU          |
| 0x09 | SetOnDemandRatingThreshold         | client $\Rightarrow$ server | Y                | M      | OCR         |
| 0x0A | SetScheduledContentRatingThreshold | client $\Rightarrow$ server | Y                | M      | SCR         |
| 0x0B | AddBlockChannels                   | client $\Rightarrow$ server | Y                | M      | BC          |
| 0x0C | RemoveBlockChannels                | client $\Rightarrow$ server | Y                | M      | BC          |

Page 620







| ID   | Name                         | Direction                   | Response | Access | Conformance |
|------|------------------------------|-----------------------------|----------|--------|-------------|
| 0x0D | AddBlockApplications         | client $\Rightarrow$ server | Y        | M      | BA          |
| 0x0E | RemoveBlockApplications      | client $\Rightarrow$ server | Y        | M      | BA          |
| 0x0F | SetBlockContentTimeWindow    | client $\Rightarrow$ server | Y        | M      | BTW         |
| 0x10 | RemoveBlockContentTimeWindow | client $\Rightarrow$ server | Y        | M      | BTW         |

#### 6.13.8.1. UpdatePIN Command

The purpose of this command is to update the PIN used for protecting configuration of the content control settings. Upon success, the old PIN SHALL no longer work.

The PIN is used to ensure that only the Node (or User) with the PIN code can make changes to the Content Control settings, for example, turn off Content Controls or modify the ScreenDailyTime. The PIN is composed of a numeric string of up to 6 human readable characters (displayable) .

Upon receipt of this command, the media device SHALL check if the OldPIN field of this command is the same as the current PIN. If the PINs are the same, then the PIN code SHALL be set to NewPIN. Otherwise a response with InvalidPINCode error status SHALL be returned.

The media device MAY provide a default PIN to the User via an out of band mechanism. For security reasons, it is recommended that a client encourage the user to update the PIN from its default value when performing configuration of the Content Control settings exposed by this cluster. The ResetPIN command can also be used to obtain the default PIN.

| ID | Name   | Type   | Constraint | Quality | Fallback | Conformance |
|----|--------|--------|------------|---------|----------|-------------|
| 0  | OldPIN | string | max 6      |         |          | M           |
| 1  | NewPIN | string | max 6      |         |          | M           |

##### 6.13.8.1.1. OldPIN Field

This field SHALL specify the original PIN. Once the UpdatePIN command is performed successfully, it SHALL be invalid.

##### 6.13.8.1.2. NewPIN Field

This field SHALL indicate a new PIN for the Content Control feature.

#### 6.13.8.2. ResetPIN Command

The purpose of this command is to reset the PIN.



Page 621



If this command is executed successfully, a ResetPINResponse command with a new PIN SHALL be returned.

#### 6.13.8.3. ResetPINResponse Command

This command SHALL be generated in response to a ResetPIN command. The data for this command SHALL be as follows:

| ID | Name    | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------|--------|------------|---------|----------|-------------|
| 0  | PINCode | string | max 6      |         |          | M           |

##### 6.13.8.3.1. PINCode Field

This field SHALL indicate a new PIN of the Content Control feature.

#### 6.13.8.4. Enable Command

The purpose of this command is to turn on the Content Control feature on a media device.

Upon receipt of the Enable command, the media device SHALL set the Enabled attribute to TRUE.

#### 6.13.8.5. Disable Command

The purpose of this command is to turn off the Content Control feature on a media device.

On receipt of the Disable command, the media device SHALL set the Enabled attribute to FALSE.

#### 6.13.8.6. AddBonusTime Command

The purpose of this command is to add the extra screen time for the user.

If a client with Operate privilege invokes this command, the media device SHALL check whether the PINCode passed in the command matches the current PINCode value. If these match, then the RemainingScreenTime attribute SHALL be increased by the specified BonusTime value.

If the PINs do not match, then a response with InvalidPINCode error status SHALL be returned, and no changes SHALL be made to RemainingScreenTime.

If a client with Manage privilege or greater invokes this command, the media device SHALL ignore the PINCode field and directly increase the RemainingScreenTime attribute by the specified BonusTime value.

A server that does not support the PM feature SHALL respond with InvalidPINCode to clients that only have Operate privilege unless:

- It has been provided with the PIN value to expect via an out of band mechanism, and
- The client has provided a PINCode that matches the expected PIN value.

Page 622



| ID | Name      | Type      | Constraint | Quality | Fallback | Conformance |
|----|-----------|-----------|------------|---------|----------|-------------|
| 0  | PINCode   | string    | max 6      |         |          | O           |
| 1  | BonusTime | elapsed-s | desc       |         | 300s     | M           |

#### 6.13.8.6.1. PINCode Field

This field SHALL indicate the PIN.

This field SHALL be optional for clients with Manage or greater privilege but SHALL be mandatory for clients with Operate privilege. The PIN provided in this field SHALL be used to guarantee that a client with Operate permission is allowed to invoke this command only if the PIN passed in this command is equal to the current PIN value.

#### 6.13.8.6.2. BonusTime Field

This field SHALL indicate the amount of extra time (in seconds) to increase RemainingScreenTime. This field SHALL NOT exceed the remaining time of this day.

### 6.13.8.7. SetScreenDailyTime Command

The purpose of this command is to set the ScreenDailyTime attribute.

Upon receipt of the SetScreenDailyTime command, the media device SHALL set the ScreenDailyTime attribute to the ScreenTime value.

| ID | Name       | Type      | Constraint | Quality | Fallback | Conformance |
|----|------------|-----------|------------|---------|----------|-------------|
| 0  | ScreenTime | elapsed-s | max 86400  |         |          | M           |

#### 6.13.8.7.1. ScreenTime Field

This field SHALL indicate the time (in seconds) which the User is allowed to spend watching TV on this media device within one day.

### 6.13.8.8. BlockUnratedContent Command

The purpose of this command is to specify whether programs with no Content rating must be blocked by this media device.

Upon receipt of the BlockUnratedContent command, the media device SHALL set the BlockUnrated attribute to TRUE.

### 6.13.8.9. UnblockUnratedContent Command

The purpose of this command is to specify whether programs with no Content rating must be blocked by this media device.

Upon receipt of the UnblockUnratedContent command, the media device SHALL set the BlockUn-




Page 623



rated attribute to FALSE.

#### 6.13.8.10. SetOnDemandRatingThreshold Command

The purpose of this command is to set the OnDemandRatingThreshold attribute.

Upon receipt of the SetOnDemandRatingThreshold command, the media device SHALL check if the Rating field is one of values present in the OnDemandRatings attribute. If not, then a response with InvalidRating error status SHALL be returned.

| ID | Name          | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------------|--------|------------|---------|----------|-------------|
| 0  | <b>Rating</b> | string | max 8      |         |          | M           |

##### 6.13.8.10.1. Rating

This field indicates a threshold rating for filtering on-demand content. This field SHALL be set to one of the values present in the OnDemandRatings attribute

#### 6.13.8.11. SetScheduledContentRatingThreshold Command

The purpose of this command is to set ScheduledContentRatingThreshold attribute.

Upon receipt of the SetScheduledContentRatingThreshold command, the media device SHALL check if the Rating field is one of values present in the ScheduledContentRatings attribute. If not, then a response with InvalidRating error status SHALL be returned.

| ID | Name          | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------------|--------|------------|---------|----------|-------------|
| 0  | <b>Rating</b> | string | max 8      |         |          | M           |

##### 6.13.8.11.1. Rating

This field indicates a threshold rating for filtering scheduled content. This field SHALL be set to one of the values present in the ScheduledContentRatings attribute.

#### 6.13.8.12. AddBlockChannels command

The purpose of this command is to set BlockChannelList attribute.

Upon receipt of the AddBlockChannels command, the media device SHALL check if the channels passed in this command are valid. If the channel is invalid, then a response with InvalidChannel error Status SHALL be returned.

If there is at least one channel in Channels field which is not in the BlockChannelList attribute, the media device SHALL process the request by adding these new channels into the BlockChannelList attribute and return a successful Status Response. During this process, the media device SHALL assign one unique index to BlockChannelIndex field for every channel passed in this command.

If all channels in Channel field already exist in the BlockChannelList attribute, then a response with

Page 624



ChannelAlreadyExist error Status SHALL be returned.

| ID | Name            | Type                                       | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Channels</b> | list[ <a href="#">BlockChannelStruct</a> ] | all        |         |          | M           |

#### 6.13.8.12.1. Channels Field

This field indicates a set of channels that SHALL be blocked when the Content Control feature is activated. This field SHALL be set to values present in ChannelList attribute in the Channel cluster. The BlockChannelIndex field passed in this command SHALL be NULL.

#### 6.13.8.13. RemoveBlockChannels command

The purpose of this command is to remove channels from the BlockChannelList attribute.

Upon receipt of the RemoveBlockChannels command, the media device SHALL check if the channels indicated by ChannelIndexes passed in this command are present in BlockChannelList attribute. If one or more channels indicated by ChannelIndexes passed in this command field are not present in the BlockChannelList attribute, then a response with ChannelNotExist error Status SHALL be returned.

| ID | Name                  | Type         | Constraint | Quality | Fallback | Conformance |
|----|-----------------------|--------------|------------|---------|----------|-------------|
| 0  | <b>ChannelIndexes</b> | list[uint16] | all        |         |          | M           |

##### 6.13.8.13.1. ChannelIndexes Field

This field SHALL specify a set of indexes indicating Which channels SHALL be removed from the BlockChannelList attribute.

#### 6.13.8.14. AddBlockApplications Command

The purpose of this command is to set applications to the BlockApplicationList attribute.

Upon receipt of the AddBlockApplications command, the media device SHALL check if the Applications passed in this command are installed. If there is an application in Applications field which is not identified by media device, then a response with UnidentifiableApplication error Status MAY be returned.

If there is one or more applications which are not present in BlockApplicationList attribute, the media device SHALL process the request by adding the new application to the BlockApplicationList attribute and return a successful Status Response.

If all applications in Applications field are already present in BlockApplicationList attribute, then a response with ApplicationAlreadyExist error Status SHALL be returned.




Page 625



| ID | Name         | Type                | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------|------------|---------|----------|-------------|
| 0  | Applications | list[AppInfoStruct] | all        |         |          | M           |

#### 6.13.8.14.1. Applications Field

This field indicates a set of applications that SHALL be blocked when the Content Control feature is activated.

#### 6.13.8.15. RemoveBlockApplications Command

The purpose of this command is to remove applications from the BlockApplicationList attribute.

Upon receipt of the RemoveBlockApplications command, the media device SHALL check if the applications passed in this command present in the BlockApplicationList attribute. If one or more applications in Applications field which are not present in the BlockApplicationList attribute, then a response with ApplicationNotExist error Status SHALL be returned.

| ID | Name         | Type                | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------|------------|---------|----------|-------------|
| 0  | Applications | list[AppInfoStruct] | all        |         |          | M           |

#### 6.13.8.15.1. Applications Field

This field indicates a set of applications which SHALL be removed from BlockApplicationList attribute.

#### 6.13.8.16. SetBlockContentTimeWindow Command

The purpose of this command is to set the BlockContentTimeWindow attribute.

Upon receipt of the SetBlockContentTimeWindow command, the media device SHALL check if the TimeWindowIndex field passed in this command is NULL. If the TimeWindowIndex field is NULL, the media device SHALL check if there is an entry in the BlockContentTimeWindow attribute which matches with the TimePeriod and DayOfWeek fields passed in this command. \* If Yes, then a response with TimeWindowAlreadyExist error status SHALL be returned. \* If No, then the media device SHALL assign one unique index for this time window and add it into the BlockContentTimeWindow list attribute.

If the TimeWindowIndex field is not NULL and presents in the BlockContentTimeWindow attribute, the media device SHALL replace the original time window with the new time window passed in this command.

Page 626







| ID | Name       | Type             | Constraint | Quality | Fallback | Conformance |
|----|------------|------------------|------------|---------|----------|-------------|
| 0  | TimeWindow | TimeWindowStruct |            |         |          | M           |

#### 6.13.8.16.1. TimeWindow Field

This field SHALL indicate a time window requested to set to the BlockContentTimeWindow attribute.

#### 6.13.8.17. RemoveBlockContentTimeWindow Command

The purpose of this command is to remove the selected time windows from the BlockContentTimeWindow attribute.

Upon receipt of the RemoveBlockContentTimeWindow command, the media device SHALL check if the time window index passed in this command presents in the BlockContentTimeWindow attribute.

If one or more time window indexes passed in this command are not present in BlockContentTimeWindow attribute, then a response with TimeWindowNotExist error status SHALL be returned.

| ID | Name              | Type         | Constraint | Quality | Fallback | Conformance |
|----|-------------------|--------------|------------|---------|----------|-------------|
| 0  | TimeWindowIndexes | list[uint16] |            |         |          | M           |

##### 6.13.8.17.1. TimeWindowIndexes Field

This field SHALL specify a set of time window indexes indicating which time windows will be removed from the BlockContentTimeWindow attribute.

### 6.13.9. Events

| ID   | Name                           | Priority | Access | Conformance |
|------|--------------------------------|----------|--------|-------------|
| 0x00 | RemainingScreenTimeExpired     | INFO     | V      | ST          |
| 0x01 | EnteringBlockContentTimeWindow | INFO     | V      | BTW         |

#### 6.13.9.1. RemainingScreenTimeExpired Event

This event SHALL be generated when the RemainingScreenTime equals 0.




Page 627



**6.13.9.2. EnteringBlockContentTimeWindow Event**

This event SHALL be generated when entering a period of blocked content as configured in the BlockContentTimeWindow attribute.

Page 628







# Chapter 7. Robots

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter.

## 7.1. General Description

### 7.1.1. Introduction

The clusters specified in this section define the operation of robotic devices, such as Robotic Vacuum Cleaners (RVCs).

### 7.1.2. Cluster List

This section lists the RVC specific clusters as specified in this chapter.

*Table 12. Overview of the RVC Clusters*

| Cluster ID | Cluster Name                          | Description                                                                                    |
|------------|---------------------------------------|------------------------------------------------------------------------------------------------|
| 0x0054     | <a href="#">RVC Run Mode</a>          | Commands and attributes for controlling the running mode of an RVC device.                     |
| 0x0055     | <a href="#">RVC Clean Mode</a>        | Commands and attributes for controlling the cleaning mode of an RVC device.                    |
| 0x0061     | <a href="#">RVC Operational State</a> | Commands and attributes for monitoring and controlling the operational state of an RVC device. |

## 7.2. RVC Run Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for the running modes of robotic vacuum cleaner devices.

### 7.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |



Page 629



| Revision | Description                                                                                                                                                                                                                                   |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2        | Add constraint about switching from non-Idle to non-Idle modes. ChangeToModeResponse command: StatusText must be provided for InvalidInMode status. Deprecate the OnMode attribute and the related feature map bit. Add the Mapping mode tag. |
| 3        | Remove constraint on changing cleaning modes while the RVC Run Mode cluster is in a non-Idle mode. Continue to allow InvalidInMode response for devices that do not support such mode changes.                                                |
| 4        | DirectModeChange made non-provisional                                                                                                                                                                                                         |

### 7.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | RVCRUNM   |

### 7.2.3. Cluster ID

| ID     | Name         |
|--------|--------------|
| 0x0054 | RVC Run Mode |

### 7.2.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code         | Feature          | Conformance | Summary                                                  |
|-----|--------------|------------------|-------------|----------------------------------------------------------|
| 0   | DEPONOFF     | OnOff            | X           | Dependency with the OnOff cluster                        |
| 20  | DIRECTMODECH | DirectModeChange | 0           | Cluster supports changing run modes from non-Idle states |

#### 7.2.4.1. DirectModeChange Feature

This feature indicates whether the cluster implementation supports changing the run modes while the RVC Run Mode cluster's CurrentMode attribute is set to a mode without the Idle mode tag. If the implementation does not support such a change, the ChangeToModeResponse command SHALL have the StatusCode field set to the InvalidInMode value.

Page 630







## 7.2.5. Data Types

### 7.2.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

### 7.2.6. Attributes

The table below lists the changes relative to the Mode Base cluster for the attributes. A blank field indicates no change.

| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        |             |
| 0x0001 | CurrentMode    |      |            |         |          |        |             |
| 0x0002 | StartUpMode    |      |            |         |          |        | X           |
| 0x0003 | OnMode         |      |            |         |          |        | X           |

#### 7.2.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Idle mode tag in the ModeTags field.

At least one entry in the SupportedModes attribute (different from the one above) SHALL include the Cleaning mode tag in the ModeTags field.

The Mapping, Cleaning, and Idle mode tags are mutually exclusive and SHALL NOT be used together in a mode's ModeTags.

## 7.2.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

### 7.2.7.1. ChangeToModeResponse Command Namespace Definitions

The following table defines the derived cluster specific StatusCode values.




Page 631



| Status Code Value | Name                  |
|-------------------|-----------------------|
| 0x41              | Stuck                 |
| 0x42              | DustBinMissing        |
| 0x43              | DustBinFull           |
| 0x44              | WaterTankEmpty        |
| 0x45              | WaterTankMissing      |
| 0x46              | WaterTankLidOpen      |
| 0x47              | MopCleaningPadMissing |
| 0x48              | BatteryLow            |

### 7.2.7.2. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name      |
|----------------|-----------|
| 0x0000         | Auto      |
| 0x0001         | Quick     |
| 0x0002         | Quiet     |
| 0x0003         | LowNoise  |
| 0x0004         | LowEnergy |
| 0x0005         | Vacation  |
| 0x0006         | Min       |
| 0x0007         | Max       |
| 0x0008         | Night     |
| 0x0009         | Day       |
| 0x4000         | Idle      |
| 0x4001         | Cleaning  |
| 0x4002         | Mapping   |

#### 7.2.7.2.1. Idle Tag

The device is not performing any of the main operations of the other modes. However, auxiliary actions, such as seeking the charger or charging, may occur.

For example, the device has completed cleaning, successfully or not, on its own or due to a command, or has not been asked to clean after a restart.

#### 7.2.7.2.2. Cleaning Tag

The device was asked to clean so it may be actively running, or paused due to an error, due to a pause command, or for recharging etc. If currently paused and the device can resume it will con-

Page 632



continue to clean.

#### 7.2.7.2.3. Mapping Tag

The device was asked to create a map of the space it is located in, so it may be actively running, or paused due to an error, due to a pause command, or for recharging etc. If currently paused and the device can resume, it will continue to map.

|             |                                                                                                                                                                                                                         |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | this mode is intended to be used so the current space can be mapped by the device if the robot has not previously done that, or if the layout has substantially changed, for an optimal subsequent cleaning experience. |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

### 7.2.8. Mode Use

If the DirectModeChange feature is not present:

- Clients SHALL start a cleaning cycle by switching from a mode with the Idle mode tag to a mode with the Cleaning mode tag.
- Clients SHALL stop a cleaning cycle by switching from a mode with the Cleaning mode tag to a mode with the Idle mode tag.
- Clients SHALL start a mapping cycle by switching from a mode with the Idle mode tag to a mode with the Mapping mode tag.
- Clients SHALL stop a mapping cycle by switching from a mode with the Mapping mode tag to a mode with the Idle mode tag.

If the DirectModeChange feature is present, clients MAY change between run modes without needing to set an Idle mode first.

The RVC Run Mode cluster's SupportedModes attribute MAY include multiple modes with the Cleaning mode tag, and/or modes with the Mapping mode tag.

### 7.2.9. Mode Change Restrictions

The server MAY refuse attempts to switch the RVC Run Mode from a mode without the Idle mode tag to another non-Idle mode, as indicated by the DirectModeChange feature.

## 7.3. RVC Clean Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and namespaced enumerated values for the cleaning type of robotic vacuum cleaner devices.

### 7.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.



Page 633



| Revision | Description                                                                                                                                                                                                                                            |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                                                                                                                                                                       |
| 2        | Add constraint about changing cleaning modes while the RVC Run Mode cluster is in a non-Idle mode. ChangeToModeResponse command: StatusText must be provided for InvalidInMode status. Deprecate the OnMode attribute and the related feature map bit. |
| 3        | Remove constraint on changing cleaning modes while the RVC Run Mode cluster is in a non-Idle mode. Continue to allow InvalidInMode response for devices that do not support such mode changes.                                                         |
| 4        | Add Vacuum then Mop cleaning mode                                                                                                                                                                                                                      |
| 5        | DirectModeChange made non-provisional                                                                                                                                                                                                                  |

### 7.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | RVCCLEANM |

### 7.3.3. Cluster ID

| ID     | Name           |
|--------|----------------|
| 0x0055 | RVC Clean Mode |

### 7.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code         | Feature          | Conformance | Summary                                                    |
|-----|--------------|------------------|-------------|------------------------------------------------------------|
| 0   | DEPONOFF     | OnOff            | X           | Dependency with the OnOff cluster                          |
| 20  | DIRECTMODECH | DirectModeChange | 0           | Cluster supports changing clean modes from non-Idle states |

#### 7.3.4.1. DirectModeChange Feature

This feature indicates whether the cluster implementation supports changing the clean modes while the RVC Run Mode cluster's CurrentMode attribute is set to a mode without the Idle mode tag. If the implementation does not support such a change, the ChangeToModeResponse command SHALL have the StatusCode field set to the InvalidInMode value.

Page 634






### 7.3.5. Data Types

#### 7.3.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

#### 7.3.6. Attributes

The table below lists the changes relative to the Mode Base cluster for the attributes. A blank field indicates no change.

| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        |             |
| 0x0001 | CurrentMode    |      |            |         |          |        |             |
| 0x0002 | StartUpMode    |      |            |         |          |        | X           |
| 0x0003 | OnMode         |      |            |         |          |        | X           |

##### 7.3.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Vacuum and/or the Mop mode tag in the ModeTags field list.

### 7.3.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

#### 7.3.7.1. ChangeToModeResponse Command Namespace Definitions

The following table defines the derived cluster specific StatusCode values.

| Status Code Value | Name               |
|-------------------|--------------------|
| 0x40              | CleaningInProgress |




Page 635



### 7.3.7.2. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name            |
|----------------|-----------------|
| 0x0000         | Auto            |
| 0x0001         | Quick           |
| 0x0002         | Quiet           |
| 0x0003         | LowNoise        |
| 0x0004         | LowEnergy       |
| 0x0005         | Vacation        |
| 0x0006         | Min             |
| 0x0007         | Max             |
| 0x0008         | Night           |
| 0x0009         | Day             |
| 0x4000         | DeepClean       |
| 0x4001         | Vacuum          |
| 0x4002         | Mop             |
| 0x4003         | Vacuum then Mop |

#### 7.3.7.2.1. Deep Clean Tag

While in this mode, the device is optimizing for improved cleaning.

#### 7.3.7.2.2. Vacuum Tag

The device's vacuuming feature is enabled in this mode.

#### 7.3.7.2.3. Mop Tag

The device's mopping feature is enabled in this mode.

#### 7.3.7.2.4. Vacuum then Mop Tag

The device will vacuum then mop the relevant areas in this mode.

## 7.3.8. Mode Change Restrictions

The server MAY refuse attempts to switch the RVC Run Mode from a mode without the Idle mode tag to another non-Idle mode, as indicated by the DirectModeChange feature.

## 7.3.9. Mode Examples

A few examples of modes and their mode tags are provided below.

Page 636



For the "Turbo, Vacuum Only" mode, tags: 0x4000 (Deep Clean), 0x4001 (Vacuum).

For the "Mop Only" mode, tags: 0x4002 (Mop), 0x0003 (Low Noise).

For the "Rapid Vacuum and Mop" mode, tags: 0x0001 (Quick), 0x4001 (Vacuum), 0x4002 (Mop).

Note that the "Low Noise" and "Quick" mode tags are defined in the generic Mode Base cluster specification.

## 7.4. RVC Operational State Cluster

This cluster is derived from the Operational State cluster and provides an interface for monitoring the operational state of a robotic vacuum cleaner.

### 7.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                                       |
|----------|-----------------------------------------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                                                  |
| 2        | The Pause and Resume commands are usable in all compatible states. Deprecate the Start and Stop commands. Add the GoHome command. |
| 3        | Add several operational states and errors                                                                                         |

### 7.4.2. Classification

| Hierarchy         | Role        | Scope    | PICS Code  |
|-------------------|-------------|----------|------------|
| Operational State | Application | Endpoint | RVCOPSTATE |

### 7.4.3. Cluster ID

| ID     | Name                  |
|--------|-----------------------|
| 0x0061 | RVC Operational State |

### 7.4.4. Data Types

#### 7.4.4.1. OperationalStateEnum Type

This data type is derived from enum8.

The values defined herein are applicable to this derived cluster of Operational State only and are additional to the set of values defined in Operational State itself.




Page 637



| Value | Name                    | Summary                                                                                                | Conformance |
|-------|-------------------------|--------------------------------------------------------------------------------------------------------|-------------|
| 0x00  | <b>Stopped</b>          | The device is stopped                                                                                  | M           |
| 0x01  | <b>Running</b>          | The device is operating                                                                                | M           |
| 0x02  | <b>Paused</b>           | The device is paused during an operation                                                               | M           |
| 0x03  | <b>Error</b>            | The device is in an error state                                                                        | M           |
| 0x40  | <b>SeekingCharger</b>   | The device is en route to the charging dock                                                            | M           |
| 0x41  | <b>Charging</b>         | The device is charging                                                                                 | M           |
| 0x42  | <b>Docked</b>           | The device is on the dock, not charging                                                                | M           |
| 0x43  | <b>EmptyingDustBin</b>  | The device is automatically emptying its own dust bin, such as to a dock                               | O           |
| 0x44  | <b>CleaningMop</b>      | The device is automatically cleaning its own mopping device, such as on a dock                         | O           |
| 0x45  | <b>FillingWaterTank</b> | The device is automatically filling its own clean water tank for use when mopping, such as from a dock | O           |
| 0x46  | <b>UpdatingMaps</b>     | The device is processing acquired data to update its maps                                              | O           |

[RVC Pause Compatibility](#) defines the compatibility of the states this cluster defines with the Pause command.

*Table 13. RVC Pause Compatibility*

| State Value | State Name              | Pause-Compatible | Notes |
|-------------|-------------------------|------------------|-------|
| 0x40        | <b>SeekingCharger</b>   | Y                |       |
| 0x41        | <b>Charging</b>         | N                |       |
| 0x42        | <b>Docked</b>           | N                |       |
| 0x43        | <b>EmptyingDustBin</b>  | N                |       |
| 0x44        | <b>CleaningMop</b>      | N                |       |
| 0x45        | <b>FillingWaterTank</b> | N                |       |

Page 638



| State Value | State Name   | Pause-Compatible | Notes |
|-------------|--------------|------------------|-------|
| 0x46        | UpdatingMaps | N                |       |

[RVC Resume Compatibility](#) defines the compatibility of the states this cluster defines with the Resume command.

*Table 14. RVC Resume Compatibility*

| State Value | State Name       | Resume-Compatible | Notes |
|-------------|------------------|-------------------|-------|
| 0x40        | SeekingCharger   | N                 |       |
| 0x41        | Charging         | Y                 |       |
| 0x42        | Docked           | Y                 |       |
| 0x43        | EmptyingDustBin  | N                 |       |
| 0x44        | CleaningMop      | N                 |       |
| 0x45        | FillingWaterTank | N                 |       |
| 0x46        | UpdatingMaps     | N                 |       |

While in the Charging or Docked states, the device SHALL NOT attempt to resume unless it transitioned to those states while operating and can resume, such as, for example, if it is recharging while in a cleaning cycle. Else, if the operational state is Charging or Docked but there's no operation to resume or the operation can't be resumed, the device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of CommandInvalidInState but take no further action.

#### 7.4.4.2. ErrorStateEnum Type

This data type is derived from enum8.

The values defined herein are applicable to this derived cluster of Operational State only and are additional to the set of values defined in Operational State itself.

| Value | Name                      | Summary                                                    | Conformance |
|-------|---------------------------|------------------------------------------------------------|-------------|
| 0x00  | NoError                   | The device is not in an error state                        | M           |
| 0x01  | UnableToStartOrResume     | The device is unable to start or resume operation          | M           |
| 0x02  | UnableToCompleteOperation | The device was unable to complete the current operation    | M           |
| 0x03  | CommandInvalidInState     | The device cannot process the command in its current state | M           |




Page 639



| Value | Name                            | Summary                                                                                                                                                                                                                                                      | Conformance |
|-------|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0x40  | <b>FailedToFindChargingDock</b> | The device has failed to find or reach the charging dock                                                                                                                                                                                                     | M           |
| 0x41  | <b>Stuck</b>                    | The device is stuck and requires manual intervention                                                                                                                                                                                                         | M           |
| 0x42  | <b>DustBinMissing</b>           | The device has detected that its dust bin is missing                                                                                                                                                                                                         | M           |
| 0x43  | <b>DustBinFull</b>              | The device has detected that its dust bin is full                                                                                                                                                                                                            | M           |
| 0x44  | <b>WaterTankEmpty</b>           | The device has detected that its clean water tank is empty                                                                                                                                                                                                   | M           |
| 0x45  | <b>WaterTankMissing</b>         | The device has detected that its clean water tank is missing                                                                                                                                                                                                 | M           |
| 0x46  | <b>WaterTankLidOpen</b>         | The device has detected that its water tank lid is open                                                                                                                                                                                                      | M           |
| 0x47  | <b>MopCleaningPadMissing</b>    | The device has detected that its cleaning pad is missing                                                                                                                                                                                                     | M           |
| 0x48  | <b>LowBattery</b>               | The device is unable to start or to continue operating due to a low battery                                                                                                                                                                                  | M           |
| 0x49  | <b>CannotReachTargetArea</b>    | The device is unable to move to an area where it was asked to operate, such as by setting the ServiceArea cluster's SelectedAreas attribute, due to an obstruction. For example, the obstruction might be a closed door or objects blocking the mapped path. | M           |
| 0x4A  | <b>DirtyWaterTankFull</b>       | The device has detected that its dirty water tank is full                                                                                                                                                                                                    | M           |

Page 640







| Value | Name                            | Summary                                                                                                                 | Conformance |
|-------|---------------------------------|-------------------------------------------------------------------------------------------------------------------------|-------------|
| 0x4B  | <b>DirtyWaterTankMissing</b>    | The device has detected that its dirty water tank is missing                                                            | M           |
| 0x4C  | <b>WheelsJammed</b>             | The device has detected that one or more wheels are jammed by an object                                                 | M           |
| 0x4D  | <b>BrushJammed</b>              | The device has detected that its brush is jammed by an object                                                           | M           |
| 0x4E  | <b>NavigationSensorObscured</b> | The device has detected that one of its sensors, such as LiDAR, infrared, or camera is obscured and needs to be cleaned | M           |

#### 7.4.5. Commands

The table below lists the changes relative to the Operational State cluster for the commands. A blank field indicates no change.

| ID   | Name                              | Direction                   | Response                   | Access | Conformance |
|------|-----------------------------------|-----------------------------|----------------------------|--------|-------------|
| 0x00 | <b>Pause</b>                      |                             |                            |        |             |
| 0x01 | <b>Stop</b>                       |                             |                            |        | X           |
| 0x02 | <b>Start</b>                      |                             |                            |        | X           |
| 0x03 | <b>Resume</b>                     |                             |                            |        |             |
| 0x04 | <b>OperationalCommandResponse</b> |                             |                            |        |             |
| 0x80 | <b>GoHome</b>                     | client $\Rightarrow$ server | OperationalCommandResponse | O      | O           |

##### 7.4.5.1. GoHome Command

On receipt of this command, the device SHALL start seeking the charging dock, if possible in the current state of the device.

If this command is received when already in the SeekingCharger state the device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of NoError but the command SHALL have no other effect.



Page 641



A device that receives this command in any state which does not allow seeking the charger, such as Charging or Docked, SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of CommandInvalidInState and SHALL have no other effect.

Otherwise, on success:

- The OperationalState attribute SHALL be set to SeekingCharger.
- The device SHALL respond with an [OperationalCommandResponse](#) command with an ErrorStateID of NoError.
- After the device reaches the dock and completes its docking activities, the RVC Run Mode cluster's CurrentMode attribute SHALL be set to an Idle mode.

Page 642







# Chapter 8. Home Appliances

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter.

## 8.1. General Description

### 8.1.1. Introduction

The clusters specified in this section are typically used in control of home appliances, such as laundry washers, refrigerators etc.

### 8.1.2. Cluster List

This section lists the home appliance specific clusters as specified in this chapter.

*Table 15. Overview of the Home Appliance Clusters*

| Cluster ID                        | Cluster Name                            | Description                                                                              |
|-----------------------------------|-----------------------------------------|------------------------------------------------------------------------------------------|
| <b>Common Clusters</b>            |                                         |                                                                                          |
| 0x0056                            | <a href="#">Temperature Control</a>     | Commands and attributes for control of a temperature set point                           |
| <b>Dishwasher Clusters</b>        |                                         |                                                                                          |
| 0x0059                            | <a href="#">Dishwasher Mode</a>         | Commands and attributes for controlling a dishwasher                                     |
| 0x005D                            | <a href="#">Dishwasher Alarm</a>        | Alarm definitions for Dishwasher devices                                                 |
| <b>Laundry Clusters (General)</b> |                                         |                                                                                          |
| 0x0051                            | <a href="#">Laundry Washer Mode</a>     | Commands and attributes for controlling a laundry washer or dryer                        |
| <b>Laundry Dryer Clusters</b>     |                                         |                                                                                          |
| 0x004A                            | <a href="#">Laundry Dryer Controls</a>  | Commands and attributes for the control of options on a device that does laundry drying  |
| <b>Laundry Washer Clusters</b>    |                                         |                                                                                          |
| 0x0053                            | <a href="#">Laundry Washer Controls</a> | Commands and attributes for the control of options on a device that does laundry washing |
| <b>Microwave Oven Clusters</b>    |                                         |                                                                                          |




Page 643



| Cluster ID                   | Cluster Name                                                         | Description                                                                                |
|------------------------------|----------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| 0x005E                       | <a href="#">Microwave Oven Mode</a>                                  | Modes associated with a Microwave Oven                                                     |
| 0x005F                       | <a href="#">Microwave Oven Control</a>                               | Commands and attributes for controlling a Microwave Oven                                   |
| <b>Oven Clusters</b>         |                                                                      |                                                                                            |
| 0x0048                       | <a href="#">Oven Operational State</a>                               | Operational states and phases associated with an Oven                                      |
| 0x0049                       | <a href="#">Oven Mode</a>                                            | Modes associated with an Oven                                                              |
| <b>Refrigerator Clusters</b> |                                                                      |                                                                                            |
| 0x0052                       | <a href="#">Refrigerator And Temperature Controlled Cabinet Mode</a> | Commands and attributes for controlling a refrigerator or a temperature controlled cabinet |
| 0x0057                       | <a href="#">Refrigerator Alarm</a>                                   | Alarm definitions for Refrigerator devices                                                 |

## 8.2. Temperature Control Cluster

This cluster provides an interface to the setpoint temperature on devices such as washers, refrigerators, and water heaters. The setpoint temperature is the temperature to which a device using this cluster would attempt to control to. This cluster does not provide access to the actual or physical temperature associated with any device using this cluster. Access to the physical temperature associated with a device using this cluster would be provided by other clusters as part of that devices device type definition.

The values and constraints of the attributes communicated to clients SHOULD match the controls on any physical interface on a device implementing this server. For example, the value of the Step attribute SHOULD match the incremental value by which the temperature setpoint can be changed on the physical device.

### 8.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 8.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | TCTL      |

Page 644



### 8.2.3. Cluster ID

| ID     | Name                |
|--------|---------------------|
| 0x0056 | Temperature Control |

### 8.2.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature           | Conformance | Summary                                   |
|-----|------|-------------------|-------------|-------------------------------------------|
| 0   | TN   | TemperatureNumber | O.a         | Use actual temperature numbers            |
| 1   | TL   | TemperatureLevel  | O.a         | Use temperature levels                    |
| 2   | STEP | TemperatureStep   | [TN]        | Use step control with temperature numbers |

#### 8.2.4.1. TemperatureNumber Feature

For devices that use an actual temperature value for the temperature setpoint, such as some water heaters, the feature TN SHALL be used. Note that this cluster provides and supports temperatures in degrees Celsius via the **temperature** data type.

#### 8.2.4.2. TemperatureLevel Feature

For devices that use vendor-specific temperature levels for the temperature setpoint, such as some washers, the feature TL SHALL be used.

#### 8.2.4.3. TemperatureStep Feature

For devices that support discrete temperature setpoints that are larger than the temperature resolution imposed via the **temperature** data type, the Step feature MAY be used.

### 8.2.5. Attributes

| ID     | Name                | Type        | Constraint                       | Quality | Fallback | Access | Conformance |
|--------|---------------------|-------------|----------------------------------|---------|----------|--------|-------------|
| 0x0000 | TemperatureSetpoint | temperature | MinTemperature to MaxTemperature |         |          | R V    | TN          |
| 0x0001 | MinTemperature      | temperature | max (MaxTemperature - 1)         | F       |          | R V    | TN          |




Page 645



| ID     | Name                              | Type         | Constraint                             | Quality | Fallback | Access | Conformance |
|--------|-----------------------------------|--------------|----------------------------------------|---------|----------|--------|-------------|
| 0x0002 | <b>MaxTemperature</b>             | temperature  | desc                                   | F       |          | R V    | TN          |
| 0x0003 | <b>Step</b>                       | temperature  | 1 to (MaxTemperature - MinTemperature) | F       |          | R V    | STEP        |
| 0x0004 | <b>SelectedTemperatureLevel</b>   | uint8        | max 31                                 |         |          | R V    | TL          |
| 0x0005 | <b>SupportedTemperatureLevels</b> | list[string] | max 32[max 16]                         |         |          | R V    | TL          |

**NOTE**

See the `temperature` data type, in the data model, for encoding units. The scalar values are uint16 counts of 0.01C. For example, MinTemperature of -1800 is -18.00C.

**8.2.5.1. TemperatureSetpoint Attribute**

This attribute SHALL represent the desired Temperature Setpoint on the device.

**8.2.5.2. MinTemperature Attribute**

This attribute SHALL represent the minimum temperature to which the TemperatureSetpoint attribute MAY be set.

**8.2.5.3. MaxTemperature Attribute**

This attribute SHALL represent the maximum temperature to which the TemperatureSetpoint attribute MAY be set.

If the Step attribute is supported, this attribute SHALL be such that  $\text{MaxTemperature} = \text{MinTemperature} + (\text{Step} * n)$ , where  $n$  is an integer and  $n > 0$ . If the Step attribute is not supported, this attribute SHALL be such that  $\text{MaxTemperature} > \text{MinTemperature}$ .

**8.2.5.4. Step Attribute**

This attribute SHALL represent the discrete value by which the TemperatureSetpoint attribute can be changed via the SetTemperature command.

For example, if the value of MinTemperature is 25.00C (2500) and the Step value is 0.50C (50), valid values of the TargetTemperature field of the SetTemperature command would be 25.50C

Page 646







(2550), 26.00C (2600), 26.50C (2650), etc.

#### 8.2.5.5. SelectedTemperatureLevel Attribute

This attribute SHALL represent the currently selected temperature level setting of the server. This attribute SHALL be the positional index of the list item in the SupportedTemperatureLevels list that represents the currently selected temperature level setting of the server.

#### 8.2.5.6. SupportedTemperatureLevels Attribute

This attribute SHALL represent the list of supported temperature level settings that may be selected via the TargetTemperatureLevel field in the SetTemperature command. Each string is readable text that describes each temperature level setting in a way that can be easily understood by humans. For example, a washing machine can have temperature levels like "Cold", "Warm", and "Hot". Each string is specified by the manufacturer.

Each item in this list SHALL represent a unique temperature level. Each entry in this list SHALL have a unique value. The entries in this list SHALL appear in order of increasing temperature level with list item 0 being the setting with the lowest temperature level.

### 8.2.6. Commands

| ID   | Name           | Direction                   | Response | Access | Conformance |
|------|----------------|-----------------------------|----------|--------|-------------|
| 0x00 | SetTemperature | client $\Rightarrow$ server | Y        | O      | M           |

#### 8.2.6.1. SetTemperature Command

This command is used to set the temperature setpoint.

| ID | Name                   | Type        | Constraint | Quality | Fallback | Conformance |
|----|------------------------|-------------|------------|---------|----------|-------------|
| 0  | TargetTemperature      | temperature | desc       |         |          | TN          |
| 1  | TargetTemperatureLevel | uint8       | desc       |         |          | TL          |

##### 8.2.6.1.1. TargetTemperature Field

This field SHALL specify the desired temperature setpoint that the server is to be set to.

The TargetTemperature SHALL be from MinTemperature to MaxTemperature inclusive. If the Step attribute is supported, TargetTemperature SHALL be such that  $(\text{TargetTemperature} - \text{MinTemperature}) \% \text{Step} == 0$ .




Page 647



### 8.2.6.1.2. TargetTemperatureLevel Field

This field SHALL specify the index of the list item in the SupportedTemperatureLevels list that represents the desired temperature level setting of the server. The value of this field SHALL be between 0 and the length of the SupportedTemperatureLevels list -1.

#### 8.2.6.1.3. Effect on Receipt

If the TargetTemperature or TargetTemperatureLevel fields of the command meet all constraints but the server is unable to execute the command at the time the command is received by the server (e.g. due to the design of a device it cannot accept a change in its temperature setting after it has begun operation), then the server SHALL respond with a status code of INVALID\_IN\_STATE, and discard the command.

If the TN feature is supported, on receipt of this command:

- If the STEP feature is supported and the TargetTemperature field does not meet the equality  $(\text{TargetTemperature} - \text{MinTemperature}) \% \text{Step} == 0$ , then the server SHALL respond with a status code of CONSTRAINT\_ERROR, and the value of the TemperatureSetpoint attribute SHALL remain unchanged.
- Otherwise, the server SHALL set the TemperatureSetpoint attribute to the value of the TargetTemperature field and the response SHALL have a status code of SUCCESS.

If the TL feature is supported, on receipt of this command,

- If value of the TargetTemperatureLevel field meets all constraints, the server SHALL set its SelectedTemperatureLevel attribute to the value of TargetTemperatureLevel field and respond with status SUCCESS.
- Otherwise (e.g. if the value of the TargetTemperatureLevel field is out of bounds of the SupportedTemperatureLevels list), the status of the response SHALL be CONSTRAINT\_ERROR, and the value of SelectedTemperatureLevel SHALL remain unchanged.

## 8.3. Dishwasher Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for dishwasher devices.

### 8.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                        |
|----------|------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                   |
| 2        | ChangeToModeResponse command: StatusText must be provided for InvalidInMode status |

Page 648



| Revision | Description                                                                                                                            |
|----------|----------------------------------------------------------------------------------------------------------------------------------------|
| 3        | Set OnOff feature as disallowed (previously a Device Type override), Set StartUpMode and OnMode as disallowed (previously provisional) |

### 8.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | DISHM     |

### 8.3.3. Cluster ID

| ID     | Name            |
|--------|-----------------|
| 0x0059 | Dishwasher Mode |

### 8.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

### 8.3.5. Data Types

#### 8.3.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

### 8.3.6. Attributes

| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        | M           |




Page 649



| ID     | Name         | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------|------|------------|---------|----------|--------|-------------|
| 0x0001 | Current-Mode |      |            |         |          |        | M           |
| 0x0002 | StartUp-Mode |      |            |         |          |        | X           |
| 0x0003 | OnMode       |      |            |         |          |        | X           |

### 8.3.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Normal mode tag in the ModeTags field list.

## 8.3.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

### 8.3.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name      |
|----------------|-----------|
| 0x0000         | Auto      |
| 0x0001         | Quick     |
| 0x0002         | Quiet     |
| 0x0003         | LowNoise  |
| 0x0004         | LowEnergy |
| 0x0005         | Vacation  |
| 0x0006         | Min       |
| 0x0007         | Max       |
| 0x0008         | Night     |
| 0x0009         | Day       |
| 0x4000         | Normal    |
| 0x4001         | Heavy     |
| 0x4002         | Light     |

#### 8.3.7.1.1. Normal Tag

The normal regime of operation.

#### 8.3.7.1.2. Heavy Tag

Mode optimized for washing heavily-soiled dishes.

Page 650



**8.3.7.1.3. Light Tag**

Mode optimized for light washing.

## 8.4. Dishwasher Alarm Cluster

This cluster is a derived cluster of the Alarm Base cluster and provides the alarm definition related to dishwasher devices.

### 8.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 8.4.2. Classification

| Hierarchy  | Role        | Scope    | PICS Code |
|------------|-------------|----------|-----------|
| Alarm Base | Application | Endpoint | DISHALM   |

### 8.4.3. Cluster ID

| ID     | Name             |
|--------|------------------|
| 0x005D | Dishwasher Alarm |

### 8.4.4. Data Types

#### 8.4.4.1. AlarmBitmap Type

This data type is derived from map32.

| Bit | Name               | Summary                            | Conformance         |
|-----|--------------------|------------------------------------|---------------------|
| 0   | <b>InflowError</b> | Water inflow is abnormal           | P, O.a <sup>+</sup> |
| 1   | <b>DrainError</b>  | Water draining is abnormal         | P, O.a <sup>+</sup> |
| 2   | <b>DoorError</b>   | Door or door lock is abnormal      | O.a <sup>+</sup>    |
| 3   | <b>TempTooLow</b>  | Unable to reach normal temperature | P, O.a <sup>+</sup> |
| 4   | <b>TempTooHigh</b> | Temperature is too high            | P, O.a <sup>+</sup> |



Page 651



| Bit | Name            | Summary                 | Conformance |
|-----|-----------------|-------------------------|-------------|
| 5   | WaterLevelError | Water level is abnormal | P, O.a+     |

## 8.5. Laundry Washer Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for laundry washer as well as laundry dryer devices.

### 8.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                  |
|----------|----------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                             |
| 2        | ChangeToModeResponse command: StatusText must be provided for InvalidInMode status           |
| 3        | Set OnOff feature, StartUpMode, and OnMode as disallowed (previously a Device Type override) |

### 8.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | LWM       |

### 8.5.3. Cluster ID

| ID     | Name                |
|--------|---------------------|
| 0x0051 | Laundry Washer Mode |

### 8.5.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

### 8.5.5. Data Types

#### 8.5.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOption-

Page 652



Struct type. A blank field indicates no change.

| ID | Name            | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|------|------------|---------|----------|--------|-------------|
| 0  | <b>Label</b>    |      |            |         |          |        | M           |
| 1  | <b>Mode</b>     |      |            |         |          |        | M           |
| 2  | <b>ModeTags</b> |      | 1 to 8     |         |          |        | M           |

## 8.5.6. Attributes

| ID     | Name                  | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>SupportedModes</b> |      |            |         |          |        | M           |
| 0x0001 | <b>CurrentMode</b>    |      |            |         |          |        | M           |
| 0x0002 | <b>StartUpMode</b>    |      |            |         |          |        | X           |
| 0x0003 | <b>OnMode</b>         |      |            |         |          |        | X           |

### 8.5.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Normal mode tag in the ModeTags field list.

## 8.5.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

### 8.5.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name             |
|----------------|------------------|
| 0x0000         | <b>Auto</b>      |
| 0x0001         | <b>Quick</b>     |
| 0x0002         | <b>Quiet</b>     |
| 0x0003         | <b>LowNoise</b>  |
| 0x0004         | <b>LowEnergy</b> |
| 0x0005         | <b>Vacation</b>  |
| 0x0006         | <b>Min</b>       |
| 0x0007         | <b>Max</b>       |




Page 653



| Mode Tag Value | Name     |
|----------------|----------|
| 0x0008         | Night    |
| 0x0009         | Day      |
| 0x4000         | Normal   |
| 0x4001         | Delicate |
| 0x4002         | Heavy    |
| 0x4003         | Whites   |

#### 8.5.7.1.1. Normal Tag

The normal regime of operation.

#### 8.5.7.1.2. Delicate Tag

Mode optimized for washing delicate garments.

#### 8.5.7.1.3. Heavy Tag

Mode optimized for heavy washing.

#### 8.5.7.1.4. Whites Tag

Mode optimized for stain removal on white fabrics.

### 8.5.8. Mode Examples

A few examples of Laundry modes and their mode tags are provided below.

- For the "Heavy Wash, Whites" mode, tags: 0x4002 (Heavy), 0x4003 (Whites).
- For the "Fast" mode, tags: 0x0001 (Quick), 0x4000 (Normal).

## 8.6. Laundry Washer Controls Cluster

This cluster provides a way to access options associated with the operation of a laundry washer device type.

### 8.6.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                     |
|----------|---------------------------------|
| 1        | Initial revision                |
| 2        | Updated Feature Map Conformance |

Page 654







## 8.6.2. Classification

| Hierarchy | Role        | Scope    | PICS Code  |
|-----------|-------------|----------|------------|
| Base      | Application | Endpoint | WASHERCTRL |

## 8.6.3. Cluster ID

| ID     | Name                    |
|--------|-------------------------|
| 0x0053 | Laundry Washer Controls |

## 8.6.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code  | Feature | Conformance | Summary                         |
|-----|-------|---------|-------------|---------------------------------|
| 0   | SPIN  | Spin    | O.a+        | Multiple spin speeds supported  |
| 1   | RINSE | Rinse   | O.a+        | Multiple rinse cycles supported |

### 8.6.4.1. Spin Feature

This feature indicates multiple spin speeds are supported in at least one supported mode. Note that some modes may not support multiple spin speeds even if this feature is supported.

### 8.6.4.2. Rinse Feature

This feature indicates multiple rinse cycles are supported in at least one supported mode. Note that some modes may not support selection of the number of rinse cycles even if this feature is supported.

## 8.6.5. Data Types

### 8.6.5.1. NumberOfRinsesEnum Type

This data type is derived from enum8.

The NumberOfRinsesEnum provides a representation of the number of rinses that will be performed for a selected mode. NumberOfRinsesEnum is derived from enum8. It is up to the device manufacturer to determine the mapping between the enum values and the corresponding numbers of rinses.

| Value | Name | Summary                                                | Conformance |
|-------|------|--------------------------------------------------------|-------------|
| 0     | None | This laundry washer mode does not perform rinse cycles | RINSE       |



Page 655



| Value | Name          | Summary                                                                                             | Conformance |
|-------|---------------|-----------------------------------------------------------------------------------------------------|-------------|
| 1     | <b>Normal</b> | This laundry washer mode performs normal rinse cycles determined by the manufacturer                | RINSE       |
| 2     | <b>Extra</b>  | This laundry washer mode performs an extra rinse cycle                                              | RINSE       |
| 3     | <b>Max</b>    | This laundry washer mode performs the maximum number of rinse cycles determined by the manufacturer | RINSE       |

### 8.6.6. Attributes

| ID     | Name                    | Type                     | Constraint     | Quality | Fallback | Access | Conformance |
|--------|-------------------------|--------------------------|----------------|---------|----------|--------|-------------|
| 0x0000 | <b>SpinSpeeds</b>       | list[string]             | max 16[max 64] |         |          | R V    | SPIN        |
| 0x0001 | <b>SpinSpeedCurrent</b> | uint8                    | max 15         | X       |          | RW VO  | SPIN        |
| 0x0002 | <b>NumberOfRinses</b>   | NumberofRinsesEnum       | desc           |         |          | RW VO  | RINSE       |
| 0x0003 | <b>SupportedRinses</b>  | list[NumberofRinsesEnum] | max 4          |         |          | R V    | RINSE       |

#### 8.6.6.1. SpinSpeeds Attribute

This attribute SHALL indicate the list of spin speeds available to the appliance in the currently selected mode. The spin speed values are determined by the manufacturer. At least one spin speed value SHALL be provided in the SpinSpeeds list. The list of spin speeds MAY change depending on the currently selected Laundry Washer mode. For example, Quick mode might have a completely different list of SpinSpeeds than Delicates mode.

#### 8.6.6.2. SpinSpeedCurrent Attribute

This attribute SHALL indicate the currently selected spin speed. It is the index into the SpinSpeeds list of the selected spin speed, as such, this attribute can be an integer between 0 and the number of entries in SpinSpeeds - 1. If a value is received that is outside of the defined constraints, a CONSTRAINT\_ERROR SHALL be sent as the response. If a value is attempted to be written that doesn't match a valid index (e.g. an index of 5 when the list has 4 values), a CONSTRAINT\_ERROR SHALL be

Page 656







sent as the response. If null is written to this attribute, there will be no spin speed for the selected cycle. If the value is null, there will be no spin speed on the current mode.

#### 8.6.6.3. NumberOfRinses Attribute

This attribute SHALL indicate how many times a rinse cycle SHALL be performed on a device for the current mode of operation. A value of None SHALL indicate that no rinse cycle will be performed. This value may be set by the client to adjust the number of rinses that are performed for the current mode of operation. If the device is not in a compatible state to accept the provided value, an INVALID\_IN\_STATE error SHALL be sent as the response.

#### 8.6.6.4. SupportedRinses Attribute

This attribute SHALL indicate the amount of rinses allowed for a specific mode. Each entry SHALL indicate a NumberOfRinsesEnum value that is possible in the selected mode on the device. The value of this attribute MAY change at runtime based on the currently selected mode. Each entry SHALL be distinct.

## 8.7. Refrigerator And Temperature Controlled Cabinet Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for refrigerator and temperature controlled cabinet devices.

### 8.7.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                  |
|----------|----------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                             |
| 2        | ChangeToModeResponse command: StatusText must be provided for InvalidInMode status           |
| 3        | Set OnOff feature, StartUpMode, and OnMode as disallowed (previously a Device Type override) |

### 8.7.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | TCCM      |

### 8.7.3. Cluster ID




Page 657



| ID     | Name                                                 |
|--------|------------------------------------------------------|
| 0x0052 | Refrigerator And Temperature Controlled Cabinet Mode |

### 8.7.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

### 8.7.5. Data Types

#### 8.7.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

### 8.7.6. Attributes

| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        | M           |
| 0x0001 | CurrentMode    |      |            |         |          |        | M           |
| 0x0002 | StartUpMode    |      |            |         |          |        | X           |
| 0x0003 | OnMode         |      |            |         |          |        | X           |

#### 8.7.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Auto mode tag in the ModeTags field list.

Page 658



## 8.7.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

### 8.7.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name        |
|----------------|-------------|
| 0x0000         | Auto        |
| 0x0001         | Quick       |
| 0x0002         | Quiet       |
| 0x0003         | LowNoise    |
| 0x0004         | LowEnergy   |
| 0x0005         | Vacation    |
| 0x0006         | Min         |
| 0x0007         | Max         |
| 0x0008         | Night       |
| 0x0009         | Day         |
| 0x4000         | RapidCool   |
| 0x4001         | RapidFreeze |

#### 8.7.7.1.1. RapidCool Tag

This mode reduces the temperature rapidly, typically above freezing grade.

#### 8.7.7.1.2. RapidFreeze Tag

This mode reduces the temperature rapidly, below freezing grade.

## 8.7.8. Mode Examples

A few examples of Refrigerator and Temperature Controlled Cabinet modes and their mode tags are provided below.

- For the "Normal" mode, tags: 0x0000 (Auto)
- For the "Energy Save" mode, tags: 0x0004 (LowEnergy)
- For the "Rapid Cool" mode, tags: 0x4000 (RapidCool)

## 8.8. Refrigerator Alarm Cluster

This cluster is a derived cluster of Alarm Base cluster and provides the alarm definition related to refrigerator and temperature controlled cabinet devices.



Page 659



### 8.8.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 8.8.2. Classification

| Hierarchy  | Role        | Scope    | PICS Code |
|------------|-------------|----------|-----------|
| Alarm Base | Application | Endpoint | REFALM    |

### 8.8.3. Cluster ID

| ID     | Name               |
|--------|--------------------|
| 0x0057 | Refrigerator Alarm |

### 8.8.4. Features

| Bit | Code  | Feature | Conformance | Summary                              |
|-----|-------|---------|-------------|--------------------------------------|
| 0   | RESET | Reset   | X           | Supports the ability to reset alarms |

### 8.8.5. Data Types

#### 8.8.5.1. AlarmBitmap Type

This data type is derived from map32.

| Bit | Name     | Summary                                                               | Conformance |
|-----|----------|-----------------------------------------------------------------------|-------------|
| 0   | DoorOpen | The cabinet's door has been open for a vendor defined amount of time. | M           |

### 8.8.6. Attributes

#### 8.8.6.1. Mask Attribute

If the generation of the alarm has not been suppressed at the device itself, then this attribute SHALL have these fixed values.

| Bit | Name     | Value |
|-----|----------|-------|
| 0   | DoorOpen | 1     |

Page 660







This alarm SHALL be cleared only when the door is closed (manual action).

If the generation of the alarm is suppressed at the device itself, then bit 0 SHALL have a value of 0. It SHALL be re-set to 1 if the alarm is re-enabled at the device itself.

### 8.8.7. Commands

| ID   | Name                | Direction | Response | Access | Conformance |
|------|---------------------|-----------|----------|--------|-------------|
| 0x01 | ModifyEnabledAlarms |           |          |        | X           |

## 8.9. Laundry Dryer Controls Cluster

This cluster provides a way to access options associated with the operation of a laundry dryer device type.

### 8.9.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 8.9.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | DRYERCTRL |

### 8.9.3. Cluster ID

| ID     | Name                   |
|--------|------------------------|
| 0x004A | Laundry Dryer Controls |

### 8.9.4. Data Types

#### 8.9.4.1. DrynessLevelEnum Type

This data type is derived from enum8.

This enum provides a representation of the level of dryness that will be used while drying in a selected mode.

It is up to the device manufacturer to determine the mapping between the enum values and the corresponding temperature level.



Page 661



| Value | Name          | Summary                                                    | Conformance |
|-------|---------------|------------------------------------------------------------|-------------|
| 0     | <b>Low</b>    | Provides a low dryness level for the selected mode         | M           |
| 1     | <b>Normal</b> | Provides the normal level of dryness for the selected mode | M           |
| 2     | <b>Extra</b>  | Provides an extra dryness level for the selected mode      | M           |
| 3     | <b>Max</b>    | Provides the max dryness level for the selected mode       | M           |

### 8.9.5. Attributes

| ID     | Name                   | Type                                     | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------|------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedDrynessLevels | list[ <a href="#">DrynessLevelEnum</a> ] | 1 to 4     |         |          | R V    | M           |
| 0x0001 | SelectedDrynessLevel   | <a href="#">DrynessLevelEnum</a>         | desc       | X       |          | RW VO  | M           |

#### 8.9.5.1. SupportedDrynessLevels Attribute

This attribute SHALL indicate the list of supported dryness levels available to the appliance in the currently selected mode. The dryness level values are determined by the manufacturer. At least one dryness level value SHALL be provided in the SupportedDrynessLevels list. The list of dryness levels MAY change depending on the currently-selected Laundry Dryer mode.

#### 8.9.5.2. SelectedDrynessLevel Attribute

This attribute SHALL indicate the currently-selected dryness level and it SHALL be the index into the SupportedDrynessLevels list of the selected dryness level.

If an attempt is made to write this attribute with a value other than null or a value contained in SupportedDrynessLevels, a CONSTRAINT\_ERROR response SHALL be sent as the response. If an attempt is made to write this attribute while the device is not in a state that supports modifying the dryness level, an INVALID\_IN\_STATE error SHALL be sent as the response. A value of null SHALL indicate that there will be no dryness level setting for the current mode.

Page 662







## 8.10. Oven Cavity Operational State Cluster

This cluster is derived from the Operational State cluster and provides an interface for monitoring the operational state of an oven.

### 8.10.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                     |
|----------|---------------------------------------------------------------------------------|
| 1        | Initial revision                                                                |
| 2        | Set Pause and Resume commands as disallowed (previously a Device Type override) |

### 8.10.2. Classification

| Hierarchy         | Role        | Scope    | PICS Code   |
|-------------------|-------------|----------|-------------|
| Operational State | Application | Endpoint | OVENOPSTATE |

### 8.10.3. Cluster ID

| ID     | Name                          |
|--------|-------------------------------|
| 0x0048 | Oven Cavity Operational State |

### 8.10.4. Attributes

#### 8.10.4.1. PhaseList Attribute

As defined in the [base cluster](#), this attribute indicates a list of names of different phases that the device can go through for the selected function or mode.

For this derived cluster, only these pre-defined strings may be used in the PhaseList attribute:

"pre-heating", "pre-heated", and "cooling down".

Other values SHALL NOT be used.

As defined in the [base cluster](#), a null value indicates that the device does not present phases during its operation. When this attribute's value is null, the CurrentPhase attribute SHALL also be set to null.

### 8.10.5. Commands

| ID   | Name         | Direction | Response | Access | Conformance |
|------|--------------|-----------|----------|--------|-------------|
| 0x00 | <b>Pause</b> |           |          |        | X           |




Page 663



| ID   | Name                        | Direction | Response | Access | Conformance |
|------|-----------------------------|-----------|----------|--------|-------------|
| 0x01 | Stop                        |           |          |        |             |
| 0x02 | Start                       |           |          |        |             |
| 0x03 | Resume                      |           |          |        | X           |
| 0x04 | Operational-CommandResponse |           |          |        |             |

## 8.11. Oven Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for oven devices.

### 8.11.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                  |
|----------|----------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                             |
| 2        | Set OnOff feature, StartUpMode, and OnMode as disallowed (previously a Device Type override) |

### 8.11.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | OTCCM     |

### 8.11.3. Cluster ID

| ID     | Name      |
|--------|-----------|
| 0x0049 | Oven Mode |

### 8.11.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

Page 664



## 8.11.5. Data Types

### 8.11.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

### 8.11.6. Attributes

| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        |             |
| 0x0001 | CurrentMode    |      |            |         |          |        |             |
| 0x0002 | StartUpMode    |      |            |         |          |        | X           |
| 0x0003 | OnMode         |      |            |         |          |        | X           |

#### 8.11.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Bake mode tag in the ModeTags field list.

## 8.11.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

### 8.11.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name      |
|----------------|-----------|
| 0x0000         | Auto      |
| 0x0001         | Quick     |
| 0x0002         | Quiet     |
| 0x0003         | LowNoise  |
| 0x0004         | LowEnergy |




Page 665



| <b>Mode Tag Value</b> | <b>Name</b>             |
|-----------------------|-------------------------|
| 0x0005                | <b>Vacation</b>         |
| 0x0006                | <b>Min</b>              |
| 0x0007                | <b>Max</b>              |
| 0x0008                | <b>Night</b>            |
| 0x0009                | <b>Day</b>              |
| 0x4000                | <b>Bake</b>             |
| 0x4001                | <b>Convection</b>       |
| 0x4002                | <b>Grill</b>            |
| 0x4003                | <b>Roast</b>            |
| 0x4004                | <b>Clean</b>            |
| 0x4005                | <b>Convection Bake</b>  |
| 0x4006                | <b>Convection Roast</b> |
| 0x4007                | <b>Warming</b>          |
| 0x4008                | <b>Proofing</b>         |
| 0x4009                | <b>Steam</b>            |

#### 8.11.7.1.1. Bake Tag

This mode sets the device into baking mode for baking food items.

#### 8.11.7.1.2. Convection Tag

This mode sets the device into convection mode which creates an airflow within the device during the cooking duration.

#### 8.11.7.1.3. Grill Tag

This mode sets the device into grill mode for grilling food items. This is the same as Broil for many regions.

#### 8.11.7.1.4. Roast Tag

This mode sets the device into roast mode for roasting food items.

#### 8.11.7.1.5. Clean Tag

This mode sets the device into cleaning mode to clean the internal components of the appliance.

#### 8.11.7.1.6. Convection Bake Tag

This mode sets the device into convection bake mode which creates an airflow within the device during the baking duration.

Page 666







#### 8.11.7.1.7. Convection Roast Tag

This mode sets the device into convection roast mode which creates an airflow within the device during the roasting duration.

#### 8.11.7.1.8. Warming Tag

This mode sets the device into a warming mode which begins warming the cavity.

#### 8.11.7.1.9. Proofing Tag

This mode sets the device into proofing mode which creates an environment ready for proofing.

### 8.11.8. Mode Examples

A few examples of Oven modes and their mode tags are provided below.

- For the "Convection" mode, tags: 0x4001 (Convection)
- For the "Bake" mode, tags: 0x4000 (Bake)
- For the "Bake and Warm" mode, tags: 0x4000 (Bake), 0x4007 (Warming)
- For the "Convection Cook and Clean" mode, tags: 0x4001 (Convection), 0x4004 (Clean)

## 8.12. Microwave Oven Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for microwave oven devices.

### 8.12.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                     |
|----------|---------------------------------|
| 1        | Initial revision                |
| 2        | Set OnOff feature as disallowed |

### 8.12.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | MWOM      |

### 8.12.3. Cluster ID

| ID     | Name                |
|--------|---------------------|
| 0x005E | Microwave Oven Mode |




Page 667



### 8.12.4. Features

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

### 8.12.5. Attributes

| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        |             |
| 0x0001 | CurrentMode    |      |            |         |          |        |             |
| 0x0002 | StartUpMode    |      |            |         |          |        | X           |
| 0x0003 | OnMode         |      |            |         |          |        | X           |

#### 8.12.5.1. SupportedModes Attribute

Exactly one entry in the SupportedModes attribute SHALL include the Normal mode tag in the ModeTags field.

The Normal and Defrost mode tags are mutually exclusive and SHALL NOT both be used together in a mode's ModeTags.

### 8.12.6. Commands

| ID   | Name                  | Direction | Response | Access | Conformance |
|------|-----------------------|-----------|----------|--------|-------------|
| 0x00 | ChangeTo-Mode         |           |          |        | X           |
| 0x01 | ChangeTo-ModeResponse |           |          |        | X           |

### 8.12.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

#### 8.12.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name |
|----------------|------|
| 0x0000         | Auto |

Page 668



| Mode Tag Value | Name      |
|----------------|-----------|
| 0x0001         | Quick     |
| 0x0002         | Quiet     |
| 0x0003         | LowNoise  |
| 0x0004         | LowEnergy |
| 0x0005         | Vacation  |
| 0x0006         | Min       |
| 0x0007         | Max       |
| 0x0008         | Night     |
| 0x0009         | Day       |
| 0x4000         | Normal    |
| 0x4001         | Defrost   |

#### 8.12.7.1.1. Normal tag

This is the normal mode of operation for general cooking of food.

#### 8.12.7.1.2. Defrost tag

This is a mode optimized for defrosting food.

## 8.13. Microwave Oven Control Cluster

This cluster defines the requirements for the Microwave Oven Control cluster.

This cluster has dependencies with the Operational State and Microwave Oven Mode clusters. The Operational State cluster and the Microwave Oven Mode clusters, or derivatives of those clusters SHALL appear on the same endpoint as this cluster.

### 8.13.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 8.13.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | MWOCTRL   |



Page 669



### 8.13.3. Cluster ID

| ID     | Name                   |
|--------|------------------------|
| 0x005F | Microwave Oven Control |

### 8.13.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code    | Feature            | Conformance | Summary                                                    |
|-----|---------|--------------------|-------------|------------------------------------------------------------|
| 0   | PWRNUM  | PowerAsNumber      | O.a         | Power is specified as a unitless number or a percentage    |
| 1   | WATTS   | PowerInWatts       | P, O.a      | Power is specified in Watts                                |
| 2   | PWRLMTS | PowerNumber-Limits | [PWRNUM]    | Supports the limit attributes used with the PWRNUM feature |

### 8.13.5. Attributes

| ID     | Name                     | Type         | Constraint            | Quality | Fallback | Access | Conformance |
|--------|--------------------------|--------------|-----------------------|---------|----------|--------|-------------|
| 0x0000 | <b>CookTime</b>          | elapsed-s    | 1 to Max-CookTime     |         |          | R V    | M           |
| 0x0001 | <b>MaxCookTime</b>       | elapsed-s    | 1 to 86400            | F       |          | R V    | M           |
| 0x0002 | <b>PowerSetting</b>      | uint8        | desc                  |         |          | R V    | PWRNUM      |
| 0x0003 | <b>MinPower</b>          | uint8        | 1 to 99               | F       |          | R V    | PWRLMTS     |
| 0x0004 | <b>MaxPower</b>          | uint8        | (MinPower + 1) to 100 | F       |          | R V    | PWRLMTS     |
| 0x0005 | <b>PowerStep</b>         | uint8        | desc                  | F       |          | R V    | PWRLMTS     |
| 0x0006 | <b>SupportedWatts</b>    | list[uint16] | 1 to 10               | F       |          | R V    | P, WATTS    |
| 0x0007 | <b>SelectedWattIndex</b> | uint8        | desc                  |         |          | R V    | P, WATTS    |
| 0x0008 | <b>WattRating</b>        | uint16       | all                   | F       | MS       | R V    | O           |

Page 670







#### 8.13.5.1. CookTime Attribute

This attribute SHALL indicate the total cook time associated with the operation of the device.

This attribute SHALL remain unchanged during the operation of the oven unless the value is changed via a command or out-of-band action.

#### 8.13.5.2. MaxCookTime Attribute

This attribute SHALL indicate the maximum value to which the CookTime attribute can be set.

#### 8.13.5.3. PowerSetting Attribute

This attribute SHALL indicate the power level associated with the operation of the device.

If the MinPower, MaxPower, and PowerStep attributes are not supported:

- The minimum value of this attribute SHALL be 10,
- The maximum value of this attribute SHALL be 100,
- The value SHALL be in even multiples of 10,
- The default value SHALL be 100.

If the MinPower, MaxPower, and PowerStep attributes are supported:

- The value of this attribute SHALL be between MinPower and MaxPower inclusive.
- The value of this attribute SHALL be such that  $(\text{PowerSetting} - \text{MinPower}) \% \text{PowerStep} == 0$

#### 8.13.5.4. MinPower Attribute

This attribute SHALL indicate the minimum value to which the PowerSetting attribute that can be set on the server.

#### 8.13.5.5. MaxPower Attribute

This attribute SHALL indicate the maximum value to which the PowerSetting attribute that can be set on the server.

#### 8.13.5.6. PowerStep Attribute

This attribute SHALL indicate the increment of power that can be set on the server.

The value of this attribute SHALL be between 1 and MaxPower inclusive.

The value of this attribute SHALL be such that  $(\text{MaxPower} - \text{MinPower}) \% \text{PowerStep} == 0$

For example, if MinPower is 1, MaxPower is 10, and PowerSetting can be set to any integer between MinPower and MaxPower, PowerStep would be set to 1.



Page 671



### 8.13.5.7. SupportedWatts Attribute

This attribute SHALL indicate the list of power levels (in W) supported by the server.

### 8.13.5.8. SelectedWattIndex Attribute

This attribute SHALL indicate the index into the list of SupportedWatts of the currently selected power setting.

The index SHALL be a valid index into the SupportedWatts list.

### 8.13.5.9. WattRating Attribute

This attribute SHALL indicate the rating, in Watts, of the microwave power of the oven.

Supporting this attribute can assist clients in suggesting cooking settings for various foods and beverages.

## 8.13.6. Commands

| ID   | Name                        | Direction                   | Response | Access | Conformance |
|------|-----------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <b>SetCookingParameters</b> | client $\Rightarrow$ server | Y        | O      | M           |
| 0x01 | <b>AddMoreTime</b>          | client $\Rightarrow$ server | Y        | O      | O           |

### 8.13.6.1. Command Responses Impacted By the Operational State Cluster

When the [Operational State](#) cluster or a cluster derived from it is included on the same endpoint as this cluster, the server MAY respond to commands defined in this cluster with an INVALID\_IN\_STATE response if the server is unable to accept those command due to restrictions imposed by the current operational state of the device or other factors.

### 8.13.6.2. SetCookingParameters Command

This command is used to set the cooking parameters associated with the operation of the device. This command supports the following fields:

| ID | Name                    | Type      | Constraint           | Quality | Fallback | Conformance      |
|----|-------------------------|-----------|----------------------|---------|----------|------------------|
| 0  | <b>CookMode</b>         | uint8     | desc                 |         | desc     | O.b+             |
| 1  | <b>CookTime</b>         | elapsed-s | 1 to Max-CookTime    |         | 30       | O.b+             |
| 2  | <b>PowerSetting</b>     | uint8     | MinPower to MaxPower |         | MaxPower | [PWR-<br>NUM].b+ |
| 3  | <b>WattSettingIndex</b> | uint8     | desc                 |         | MS       | [WATTS].b+       |

Page 672







| ID | Name                     | Type | Constraint | Quality | Fallback | Conformance |
|----|--------------------------|------|------------|---------|----------|-------------|
| 4  | <b>StartAfterSetting</b> | bool | all        |         | false    | 0           |

#### 8.13.6.2.1. CookMode Field

This field SHALL indicate the value to which the CurrentMode attribute of the Microwave Oven Mode cluster should be set. The value of this field SHALL be one from the list of SupportedModes from the Microwave Oven Mode cluster.

If this field is missing, the CurrentMode attribute SHALL be set to a mode having the Normal mode tag.

#### 8.13.6.2.2. CookTime Field

This field SHALL indicate the CookTime associated with the operation of the device. The value of this field SHALL be subject to the constraints of the CookTime attribute of this cluster.

If this field is missing, the CookTime attribute SHALL be set to 30 seconds by the server.

#### 8.13.6.2.3. PowerSetting Field

This field SHALL indicate the PowerSetting associated with the operation of the device. The value of this field SHALL be subject to the constraints of the PowerSetting attribute of this cluster. If the PowerSetting field does not conform to the constraints of the PowerSetting attribute, the server SHALL return a CONSTRAINT\_ERROR status.

If this field is missing, the PowerSetting attribute SHALL be set to 100 if MaxPower is not supported by the server, otherwise it SHALL be set to MaxPower if the MaxPower attribute is supported by the server.

#### 8.13.6.2.4. WattSettingIndex Field

This field SHALL indicate the value to which the SelectedWattIndex attribute is set. If the value of this field is greater than or equal to the length of the SupportedWatts attribute list, the server SHALL return a CONSTRAINT\_ERROR status and the value of the SelectedWattIndex attribute SHALL be unchanged.

If this field is missing, the SelectedWattIndex attribute SHALL be set by the server to the index associated with the highest Watt setting for the selected CookMode.

#### 8.13.6.2.5. StartAfterSetting Field

This field SHALL indicate whether or not oven operation SHALL be started when the command is received.

#### 8.13.6.2.6. Effect on Receipt

If this command is received while the operational state of the server cannot support the command in that state, the server SHALL respond with an INVALID\_IN\_STATE response and the attributes and




Page 673



state SHALL remain unchanged. See [Operational State Cluster](#) for details on the operational states.

If this command is received and any fields sent with the command do not meet the constraints of any of the associated attributes (i.e. bearing the same name as the field or as described in the field description), the server SHALL respond with a response of CONSTRAINT\_ERROR and the attributes and state SHALL remain unchanged.

If the StartAfterSetting field is present in the command but the Start command of the Operational State cluster or one of its derivatives on the same endpoint as this cluster is not supported, the server SHALL respond with a response of INVALID\_COMMAND and the attributes and state SHALL remain unchanged.

Otherwise:

- The attributes associated with any included fields SHALL be set to the values of those fields.
- The attributes associated with any missing fields SHALL be set to the values as specified in descriptions of the missing fields.
- If the StartAfterSetting field is included:
  - If the value of StartAfterSetting is TRUE, oven operation SHALL start.
  - If the value of StartAfterSetting is FALSE, oven operation SHALL NOT start.

#### 8.13.6.3. AddMoreTime Command

This command is used to add more time to the CookTime attribute of the server.

This command supports these fields:

| ID | Name      | Type      | Constraint        | Quality | Fallback | Conformance |
|----|-----------|-----------|-------------------|---------|----------|-------------|
| 0  | TimeToAdd | elapsed-s | 1 to Max-CookTime |         |          | M           |

##### 8.13.6.3.1. TimeToAdd Field

This field SHALL indicate the number of seconds to be added to the CookTime attribute.

##### 8.13.6.3.2. Effect on Receipt

Upon receipt of this command, if the sum of the value of the TimeToAdd field and the current value of the CookTime attribute is greater than the MaxCookTime attribute, the server SHALL respond with a response of CONSTRAINT\_ERROR and the command SHALL be ignored.

If this command is received while the operational state of the server cannot support the command in that state, the server SHALL respond with an INVALID\_IN\_STATE response. See [Operational State Cluster](#) for details on the operational states.

Otherwise, the server SHALL add the value of the TimeToAdd field to the value of the CookTime attribute of this cluster and the server SHALL add the value of the TimeToAdd field to the value of

Page 674







the CountdownTime attribute of the Operational State cluster if that cluster or a derivative is on the same endpoint as this cluster.



Page 675



Page 676







# Chapter 9. Energy Management

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter.

## 9.1. General Description

### 9.1.1. Introduction

The clusters specified in this chapter are for use typically in Energy Management applications with associated security controls at the application layer. These clusters may be used in any application domain.

### 9.1.2. Data Types

#### 9.1.3. TariffUnitEnum Type

This data type is derived from enum8.

| Value | Name | Summary            | Conformance |
|-------|------|--------------------|-------------|
| 0     | kWh  | Kilowatt Hours     | M           |
| 1     | kVAh | Kilovolt-amp Hours | M           |

#### 9.1.4. PowerThresholdSourceEnum Type

This data type is derived from enum8.

| Value | Name      | Summary                                                        | Conformance |
|-------|-----------|----------------------------------------------------------------|-------------|
| 0x00  | Contract  | The power threshold comes from a signed contract               | M           |
| 0x01  | Regulator | The power threshold comes from a legal regulator               | M           |
| 0x02  | Equipment | The power threshold comes from a certified limits of the meter | M           |

#### 9.1.5. TariffPriceTypeEnum Type

This data type is derived from enum8.



Page 677



| Value | Name            | Summary                 | Conformance |
|-------|-----------------|-------------------------|-------------|
| 0x00  | Standard        | Standard tariff price   | M           |
| 0x01  | Critical        | Price during CPP events | M           |
| 0x02  | Virtual         | Price during VPP events | M           |
| 0x03  | Incentive       | Price incentives        | M           |
| 0x04  | IncentiveSignal | Price incentive signals | M           |

#### 9.1.5.1. Standard Value

This value SHALL indicate that a price comes from a standard tariff rate.

#### 9.1.5.2. Critical Value

This value SHALL indicate that a price comes from a critical peak pricing event.

#### 9.1.5.3. Virtual Value

This value SHALL indicate that a price comes from a virtual power plant event.

#### 9.1.5.4. Incentive Value

This value SHALL indicate that a price comes from a incentive event.

#### 9.1.5.5. IncentiveSignal Value

This value SHALL indicate that a price is synthesized from a non-tariff source; e.g. gCO2e/kWh.

### 9.1.6. PowerThresholdStruct Type

This struct represents information about a power threshold.

| ID | Name                   | Type                     | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|--------------------------|------------|---------|----------|--------|-------------|
| 0  | PowerThreshold         | power-mW                 | all        |         |          |        | O.b         |
| 1  | ApparentPowerThreshold | power-mVA                | all        |         |          |        | O.b         |
| 2  | PowerThresholdSource   | PowerThresholdSourceEnum |            | X       |          |        | M           |

Page 678







### 9.1.6.1. PowerThreshold Field

This field SHALL indicate the instantaneous power demand that can be distributed to the customer without any risk of overload. The value is in mW and could be provided by the contract or Distribution Network Operator (DNO).

### 9.1.6.2. ApparentPowerThreshold Field

This field SHALL indicate the instantaneous apparent power demand that can be distributed to the customer without any risk of overload. The value is in mVA and could be provided by the contract or Distribution Network Operator (DNO).

### 9.1.6.3. PowerThresholdSource Field

This field SHALL indicate the reason why the [PowerThreshold](#) field was set. If the reason is unavailable, this field SHALL be null.

## 9.1.7. Cluster List

This section lists the Energy Management specific clusters as specified in this chapter.

*Table 16. Overview of the Energy Management Clusters*

| Cluster ID | Cluster Name                                  | Description                                                                                                      |
|------------|-----------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| 0x0098     | <a href="#">Device Energy Management</a>      | Generic cluster for enabling power adjustment, sharing power forecasts and modifying power forecasts for devices |
| 0x0099     | <a href="#">Energy EVSE</a>                   | Commands and attributes for controlling an EVSE                                                                  |
| 0x009D     | <a href="#">Energy EVSE Mode</a>              | Commands and attributes for setting the mode of an EVSE                                                          |
| 0x0094     | <a href="#">Water Heater Management</a>       | Commands and attributes for controlling a Water Heater                                                           |
| 0x009E     | <a href="#">Water Heater Mode</a>             | Commands and attributes for setting the mode of a Water Heater                                                   |
| 0x009B     | <a href="#">Energy Preference</a>             | Attributes and commands for expressing user preferences around energy consumption                                |
| 0x009F     | <a href="#">Device Energy Management Mode</a> | Commands and attributes for setting the mode of devices with energy management capability                        |
| 0x0095     | <a href="#">Commodity Price</a>               | Commands and attributes for reporting price                                                                      |




Page 679



| Cluster ID | Cluster Name                               | Description                                                 |
|------------|--------------------------------------------|-------------------------------------------------------------|
| 0x0B01     | <a href="#">Meter Identification</a>       | Attributes for advanced utility metering device information |
| 0x0700     | <a href="#">Commodity Tariff</a>           | Attributes for commodity tariff reporting                   |
| 0x0B07     | <a href="#">Commodity Metering</a>         | Attributes for commodity metering                           |
| 0x00A0     | <a href="#">Electrical Grid Conditions</a> | Attributes for reporting conditions on the electricity grid |

## 9.2. Device Energy Management Cluster

This cluster allows a client to manage the power draw of a device. An example of such a client could be an Energy Management System (EMS) which controls an Energy Smart Appliance (ESA).

In most deployments the EMS will be the client, and the ESA will host the Device Energy Management Cluster server.

![Diagram showing an Energy Manager System (EMS) acting as a client (C) connecting to two Energy Smart Appliances (ESAs), each hosting a Device Energy Management (DEM) Cluster server (S).](2c65a2c95c030f00ca2c6469079156dd_img.jpg)

The diagram illustrates the relationship between an Energy Manager System (EMS) and multiple Energy Smart Appliances (ESAs). On the left, a large rounded rectangle labeled 'Energy Manager System (EMS)' contains two small square icons labeled 'C', representing client endpoints. Two lines extend from these 'C' icons to the right. The top line connects to the 'S' icon (server endpoint) of the top 'Energy Smart Appliance (ESA)' box. The bottom line connects to the 'S' icon of the bottom 'Energy Smart Appliance (ESA)' box. Each ESA box contains a grey rounded rectangle labeled 'DEM Cluster', representing the server side of the Device Energy Management Cluster.

Diagram showing an Energy Manager System (EMS) acting as a client (C) connecting to two Energy Smart Appliances (ESAs), each hosting a Device Energy Management (DEM) Cluster server (S).

*Figure 19. Example of the how an EMS is a client of multiple ESAs Device Energy Management clusters.*

This cluster is intended to be generic in nature and could apply to any electrical load or generator (e.g. a Battery Electric Storage System - BESS, solar PV inverter, EVSE, HVAC, heat pump, hot water heater, white goods appliances etc).

It consists of the following areas which SHALL be supported by all devices implementing this cluster:

- Description of ESA and its capabilities & power limits (sometimes referred to as a nameplate)
- Current state of operation (including user opt-out, safety limitations / alarms)

There are some optional capabilities that some ESAs may be able to offer:

Page 680







- Ability to control the load or generation
- Forecast data, including when it can be flexible (i.e. modify the power or time period)
- The ability to have their power profile adjusted by an EMS, and to provide an updated Forecast back to the EMS.

This allows the EMS to manage multiple home loads and where ESAs can be flexible, continuously optimizing the home energy to minimize cost, reduce CO2 impact, maximize self-consumption of solar PV and provide Demand Side Response (DSR) Grid services.

It is likely that the ESA may also use the Pricing Cluster to obtain incentive signals such as 'grid carbon intensity', 'time of use' or 'type of use' tariffs to schedule its operation to run at the cheapest and greenest times.

![Diagram illustrating how an HVAC system may use multiple clusters. The diagram shows two main groups: EMS (Energy Management System) and HVAC. The EMS group contains a Pricing Server Cluster and a home energy optimiser. The HVAC group contains a Thermostat Cluster, a Time of Use Scheduling Optimiser, and an EM Cluster. A user icon interacts with the Thermostat Cluster. The Thermostat Cluster provides User Schedules to the Time of Use Scheduling Optimiser. The Time of Use Scheduling Optimiser provides a Power Forecast (with flexibility) to the EM Cluster. The EM Cluster provides a Modified Power Forecast to the HVAC system. The home energy optimiser in the EMS group interacts with the EM Cluster, sending GetForecast() and ModifyForecast() messages, and receiving AdjustPower() and CancelPowerAdjust() messages. The Pricing Server Cluster also interacts with the EM Cluster.](8c6b89f73329f48b2300fb82e6c9f8ab_img.jpg)

Diagram illustrating how an HVAC system may use multiple clusters. The diagram shows two main groups: EMS (Energy Management System) and HVAC. The EMS group contains a Pricing Server Cluster and a home energy optimiser. The HVAC group contains a Thermostat Cluster, a Time of Use Scheduling Optimiser, and an EM Cluster. A user icon interacts with the Thermostat Cluster. The Thermostat Cluster provides User Schedules to the Time of Use Scheduling Optimiser. The Time of Use Scheduling Optimiser provides a Power Forecast (with flexibility) to the EM Cluster. The EM Cluster provides a Modified Power Forecast to the HVAC system. The home energy optimiser in the EMS group interacts with the EM Cluster, sending GetForecast() and ModifyForecast() messages, and receiving AdjustPower() and CancelPowerAdjust() messages. The Pricing Server Cluster also interacts with the EM Cluster.

Figure 20. Example of the how an HVAC may use multiple clusters

**NOTE** Grid Services are market dependent and will use other protocols ([[OpenADR](#)] / [[IEEE2030.5](#)]) to communicate grid events to the EMS. These are outside the scope of Matter.

**NOTE** Different markets may follow different approaches, but the UK [[PAS1878](#)] and [[EUCodeOfConduct](#)] give examples of how ESAs may be mandated to support these features in the future.

## 9.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                           |
|----------|---------------------------------------|
| 1        | Initial revision                      |
| 2        | Updates after 0.7 Ballot review       |
| 3        | Updates to match cluster spec updates |



Page 681



| Revision | Description                                               |
|----------|-----------------------------------------------------------|
| 4        | Updates to feature conformance. Corrected ForecastID type |

## 9.2.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | DEM       |

## 9.2.3. Cluster ID

| ID     | Name                     |
|--------|--------------------------|
| 0x0098 | Device Energy Management |

## 9.2.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature                | Conformance                      | Summary                                                                                    |
|-----|------|------------------------|----------------------------------|--------------------------------------------------------------------------------------------|
| 0   | PA   | PowerAdjustment        | 0                                | Allows an EMS to make a temporary power adjustment (within the limits offered by the ESA). |
| 1   | PFR  | PowerForecastReporting | ![PA].a,(STA   PAU   FA   CON),0 | Allows an ESA to advertise its indicative future power consumption vs time.                |
| 2   | SFR  | StateForecastReporting | ![PA].a                          | Allows an ESA to advertise its indicative future state vs time.                            |
| 3   | STA  | StartTimeAdjustment    | 0                                | Allows an EMS to delay an ESA's planned operation.                                         |
| 4   | PAU  | Pausable               | 0                                | Allows an EMS to pause an ESA's planned operation.                                         |

Page 682







| Bit | Code | Feature                    | Conformance | Summary                                                             |
|-----|------|----------------------------|-------------|---------------------------------------------------------------------|
| 5   | FA   | ForecastAdjustment         | 0           | Allows an EMS to adjust an ESA's planned operation.                 |
| 6   | CON  | Constraint-BasedAdjustment | 0           | Allows an EMS to request constraints to an ESA's planned operation. |

The conformance rules specified above can be described as:

- At least one of the features SHALL be supported.
- At most one of the 'SFR' and 'PFR' features SHALL be supported.
- If one or more of the 'STA', 'PAU', 'FA', or 'CON' features are supported, then either the 'PFR' or the 'SFR' feature SHALL also be supported.
- If PA is supported, SFR SHALL NOT be supported

#### 9.2.4.1. PowerAdjustment Feature

For Energy Smart Appliances (ESA) the definition of being 'smart' mandates that they can report their current power adjustment capability and have an EMS request a temporary adjustment. This may typically be to curtail power requirements during peak periods, but can also be used to turn on an ESA if there is excess renewable or local generation (Solar PV).

For example, a home may have solar PV which often produces more power than the home requires, resulting in the excess power flowing into the grid. This excess power naturally fluctuates when clouds pass overhead and other loads in the home are switched on and off.

**EVSE Example:** An EMS may therefore be able to turn on the EVSE (if the vehicle is plugged in) and can start charging the vehicle, and periodically modify the charging power depending on PV generation and other home loads, so as to minimize import and export to the grid. An EMS may also use this feature to control the discharging (and re-charging) of the vehicle if the EVSE and vehicle support the V2X feature of the EVSE cluster of the associated EVSE device.

#### 9.2.4.2. PowerForecastReporting Feature

For Energy Smart Appliances (ESA) the definition of being 'smart' implies that they can report their indicative forecast power demands or generation, to a greater or lesser extent. For some ESAs this is highly predictable (in terms of both power and time), in other appliances this is more challenging and only a basic level of forecast is possible.

Forecasts are defined from a current time, using a slot format, where the slot is akin to a relatively constant operating mode.

**Washing machine example:** a washing machine may have stages of a washing cycle: heating, tum-



Page 683



bling, rinse and spin stages. At each stage, the approximate minimum and maximum power consumption may be known, as well as the duration of that stage.

In some circumstances the ESA may allow the stage to be delayed or paused (subject to safety and manufacturer's discretion and user preferences).

Typically, appliances with a heating element cannot have their power consumption adjusted and can only be paused or delayed.

Some ESAs may not be flexible other than a delayed cycle start (for example, once the washing cycle has been started then they run continuously until the cycle completes).

Appliances that only support the PowerForecastReporting and not any of the adjustment features may indicate that they are not flexible in the forecast slot format.

The PowerForecastReporting and the adjustment features aim to align to the [\[SAREF4ENER\]](#) ontology.

**Inverter driven ESAs:** some inverter driven ESAs can consume or generate a variable amount of power.

For example, a single phase EVSE can be adjusted in the range of 6-32Amps in 0.6 Amp steps in EU or on a hardwired 120V supply in the range of 6-15 Amps in US.

For example, a home battery may be adjusted to charge or discharge in steps of 1W.

For example, a heat pump may be able to modulate its compressor inverter between 20-100% of its rated power.

The ESA indicates its power adjustment range and its nominal power consumption as part of its Forecast.

#### 9.2.4.3. StateForecastReporting Feature

Some ESAs do not know their actual power consumption, but do know the state of operation. Like the PowerForecastingReporting feature, this uses the same slot structure mechanism to indicate a change in state vs time.

An external observing EMS may have access to real-time meter readings, and could learn the typical power consumption based on the advertised internal state of the ESA.

To enable this capability, the ESA SHALL report its internal operational state using a manufacturer specific value.

Once the EMS has built a model of the state vs observed power consumption, it may request a forecast adjustment for particular times of the day, encouraging the ESA to use power at alternative times.

#### 9.2.4.4. StartTimeAdjustment Feature

ESAs which support the Start Time Adjustment feature, allow an EMS to recommend a change to

Page 684







the start time of the energy transfer that the ESA has previously suggested it would use.

**Washing machine example:** A Washing Machine may have been set to start a wash cycle at 9pm when the variable tariff normally reduces.

However, the EMS is aware that a grid event has occurred, making it cheaper to run the cycle at a later time, but the washing machine is not aware of this.

The EMS first requests the Forecast data from each of its registered ESAs. It determines that the washing machine has a power profile suggesting it will start the wash cycle at 9pm, but the EMS now knows that the grid event means it will be cheaper to delay the start until 11pm.

The EMS can then optimize the cost by asking the washing machine to delay starting the wash cycle until 11pm.

It does this by sending a [StartTimeAdjustRequest](#) to the washing machine to request delaying the start of the washing cycle.

#### 9.2.4.5. Pausable Feature

ESAs which support the Pausable feature, allow an EMS to recommend a pause in the middle of a forecast power profile that the ESA is currently using.

**Washing machine example:** A Washing Machine is in operation, and starting its water heating step.

However, the EMS becomes aware from the smart meter that the total home load on the grid is close to exceeding its allowed total grid load.

The EMS first requests the Forecast data from each of its registered ESAs. It determines that the washing machine has a power profile suggesting its current step in the wash cycle is using power to heat the water, but that this step can be paused.

The EMS can then reduce the grid load by asking the washing machine to pause the wash cycle for a short duration.

It does this by sending a [PauseRequest](#) to the washing machine to request pausing the current step of the forecast power usage for a period to allow other home loads to finish before resuming the washing cycle.

#### 9.2.4.6. ForecastAdjustment Feature

ESAs which support the Forecast adjustment feature, allow an EMS to recommend a change to the start, duration and/or power level limits of the steps of the power profile that the ESA has previously suggested it would use.

**Heat pump and Solar PV example:** A heat pump may have the ability to heat hot water as well as heating the home. The heat pump scheduling system may have determined that the home will be unoccupied during the day, or that the indoor temperature is above the set-point and so it knows that it will not need to heat the home.



Page 685



However, the hot water tank is likely to need to be reheated before the homeowner comes home in the evening. The heat pump is not aware that the property also has a solar PV inverter which is also an ESA that is communicating with the EMS.

The EMS first requests the Forecast data from each of its registered ESAs. It determines that the heat pump has a power profile suggesting it needs to heat hot water around 6pm. The solar PV inverter has forecast that it will generate 3.6kW of power during the middle of the day and into the afternoon before the sun goes down.

The EMS can then optimize the home considering other non-ESA loads and can ask the heat pump to heat the hot water around 3pm when it has forecast that excess solar power will be available.

It does this by sending a [ModifyForecastRequest](#) to the heat pump and asks the heat pump to expect to run at a lower power consumption (within the solar excess power) which requires the heat pump to run for a longer duration to achieve its required energy demand.

#### 9.2.4.7. ConstraintBasedAdjustment Feature

ESAs which support the Constraint-Based Adjustment feature allow an EMS to inform the ESA of periods during which power usage should be modified (for example when the EMS has been made aware that the grid supplier has requested reduced energy usage due to overall peak grid demand) and may cause the ESA to modify the intended power profile has previously suggested it would use.

**EVSE example:** An EVSE scheduling system may have determined that the vehicle would be charged starting at a moderate rate at 1am, so that it has enough charge by the time it is needed later that morning.

However, the DSR service provider has informed the EMS that due to high forecast winds it is now forecast that there will be very cheap energy available from wind generation between 2am and 3am.

The EMS first requests the Forecast data from each of its registered ESAs. It determines that the EVSE has a power profile suggesting it plans to start charging the vehicle at 1am.

The EMS can then try to reduce the cost of charging the EV by informing the EVSE of the desire to increase the charging between scheduled times.

It does this by sending a [RequestConstraintBasedForecast](#) to the EVSE and asks it to run at a higher [NominalPower](#) consumption during the constraint period, which may require it to decrease its charge rate outside the constraint period to achieve its required energy demand.

### 9.2.5. Dependencies

This cluster does not report electrical power and electrical energy. Devices that use this cluster SHALL also support the Electrical Power Measurement and optionally support the Electrical Energy Measurement cluster to allow an energy management system to perform its role. See Device Type library for device specific details.

Page 686



## 9.2.6. Definitions

### 9.2.6.1. Power

Power is defined in the main specification (see Data Model) in units of milliwatts. It is a signed value, where positive values indicate the direction of power flow into the node. A negative value indicates that the device is supplying power, and thus reducing the overall load of the premises on the grid supply.

![Diagram illustrating power flows into devices in a solar/battery system. The diagram shows a central junction point with four connections: Grid (left), Utility Meter (top-left), PV Panels (top-right), and Load(s) (right). Below the junction is a Battery inverter, which is connected to a Battery Pack (right) via a DC line. The Battery inverter also has a meter 'M' on its output line. Arrows indicate power flow directions, and small boxes labeled 'M' represent meters measuring power flow into or out of the node.](f1be2f41ab63bd6132d16190bf5ab76f_img.jpg)

Diagram illustrating power flows into devices in a solar/battery system. The diagram shows a central junction point with four connections: Grid (left), Utility Meter (top-left), PV Panels (top-right), and Load(s) (right). Below the junction is a Battery inverter, which is connected to a Battery Pack (right) via a DC line. The Battery inverter also has a meter 'M' on its output line. Arrows indicate power flow directions, and small boxes labeled 'M' represent meters measuring power flow into or out of the node.

*NOTE: Charging the battery implies a positive power  
Discharging the battery implies a negative power  
from the perspective of the meter 'M' inside the node*

Figure 21. Power flows into devices

**Solar PV inverter example:** A solar PV inverter is normally connected to the premises' wiring, so its generation power will be indicated as a negative integer, since power is flowing out of the node towards the mains connection. Note that at night (when there is no solar production) the PV inverter will consume some standby power, and this will result in a small positive power reading.

**Grid Power:** Power from the grid is measured by a utility meter which is imported into the node, so positive power values indicate that power is flowing into the premises. Negative values indicate power is flowing back towards the grid.

**EVSE example:** An EVSE provides power to the EV (when charging) so a positive value indicates that the power is flowing into the EVSE from the mains supply when the EV is charging, and is acting as a load on the grid supply, and negative value indicates that the EV is discharging.

**BESS example:** A battery storage inverter normally provides power to loads when discharging, so negative power indicates discharging (power is flowing back to the mains supply) therefore reducing the load on the grid, and positive power indicates power flowing from the mains to the battery during charging (adding load to the grid).

**Washing Machine example:** A washing machine only consumes power (i.e. is a load), so it will always have a positive power value.



Page 687



### 9.2.6.2. Energy

Energy is defined in the main specification (see Data Model). This is defined in units of mWh (milli-watt-hours). It is signed value, where positive values indicate the direction of current flow towards a load.

## 9.2.7. Data Types

### 9.2.7.1. CostTypeEnum Type

This data type is derived from enum8.

| Value | Name                | Summary                      | Conformance |
|-------|---------------------|------------------------------|-------------|
| 0     | <b>Financial</b>    | Financial cost               | M           |
| 1     | <b>GHGEmissions</b> | Grid CO2e grams cost         | M           |
| 2     | <b>Comfort</b>      | Consumer comfort impact cost | M           |
| 3     | <b>Temperature</b>  | Temperature impact cost      | M           |

#### 9.2.7.1.1. Financial Value

This value SHALL indicate that the cost is related to the financial cost to provide the energy.

#### 9.2.7.1.2. GHGEmissions Value

This value SHALL indicate that the cost is related to greenhouse gas emissions (in grams of CO2e).

#### 9.2.7.1.3. Comfort Value

This value SHALL indicate that the cost is related to some abstract sense of comfort expressed by the consumer; a higher value indicates more discomfort. For example, a consumer may be more comfortable knowing that their EV is charged earlier in the day in case there is a sudden need to depart and drive to the hospital. Or the consumer may feel inconvenienced by the fact that they need to wait for the washing machine to finish its load so that they can use it again.

#### 9.2.7.1.4. Temperature Value

This value SHALL indicate that the cost is related to the temperature of the home or water being at its setpoint. Some consumers may be more sensitive to being too hot or too cold.

This is expressed in degrees Celsius.

### 9.2.7.2. ESATypeEnum Type

This data type is derived from enum8.

Page 688







| Value | Name                       | Summary                              | Conformance |
|-------|----------------------------|--------------------------------------|-------------|
| 0     | <b>EVSE</b>                | EV Supply Equipment                  | O           |
| 1     | <b>SpaceHeating</b>        | Space heating appliance              | O           |
| 2     | <b>WaterHeating</b>        | Water heating appliance              | O           |
| 3     | <b>SpaceCooling</b>        | Space cooling appliance              | O           |
| 4     | <b>SpaceHeatingCooling</b> | Space heating and cooling appliance  | O           |
| 5     | <b>BatteryStorage</b>      | Battery Electric Storage System      | O           |
| 6     | <b>SolarPV</b>             | Solar PV inverter                    | O           |
| 7     | <b>FridgeFreezer</b>       | Fridge / Freezer                     | O           |
| 8     | <b>WashingMachine</b>      | Washing Machine                      | O           |
| 9     | <b>Dishwasher</b>          | Dishwasher                           | O           |
| 10    | <b>Cooking</b>             | Cooking appliance                    | O           |
| 11    | <b>HomeWaterPump</b>       | Home water pump (e.g. drinking well) | O           |
| 12    | <b>IrrigationWaterPump</b> | Irrigation water pump                | O           |
| 13    | <b>PoolPump</b>            | Pool pump                            | O           |
| 255   | <b>Other</b>               | Other appliance type                 | O           |

### 9.2.7.3. ESASStateEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                                               | Conformance |
|-------|--------------------------|-----------------------------------------------------------------------|-------------|
| 0     | <b>Offline</b>           | The ESA is not available to the EMS (e.g. start-up, maintenance mode) | M           |
| 1     | <b>Online</b>            | The ESA is working normally and can be controlled by the EMS          | M           |
| 2     | <b>Fault</b>             | The ESA has developed a fault and cannot provide service              | M           |
| 3     | <b>PowerAdjustActive</b> | The ESA is in the middle of a power adjustment event                  | PA          |




Page 689



| Value | Name          | Summary                                                                | Conformance |
|-------|---------------|------------------------------------------------------------------------|-------------|
| 4     | <b>Paused</b> | The ESA is currently paused by a client using the PauseRequest command | PAU         |

#### 9.2.7.4. OptOutStateEnum Type

This data type is derived from enum8.

| Value | Name               | Summary                                                          | Conformance |
|-------|--------------------|------------------------------------------------------------------|-------------|
| 0     | <b>NoOptOut</b>    | The user has not opted out of either local or grid optimizations | M           |
| 1     | <b>LocalOptOut</b> | The user has opted out of local EMS optimizations only           | M           |
| 2     | <b>GridOptOut</b>  | The user has opted out of grid EMS optimizations only            | M           |
| 3     | <b>OptOut</b>      | The user has opted out of all external optimizations             | M           |

#### 9.2.7.5. CauseEnum Type

This data type is derived from enum8.

| Value | Name                    | Summary                                                         | Conformance |
|-------|-------------------------|-----------------------------------------------------------------|-------------|
| 0     | <b>NormalCompletion</b> | The ESA completed the power adjustment as requested             | M           |
| 1     | <b>Offline</b>          | The ESA was set to offline                                      | M           |
| 2     | <b>Fault</b>            | The ESA has developed a fault could not complete the adjustment | M           |
| 3     | <b>UserOptOut</b>       | The user has disabled the ESA's flexibility capability          | M           |
| 4     | <b>Cancelled</b>        | The adjustment was cancelled by a client                        | M           |

Page 690



### 9.2.7.6. AdjustmentCauseEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                              | Conformance |
|-------|--------------------------|------------------------------------------------------|-------------|
| 0     | <b>LocalOptimization</b> | The adjustment is to optimize the local energy usage | M           |
| 1     | <b>GridOptimization</b>  | The adjustment is to optimize the grid energy usage  | M           |

### 9.2.7.7. ForecastUpdateReasonEnum Type

This data type is derived from enum8.

| Value | Name                        | Summary                                                | Conformance |
|-------|-----------------------------|--------------------------------------------------------|-------------|
| 0     | <b>InternalOptimization</b> | The update was due to internal ESA device optimization | M           |
| 1     | <b>LocalOptimization</b>    | The update was due to local EMS optimization           | M           |
| 2     | <b>GridOptimization</b>     | The update was due to grid optimization                | M           |

### 9.2.7.8. PowerAdjustReasonEnum Type

This data type is derived from enum8.

| Value | Name                               | Summary                                                       | Conformance |
|-------|------------------------------------|---------------------------------------------------------------|-------------|
| 0     | <b>NoAdjustment</b>                | There is no Power Adjustment active                           | M           |
| 1     | <b>LocalOptimizationAdjustment</b> | There is PowerAdjustment active due to local EMS optimization | M           |
| 2     | <b>GridOptimizationAdjustment</b>  | There is PowerAdjustment active due to grid optimization      | M           |

### 9.2.7.9. CostStruct Type

This indicates a generic mechanism for expressing cost to run an appliance, in terms of financial, GHG emissions, comfort value etc.



Page 691



| ID | Name                  | Type                         | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------|------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>CostType</b>       | <a href="#">CostTypeEnum</a> | all        |         |          |        | M           |
| 1  | <b>Value</b>          | int32                        | all        |         |          |        | M           |
| 2  | <b>Decimal-Points</b> | uint8                        | all        |         |          |        | M           |
| 3  | <b>Currency</b>       | uint16                       | max 999    |         | 0        |        | O           |

#### 9.2.7.9.1. CostType Field

This field SHALL indicate the type of cost being represented (see [CostTypeEnum](#)).

#### 9.2.7.9.2. Value Field

This field SHALL indicate the value of the cost. This may be negative (indicating that it is not a cost, but a free benefit).

For example, if the Value was -302 and DecimalPoints was 2, then this would represent a benefit of 3.02.

#### 9.2.7.9.3. DecimalPoints Field

This field SHALL indicate the number of digits to the right of the decimal point in the Value field. For example, if the Value was 102 and DecimalPoints was 2, then this would represent a cost of 1.02.

#### 9.2.7.9.4. Currency Field

Indicates the currency for the value in the [Value](#) field. The value of the currency field SHALL match the values defined by [\[ISO 4217\]](#).

This is an optional field. It SHALL be included if CostType is Financial.

### 9.2.7.10. PowerAdjustStruct Type

| ID | Name               | Type      | Constraint       | Quality | Fallback | Access | Conformance |
|----|--------------------|-----------|------------------|---------|----------|--------|-------------|
| 0  | <b>MinPower</b>    | power-mW  | all              |         |          |        | M           |
| 1  | <b>MaxPower</b>    | power-mW  | min Min-Power    |         |          |        | M           |
| 2  | <b>MinDuration</b> | elapsed-s | all              |         |          |        | M           |
| 3  | <b>MaxDuration</b> | elapsed-s | min Min-Duration |         |          |        | M           |

Page 692



**9.2.7.10.1. MinPower Field**

This field SHALL indicate the minimum power that the ESA can have its power adjusted to.

Note that this is a signed value. Negative values indicate power flows out of the node (e.g. discharging a battery).

**9.2.7.10.2. MaxPower Field**

This field SHALL indicate the maximum power that the ESA can have its power adjusted to.

Note that this is a signed value. Negative values indicate power flows out of the node (e.g. discharging a battery).

For example, if the charging current of an EVSE can be adjusted within the range of 6A to 32A on a 230V supply, then the power adjustment range is between 1380W and 7360W. Here the MinPower would be 1380W, and MaxPower would be 7360W.

For example, if a battery storage inverter can discharge between 0 to 3000W towards a load, then power is flowing out of the node and is therefore negative. Its MinPower would be -3000W and its MaxPower would be 0W.

In another example, if a battery storage inverter can charge its internal battery, between 0W and 2000W. Here power is flowing into the node when charging. As such the MinPower becomes 0W and MaxPower becomes 2000W.

**9.2.7.10.3. MinDuration field**

This field SHALL indicate the minimum duration, in seconds, that a controller may invoke an ESA power adjustment. Manufacturers may use this to as an anti-cycling capability to avoid controllers from rapidly making power adjustments.

**9.2.7.10.4. MaxDuration field**

This field SHALL indicate the maximum duration, in seconds, that a controller may invoke an ESA power adjustment. Manufacturers may use this to protect the user experience, to avoid over heating of the ESA, ensuring that there is sufficient headroom to use or store energy in the ESA or for any other reason.

**9.2.7.11. PowerAdjustCapabilityStruct Type**

| ID | Name                         | Type                                      | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------------|-------------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>PowerAdjustCapability</b> | list[ <a href="#">PowerAdjustStruct</a> ] | max 8      | X       |          |        | M           |
| 1  | <b>Cause</b>                 | <a href="#">PowerAdjustReasonEnum</a>     | all        |         |          |        | M           |



Page 693



### 9.2.7.12. PowerAdjustCapability

This field SHALL indicate how the ESA can be adjusted at the current time.

For example, a battery storage inverter may need to regulate its internal temperature, or the charging rate of the battery may be limited due to cold temperatures, or a change in the state of charge of the battery may mean that the maximum charging or discharging rate is limited.

An empty list SHALL indicate that no power adjustment is currently possible.

Multiple entries in the list allow indicating that permutations of scenarios may be possible.

For example, a 10kWh battery could be at 80% state of charge. If charging at 2kW, then it would be full in 1 hour. However, it could be discharged at 2kW for 4 hours.

In this example the list of [PowerAdjustStructs](#) allows multiple scenarios to be offered as follows:

| Entry [0] - Charging option:    |       |                   |
|---------------------------------|-------|-------------------|
| MinPower                        | 0     | Watts             |
| MaxPower                        | 2000  | Watts             |
| MinDuration                     | 60    | seconds           |
| MaxDuration                     | 3600  | seconds (1 hour)  |
| Entry [1] - Discharging option: |       |                   |
| MinPower                        | -2000 | Watts             |
| MaxPower                        | 0     | Watts             |
| MinDuration                     | 60    | seconds           |
| MaxDuration                     | 14400 | seconds (4 hours) |

#### 9.2.7.12.1. Cause field

This field SHALL indicate the cause of the currently active power adjustment.

### 9.2.7.13. ForecastStruct Type

This indicates a list of 'slots' describing the overall timing of the ESA's planned energy and power use, with different power and energy demands per slot. For example, slots might be used to describe the distinct stages of a washing machine cycle.

Where an ESA does not know the actual power and energy use of the system, it may support the [SFR](#) feature and instead report its internal state.

| ID | Name       | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|------------|--------|------------|---------|----------|--------|-------------|
| 0  | ForecastID | uint32 | all        |         |          |        | M           |

Page 694







| ID | Name                 | Type                     | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------|--------------------------|------------|---------|----------|--------|-------------|
| 1  | ActiveSlotNumber     | uint16                   | all        | X       |          |        | M           |
| 2  | StartTime            | epoch-s                  | all        |         |          |        | M           |
| 3  | EndTime              | epoch-s                  | all        |         |          |        | M           |
| 4  | EarliestStartTime    | epoch-s                  | all        | X       |          |        | STA         |
| 5  | LatestEndTime        | epoch-s                  | all        |         |          |        | STA         |
| 6  | IsPausable           | bool                     | all        |         |          |        | M           |
| 7  | Slots                | list[SlotStruct]         | max 10     |         |          |        | M           |
| 8  | ForecastUpdateReason | ForecastUpdateReasonEnum | all        |         |          |        | M           |

#### 9.2.7.13.1. ForecastID Field

This field SHALL indicate the sequence number for the current forecast. If the ESA updates a forecast, it shall monotonically increase this value.

The ESA does not need to persist this value across reboots, since the EMS SHOULD be able to detect that any previous subscriptions are lost if a device reboots. The loss of a subscription and subsequent re-subscription allows the EMS to learn about any new forecasts.

The value of ForecastID is allowed to wrap.

#### 9.2.7.13.2. ActiveSlotNumber Field

This field SHALL indicate which element of the Slots list is currently active in the Forecast sequence. A null value indicates that the sequence has not yet started.

#### 9.2.7.13.3. StartTime Field

This field SHALL indicate the planned start time, in UTC, for the entire Forecast.

#### 9.2.7.13.4. EndTime Field

This field SHALL indicate the planned end time, in UTC, for the entire Forecast.

#### 9.2.7.13.5. EarliestStartTime Field

This field SHALL indicate the earliest start time, in UTC, that the entire Forecast can be shifted to.

A null value indicates that it can be started immediately.




Page 695



**9.2.7.13.6. LatestEndTime Field**

This field SHALL indicate the latest end time, in UTC, for the entire Forecast.

e.g. for an EVSE charging session, this may indicate the departure time for the vehicle, by which time the charging session must end.

**9.2.7.13.7. IsPausable Field**

This field SHALL indicate that some part of the Forecast can be paused. It aims to allow a client to read this flag and if it is false, then none of the slots contain SlotIsPausable set to true. This can save a client from having to check each slot in the list.

**9.2.7.13.8. Slots Field**

This field SHALL contain a list of SlotStructs.

It SHALL contain at least 1 entry, and a maximum of 10.

**9.2.7.13.9. ForecastUpdateReason Field**

This field SHALL contain the reason the current Forecast was generated.

**9.2.7.14. SlotStruct Type**

This indicates a specific stage of an ESA's operation.

| ID | Name                     | Type      | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------------|-----------|------------|---------|----------|--------|-------------|
| 0  | <b>MinDuration</b>       | elapsed-s | all        |         |          |        | M           |
| 1  | <b>MaxDuration</b>       | elapsed-s | all        |         |          |        | M           |
| 2  | <b>DefaultDuration</b>   | elapsed-s | all        |         |          |        | M           |
| 3  | <b>ElapsedSlotTime</b>   | elapsed-s | all        |         |          |        | M           |
| 4  | <b>RemainingSlotTime</b> | elapsed-s | all        |         |          |        | M           |
| 5  | <b>SlotIsPausable</b>    | bool      | all        |         |          |        | PAU         |
| 6  | <b>MinPauseDuration</b>  | elapsed-s | all        |         |          |        | PAU         |

Page 696







| ID | Name                         | Type                                | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------------|-------------------------------------|------------|---------|----------|--------|-------------|
| 7  | <b>Max-PauseDuration</b>     | elapsed-s                           | all        |         |          |        | PAU         |
| 8  | <b>ManufacturerESATate</b>   | uint16                              | all        |         |          |        | SFR         |
| 9  | <b>NominalPower</b>          | power-mW                            | all        |         |          |        | PFR         |
| 10 | <b>MinPower</b>              | power-mW                            | all        |         |          |        | PFR         |
| 11 | <b>MaxPower</b>              | power-mW                            | all        |         |          |        | PFR         |
| 12 | <b>NominalEnergy</b>         | energy-mWh                          | all        |         |          |        | PFR         |
| 13 | <b>Costs</b>                 | list[ <a href="#">Cost-Struct</a> ] | max 5      |         |          |        | O           |
| 14 | <b>MinPowerAdjustment</b>    | power-mW                            | all        |         |          |        | FA & PFR    |
| 15 | <b>MaxPowerAdjustment</b>    | power-mW                            | all        |         |          |        | FA & PFR    |
| 16 | <b>MinDurationAdjustment</b> | elapsed-s                           | all        |         |          |        | FA          |
| 17 | <b>MaxDurationAdjustment</b> | elapsed-s                           | all        |         |          |        | FA          |

#### 9.2.7.14.1. MinDuration Field

This field SHALL indicate the minimum time (in seconds) that the appliance expects to be in this slot for.

#### 9.2.7.14.2. MaxDuration Field

This field SHALL indicate the maximum time (in seconds) that the appliance expects to be in this slot for.

#### 9.2.7.14.3. DefaultDuration Field

This field SHALL indicate the expected time (in seconds) that the appliance expects to be in this slot for.




Page 697



#### 9.2.7.14.4. ElapsedSlotTime Field

This field SHALL indicate the time (in seconds) that has already elapsed whilst in this slot. If the slot has not yet been started, then it SHALL be 0. Once the slot has been completed, then this reflects how much time was spent in this slot.

When subscribed to, a change in this field value SHALL NOT cause the Forecast attribute to be updated since this value may change every 1 second.

When the Forecast attribute is read, then this value SHALL be the most recent value.

#### 9.2.7.14.5. RemainingSlotTime Field

This field SHALL indicate the time (in seconds) that is estimated to be remaining.

Note that it may not align to the [DefaultDuration](#) - [ElapsedSlotTime](#) since an appliance may have revised its planned operation based on conditions.

When subscribed to, a change in this field value SHALL NOT cause the Forecast attribute to be updated, since this value may change every 1 second.

Note that if the ESA is currently paused, then this value SHALL NOT change.

When the Forecast attribute is read, then this value SHALL be the most recent value.

#### 9.2.7.14.6. SlotIsPausable Field

This field SHALL indicate whether this slot can be paused.

#### 9.2.7.14.7. MinPauseDuration Field

This field SHALL indicate the shortest period that the slot can be paused for. This can be set to avoid controllers trying to pause ESAs for short periods and then resuming operation in a cyclic fashion which may damage or cause excess energy to be consumed with restarting of an operation.

#### 9.2.7.14.8. MaxPauseDuration Field

This field SHALL indicate the longest period that the slot can be paused for.

#### 9.2.7.14.9. ManufacturerESASState Field

This field SHALL indicate a manufacturer defined value indicating the state of the ESA.

This may be used by an observing EMS which also has access to the metering data to ascertain the typical power drawn when the ESA is in a manufacturer defined state.

Some appliances, such as smart thermostats, may not know how much power is being drawn by the HVAC system, but do know what they have asked the HVAC system to do.

Manufacturers can use this value to indicate a variety of states in an unspecified way. For example, they may choose to use values between 0-100 as a percentage of compressor modulation, or could use these values as Enum states meaning heating with fan, heating without fan etc.

Page 698







**NOTE** An ESA SHALL always use the same value to represent the same operating state.

By providing this information a smart EMS may be able to learn the observed power draw when the ESA is put into a specific state. It can potentially then use the ManufacturerESATate field in the Forecast attribute along with observed power drawn to predict the power draw from the appliance and potentially ask it to modify its timing via one of the adjustment request commands, or adjust other ESAs power to compensate.

#### 9.2.7.14.10. NominalPower Field

This field SHALL indicate the expected power that the appliance will use during this slot. It may be considered the average value over the slot, and some variation from this would be expected (for example, as it is ramping up).

#### 9.2.7.14.11. MinPower Field

This field SHALL indicate the lowest power that the appliance expects to use during this slot. (e.g. during a ramp up it may be 0W).

Some appliances (e.g. battery inverters which can charge and discharge) may have a negative power.

#### 9.2.7.14.12. MaxPower Field

This field SHALL indicate the maximum power that the appliance expects to use during this slot. (e.g. during a ramp up it may be 0W). This field ignores the effects of short-lived inrush currents.

Some appliances (e.g. battery inverters which can charge and discharge) may have a negative power.

#### 9.2.7.14.13. NominalEnergy Field

This field SHALL indicate the expected energy that the appliance expects to use or produce during this slot.

Some appliances (e.g. battery inverters which can charge and discharge) may have a negative energy.

#### 9.2.7.14.14. Costs Field

This field SHALL indicate the current estimated cost for operating.

For example, if the device has access to an Energy pricing server it may be able to use the tariff to estimate the cost of energy for this slot in the power forecast.

When an Energy Management System requests a change in the schedule, then the device MAY suggest a change in the cost as a result of shifting its energy. This can allow a demand side response service to be informed of the relative cost to use energy at a different time.

The Costs field is a list of CostStruct structures which allows multiple CostTypeEnum and Values to be shared by the energy appliance. These could be based on GHG emissions, comfort value for the



Page 699



consumer etc.

For example, comfort could be expressed in abstract units or in currency. A water heater that is heated earlier in the day is likely to lose some of its heat before it is needed, which could require a top-up heating event to occur later in the day (which may incur additional cost).

If the ESA cannot calculate its cost for any reason (such as losing its connection to a Price server) it may omit this field. This is treated as extra meta data that an EMS may use to optimize a system.

#### 9.2.7.14.15. **MinPowerAdjustment Field**

This field SHALL indicate the minimum power that the appliance can be requested to use.

For example, some EVSEs cannot be switched on to charge below 6A which may equate to ~1.3kW in EU markets. If the slot indicates a [NominalPower](#) of 0W (indicating it is expecting to be off), this allows an ESA to indicate it could be switched on to charge, but this would be the minimum power limit it can be set to.

#### 9.2.7.14.16. **MaxPowerAdjustment Field**

This field SHALL indicate the maximum power that the appliance can be requested to use.

For example, an EVSE may be limited by its electrical supply to 32A which would be ~7.6kW in EU markets. If the slot indicates a [NominalPower](#) of 0W (indicating it is expecting to be off), this allows an ESA to indicate it could be switched on to charge, but this would be the maximum power limit it can be set to.

#### 9.2.7.14.17. **MinDurationAdjustment Field**

This field SHALL indicate the minimum time, in seconds, that the slot can be requested to shortened to.

For example, if the slot indicates a [NominalPower](#) of 0W (indicating it is expecting to be off), this would allow an ESA to specify the minimum time it could be switched on for. This is to help protect the appliance from being damaged by short cycling times.

For example, a heat pump compressor may have a minimum cycle time of order a few minutes.

#### 9.2.7.14.18. **MaxDurationAdjustment Field**

This field SHALL indicate the maximum time, in seconds, that the slot can be requested to extended to.

For example, if the slot indicates a [NominalPower](#) of 0W (indicating it is expecting to be off), this allows an ESA to specify the maximum time it could be switched on for. This may allow a battery or water heater to indicate the maximum duration that it can charge for before becoming full. In the case of a battery inverter which can be discharged, it may equally indicate the maximum time the battery could be discharged for (at the [MaxPowerAdjustment](#) power level).

Page 700







### 9.2.7.15. SlotAdjustmentStruct Type

| ID | Name                | Type      | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------|-----------|------------|---------|----------|--------|-------------|
| 0  | <b>SlotIndex</b>    | uint8     | desc       |         |          |        | M           |
| 1  | <b>NominalPower</b> | power-mW  | desc       |         |          |        | PFR         |
| 2  | <b>Duration</b>     | elapsed-s | desc       |         |          |        | M           |

#### 9.2.7.15.1. SlotIndex Field

This field SHALL indicate the index into the Slots list within the [Forecast](#) that is to be modified. It SHALL be less than the actual length of the Slots list (implicitly it must be in the range 0 to 9 based on the maximum length of the Slots list constraint).

#### 9.2.7.15.2. NominalPower Field

This field SHALL indicate the new requested power that the ESA SHALL operate at. It SHALL be between the [AbsMinPower](#) and [AbsMaxPower](#) attributes as advertised by the ESA if it supports [PFR](#).

This is a signed value and can be used to indicate charging or discharging.

If the ESA does NOT support [PFR](#) this value SHALL be ignored by the ESA.

#### 9.2.7.15.3. Duration Field

This field SHALL indicate the new requested duration, in seconds, that the ESA SHALL extend or shorten the slot duration to. It SHALL be between the [MinDurationAdjustment](#) and [MaxDurationAdjustment](#) for the slot as advertised by the ESA.

### 9.2.7.16. ConstraintsStruct Type

The ConstraintsStruct allows a client to inform an ESA about a constraint period (such as a grid event, or perhaps excess solar PV). The format allows the client to suggest that the ESA can either turn up its energy consumption, or turn down its energy consumption during this period.

| ID | Name                 | Type       | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------|------------|------------|---------|----------|--------|-------------|
| 0  | <b>StartTime</b>     | epoch-s    | desc       |         |          |        | M           |
| 1  | <b>Duration</b>      | elapsed-s  | max 86400  |         |          |        | M           |
| 2  | <b>NominalPower</b>  | power-mW   | desc       |         |          |        | PFR         |
| 3  | <b>MaximumEnergy</b> | energy-mWh | all        |         |          |        | PFR         |
| 4  | <b>LoadControl</b>   | int8       | all        |         |          |        | SFR         |



Page 701



**9.2.7.16.1. StartTime Field**

This field SHALL indicate the start time of the constraint period that the client wishes the ESA to compute a new Forecast.

This value is in UTC and SHALL be in the future.

**9.2.7.16.2. Duration Field**

This field SHALL indicate the duration of the constraint in seconds.

**9.2.7.16.3. NominalPower Field**

This field SHALL indicate the nominal power that client wishes the ESA to operate at during the constrained period. It SHALL be between the [AbsMinPower](#) and [AbsMaxPower](#) attributes as advertised by the ESA if it supports [PFR](#).

This is a signed value and can be used to indicate charging or discharging.

**9.2.7.16.4. MaximumEnergy Field**

This field SHALL indicate the maximum energy that can be transferred to or from the ESA during the constraint period.

This is a signed value and can be used to indicate charging or discharging.

**9.2.7.16.5. LoadControl Field**

This field SHALL indicate the turn up or turn down nature that the grid wants as the outcome by the ESA during the constraint period.

This is expressed as a signed value between -100 to +100. A value of 0 would indicate no bias to using more or less energy. A negative value indicates a request to use less energy. A positive value indicates a request to use more energy.

Note that the mapping between values and operation is manufacturer specific.

**9.2.8. Attributes**

| ID     | Name                   | Type                         | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------|------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>ESAType</b>         | <a href="#">ESAType-Enum</a> | all        | F       |          | R V    | M           |
| 0x0001 | <b>ESACan-Generate</b> | bool                         | all        | F       |          | R V    | M           |
| 0x0002 | <b>ESAState</b>        | <a href="#">ESAStateEnum</a> | desc       |         |          | R V    | M           |
| 0x0003 | <b>AbsMin-Power</b>    | power-mW                     | all        |         |          | R V    | M           |

Page 702



| ID     | Name                       | Type                        | Constraint          | Quality | Fallback | Access | Conformance                     |
|--------|----------------------------|-----------------------------|---------------------|---------|----------|--------|---------------------------------|
| 0x0004 | AbsMax-Power               | power-mW                    | min<br>AbsMin-Power |         |          | RV     | M                               |
| 0x0005 | PowerAdjustment-Capability | PowerAdjustCapabilityStruct | all                 | Q X     |          | RV     | PA                              |
| 0x0006 | Forecast                   | Forecast-Struct             | all                 | Q X     |          | RV     | PFR   SFR                       |
| 0x0007 | OptOut-State               | OptOutStateEnum             | desc                |         |          | RV     | PA   STA  <br>PAU   FA  <br>CON |

#### 9.2.8.1. ESAType Attribute

This attribute SHALL indicate the type of ESA.

This attribute enables an EMS to understand some of the basic properties about how the energy may be consumed, generated, and stored by the ESA.

For example, the heat energy converted by a heat pump will naturally be lost through the building to the outdoor environment relatively quickly, compared to storing heat in a well-insulated hot water tank. Similarly, battery storage and EVs can store electrical energy for much longer durations.

This attribute can also help the EMS display information to a user and to make basic assumptions about typical best use of energy. For example, an EVSE may not always have an EV plugged in, so knowing the type of ESA that is being controlled can allow advanced energy management strategies.

#### 9.2.8.2. ESACanGenerate Attribute

This attribute SHALL indicate whether the ESA is classed as a generator or load. This allows an EMS to understand whether the power values reported by the ESA need to have their sign inverted when dealing with forecasts and adjustments.

For example, a solar PV inverter (being a generator) may produce negative values to indicate generation (since power is flowing out of the node into the home), however a display showing the power to the consumers may need to present a positive solar production value to the consumer.

For example, a home battery storage system (BESS) which needs to charge the battery and then discharge to the home loads, would be classed as a generator. These types of devices SHALL have this field set to true. When generating its forecast or advertising its PowerAdjustmentCapability, the power values shall be negative to indicate discharging to the loads in the home, and positive to indicate when it is charging its battery.



Page 703



$$\text{GRID meter} = \Sigma \text{ LoadPowers} + \Sigma \text{ GeneratorPowers}$$

Example:

| Home has the following loads: |              |
|-------------------------------|--------------|
| Water Heater:                 | 3000W        |
| TV:                           | 200W         |
| FridgeFreezer:                | 200W         |
| <b>Total:</b>                 | <b>3400W</b> |

| Home has the following generators (ESACanGenerate = true) |               |
|-----------------------------------------------------------|---------------|
| Solar:                                                    | -2500W        |
| BESS:                                                     | -900W         |
| <b>Total:</b>                                             | <b>-3400W</b> |

| GRID Meter:          |           |
|----------------------|-----------|
| $\Sigma$ Loads:      | 3400W     |
| $\Sigma$ Generators: | -3400W    |
| <b>Total:</b>        | <b>0W</b> |

#### 9.2.8.3. ESASState Attribute

This attribute SHALL indicate the current state of the ESA.

If the ESA is in the Offline or Fault state it cannot be controlled by an EMS, and may not be able to report its Forecast information. An EMS may subscribe to the [ESASState](#) to get notified about changes in operational state.

The ESA may have a local user interface to allow a service technician to put the ESA into Offline mode, for example to avoid the EMS accidentally starting or stopping the appliance when it is being serviced or tested.

#### 9.2.8.4. AbsMinPower Attribute

This attribute SHALL indicate the minimum electrical power that the ESA can consume when switched on. This does not include when in power save or standby modes.

##### NOTE

For Generator ESAs that can discharge an internal battery (such as a battery storage inverter) to loads in the home, the [AbsMinPower](#) will be a negative number representing the maximum power that the ESA can discharge its internal battery.

Page 704







### 9.2.8.5. AbsMaxPower Attribute

This attribute SHALL indicate the maximum electrical power that the ESA can consume when switched on.

Note that for Generator ESAs that can charge a battery by importing power into the node (such as a battery storage inverter), the [AbsMaxPower](#) will be a positive number representing the maximum power at which the ESA can charge its internal battery.

For example, a battery storage inverter that can charge its battery at a maximum power of 2000W and can discharge the battery at a maximum power of 3000W, would have a [AbsMinPower](#): -3000, [AbsMaxPower](#): 2000W.

### 9.2.8.6. PowerAdjustmentCapability Attribute

This attribute SHALL indicate how the ESA can be adjusted at the current time, and the state of any active adjustment.

A null value indicates that no power adjustment is currently possible, and nor is any adjustment currently active.

This attribute SHOULD be updated periodically by ESAs to reflect any changes in internal state, for example temperature or stored energy, which would affect the power or duration limits.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once every 10 seconds on changes, or
- When it changes from null to any other value and vice versa.

### 9.2.8.7. Forecast Attribute

This attribute allows an ESA to share its intended forecast with a client (such as an Energy Management System).

A null value indicates that there is no forecast currently available (for example, a program has not yet been selected by the user).

A server MAY reset this value attribute to null on a reboot, and it does not need to persist any previous forecasts.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once every 10 seconds on changes, or
- When it changes from null to any other value and vice versa, or
- As a result of a command which causes the forecast to be updated, or
- As a result of a change in the opt-out status which in turn may cause the ESA to recalculate its forecast.



Page 705



### 9.2.8.8. OptOutState Attribute

This attribute SHALL indicate the current Opt-Out state of the ESA. The ESA may have a local user interface to allow the user to control this OptOutState. An EMS may subscribe to the [OptOutState](#) to get notified about changes in operational state.

If the ESA is in the LocalOptOut or OptOut states, so it cannot be controlled by an EMS for local optimization reasons, it SHALL reject any commands which have the [AdjustmentCauseEnum](#) value LocalOptimization. If the ESA is in the GridOptOut or OptOut states, so it cannot be controlled by an EMS for grid optimization reasons, it SHALL reject any commands which have the [AdjustmentCauseEnum](#) value GridOptimization.

If the user changes the Opt-Out state of the ESA which is currently operating with a Forecast that is due to a previous [StartTimeAdjustRequest](#), [ModifyForecastRequest](#) or [RequestConstraintBasedForecast](#) command that would now not be permitted due to the new Opt-out state (i.e. the [Forecast](#) attribute [ForecastUpdateReason](#) field currently contains a reason which is now opted out), the ESA SHALL behave as if it had received a [CancelRequest](#) command.

If the user changes the Opt-Out state of the ESA which currently has the [ESASStateEnum](#) with value **Paused** due to a previous [PauseRequest](#) command that would now not be permitted due to the new Opt-out state, and the ESA supports the [PFR](#) or [SFR](#) features (i.e. the [Forecast](#) attribute [ForecastUpdateReason](#) field currently contains a reason which is now opted out), the ESA SHALL behave as if it had received a [ResumeRequest](#) command.

If the user changes the Opt-Out state of the ESA which currently has the [ESASStateEnum](#) with value **PowerAdjustActive** due to a previous [PowerAdjustRequest](#) command that would now not be permitted due to the new Opt-out state (i.e. the [Forecast](#) attribute [ForecastUpdateReason](#) field currently contains a reason which is now opted out), the ESA SHALL behave as if it had received a [CancelPowerAdjustRequest](#) command.

If the ESA is in the LocalOptOut, GridOptOut, or NoOptOut states, the device is still permitted to optimize its own energy usage, for example, using tariff information it may obtain.

### 9.2.9. Commands

| ID   | Name                            | Direction       | Response | Access | Conformance |
|------|---------------------------------|-----------------|----------|--------|-------------|
| 0x00 | <b>PowerAdjustRequest</b>       | client ⇒ server | Y        | O      | PA          |
| 0x01 | <b>CancelPowerAdjustRequest</b> | client ⇒ server | Y        | O      | PA          |
| 0x02 | <b>StartTimeAdjustRequest</b>   | client ⇒ server | Y        | O      | STA         |
| 0x03 | <b>PauseRequest</b>             | client ⇒ server | Y        | O      | PAU         |
| 0x04 | <b>ResumeRequest</b>            | client ⇒ server | Y        | O      | PAU         |
| 0x05 | <b>ModifyForecastRequest</b>    | client ⇒ server | Y        | O      | FA          |

Page 706



| ID   | Name                                  | Direction                   | Response | Access | Conformance    |
|------|---------------------------------------|-----------------------------|----------|--------|----------------|
| 0x06 | <b>RequestConstraintBasedForecast</b> | client $\Rightarrow$ server | Y        | O      | CON            |
| 0x07 | <b>CancelRequest</b>                  | client $\Rightarrow$ server | Y        | O      | STA   FA   CON |

### 9.2.9.1. PowerAdjustRequest Command

Allows a client to request an adjustment in the power consumption of an ESA for a specified duration.

| ID | Name            | Type                | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------------|------------|---------|----------|-------------|
| 0  | <b>Power</b>    | power-mW            | desc       |         |          | M           |
| 1  | <b>Duration</b> | elapsed-s           | desc       |         |          | M           |
| 2  | <b>Cause</b>    | AdjustmentCauseEnum | desc       |         |          | M           |

#### 9.2.9.1.1. Power Field

This field SHALL indicate the power that the ESA SHALL use during the adjustment period.

This value SHALL be between the MinPower and MaxPower fields of the [PowerAdjustStruct](#) in the PowerAdjustmentCapability attribute.

#### 9.2.9.1.2. Duration Field

This field SHALL indicate the duration that the ESA SHALL maintain the requested power for.

This value SHALL be between the MinDuration and MaxDuration fields of the [PowerAdjustStruct](#) in the PowerAdjustmentCapability attribute.

#### 9.2.9.1.3. Cause Field

This field SHALL indicate the cause of the request from the EMS.

#### 9.2.9.1.4. Effect on receipt

On receipt of this command, the ESA SHALL validate that the Power and Duration specified in the command are within the limits of its current operation and advertised [PowerAdjustmentCapability](#) attribute, the [OptOutState](#) permits the specified [AdjustmentCauseEnum](#) (see [OptOutState](#) for details), and the [ESASState](#) is Online.

If the PowerAdjustRequest command is accepted, then the ESA SHALL change its [ESASState](#) to PowerAdjustActive, and the [PowerAdjustmentCapability](#) attribute SHALL be updated to set the Cause value from the Cause field of this command.

The command status returned SHALL be SUCCESS if the adjustment is accepted; otherwise the com-



Page 707



mand SHALL be rejected with `CONSTRAINT_ERROR` if the Power, Duration, or Cause values are not permitted as above, or with `FAILURE` otherwise.

### Start of adjustment

The ESA SHALL generate a `PowerAdjustStart` Event when it begins to adjust its power.

The ESA then begins to adjust its power consumption or generation to the power level commanded in the Power field.

### End of adjustment (normal completion)

After the elapsed duration, the ESA SHALL revert to normal (or idle) power levels.

The ESA SHALL also generate a `PowerAdjustEnd` Event with a cause code to indicate a 'Normal completion', the `ESASTate` SHALL be restored to Online, and the `PowerAdjustmentCapability` attribute SHALL be updated to set the Cause value to 'NoAdjustment'.

### Failure or Opt-out during adjustment

If during the power adjustment session a failure or other condition occurs (such as the user deciding to opt-out by updating the `OptOutState`) then the ESA SHALL generate a `PowerAdjustEnd` Event to indicate the end of the session, with the appropriate cause code.

The `ESASTate` SHALL be updated to reflect the new state, and the `PowerAdjustmentCapability` attribute SHALL be updated to set the Cause value to 'NoAdjustment'.

### Receiving a new PowerAdjustRequest command when adjustment is on-going

If an existing power adjustment is already happening, and a new `PowerAdjustRequest` command is received, then if the ESA allows it, the ESA SHALL return `SUCCESS`, and the `PowerAdjustmentCapability` attribute SHALL be updated to set the Cause value from the Cause field of the new command. If the ESA does not permit this new `PowerAdjustmentRequest` command to interrupt the adjustment that is in progress, it SHALL return `BUSY`.

Note that if the new command is accepted, then the ESA SHALL NOT generate a new `PowerAdjustEnd` Event until the new duration has elapsed. This is to avoid generating too many events in cases where a device is routinely commanded with overlapping power adjustments.

For example, a battery inverter ESA may be sent a new request every 5 seconds to adjust its discharge power based on real-time meter readings. Each command may have a 60 second duration, but this command is superseded after 5 seconds by a new request.

After the client has sent its last command and after this command duration expires then the last active power adjustment has been completed. This final command causes the `PowerAdjustEnd` Event to be generated when the `ESASTate` is restored to Online, and the `PowerAdjustmentCapability` attribute SHALL be updated to set the Cause value to 'NoAdjustment'.

#### 9.2.9.2. CancelPowerAdjustRequest Command

Allows a client to cancel an ongoing `PowerAdjustmentRequest` operation.

Page 708



### 9.2.9.2.1. Effect on receipt

On receipt of this command, the ESA SHALL end the active power adjustment session and return to normal (or idle) power levels.

If the [ESASState](#) is not PowerAdjustActive, then the command SHALL be rejected with INVALID\_IN\_STATE.

If the command is accepted, the ESA SHALL generate an [PowerAdjustEnd](#) Event and the [ESASState](#) SHALL be restored to Online, the [PowerAdjustmentCapability](#) attribute SHALL be updated to set the Cause value to 'NoAdjustment', and the command status returned SHALL be SUCCESS.

### 9.2.9.3. StartTimeAdjustRequest Command

Allows a client to adjust the start time of a Forecast sequence that has not yet started operation (i.e. where the current Forecast StartTime is in the future).

| ID | Name                       | Type                                | Constraint | Quality | Fallback | Conformance |
|----|----------------------------|-------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Requested-StartTime</b> | epoch-s                             | desc       |         |          | M           |
| 1  | <b>Cause</b>               | <a href="#">AdjustmentCauseEnum</a> | all        |         |          | M           |

#### 9.2.9.3.1. RequestedStartTime Field

This field SHALL indicate the requested start time, in UTC, that the client would like the appliance to shift its Forecast to. This value SHALL be in the future.

A client can estimate the entire Forecast sequence duration by computing the [EndTime - StartTime](#) fields from the [Forecast](#) attribute, and therefore avoid scheduling the start time too late.

This value SHALL be after the EarliestStartTime in the Forecast attribute. The new EndTime, that can be computed from the RequestedStartTime and the Forecast sequence duration, SHALL be before the LatestEndTime.

#### 9.2.9.3.2. Cause Field

This field SHALL indicate the cause of the request from the EMS.

#### 9.2.9.3.3. Effect on receipt

On receipt of this command, if the ESA supports [STA](#), and the [OptOutState](#) permits the specified [AdjustmentCauseEnum](#) (see [OptOutState](#) for details), and the RequestedStartTime adjustment would be within constraints described in [RequestedStartTime](#) then ESA SHALL accept the request to modify the Start Time.

If the RequestedStartTime value resulted in a time shift which is outside the time constraints of EarliestStartTime and LatestEndTime, or the Cause is not permitted, then the command SHALL be rejected with CONSTRAINT\_ERROR; in other failure scenarios the command SHALL be rejected with




Page 709



FAILURE.

The command status returned SHALL be SUCCESS if the StartTime in the Forecast is updated. The ESA SHALL update its [Forecast](#) attribute using the new [RequestedStartTime](#) including a new ForecastID, StartTime, EndTime, and [ForecastUpdateReason](#).

#### 9.2.9.4. PauseRequest Command

Allows a client to temporarily pause an operation and reduce the ESAs energy demand.

| ID | Name            | Type                                 | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Duration</b> | elapsed-s                            | desc       |         |          | M           |
| 1  | <b>Cause</b>    | <a href="#">Adjustment-CauseEnum</a> | all        |         |          | M           |

##### 9.2.9.4.1. Duration Field

This field SHALL indicate the duration that the ESA SHALL be paused for. This value SHALL be between the MinPauseDuration and MaxPauseDuration indicated in the ActiveSlotNumber index in the Slots list in the Forecast.

##### 9.2.9.4.2. Cause Field

This field SHALL indicate the cause of the request from the EMS.

##### 9.2.9.4.3. Effect on receipt

On receipt of this command, if the ESA supports [PAU](#) and the SlotIsPausable field is true in the ActiveSlotNumber index in the Slots list, the [OptOutState](#) permits the specified [Adjustment-CauseEnum](#) (see [OptOutState](#) for details), and the [OptOutState](#) is Online or PowerAdjustActive, the ESA SHALL allow its current operation to be Paused. If the Cause is not permitted, then the command SHALL be rejected with CONSTRAINT\_ERROR.

If the ESA SlotIsPausable field is false for the ActiveSlotNumber, then the command SHALL be rejected with FAILURE.

The ESA SHALL validate that the Duration field is within the range of [MinPauseDuration](#) and [MaxPauseDuration](#). If it is outside of this range then the command SHALL be rejected with CONSTRAINT\_ERROR.

The command status returned SHALL be SUCCESS if the ESA is paused.

Once the command has been accepted, the ESA SHALL also generate a [Paused](#) Event and the [ESAS-tate](#) SHALL be set to Paused.

The ESA SHALL update its [Forecast](#) to account for the pause, including updating the [ForecastUpdateReason](#) from the Cause field.

**Pause timer start** The ESA SHALL start a Pause timer based on the value of the Duration field.

Page 710







**Paused State** Whilst in the Paused state, the ESA SHALL NOT consume or produce significant power (other than required to keep its basic control system operational).

**Pause timer expiry** When the Pause timer expires the ESA SHALL automatically resume operation. When it does this, then it SHALL also generate a [Resumed](#) Event and the [ESASState](#) SHALL be updated accordingly to reflect its current state (for example, it may still have PowerAdjustActive now it has resumed from the Pause). The ESA SHALL update its [Forecast](#) including setting [ForecastUpdateReason](#) to [InternalOptimization](#) to account for the resumption after the pause.

**Receiving a further pause request command whilst paused** If a further Pause Request is received in the same forecast slot whilst already in the paused state, the ESA SHALL again validate that the Duration value is within the range of the (possibly revised) [MinPauseDuration](#) and [MaxPauseDuration](#). If it is outside of this range then the command SHALL be rejected with CONSTRAINT\_ERROR.

If the command is accepted the pause timer SHALL be extended by the new Duration.

**ResumeRequest** A client MAY send a ResumeRequest command, before the Pause timer has expired, to request the ESA to return to its normal operating state. See [ResumeRequest](#) for details.

**Failure or Opt-out during PauseRequest** A consumer MAY decide to opt-out of the remotely commanded PauseRequest by updating the [OptOutState](#), and the ESA SHALL also change the [ESASState](#) to the new state.

If the ESA develops a fault whilst Paused, the [ESASState](#) SHALL be set to Fault.

On change of [ESASState](#) (from Paused to another state), the ESA SHALL generate a [Resumed](#) Event.

### 9.2.9.5. ResumeRequest Command

Allows a client to cancel the PauseRequest command and enable earlier resumption of operation.

#### 9.2.9.5.1. Effect on receipt

On receipt of this command, if the ESA supports [PAU](#) and it is currently Paused, the ESA MAY decide not to resume immediately if the [MinPauseDuration](#) has not yet elapsed. This behavior is manufacturer specific.

If accepted, the ESA SHALL resume its operation. The ESA SHALL also generate a [Resumed](#) Event and the [ESASState](#) SHALL be updated accordingly to reflect its current state.

The command status returned SHALL be SUCCESS if the operation is resumed, or the command SHALL be rejected with the response INVALID\_IN\_STATE if the ESA is not currently Paused, otherwise the command SHALL be rejected with FAILURE.

The ESA SHALL update its [Forecast](#) including setting [ForecastUpdateReason](#) to [InternalOptimization](#) to account for the resumption after the pause.

### 9.2.9.6. ModifyForecastRequest Command

Allows a client to modify a Forecast within the limits allowed by the ESA.



Page 711



| ID | Name                   | Type                                         | Constraint | Quality | Fallback | Conformance |
|----|------------------------|----------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>ForecastID</b>      | uint32                                       | all        |         |          | M           |
| 1  | <b>SlotAdjustments</b> | list[ <a href="#">SlotAdjustmentStruct</a> ] | max 10     |         |          | M           |
| 2  | <b>Cause</b>           | <a href="#">AdjustmentCauseEnum</a>          | all        |         |          | M           |

#### 9.2.9.6.1. ForecastID Field

This field SHALL indicate the ForecastID that is to be modified.

#### 9.2.9.6.2. SlotAdjustments Field

This field SHALL contain a list of SlotAdjustment parameters that should be modified in the corresponding Forecast with matching ForecastID.

#### 9.2.9.6.3. Cause Field

This field SHALL indicate the cause of the request from the EMS.

#### 9.2.9.6.4. Effect on receipt

On receipt of this command, if the ESA supports [FA](#), and the [OptOutState](#) permits the specified [AdjustmentCauseEnum](#) (see [OptOutState](#) for details), it SHALL attempt to adjust its forecast.

The client may be an energy management system which has retrieved the forecasts from multiple ESA and then performed some optimization (for example, taking advantage of local solar PV generation).

The ESA SHALL inspect the requested forecast and ensure that it does not exceed the limits set in each of its slots. The ESA manufacturer may also reject the request if it could cause the user's preferences to be breached (for example, if it may cause the home to be too hot or too cold, or a battery to be insufficiently charged).

Note that the client may make an adjustment when the ESA's program has already been started. In this case the ActiveSlotNumber may have moved through the Forecast sequence. Any attempts to modify slots which have already been run SHALL result in the entire command being rejected.

The command allows a single modification to a particular slot, or to multiple slots in a single command by sending a list of modifications.

If the ESA accepts the requested Forecast then it SHALL update its [Forecast](#) attribute (incrementing its [ForecastID](#), and updating its [ForecastUpdateReason](#) from the Cause value) and run the revised Forecast as its new intended operation.

Note that an ESA may adapt its Forecast based on a slot modification. For example, if an ESA was switched on earlier in the day to take account of available solar PV, then it may not need to use

Page 712



energy later in the day. It may add or remove slots as it chooses. This may result in several iterations for the Energy Management System to reprocess updated forecasts until it has stabilized on an agreed set of changes.

If for any reason the ESA cannot accept the entire requested forecast adjustments then it SHALL reject the entire command.

If the Cause is not permitted, or the requested forecast exceeds any of the limits in the respective slots, then the command SHALL be rejected with CONSTRAINT\_ERROR, otherwise if the ForecastID is valid, and the entire list of [SlotAdjustmentStruct](#) are accepted, the command status returned SHALL be SUCCESS, otherwise the command SHALL be rejected with FAILURE.

### 9.2.9.7. RequestConstraintBasedForecast Command

Allows a client to ask the ESA to recompute its Forecast based on power and time constraints.

| ID | Name               | Type                                      | Constraint | Quality | Fallback | Conformance |
|----|--------------------|-------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Constraints</b> | list[ <a href="#">ConstraintsStruct</a> ] | max 10     |         |          | M           |
| 1  | <b>Cause</b>       | <a href="#">Adjustment-CauseEnum</a>      | all        |         |          | M           |

#### 9.2.9.7.1. Constraints Field

This field SHALL indicate the series of turn up or turn down power requests that the ESA is being asked to constrain its operation within. These requests SHALL be in the future, SHALL be in chronological order, starting with the earliest start time, and SHALL NOT overlap in time.

For example, a grid event which requires devices to reduce power (turn down) between 4pm and 6pm and due to excess power on the grid overnight, may request ESAs to increase their power demand (turn up) between midnight and 6am.

If this ESA supports **PFR** this would have 2 entries in the list as follows:

| Entry [0] - Turn Down |                     |           |
|-----------------------|---------------------|-----------|
| StartTime             | 2023-10-23T16:00:00 |           |
| Duration              | 7200                | (2 hours) |
| NominalPower          | 20                  | W         |
| MaximumEnergy         | 40                  | Wh        |

| Entry [1] - Turn Up |                     |           |
|---------------------|---------------------|-----------|
| StartTime           | 2023-10-24T00:00:00 |           |
| Duration            | 21,600              | (6 hours) |



Page 713



|               |       |    |
|---------------|-------|----|
| NominalPower  | 7000  | W  |
| MaximumEnergy | 42000 | Wh |

If this ESA supports **SFR** where it does not know the actual power, but has an understanding of the functions that use more energy, it could be requested to use more or less energy using the LoadControl field as follows:

| Entry [0] - Turn Down |                     |                  |
|-----------------------|---------------------|------------------|
| StartTime             | 2023-10-23T16:00:00 |                  |
| Duration              | 7200                | (2 hours)        |
| LoadControl           | -100                | (Use less power) |

| Entry [1] - Turn Up |                     |                  |
|---------------------|---------------------|------------------|
| StartTime           | 2023-10-24T00:00:00 |                  |
| Duration            | 21,600              | (6 hours)        |
| LoadControl         | +100                | (Use more power) |

#### 9.2.9.7.2. Cause Field

This field SHALL indicate the cause of the request from the EMS.

#### 9.2.9.7.3. Effect on receipt

On receipt of this command, if the ESA supports **CON**, and the [OptOutState](#) permits the specified [AdjustmentCauseEnum](#) (see [OptOutState](#) for details), it may be requested to generate a new forecast by a client.

For example the client may be an energy management system which has determined that the peak load on the home should be reduced (for example a grid event) or that there is more local generation available and the solar export power needs to be consumed.

The EMS may not be best placed to make the forecast adjustment because the ESA knows more about its internal operation and system efficiencies.

For example the total energy used when charging a battery faster may result in increased heat losses in the inverter, so the total energy required to charge a battery with 10kWh of stored energy may vary based on charging power.

The ESA SHALL inspect the constraints field to ensure that the constraints defined for that field and its elements are met. The ESA manufacturer may also reject the request if it could cause the user's preferences to be breached (e.g. may cause the home to be too hot or too cold, or a battery to be insufficiently charged).

If the ESA can meet the requested power limits, it SHALL regenerate a new Power Forecast with a new [ForecastID](#) and [ForecastUpdateReason](#) from the Cause value.

If an appliance has already begun running a program (and agreed to modify its schedule), it may

Page 714







continue to run the same program and meet the same user settings (e.g. ECO mode), but may take more or less time to complete the cycle. The new reported Forecast will start from the current time, i.e. the slots that have already been completed SHALL NOT be included in the new forecast.

The command status returned SHALL be SUCCESS, otherwise if the Cause is not permitted, or the constraints field value does not meet the defined constraints, the command SHALL be rejected with CONSTRAINT\_ERROR, otherwise the command SHALL be rejected with FAILURE.

#### 9.2.9.8. CancelRequest Command

Allows a client to request cancellation of a previous adjustment request in a [StartTimeAdjustRequest](#), [ModifyForecastRequest](#) or [RequestConstraintBasedForecast](#) command.

##### 9.2.9.8.1. Effect on receipt

On receipt of this command, the ESA SHALL attempt to cancel the effects of any previous adjustment request commands, and re-evaluate its forecast for intended operation ignoring those previous requests.

If the ESA [ForecastUpdateReason](#) was already [Internal Optimization](#), then the command SHALL be rejected with INVALID\_IN\_STATE.

If the command is accepted, the ESA SHALL update its [ESATState](#) if required, and the command status returned SHALL be SUCCESS. The ESA SHALL update its [Forecast](#) attribute to match its new intended operation, and update the [ForecastUpdateReason](#) to [Internal Optimization](#).

### 9.2.10. Events

| ID   | Name                    | Priority | Quality | Access | Conformance |
|------|-------------------------|----------|---------|--------|-------------|
| 0x00 | <b>PowerAdjustStart</b> | INFO     |         | V      | PA          |
| 0x01 | <b>PowerAdjustEnd</b>   | INFO     |         | V      | PA          |
| 0x02 | <b>Paused</b>           | INFO     |         | V      | PAU         |
| 0x03 | <b>Resumed</b>          | INFO     |         | V      | PAU         |

#### 9.2.10.1. PowerAdjustStart Event

This event SHALL be generated when the Power Adjustment session is started.

#### 9.2.10.2. PowerAdjustEnd Event

This event SHALL be generated when the Power Adjustment session ends.

| ID | Name         | Type                      | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------------|------------|---------|----------|-------------|
| 0  | <b>Cause</b> | <a href="#">CauseEnum</a> | all        |         |          | M           |




Page 715



| ID | Name             | Type       | Constraint | Quality | Fallback | Conformance |
|----|------------------|------------|------------|---------|----------|-------------|
| 1  | <b>Duration</b>  | elapsed-s  | all        |         |          | M           |
| 2  | <b>EnergyUse</b> | energy-mWh | all        |         |          | M           |

#### 9.2.10.2.1. Cause Field

This field SHALL indicate the reason why the power adjustment session ended.

#### 9.2.10.2.2. Duration Field

This field SHALL indicate the number of seconds that the power adjustment session lasted before ending.

#### 9.2.10.2.3. EnergyUse Field

This field SHALL indicate the approximate energy used by the ESA during the session.

For example, if the ESA was on and was adjusted to be switched off, then this SHALL be 0 mWh. If this was a battery inverter that was requested to discharge it would have a negative EnergyUse value. If this was a normal load that was turned on, then it will have positive value.

#### 9.2.10.3. Paused Event

This event SHALL be generated when the ESA enters the Paused state.

There is no data for this event.

#### 9.2.10.4. Resumed Event

This event SHALL be generated when the ESA leaves the Paused state and resumes operation.

| ID | Name         | Type      | Constraint | Quality | Fallback | Conformance |
|----|--------------|-----------|------------|---------|----------|-------------|
| 0  | <b>Cause</b> | CauseEnum | all        |         |          | M           |

#### 9.2.10.4.1. Cause Field

This field SHALL indicate the reason why the pause ended.

## 9.3. Energy EVSE Cluster

Electric Vehicle Supply Equipment (EVSE) is equipment used to charge an Electric Vehicle (EV) or Plug-In Hybrid Electric Vehicle. This cluster provides an interface to the functionality of Electric Vehicle Supply Equipment (EVSE) management.

Devices targeted by this cluster include Electric Vehicle Supply Equipment (EVSE). The cluster generically assumes a signaling protocol (J1772 in NA and IEC61851 in Europe and Asia) between the EVSE and Electric Vehicle (EV) that utilizes a pilot signal to manage the states of the charging

Page 716







process. [SAE J2847/3\_202311] version and IEC61841 define Pilot signal as a modulated DC voltage on a single wire.

Power Line Communication (PLC) is supported by some EVSEs (e.g. for support of ISO 15118 in Europe and SAE J2931/4 in NA) and may enable features such as Vehicle to Grid (V2G) or Vehicle to Home (V2H) that allows for bi-directional charging/discharging of electric vehicles.

More modern EVSE devices may optionally support ISO 15118-20 in Europe and SAE J2836/3 for NA to support bi-directional charging (Vehicle to Grid - V2G) and Plug and Charge capabilities.

This cluster definition assumes AC charging only. DC charging options may be added in future revisions of this cluster.

This cluster supports a safety mechanism that may lockout remote operation until the initial latching conditions have been met. Some of the fault conditions defined in SAE J1772, such as Ground-Fault Circuit Interrupter (GFCI) or Charging Circuit Interrupting Device (CCID), may require clearing by an operator by, for example, pressing a button on the equipment or breaker panel.

This EVSE cluster is written around support of a single EVSE. Having multiple EVSEs at home or a business is managed by backend system and outside scope of this cluster.

Note that in many deployments the EVSE may be outside the home and may suffer from intermittent network connections (e.g. a weak Wi-Fi signal). It also allows for a charging profile to be pre-configured, in case there is a temporary communications loss during a charging session.

### 9.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                                                                                                      |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | Initial revision                                                                                                                                 |
| 2        | Updates after 0.7 Ballot review                                                                                                                  |
| 3        | Added Q quality for SessionDuration, SessionEnergyCharged and SessionEnergyDischarged. Updates to V2X and associated areas. Make PREF mandatory. |
| 4        | Sync with SDK revision number                                                                                                                    |

### 9.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | EEVSE     |

### 9.3.3. Cluster ID




Page 717



| ID     | Name        |
|--------|-------------|
| 0x0099 | Energy EVSE |

### 9.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code        | Feature             | Conformance | Summary                                                  |
|-----|-------------|---------------------|-------------|----------------------------------------------------------|
| 0   | <b>PREF</b> | ChargingPreferences | M           | EVSE supports storing user charging preferences          |
| 1   | <b>SOC</b>  | SoCReporting        | O           | EVSE supports reporting of vehicle State of Charge (SoC) |
| 2   | <b>PNC</b>  | PlugAndCharge       | O           | EVSE supports PLC to support Plug and Charge             |
| 3   | <b>RFID</b> | RFID                | O           | EVSE is fitted with an RFID reader                       |
| 4   | <b>V2X</b>  | V2X                 | O           | EVSE supports bi-directional charging / discharging      |

#### 9.3.4.1. ChargingPreferences Feature

Since some EVSEs cannot obtain the SoC from the vehicle, some EV charging solutions allow the consumer to specify a daily charging target (for adding energy to the EV's battery). This feature allows the consumer to specify how many miles or km of additional range they need for their typical daily commute. This range requirement can be converted into a daily energy demand with a target charging completion time.

The EVSE itself can use this information (or may allow a controller such as an EMS) to compute an optimized charging schedule. For example, an optimizer may be able to use the [Commodity Price](#) cluster to determine the cheapest and lowest GHG based charging schedule for the vehicle.

An EVSE device which includes a Device Energy Management device with the Device Energy Management cluster **PFR** (PowerForecastReporting) feature can use the charging preferences information to produce its power forecast.

EVSE devices that support the Device Energy Management cluster's **FA** feature can have their charging profiles set by a controller device such as an EMS. For example, if the EVSE advertises a simple power forecast which allows the EMS to adjust over a wide range of power and time durations, then the EVSE may allow the EMS to propose a revised optimized forecast (which is the charging profile). For example, a solar PV ESA may also share its Forecast, so enabling an EMS to adjust the EVSE forecast to the best time to charge so that any excess solar generation is used to charge the EV.

Page 718







See the [Device Energy Management Cluster](#) for more details.

#### 9.3.4.2. SoCReporting Feature

Vehicles and EVSEs which support ISO 15118 may allow the vehicle to report its battery size and state of charge. If the EVSE supports PLC it may have a vehicle connected which optionally supports reporting of its battery size and current State of Charge (SoC).

If the EVSE supports reporting of State of Charge this feature will only work if a compatible EV is connected.

Note some EVSEs may use other undefined mechanisms to obtain vehicle State of Charge outside the scope of this cluster.

#### 9.3.4.3. PlugAndCharge Feature

If the EVSE supports PLC, it may be able to support the Plug and Charge feature. e.g. this may allow the vehicle ID to be obtained which may allow an energy management system to track energy usage per vehicle (e.g. to give the owner an indicative cost of charging, or for work place charging).

If the EVSE supports the Plug and Charge feature, it will only work if a compatible EV is connected.

#### 9.3.4.4. RFID Feature

If the EVSE is fitted with an RFID reader, it may be possible to obtain the User or Vehicle ID from an RFID card. This may be used to record a charging session against a specific charging account, and may optionally be used to authorize a charging session.

An RFID event can be generated when a user taps an RFID card onto the RFID reader. The event must be subscribed to by the EVSE Management cluster client. This client may use this to enable the EV to charge or discharge. The lookup and authorization of RFID UID is outside the scope of this cluster.

#### 9.3.4.5. V2X Feature

If the EVSE can support bi-directional charging, it may be possible to request that the vehicle can discharge to the home or grid.

The charging and discharging may be controlled by a home Energy Management System (EMS) using the Device Energy Management cluster of the associated Device Energy Management device. For example, an EMS may use the **PA** (PowerAdjustment) feature to continually adjust the charge/discharge current to/from the EV so as to minimise the energy flow from/to the grid as the demand in the home and the solar supply to the home both fluctuate.

### 9.3.5. Dependencies

The server side of this cluster SHALL depend on setting time from another device or using a real-time clock.

This can either use a built-in real-time clock or non-Matter time source, or can be derived using the Time Synchronization cluster.




Page 719



### 9.3.5.1. Diagnostic Event logs

It is quite common that users may experience issues charging their vehicle, which, without logs to understand what happened, makes it very difficult to resolve the root cause.

Matter supports events (see Matter specification section 7.14) which includes a buffered log of previous events including a Timestamp (see Matter specification 7.14.2.2).

This Timestamp can be the System Time (since boot) or Epoch Time. It is recommended to use Epoch time (which can be set using the Time Synchronization cluster), which would allow remote support operatives to retrieve the event logs and analyze them against a user reported actual time.

### 9.3.6. Definitions

**EVSE Session** - An EVSE session starts when an EV is plugged in. It ends when it is unplugged.

### 9.3.7. Data Types

#### 9.3.7.1. TargetDayOfWeekBitmap Type

This data type is derived from map8.

| Bit | Name      | Summary   | Conformance |
|-----|-----------|-----------|-------------|
| 0   | Sunday    | Sunday    | M           |
| 1   | Monday    | Monday    | M           |
| 2   | Tuesday   | Tuesday   | M           |
| 3   | Wednesday | Wednesday | M           |
| 4   | Thursday  | Thursday  | M           |
| 5   | Friday    | Friday    | M           |
| 6   | Saturday  | Saturday  | M           |

#### 9.3.7.2. StateEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                          | Conformance |
|-------|--------------------------|--------------------------------------------------|-------------|
| 0     | <b>NotPluggedIn</b>      | The EV is not plugged in.                        | M           |
| 1     | <b>PluggedInNoDemand</b> | The EV is plugged in, but not demanding current. | M           |

Page 720







| Value | Name                        | Summary                                                                                  | Conformance |
|-------|-----------------------------|------------------------------------------------------------------------------------------|-------------|
| 2     | <b>PluggedInDemand</b>      | The EV is plugged in and is demanding current, but EVSE is not allowing current to flow. | M           |
| 3     | <b>PluggedInCharging</b>    | The EV is plugged in, charging is in progress, and current is flowing                    | M           |
| 4     | <b>PluggedInDischarging</b> | The EV is plugged in, discharging is in progress, and current is flowing                 | V2X         |
| 5     | <b>SessionEnding</b>        | The EVSE is transitioning from any plugged-in state to NotPluggedIn                      | M           |
| 6     | <b>Fault</b>                | There is a fault, further details in the <a href="#">FaultState</a> attribute            | M           |

### 9.3.7.3. SupplyStateEnum Type

This data type is derived from enum8.

| Value | Name                       | Summary                                                                                                                          | Conformance |
|-------|----------------------------|----------------------------------------------------------------------------------------------------------------------------------|-------------|
| 0     | <b>Disabled</b>            | The EV is not currently allowed to charge or discharge                                                                           | M           |
| 1     | <b>ChargingEnabled</b>     | The EV is currently allowed to charge                                                                                            | M           |
| 2     | <b>DischargingEnabled</b>  | The EV is currently allowed to discharge                                                                                         | [V2X]       |
| 3     | <b>DisabledError</b>       | The EV is not currently allowed to charge or discharge due to an error. The error must be cleared before operation can continue. | M           |
| 4     | <b>DisabledDiagnostics</b> | The EV is not currently allowed to charge or discharge due to self-diagnostics mode.                                             | M           |




Page 721



| Value | Name           | Summary                                             | Conformance |
|-------|----------------|-----------------------------------------------------|-------------|
| 5     | <b>Enabled</b> | The EV is currently allowed to charge and discharge | [V2X]       |

#### 9.3.7.4. FaultStateEnum Type

This data type is derived from enum8.

| Value | Name                     | Summary                                                                   | Conformance |
|-------|--------------------------|---------------------------------------------------------------------------|-------------|
| 0     | <b>NoError</b>           | The EVSE is not in an error state.                                        | M           |
| 1     | <b>MeterFailure</b>      | The EVSE is unable to obtain electrical measurements.                     | M           |
| 2     | <b>OverVoltage</b>       | The EVSE input voltage level is too high.                                 | M           |
| 3     | <b>UnderVoltage</b>      | The EVSE input voltage level is too low.                                  | M           |
| 4     | <b>OverCurrent</b>       | The EVSE detected charging current higher than allowed by charger.        | M           |
| 5     | <b>ContactWetFailure</b> | The EVSE detected voltage on charging pins when the contactor is open.    | M           |
| 6     | <b>ContactDryFailure</b> | The EVSE detected absence of voltage after enabling contactor.            | M           |
| 7     | <b>GroundFault</b>       | The EVSE has an unbalanced current supply.                                | M           |
| 8     | <b>PowerLoss</b>         | The EVSE has detected a loss in power.                                    | M           |
| 9     | <b>PowerQuality</b>      | The EVSE has detected another power quality issue (e.g. phase imbalance). | M           |
| 10    | <b>PilotShortCircuit</b> | The EVSE pilot signal amplitude short circuited to ground.                | M           |

Page 722



| Value | Name                    | Summary                                                 | Conformance |
|-------|-------------------------|---------------------------------------------------------|-------------|
| 11    | <b>EmergencyStop</b>    | The emergency stop button was pressed.                  | M           |
| 12    | <b>EVDisconnected</b>   | The EVSE detected that the cable has been disconnected. | M           |
| 13    | <b>WrongPowerSupply</b> | The EVSE could not determine proper power supply level. | M           |
| 14    | <b>LiveNeutralSwap</b>  | The EVSE detected Live and Neutral are swapped.         | M           |
| 15    | <b>OverTemperature</b>  | The EVSE internal temperature is too high.              | M           |
| 255   | <b>Other</b>            | Any other reason.                                       | M           |

#### 9.3.7.5. EnergyTransferStoppedReasonEnum Type

This data type is derived from enum8.

| Value | Name               | Summary                  | Conformance |
|-------|--------------------|--------------------------|-------------|
| 0     | <b>EVStopped</b>   | The EV decided to stop   | M           |
| 1     | <b>EVSEStopped</b> | The EVSE decided to stop | M           |
| 2     | <b>Other</b>       | An other unknown reason  | M           |

#### 9.3.7.6. ChargingTargetStruct Type

This represents a single user specified charging target for an EV.

An EVSE or EMS system optimizer may use this information to take the Time of Use Tariff, grid carbon intensity, local generation (solar PV) into account to provide the cheapest and cleanest energy to the EV.

The optimization strategy is not defined here, however in simple terms, the AddedEnergy requirement can be fulfilled by knowing the charging Power (W) and the time needed to charge.

To compute the Charging Time:  $\text{Required Energy (Wh)} = \text{Power (W)} \times \text{ChargingTime (s)} / 3600$

Therefore:  $\text{ChargingTime (s)} = (3600 \times \text{RequiredEnergy (wH)}) / \text{Power (W)}$

To compute the charging time:  $\text{Charging StartTime} = \text{TargetTimeMinutesPastMidnight} - \text{ChargingTime}$




Page 723



| ID | Name                          | Type       | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------------------|------------|------------|---------|----------|--------|-------------|
| 0  | TargetTimeMinutesPastMidnight | uint16     | max 1439   |         |          |        | M           |
| 1  | TargetSoC                     | percent    |            |         | 0        |        | SOC, O.a+   |
| 2  | AddedEnergy                   | energy-mWh | min 0      |         | 0        |        | [SOC], O.a+ |

#### 9.3.7.6.1. TargetTimeMinutesPastMidnight Field

This field SHALL indicate the desired charging completion time of the associated day. The time will be represented by a 16 bits unsigned integer to designate the minutes since midnight. For example, 6am will be represented by 360 minutes since midnight and 11:30pm will be represented by 1410 minutes since midnight.

This field is based on local wall clock time. In case of Daylight Savings Time transition which may result in an extra hour or one hour less in the day, the charging algorithm should take into account the shift appropriately.

Note that if the TargetTimeMinutesPastMidnight values are too close together (e.g. 2 per day) these may overlap. The EVSE may have to coalesce the charging targets into a single target. e.g. if the 1st charging target cannot be met in the time available, the EVSE may be forced to begin working towards the 2nd charging target and immediately continue until both targets have been satisfied (or the vehicle becomes full).

The EVSE itself cannot predict the behavior of the vehicle (i.e. if it cannot obtain the SoC from the vehicle), so should attempt to perform a sensible operation based on these targets. It is recommended that the charging schedule is pessimistic (i.e. starts earlier) since the vehicle may charge more slowly than the electrical supply may provide power (especially if it is cold).

If the user configures large charging targets (e.g. high values of AddedEnergy or SoC) then it is expected that the EVSE may need to begin charging immediately, and may not be able to guarantee that the vehicle will be able to reach the target.

#### 9.3.7.6.2. TargetSoC Field

This field represents the target SoC that the vehicle should be charged to before the TargetTimeMinutesPastMidnight.

If the EVSE supports the SOC feature and can obtain the SoC of the vehicle:

- the TargetSoC field SHALL take precedence over the AddedEnergy field.
- the EVSE SHOULD charge to the TargetSoC and then stop the charging automatically when it reaches that point.
- if the TargetSoC value is set to 100% then the EVSE SHOULD continue to charge the vehicle until the vehicle decides to stop charging.

Page 724







If the EVSE does not support the SOC feature or cannot obtain the SoC of the vehicle:

- the AddedEnergy field SHALL take precedence over the TargetSoC field, and if the EVSE does not support the SOC feature then the TargetSoC field may only take the values null or 100%.
- if the AddedEnergy field has not been provided, the EVSE SHOULD assume the vehicle is empty and charge until the vehicle stops demanding a charge.

#### 9.3.7.6.3. AddedEnergy Field

This field represents the amount of energy that the user would like to have added to the vehicle before the TargetTimeMinutesPastMidnight.

This represents a positive value in mWh that SHOULD be added during the session (i.e. if the vehicle charging is stopped and started several times, this equates to the total energy since the vehicle has been plugged in).

The maximum value (500kWh) is much larger than most EV batteries on the market today. If the client tries to set this value too high then the EVSE will need to start charging immediately and continue charging until the vehicle stops demanding charge (i.e. it is full). Therefore the maximum value should be set based on typical battery size of the vehicles on the market (e.g. 70000Wh), however this is up to the client to carefully choose a value.

#### NOTE

If the EVSE can obtain the Battery Capacity of the vehicle, it SHOULD NOT limit this AddedEnergy value to the Battery Capacity of the vehicle, since the EV may also require energy for heating and cooling of the battery during charging, or for heating or cooling the cabin.

#### 9.3.7.7. ChargingTargetScheduleStruct Type

This represents a set of user specified charging targets for an EV for a set of specified days.

| ID | Name                   | Type                       | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------------|----------------------------|------------|---------|----------|--------|-------------|
| 0  | Day-OfWeek-ForSequence | TargetDay-OfWeek-Bitmap    | all        |         |          |        | M           |
| 1  | Charging-Targets       | list[ChargingTargetStruct] | max 10     |         |          |        | M           |

#### 9.3.7.8. DayOfWeekForSequence Field

This field SHALL indicate the days of the week that the charging targets SHOULD be associated to. This field is a bitmap and therefore the associated targets could be applied to multiple days.




Page 725



### 9.3.7.9. ChargingTargets Field

This field SHALL indicate a list of up to 10 charging targets for each of the associated days of the week.

### 9.3.8. Attributes

| ID     | Name                     | Type            | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------|-----------------|------------|---------|----------|--------|-------------|
| 0x0000 | State                    | StateEnum       | all        | X       |          | R V    | M           |
| 0x0001 | SupplyState              | SupplyStateEnum | all        |         |          | R V    | M           |
| 0x0002 | FaultState               | FaultStateEnum  | all        |         |          | R V    | M           |
| 0x0003 | ChargingEnabledUntil     | epoch-s         | all        | N X     |          | R V    | M           |
| 0x0004 | DischargingEnabledUntil  | epoch-s         | all        | N X     |          | R V    | V2X         |
| 0x0005 | CircuitCapacity          | amperage-mA     | min 0      | N       |          | R V    | M           |
| 0x0006 | MinimumChargeCurrent     | amperage-mA     | min 0      | N       |          | R V    | M           |
| 0x0007 | MaximumChargeCurrent     | amperage-mA     | min 0      | N       |          | R V    | M           |
| 0x0008 | MaximumDischargeCurrent  | amperage-mA     | min 0      | N       |          | R V    | V2X         |
| 0x0009 | UserMaximumChargeCurrent | amperage-mA     | desc       | N       | 0        | RW VM  | O           |
| 0x000A | RandomizationDelayWindow | elapsed-s       | max 86400  | N       | 600      | RW VM  | O           |

Page 726







| ID     | Name                      | Type       | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------------------|------------|------------|---------|----------|--------|-------------|
| 0x0023 | NextChargeStart-Time      | epoch-s    | all        | X       |          | RV     | PREF        |
| 0x0024 | NextChargeTarget-Time     | epoch-s    | all        | X       |          | RV     | PREF        |
| 0x0025 | NextChargeRequired Energy | energy-mWh | min 0      | X       |          | RV     | PREF        |
| 0x0026 | NextChargeTarget-Soc      | percent    |            | X       |          | RV     | PREF        |
| 0x0027 | ApproximateEVEfficiency   | uint16     | desc       | N X     | null     | RW VM  | [PREF]      |
| 0x0030 | State-OfCharge            | percent    |            | X       |          | RV     | SOC         |
| 0x0031 | BatteryCapacity           | energy-mWh | min 0      | X       |          | RV     | SOC         |
| 0x0032 | VehicleID                 | string     | max 32     | X       |          | RV     | PNC         |
| 0x0040 | SessionID                 | uint32     | all        | N X     |          | RV     | M           |
| 0x0041 | Session-Duration          | elapsed-s  | all        | N Q X   |          | RV     | M           |
| 0x0042 | SessionEnergy-Charged     | energy-mWh | min 0      | N Q X   |          | RV     | M           |
| 0x0043 | SessionEnergyDis-charged  | energy-mWh | min 0      | N Q X   |          | RV     | V2X         |

### 9.3.8.1. State Attribute

This attribute SHALL indicate the current status of the EVSE. This higher-level status is partly derived from the signaling protocol as communicated between the EVSE and the vehicle through the pilot signal.

The State attribute SHALL change when the EVSE detects change of condition of the EV (plugged in or unplugged, whether the vehicle is asking for demand or not, and if it is charging or discharging).

#### NOTE

SessionEnding is not really a state but a transition. However, the transition period



Page 727



may take a few seconds and is useful for some clean up purposes.

The Fault state is used to indicate that the FaultState attribute is not NoError.

A null value SHALL indicate that the state cannot be determined.

#### 9.3.8.2. SupplyState Attribute

This attribute SHALL indicate whether the EV is currently allowed to charge from or discharge to the EVSE.

#### 9.3.8.3. FaultState Attribute

This attribute SHALL indicate the type of fault detected by the EVSE (internally or as detected in the pilot signal).

When the SupplyState attribute is DisabledError, the FaultState attribute will be one of the values listed in [FaultStateEnum](#), except NoError. For all values of SupplyState other than DisabledError, the FaultState attribute SHALL be NoError.

#### 9.3.8.4. ChargingEnabledUntil Attribute

This attribute SHALL indicate the time, in UTC, that the EVSE will automatically stop current flow to the EV.

A null value indicates the EVSE is always enabled for charging.

A value in the past or 0x0 indicates that EVSE charging SHALL be disabled. The attribute is only set via the payload of the [EnableCharging](#) command.

This attribute SHALL be persisted, for example a temporary power failure should not stop the vehicle from being charged.

#### 9.3.8.5. DischargingEnabledUntil Attribute

This attribute SHALL indicate the time, in UTC, that the EVSE will automatically stop current flow from the EV.

A null value indicates the EVSE is always enabled for discharging.

A value in the past or 0x0 indicates that EVSE discharging SHALL be disabled. The attribute is only set via the payload of the [EnableDischarging](#) command.

This attribute SHALL be persisted, for example a temporary power failure should not stop the vehicle from being discharged.

#### 9.3.8.6. CircuitCapacity Attribute

This attribute SHALL indicate the capacity that the circuit that the EVSE is connected to can provide. It is intended to allow implementation of a self-managed network of EVSEs. It is assumed that the device will allow the setting of such values by an installer.

Page 728







### 9.3.8.7. MinimumChargeCurrent Attribute

This attribute SHALL indicate the minimum current that can be delivered by the EVSE to the EV.

The attribute can be set using the [EnableCharging](#) command.

### 9.3.8.8. MaximumChargeCurrent Attribute

This attribute SHALL indicate the maximum current that can be delivered by the EVSE to the EV.

This SHALL represent the actual maximum current offered to the EV at any time. Note that the EV can draw less current than this value. For example, the EV may be limiting its power draw based on the operating conditions of the battery, such as temperature and state of charge.

The attribute can be initially set using the [EnableCharging](#) command or by adjusting the [UserMaximumChargeCurrent](#) attribute.

This attribute value SHALL be the minimum of:

- CircuitCapacity - Electrician's installation setting
- CableAssemblyCurrentLimit (detected by the EVSE when the cable is plugged in)
- MaximumChargeCurrent field in the EnableCharging command
- UserMaximumChargeCurrent attribute

### 9.3.8.9. MaximumDischargeCurrent Attribute

This attribute SHALL indicate the maximum current that can be received by the EVSE from the EV.

This attribute can be set using the [EnableDischarging](#) command.

This attribute value SHALL be the minimum of:

- CircuitCapacity - Electrician's installation setting
- CableAssemblyCurrentLimit (detected by the EVSE when the cable is plugged in)
- MaximumDischargeCurrent field in the EnableDischarging command

### 9.3.8.10. UserMaximumChargeCurrent Attribute

This attribute SHALL indicate a maximum current that can be set by the consumer (e.g. via an app) as a preference to further reduce the charging rate. This may be desirable if the home owner has a solar PV or battery storage system which may only be able to deliver a limited amount of power. The consumer can manually control how much they allow the EV to take.

This attribute value SHALL be limited by the EVSE to be in the range of:



Page 729



```
MinimumChargeCurrent <= UserMaximumChargeCurrent <= MaximumChargeCurrent
```

where MinimumChargeCurrent and MaximumChargeCurrent are the values received in the [EnableCharging](#) command.

Its default value SHOULD be initialized to the same as the [CircuitCapacity](#) attribute. This value SHALL be persisted across reboots to ensure it does not cause charging issues during temporary power failures.

#### 9.3.8.11. RandomizationDelayWindow Attribute

This attribute SHALL indicate the size of a random window over which the EVSE will randomize the start of a charging session. This value is in seconds.

This is a feature that is mandated in some markets (such as UK) where the EVSE should by default randomize its start time within the randomization window. By default in the UK this should be 600s.

For example, if the RandomizationDelayWindow is 600s (i.e. 10 minutes) and if there was a cheap rate energy starting at 00:30, then the EVSE must compute a random delay between 0-599s and add this to its initial planned start time.

#### 9.3.8.12. NextChargeStartTime Attribute

This attribute SHALL indicate the time, in UTC, when the EVSE plans to start the next scheduled charge based on the charging preferences.

A null value indicates that there is no scheduled charging (for example, the EVSE Mode is set to use Manual mode tag), or that the vehicle is not plugged in with the SupplyState indicating that charging is enabled.

#### 9.3.8.13. NextChargeTargetTime Attribute

This attribute SHALL indicate the time, in UTC, when the EVSE SHOULD complete the next scheduled charge based on the charging preferences.

A null value indicates that there is no scheduled charging (for example, the EVSE Mode is set to use Manual mode tag), or that the vehicle is not plugged in with the SupplyState indicating that charging is enabled.

#### 9.3.8.14. NextChargeRequiredEnergy Attribute

This attribute SHALL indicate the amount of energy that the EVSE is going to attempt to add to the vehicle in the next charging target.

A null value indicates that there is no scheduled charging (for example, the EVSE Mode is set to use Manual mode tag), or that the vehicle is not plugged in with the SupplyState indicating that charging is enabled, or that the next [ChargingTargetStruct](#) is using the TargetSoC value to charge the vehicle.

Page 730



### 9.3.8.15. NextChargeTargetSoC Attribute

This attribute SHALL indicate the target SoC the EVSE is going to attempt to reach when the vehicle is next charged.

A null value indicates that there is no scheduled charging (for example, the EVSE Mode is set to use Manual mode tag), or that the vehicle is not plugged in with the SupplyState indicating that charging is enabled, or that the next [ChargingTargetStruct](#) is using the AddedEnergy value to charge the vehicle.

If the SOC feature is not supported, only the values null and 100% are supported.

### 9.3.8.16. ApproximateEVEfficiency Attribute

This attribute SHALL indicate the vehicle efficiency rating for a connected vehicle.

This can be used to help indicate to the user *approximately* how many miles or km of range will be added. It allows user interfaces to display to the user simpler terms that they can relate to compared to kWh.

This is value is stored in km per kWh multiplied by a scaling factor of 1000.

A null value indicates that the EV efficiency is unknown and the [NextChargeRequiredEnergy](#) attribute cannot be converted from Wh to miles or km.

To convert from Wh into Range:

$$\begin{aligned} \text{AddedRange (km)} &= \text{AddedEnergy (Wh)} \times \text{ApproxEVEfficiency (km/kWh} \times 1000) \\ \text{AddedRange (Miles)} &= \text{AddedEnergy (Wh)} \times \text{ApproxEVEfficiency (km/kWh} \times 1000) \times 0.6213 \end{aligned}$$

Example:

$$\begin{aligned} \text{ApproxEVEfficiency (km/kWh} \times 1000) &: 4800 \text{ (i.e. } 4.8 \text{ km/kWh} \times 1000) \\ \text{AddedEnergy (Wh)} &: 10,000 \end{aligned}$$

$$\begin{aligned} \text{AddedRange (km)} &= 10,000 \times 4800 / 1,000,000 = 48 \text{ km} \\ \text{AddedRange (Miles)} &= \text{AddedEnergy (Wh)} \times \text{ApproxEVEfficiency (km/kWh} \times 1000) \times 0.6213 \\ &= 29.82 \text{ Miles} \end{aligned}$$

### 9.3.8.17. StateOfCharge Attribute

This attribute SHALL indicate the state of charge of the EV battery in steps of 1%. The values are in the 0-100%. This attribute is only available on EVSEs which can read the state of charge from the vehicle and that support the [SOC](#) feature. If the StateOfCharge cannot be read from the vehicle it




Page 731



SHALL be returned with a NULL value.

#### 9.3.8.18. BatteryCapacity Attribute

This attribute SHALL indicate the capacity of the EV battery in mWh. This value is always positive.

#### 9.3.8.19. VehicleID Attribute

This attribute SHALL indicate the vehicle ID read by the EVSE via ISO-15118 using the **PNC** feature, if the EVSE supports this capability.

The field may be based on the e-Mobility Account Identifier (E Maid).

A null value SHALL indicate that this is unknown.

#### 9.3.8.20. Session Attributes

The following set of attributes provides information about a charging session, defined as the period from the EVSE detecting an EV plug-in to when it is unplugged.

|             |                                                                                                                       |
|-------------|-----------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | the session attributes hold their values from the previous session and are reset when the next plug-in event happens. |
|-------------|-----------------------------------------------------------------------------------------------------------------------|

Whenever the State leaves the NotPluggedIn state and moves to any 'Plugged' state (see the [State](#) attribute), the SessionID attribute SHALL be incremented. The SessionDuration, SessionEnergyCharged and SessionEnergyDischarged attributes SHALL be reset to zero.

##### 9.3.8.20.1. SessionID Attribute

This attribute SHALL indicate a unique identifier for the current or last session. A value of null indicates no sessions have occurred. The SessionID SHALL be incremented each time a plugin is detected. A session begins when the vehicle is plugged in and ends when the vehicle is unplugged.

SessionIDs are allowed to roll over, although the range of SessionID is a large number and it is unlikely that the EVSE will have this many sessions in its lifetime unless there is a electrical fault causes sessions to be detected at a rapid rate.

If there is no session in progress, the Session ID attribute will remain at the value for the last session.

##### 9.3.8.20.2. SessionDuration Attribute

This attribute SHALL indicate the duration in seconds for the current or last charging session. A default value of null indicates no sessions have occurred. A charge session begins when the vehicle is plugged in and ends when the vehicle is unplugged.

The SessionDuration can be calculated from the start time of the session. Manufacturers SHALL ensure this can be correctly calculated if there has been an power failure or reboot since the start of the session.

Changes to this attribute SHALL only be marked as reportable in the following cases:

Page 732







- At most once every 10 seconds on changes, or
- When it changes from null to any other value and vice versa, such as at the beginning and end of a charging session.

#### 9.3.8.20.3. SessionEnergyCharged Attribute

This attribute SHALL indicate the energy, in mWh, delivered by the EVSE to the EV for the current or last charging session. A default value of null indicates no sessions have occurred.

The SessionEnergyCharged value can be calculated by knowing the initial value of the energy meter at the start time of the session. Manufacturers SHALL ensure this can be correctly calculated if there has been a power failure or reboot since the start of the session.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once every 10 seconds on changes, or
- When it changes from null to any other value and vice versa, such as at the beginning and end of a charging session.

#### 9.3.8.20.4. SessionEnergyDischarged Attribute

This attribute SHALL indicate the energy, in mWh, received by the EVSE from the EV for the current or last charging session. A default value of null indicates no sessions have occurred.

The SessionEnergyDischarged value can be calculated by knowing the initial value of the energy meter at the start time of the session. Manufacturers SHALL ensure this can be correctly calculated if there has been a power failure or reboot since the start of the session.

Changes to this attribute SHALL only be marked as reportable in the following cases:

- At most once every 10 seconds on changes, or
- When it changes from null to any other value and vice versa, such as at the beginning and end of a charging session.

### 9.3.9. Commands

| ID   | Name              | Direction                   | Response | Access | Conformance |
|------|-------------------|-----------------------------|----------|--------|-------------|
| 0x01 | Disable           | client $\Rightarrow$ server | Y        | O T    | M           |
| 0x02 | EnableCharging    | client $\Rightarrow$ server | Y        | O T    | M           |
| 0x03 | EnableDischarging | client $\Rightarrow$ server | Y        | O T    | V2X         |
| 0x04 | StartDiagnostics  | client $\Rightarrow$ server | Y        | O T    | O           |
| 0x05 | SetTargets        | client $\Rightarrow$ server | Y        | O T    | PREF        |



Page 733



| ID   | Name               | Direction                   | Response           | Access | Conformance |
|------|--------------------|-----------------------------|--------------------|--------|-------------|
| 0x06 | GetTargets         | client $\Rightarrow$ server | GetTargetsResponse | O T    | PREF        |
| 0x07 | ClearTargets       | client $\Rightarrow$ server | Y                  | O T    | PREF        |
| 0x00 | GetTargetsResponse | client $\Leftarrow$ server  | N                  |        | PREF        |

### 9.3.9.1. Disable Command

Allows a client to disable the EVSE from charging and discharging.

#### 9.3.9.1.1. Effect on Receipt

On receipt of this command, the EVSE will stop any power flow between the EV and EVSE.

If the command cannot be handled, a status of FAILURE SHALL be returned.

If the [SupplyState](#) attribute is already Disabled, a response with status of SUCCESS SHALL be returned.

Otherwise, if successful, the [ChargingEnabledUntil](#) and [DischargingEnabledUntil](#) attributes SHALL be set to 0x0, the [SupplyState](#) attribute changed to Disabled, and a response with status of SUCCESS SHALL be returned.

If any energy was being transferred, then a corresponding [EnergyTransferStopped](#) event SHALL be generated.

### 9.3.9.2. EnableCharging Command

This command allows a client to enable the EVSE to charge an EV, and to provide or update the maximum and minimum charge current.

| ID | Name                         | Type        | Constraint | Quality | Fallback | Conformance |
|----|------------------------------|-------------|------------|---------|----------|-------------|
| 0  | <b>ChargingEnabledUntil</b>  | epoch-s     | all        | X       |          | M           |
| 1  | <b>Minimum-ChargeCurrent</b> | amperage-mA | min 0      |         |          | M           |
| 2  | <b>Maximum-ChargeCurrent</b> | amperage-mA | min 0      |         |          | M           |

#### 9.3.9.2.1. ChargingEnabledUntil Field

This field SHALL indicate the expiry time, in UTC, when charging will be automatically disabled.

A value in the past in this field SHALL disable the EVSE charging whereas a null value SHALL

Page 734



enable it permanently.

#### 9.3.9.2.2. MinimumChargeCurrent Field

This field SHALL indicate the minimum current that can be delivered by the EVSE to the EV in trickle mode. The EVSE current limit can be advertised to an EV in 0.6A steps.

The value of the [MinimumChargeCurrent](#) attribute SHALL be set to the value of this field (see [Section 9.3.8.7, “MinimumChargeCurrent Attribute”](#) for further details).

#### 9.3.9.2.3. MaximumChargeCurrent Field

This field SHALL indicate the maximum current that can be delivered by the EVSE to the EV. The EVSE current limit can be advertised to an EV in 0.6A steps.

The value of this field SHALL be stored by the EVSE to determine the value of [MaximumChargeCurrent](#) attribute. For example, if the [UserMaximumChargeCurrent](#) attribute is adjusted below then this value, and then later adjusted above this value, the resulting [MaximumChargeCurrent](#) attribute will be limited to this value.

#### 9.3.9.2.4. Effect on Receipt

On receipt of this command, this SHALL allow the EVSE to charge the EV until the specified timestamp within the current limits specified in the fields of the command.

If there is currently an error present on the EVSE, or Diagnostics are currently active, then the command SHALL be ignored and a response with a status of FAILURE SHALL be returned.

If successful, the [SupplyState](#) attribute SHALL be set to ChargingEnabled (if previously Disabled) or Enabled (if previously DischargingEnabled), and a response with status of SUCCESS SHALL be returned.

The timestamp indicated in the [ChargingEnabledUntil](#) attribute SHALL be updated to the timestamp of the ChargingEnabledUntil field if the command is successful.

If the ChargingEnabledUntil is null (i.e. should be permanently enabled), then the EVSE should enable charging indefinitely.

If the ChargingEnabledUntil time is not null, then when this time expires then the EVSE SHALL stop charging and SHALL update the [State](#) attribute to indicate it is no longer charging, and SHALL update the [SupplyState](#) attribute to Disabled (if [DischargingEnabledUntil](#) is also in the past) or DischargingEnabled (if [DischargingEnabledUntil](#) is in the future or null).

### 9.3.9.3. EnableDischarging Command

Upon receipt, this SHALL allow a client to enable the discharge of an EV, and to provide or update the maximum discharge current.



Page 735



| ID | Name                    | Type        | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|-------------|------------|---------|----------|-------------|
| 0  | DischargingEnabledUntil | epoch-s     | all        | X       |          | M           |
| 1  | MaximumDischargeCurrent | amperage-mA | min 0      |         |          | M           |

#### 9.3.9.3.1. DischargingEnabledUntil Field

This field SHALL indicate the expiry time, in UTC, when discharging will be automatically disabled.

A value in the past in this field SHALL disable the EVSE discharging whereas a null value SHALL enable EVSE discharging permanently.

#### 9.3.9.3.2. MaximumDischargeCurrent Field

This field SHALL indicate the maximum current that can be received by the EVSE from the EV. The EVSE current limit can be advertised to an EV in 0.6A steps. The value of the [MaximumDischargeCurrent](#) attribute SHALL be stored and persisted across reboots by the EVSE to the value of this field.

#### 9.3.9.3.3. Effect on Receipt

On receipt of this command, this SHALL allow the EVSE to discharge the EV until the specified timestamp, and allows a maximum current limit to be specified in the fields of the command.

If there is currently an error present on the EVSE, or Diagnostics are currently active, then the command SHALL be ignored and a response with a status of FAILURE SHALL be returned.

If successful, the [SupplyState](#) attribute SHALL be set to DischargingEnabled (if previously Disabled) or Enabled (if previously ChargingEnabled), and a response with status of SUCCESS SHALL be returned.

The timestamp indicated in the [DischargingEnabledUntil](#) attribute SHALL be updated to the timestamp of the DischargingEnabledUntil field if the command is successful.

If the DischargingEnabledUntil is null (i.e. should be permanently enabled), then the EVSE should enable discharging indefinitely.

If the DischargingEnabledUntil time is not null, then when this time expires then the EVSE SHALL stop discharging and SHALL update the [State](#) attribute to indicate it is no longer discharging, and SHALL update the [SupplyState](#) attribute to Disabled (if [ChargingEnabledUntil](#) is also in the past) or ChargingEnabled (if [ChargingEnabledUntil](#) is in the future or null).

Page 736



### 9.3.9.4. StartDiagnostics Command

Allows a client to put the EVSE into a self-diagnostics mode.

#### 9.3.9.4.1. Effect on Receipt

On receipt of this command, the EVSE SHALL enter a Diagnostics state only if the SupplyState attribute is in the Disabled state.

If the EVSE cannot start diagnostics, a response SHALL be generated with a status of FAILURE.

If successful, the SupplyState attribute SHALL be set to DisabledDiagnostics, and a response with status of SUCCESS SHALL be returned.

The diagnostics are at the discretion of the manufacturer and usually include internal checks. Upon completion of the diagnostics, the EVSE SHALL restore SupplyState to the Disabled state (see [Section 9.3.8.2, “SupplyState Attribute”](#) for further details).

### 9.3.9.5. SetTargets Command

Allows a client to set the user specified charging targets.

| ID | Name                    | Type                               | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|------------------------------------|------------|---------|----------|-------------|
| 0  | ChargingTargetSchedules | list[ChargingTargetScheduleStruct] | max 7      |         |          | M           |

#### 9.3.9.5.1. ChargingTargetSchedules Field

This field SHALL indicate a list of up to 7 sets of daily charging targets together with their associated days of the week. Each of the days of the week may only be included in a single ChargingTargetSchedule within this list field.

#### 9.3.9.5.2. Effect on Receipt

On receipt of this command, the EVSE SHALL validate that all of the charging targets are within a valid range, and that each day of the week is included in at most one of the ChargingTargetSchedule, if they are not then the response SHALL be CONSTRAINT\_ERROR.

When a command is received that requires a total number of charging targets greater than the device supports, the status of the response SHALL be RESOURCE\_EXHAUSTED.

If the charging targets are accepted, then the charging targets SHALL be stored for all of days that are set in the DayOfWeekForSequence bitmap fields in all the ChargingTargetSchedules. If a ChargingTargetSchedule is defined with no ChargingTargets then the ChargingTargets are cleared for those days defined in the DayOfWeekForSequence

The SetTargets command is used to update the EVSE's weekly charging schedule. If the EVSE already has some stored weekly charging targets, then it SHALL replace each daily charging target



Page 737



as it receives the updates from the client. For example, if the EVSE has 2 charging targets for every day of the week and is sent a SetTargets command with one target for Saturday then the EVSE SHALL remove both charging targets for Saturday and replace those with the updated charging target but leave all other days unchanged.

**NOTE**

the EVSE may not be able to compute the schedules by itself, or may rely upon an EMS or other optimizer to do this.

In a standalone mode (e.g. without using a ToU tariff from the Pricing Cluster) the EVSE should be able to compute the latest NextChargeStartTime based on the preset MaximumChargeCurrent attribute and local grid voltage to determine the charging duration required. It should automatically begin charging and following the charging schedule if the EVSE is plugged in (and the EVSE is enabled for charging).

If the EVSE supports the **PFR** (PowerForecastReporting) feature in the Device Energy Management cluster, it SHALL auto update the Forecast with the indicative power forecast.

If the EVSE supports the **FA** (ForecastAdjustment) feature in the Device Energy Management cluster, it SHALL indicate its adjustment capability in each of the Forecast slots (see [Device Energy Management Cluster](#) for more details).

The EVSE SHALL be responsible for updating the NextChargeEndTime, NextChargeRequiredEnergy and/or NextChargeTargetSoC attributes as it runs through its internal schedule. For example, as a scheduled charging session is completed or as it transitions to the next day, it should compute the next time it expects to start charging, and then update the corresponding attributes accordingly.

#### 9.3.9.6. GetTargets Command

Allows a client to retrieve the current set of charging targets.

##### 9.3.9.6.1. Effect on Receipt

On receipt of this command, the EVSE SHALL send the [GetTargetsResponse](#) command to the client.

#### 9.3.9.7. GetTargetsResponse Command

The GetTargetsResponse is sent in response to the GetTargets Command.

| ID | Name                    | Type                                                 | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|------------------------------------------------------|------------|---------|----------|-------------|
| 0  | ChargingTargetSchedules | list[ <a href="#">ChargingTargetScheduleStruct</a> ] | max 7      |         |          | M           |

##### 9.3.9.7.1. ChargingTargetSchedules Field

This field SHALL indicate a list of up to 7 sets of daily charging targets together with their associated days of the week.

Page 738



### 9.3.9.8. ClearTargets Command

Allows a client to clear all stored charging targets.

#### 9.3.9.8.1. Effect on Receipt

On receipt of this command, all weekly targets that are currently stored SHALL be cleared and a default response of SUCCESS SHALL be sent in response. There are no error responses to this command.

If the EVSE is currently charging based on being in automatic mode, then it SHALL stop the EVSE charging.

### 9.3.10. Events

| ID   | Name                  | Priority | Quality | Access | Conformance |
|------|-----------------------|----------|---------|--------|-------------|
| 0x00 | EVConnected           | INFO     |         | V      | M           |
| 0x01 | EVNotDetected         | INFO     |         | V      | M           |
| 0x02 | EnergyTransferStarted | INFO     |         | V      | M           |
| 0x03 | EnergyTransferStopped | INFO     |         | V      | M           |
| 0x04 | Fault                 | CRITICAL |         | V      | M           |
| 0x05 | RFID                  | INFO     |         | V      | [RFID]      |

#### 9.3.10.1. EVConnected Event

This event SHALL be generated when the EV is plugged in.

| ID | Name      | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------|--------|------------|---------|----------|-------------|
| 0  | SessionID | uint32 | all        |         |          | M           |

##### 9.3.10.1.1. SessionID Field

This is the new session ID created after the vehicle is plugged in.

#### 9.3.10.2. EVNotDetected Event

This event SHALL be generated when the EV is unplugged or not detected (having been previously plugged in). When the vehicle is unplugged then the session is ended.

| ID | Name      | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------|--------|------------|---------|----------|-------------|
| 0  | SessionID | uint32 | all        |         |          | M           |



Page 739



| ID | Name                           | Type                      | Constraint | Quality | Fallback | Conformance |
|----|--------------------------------|---------------------------|------------|---------|----------|-------------|
| 1  | <b>State</b>                   | <a href="#">StateEnum</a> | all        |         |          | M           |
| 2  | <b>SessionDuration</b>         | elapsed-s                 | all        |         |          | M           |
| 3  | <b>SessionEnergyCharged</b>    | energy-mWh                | min 0      |         |          | M           |
| 4  | <b>SessionEnergyDischarged</b> | energy-mWh                | min 0      |         |          | V2X         |

#### 9.3.10.2.1. SessionID Field

This field SHALL indicate the current value of the [SessionID](#) attribute.

#### 9.3.10.2.2. State Field

This field SHALL indicate the value of the [State](#) attribute prior to the EV not being detected.

#### 9.3.10.2.3. SessionDuration Field

This field SHALL indicate the total duration of the session, from the start of the session when the EV was plugged in, until it was unplugged.

#### 9.3.10.2.4. SessionEnergyCharged Field

This field SHALL indicate the total amount of energy transferred from the EVSE to the EV during the session.

Note that if bi-directional charging occurs during the session, then this value SHALL only include the sum of energy transferred from the EVSE to the EV, and SHALL NOT be a net value of charging and discharging energy.

#### 9.3.10.2.5. SessionEnergyDischarged Field

This field SHALL indicate the total amount of energy transferred from the EV to the EVSE during the session.

Note that if bi-directional discharging occurs during the session, then this value SHALL only include the sum of energy transferred from the EV to the EVSE, and SHALL NOT be a net value of charging and discharging energy.

### 9.3.10.3. EnergyTransferStarted Event

This event SHALL be generated whenever the EV starts charging or discharging, except when an EV has switched between charging and discharging under the control of the PowerAdjustment feature of the Device Energy Management cluster of the associated Device Energy Management device.

Page 740





| ID | Name                           | Type        | Constraint | Quality | Fallback | Conformance |
|----|--------------------------------|-------------|------------|---------|----------|-------------|
| 0  | <b>SessionID</b>               | uint32      | all        |         |          | M           |
| 1  | <b>State</b>                   | StateEnum   | all        |         |          | M           |
| 2  | <b>MaximumCurrent</b>          | amperage-mA | min 0      |         |          | M           |
| 3  | <b>MaximumDischargeCurrent</b> | amperage-mA | min 0      |         |          | V2X         |

#### 9.3.10.3.1. SessionID Field

This field SHALL indicate the value of the [SessionID](#) attribute at the time the event was generated.

#### 9.3.10.3.2. State Field

This field SHALL indicate the value of the [State](#) attribute at the time the event was generated.

#### 9.3.10.3.3. MaximumCurrent Field

This field SHALL indicate the value of the maximum charging current at the time the event was generated.

A non-zero value indicates that the EV has been enabled for charging and the value is taken directly from the [MaximumChargeCurrent](#) attribute. A zero value indicates that the EV has not been enabled for charging.

#### 9.3.10.3.4. MaximumDischargeCurrent Field

This field SHALL indicate the value of the maximum discharging current at the time the event was generated.

A non-zero value indicates that the EV has been enabled for discharging and the value is taken directly from the [MaximumDischargeCurrent](#) attribute. A zero value indicates that the EV has not been enabled for discharging.

### 9.3.10.4. EnergyTransferStopped Event

This event SHALL be generated whenever the EV stops charging or discharging, except when an EV has switched between charging and discharging under the control of the PowerAdjustment feature of the Device Energy Management cluster of the associated Device Energy Management device.

| ID | Name             | Type      | Constraint | Quality | Fallback | Conformance |
|----|------------------|-----------|------------|---------|----------|-------------|
| 0  | <b>SessionID</b> | uint32    | all        |         |          | M           |
| 1  | <b>State</b>     | StateEnum | all        |         |          | M           |




Page 741



| ID | Name               | Type                              | Constraint | Quality | Fallback | Conformance |
|----|--------------------|-----------------------------------|------------|---------|----------|-------------|
| 2  | Reason             | Energy-Transfer-StoppedReasonEnum | all        |         |          | M           |
| 4  | Energy-Transferred | energy-mWh                        | min 0      |         |          | M           |
| 5  | EnergyDis-charged  | energy-mWh                        | min 0      |         |          | V2X         |

#### 9.3.10.4.1. SessionID Field

This field SHALL indicate the value of the [SessionID](#) attribute prior to the energy transfer stopping.

#### 9.3.10.4.2. State Field

This field SHALL indicate the value of the [State](#) attribute prior to the energy transfer stopping.

#### 9.3.10.4.3. Reason Field

This field SHALL indicate the reason why the energy transferred stopped.

#### 9.3.10.4.4. EnergyTransferred Field

This field SHALL indicate the amount of energy transferred from the EVSE to the EV since the previous EnergyTransferStarted event, in mWh.

#### 9.3.10.4.5. EnergyDischarged Field

This field SHALL indicate the amount of energy transferred from the EV to the EVSE since the previous EnergyTransferStarted event, in mWh.

#### 9.3.10.5. Fault Event

If the EVSE detects a fault it SHALL generate a Fault Event. The SupplyState attribute SHALL be set to DisabledError and the type of fault detected by the EVSE SHALL be stored in the FaultState attribute.

This event SHALL be generated when the FaultState changes from any error state. i.e. if it changes from NoError to any other state and if the error then clears, this would generate 2 events.

It is assumed that the fault will be cleared locally on the EVSE device. When all faults have been cleared, the EVSE device SHALL set the FaultState attribute to NoError and the SupplyState attribute SHALL be set back to its previous state.

| ID | Name      | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------|--------|------------|---------|----------|-------------|
| 0  | SessionID | uint32 | all        | X       |          | M           |

Page 742



| ID | Name                    | Type           | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|----------------|------------|---------|----------|-------------|
| 1  | State                   | StateEnum      | all        |         |          | M           |
| 2  | FaultStatePreviousState | FaultStateEnum | all        |         |          | M           |
| 4  | FaultStateCurrentState  | FaultStateEnum | all        |         |          | M           |

#### 9.3.10.5.1. SessionID Field

This field SHALL indicate the value of the [SessionID](#) attribute prior to the Fault State being changed. A value of null indicates no sessions have occurred before the fault occurred.

#### 9.3.10.5.2. State Field

This field SHALL indicate the value of the [State](#) attribute prior to the Fault State being changed.

#### 9.3.10.5.3. FaultStatePreviousState Field

This field SHALL indicate the value of the [FaultState](#) attribute prior to the Fault State being changed.

#### 9.3.10.5.4. FaultStateCurrentState Field

This field SHALL indicate the current value of the [FaultState](#) attribute.

#### 9.3.10.6. RFID Event

This event SHALL be generated when a RFID card has been read. This allows a controller to register the card ID and use this to authenticate and start the charging session.

| ID | Name | Type   | Constraint | Quality | Fallback | Conformance |
|----|------|--------|------------|---------|----------|-------------|
| 0  | UID  | octstr | max 10     |         |          | M           |

##### 9.3.10.6.1. UID Field

The UID field (ISO 14443A UID) is either 4, 7 or 10 bytes.

## 9.4. Energy EVSE Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for EVSE devices.




Page 743



### 9.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                       |
|----------|-------------------------------------------------------------------|
| 1        | Initial revision                                                  |
| 2        | Disallowed DEPONOFF feature and OnMode and StartUpMode attributes |

### 9.4.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | EEVSEM    |

### 9.4.3. Cluster ID

| ID     | Name             |
|--------|------------------|
| 0x009D | Energy EVSE Mode |

### 9.4.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

### 9.4.5. Data Types

#### 9.4.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

### 9.4.6. Attributes

Page 744



| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        |             |
| 0x0001 | CurrentMode    |      |            |         |          |        |             |
| 0x0002 | StartUpMode    |      |            |         |          |        | X           |
| 0x0003 | OnMode         |      |            |         |          |        | X           |

#### 9.4.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Manual mode tag in the ModeTags field list.

Modes with entries in the SupportedModes attribute which contain multiple mode tags permitting charging or discharging under different conditions SHALL permit the charging or discharging to occur if any of the conditions are satisfied.

Modes SHALL NOT have both the Manual tag and the TimeOfUse or SolarCharging tags defined in the SupportedModes attribute.

### 9.4.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

#### 9.4.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name      |
|----------------|-----------|
| 0x0000         | Auto      |
| 0x0001         | Quick     |
| 0x0002         | Quiet     |
| 0x0003         | LowNoise  |
| 0x0004         | LowEnergy |
| 0x0005         | Vacation  |
| 0x0006         | Min       |
| 0x0007         | Max       |
| 0x0008         | Night     |
| 0x0009         | Day       |
| 0x4000         | Manual    |




Page 745



| Mode Tag Value | Name          |
|----------------|---------------|
| 0x4001         | TimeOfUse     |
| 0x4002         | SolarCharging |
| 0x4003         | V2X           |

#### 9.4.7.1.1. Manual Tag

While in modes with this tag, and once enabled with the EnableCharging command, the EVSE will permit charging based on demand from the EV.

#### 9.4.7.1.2. TimeOfUse Tag

While in modes with this tag, and once enabled with the EnableCharging command, the EVSE will attempt to automatically start charging based on the user's charging targets (for example, set based on a Time of Use tariff to charge at the cheapest times of the day).

#### 9.4.7.1.3. SolarCharging Tag

While in modes with this tag, and once enabled with the EnableCharging, the EVSE will attempt to automatically start charging based on available excess solar PV generation, limiting the charging power to avoid importing energy from the grid.

#### 9.4.7.1.4. V2X Tag

While in modes with this tag, and once enabled with the EnableDischarging command, the EVSE will permit discharging based on the current charge state of the EV, and its control from an associated Device Energy Management cluster.

|             |                                                                                                                                                                                                                         |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | being in a mode with this tag set or not does not affect the handling of the EnableDischarging command by the Energy EVSE cluster, but once enabled, only modes with this tag enable the discharging to actually occur. |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

### 9.4.8. Mode Examples

A few examples of EVSE modes and their mode tags are provided below.

- For the "Manual" mode, tags: 0x4000 (Manual)
- For the "Auto-scheduled" mode, tags: 0x4001 (TimeOfUse)
- For the "Solar" mode, tags: 0x4002 (SolarCharging)
- For the "Auto-scheduled with Solar charging" mode, tags: 0x4001 (TimeOfUse), 0x4002 (SolarCharging)
- For the "Vehicle-to-home with Solar charging" mode, tags: 0x4002 (SolarCharging), 0x4003 (V2X)

## 9.5. Water Heater Management Cluster

This cluster is used to allow clients to control the operation of a hot water heating appliance so that

Page 746



it can be used with energy management.

Heating of hot water is one of the main energy uses in homes, and when coupled with the Energy Management cluster, it can help consumers save cost (e.g. using power at cheaper times or from local solar PV generation).

### 9.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                            |
|----------|----------------------------------------|
| 1        | Initial revision                       |
| 2        | Added events and simplified data types |

### 9.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | EWATERHTR |

### 9.5.3. Cluster ID

| ID     | Name                    |
|--------|-------------------------|
| 0x0094 | Water Heater Management |

### 9.5.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature          | Conformance | Summary                                                     |
|-----|------|------------------|-------------|-------------------------------------------------------------|
| 0   | EM   | EnergyManagement | 0           | Allows energy management control of the tank                |
| 1   | TP   | TankPercent      | 0           | Supports monitoring the percentage of hot water in the tank |

### 9.5.5. Dependencies

This cluster SHALL be on an endpoint that also includes the Thermostat cluster as this cluster is dependent on the Thermostat cluster.




Page 747



## 9.5.6. Data Types

### 9.5.6.1. WaterHeaterHeatSourceBitmap Type

This data type is derived from map8.

| Bit | Name              | Summary                          | Conformance |
|-----|-------------------|----------------------------------|-------------|
| 0   | ImmersionElement1 | Immersion Heating Element 1      | M           |
| 1   | ImmersionElement2 | Immersion Heating Element 2      | M           |
| 2   | HeatPump          | Heat pump Heating                | M           |
| 3   | Boiler            | Boiler Heating (e.g. Gas or Oil) | M           |
| 4   | Other             | Other Heating                    | M           |

### 9.5.6.2. BoostStateEnum Type

This data type is derived from enum8.

| Value | Name     | Summary                       | Conformance |
|-------|----------|-------------------------------|-------------|
| 0     | Inactive | Boost is not currently active | M           |
| 1     | Active   | Boost is currently active     | M           |

### 9.5.6.3. WaterHeaterBoostInfoStruct Type

| ID | Name              | Type        | Constraint           | Quality | Fallback | Access | Conformance         |
|----|-------------------|-------------|----------------------|---------|----------|--------|---------------------|
| 0  | Duration          | elapsed-s   | min 1                |         |          |        | M                   |
| 1  | OneShot           | bool        | all                  |         | False    |        | [!TP], [TP].a-      |
| 2  | EmergencyBoost    | bool        | all                  |         | False    |        | O                   |
| 3  | TemporarySetpoint | temperature | desc                 |         |          |        | O                   |
| 4  | TargetPercentage  | percent     | all                  |         |          |        | TargetRe-heat, [TP] |
| 5  | TargetRe-heat     | percent     | max TargetPercentage |         |          |        | [TP].a-             |

Page 748







#### 9.5.6.3.1. Duration Field

This field SHALL indicate the time period, in seconds, for which the boost state is activated.

#### 9.5.6.3.2. OneShot Field

This field SHALL indicate whether the boost state SHALL be automatically canceled once the hot water has reached either:

- the set point temperature (from the thermostat cluster)
- the [TemporarySetpoint](#) temperature (if specified)
- the [TargetPercentage](#) (if specified).

#### 9.5.6.3.3. EmergencyBoost Field

This field SHALL indicate that the consumer wants the water to be heated quickly. This MAY cause multiple heat sources to be activated (e.g. a heat pump and direct electric immersion heating element).

The choice of which heat sources are activated is manufacturer specific.

#### 9.5.6.3.4. TemporarySetpoint Field

This field SHALL indicate the target temperature to which the water will be heated.

If included, it SHALL be used instead of the thermostat cluster set point temperature whilst the boost state is activated.

The value of this field SHALL be within the constraints of the MinHeatSetpointLimit and MaxHeatSetpointLimit attributes (inclusive), of the thermostat cluster.

#### 9.5.6.3.5. TargetPercentage Field

This field SHALL indicate the target percentage of hot water in the tank that the TankPercentage attribute must reach before the heating is switched off.

#### 9.5.6.3.6. TargetReheat Field

This field SHALL indicate the percentage to which the hot water in the tank SHALL be allowed to fall before again beginning to reheat it.

For example if the [TargetPercentage](#) was 80%, and the [TargetReheat](#) was 40%, then after initial heating to 80% hot water, the tank may have hot water drawn off until only 40% hot water remains. At this point the heater will begin to heat back up to 80% of hot water. If this field and the [OneShot](#) field were both omitted, heating would begin again after any water draw which reduced the [TankPercentage](#) below 80%.

This field SHALL be less than or equal to the [TargetPercentage](#) field.




Page 749



## 9.5.7. Attributes

| ID     | Name                         | Type                            | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------------|---------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>HeaterTypes</b>           | Water-Heater-Heat-SourceBit map | all        | F       |          | R V    | M           |
| 0x0001 | <b>HeatDemand</b>            | Water-Heater-Heat-SourceBit map | all        |         |          | R V    | M           |
| 0x0002 | <b>TankVolume</b>            | uint16                          | all        |         |          | R V    | EM          |
| 0x0003 | <b>EstimatedHeatRequired</b> | energy-mWh                      | min 0      |         |          | R V    | EM          |
| 0x0004 | <b>TankPercentage</b>        | percent                         | all        |         |          | R V    | TP          |
| 0x0005 | <b>BoostState</b>            | BoostStateEnum                  | all        |         |          | R V    | M           |

### 9.5.7.1. HeaterTypes Attribute

This attribute SHALL indicate the heat sources that the water heater can call on for heating. If a bit is set then the water heater supports the corresponding heat source.

### 9.5.7.2. HeatDemand Attribute

This attribute SHALL indicate if the water heater is heating water. If a bit is set then the corresponding heat source is active.

### 9.5.7.3. TankVolume Attribute

This attribute SHALL indicate the volume of water that the hot water tank can hold (in units of Litres). This allows an energy management system to estimate the required heating energy needed to reach the target temperature.

### 9.5.7.4. EstimatedHeatRequired Attribute

This attribute SHALL indicate the estimated heat energy needed to raise the water temperature to the target setpoint. This can be computed by taking the specific heat capacity of water (4182 J/kg °C) and by knowing the current temperature of the water, the tank volume and target temperature.

Page 750



For example, if the target temperature was 60°C, the current temperature was 20°C and the tank volume was 100L:

|                      |                                                                        |
|----------------------|------------------------------------------------------------------------|
| Mass of water        | = 1kg per Litre                                                        |
| Total Mass           | = 100 x 1kg = 100kg                                                    |
| $\Delta$ Temperature | = (target temperature - current temperature)<br>= (60°C - 20°C) = 40°C |

Energy required to  
heat the water to 60°C =  $4182 \times 40 \times 100 = 16,728,000$  J

Converting Joules in to Wh of heat (divide by 3600):  
=  $16,728,000 \text{ J} / 3600$   
= 4647 Wh (4.65kWh)

If the TankPercent feature is supported, then this estimate SHALL also take into account the percentage of the water in the tank which is already hot.

#### NOTE

The electrical energy required to heat the water depends on the heating system used to heat the water. For example, a direct electric immersion heating element can be close to 100% efficient, so the electrical energy needed to heat the hot water is nearly the same as the EstimatedHeatEnergyRequired. However some forms of heating, such as an air-source heat pump which extracts heat from ambient air, requires much less electrical energy to heat hot water. Heat pumps can produce 3kWh of heat output for 1kWh of electrical energy input. The conversion between heat energy and electrical energy is outside the scope of this cluster.

### 9.5.7.5. TankPercentage Attribute

This attribute SHALL indicate an approximate level of hot water stored in the tank, which might help consumers understand the amount of hot water remaining in the tank. The accuracy of this attribute is manufacturer specific.

In most hot water tanks, there is a stratification effect where the hot water layer rests above a cooler layer of water below. For this reason cold water is fed in at the bottom of the tank and the hot water is drawn from the top.

Some water tanks might use multiple temperature probes to estimate the level of the hot water layer. A water heater with multiple temperature probes is likely to implement an algorithm to estimate the hot water tank percentage by taking into account the temperature values of each probe to determine the height of the hot water.

However it might be possible with a single temperature probe to estimate how much hot water is left using a simpler algorithm:



Page 751



For example, if the target temperature was 60°C, the `CurrentTemperature` was 40°C from a single temperature probe measuring the average water temperature and the temperature of incoming cold water (`COLD_WATER_TEMP`) was assumed to be 20°C:

```
TankPercentage = int(((current temperature - COLD_WATER_TEMP) / (target
temperature - COLD_WATER_TEMP)) * 100)
TankPercentage = min( max(TankPercentage,0), 100)
```

```
TankPercentage = 50%
```

#### 9.5.7.6. BoostState Attribute

This attribute SHALL indicate whether the Boost, as triggered by a [Boost command](#), is currently [Active](#) or [Inactive](#).

See [Section 9.5.8.1, “Boost Command”](#) and [Section 9.5.8.2, “CancelBoost Command”](#) for more details.

### 9.5.8. Commands

| ID   | Name        | Direction                   | Response | Access | Conformance |
|------|-------------|-----------------------------|----------|--------|-------------|
| 0x00 | Boost       | client $\Rightarrow$ server | Y        | M      | M           |
| 0x01 | CancelBoost | client $\Rightarrow$ server | Y        | M      | M           |

#### 9.5.8.1. Boost Command

Allows a client to request that the water heater is put into a Boost state.

| ID | Name             | Type                         | Constraint | Quality | Fallback | Conformance |
|----|------------------|------------------------------|------------|---------|----------|-------------|
| 0  | <b>BoostInfo</b> | Water-HeaterBoost-InfoStruct | all        |         |          | M           |

##### 9.5.8.1.1. Effect on receipt

On receipt of this command, this SHALL allow the water heater to attempt to heat the water, which may override other settings, for example, if the Water Heater Mode is set to [Off](#), or [Timed](#) and it is during one of the Off periods.

If the duration field is too short for the water heater to accept, for example a heat pump may take several minutes to ramp up in operation, then the boost command SHALL be rejected with a status of `INVALID_IN_STATE`.

If successful, the value of the [BoostState](#) attribute SHALL transition to [Active](#), and a response with

Page 752







status of SUCCESS SHALL be returned, and a [BoostStarted](#) event SHALL be generated to include the field values received in the command.

The water in the tank SHALL be heated until one of the following conditions is met:

- the temperature reaches the set point in the corresponding thermostat cluster or the [TemporarySetpoint](#) (if included)
- the [TankPercentage](#) attribute value reaches the [TargetPercentage](#) (if it was included)

If [OneShot](#) is specified then once the hot water has reached the set point temperature (or the [TemporarySetpoint](#) temperature, if specified) or the [TargetPercentage](#) (if specified), or the boost command's duration times out after the specified [Duration](#), then [BoostState](#) transitions to [Inactive](#). This SHALL cause the [BoostEnded](#) event to be generated.

If the Water Heater was already in the [BoostState](#) 'Active' when this command is received, it SHALL continue in this [BoostState](#), but SHALL discard the effect of the values of the fields from the previous [Boost](#) commands, and SHALL continue with the values of the fields from the new [Boost](#) command. A new [BoostStarted](#) event SHALL be generated to include the field values received in the new command.

#### 9.5.8.2. CancelBoost Command

Allows a client to cancel an ongoing Boost operation.

This command has no payload.

##### 9.5.8.2.1. Effect on receipt

If the [BoostState](#) attribute value was already [Inactive](#) when this command is received, the [BoostState](#) attribute value shall remain [Inactive](#) and the server SHALL return SUCCESS.

Otherwise the Water Heater SHALL transition the [BoostState](#) to [Inactive](#), generate a [BoostEnded](#) event, and the water heating reverts to being controlled through the current Water Heater Mode (e.g. [Off](#), [Manual](#) or [Timed](#)).

#### 9.5.9. Events

| ID   | Name                         | Priority | Quality | Access | Conformance |
|------|------------------------------|----------|---------|--------|-------------|
| 0x00 | <a href="#">BoostStarted</a> | INFO     |         | V      | M           |
| 0x01 | <a href="#">BoostEnded</a>   | INFO     |         | V      | M           |

##### 9.5.9.1. BoostStarted Event

This event SHALL be generated whenever a [Boost](#) command is accepted.




Page 753



| ID | Name      | Type                       | Constraint | Quality | Fallback | Conformance |
|----|-----------|----------------------------|------------|---------|----------|-------------|
| 0  | BoostInfo | WaterHeaterBoostInfoStruct | all        |         |          | M           |

The corresponding structure fields within the [WaterHeaterBoostInfoStruct](#) are copied from the [Boost](#) command.

#### 9.5.9.2. BoostEnded Event

This event SHALL be generated whenever the [BoostState](#) transitions from [Active](#) to [Inactive](#).

## 9.6. Water Heater Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for water heater devices.

### 9.6.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 9.6.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | WHM       |

### 9.6.3. Cluster ID

| ID     | Name              |
|--------|-------------------|
| 0x009E | Water Heater Mode |

### 9.6.4. Features

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

### 9.6.5. Data Types

Page 754



### 9.6.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

## 9.6.6. Attributes

| ID     | Name           | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | SupportedModes |      |            |         |          |        |             |
| 0x0001 | CurrentMode    |      |            |         |          |        |             |
| 0x0002 | StartUpMode    |      |            |         |          |        | X           |
| 0x0003 | OnMode         |      |            |         |          |        | X           |

### 9.6.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the Manual mode tag in the ModeTags field list.

At least one entry in the SupportedModes attribute SHALL include the Off mode tag in the ModeTags field list.

An entry in the SupportedModes attribute that includes one of an Off, Manual, or Timed tag SHALL NOT also include an additional instance of any one of these tag types.

## 9.6.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

### 9.6.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name  |
|----------------|-------|
| 0x0000         | Auto  |
| 0x0001         | Quick |



Page 755



| Mode Tag Value | Name      |
|----------------|-----------|
| 0x0002         | Quiet     |
| 0x0003         | LowNoise  |
| 0x0004         | LowEnergy |
| 0x0005         | Vacation  |
| 0x0006         | Min       |
| 0x0007         | Max       |
| 0x0008         | Night     |
| 0x0009         | Day       |
| 0x4000         | Off       |
| 0x4001         | Manual    |
| 0x4002         | Timed     |

#### 9.6.7.1.1. Off Tag

While in modes with this tag, the device will not attempt to keep the water warm.

#### 9.6.7.1.2. Manual Tag

While in modes with this tag, the device will attempt to keep the water warm based on the OccupiedHeatingSetpoint attribute of the associated Thermostat cluster.

#### 9.6.7.1.3. Timed Tag

While in modes with this tag, the device will attempt to keep the water warm based on the Schedules attribute of the associated Thermostat cluster.

### 9.6.8. Mode Examples

A few examples of Water Heater modes and their mode tags are provided below.

- For the "Off" mode, tags: 0x4000 (Off)
- For the "Manual" mode, tags: 0x4001 (Manual)
- For the "Timed" mode, tags: 0x4002 (Timed)

## 9.7. Energy Preference Cluster

This cluster provides an interface to specify preferences for how devices should consume energy.

**NOTE** Support for Energy Preference cluster is provisional.

Page 756







### 9.7.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 9.7.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | EPREF     |

### 9.7.3. Cluster ID

| ID     | Name              | Conformance |
|--------|-------------------|-------------|
| 0x009B | Energy Preference | P           |

### 9.7.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature                 | Conformance | Summary                                                        |
|-----|------|-------------------------|-------------|----------------------------------------------------------------|
| 0   | BALA | EnergyBalance           | O.a+        | Device can balance energy consumption vs. another priority     |
| 1   | LPMS | LowPowerModeSensitivity | O.a+        | Device can adjust the conditions for entering a low power mode |

#### 9.7.4.1. EnergyBalance Feature

This feature allows a user to select from a list of energy balances with associated descriptions of which strategies a device will use to target the specified balance.

#### 9.7.4.2. LowPowerModeSensitivity Feature

This feature allows the user to select a condition or set of conditions which will cause the device to switch to a mode using less power. For example, a device might provide a scale of durations that must elapse without user interaction before it goes to sleep.

### 9.7.5. Data Types




Page 757



### 9.7.5.1. EnergyPriorityEnum Type

This data type is derived from enum8.

| Value | Name                    | Summary                                 | Conformance |
|-------|-------------------------|-----------------------------------------|-------------|
| 0     | <b>Comfort</b>          | User comfort                            | M           |
| 1     | <b>Speed</b>            | Speed of operation                      | M           |
| 2     | <b>Efficiency</b>       | Amount of Energy consumed by the device | M           |
| 3     | <b>WaterConsumption</b> | Amount of water consumed by the device  | M           |

#### 9.7.5.1.1. Comfort Value

This value SHALL emphasize user comfort; e.g. local temperature for a thermostat.

#### 9.7.5.1.2. Speed Value

This value SHALL emphasize how quickly a device accomplishes its targeted use; e.g. how quickly a robot vacuum completes a cleaning cycle.

#### 9.7.5.1.3. Efficiency Value

This value SHALL emphasize how much energy a device uses; e.g. electricity usage for a Pump.

#### 9.7.5.1.4. Water consumption Value

This value SHALL emphasize how much water is consumed during device use; e.g. how much water a dishwasher uses during a cleaning cycle.

### 9.7.5.2. BalanceStruct Type

This represents a step along a scale of preferences.

| ID | Name         | Type    | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------|---------|------------|---------|----------|--------|-------------|
| 0  | <b>Step</b>  | percent | all        | F       |          |        | M           |
| 1  | <b>Label</b> | string  | max 64     | F       |          |        | O           |

#### 9.7.5.2.1. Step Field

This field SHALL indicate the relative value of this step.

#### 9.7.5.2.2. Label Field

This field SHALL indicate an optional string explaining which actions a device might take at the given step value.

Page 758



## 9.7.6. Attributes

| ID     | Name                                  | Type                                       | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------------------------------|--------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>EnergyBalances</b>                 | list[ <a href="#">BalanceStruct</a> ]      | 2 to 10    | F       |          | R V    | BALA        |
| 0x0001 | <b>CurrentEnergyBalance</b>           | uint8                                      | all        | N       |          | RW VO  | BALA        |
| 0x0002 | <b>EnergyPriorities</b>               | list[ <a href="#">EnergyPriorityEnum</a> ] | 2          | F       |          | R V    | BALA        |
| 0x0003 | <b>LowPowerModeSensitivities</b>      | list[ <a href="#">BalanceStruct</a> ]      | 2 to 10    | F       |          | R V    | LPMS        |
| 0x0004 | <b>CurrentLowPowerModeSensitivity</b> | uint8                                      | all        | N       |          | RW VO  | LPMS        |

### 9.7.6.1. EnergyBalances Attribute

This attribute SHALL indicate a list of [BalanceStructs](#), each representing a step along a linear scale of relative priorities. A [Step](#) field with a value of zero SHALL indicate that the device SHOULD entirely favor the priority specified by the first element in [EnergyPriorities](#); whereas a [Step](#) field with a value of 100 SHALL indicate that the device SHOULD entirely favor the priority specified by the second element in [EnergyPriorities](#). The midpoint value of 50 SHALL indicate an even split between the two priorities.

This SHALL contain at least two [BalanceStructs](#).

Each [BalanceStruct](#) SHALL have a [Step](#) field larger than the [Step](#) field on the previous [BalanceStruct](#) in the list.

The first [BalanceStruct](#) SHALL have a [Step](#) value of zero, and the last [BalanceStruct](#) SHALL have a [Step](#) value of 100.

### 9.7.6.2. CurrentEnergyBalance Attribute

This attribute SHALL indicate the current preference of the user for balancing different priorities during device use. The value of this attribute is the index, 0-based, into the [EnergyBalances](#) attribute for the currently selected balance.

If an attempt is made to set this attribute to an index outside the maximum index for [EnergyBalances](#), a response with the status code `CONSTRAINT_ERROR` SHALL be returned.




Page 759



If the value of [EnergyBalances](#) changes after an update, the device SHALL migrate the value of the [CurrentEnergyBalance](#) attribute to the index which the manufacturer specifies most closely matches the previous value, while preserving extreme preferences as follows:

1. If the previous value of [CurrentEnergyBalance](#) was zero, indicating a total preference for the priority specified by the first element in [EnergyPriorities](#), the new value of [CurrentEnergyBalance](#) SHALL also be zero.
2. If the previous value of [CurrentEnergyBalance](#) was the index of the last [BalanceStruct](#) in the previous value of [EnergyBalances](#), indicating a total preference for the priority specified by the last element in [EnergyPriorities](#), the new value of [CurrentEnergyBalance](#) SHALL be the index of the last element in the updated value of [EnergyBalances](#).

#### 9.7.6.3. **EnergyPriorities** Attribute

This attribute SHALL indicate two extremes for interpreting the values in the [EnergyBalances](#) attribute. These two priorities SHALL be in opposition to each other; e.g. Comfort vs. Efficiency or Speed vs. WaterConsumption.

If the value of [EnergyPriorities](#) changes after an update to represent a new balance between priorities, the value of the [CurrentEnergyBalance](#) attribute SHALL be set to its default.

#### 9.7.6.4. **LowPowerModeSensitivities** Attribute

This attribute SHALL indicate a list of [BalanceStructs](#), each representing a condition or set of conditions for the device to enter a low power mode.

This SHALL contain at least two [BalanceStructs](#).

Each [BalanceStruct](#) SHALL have a [Step](#) field larger than the [Step](#) field on the previous [BalanceStruct](#) in the list.

#### 9.7.6.5. **CurrentLowPowerModeSensitivity** Attribute

This attribute SHALL indicate the current preference of the user for determining when the device should enter a low power mode. The value of this attribute is the index, 0-based, into the [LowPowerModeSensitivities](#) attribute for the currently selected preference.

If an attempt is made to set this attribute to an index outside the maximum index for [LowPowerModeSensitivities](#), a response with the status code `CONSTRAINT_ERROR` SHALL be returned.

If the value of [LowPowerModeSensitivities](#) changes after an update, the device SHALL migrate the value of the [LowPowerModeSensitivity](#) attribute to the index which the manufacturer specifies most closely matches the previous value.

## 9.8. Device Energy Management Mode Cluster

This cluster is derived from the Mode Base cluster and defines additional mode tags and name-spaced enumerated values for Device Energy Management devices.

Page 760



### 9.8.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                                       |
|----------|-------------------------------------------------------------------|
| 1        | Initial revision                                                  |
| 2        | Disallowed DEPONOFF feature and OnMode and StartUpMode attributes |

### 9.8.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Mode Base | Application | Endpoint | DEMM      |

### 9.8.3. Cluster ID

| ID     | Name                          |
|--------|-------------------------------|
| 0x009F | Device Energy Management Mode |

### 9.8.4. Features

| Bit | Code     | Feature | Conformance | Summary                           |
|-----|----------|---------|-------------|-----------------------------------|
| 0   | DEPONOFF | OnOff   | X           | Dependency with the OnOff cluster |

### 9.8.5. Data Types

#### 9.8.5.1. ModeOptionStruct Type

The table below lists the changes relative to the Mode Base cluster for the fields of the ModeOptionStruct type. A blank field indicates no change.

| ID | Name     | Type | Constraint | Quality | Fallback | Access | Conformance |
|----|----------|------|------------|---------|----------|--------|-------------|
| 0  | Label    |      |            |         |          |        | M           |
| 1  | Mode     |      |            |         |          |        | M           |
| 2  | ModeTags |      | 1 to 8     |         |          |        | M           |

### 9.8.6. Attributes




Page 761



| ID     | Name                  | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>SupportedModes</b> |      |            |         |          |        |             |
| 0x0001 | <b>Current-Mode</b>   |      |            |         |          |        |             |
| 0x0002 | <b>StartUp-Mode</b>   |      |            |         |          |        | X           |
| 0x0003 | <b>OnMode</b>         |      |            |         |          |        | X           |

#### 9.8.6.1. SupportedModes Attribute

At least one entry in the SupportedModes attribute SHALL include the NoOptimization mode tag in the ModeTags field.

At least one entry in the SupportedModes attribute SHALL include the LocalOptimization mode tag in the ModeTags field list.

At least one entry in the SupportedModes attribute SHALL include the GridOptimization mode tag in the ModeTags field list.

An entry in the SupportedModes attribute that includes one of an DeviceOptimization, LocalOptimization, or GridOptimization tags SHALL NOT also include NoOptimization tag.

### 9.8.7. Derived Cluster Namespace

This namespace includes definitions for data associated exclusively with the derived cluster.

#### 9.8.7.1. Mode Tags

The following table defines the base and derived-cluster-specific ModeTag values.

| Mode Tag Value | Name             |
|----------------|------------------|
| 0x0000         | <b>Auto</b>      |
| 0x0001         | <b>Quick</b>     |
| 0x0002         | <b>Quiet</b>     |
| 0x0003         | <b>LowNoise</b>  |
| 0x0004         | <b>LowEnergy</b> |
| 0x0005         | <b>Vacation</b>  |
| 0x0006         | <b>Min</b>       |
| 0x0007         | <b>Max</b>       |
| 0x0008         | <b>Night</b>     |
| 0x0009         | <b>Day</b>       |

Page 762



| Mode Tag Value | Name               |
|----------------|--------------------|
| 0x4000         | NoOptimization     |
| 0x4001         | DeviceOptimization |
| 0x4002         | LocalOptimization  |
| 0x4003         | GridOptimization   |

#### 9.8.7.1.1. NoOptimization Tag

The device prohibits optimization of energy usage management: its energy usage is determined only by the user configuration and internal device needs.

#### 9.8.7.1.2. DeviceOptimization Tag

The device is permitted to manage its own energy usage. For example, using tariff information it may obtain.

#### 9.8.7.1.3. LocalOptimization Tag

The device permits management of energy usage by an energy manager to optimize the local energy usage.

#### 9.8.7.1.4. GridOptimization Tag

The device permits management of energy usage by an energy manager to optimize the grid energy usage.

### 9.8.8. Mode Examples

A few examples of Device Energy Management modes and their mode tags are provided below.

- For the "No Energy Management (Forecast reporting only)" mode, tags: 0x4000 (NoOptimization).
- For the "Device Energy Management" mode, tags: 0x4001 (DeviceOptimization).
- For the "Home Energy Management" mode, tags: 0x4001 (DeviceOptimization), 0x4002 (LocalOptimization).
- For the "Grid Energy Management" mode, tags: 0x4003 (GridOptimization).
- For the "Full Energy Management" mode, tags: 0x4001 (DeviceOptimization), 0x4002 (LocalOptimization), 0x4003 (GridOptimization).

## 9.9. Commodity Price Cluster

The Commodity Price Cluster provides the mechanism for communicating Gas, Energy, or Water pricing information within the premises.




Page 763



### 9.9.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                      |
|----------|--------------------------------------------------|
| 1        | Mandatory global ClusterRevision attribute added |
| 2        | Updated from SE1.4 version; CCB 1447 2964 2965   |
| 3        | CCBs 2043 2706 2810 2912 3566                    |
| 4        | Initial Matter revision                          |

### 9.9.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | SEPR      |

### 9.9.3. Cluster ID

| ID     | Name            |
|--------|-----------------|
| 0x0095 | Commodity Price |

### 9.9.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature     | Conformance | Summary                    |
|-----|------|-------------|-------------|----------------------------|
| 0   | FORE | Forecasting | 0           | Forecasts upcoming pricing |

### 9.9.5. Data Types

#### 9.9.5.1. CommodityPriceDetailBitmap Type

This data type is derived from map16.

| Bit | Name        | Summary                                                                        | Conformance |
|-----|-------------|--------------------------------------------------------------------------------|-------------|
| 0   | Description | A textual description of a price; e.g. the name of a rate plan.                | M           |
| 1   | Components  | A breakdown of the component parts of a price; e.g. generation, delivery, etc. | M           |

Page 764







### 9.9.5.2. CommodityPriceComponentStruct Type

This represents a component of a given price; it is only used in the [Components](#) field.

| ID | Name                     | Type                | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------------|---------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Price</b>             | money               | all        |         |          |        | M           |
| 1  | <b>Source</b>            | TariffPriceTypeEnum | all        |         |          |        | M           |
| 2  | <b>Description</b>       | string              | max 32     |         |          |        | O           |
| 3  | <b>TariffComponentID</b> | uint32              | all        |         |          |        | O           |

#### 9.9.5.2.1. Price Field

This field SHALL indicate the component price of the commodity per [TariffUnit](#), with the currency indicated by the currency of the [Price](#) field of the parent [CommodityPriceStruct](#).

#### 9.9.5.2.2. PriceLevel Field

This field SHALL indicate the tariff component price level.

#### 9.9.5.2.3. Source Field

This field SHALL indicate the source of the price component.

#### 9.9.5.2.4. Description Field

This field SHALL indicate a description of the pricing plan yielding the value of the [Price](#) field. For example, this field may contain the name of the current block of the selected billing plan, or the name of the time of usage tier.

#### 9.9.5.2.5. TariffComponentID Field

This field SHALL indicate the [ID](#) of the associated [TariffComponent](#) for this price component. If there is no associated TariffComponent, this field SHALL be omitted.

### 9.9.5.3. CommodityPriceStruct Type

This represents a price over a given period.

| ID | Name                | Type    | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------|---------|------------|---------|----------|--------|-------------|
| 0  | <b>Period-Start</b> | epoch-s | all        |         |          |        | M           |




Page 765



| ID | Name               | Type                                 | Constraint            | Quality | Fallback | Access | Conformance |
|----|--------------------|--------------------------------------|-----------------------|---------|----------|--------|-------------|
| 1  | <b>PeriodEnd</b>   | epoch-s                              | min (PeriodStart + 1) | X       |          |        | M           |
| 2  | <b>Price</b>       | money                                | all                   |         |          |        | O.b+        |
| 3  | <b>PriceLevel</b>  | int16                                | all                   |         |          |        | O.b+        |
| 4  | <b>Description</b> | string                               | max 32                |         |          |        | O           |
| 5  | <b>Components</b>  | list[CommodityPrice-ComponentStruct] | max 10                |         | empty    |        | [Price]     |

#### 9.9.5.3.1. PeriodStart Field

This field SHALL indicate the beginning timestamp in UTC of the period covered by the price indicated in the [Price](#) field, or the price level indicated in the [Price Level](#) field, or both.

#### 9.9.5.3.2. PeriodEnd Field

This field SHALL indicate the ending timestamp in UTC of the period covered by the price indicated in the [Price](#) field, or the price level indicated in the [Price Level](#) field, or both.

If this field is null, then the period has no definite end.

#### 9.9.5.3.3. Price Field

This field SHALL indicate the price of the commodity per [TariffUnit](#).

#### 9.9.5.3.4. PriceLevel Field

This field SHALL indicate the tariff price level.

#### 9.9.5.3.5. Description Field

This field SHALL indicate a description of the pricing plan yielding the value of the [Price](#) field, or the [Price Level](#) field. For example, this field may contain the name of the selected billing plan.

#### 9.9.5.3.6. Components Field

This field SHALL indicate a list of the components that comprise the value in the [Price](#) field. For example, if a pricing plan has a base price and a surcharge for a given time of day, it may have two entries in the Components field.

If this field is not empty, the [Price](#) fields in the list SHALL sum to the value in the [Price](#) field.

Page 766







## 9.9.6. Attributes

| ID     | Name          | Type                       | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------|----------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | TariffUnit    | TariffUnitEnum             | all        |         |          | R V    | M           |
| 0x0001 | Currency      | currency                   | all        | X       |          | R V    | M           |
| 0x0002 | CurrentPrice  | CommodityPriceStruct       | all        | X       |          | R V    | M           |
| 0x0003 | PriceForecast | list[CommodityPriceStruct] | max 56     |         |          | R V    | FORE        |

### 9.9.6.1. TariffUnit Attribute

This attribute SHALL indicate the unit of measure for all pricing reported by this cluster.

### 9.9.6.2. Currency Attribute

This attribute SHALL indicate the currency for all pricing reported by this cluster. If the current currency is unknown, or cannot be determined, the value SHALL be null.

### 9.9.6.3. CurrentPrice Attribute

This attribute SHALL indicate the current price. If the current price is unknown, or cannot be determined, the value SHALL be null.

The [Description](#) and [Components](#) fields SHALL be omitted in this attribute's value.

### 9.9.6.4. PriceForecast Attribute

This attribute SHALL indicate the forecast of upcoming price changes. If the forecast is unable to be determined, this list SHALL be empty.

The list entries SHALL be in time order:

- All entries except the last one SHALL have a non-null [PeriodEnd](#).
- For all entries except the first one, [PeriodStart](#) SHALL be greater than the previous entry's [PeriodEnd](#).

The [Description](#) and [Components](#) fields SHALL be omitted from [CommodityPriceStructs](#) in this attribute's value.

If the [PeriodEnd](#) field is null on the value of the [CurrentPrice](#) attribute, then this list SHALL be empty.




Page 767



## 9.9.7. Commands

| ID   | Name                        | Direction       | Response                     | Access | Quality | Conformance                 |
|------|-----------------------------|-----------------|------------------------------|--------|---------|-----------------------------|
| 0x00 | GetDetailed-PriceRequest    | client ⇔ server | GetDetailed-PriceResponse    | O      |         | O                           |
| 0x01 | GetDetailed-PriceResponse   | client ⇐ server | N                            |        |         | GetDetailed-PriceRequest    |
| 0x02 | GetDetailedForecastRequest  | client ⇔ server | GetDetailed-ForecastResponse | O      | L       | [FORE]                      |
| 0x03 | GetDetailedForecastResponse | client ⇐ server | N                            |        | L       | GetDetailed-ForecastRequest |

### 9.9.7.1. GetDetailedPriceRequest Command

Upon receipt, this SHALL generate a GetDetailedPrice Response command.

| ID | Name    | Type                       | Constraint | Quality | Fallback | Conformance |
|----|---------|----------------------------|------------|---------|----------|-------------|
| 0  | Details | CommodityPriceDetailBitmap | all        |         |          | M           |

#### 9.9.7.1.1. Details Field

This field SHALL indicate which fields on the [CommodityPriceStruct](#) in the [GetDetailedPriceResponseCurrentPrice](#) field will be included.

### 9.9.7.2. GetDetailedPriceResponse Command

This command SHALL be generated in response to a GetDetailedPrice Request command. The data for this command SHALL be as follows:

| ID | Name          | Type                 | Constraint | Quality | Fallback | Conformance |
|----|---------------|----------------------|------------|---------|----------|-------------|
| 0  | Current-Price | CommodityPriceStruct | all        | X       |          | M           |

Page 768







#### 9.9.7.2.1. CurrentPrice Field

This field SHALL indicate the current price. Unlike the value returned from the [CurrentPrice](#) attribute, the [Description](#) and [Components](#) fields MAY be populated based on the value of the [GetDetailedPriceRequestDetails](#) field.

If the current price is unknown, or cannot be determined, the value SHALL be null.

#### 9.9.7.3. GetDetailedForecastRequest Command

Upon receipt, this SHALL generate a GetDetailedForecast Response command.

| ID | Name           | Type                                       | Constraint | Quality | Fallback | Conformance |
|----|----------------|--------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Details</b> | <a href="#">CommodityPriceDetailBitmap</a> | all        |         |          | M           |

##### 9.9.7.3.1. Details Field

This field SHALL indicate which fields on the [CommodityPriceStructs](#) in the [GetDetailedForecastResponsePriceForecast](#) field will be included.

#### 9.9.7.4. GetDetailedForecastResponse Command

This command SHALL be generated in response to a GetDetailedForecast Request command. The data for this command SHALL be as follows:

| ID | Name                 | Type                                         | Constraint | Quality | Fallback | Conformance |
|----|----------------------|----------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>PriceForecast</b> | list[ <a href="#">CommodityPriceStruct</a> ] | max 56     |         |          | M           |

##### 9.9.7.4.1. PriceForecast Field

This field SHALL indicate the current forecast of upcoming price changes. Unlike the value returned from the [PriceForecast](#) attribute, the [Description](#) and [Components](#) fields MAY be populated on each [CommodityPriceStruct](#) based on the value of the [GetDetailedPriceRequestDetails](#) field.

If the forecast is unable to be determined, this list SHALL be empty.

### 9.9.8. Events

| ID   | Name               | Priority | Quality | Access | Conformance |
|------|--------------------|----------|---------|--------|-------------|
| 0x00 | <b>PriceChange</b> | INFO     |         | V      | O           |




Page 769



### 9.9.8.1. PriceChange Event

This event SHALL be generated when the value of the [CurrentPrice](#) attribute changes.

| ID | Name                 | Type                                 | Constraint | Quality | Fallback | Conformance |
|----|----------------------|--------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Current-Price</b> | <a href="#">CommodityPriceStruct</a> |            | X       |          | M           |

#### 9.9.8.1.1. CurrentPrice Field

This field SHALL be the new value of the [CurrentPrice](#) attribute.

## 9.10. Meter Identification Cluster

This [Meter Identification Cluster](#) provides attributes for determining advanced information about utility metering device.

### 9.10.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description     |
|----------|-----------------|
| 1        | Initial version |

### 9.10.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | MTRID     |

### 9.10.3. Cluster ID

| ID     | Name                 |
|--------|----------------------|
| 0x0B06 | Meter Identification |

### 9.10.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code           | Feature        | Conformance | Summary                                    |
|-----|----------------|----------------|-------------|--------------------------------------------|
| 0   | <b>PWRTHLD</b> | PowerThreshold | O           | Supports information about power threshold |

Page 770





## 9.10.5. Data Types

### 9.10.5.1. MeterTypeEnum Type

This data type is derived from enum8.

| Value | Name    | Summary       | Conformance |
|-------|---------|---------------|-------------|
| 0x00  | Utility | Utility Meter | M           |
| 0x01  | Private | Private Meter | M           |
| 0x02  | Generic | Generic Meter | M           |

## 9.10.6. Attributes

| ID     | Name              | Type                                 | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------|--------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | MeterType         | <a href="#">MeterTypeEnum</a>        | all        | X       |          | R V    | M           |
| 0x0001 | PointOfDelivery   | string                               | max 64     | X       |          | R V    | M           |
| 0x0002 | MeterSerialNumber | string                               | max 64     | X       |          | R V    | M           |
| 0x0003 | ProtocolVersion   | string                               | max 64     | X       |          | R V    | O           |
| 0x0004 | PowerThreshold    | <a href="#">PowerThresholdStruct</a> | all        | X       |          | R V    | PWRTHLD     |

### 9.10.6.1. MeterType Attribute

This attribute SHALL indicate the Meter type features, decided by manufacturer. If the type is unavailable, this attribute SHALL be null.

### 9.10.6.2. PointOfDelivery Attribute

This attribute SHALL indicate the unique identification of the connection point for the premises for billing purposes. If the point of delivery is unavailable, this attribute SHALL be null.

### 9.10.6.3. MeterSerialNumber Attribute

This attribute SHALL indicate the serial number of the meter. If the serial number is unavailable, this attribute SHALL be null.

### 9.10.6.4. ProtocolVersion Attribute

This attribute SHALL indicate the underlying protocol version to express local market features. If the protocol version is unavailable, this attribute SHALL be null.



Page 771



#### 9.10.6.4.1. PowerThreshold Attribute

This attribute SHALL indicate the maximum instantaneous power demand that can be distributed to the customer without any risk of overload. If the maximum instantaneous power demand is unavailable, this attribute SHALL be null.

### 9.11. Commodity Metering Cluster

The Commodity Metering Cluster provides the mechanism for communicating commodity consumption information within a premises.

#### 9.11.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description     |
|----------|-----------------|
| 1        | Initial Release |

#### 9.11.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | COMMTR    |

#### 9.11.3. Cluster ID

| ID     | Name               |
|--------|--------------------|
| 0x0B07 | Commodity Metering |

#### 9.11.4. Data Types

##### 9.11.4.1. MeteredQuantityStruct Type

Provides access to the Electric Metering device's readings.

| ID | Name                | Type         | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------|--------------|------------|---------|----------|--------|-------------|
| 0  | Tariff-ComponentIDs | list[uint32] | max 128    |         |          |        | M           |
| 1  | Quantity            | int64        |            |         |          |        | M           |

##### 9.11.4.1.1. TariffComponentIDs Field

Indicates the specific [TariffComponentStructs](#) associated with the metered commodity.

Page 772



#### 9.11.4.1.2. Quantity Field

This field indicates the amount of a commodity metered during the associated [TariffComponentStructs](#).

#### 9.11.5. Attributes

| ID     | Name                                        | Type                                          | Constraint                   | Quality | Fallback | Access | Conformance |
|--------|---------------------------------------------|-----------------------------------------------|------------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>MeteredQuantity</b>                      | list[ <a href="#">MeteredQuantityStruct</a> ] | max MaximumMeteredQuantities | X       |          | R V    | M           |
| 0x0001 | <b>MeteredQuantity-<br/>Time-<br/>stamp</b> | epoch-s                                       | all                          | X       |          | R V    | M           |
| 0x0002 | <b>TariffUnit</b>                           | <a href="#">TariffUnitEnum</a>                | all                          | X       |          | R V    | M           |
| 0x0003 | <b>MaximumMeteredQuantities</b>             | uint16                                        | min 1                        | X       |          | R V    | M           |

##### 9.11.5.1. MeteredQuantity Attribute

The most recent summed value of a commodity delivered to and consumed in the premises. A null value indicates that metering data is currently unavailable.

##### 9.11.5.2. MeteredQuantityTimestamp Attribute

The timestamp in UTC for when the value of the [MeteredQuantity](#) attribute was last updated. A null value indicates that metering data is currently unavailable.

##### 9.11.5.3. TariffUnit Attribute

This attribute SHALL indicate the unit for the [Quantity](#) field on all [MeteredQuantityStructs](#) in the [MeteredQuantity](#) attribute. A null value indicates that metering data is currently unavailable.

##### 9.11.5.4. MaximumMeteredQuantities Attribute

This attribute SHALL indicate the maximum number of [MeteredQuantityStructs](#) in the [MeteredQuantity](#) attribute. A null value indicates that metering data is currently unavailable.

### 9.12. Commodity Tariff Cluster

The [CommodityTariffCluster](#) provides the mechanism for communicating Commodity Tariff infor-




Page 773



mation within the premises.

### 9.12.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description             |
|----------|-------------------------|
| 1        | Initial Matter revision |

### 9.12.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | SETRF     |

### 9.12.3. Cluster ID

| ID     | Name             |
|--------|------------------|
| 0x0700 | Commodity Tariff |

### 9.12.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code           | Feature        | Conformance | Summary                                                                       |
|-----|----------------|----------------|-------------|-------------------------------------------------------------------------------|
| 0   | <b>PRICE</b>   | Pricing        | O.a+        | Supports information about commodity pricing                                  |
| 1   | <b>FCRED</b>   | FriendlyCredit | O.a+        | Supports information about when friendly credit periods begin and end         |
| 2   | <b>AUXLD</b>   | AuxiliaryLoad  | O.a+        | Supports information about when auxiliary loads should be enabled or disabled |
| 3   | <b>PEAKP</b>   | PeakPeriod     | O           | Supports information about peak periods                                       |
| 4   | <b>PWRTHLD</b> | PowerThreshold | O           | Supports information about power threshold                                    |

Page 774







| Bit | Code | Feature       | Conformance | Summary                                                          |
|-----|------|---------------|-------------|------------------------------------------------------------------|
| 5   | RNDM | Randomization | O           | Supports information about randomization of calendar day entries |

## 9.12.5. Data Types

### 9.12.5.1. DayPatternDayOfWeekBitmap Type

This data type is derived from map8.

| Bit | Name             | Summary   | Conformance |
|-----|------------------|-----------|-------------|
| 0   | <b>Sunday</b>    | Sunday    | M           |
| 1   | <b>Monday</b>    | Monday    | M           |
| 2   | <b>Tuesday</b>   | Tuesday   | M           |
| 3   | <b>Wednesday</b> | Wednesday | M           |
| 4   | <b>Thursday</b>  | Thursday  | M           |
| 5   | <b>Friday</b>    | Friday    | M           |
| 6   | <b>Saturday</b>  | Saturday  | M           |

### 9.12.5.2. AuxiliaryLoadSettingEnum Type

This data type is derived from enum8.

This enumeration SHALL indicated the required state of an auxiliary switch.

| Value | Name        | Summary                               | Conformance |
|-------|-------------|---------------------------------------|-------------|
| 0     | <b>Off</b>  | The switch should be in the OFF state | M           |
| 1     | <b>On</b>   | The switch should be in the ON state  | M           |
| 2     | <b>None</b> | No state is required                  | M           |

### 9.12.5.3. DayTypeEnum Type

This data type is derived from enum8.

| Value | Name            | Summary         | Conformance |
|-------|-----------------|-----------------|-------------|
| 0     | <b>Standard</b> | Standard        | M           |
| 1     | <b>Holiday</b>  | Holiday         | M           |
| 2     | <b>Dynamic</b>  | Dynamic Pricing | M           |




Page 775



| Value | Name  | Summary           | Conformance |
|-------|-------|-------------------|-------------|
| 3     | Event | Individual Events | M           |

#### 9.12.5.4. PeakPeriodSeverityEnum Type

This data type is derived from enum8.

| Value | Name   | Summary | Conformance |
|-------|--------|---------|-------------|
| 0     | Unused | Unused  | M           |
| 1     | Low    | Low     | M           |
| 2     | Medium | Medium  | M           |
| 3     | High   | High    | M           |

#### 9.12.5.5. DayEntryRandomizationTypeEnum Type

This data type is derived from enum8.

| Value | Name           | Summary                  | Conformance |
|-------|----------------|--------------------------|-------------|
| 0     | None           | No randomization applied | M           |
| 1     | Fixed          | An unchanging offset     | M           |
| 2     | Random         | A random value           | M           |
| 3     | RandomPositive | A random positive value  | M           |
| 4     | RandomNegative | A random negative value  | M           |

#### 9.12.5.6. BlockModeEnum Type

This data type is derived from enum8.

| Value | Name       | Summary                                         | Conformance |
|-------|------------|-------------------------------------------------|-------------|
| 0     | NoBlock    | Tariff has no usage blocks                      | M           |
| 1     | Combined   | Usage is metered in combined blocks             | M           |
| 2     | Individual | Usage is metered separately by tariff component | M           |

##### 9.12.5.6.1. NoBlock Value

This value SHALL indicate that the tariff has no usage blocks. All [Threshold](#) fields on [TariffCompo-](#)

Page 776







mentStruct in a tariff whose [BlockMode](#) field is set to NoBlock SHALL be null.

#### 9.12.5.6.2. Combined Value

This value SHALL indicate that all [Threshold](#) fields apply to combined usage across all [TariffComponentStruct](#) during the billing period.

#### 9.12.5.6.3. Individual Value

This value SHALL indicate that all [Threshold](#) fields apply only to usage during the active period of the associated [TariffComponentStruct](#) in the billing period.

#### 9.12.5.7. AuxiliaryLoadSwitchSettingsStruct Type

This represents the settings for a given auxiliary load switch in a tariff component.

| ID | Name                  | Type                                      | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------|-------------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Number</b>         | uint8                                     | all        |         |          |        | M           |
| 1  | <b>Required-State</b> | <a href="#">Auxiliary-LoadSettingEnum</a> |            |         |          |        | M           |

#### 9.12.5.8. AuxiliaryLoadSwitchesSettingsStruct Type

This represents the set of auxiliary load settings in a tariff component.

| ID | Name                 | Type                                                       | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------|------------------------------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Switch-States</b> | list[ <a href="#">Auxiliary-LoadSwitchSettingsStruct</a> ] | max 8      |         |          |        | M           |

#### 9.12.5.9. CalendarPeriodStruct Type

This represents a sub period of a calendar, commencing on its [StartDate](#).

##### NOTE

A 'Calendar Period', while normally considered to be a 3 or 6 month period, could be used for other arbitrary periods e.g. monthly or quarterly. The minimum resolution is 1 day, although a week would normally be the smallest interval.




Page 777



| ID | Name                 | Type                           | Constraint                    | Quality | Fallback | Access | Conformance |
|----|----------------------|--------------------------------|-------------------------------|---------|----------|--------|-------------|
| 0  | <b>StartDate</b>     | epoch-s                        | min <a href="#">StartDate</a> | X       |          |        | M           |
| 1  | <b>DayPatternIDs</b> | list[ <a href="#">uint32</a> ] | 1 to 7                        |         |          |        | M           |

#### 9.12.5.9.1. StartDate Field

This field SHALL indicate the timestamp in UTC when the calendar period becomes active.

A null value SHALL indicate the calendar period becomes active immediately. See [CalendarPeriods](#) attribute.

#### 9.12.5.9.2. DayPatternIDs Field

This field SHALL indicate a list of [DayPatternIDs](#) for the [DayPatternStructs](#) in use during this calendar period.

If any of the [DayPatternStructs](#) referenced by this list has no bits set in [DaysOfWeek](#), then none of the [DayPatternStructs](#) referenced by this list SHALL have any bits set, and the list SHALL be treated as a rotating set of days.

If at least one of the [DayPatternStructs](#) referenced by this list has a bit set in [DaysOfWeek](#), then:

1. All of the [DayPatternStructs](#) referenced by this list SHALL have at least one bit set in [DaysOfWeek](#)
2. No two [DayPatternStructs](#) referenced by this list SHALL have the same bit set in [DaysOfWeek](#).
3. Every bit defined in [DayPatternDayOfWeekBitmap](#) referenced by this list SHALL be set in [DaysOfWeek](#) on one of the [DayPatternStructs](#).

Meeting these constraints ensures that every day of the week during this week has specified day entries, and no day of the week has more than one set of day entries.

#### 9.12.5.10. DayEntryStruct Type

This struct represents a day entry at a particular time of day, along with an optional duration and randomization parameters.

| ID | Name              | Type                   | Constraint              | Quality | Fallback | Access | Conformance |
|----|-------------------|------------------------|-------------------------|---------|----------|--------|-------------|
| 0  | <b>DayEntryID</b> | <a href="#">uint32</a> | all                     |         |          |        | M           |
| 1  | <b>StartTime</b>  | <a href="#">uint16</a> | max 1499                |         |          |        | M           |
| 2  | <b>Duration</b>   | <a href="#">uint16</a> | max (1500 - Start-Time) |         |          |        | O           |

Page 778





| ID | Name                | Type                          | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------|-------------------------------|------------|---------|----------|--------|-------------|
| 3  | RandomizationOffset | int16                         | all        |         |          |        | [RNDM]      |
| 4  | RandomizationType   | DayEntryRandomizationTypeEnum | all        |         | None     |        | [RNDM]      |

#### 9.12.5.10.1. DayEntryID Field

This field SHALL indicate an identifier for the day entry which is unique on the server to a set of values:

1. If this identifier is included in the [DayEntryIDs](#) associated with a [DayPatternStruct](#), then the identifier SHALL be unique to the combination of:
  - a. the [StartTime](#)
  - b. the [Duration](#), if indicated
  - c. the [DaysOfWeek](#) field in the containing [DayPatternStruct](#)
2. Otherwise, if this identifier is included in the [DayEntryIDs](#) associated with a [DayStruct](#), then the identifier SHALL be unique to the combination of:
  - a. the [StartTime](#)
  - b. the [Duration](#), if indicated
  - c. the [Date](#) field in the containing [DayStruct](#)

Once an identifier has been used for a given combination above, it SHALL never be used for any other combination of these values.

#### 9.12.5.10.2. StartTime Field

This field SHALL indicate the start time of the [DayEntryStruct](#), expressed as the number of minutes that have elapsed since midnight on the associated days.

For example, 6am will be represented by 360 minutes since midnight and 11:30pm will be represented by 1410 minutes since midnight.

This will differ on days with a day entry in or out of daylight saving time. For example, if the implementation of daylight saving time in a region means that the hour between 2am and 3am will be skipped on the day entry into daylight saving time, then 2am cannot be represented, and 3am will be represented by 120 minutes.

Similarly, if the implementation of daylight saving time in a region means that the hour between 2am and 3am will be repeated on the date of day entry out of daylight saving time, then the first 2am will be represented by 120 minutes, while the second 2am will be represented by 180 minutes,



Page 779



and 4am will be represented by 300 minutes. As such, the maximum start time on this day is 1499, 60 minutes longer than all other days.

[DayEntryStruct](#) on daylight saving time days SHOULD be handled by a [DayStruct](#) in the [Individual-Days](#) attribute whose [Date](#) field indicates the date of the day entry.

#### 9.12.5.10.3. Duration Field

This field SHALL indicate the duration of the day entry, expressed as the number of minutes since the time indicated by the [StartTime](#) field.

If this field is omitted, the day entry SHALL end at the [StartTime](#) of the [DayEntryStruct](#) identified by the next [DayEntryID](#) in the containing list. If the [DayEntryStruct](#) is the last item in the containing list, then the day entry SHALL last until the end of the day.

#### 9.12.5.10.4. RandomizationOffset Field

This field SHALL indicate a randomization offset for this particular day entry in seconds. If this field is not indicated, randomization SHALL use the value in the [DefaultRandomizationOffset](#) attribute.

1. If the value of the [RandomizationType](#) field is Fixed, then the value of this field MAY be negative
2. Otherwise if the value of the [RandomizationType](#) field is RandomNegative, then the value of this field SHALL be less than or equal to zero
3. Otherwise the value of this field SHALL be greater than or equal to zero

#### 9.12.5.10.5. RandomizationType Field

This field SHALL indicate a randomization type for this particular day entry. If this field is not indicated, randomization SHALL use the value in the [DefaultRandomizationType](#) attribute.

If the calculated value for this field is of type None, no randomization SHALL be applied to the start of this day entry.

If the calculated value for this field is of type Fixed, then the calculated value of the [RandomizationOffset](#) field SHALL be added to the start time of the day entry.

If the calculated value for this field is of type Random, then a random number of whole seconds whose absolute value is less than or equal to the calculated value of the [RandomizationOffset](#) field SHALL be added to the start time of the day entry.

If the calculated value for this field is of type RandomPositive, then a random non-negative number of whole seconds whose value is less than or equal to the calculated value of the [RandomizationOffset](#) field SHALL be added to the start time of the day entry.

If the calculated value for this field is of type RandomNegative, then a random negative number of whole seconds whose value is greater than or equal to the calculated value of the [RandomizationOffset](#) field SHALL be added to the start time of the day entry.

Page 780







### 9.12.5.11. DayStruct Type

This represents a series of day entries over the course of a day for a specific date.

| ID | Name               | Type         | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------|--------------|------------|---------|----------|--------|-------------|
| 0  | <b>Date</b>        | epoch-s      |            |         |          |        | M           |
| 1  | <b>DayType</b>     | DayType-Enum | any        |         |          |        | M           |
| 2  | <b>DayEntryIDs</b> | list[uint32] | 1 to 96    |         |          |        | M           |

#### 9.12.5.11.1. Date Field

This field SHALL indicate the date the associated set of [DayEntryStructs](#) applies to.

#### 9.12.5.11.2. DayType Field

This field SHALL indicate the type of day represented by the struct.

#### 9.12.5.11.3. DayEntryIDs Field

This field SHALL indicate a list of [DayEntryIDs](#) for the [DayEntryStructs](#) to apply during the date specified by [Date](#), ordered by the value of the [StartTime](#) field.

This list SHALL NOT contain two [DayEntryIDs](#) for [DayEntryStructs](#) with the same value of the [Start-Time](#) field.

If the Randomization feature is supported, every [DayEntryStruct](#) whose [DayEntryID](#) is included in this field SHALL have its [StartTime](#) field set to a value less than the following [DayEntryStruct](#)'s [StartTime](#) field minus the calculated value of its [RandomizationOffset](#) field. In other words, it should not be possible for a random offset to cause a day entry to begin before the preceding day entry.

If the [DayType](#) field is not Event:

1. The [DayEntryStruct](#) referenced by the first [DayEntryID](#) in this list SHALL have its [StartTime](#) field set to zero.
2. Every [DayEntryStruct](#) referenced by this list SHALL have its [Duration](#) field omitted.

Otherwise, if the [DayType](#) field is Event:

1. Every [DayEntryStruct](#) referenced by this list SHALL NOT have a [Duration](#) field whose value, added to the value of [StartTime](#) field, is greater than the value of [StartTime](#) field on any subsequent [DayEntryStruct](#) referenced by this list. In other words, day entries with a set duration can not overlap any other day entries.




Page 781



### 9.12.5.12. DayPatternStruct Type

This represents a series of day entries over the course of a day for a given set of days of the week.

| ID | Name                | Type                       | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------|----------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>DayPatternID</b> | uint32                     | all        |         |          |        | M           |
| 1  | <b>DaysOfWeek</b>   | DayPatternDayOfWeek-Bitmap | all        |         |          |        | M           |
| 2  | <b>DayEntryIDs</b>  | list[uint32]               | 1 to 96    |         |          |        | M           |

#### 9.12.5.12.1. DayPatternID Field

This field SHALL indicate an identifier for the day pattern. It SHALL be a unique identifier for the combination of values of the [DaysOfWeek](#) and [DayEntryIDs](#) fields.

Once an identifier has been used for this combination, it SHALL NOT be used to represent any other combination of these values.

#### 9.12.5.12.2. DaysOfWeek Field

This field SHALL indicate which days of the week the associated set of [DayEntryStructs](#) applies to. If no bits are set, then this SHALL be a rotating day. See [DayPatternIDs](#).

#### 9.12.5.12.3. DayEntryIDs Field

This field SHALL indicate a list of [DayEntryIDs](#) for the [DayEntryStructs](#) to apply during the days specified by [DaysOfWeek](#), ordered by [StartTime](#).

This list SHALL NOT contain two [DayEntryIDs](#) for the [DayEntryStructs](#) with the same value of the [StartTime](#) field.

#### 9.12.5.12.3.1. Day Coverage

The [DayEntryStruct](#) referenced by the first [DayEntryID](#) in this list SHALL have its [StartTime](#) field set to zero.

Every [DayEntryStruct](#) referenced by this list SHALL have its [Duration](#) field omitted.

Meeting these constraints ensures that there are no periods during the day which are not covered by a [DayEntryStruct](#).

### 9.12.5.13. PeakPeriodStruct Type

Page 782



| ID | Name       | Type                   | Constraint | Quality | Fallback | Access | Conformance |
|----|------------|------------------------|------------|---------|----------|--------|-------------|
| 0  | Severity   | PeakPeriodSeverityEnum | all        |         |          |        | M           |
| 1  | PeakPeriod | uint16                 | min 1      |         |          |        | M           |

#### 9.12.5.13.1. Severity Field

This field SHALL indicate the severity of the peak period.

#### 9.12.5.13.2. PeakPeriod Field

This field SHALL indicate the PeakPeriod number.

### 9.12.5.14. TariffInformationStruct Type

This represents particular Tariff Price information.

| ID | Name          | Type          | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------|---------------|------------|---------|----------|--------|-------------|
| 0  | TariffLabel   | string        | max 128    | X       |          |        | M           |
| 1  | Provider-Name | string        | max 128    | X       |          |        | M           |
| 2  | Currency      | currency      | all        | X       |          |        | PRICE       |
| 3  | BlockMode     | BlockModeEnum | all        | X       |          |        | M           |

#### 9.12.5.14.1. TariffLabel Field

This field SHALL indicate a label for the tariff.

#### 9.12.5.14.2. ProviderName Field

This field SHALL indicate the name of the commodity provider for this tariff.

#### 9.12.5.14.3. Currency Field

This field SHALL indicate the currency for the value of the [Price](#) field on all [TariffPriceStruct](#).

#### 9.12.5.14.4. BlockMode Field

This field SHALL indicate the mode for metering blocks of usage.

### 9.12.5.15. TariffPriceStruct Type

This indicates a price or price level for a given tariff component, as well as what type of pricing it



Page 783



represents

| ID | Name              | Type                | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------|---------------------|------------|---------|----------|--------|-------------|
| 0  | <b>PriceType</b>  | TariffPriceTypeEnum |            |         |          |        | M           |
| 1  | <b>Price</b>      | money               | all        |         |          |        | O.c+        |
| 2  | <b>PriceLevel</b> | int16               | all        |         |          |        | O.c+        |

#### 9.12.5.15.1. PriceType Field

This field SHALL indicate the type of price for the [Price](#) or [PriceLevel](#) fields.

#### 9.12.5.15.2. Price Field

This field SHALL indicate the tariff price.

#### 9.12.5.15.3. PriceLevel Field

This field SHALL indicate the tariff price level.

### 9.12.5.16. TariffComponentStruct Type

This represents components of a tariff.

Tariff components typically represent a price or price level, though they may also specify other aspects of a tariff. For example, a tariff component may indicate changes in power thresholds, friendly credit status, or the expected state of auxiliary switches.

| ID | Name                      | Type                               | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------------------|------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Tariff-ComponentID</b> | uint32                             | all        |         |          |        | M           |
| 1  | <b>Price</b>              | TariffPriceStruct                  | all        | X       |          |        | [PRICE].b+  |
| 2  | <b>Friendly-Credit</b>    | bool                               | all        |         |          |        | [FCRED].b+  |
| 3  | <b>Auxiliary-Load</b>     | Auxiliary-LoadSwitchSettingsStruct | all        |         |          |        | [AUXLD].b+  |
| 4  | <b>PeakPeriod</b>         | PeakPeriodStruct                   | all        |         | 0        |        | [PEAKP].b+  |

Page 784







| ID | Name                  | Type                                 | Constraint | Quality | Fallback | Access | Conformance  |
|----|-----------------------|--------------------------------------|------------|---------|----------|--------|--------------|
| 5  | <b>PowerThreshold</b> | <a href="#">PowerThresholdStruct</a> | all        |         | 0        |        | [PWRTHLD].b+ |
| 6  | <b>Threshold</b>      | int64                                | all        | X       |          |        | M            |
| 7  | <b>Label</b>          | string                               | max 128    | X       |          |        | O            |
| 8  | <b>Predicted</b>      | bool                                 | all        |         |          |        | O            |

#### 9.12.5.16.1. TariffComponentID Field

This field SHALL indicate an identifier for the tariff component. If the tariff component is not a prediction, this field SHALL be a unique identifier for the combination of values of the [Price](#), [Threshold](#), [FriendlyCredit](#), [AuxiliaryLoad](#), and [PeakPeriod](#) fields with the value of the [DayEntryIDs](#) field on the encompassing [TariffPeriodStruct](#).

Once an identifier has been used for this combination, it SHALL NOT be used to represent any other combination of these values.

#### 9.12.5.16.2. Price Field

This field SHALL indicate the price when the tariff component is active.

When the [Predicted](#) field is set to TRUE, a null value SHALL indicate that the price and/or price level is not yet available.

When the [Predicted](#) field is set to FALSE, a null value SHALL indicate that the server is unable to provide a specific price or price level.

#### 9.12.5.16.3. FriendlyCredit Field

This field SHALL indicate whether the calendar is entering a friendly credit period or not.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | When a meter enters into a Friendly Credit Period with a usable positive credit balance, the consumer will be allowed to consume energy for the duration of the Friendly Credit Period, regardless of their credit status while in that period. If, however, the consumer had already run out of credit and supply was interrupted before entering into the Friendly Credit Period, they will not be allowed to reconnect without first adding suitable additional credit. |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

|             |                                                                                                                                                                                                                                                                                                                               |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <b>NOTE</b> | At the end of the Friendly Credit Period, the normal delivery rules connected with the accounting functions of the meter will be resumed, and if the meter's credit balance has dropped below the disablement threshold during the Friendly Credit Period, then the meter will disconnect upon resuming normal delivery rules |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

#### 9.12.5.16.4. AuxiliaryLoad Field

This field SHALL indicate the required state of auxiliary load switches.



Page 785



#### 9.12.5.16.5. PeakPeriod Field

This field SHALL indicate whether the tariff component represents a peak period.

#### 9.12.5.16.6. PowerThreshold Field

This field SHALL indicate whether the tariff component represents a power threshold.

#### 9.12.5.16.7. Threshold Field

This field SHALL indicate the maximum level of consumption this tariff component applies to, in units specified by the `TariffUnit` attribute. If the tariff component applies to any level of consumption, this field SHALL be null.

#### 9.12.5.16.8. Label Field

A free-form label for the tariff component.

#### 9.12.5.16.9. Predicted Field

This field SHALL indicate whether the tariff component represents a price prediction.

### 9.12.5.17. TariffPeriodStruct Type

This represents the tariff components in effect for a set of calendar day entry IDs.

| ID | Name               | Type         | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------|--------------|------------|---------|----------|--------|-------------|
| 0  | Label              | string       | max 128    | X       |          |        | M           |
| 1  | DayEntryIDs        | list[uint32] | 1 to 20    |         |          |        | M           |
| 2  | TariffComponentIDs | list[uint32] | 1 to 20    |         |          |        | M           |

#### 9.12.5.17.1. Label Field

A free-form label for the tariff period.

#### 9.12.5.17.2. DayEntryIDs Field

This field SHALL indicate a list of `DayEntryIDs` for the `DayEntryStructs` during which the tariff components are active.

Each `DayEntryID` SHALL be included in at most one `DayEntryIDs` field. In other words, there SHALL be only one `TariffPeriodStruct` for each `DayEntryID`.

#### 9.12.5.17.3. TariffComponentIDs Field

This field SHALL indicate a list of `TariffComponentIDs` for the `TariffComponentStructs` active during the specified day entries.

Page 786







**9.12.6. Attributes**

| ID     | Name                     | Type                        | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------|-----------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | TariffInfo               | TariffInformation-Struct    |            | X       |          | R V    | M           |
| 0x0001 | TariffUnit               | TariffUnitEnum              | all        | X       |          | R V    | M           |
| 0x0002 | StartDate                | epoch-s                     | desc       | X       |          | R V    | M           |
| 0x0003 | DayEntries               | list[DayEntryStruct]        | max 672    | X       |          | R V    | M           |
| 0x0004 | DayPatterns              | list[DayPatternStruct]      | max 28     | X       |          | R V    | M           |
| 0x0005 | CalendarPeriods          | list[CalendarPeriod-Struct] | 1 to 4     | X       |          | R V    | M           |
| 0x0006 | Individual-Days          | list[DayStruct]             | max 50     | X       |          | R V    | M           |
| 0x0007 | Current-Day              | DayStruct                   |            | X       |          | R V    | M           |
| 0x0008 | NextDay                  | DayStruct                   |            | X       |          | R V    | M           |
| 0x0009 | Current-DayEntry         | DayEntryStruct              |            | X       |          | R V    | M           |
| 0x000A | Current-DayEntry-Date    | epoch-s                     | all        | X       |          | R V    | M           |
| 0x000B | Next-DayEntry            | DayEntryStruct              |            | X       |          | R V    | M           |
| 0x000C | Next-DayEntry-Date       | epoch-s                     | all        | X       |          | R V    | M           |
| 0x000D | TariffComponents         | list[TariffComponentStruct] | 1 to 672   | X       |          | R V    | M           |
| 0x000E | TariffPeriods            | list[TariffPeriod-Struct]   | 1 to 672   | X       |          | R V    | M           |
| 0x000F | Current-TariffComponents | list[TariffComponentStruct] | max 20     | X       |          | R V    | M           |



Page 787



| ID     | Name                       | Type                                          | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------------------|-----------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0010 | NextTariffComponents       | list[ <a href="#">TariffComponentStruct</a> ] | max 20     | X       |          | R V    | M           |
| 0x0011 | DefaultRandomizationOffset | int16                                         | desc       | X       |          | R V    | RNDM        |
| 0x0012 | DefaultRandomizationType   | <a href="#">DayEntryRandomizationTypeEnum</a> | all        | X       |          | R V    | RNDM        |

#### 9.12.6.1. TariffInfo Attribute

This attribute SHALL indicate basic information about the tariff.

If the tariff is unavailable, this attribute SHALL be null.

#### 9.12.6.2. TariffUnit Attribute

This attribute SHALL indicate the unit of the commodity for pricing.

If the tariff is unavailable, this attribute SHALL be null.

#### 9.12.6.3. StartDate Attribute

This attribute SHALL indicate a timestamp in UTC to denote the time at which the published calendar becomes active. A start date/time of 0x00000000 shall indicate that the calendar should become active immediately.

If the tariff is unavailable, this attribute SHALL be null.

#### 9.12.6.4. DayEntries Attribute

This attribute SHALL indicate the list of [DayEntryStructs](#) included in this calendar.

The maximum constraint of this attribute is intended to allow representation of seven days of tariff information at 15 minute intervals.

If the tariff is unavailable, this attribute SHALL be null.

#### 9.12.6.5. DayPatterns Attribute

This attribute SHALL indicate the list of [DayPatternStructs](#) used in the [CalendarPeriodStruct](#) in this calendar.

Each day pattern in this list SHALL define the specific schedule that applies to the days it covers.

Page 788



#### 9.12.6.6. CalendarPeriods Attribute

This attribute SHALL indicate the list of [CalendarPeriodStructs](#) comprising this calendar. The [CalendarPeriodStructs](#) in this list SHALL be arranged in increasing order by the value of [StartDate](#).

If and only if the value of the [StartDate](#) attribute is null, the value of the [StartDate](#) field on the first [CalendarPeriodStruct](#) in the [CalendarPeriods](#) attribute SHALL also be null, indicating that the period begins immediately. The value of the [StartDate](#) field on any subsequent [CalendarPeriodStruct](#) in [CalendarPeriods](#) SHALL NOT be null.

The active calendar period SHALL be in effect until the [StartDate](#) of the next calendar period.

If the calendar is unavailable, this attribute SHALL be null.

#### 9.12.6.7. IndividualDays Attribute

This attribute SHALL indicate the list of days to overlay on this calendar.

The [DayStruct](#) in this list SHALL be arranged in increasing order by the value of [Date](#). The [DayStruct](#) in this list SHALL not overlap.

If the calendar is unavailable, this attribute SHALL be null.

#### 9.12.6.8. CurrentDay Attribute

This attribute SHALL indicate the current day's day entries.

If the tariff is not active or CurrentDay information is not available, this attribute SHALL be null.

#### 9.12.6.9. NextDay Attribute

This attribute SHALL indicate the next day's day entries.

If the tariff is not active or NextDay information is not available, this attribute SHALL be null.

#### 9.12.6.10. CurrentDayEntry Attribute

This attribute SHALL indicate the currently active [DayEntryStruct](#).

If the tariff is not active or day entry information is not available, this attribute SHALL be null.

#### 9.12.6.11. CurrentDayEntryDate Attribute

This attribute SHALL indicate the UTC date when the [CurrentDay](#), [CurrentDayEntry](#), and [Current-TariffComponents](#) attributes were last updated.

If the tariff is not active or day entry information is not available, this attribute SHALL be null.

#### 9.12.6.12. NextDayEntry Attribute

This attribute SHALL indicate the predicted next active [DayEntryStruct](#).



Page 789



If the tariff is not active or is not available, this attribute SHALL be null.

#### 9.12.6.13. **NextDayEntryDate Attribute**

This attribute SHALL indicate the predicted UTC date when the [CurrentDay](#), [CurrentDayEntry](#), and [CurrentTariffComponents](#) attributes will update to the values in the [NextDay](#), [NextDayEntry](#), and [NextTariffComponents](#) attributes, respectively.

If the tariff is not active or is not available, this attribute SHALL be null.

#### 9.12.6.14. **TariffComponents Attribute**

This attribute SHALL indicate a list of [TariffComponentStructs](#) for the tariff.

If the tariff is unavailable, this attribute SHALL be empty.

#### 9.12.6.15. **TariffPeriods Attribute**

This attribute SHALL indicate a list of [TariffPeriodStructs](#) for the tariff.

If the tariff is unavailable, this attribute SHALL be empty.

#### 9.12.6.16. **CurrentTariffComponents Attribute**

This attribute SHALL indicate a list of the currently active [TariffComponentStructs](#).

If the tariff is unavailable, this attribute SHALL be empty.

#### 9.12.6.17. **NextTariffComponents Attribute**

This attribute SHALL indicate the predicted next active [TariffComponentStructs](#).

If the tariff is unavailable, this attribute SHALL be null.

#### 9.12.6.18. **DefaultRandomizationOffset Attribute**

This attribute SHALL indicate a default randomization offset for [DayEntryStructs](#) in this tariff. See [RandomizationOffset](#) for details.

#### 9.12.6.19. **DefaultRandomizationType Attribute**

This attribute SHALL indicate a default randomization type for [DayEntryStruct](#) in this tariff. See [RandomizationType](#) for details.

### 9.12.7. **Commands**

| ID   | Name                      | Direction       | Response                   | Access | Conformance |
|------|---------------------------|-----------------|----------------------------|--------|-------------|
| 0x00 | <b>GetTariffComponent</b> | client ⇒ server | GetTariffComponentResponse | O      | M           |

Page 790



| ID   | Name                       | Direction       | Response            | Access | Conformance |
|------|----------------------------|-----------------|---------------------|--------|-------------|
| 0x00 | GetTariffComponentResponse | client ⇐ server | N                   |        | M           |
| 0x01 | GetDayEntry                | client ⇒ server | GetDayEntryResponse | O      | M           |
| 0x01 | GetDayEntryResponse        | client ⇐ server | N                   |        | M           |

### 9.12.7.1. GetTariffComponent Command

The GetTariffComponent command allows a client to request information for a tariff component identifier that may no longer be available in the [TariffPeriods](#) attributes.

| ID | Name              | Type   | Constraint | Quality | Fallback | Conformance |
|----|-------------------|--------|------------|---------|----------|-------------|
| 0  | TariffComponentID | uint32 | all        |         |          | M           |

#### 9.12.7.1.1. TariffComponentID Field

This field SHALL be used to indicate the [TariffComponentID](#) of the [DayEntryStruct](#) to be returned.

#### 9.12.7.1.2. Effect on Receipt

If the [TariffComponentStruct](#) indicated by the [GetTariffComponentTariffComponentID](#) field is no longer available, the server SHALL return a status code of NOT\_FOUND.

Otherwise, the server SHALL return information about the [TariffComponentStruct](#).

See [GetTariffComponentResponse](#) for a description of the response command.

### 9.12.7.2. GetTariffComponentResponse Command

The GetTariffComponentResponse command is sent in response to a GetTariffComponent command.

| ID | Name            | Type                  | Constraint | Quality | Fallback | Conformance |
|----|-----------------|-----------------------|------------|---------|----------|-------------|
| 0  | Label           | string                | max 128    | X       |          | M           |
| 1  | DayEntryIDs     | list[uint32]          | 1 to 96    |         |          | M           |
| 2  | TariffComponent | TariffComponentStruct |            |         |          | M           |



Page 791



#### 9.12.7.2.1. Label Field

A free-form label for the tariff period.

#### 9.12.7.2.2. DayEntryIDs Field

This field SHALL indicate a list of [DayEntryIDs](#) for the [DayEntryStructs](#) during which the tariff component is active.

#### 9.12.7.2.3. TariffComponent Field

This field SHALL indicate the [TariffComponentStruct](#) whose [TariffComponentID](#) field matches the requested [GetTariffComponentTariffComponentID](#).

### 9.12.7.3. GetDayEntry Command

The GetDayEntry command allows a client to request information for a calendar day entry identifier that may no longer be available in the [CalendarPeriods](#) or [IndividualDays](#) attributes.

| ID | Name              | Type   | Constraint | Quality | Fallback | Conformance |
|----|-------------------|--------|------------|---------|----------|-------------|
| 0  | <b>DayEntryID</b> | uint32 | all        |         |          | M           |

#### 9.12.7.3.1. DayEntryID Field

This field SHALL be used to indicate the [DayEntryID](#) of the [DayEntryStruct](#) to be returned.

#### 9.12.7.3.2. Effect on Receipt

If the [DayEntryStruct](#) indicated by the [DayEntryID](#) field is no longer available, the server SHALL return a status code of NOT\_FOUND.

Otherwise, the server SHALL return information about the [DayEntryStruct](#).

See [GetDayEntryResponse](#) for a description of the response command.

### 9.12.7.4. GetDayEntryResponse Command

The GetDayEntryResponse command is sent in response to a GetDayEntry command.

| ID | Name            | Type                           | Constraint | Quality | Fallback | Conformance |
|----|-----------------|--------------------------------|------------|---------|----------|-------------|
| 0  | <b>DayEntry</b> | <a href="#">DayEntryStruct</a> |            |         |          | M           |

#### 9.12.7.4.1. DayEntryField

This field SHALL indicate the [DayEntryStruct](#) whose [DayEntryID](#) field matches the requested [DayEntryID](#).

Page 792







## 9.12.8. Tariff Examples

### 9.12.8.1. Flat Rate

A flat rate tariff has the simplest structure: the consumer pays a single price at all times of year.

For example if a tariff charges:

1. \$0.1485 per unit, all day, every day, starting on 2025/01/01

This can be represented by:

1. One `DayEntryStruct` starting at midnight; in this example, the `DayEntryID` is 0x19
2. One `DayPatternStruct` with all `DaysOfWeek` set and containing the `DayEntryID` 0x19; in this example, the `DayPatternID` is 0x15
3. One `CalendarPeriodStruct` starting on 2025/01/01 and containing the `DayPatternID` 0x15
4. One `TariffComponentStruct` with a standard price of \$0.1485; in this example, the `TariffComponentID` is 0x29
5. One `TariffPeriodStruct` linking the `TariffComponentID` of 0x29 to the `DayEntryID` of 0x19

![Diagram illustrating the structure of a flat rate commodity tariff. It shows four tables: TariffPeriods, TariffComponents, DayEntries, and CalendarPeriods, with arrows indicating their relationships.](94be9e372e546978b6af67abc7623d0a_img.jpg)

The diagram illustrates the structure of a flat rate commodity tariff using four interconnected tables:

- TariffPeriods** (linked to **TariffComponents**):

| TariffPeriods |                    |             |
|---------------|--------------------|-------------|
| Label         | TariffComponentIDs | DayEntryIDs |
| All Day       | [0x29]             | [0x019]     |
- TariffComponents** (linked to **TariffPeriods** and **DayEntries**):

| TariffComponents  |           |           |
|-------------------|-----------|-----------|
| TariffComponentID | Price     | Threshold |
| 0x29              | PriceType | Standard  |
|                   | Price     | \$0.1485  |
- DayEntries** (linked to **TariffComponents**):

| DayEntries |           |
|------------|-----------|
| DayEntryID | StartTime |
| 0x19       | 0         |
- CalendarPeriods** (linked to **DayEntries**):

| CalendarPeriods |               |
|-----------------|---------------|
| StartDate       | DayPatternIDs |
| 2025/01/01      | [0x15]        |

Diagram illustrating the structure of a flat rate commodity tariff. It shows four tables: TariffPeriods, TariffComponents, DayEntries, and CalendarPeriods, with arrows indicating their relationships.

Figure 22. Example of a flat rate commodity tariff

### 9.12.8.2. Flat Rate with Blocks

Tariffs may have thresholds of consumption; when an account has consumed more than the threshold, a new rate applies.

For example, if a tariff charges:

1. \$0.40 per unit, all day, every day, starting on 2025/01/01
2. \$0.50 per unit, once 100 units have been consumed

This can be represented by:

1. One `DayEntryStruct` starting at midnight; in this example, the `DayEntryID` is 0x806
2. One `DayPatternStruct` with all `DaysOfWeek` set and containing the `DayEntryID` 0x806; in this example, the `DayPatternID` is 0x62



Page 793



3. One `CalendarPeriodStruct` starting on 2025/01/01 and containing the `DayPatternID` 0x62
4. One `TariffComponentStruct` with a standard price of \$0.40 and a `Threshold` of zero, indicating that it takes effect after zero consumption (immediately). In this example, this component's `TariffComponentID` is 0x59.
5. One second `TariffComponentStruct` with a standard price of \$0.50 and a `Threshold` of 100, indicating that it takes effect after consumption reaches 100. In this example, this component's `TariffComponentID` is 0x5A.
6. One `TariffPeriodStruct` linking the `TariffComponentIDs` of 0x59 and 0x5A to the `DayEntryID` of 0x806

![Diagram illustrating the structure of a flat rate commodity tariff with usage blocks. It shows four tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with CalendarPeriods. Arrows show relationships between them.](7ba7f01301b063b66d47ec6c4ff0973a_img.jpg)

The diagram illustrates the structure of a flat rate commodity tariff with usage blocks. It consists of four tables and their relationships:

- TariffPeriods** (purple header):
 

| Label   | TariffComponentIDs | DayEntryIDs |
|---------|--------------------|-------------|
| All Day | [0x59, 0x5A]       | [0x806]     |
- TariffComponents** (purple header):
 

| TariffComponentID | Price     |          | Threshold |
|-------------------|-----------|----------|-----------|
| 0x59              | PriceType | Standard | 0         |
|                   | Price     | \$0.40   |           |
| 0x5A              | PriceType | Standard | 100       |
|                   | Price     | \$0.50   |           |
- DayEntries** (blue header):
 

| DayEntryID | StartTime |
|------------|-----------|
| 0x806      | 0         |
- DayPatterns** (blue header):
 

| DayPatternID | DaysOfWeek | DayEntryIDs |
|--------------|------------|-------------|
| 0x62         | 0x7F       | [0x806]     |
- CalendarPeriods** (blue header):
 

| StartDate  | DayPatternIDs |
|------------|---------------|
| 2025/01/01 | [0x62]        |

Relationships: Arrows indicate that `TariffPeriods` points to `TariffComponents` and `DayEntries`. `TariffComponents` points to `DayEntries`. `DayEntries` points to `DayPatterns`. `DayPatterns` points to `CalendarPeriods`.

Diagram illustrating the structure of a flat rate commodity tariff with usage blocks. It shows four tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with CalendarPeriods. Arrows show relationships between them.

Figure 23. Example of a flat rate commodity tariff with usage blocks

### 9.12.8.3. Seasonal Flat Rate

Tariffs may have periods of the year during which different rates apply.

For example, if a tariff charges:

1. \$0.1295 per unit, all day, every day, from 2025/01/01 until 2025/05/01
2. \$0.1331 per unit, all day, every day, from 2025/05/01 until 2025/06/01
3. \$0.2126 per unit, all day, every day, from 2025/06/01 until 2025/10/01
4. \$0.1331 per unit, all day, every day, after 2025/10/01

This can be represented by:

1. Three `DayEntryStructs` starting at midnight:
  - a. One with a `DayEntryID` of 0x324; this will represent days between 2025/01/01 and 2025/05/01
  - b. One with a `DayEntryID` of 0x325; this will represent days between 2025/05/01 and 2025/06/01 as well as days after 2025/10/01
  - c. One with a `DayEntryID` of 0x326; this will represent days between 2025/06/01 and 2025/10/01
2. Three `DayPatternStructs` with all `DaysOfWeek` set:
  - a. One with a `DayPatternID` of 0x832, containing the `DayEntryID` 0x324
  - b. One with a `DayPatternID` of 0x833, containing the `DayEntryID` 0x325
  - c. One with a `DayPatternID` of 0x834, containing the `DayEntryID` 0x326

Page 794







3. Four [CalendarPeriodStructs](#):

- One starting on 2025/01/01, containing the [DayPatternID](#) 0x832
- One starting on 2025/05/01, containing the [DayPatternID](#) 0x833
- One starting on 2025/06/01, containing the [DayPatternID](#) 0x834
- One starting on 2025/10/01, containing the [DayPatternID](#) 0x833

4. Three [TariffComponentStructs](#):

- One with a [TariffComponentID](#) of 0x59A, and a standard price of \$0.1295
- One with a [TariffComponentID](#) of 0x59B, and a standard price of \$0.1331
- One with a [TariffComponentID](#) of 0x59C, and a standard price of \$0.2126

5. Three [TariffPeriodStructs](#)

- One linking the [TariffComponentID](#) of 0x59A to the [DayEntryID](#) of 0x324
- One linking the [TariffComponentID](#) of 0x59B to the [DayEntryID](#) of 0x325
- One linking the [TariffComponentID](#) of 0x59C to the [DayEntryID](#) of 0x326

![Diagram illustrating the structure of a seasonal flat rate commodity tariff. It shows four interconnected tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with CalendarPeriods at the bottom. Arrows indicate relationships between these tables.](4bdb08c91bf6aadde2efdac8f1bcb94b_img.jpg)

The diagram illustrates the structure of a seasonal flat rate commodity tariff, showing the relationships between four main data structures: **TariffPeriods**, **TariffComponents**, **DayEntries**, and **DayPatterns**, with **CalendarPeriods** at the bottom.

- TariffPeriods** (Table 1):

| Label       | TariffComponentIDs | DayEntryIDs |
|-------------|--------------------|-------------|
| Winter      | [0x59A]            | [0x324]     |
| Spring/Fall | [0x59B]            | [0x325]     |
| Summer      | [0x59C]            | [0x326]     |
- TariffComponents** (Table 2):

| TariffComponentID | Price            | Threshold |
|-------------------|------------------|-----------|
| 0x59A             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.1295  |
| 0x59B             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.1331  |
| 0x59C             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.2126  |
- DayEntries** (Table 3):

| DayEntryID | StartTime |
|------------|-----------|
| 0x324      | 0         |
| 0x325      | 0         |
| 0x326      | 0         |
- DayPatterns** (Table 4):

| DayPatternID | DaysOfWeek | DayEntryIDs |
|--------------|------------|-------------|
| 0x832        | 0x7F       | [0x324]     |
| 0x833        | 0x7F       | [0x325]     |
| 0x834        | 0x7F       | [0x326]     |
- CalendarPeriods** (Table 5):

| StartDate  | DayPatternIDs |
|------------|---------------|
| 2025/01/01 | [0x832]       |
| 2025/05/01 | [0x833]       |
| 2025/06/01 | [0x834]       |
| 2025/10/01 | [0x833]       |

Relationships: Arrows indicate that **TariffPeriods** links to **TariffComponents** and **DayEntries**. **TariffComponents** links to **DayEntries**. **DayEntries** links to **DayPatterns**. **CalendarPeriods** links to **DayPatterns**.

Diagram illustrating the structure of a seasonal flat rate commodity tariff. It shows four interconnected tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with CalendarPeriods at the bottom. Arrows indicate relationships between these tables.

Figure 24. Example of a seasonal flat rate commodity tariff

## 9.12.8.4. Time of Use Rate

Tariffs may have different rates at different times of day, for different days of the week.

For example, if a tariff starting on 2025/01/01 charges:

- \$0.40 per unit from 00:00 to 15:00, Monday to Friday
- \$0.50 per unit from 15:00 to 18:00, Monday to Friday
- \$0.60 per unit from 18:00 to 21:00, Monday to Friday



Page 795



4. \$0.40 per unit from 21:00 to 00:00, Monday to Friday
5. \$0.25 per unit from 00:00 to 17:00, Saturday and Sunday
6. \$0.35 per unit from 17:00 to 20:00, Saturday and Sunday
7. \$0.25 per unit from 20:00 to 00:00, Saturday and Sunday

This can be represented by:

1. Seven [DayEntryStructs](#):
  - a. Four representing the schedule on weekdays:
    - i. One with a start time of zero (00:00) with a [DayEntryID](#) of 0x6
    - ii. One with a start time of 900 (15:00) with a [DayEntryID](#) of 0x7
    - iii. One with a start time of 1080 (18:00) with a [DayEntryID](#) of 0x8
    - iv. One with a start time of 1260 (21:00) with a [DayEntryID](#) of 0x9
  - b. Three representing the schedule on weekends
    - i. One with a start time of zero (00:00) with a [DayEntryID](#) of 0xA
    - ii. One with a start time of 1020 (17:00) with a [DayEntryID](#) of 0xB
    - iii. One with a start time of 1200 (20:00) with a [DayEntryID](#) of 0xC
2. Two [DayPatternStructs](#):
  - a. One with a [DayPatternID](#) of 0x73
    - i. Containing the [DayEntryIDs](#) 0x6, 0x7, 0x8, and 0x9
    - ii. [DaysOfWeek](#) set to Monday, Tuesday, Wednesday, Thursday, and Friday
  - b. One with a [DayPatternID](#) of 0x74
    - i. Containing the [DayEntryIDs](#) 0xA, 0xB, and 0xC
    - ii. [DaysOfWeek](#) set to Saturday and Sunday
3. A [CalendarPeriodStruct](#) starting on 2025/01/01 and containing the [DayPatternIDs](#) 0x73 and 0x74.
4. Five [TariffComponentStructs](#):
  - a. One with a [TariffComponentID](#) of 0x491, and a standard price of \$0.40
  - b. One with a [TariffComponentID](#) of 0x492, and a standard price of \$0.50
  - c. One with a [TariffComponentID](#) of 0x493, and a standard price of \$0.60
  - d. One with a [TariffComponentID](#) of 0x494, and a standard price of \$0.25
  - e. One with a [TariffComponentID](#) of 0x495, and a standard price of \$0.35
5. Five [TariffPeriodStructs](#)
  - a. One linking the [TariffComponentID](#) of 0x491 to the [DayEntryIDs](#) of 0x6 and 0x9
  - b. One linking the [TariffComponentID](#) of 0x492 to the [DayEntryID](#) of 0x7
  - c. One linking the [TariffComponentID](#) of 0x493 to the [DayEntryID](#) of 0x8
  - d. One linking the [TariffComponentID](#) of 0x494 to the [DayEntryIDs](#) of 0xA and 0xC

Page 796







- e. One linking the `TariffComponentID` of 0x495 to the `DayEntryID` of 0xB

![Diagram illustrating a time-of-use rate commodity tariff structure. It shows four tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with arrows indicating relationships between them.](e0ebb9885af72036c3f7050784d8d8ca_img.jpg)

The diagram illustrates the structure of a time-of-use rate commodity tariff, showing the relationships between TariffPeriods, TariffComponents, DayEntries, DayPatterns, and CalendarPeriods.

| TariffPeriods             |                    |            | DayEntryIDs |
|---------------------------|--------------------|------------|-------------|
| Label                     | TariffComponentIDs |            |             |
| M-F <sub>off-Peak</sub>   | [0x491]            | [0x6, 0x9] |             |
| M-F <sub>Mid-Peak</sub>   | [0x492]            | [0x7]      |             |
| M-F <sub>Peak</sub>       | [0x493]            | [0x8]      |             |
| Sa-Su <sub>off-Peak</sub> | [0x494]            | [0xA, 0xC] |             |
| Sa-Su <sub>Peak</sub>     | [0x495]            | [0xB]      |             |

  

| TariffComponents  |                  |           |
|-------------------|------------------|-----------|
| TariffComponentID | Price            | Threshold |
| 0x491             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.40    |
| 0x492             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.50    |
| 0x493             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.60    |
| 0x494             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.25    |
| 0x495             | <i>PriceType</i> | Standard  |
|                   | <i>Price</i>     | \$0.35    |

  

| DayEntries |           |
|------------|-----------|
| DayEntryID | StartTime |
| 0x6        | 0         |
| 0x7        | 900       |
| 0x8        | 1080      |
| 0x9        | 1260      |
| 0xA        | 0         |
| 0xB        | 1020      |
| 0xC        | 1200      |

  

| DayPatterns  |      |                      |
|--------------|------|----------------------|
| DayPatternID | DoW  | DayEntryIDs          |
| 0x73         | 0x3E | [0x6, 0x7, 0x8, 0x9] |
| 0x74         | 0x41 | [0xA, 0xB, 0xC]      |

  

| CalendarPeriods |               |
|-----------------|---------------|
| StartDate       | DayPatternIDs |
| 2025/01/01      | [0x73, 0x74]  |

Diagram illustrating a time-of-use rate commodity tariff structure. It shows four tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with arrows indicating relationships between them.

Figure 25. Example of a time-of-use rate commodity tariff

#### 9.12.8.5. Seasonal Time of Use Rate

Tariffs with a time-of-use structure may vary the times of day during different times of the year.

For example, if a tariff starting on 2025/01/01 charges:

1. From 2025/01/01 until 2025/05/01, and after 2025/10/01:
  - a. \$0.40 per unit from 00:00 to 16:00, every day
  - b. \$0.50 per unit from 16:00 to 21:00, every day
  - c. \$0.40 per unit from 21:00 to 00:00, every day
2. From 2025/05/01 until 2025/10/01:
  - a. \$0.40 per unit from 00:00 to 15:00, every day
  - b. \$0.60 per unit from 15:00 to 21:00, every day
  - c. \$0.40 per unit from 21:00 to 00:00, every day

This can be represented by:

1. Six `DayEntryStructs`:
  - a. Three representing the schedule from 2025/01/01 until 2025/05/01, and after 2025/10/01:
    - i. One with a start time of zero (00:00) with a `DayEntryID` of 0x71
    - ii. One with a start time of 960 (16:00) with a `DayEntryID` of 0x72



Page 797



- iii. One with a start time of 1260 (21:00) with a [DayEntryID](#) of 0x73
- b. Three representing the schedule from 2025/05/01 until 2025/10/01:
  - i. One with a start time of zero (00:00) with a [DayEntryID](#) of 0x74
  - ii. One with a start time of 900 (15:00) with a [DayEntryID](#) of 0x75
  - iii. One with a start time of 1260 (21:00) with a [DayEntryID](#) of 0x76
- 2. Two [DayPatternStructs](#) with all [DaysOfWeek](#) set:
  - a. One with a [DayPatternID](#) of 0x56A containing the [DayEntryIDs](#) 0x71, 0x72, and 0x73
  - b. One with a [DayPatternID](#) of 0x56B containing the [DayEntryIDs](#) 0x74, 0x75, and 0x76
- 3. Three [CalendarPeriodStructs](#):
  - a. One starting on 2025/01/01, containing the [DayPatternID](#) 0x56A
  - b. One starting on 2025/05/01, containing the [DayPatternID](#) 0x56B
  - c. One starting on 2025/10/01, containing the [DayPatternID](#) 0x56A
- 4. Four [TariffComponentStructs](#):
  - a. One with a [TariffComponentID](#) of 0x891, and a standard price of \$0.40
  - b. One with a [TariffComponentID](#) of 0x892, and a standard price of \$0.50
  - c. One with a [TariffComponentID](#) of 0x893, and a standard price of \$0.40
  - d. One with a [TariffComponentID](#) of 0x894, and a standard price of \$0.60
- 5. Four [TariffPeriodStructs](#)
  - a. One linking the [TariffComponentID](#) of 0x891 to the [DayEntryIDs](#) of 0x71 and 0x73
  - b. One linking the [TariffComponentID](#) of 0x892 to the [DayEntryID](#) of 0x72
  - c. One linking the [TariffComponentID](#) of 0x893 to the [DayEntryID](#) of 0x74 and 0x76
  - d. One linking the [TariffComponentID](#) of 0x894 to the [DayEntryIDs](#) of 0x75

Page 798







![Diagram illustrating a seasonal time-of-use rate commodity tariff structure. It shows four interconnected tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with a CalendarPeriods table at the bottom. Arrows indicate relationships: TariffPeriods links to TariffComponents and DayEntries; TariffComponents links to DayEntries; DayEntries links to DayPatterns; and DayPatterns links to CalendarPeriods.](a6e52b746b6dc09bdb0e3487232fc321_img.jpg)

**TariffPeriods**

| Label                      | TariffComponentIDs | DayEntryIDs  |
|----------------------------|--------------------|--------------|
| Winter <sub>Off-Peak</sub> | [0x891]            | [0x71, 0x73] |
| Winter <sub>Peak</sub>     | [0x892]            | [0x72]       |
| Summer <sub>Off-Peak</sub> | [0x893]            | [0x74, 0x76] |
| Summer <sub>Peak</sub>     | [0x894]            | [0x75]       |

**TariffComponents**

| TariffComponentID | Price     |          | Threshold |
|-------------------|-----------|----------|-----------|
| 0x891             | PriceType | Standard | 0         |
|                   | Price     | \$0.40   |           |
| 0x892             | PriceType | Standard | 0         |
|                   | Price     | \$0.50   |           |
| 0x893             | PriceType | Standard | 0         |
|                   | Price     | \$0.40   |           |
| 0x894             | PriceType | Standard | 0         |
|                   | Price     | \$0.60   |           |

**DayEntries**

| DayEntryID | StartTime |
|------------|-----------|
| 0x71       | 0         |
| 0x72       | 960       |
| 0x73       | 1260      |
| 0x74       | 0         |
| 0x75       | 900       |
| 0x76       | 1260      |

**DayPatterns**

| DayPatternID | DoW  | DayEntryIDs        |
|--------------|------|--------------------|
| 0x56A        | 0x7F | [0x71, 0x72, 0x73] |
| 0x56B        | 0x7F | [0x74, 0x75, 0x76] |

**CalendarPeriods**

| StartDate  | DayPatternIDs |
|------------|---------------|
| 2025/01/01 | [0x56A]       |
| 2025/05/01 | [0x56B]       |
| 2025/10/01 | [0x56A]       |

Diagram illustrating a seasonal time-of-use rate commodity tariff structure. It shows four interconnected tables: TariffPeriods, TariffComponents, DayEntries, and DayPatterns, with a CalendarPeriods table at the bottom. Arrows indicate relationships: TariffPeriods links to TariffComponents and DayEntries; TariffComponents links to DayEntries; DayEntries links to DayPatterns; and DayPatterns links to CalendarPeriods.

Figure 26. Example of a seasonal time-of-use rate commodity tariff

#### 9.12.8.6. Individual Days

Tariffs can override scheduled rates on specific days using the `IndividualDays` attribute.

For example, if a tariff starting on 2025/01/01 charges:

1. \$0.17 per unit, all day, every day
2. \$0.10 per unit, all day on Easter (2025/04/20)

This can be represented by:

1. Two `DayEntryStructs` starting at midnight:
  - a. One with a `DayEntryID` of 0x94; this will represent the regular schedule
  - b. One with a `DayEntryID` of 0x95; this will represent the schedule on Easter
2. One `DayPatternStruct` with a `DayPatternID` of 0x67, with all `DaysOfWeek` set and containing the `DayEntryID` 0x94
3. One `CalendarPeriodStruct` starting on 2025/01/01 and containing the `DayPatternID` 0x67
4. One `DayStruct` with a `DayStructDate` of 2025/04/20, a `DayType` of Holiday, and containing the `DayEntryID` 0x95
5. Two `TariffComponentStructs`:
  - a. One with a `TariffComponentID` of 0x5A2, and a standard price of \$0.17
  - b. One with a `TariffComponentID` of 0x5A3, and a standard price of \$0.10
6. Two `TariffPeriodStructs`
  - a. One linking the `TariffComponentID` of 0x5A2 to the `DayEntryID` of 0x94



Page 799



b. One linking the `TariffComponentID` of 0x5A3 to the `DayEntryID` of 0x95

![Diagram illustrating the relationship between TariffPeriods, TariffComponents, IndividualDays, DayEntries, DayPatterns, and CalendarPeriods for a flat rate commodity tariff with holiday pricing.](230a645467342cbe60ab5df637de0120_img.jpg)

The diagram shows the following data structures and their relationships:

- TariffPeriods** (Table):

| Label   | TariffComponentIDs | DayEntryIDs |
|---------|--------------------|-------------|
| All Day | [0x5A2]            | [0x94]      |
| Easter  | [0x5A3]            | [0x95]      |
- TariffComponents** (Table):

| TariffComponentID | Price                     | Threshold |
|-------------------|---------------------------|-----------|
| 0x5A2             | <i>PriceType</i> Standard | 0         |
|                   | <i>Price</i> \$0.17       |           |
| 0x5A3             | <i>PriceType</i> Standard | 0         |
|                   | <i>Price</i> \$0.10       |           |
- IndividualDays** (Table):

| IndividualDays |         |             |
|----------------|---------|-------------|
| Date           | DayType | DayEntryIDs |
| 2025/04/20     | Holiday | [0x95]      |
- DayEntries** (Table):

| DayEntries |           |
|------------|-----------|
| DayEntryID | StartTime |
| 0x94       | 0         |
| 0x95       | 0         |
- DayPatterns** (Table):

| DayPatterns  |            |             |
|--------------|------------|-------------|
| DayPatternID | DaysOfWeek | DayEntryIDs |
| 0x67         | 0x7F       | [0x94]      |
- CalendarPeriods** (Table):

| CalendarPeriods |               |
|-----------------|---------------|
| StartDate       | DayPatternIDs |
| 2025/01/01      | [0x67]        |

Relationships: Arrows indicate that TariffPeriods links to TariffComponents and DayEntries. TariffComponents links to DayEntries. DayEntries links to IndividualDays. DayEntries links to DayPatterns. DayPatterns links to CalendarPeriods.

Diagram illustrating the relationship between TariffPeriods, TariffComponents, IndividualDays, DayEntries, DayPatterns, and CalendarPeriods for a flat rate commodity tariff with holiday pricing.

Figure 27. Example of a flat rate commodity tariff with holiday pricing

### 9.12.8.7. Individual Days with Durations

Tariffs can override scheduled rates on specific days during specific times using the `IndividualDays` attribute.

For example, if a tariff starting on 2025/01/01 charges:

1. \$0.23 per unit, all day, every day
2. \$0.40 per unit from 16:00 to 19:00 on 2025/02/14 as part of a Critical Peak Pricing event

This can be represented by:

1. Two `DayEntryStructs`:
  - a. One with a `DayEntryID` of 0x132, starting at midnight; this will represent the regular schedule
  - b. One with a `DayEntryID` of 0x133, starting and 960 (16:00) with a duration of 180 (three hours); this will represent the CPP event
2. One `DayPatternStruct` with a `DayPatternID` of 0x13B3, with all `DaysOfWeek` set and containing the `DayEntryID` 0x132
3. One `CalendarPeriodStruct` starting on 2025/01/01 and containing the `DayPatternID` 0x67
4. One `DayStruct` with a `DayStructDate` of 2025/02/14, a `DayType` of Dynamic, and containing the `DayEntryID` 0x133
5. Two `TariffComponentStructs`:
  - a. One with a `TariffComponentID` of 0x9D4, and a standard price of \$0.23
  - b. One with a `TariffComponentID` of 0x9D5, and a critical price of \$0.40
6. Two `TariffPeriodStructs`:

Page 800







- One linking the `TariffComponentID` of 0x9D4 to the `DayEntryID` of 0x132
- One linking the `TariffComponentID` of 0x9D5 to the `DayEntryID` of 0x133

![Diagram illustrating the structure of a flat rate commodity tariff with a critical peak pricing event. It shows five interconnected tables: TariffPeriods, TariffComponents, IndividualDays, DayEntries, and CalendarPeriods.](c171abd8447327672855f126bbf140c3_img.jpg)

The diagram illustrates the structure of a flat rate commodity tariff with a critical peak pricing event. It consists of five interconnected tables:

- TariffPeriods** (purple header):

| Label      | TariffComponentIDs | DayEntryIDs |
|------------|--------------------|-------------|
| All Day    | [0x9D4]            | [0x132]     |
| CPP Events | [0x9D5]            | [0x133]     |
- TariffComponents** (purple header):

| TariffComponentID | Price     |          | Threshold |
|-------------------|-----------|----------|-----------|
| 0x9D4             | PriceType | Standard | 0         |
|                   | Price     | \$0.23   |           |
| 0x9D5             | PriceType | Critical | 0         |
|                   | Price     | \$0.40   |           |
- IndividualDays** (blue header):

| IndividualDays |           |             |
|----------------|-----------|-------------|
| Date           | DayType   | DayEntryIDs |
| 2025/02/14     | CPP Event | [0x133]     |
- DayEntries** (blue header):

| DayEntries |           |          |
|------------|-----------|----------|
| DayEntryID | StartTime | Duration |
| 0x132      | 0         |          |
| 0x133      | 960       | 180      |
- DayPatterns** (blue header):

| DayPatterns  |            |             |
|--------------|------------|-------------|
| DayPatternID | DaysOfWeek | DayEntryIDs |
| 0x13B3       | 0x7F       | [0x132]     |
- CalendarPeriods** (blue header):

| CalendarPeriods |               |
|-----------------|---------------|
| StartDate       | DayPatternIDs |
| 2025/01/01      | [0x13B3]      |

Diagram illustrating the structure of a flat rate commodity tariff with a critical peak pricing event. It shows five interconnected tables: TariffPeriods, TariffComponents, IndividualDays, DayEntries, and CalendarPeriods.

Figure 28. Example of a flat rate commodity tariff with a critical peak pricing event

#### 9.12.8.8. Dynamic Pricing

Tariffs can also use the `IndividualDays` attribute to implement fully dynamic pricing.

For example, if a tariff charges a different rate every hour of the day, publishing the current day's rates as well as predictions of the next six days rates, the state of the tariff on 2025/03/15 can be represented by:

- 168 `DayEntryStructs`:
  - 24 for today, with `DayEntryIDs` ranging from 0x200 to 0x217
  - 24 for tomorrow, with `DayEntryIDs` ranging from 0x218 to 0x22F
  - 120 for the remaining five days, with `DayEntryIDs` ranging from 0x230 to 0x2A7
- Seven `DayStructs`:
  - One for 2025/03/15, with a `DayType` of Dynamic, containing `DayEntryIDs` ranging from 0x200 to 0x217
  - One for 2025/03/16, with a `DayType` of Dynamic, containing `DayEntryIDs` ranging from 0x218 to 0x22F
  - Five more for the remaining days
- 168 `TariffComponentStructs`:
  - 24 for today, with `TariffComponentIDs` ranging from 0x400 to 0x417, prices for each hour, and `Predicted` set to false
  - 24 for tomorrow, with `TariffComponentIDs` ranging from 0x418 to 0x42F, prices for each hour, and `Predicted` set to true
  - 120 for the remaining five days, with `TariffComponentIDs` ranging from 0x430 to 0x4A7,



Page 801



prices for each hour, and `Predicted` set to true

4. 168 `TariffPeriodStructs`:

- a. 24 linking the 0x400 to 0x417 range of `TariffComponentIDs` to the 0x200 to 0x217 range of `DayEntryIDs`
  - i. These components link the price for each hour of today to the day entry representing that hour
- b. 24 linking the 0x418 to 0x42F range of `TariffComponentIDs` to the 0x218 to 0x22F range of `DayEntryIDs`
  - i. These components link the price for each hour of tomorrow to the day entry representing that hour
- c. 120 linking the 0x430 to 0x4A7 range of `TariffComponentID` to the 0x230 to 0x2A7 range of `DayEntryIDs`
  - i. These components link the price for each hour of the remaining five days to the day entry representing that hour

As new rates are provided, the `IndividualDays`, `TariffComponents`, and `TariffPeriods` attributes can drop expired values while adding new predictions. `TariffComponentStructs` which previously had `Predicted` set to true can be updated with actual prices and `Predicted` set to false.

Page 802







![Diagram illustrating a fully dynamic rate commodity tariff structure across four interconnected tables: TariffPeriods, DayEntries, TariffComponents, and IndividualDays.](c3bc95790836bface2941f6f888be9aa_img.jpg)

The diagram illustrates a fully dynamic rate commodity tariff structure across four interconnected tables:

- TariffPeriods** (Left, purple header): Maps time periods to tariff components and day entries. It includes columns for **Label** (e.g., 3/15 00:00 to 3/21 23:00), **TariffComponentIDs** (e.g., [0x400] to [0x4A7]), and **DayEntryIDs** (e.g., [0x200] to [0x2A7]).
- DayEntries** (Top Right, blue header): Maps day entries to start times. It includes columns for **DayEntryID** (e.g., 0x200 to 0x2A7) and **StartTime** (e.g., 0 to 1380 minutes). The **DayEntryID** column is grouped by date (3/15, 3/16, 3/17, 3/18, 3/19, 3/20, 3/21).
- TariffComponents** (Bottom Left, purple header): Defines tariff components with prices and prediction status. It includes columns for **TariffComponentID** (e.g., 0x400 to 0x4A7), **Price** (sub-table with *PriceType* and *Price*), and **Predicted** (True/False). The **Predicted** column is grouped by date (3/15, 3/16).
- IndividualDays** (Bottom Right, blue header): Maps individual days to their type and day entries. It includes columns for **Date** (e.g., 2025/03/15 to 2025/03/21), **DayType** (e.g., Dynamic, Variable), and **DayEntryIDs** (e.g., [0x200, ... 0x217]).

Arrows indicate relationships: TariffPeriods points to DayEntries and TariffComponents. TariffComponents points to IndividualDays. DayEntries points to IndividualDays.

Diagram illustrating a fully dynamic rate commodity tariff structure across four interconnected tables: TariffPeriods, DayEntries, TariffComponents, and IndividualDays.

Figure 29. Example of a fully dynamic rate commodity tariff



Page 803



### 9.12.8.9. Other Tariff Components

Tariffs components can represent changes to other metering states than price.

For example, a tariff that controls a set of auxiliary load switches might only switch auxiliary switch 8 to ON from 00:00 to 01:00 and 07:00 to 24:00 on 2025/05/30. This tariff could be represented by:

1. Three `DayEntryStructs`:
  - a. One with a `DayEntryID` of 0x06; this will represent the 00:00 to 01:00 period on 2025/05/30
  - b. One with a `DayEntryID` of 0x07; this will represent the 07:00 to 24:00 period on 2025/05/30
  - c. One with a `DayEntryID` of 0x08; this will represent the all-day regular schedule
2. One `DayPatternStruct` with a `DayPatternID` of 0x15, with all `DaysOfWeek` set and containing the `DayEntryID` 0x08
3. One `CalendarPeriodStruct` starting on 2025/01/01 and containing the `DayPatternID` 0x15
4. One `DayStruct` with a `DayStructDate` of 2025/05/30, a `DayType` of Event, and containing the `DayEntryIDs` 0x06 and 0x07
5. Two `TariffComponentStructs`:
  - a. One with a `TariffComponentID` of 0x29, with all auxiliary switches disabled
  - b. One with a `TariffComponentID` of 0x3A, with the eighth auxiliary switch enabled
6. Two `TariffPeriodStructs`
  - a. One linking the `TariffComponentID` of 0x29 to the `DayEntryID` of 0x08
  - b. One linking the `TariffComponentID` of 0x3A to the `DayEntryIDs` of 0x06 and 0x07

![Diagram illustrating the structure of a commodity tariff for auxiliary load switches. It shows five interconnected data structures: TariffPeriods, TariffComponents, IndividualDays, DayEntries, and CalendarPeriods. Arrows indicate relationships: TariffPeriods links to TariffComponents and IndividualDays; TariffComponents links to IndividualDays; IndividualDays links to DayEntries; and CalendarPeriods links to DayPatterns, which in turn links to DayEntries.](2fdf00c28ce92c0808f262191b6fb96a_img.jpg)

| TariffPeriods |                    |             |
|---------------|--------------------|-------------|
| Label         | TariffComponentIDs | DayEntryIDs |
| All Day       | [0x29]             | [0x8]       |
| Tomorrow      | [0x3A]             | [0x6, 0x7]  |

  

| TariffComponents  |                       |       |
|-------------------|-----------------------|-------|
| TariffComponentID | Auxiliary Load Switch | Label |
| 0x29              | 0x00                  | HN    |
| 0x3A              | 0x80                  | PM    |

  

| IndividualDays |         |             |
|----------------|---------|-------------|
| Date           | DayType | DayEntryIDs |
| 2025/05/30     | Event   | [0x6, 0x7]  |

  

| DayEntries |           |          |
|------------|-----------|----------|
| DayEntryID | StartTime | Duration |
| 0x6        | 0         | 60       |
| 0x7        | 420       | 1020     |
| 0x8        | 0         | -        |

  

| DayPatterns  |            |             |
|--------------|------------|-------------|
| DayPatternID | DaysOfWeek | DayEntryIDs |
| 0x15         | 0x7F       | [0x8]       |

  

| CalendarPeriods |               |
|-----------------|---------------|
| StartDate       | DayPatternIDs |
| 2025/01/01      | [0x15]        |

Diagram illustrating the structure of a commodity tariff for auxiliary load switches. It shows five interconnected data structures: TariffPeriods, TariffComponents, IndividualDays, DayEntries, and CalendarPeriods. Arrows indicate relationships: TariffPeriods links to TariffComponents and IndividualDays; TariffComponents links to IndividualDays; IndividualDays links to DayEntries; and CalendarPeriods links to DayPatterns, which in turn links to DayEntries.

Figure 30. Example of a commodity tariff for auxiliary load switches

Page 804





### 9.12.9. Active Tariff Components for a Timestamp

The currently active tariff components are indicated by the value of the `CurrentTariffComponents` attribute. Additionally, the upcoming tariff components are indicated by the value of the `NextTariffComponents` attribute; the value of the `CurrentTariffComponents` attribute will next update at the timestamp indicated by the `NextDayEntryDate` attribute.

Finding the active tariff components for an arbitrary timestamp requires examining the contents of the `DayEntries`, `DayPatterns`, `CalendarPeriods`, `IndividualDays`, `TariffComponents`, and `TariffPeriods` attributes, and applying the following steps:

1. Determine the minutes since elapsed since midnight in the meter's timezone for the timestamp
2. For each `DayStruct` in the `IndividualDays` attribute:
  - a. If the `Date` field matches the timestamp:
    - i. Find the `DayEntryStruct` referenced in `DayStructDayEntryIDs` with the largest `StartTime` that is less than or equal to the minutes since midnight and either:
      - A. Has no `Duration`, or
      - B. `StartTime` + `Duration` is greater than or equal to the minutes since midnight
3. If no matching `DayEntryStruct` was found:
  - a. Determine the day of the week for the timestamp
  - b. Find the `CalendarPeriodStruct` in the `CalendarPeriods` attribute with the largest `StartDate` that is less than or equal to the timestamp
  - c. If a matching `CalendarPeriodStruct` was found:
    - i. For each `DayPatternStruct` in the `DayPatterns` attribute referenced in `DayPatternIDs`:
      - A. If the bit matching the day of the week is set in `DaysOfWeek`:
        - I. Find the `DayEntryStruct` referenced in `DayStructDayEntryIDs` with the largest `StartTime` that is less than or equal to the minutes since midnight
4. If a matching `DayEntryStruct` was found:
  - a. For each `TariffPeriodStruct` in the `TariffPeriods` attribute:
    - i. If the `DayEntryIDs` field contains the `DayEntryID` of the matched `DayEntryStruct`, then the `TariffComponentIDs` field contains the `TariffComponentIDs` of the active `TariffComponentStructs`.
5. Otherwise, there is no available information in the tariff for determining the tariff components active at the timestamp



Page 805



![Flowchart for determining tariff components for a given timestamp. The process starts with a timestamp, determines minutes since, and then iterates through DayStructs and DayEntryStructs to find matching entries. If no match is found, it determines the day of the week and iterates through Calendar Periods, DayPatterns, and TariffPeriods to find applicable tariff components. If a tariff component is found with a price field, it indicates the price. If no tariff component is found, it is unable to determine the tariff components.](d3a8b8df80ce3f9d08adf3366e4dd307_img.jpg)

```

graph TD
    start([start]) --> Timestamp[/Timestamp.../]
    Timestamp --> DetermineMinutes[Determine minutes since...]
    DetermineMinutes --> DayStructLoop[For each DayStruct...]
    DayStructLoop --> DateMatches{Date matches...}
    DateMatches -- no --> DayStructLoop
    DateMatches -- yes --> DayEntryLoop[For each associated DayEntryStruct...]
    DayEntryLoop --> StartTime{StartTime...}
    StartTime -- no --> DayEntryLoop
    StartTime -- yes --> DayEntryHas{DayEntry has...}
    DayEntryHas -- no --> DayEntryLoop
    DayEntryHas -- yes --> StartTimePlus{StartTime +...}
    StartTimePlus -- no --> DayEntryLoop
    StartTimePlus -- yes --> DayEntryLoop
    DayEntryLoop --> DayOfWeek[Determine day of week...]
    DayOfWeek --> CalendarPeriodLoop[For each Calendar Period...]
    CalendarPeriodLoop --> StartDate{StartDate <...}
    StartDate -- no --> CalendarPeriodLoop
    StartDate -- yes --> DayPatternLoop[For each DayPattern]
    DayPatternLoop --> DaysOfWeek{DaysOfWeek...}
    DaysOfWeek -- no --> DayPatternLoop
    DaysOfWeek -- yes --> DayEntryLoop2[For each associated DayEntryStruct...]
    DayEntryLoop2 --> StartTimeLess{StartTime <= MsM?}
    StartTimeLess -- no --> DayEntryLoop2
    StartTimeLess -- yes --> DayEntryLoop2
    DayEntryLoop2 --> TariffPeriodLoop[For each TariffPeriod]
    TariffPeriodLoop --> DayEntryIDs{DayEntryIDs...}
    DayEntryIDs -- no --> TariffPeriodLoop
    DayEntryIDs -- yes --> TariffComponentLoop[For each TariffComponentID]
    TariffComponentLoop --> HasPrice{Has Price field?}
    HasPrice -- no --> TariffComponentLoop
    HasPrice -- yes --> PriceField[/Price field indicates.../]
    PriceField --> end([end])
    DayEntryLoop2 --> UnableToDetermine[/Unable to determine.../]
    UnableToDetermine --> end
  
```

Flowchart for determining tariff components for a given timestamp. The process starts with a timestamp, determines minutes since, and then iterates through DayStructs and DayEntryStructs to find matching entries. If no match is found, it determines the day of the week and iterates through Calendar Periods, DayPatterns, and TariffPeriods to find applicable tariff components. If a tariff component is found with a price field, it indicates the price. If no tariff component is found, it is unable to determine the tariff components.

Figure 31. Flowchart for determining tariff components for a given timestamp

Page 806







## 9.13. Electrical Grid Conditions Cluster

The Electrical Grid Conditions Cluster provides the mechanism for communicating electricity grid carbon intensity to devices within the premises in units of Grams of CO<sub>2</sub>e per kWh.

This is an important mechanism to allow energy appliances decide when to operate to help consumers reduce their carbon footprint, when the pricing may be the same throughout the day.

When homes have local generation (for example Solar PV) this may mean that the premises at the local grid connection point has effectively no green house gas emissions, and so this cluster allows devices to understand both the grid and local conditions.

### 9.13.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description             |
|----------|-------------------------|
| 1        | Initial Matter revision |

### 9.13.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | EGC       |

### 9.13.3. Cluster ID

| ID     | Name                       |
|--------|----------------------------|
| 0x00A0 | Electrical Grid Conditions |

### 9.13.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature     | Conformance | Summary            |
|-----|------|-------------|-------------|--------------------|
| 0   | FORE | Forecasting | 0           | Forecasts upcoming |

#### 9.13.4.1. Forecasting Feature

The feature indicates the server is capable of providing a forecast of grid and local conditions for several hours in the future.

### 9.13.5. Data Types



Page 807



### 9.13.5.1. ThreeLevelEnum Type

This data type is derived from enum8 and is used for indicating three levels: Low, Medium, High.

| Value | Name   | Summary | Conformance |
|-------|--------|---------|-------------|
| 0     | Low    | Low     | M           |
| 1     | Medium | Medium  | M           |
| 2     | High   | High    | M           |

### 9.13.5.2. ElectricalGridConditionsStruct Type

This represents the greenhouse gas carbon intensity over a given period.

| ID | Name                 | Type           | Constraint            | Quality | Fallback | Access | Conformance |
|----|----------------------|----------------|-----------------------|---------|----------|--------|-------------|
| 0  | PeriodStart          | epoch-s        | all                   |         |          |        | M           |
| 1  | PeriodEnd            | epoch-s        | min (PeriodStart + 1) | X       |          |        | M           |
| 2  | GridCarbonIntensity  | int16          | all                   |         |          |        | M           |
| 3  | GridCarbonLevel      | ThreeLevelEnum | all                   |         |          |        | M           |
| 4  | LocalCarbonIntensity | int16          | all                   |         |          |        | M           |
| 5  | LocalCarbonLevel     | ThreeLevelEnum | all                   |         |          |        | M           |

#### 9.13.5.2.1. PeriodStart Field

This field SHALL indicate the beginning timestamp in UTC of the period.

#### 9.13.5.2.2. PeriodEnd Field

This field SHALL indicate the ending timestamp in UTC of the period. This SHALL be greater than PeriodStart. If this field is null, then the period has no definite end.

#### 9.13.5.2.3. GridCarbonIntensity Field

This field SHALL indicate the estimated carbon intensity in grams of CO2 equivalent per kWh of the grid. This is not impacted by any local generation.

Page 808







#### 9.13.5.2.4. GridCarbonLevel Field

This field SHALL indicate the relative level of carbon intensity of the grid. This is not impacted by any local generation.

It is up to the cluster server to determine the thresholds of High, Medium or Low based upon typical grid carbon levels for this region or market, since this can vary significantly between countries across the world.

#### 9.13.5.2.5. LocalCarbonIntensity Field

This field SHALL indicate the estimated carbon intensity in grams of CO2 equivalent per kWh of the premises mains supply. This value SHALL take into account the impact of any local generation.

For example, if an EMS can forecast that excess generation will occur in a period or the premises are currently generating excess power to the grid, then this could assume a value of 0 grams CO2 equivalent per kWh for this period.

When solar PV is not being exported to the grid then this value is typically the same as the GridCarbonIntensity.

Clients are expected to use this value when computing or displaying the local premises carbon intensity to users.

If there is no local generation, this value SHALL be the same as the GridCarbonIntensity at all times.

#### 9.13.5.2.6. LocalCarbonLevel Field

This field SHALL indicate the relative level of carbon intensity of the premises mains supply. This level SHALL take into account impact of any local generation.

It is up to the cluster server to determine the thresholds of High, Medium or Low based upon typical grid carbon levels for this region or market, since this can vary significantly between countries across the world.

When local power generation (for example from solar PV) is not being exported to the grid then this level is the same as the GridCarbonLevel.

Clients are expected to use this value when displaying the local premises carbon intensity to users.

If there is no local generation, this value SHALL be the same as the GridCarbonLevel at all times.

### 9.13.6. Attributes

| ID     | Name                     | Type | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------|------|------------|---------|----------|--------|-------------|
| 0x0000 | LocalGenerationAvailable | bool | all        | X       |          | RW VO  | M           |




Page 809



| ID     | Name                       | Type                                  | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------------------|---------------------------------------|------------|---------|----------|--------|-------------|
| 0x0001 | <b>Current-Conditions</b>  | Electrical-GridConditionsStruct       | all        | X       |          | R V    | M           |
| 0x0002 | <b>Forecast-Conditions</b> | list[ElectricalGrid-ConditionsStruct] | max 56     |         |          | R V    | FORE        |

#### 9.13.6.1. LocalGenerationAvailable Attribute

This SHALL indicate if there is known to be local generation (for example Solar PV or Battery Storage) at the premises.

If the presence of any local generation is unknown, or cannot be determined, the value SHALL be null.

#### 9.13.6.2. CurrentConditions Attribute

This SHALL indicate the current electricity supply conditions. If the current conditions are unknown, or cannot be determined, the value SHALL be null.

#### 9.13.6.3. ForecastConditions Attribute

This SHALL indicate the forecast of upcoming electricity supply conditions. If the forecast is unable to be determined, this list SHALL be empty.

The list entries SHALL be in time order:

- All entries except the last one SHALL have a non-null [PeriodEnd](#).
- For all entries except the first one, [PeriodStart](#) SHALL be greater than the previous entry's [PeriodEnd](#).

### 9.13.7. Events

| ID   | Name                            | Priority | Quality | Access | Conformance |
|------|---------------------------------|----------|---------|--------|-------------|
| 0x00 | <b>CurrentConditionsChanged</b> | INFO     |         | V      | O           |

#### 9.13.7.1. CurrentConditionsChanged Event

This event SHALL be generated when the value of the [CurrentConditions](#) attribute changes.

Page 810





| ID | Name              | Type                            | Constraint | Quality | Fallback | Conformance |
|----|-------------------|---------------------------------|------------|---------|----------|-------------|
| 0  | CurrentConditions | Electrical-GridConditionsStruct |            | X       |          | M           |

#### 9.13.7.1.1. CurrentConditions Field

This field SHALL be the new value of the [CurrentConditions](#) attribute.



Page 811



Page 812







## Chapter 10. Network Infrastructure

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter.

### 10.1. General Description

#### 10.1.1. Introduction

The clusters specified in this section are used to control network infrastructure devices, such as home internet gateways, Wi-Fi access points, Thread Border Routers, etc.

#### 10.1.2. Cluster List

This section lists the clusters specified in this document, and gives examples of typical usage for the purpose of clarification.

*Table 17. Clusters Specified in the Network Infrastructure Functional Domain*

| Cluster ID | Cluster Name                                     | Description                                     |
|------------|--------------------------------------------------|-------------------------------------------------|
| 0x0451     | <a href="#">Wi-Fi Network Management</a>         | Request Wi-Fi network details                   |
| 0x0452     | <a href="#">Thread Border Router Management</a>  | Management of a Thread Border Router / Network  |
| 0x0453     | <a href="#">Thread Network Directory Cluster</a> | Directory of Thread networks and Border Routers |

### 10.2. Wi-Fi Network Management Cluster

This cluster provides an interface for getting information about the Wi-Fi network that a Network Infrastructure Manager device type provides. Privileged nodes within the same fabric as a Network Infrastructure Manager can use these interfaces to request information related to the Wi-Fi Network such as SSID and Passphrase.

#### 10.2.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

#### 10.2.2. Classification



Page 813



| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | WIFINM    |

### 10.2.3. Cluster ID

| ID     | Name                     |
|--------|--------------------------|
| 0x0451 | Wi-Fi Network Management |

### 10.2.4. Attributes

| ID     | Name                | Type   | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------------|--------|------------|---------|----------|--------|-------------|
| 0x0000 | SSID                | octstr | 1 to 32    | N X     |          | R V    | M           |
| 0x0001 | PassphraseSurrogate | uint64 | all        | N X     |          | R M    | M           |

#### 10.2.4.1. SSID Attribute

This attribute SHALL indicate the SSID of the primary Wi-Fi network provided by this device.

A value of null SHALL indicate that no primary Wi-Fi network is available (e.g. because the Wi-Fi network has not yet been configured by the user).

**NOTE** The SSID in Wi-Fi is a collection of 1-32 bytes, the text encoding of which is not specified. Implementations must be careful to support transferring these byte strings without requiring a particular encoding. The most common encoding is UTF-8, however this is just a convention. Some configurations may use Latin-1 or other character sets.

#### 10.2.4.2. PassphraseSurrogate Attribute

This attribute SHALL contain an arbitrary numeric value; this value SHALL increase whenever the passphrase or PSK associated with the primary Wi-Fi network provided by this device changes.

A value of null SHALL indicate that no primary Wi-Fi network is available.

Clients can subscribe to this attribute or compare its value to a locally cached copy to detect if a cached passphrase value has become stale.

It is RECOMMENDED that servers implement this attribute as either a timestamp or a counter. When implemented as a counter it SHOULD be initialized with a random value.

**NOTE** The passphrase itself is not exposed as an attribute to avoid its unintentional retrieval or caching by clients that use wildcard reads or otherwise routinely read all available attributes. It can be retrieved using the [NetworkPassphraseRequest](#)

Page 814







command.

### 10.2.5. Commands

| ID   | Name                             | Direction                   | Response                  | Access | Conformance |
|------|----------------------------------|-----------------------------|---------------------------|--------|-------------|
| 0x00 | <b>NetworkPassphraseRequest</b>  | client $\Rightarrow$ server | NetworkPassphraseResponse | M      | M           |
| 0x01 | <b>NetworkPassphraseResponse</b> | client $\Leftarrow$ server  | N                         |        | M           |

#### 10.2.5.1. NetworkPassphraseRequest Command

This command is used to request the current WPA-Personal passphrase or PSK associated with the Wi-Fi network provided by this device.

If the command is not executed via a CASE session, the command SHALL be rejected with a status of UNSUPPORTED\_ACCESS.

If no primary Wi-Fi network is available (the SSID attribute is null), the command SHALL be rejected with a status of INVALID\_IN\_STATE.

Otherwise a NetworkPassphraseResponse SHALL be generated.

#### 10.2.5.2. NetworkPassphraseResponse Command

This command SHALL be generated in response to a NetworkPassphraseRequest command. The data for this command SHALL be as follows:

| ID   | Name              | Type   | Constraint | Conformance |
|------|-------------------|--------|------------|-------------|
| 0x00 | <b>Passphrase</b> | octstr | max 64     | M           |

##### 10.2.5.2.1. Passphrase Field

This field SHALL indicate the current WPA-Personal passphrase or PSK associated with the primary Wi-Fi network provided by this device, in one of the following formats:

- 8..63 bytes: WPA/WPA2/WPA3 passphrase.
- 64 bytes: WPA/WPA2/WPA3 raw hex PSK. Each byte SHALL be a ASCII hexadecimal digit.

This matches the formats defined for WPA networks by the Credentials field in the Network Commissioning cluster (see [\[MatterCore\]](#)).

#### NOTE

WPA3-Personal permits passphrases shorter than 8 or longer than 63 characters, however the Network Commissioning cluster does not currently support configuring Matter devices to connect to operational networks utilizing such a passphrase.




Page 815



## 10.3. Thread Border Router Management Cluster

This cluster provides an interface for managing a Thread Border Router and the Thread network that it belongs to. Privileged nodes within the same fabric as a Thread Border Router can use these interfaces to request and set credentials information to the Thread network.

### 10.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 10.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | TBRM      |

### 10.3.3. Cluster ID

| ID     | Name                            |
|--------|---------------------------------|
| 0x0452 | Thread Border Router Management |

### 10.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code | Feature   | Conformance | Summary                                                                       |
|-----|------|-----------|-------------|-------------------------------------------------------------------------------|
| 0   | PC   | PANChange | 0           | The ability to change PAN configuration with pending dataset setting request. |

#### 10.3.4.1. PANChange Feature

This feature SHALL indicate the ability of the Border Router to change its already configured PAN to another, by setting a pending dataset.

##### NOTE

This feature flag can be used to protect an already-configured network from accidental configuration change, e.g. when the Thread Border Router serves non-Matter devices that do not support PAN change for an implementation-specific reason.

Page 816



### 10.3.5. Attributes

| ID     | Name                             | Type   | Constraint | Quality | Fallback | Access | Conformance |
|--------|----------------------------------|--------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Border-Router-Name</b>        | string | 1 to 63    |         |          | R V    | M           |
| 0x0001 | <b>BorderAgentID</b>             | octstr | 16         |         |          | R V    | M           |
| 0x0002 | <b>Thread-Version</b>            | uint16 | all        | F       |          | R V    | M           |
| 0x0003 | <b>InterfaceEnabled</b>          | bool   | all        | N       |          | R V    | M           |
| 0x0004 | <b>Active-Dataset-Timestamp</b>  | uint64 | all        | N X     |          | R V    | M           |
| 0x0005 | <b>Pending-Dataset-Timestamp</b> | uint64 | all        | N X     |          | R V    | M           |

#### 10.3.5.1. BorderRouterName Attribute

This attribute SHALL indicate a user-friendly name identifying the device model or product of the Border Router in MeshCOP (DNS-SD service name) as defined in the [Thread specification](#), and has the following recommended format: `<VendorName> <ProductName>._meshcop._udp`. An example name would be `ACME Border Router (74be)._meshcop._udp`.

#### 10.3.5.2. BorderAgentID Attribute

This attribute SHALL indicate a 16-byte globally unique ID for a Thread Border Router device. This ID is manufacturer-specific, and it is created and managed by the border router's implementation.

#### 10.3.5.3. ThreadVersion Attribute

This attribute SHALL indicate the Thread version supported by the Thread interface configured by the cluster instance.

The format SHALL match the value mapping defined in the "Version TLV" section of the [Thread specification](#). For example, Thread 1.3.0 would have ThreadVersion set to 4.

#### 10.3.5.4. InterfaceEnabled Attribute

This attribute SHALL indicate whether the associated IEEE 802.15.4 Thread interface is enabled or disabled.




Page 817



### 10.3.5.5. ActiveDatasetTimestamp Attribute

This attribute SHALL be null if the Thread Border Router has no dataset configured, otherwise it SHALL be the timestamp value extracted from the Active Dataset value configured by the Thread Node to which the border router is connected. This attribute SHALL be updated when a new Active dataset is configured on the Thread network to which the border router is connected.

### 10.3.5.6. PendingDatasetTimestamp Attribute

This attribute SHALL be null if the Thread Border Router has no Pending dataset configured, otherwise it SHALL be the timestamp value extracted from the Pending Dataset value configured by the Thread Node to which the border router is connected. This attribute SHALL be updated when a new Pending dataset is configured on the Thread network to which the border router is connected.

## 10.3.6. Commands

| ID   | Name                     | Direction                   | Response        | Access | Conformance |
|------|--------------------------|-----------------------------|-----------------|--------|-------------|
| 0x00 | GetActiveDatasetRequest  | client $\Rightarrow$ server | DatasetResponse | M      | M           |
| 0x01 | GetPendingDatasetRequest | client $\Rightarrow$ server | DatasetResponse | M      | M           |
| 0x02 | DatasetResponse          | client $\Leftarrow$ server  | N               |        | M           |
| 0x03 | SetActiveDatasetRequest  | client $\Rightarrow$ server | Y               | M T    | M           |
| 0x04 | SetPendingDatasetRequest | client $\Rightarrow$ server | Y               | M T    | PC          |

### 10.3.6.1. GetActiveDatasetRequest Command

This command SHALL be used to request the active operational dataset of the Thread network to which the border router is connected.

If the command is not executed via a CASE session, the command SHALL fail with a status code of UNSUPPORTED\_ACCESS.

If an internal error occurs, then this command SHALL fail with a FAILURE status code sent back to the initiator.

Otherwise, this SHALL generate a DatasetResponse command.

Page 818







### 10.3.6.2. GetPendingDatasetRequest Command

This command SHALL be used to request the pending dataset of the Thread network to which the border router is connected.

If the command is not executed via a CASE session, the command SHALL fail with a status code of UNSUPPORTED\_ACCESS.

If an internal error occurs, then this command SHALL fail with a FAILURE status code sent back to the initiator.

Otherwise, this SHALL generate a DatasetResponse command.

### 10.3.6.3. DatasetResponse Command

This command is sent in response to GetActiveDatasetRequest or GetPendingDatasetRequest command. The data for this command SHALL be as follows:

| ID | Name           | Type   | Constraint | Quality | Fallback | Conformance |
|----|----------------|--------|------------|---------|----------|-------------|
| 0  | <b>Dataset</b> | octstr | max 254    |         |          | M           |

#### 10.3.6.3.1. Dataset field

If no dataset (active or pending as requested) is configured, this field SHALL be set to empty.

Otherwise, this field SHALL contain the active or pending dataset of the Thread network to which the Border Router is connected as an octet string containing the raw Thread TLV value of the dataset, as defined in the [Thread specification](#).

### 10.3.6.4. SetActiveDatasetRequest Command

This command SHALL be used to set the active Dataset of the Thread network to which the Border Router is connected, when there is no active dataset already.

| ID | Name                  | Type   | Constraint | Quality | Fallback | Conformance |
|----|-----------------------|--------|------------|---------|----------|-------------|
| 0  | <b>Active-Dataset</b> | octstr | max 254    |         |          | M           |
| 1  | <b>Bread-crumb</b>    | uint64 | all        |         |          | O           |

#### 10.3.6.4.1. ActiveDataset Field

This field SHALL contain the active dataset to set of the Thread network to configure in the Border Router as an octet string containing the raw Thread TLV value of the dataset, as defined in the [Thread specification](#).




Page 819



#### 10.3.6.4.2. Breadcrumb Field

See Breadcrumb Attribute section of General Commissioning Cluster in [\[MatterCore\]](#) for usage.

#### 10.3.6.4.3. Effect on receipt

If the command is not executed via a CASE session, the command SHALL fail with a status code of UNSUPPORTED\_ACCESS.

If this command is received without a Fail Safe Context (see ArmFailSafe Command of General Commissioning Cluster in [\[MatterCore\]](#)), then this command SHALL fail with a FAILSAFE\_REQUIRED status code sent back to the initiator.

If any of the parameters in the ActiveDataset is invalid, the command SHALL fail with a status code of INVALID\_COMMAND.

If this command is invoked when the ActiveDatasetTimestamp attribute is not null, the command SHALL fail with a status code of INVALID\_IN\_STATE. The administrator MAY use the SetPendingDatasetRequest command to modify the future active dataset.

If this command is invoked and the ActiveDatasetTimestamp attribute is null, the Thread Border Router SHALL configure and activate its active dataset using the ActiveDataset parameter.

The activation process SHALL be a time-bound process that completes before expiration of a fail-safe timer. The fail-safe timer SHALL be set at the beginning of the activation process.

If the fail-safe timer expires prior to activation process completion, the command SHALL respond with TIMEOUT, and the Border Router state SHALL revert to the configuration set prior to the fail-safe timer being armed, see ArmFailSafe Command of General Commissioning Cluster in [\[MatterCore\]](#).

After successfully creating or joining a Thread network with the new active dataset, the InterfaceEnabled attribute SHALL be updated to TRUE, indicating that the associated Thread Interface is active and functioning. The ActiveDatasetTimestamp attribute SHALL be updated with the ActiveDataset timestamp. If the Adjacent Infrastructure Link of the Border Router is connected, then the device SHOULD also enable and operate Thread Border Routing functionality using the Thread and Adjacent Infrastructure Link interfaces.

If this command is received during the activation process triggered by a previous SetActiveDatasetRequest command, then the command SHALL fail with a status code of BUSY.

#### 10.3.6.5. SetPendingDatasetRequest Command

This command SHALL be used to set or update the pending Dataset of the Thread network to which the Border Router is connected, if the Border Router supports [PAN Change](#).

If the command is not executed via a CASE session, the command SHALL fail with a status code of UNSUPPORTED\_ACCESS.

Page 820







| ID | Name                   | Type   | Constraint | Quality | Fallback | Conformance |
|----|------------------------|--------|------------|---------|----------|-------------|
| 0  | <b>Pending-Dataset</b> | octstr | max 254    |         |          | M           |

This PendingDataset field SHALL contain the pending dataset to which the Thread network should be updated. The format of the data SHALL be an octet string containing the raw Thread TLV value of the pending dataset, as defined in the [Thread specification](#).

If any of the parameters in the PendingDataset is invalid, the command SHALL fail with a status of `INVALID_COMMAND`.

Otherwise, this command SHALL configure the pending dataset of the Thread network to which the Border Router is connected, with the value given in the PendingDataset parameter. The Border Router will manage activation of the pending dataset as defined in the [Thread specification](#).

## 10.4. Thread Network Directory Cluster

This cluster stores a list of Thread networks (including the credentials required to access each network), as well as a designation of the user's preferred network, to facilitate the sharing of Thread networks across fabrics.

### 10.4.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description      |
|----------|------------------|
| 1        | Initial revision |

### 10.4.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | THNETDIR  |

### 10.4.3. Cluster ID

| ID     | Name                     |
|--------|--------------------------|
| 0x0453 | Thread Network Directory |

### 10.4.4. Data Types

#### 10.4.4.1. ThreadNetworkStruct Type

Represents the data associated with a Thread Network.




Page 821



| ID | Name                     | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>Extended-PanID</b>    | octstr | 8          |         |          |        | M           |
| 1  | <b>Network-Name</b>      | string | 1 to 16    |         |          |        | M           |
| 2  | <b>Channel</b>           | uint16 | all        |         |          |        | M           |
| 3  | <b>Active-Time-stamp</b> | uint64 | all        |         |          |        | M           |

#### 10.4.4.1.1. ExtendedPanID Field

This field SHALL indicate the Extended PAN ID from the OperationalDataset for the given Thread network.

#### 10.4.4.1.2. NetworkName Field

This field SHALL indicate the Network Name from the OperationalDataset for the given Thread network.

#### 10.4.4.1.3. Channel Field

This field SHALL indicate the Channel from the OperationalDataset for the given Thread network.

#### 10.4.4.1.4. ActiveTimestamp Field

This field SHALL indicate the Active Timestamp from the OperationalDataset for the given Thread network.

### 10.4.5. Attributes

| ID     | Name                            | Type                                          | Constraint                  | Quality | Fallback | Access | Conformance |
|--------|---------------------------------|-----------------------------------------------|-----------------------------|---------|----------|--------|-------------|
| 0x0000 | <b>Preferre-dExtendedPanID</b>  | octstr                                        | 8                           | N X     |          | RW VM  | M           |
| 0x0001 | <b>Thread-Networks</b>          | list[ <a href="#">Thread Network-Struct</a> ] | max ThreadNetworkTable-Size | N       |          | R V    | M           |
| 0x0002 | <b>Thread-Network-TableSize</b> | uint8                                         | desc                        | F       |          | R V    | M           |

Page 822







#### 10.4.5.1. PreferredExtendedPanID Attribute

This attribute SHALL represent the Thread Extended PAN ID value for the Thread network designated by the user to be their preferred network for commissioning of Thread devices. If not null, the value of this attribute SHALL match the ExtendedPanID of a network in the ThreadNetworks attribute. A write operation with a non-null value that does not match any network in the ThreadNetworks list SHALL be rejected with a status of CONSTRAINT\_ERROR.

The purpose of designating one Thread network as preferred is to help a commissioner to select a Thread network when a Thread device is within suitable range of more than one Thread network which appears in the ThreadNetworks list. A value of null indicates that there is no current preferred network: All networks MAY be treated as equally preferred by a commissioner with access to this cluster.

This attribute MAY be automatically set to the ExtendedPanID of the first Thread network added to the ThreadNetworks list.

A client SHALL obtain user consent before changing the value of this attribute from a non-null value.

On a factory reset this attribute SHALL be reset to null.

#### 10.4.5.2. ThreadNetworks Attribute

This attribute SHALL indicate the list of Thread Networks known about by this cluster. If the node hosting this cluster includes a Thread Border Router, then an entry for its Thread Network SHALL be included in this list.

The list can be modified via the [AddNetwork](#) and [RemoveNetwork](#) commands.

For each entry in the list, the cluster server also stores a Thread Operational Dataset. Clients use the [GetOperationalDataset](#) command to obtain the Operational Dataset for an entry in this list.

On a factory reset this list SHALL be cleared, and any Thread Operational datasets previously stored SHALL be removed from the Node.

#### 10.4.5.3. ThreadNetworkTableSize Attribute

This attribute SHALL indicate the maximum number of entries that can be held in the ThreadNetworks list; it SHALL be at least 2 times the number of SupportedFabrics advertised in the Operational Credentials Cluster on the root endpoint of this node.

### 10.4.6. Commands

| ID   | Name                          | Direction                   | Response | Access | Conformance |
|------|-------------------------------|-----------------------------|----------|--------|-------------|
| 0x00 | <a href="#">AddNetwork</a>    | client $\Rightarrow$ server | Y        | M T    | M           |
| 0x01 | <a href="#">RemoveNetwork</a> | client $\Rightarrow$ server | Y        | M T    | M           |



Page 823



| ID   | Name                              | Direction                   | Response                   | Access | Conformance |
|------|-----------------------------------|-----------------------------|----------------------------|--------|-------------|
| 0x02 | <b>GetOperationalDataset</b>      | client $\Rightarrow$ server | OperationalDatasetResponse | M      | M           |
| 0x03 | <b>OperationalDatasetResponse</b> | server $\Rightarrow$ client | N                          |        | M           |

#### 10.4.6.1. AddNetwork Command

Adds an entry to the ThreadNetworks attribute with the specified Thread Operational Dataset.

If there is an existing entry with the Extended PAN ID then the Thread Operational Dataset for that entry is replaced. As a result, changes to the network parameters (e.g. Channel, Network Name, PSKc, ...) of an existing entry with a given Extended PAN ID can be made using this command.

| ID | Name                      | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------------------------|--------|------------|---------|----------|-------------|
| 0  | <b>OperationalDataset</b> | octstr | max 254    |         |          | M           |

##### 10.4.6.1.1. OperationalDataset Field

This field SHALL represent the Operational Dataset for the network, using the encoding defined in the [Thread specification](#). It SHALL contain at least the following sub-TLVs: Active Timestamp, Channel, Channel Mask, Extended PAN ID, Network Key, Network Mesh-Local Prefix, Network Name, PAN ID, PSKc, and Security Policy.

##### 10.4.6.1.2. Effect on Receipt

1. If the TLV structure of the Operational Dataset is invalid, or if any of the required sub-TLVs are missing, the command SHALL be rejected with a status of CONSTRAINT\_ERROR. However, inclusion of unknown sub-TLVs SHALL NOT be treated as an error, as future versions of the Thread specification MAY define additional sub-TLVs.
2. If there is an existing ThreadNetworks entry with an Extended PAN ID matching the received dataset, then that entry SHALL be replaced with the received dataset. However, if the received dataset has an Active Timestamp that is less than or equal to that of the existing entry, then the update SHALL be rejected with a status of INVALID\_IN\_STATE.
3. Otherwise, a new entry SHALL be added based on the received dataset. If this would cause the size of the ThreadNetworks list to exceed the ThreadNetworkTableSize, then a RESOURCE\_EXHAUSTED status SHALL be returned.

#### 10.4.6.2. RemoveNetwork Command

Removes the network with the given Extended PAN ID from the ThreadNetworks attribute.

Page 824



| ID | Name           | Type   | Constraint | Quality | Fallback | Conformance |
|----|----------------|--------|------------|---------|----------|-------------|
| 0  | Extended-PanID | octstr | 8          |         |          | M           |

#### 10.4.6.2.1. Effect on Receipt

1. If no network with the given Extended PAN ID exists in the ThreadNetworks attribute, the command SHALL be rejected with a status of NOT\_FOUND.
2. If the given Extended PAN ID matches the PreferredExtendedPanID attribute, the command SHALL be rejected with a status of CONSTRAINT\_ERROR.
3. Otherwise, the network with the matching Extended PAN ID SHALL be removed from the ThreadNetworks attribute.

#### 10.4.6.3. GetOperationalDataset Command

Retrieves the Thread Operational Dataset with the given Extended PAN ID.

| ID | Name           | Type   | Constraint | Quality | Fallback | Conformance |
|----|----------------|--------|------------|---------|----------|-------------|
| 0  | Extended-PanID | octstr | 8          |         |          | M           |

#### 10.4.6.3.1. Effect on Receipt

1. If the command is not executed via a CASE session, the command SHALL be rejected with a status of UNSUPPORTED\_ACCESS.
2. If no network with the given Extended PAN ID exists in the ThreadNetworks attribute, the command SHALL be rejected with a status of NOT\_FOUND.
3. Otherwise, an OperationalDatasetResponse command containing the operational dataset for the requested network SHALL be generated.

#### 10.4.6.4. OperationalDatasetResponse Command

Contains the Thread Operational Dataset for the Extended PAN specified in [GetOperationalDataset](#).

| ID | Name                | Type   | Constraint | Quality | Fallback | Conformance |
|----|---------------------|--------|------------|---------|----------|-------------|
| 0  | Operational-Dataset | octstr | max 254    |         |          | M           |

### 10.4.7. Guidance for Fabrics / Commissioners

This cluster allows fabrics (via their Administrators or Nodes with Manage privilege) to collaboratively share and manage a directory of [ThreadNetworks](#), as well as a designation of one of those



Page 825



networks as the user's preferred network via the [PreferredExtendedPanID](#) attribute.

It is RECOMMENDED that fabrics only interact with instances of this cluster hosted on endpoints that declare a device type that explicitly allows this cluster; currently this includes the Network Infrastructure Manager and Thread Border Router device types. Networks from the ThreadNetworks list of any such directory instance, as well as the Active Dataset made available by any Thread Border Router via the [Thread Border Router Management Cluster](#), SHOULD be considered as potentially available networks.

In determining the user's preferred network, a directory instance on a Network Infrastructure Manager device SHOULD take precedence over other instances. Where a fabric has access to multiple Network Infrastructure Manager devices, it MAY give precedence to the directory instance on the Network Infrastructure Manager device considered to be acting as the primary Internet gateway device for the network.

Due to the sensitive nature of Thread network credentials, it is RECOMMENDED that fabrics obtain user consent before starting to contribute credentials to a particular directory instance. Contributions to a directory instance SHOULD be restricted to those Thread networks that are likely to be reachable from the infrastructure network to which the device hosting that directory is connected.

Page 826







# Chapter 11. Cameras

The Cluster Library is made of individual chapters such as this one. See Document Control in the Cluster Library for a list of all chapters and documents. References between chapters are made using a X.Y notation where X is the chapter and Y is the sub-section within that chapter.

## 11.1. General Description

### 11.1.1. Introduction

The clusters specified in this section are used to set up and control camera devices.

### 11.1.2. Cluster List

This section lists the clusters specified in this document, and gives examples of typical usage for the purpose of clarification.

*Table 18. Clusters Specified in the Camera Functional Domain*

| Cluster ID | Cluster Name                                             | Description                                        |
|------------|----------------------------------------------------------|----------------------------------------------------|
| 0x0551     | <a href="#">Camera AV Stream Management</a>              | Management of Camera AV Streams                    |
| 0x0552     | <a href="#">Camera AV Settings User-Level Management</a> | Management of Camera User-Level AV Settings        |
| 0x0553     | <a href="#">WebRTC Transport Provider</a>                | Camera side of WebRTC                              |
| 0x0554     | <a href="#">WebRTC Transport Requestor</a>               | Viewer side of WebRTC                              |
| 0x0555     | <a href="#">Push AV Stream Transport</a>                 | Setup and use of Push Transport                    |
| 0x0556     | <a href="#">Chime</a>                                    | Selection and playing of preinstalled chime sounds |

### 11.1.3. Data Types

#### 11.1.3.1. StreamUsageEnum Type

This data type is derived from [enum8](#).

This data type provides an enumeration of the different usages of streams supported by the camera. This categorization indicates the use-case of a specific stream and thus factors into its priority in terms of resource allocation by the camera. For example, a Recording stream MAY be given higher priority than a LiveView stream to maintain a higher quality in terms of resolution, bitrate, etc.

| Value | Name            | Summary                | Conformance |
|-------|-----------------|------------------------|-------------|
| 0     | <b>Internal</b> | Internal video stream. | M           |




Page 827



| Value | Name             | Summary                                   | Conformance |
|-------|------------------|-------------------------------------------|-------------|
| 1     | <b>Recording</b> | Stream for recording clips.               | O           |
| 2     | <b>Analysis</b>  | Stream for analysis and entity detection. | O           |
| 3     | <b>LiveView</b>  | Stream for liveview.                      | M           |

#### 11.1.3.1.1. Internal Value

Stream is used for internal purposes, e.g., robotic vacuum using camera for navigation. While the primary use-case for a stream of this usage-type is for an internal purpose, it MAY be re-used for other camera functions, e.g., LiveView. However, this stream SHALL not be modified.

#### 11.1.3.1.2. Recording Value

Stream is used for clip upload and archival.

#### 11.1.3.1.3. Analysis Value

Stream is used for automated audio/video analysis without archival.

#### 11.1.3.1.4. LiveView Value

Stream is used for live watching through client devices.

### 11.1.3.2. ViewportStruct Type

This struct is used to encode a bounding rectangle of the viewport on the image sensor

| ID | Name      | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>X1</b> | uint16 | all        |         |          |        | M           |
| 1  | <b>Y1</b> | uint16 | all        |         |          |        | M           |
| 2  | <b>X2</b> | uint16 | all        |         |          |        | M           |
| 3  | <b>Y2</b> | uint16 | all        |         |          |        | M           |

#### 11.1.3.2.1. X1 Field

This field SHALL represent the position of the starting vertex along the horizontal (x) axis.

#### 11.1.3.2.2. Y1 Field

This field SHALL represent the position of the starting vertex along the vertical (y) axis.

#### 11.1.3.2.3. X2 Field

This field SHALL represent the position of the ending vertex along the horizontal (x) axis.

Page 828







#### 11.1.3.2.4. Y2 Field

This field SHALL represent the position of the ending vertex along the vertical (y) axis.

## 11.2. Camera AV Stream Management Cluster

This cluster is used to allow clients to manage, control, and configure various audio, video, and snapshot streams on a camera. Broadly, this cluster would be used to:

1. Create and manage all streams on the camera.
2. Manage the static and dynamic characteristics of all streams on the camera.
3. Manage settings attributes that are globally applicable across fabrics and controlled by administrators.

### 11.2.1. Lifecycle and Resource Management

#### 11.2.1.1. Stream Lifecycle

It is RECOMMENDED that Commissioners allocate streams when the device is commissioned, based on the expected [Stream Usages](#). Streams would therefore have very long lifetimes and only change if the expected use of the camera would change. Stream allocation is a complex and resource intensive task for devices to perform, and thus should be done as infrequently as possible.

When temporary disabling of streams is needed for things such as geo-fencing, scheduled recordings, alarms, etc; Controllers SHOULD use the [SoftRecordingPrivacyModeEnabled](#) or [SoftLivestreamPrivacyModeEnabled](#) attributes instead of deallocating and reallocating streams.

#### 11.2.1.2. Resource Management and Stream Priorities

Allocated streams require camera resources including but not limited to CPU, memory and network bandwidth. With multiple streams allocated on the camera that can be shared among clients (potentially in different fabrics), management of these resources allocated to the streams and the stream priorities is of critical importance. The camera maintains a [ranked list of stream-usage priorities](#) that SHALL be configurable by an administrator via the [SetStreamPriorities](#) command.

##### 11.2.1.2.1. Stream Sharing and Reuse

Whenever possible, the camera SHOULD attempt to reuse an existing stream when serving to multiple clients. If for a newly requested stream, the parameter requirements around bitrate, framerate, resolution, etc. are the same as an already existing stream, the camera SHALL reuse the existing one. For multiple available closely matching streams, one with an identical StreamUsage as the request SHOULD be selected.

If the video encoder produces a single stream, then the camera would share this stream with all receiving endpoints. However, if the video encoder is capable of producing multiple streams, the camera MAY allocate, for example, a high resolution, high bitrate stream for recording and, lower resolution, lower bitrate streams for real-time viewing on various devices.

Cameras with multiple video encoders can support simultaneous high-quality streams, with each



Page 829



encoder dedicated to a specific stream, allowing for simultaneous recording and live viewing at the highest possible quality.

#### 11.2.1.2.2. Multiple Stream Resource Conflict Resolution

The camera SHOULD utilize the highest resolution and bitrate the network can support for the stream that is at the top of the video stream priority list. For multiple simultaneous liveview clients, the camera MAY automatically adjust the resolution and bitrate while still maintaining a good quality of experience for all viewers.

If the accommodation of a new stream request requires an adjustment of video parameters (resolution, bitrate, etc) for an existing stream, it SHALL abide by the minimum configuration requirements of the existing stream. Otherwise, the new stream request SHALL be rejected with a FAILED notification to the requester.

### 11.2.2. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Rev | Description     |
|-----|-----------------|
| 1   | Initial release |

### 11.2.3. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | AVSM      |

### 11.2.4. Cluster ID

| ID     | Name                        |
|--------|-----------------------------|
| 0x0551 | Camera AV Stream Management |

### 11.2.5. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

*Table 19. Camera AV Stream Management Features*

| Bit | Code | Feature  | Conformance | Description                |
|-----|------|----------|-------------|----------------------------|
| 0   | ADO  | Audio    | O.a+        | Audio Streams supported    |
| 1   | VDO  | Video    | O.a+        | Video Streams supported    |
| 2   | SNP  | Snapshot | O.a+        | Snapshot Streams supported |

Page 830







| Bit | Code  | Feature          | Conformance | Description                  |
|-----|-------|------------------|-------------|------------------------------|
| 3   | PRIV  | Privacy          | 0           | Privacy supported            |
| 4   | SPKR  | Speaker          | [ADO]       | Speaker supported            |
| 5   | ICTL  | ImageControl     | [VDO   SNP] | Image control supported      |
| 6   | WMARK | Watermark        | [VDO   SNP] | Watermark supported          |
| 7   | OSD   | OnScreenDisplay  | [VDO   SNP] | OSD supported                |
| 8   | STOR  | LocalStorage     | 0           | Local Storage available      |
| 9   | HDR   | HighDynamicRange | [VDO   SNP] | High Dynamic Range supported |
| 10  | NV    | NightVision      | [VDO   SNP] | Night Vision mode supported  |

#### 11.2.5.1. Audio Feature

The Audio feature indicates the ability of the node to support audio streams.

#### 11.2.5.2. Video Feature

The Video feature indicates the ability of the node to support video streams. The video streams could be for either live streaming or recording stream transfer, or both.

#### 11.2.5.3. Snapshot Feature

The Snapshot feature indicates the ability of the node to support snapshot streams.

#### 11.2.5.4. Privacy Feature

The Privacy feature indicates the ability of the node to support privacy settings.

#### 11.2.5.5. Speaker Feature

The Speaker feature indicates the ability of the node to support audio playback via a speaker. The Audio feature SHALL be supported if the Speaker feature is supported. Nodes which support this feature SHALL have the ability to perform playback audio mixing in software or hardware.

#### 11.2.5.6. Image Control Feature

The Image Control feature indicates the ability of the node to support Image Control. The Video or Snapshot feature SHALL be supported if the Image Control feature is supported.

#### 11.2.5.7. Watermark Feature

The Watermark feature indicates the ability of the node to apply a manufacturer watermark logo on a video stream.




Page 831



### 11.2.5.8. OnScreenDisplay Feature

The On Screen Display (OSD) feature indicates the ability of the node to display text such as date, time, timezone, and/or device name, etc. for a video stream.

### 11.2.5.9. LocalStorage Feature

The Local Storage feature indicates that this device has the ability to store recordings and/or snapshots on this device itself. While this specification defines the ability to have this feature and enable or disable it only, it does not currently define any way to access or manage this storage.

### 11.2.5.10. HighDynamicRange Feature

The High Dynamic Range feature indicates that the sensor on this device supports operating in High Dynamic Range mode, in addition to a normal operating mode.

### 11.2.5.11. NightVision Feature

The Night Vision feature indicates the ability to operate in a low light environment mode, in addition to a normal operating mode.

## 11.2.6. Data Types

### 11.2.6.1. VideoCodecEnum Type

This data type is derived from `enum8`.

This data type provides an enumeration of the video codecs supported by the camera.

| Value | Name | Summary                                     | Conformance |
|-------|------|---------------------------------------------|-------------|
| 0     | H264 | Advanced Video Coding (H.264) codec.        | M           |
| 1     | HEVC | High efficiency Video Coding (H.265) codec. | O           |
| 2     | VVC  | Versatile Video Coding (H.266) codec.       | O           |
| 3     | AV1  | AOMedia Video 1 codec.                      | O           |

#### 11.2.6.1.1. H264 Value

Advanced Video Coding (AVC) standard, also referred to as MPEG-4 Part 10, is a widely used codec offering good balance of compression and quality.

#### 11.2.6.1.2. HEVC Value

High Efficiency Video Coding, also known as H.265, is a successor to H.264. It offers significantly better compression at the same quality level of its predecessors.

Page 832



#### 11.2.6.1.3. VVC Value

Versatile Video Coding, also known as H.266, is a successor to H.265. It builds upon the capabilities of its predecessors to achieve even more efficient compression.

#### 11.2.6.1.4. AV1 Value

An open-source and royalty-free codec that provides high compression efficiency.

#### 11.2.6.2. AudioCodecEnum Type

This data type is derived from enum8.

This data type provides an enumeration of the audio codecs supported by the camera.

| Value | Name   | Summary                                    | Conformance |
|-------|--------|--------------------------------------------|-------------|
| 0     | OPUS   | Open source IETF standard codec.           | M           |
| 1     | AAC-LC | Advanced Audio Coding codec-Low Complexity | O           |

##### 11.2.6.2.1. OPUS Value

An open-source and royalty-free audio codec that is versatile and designed for both speech and music.

##### 11.2.6.2.2. AAC-LC Value

Proprietary audio codec providing high-quality audio at moderate bit rates that is used widely across different products. AAC-LC is the low-complexity profile of the audio format.

#### 11.2.6.3. ImageCodecEnum Type

This data type is derived from enum8.

This data type provides an enumeration of the image codecs supported by the camera.

| Value | Name | Summary           | Conformance |
|-------|------|-------------------|-------------|
| 0     | JPEG | JPEG image codec. | M           |

##### 11.2.6.3.1. JPEG Value

The JPEG image codec as defined by ITU-T T.81 and ISO/IEC 10918.

#### 11.2.6.4. TwoWayTalkSupportTypeEnum Type

This data type is derived from enum8.

This data type provides an enumeration of the different modes of bi-directional audio communication that are supported by the camera.



Page 833



| Value | Name                | Summary                                  | Conformance |
|-------|---------------------|------------------------------------------|-------------|
| 0     | <b>NotSupported</b> | Two-way Talk support is absent.          | M           |
| 1     | <b>HalfDuplex</b>   | Audio in one direction at a time.        | M           |
| 2     | <b>FullDuplex</b>   | Audio in both directions simultaneously. | M           |

#### 11.2.6.5. TriStateAutoEnum Type

This data type is derived from enum8 and is used for tri-state settings on a device, where a setting can be in one of three states, i.e., On, Off, or Automatic.

| Value | Name        | Summary             | Conformance |
|-------|-------------|---------------------|-------------|
| 0     | <b>Off</b>  | Off                 | M           |
| 1     | <b>On</b>   | On                  | M           |
| 2     | <b>Auto</b> | Automatic Operation | M           |

#### 11.2.6.6. VideoSensorParamsStruct Type

This struct is used to define a video sensor and its characteristics.

| ID | Name                 | Type   | Constraint  | Quality | Fallback | Access | Conformance |
|----|----------------------|--------|-------------|---------|----------|--------|-------------|
| 0  | <b>Sensor-Width</b>  | uint16 | min 64      |         |          |        | M           |
| 1  | <b>Sen-sorHeight</b> | uint16 | min 64      |         |          |        | M           |
| 2  | <b>MaxFPS</b>        | uint16 | min 1       |         |          |        | M           |
| 3  | <b>MaxH-DRFPS</b>    | uint16 | 1 to MaxFPS |         |          |        | HDR         |

##### 11.2.6.6.1. SensorWidth Field

This field SHALL indicate the practical width of the video sensor in pixels. This value is used for various purposes such as resolution control, boundaries for the [Zone Management Cluster](#) and digital Pan/Tilt/Zoom commands in the [Camera AV Settings User Level Management](#).

##### 11.2.6.6.2. SensorHeight Field

This field SHALL indicate the practical height of the video sensor in pixels. This value is used for various purposes such as resolution control, boundaries for the [Zone Management Cluster](#) and digital Pan/Tilt/Zoom commands in the [Camera AV Settings User Level Management](#).

Page 834



#### 11.2.6.6.3. MaxFPS Field

This field SHALL indicate the maximum frame rate, in frames per second, that the video sensor is capable of supporting.

#### 11.2.6.6.4. MaxHDRFPS Field

This field SHALL indicate the maximum frame rate, in frames per second, that the video sensor is capable of supporting when HDR is enabled. The value MAY be less than or equal to the MaxFPS.

#### 11.2.6.7. VideoResolutionStruct Type

This object defines the resolution parameters in pixels which can be used for defining the resolutions of different video streams.

| ID | Name          | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|---------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>Width</b>  | uint16 | min 1      |         |          |        | M           |
| 1  | <b>Height</b> | uint16 | min 1      |         |          |        | M           |

##### 11.2.6.7.1. Width Field

This field SHALL indicate the width, in number of pixels, for a frame.

##### 11.2.6.7.2. Height Field

This field SHALL indicate the height, in number of pixels, for a frame.

#### 11.2.6.8. RateDistortionTradeOffPointsStruct Type

This struct is used to define a set of parameters of the hardware video encoder that alter the rate distortion trade-off points. The points are expressed as the minimum bitrate and resolution for each supported codec type.

| ID | Name              | Type                   | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------|------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Codec</b>      | VideoCodecEnum         | all        |         |          |        | M           |
| 1  | <b>Resolution</b> | VideoResolution-Struct |            |         |          |        | M           |
| 2  | <b>MinBitRate</b> | uint32                 | min 1      |         |          |        | M           |

##### 11.2.6.8.1. Codec Field

This field SHALL indicate the type of video codec based on the supported [VideoCodecEnum](#) types.



Page 835



#### 11.2.6.8.2. Resolution Field

This field SHALL indicate the resolution in pixels for a specific rate distortion trade-off point.

#### 11.2.6.8.3. MinBitRate Field

This field SHALL indicate the minimum bitrate for a specific rate distortion trade-off point expressed as bits per second.

#### 11.2.6.9. SnapshotCapabilitiesStruct Type

This struct is used to define the set of parameters that characterize a snapshot image that is used to build a snapshot stream.

| ID | Name                           | Type                   | Constraint | Quality | Fallback | Access | Conformance                   |
|----|--------------------------------|------------------------|------------|---------|----------|--------|-------------------------------|
| 0  | <b>Resolution</b>              | VideoResolution-Struct |            |         |          |        | M                             |
| 1  | <b>MaxFrameRate</b>            | uint16                 | min 1      |         |          |        | M                             |
| 2  | <b>ImageCodec</b>              | ImageCodecEnum         | all        |         |          |        | M                             |
| 3  | <b>RequiresEncodedPixels</b>   | bool                   | all        |         |          |        | M                             |
| 4  | <b>RequiresHardwareEncoder</b> | bool                   | all        |         |          |        | RequiresEncodedPixels == True |

##### 11.2.6.9.1. Resolution Field

This field SHALL indicate the resolution in pixels of the snapshot image.

##### 11.2.6.9.2. MaxFrameRate Field

This field SHALL indicate the maximum frame rate in frames per second of the snapshot stream.

##### 11.2.6.9.3. ImageCodec Field

This field SHALL indicate the format of the snapshot image, e.g., JPEG, as specified in [ImageCodecEnum](#).

##### 11.2.6.9.4. RequiresEncodedPixels Field

This field SHALL indicate if this entry requires using any resources from the available [MaxEncodedPixelRate](#). If true, clients need to include this entry's Resolution and MaxFrameRate in the calcu-

Page 836







lation for determining overall stream allocation resources.

#### 11.2.6.9.5. RequiresHardwareEncoder Field

This field SHALL indicate if this entry requires using a hardware encoder and thus needs to be considered when determining overall stream allocation resources.

If true, the device requires an encoder from [MaxConcurrentEncoders](#) for this combination of ImageCodec, Resolution, and MaxFrameRate.

If false, the device can produce this combination without needing a dedicated encoder.

This field is only considered if [RequiresEncodedPixels](#) is true.

### 11.2.6.10. AudioCapabilitiesStruct Type

This struct is used to express the audio capabilities of the camera.

| ID   | Name                        | Type                                   | Constraint | Quality | Fallback | Access | Conformance |
|------|-----------------------------|----------------------------------------|------------|---------|----------|--------|-------------|
| 0x00 | <b>MaxNumberOfChannels</b>  | uint8                                  | min 1      |         |          |        | M           |
| 0x01 | <b>SupportedCodecs</b>      | list[ <a href="#">AudioCodecEnum</a> ] | min 1      |         |          |        | M           |
| 0x02 | <b>SupportedSampleRates</b> | list[uint32]                           | min 1      |         |          |        | M           |
| 0x03 | <b>SupportedBitDepths</b>   | list[uint8]                            | min 1      |         |          |        | M           |

#### 11.2.6.10.1. MaxNumberOfChannels Field

This field SHALL indicate the maximum number of channels supported by an audio stream from the camera.

#### 11.2.6.10.2. SupportedCodecs Field

This field SHALL indicate the list of audio codecs from [AudioCodecEnum](#) that are supported by the camera.

#### 11.2.6.10.3. SupportedSampleRates Field

This field SHALL indicate the list of sample rates that are supported by the audio stream from the camera expressed in Hz, e.g., (48000, 32000, 16000).




Page 837



**11.2.6.10.4. SupportedBitDepths Field**

This field SHALL indicate the list of bit depths that are supported by the audio stream, e.g., (16-bit, 24-bit).

**11.2.6.11. VideoStreamStruct Type**

This struct is used to capture all constituent parameters of a video stream in order to fully characterize it.

| ID     | Name                    | Type                   | Constraint        | Quality | Fallback | Access | Conformance |
|--------|-------------------------|------------------------|-------------------|---------|----------|--------|-------------|
| 0x0000 | <b>VideoStreamID</b>    | VideoStreamIDType      | all               |         |          |        | M           |
| 0x0001 | <b>StreamUsage</b>      | StreamUsageEnum        | all               |         |          |        | M           |
| 0x0002 | <b>VideoCodec</b>       | VideoCodecEnum         | all               |         |          |        | M           |
| 0x0003 | <b>MinFrameRate</b>     | uint16                 | 1 to MaxFrameRate |         |          |        | M           |
| 0x0004 | <b>MaxFrameRate</b>     | uint16                 | min 1             |         |          |        | M           |
| 0x0005 | <b>MinResolution</b>    | VideoResolution-Struct |                   |         |          |        | M           |
| 0x0006 | <b>MaxResolution</b>    | VideoResolution-Struct |                   |         |          |        | M           |
| 0x0007 | <b>MinBitRate</b>       | uint32                 | 1 to MaxBitRate   |         |          |        | M           |
| 0x0008 | <b>MaxBitRate</b>       | uint32                 | min 1             |         |          |        | M           |
| 0x0009 | <b>KeyFrameInterval</b> | uint16                 | 0 to 65500        |         |          |        | M           |
| 0x000A | <b>WatermarkEnabled</b> | bool                   | all               |         | 0        |        | WMARK       |
| 0x000B | <b>OSDEnabled</b>       | bool                   | all               |         | 0        |        | OSD         |
| 0x000C | <b>ReferenceCount</b>   | uint8                  | all               |         | 0        |        | M           |

Page 838



**11.2.6.11.1. VideoStreamID Field**

This field SHALL indicate the uniquely allocated identifier for the video stream.

**11.2.6.11.2. StreamUsage Field**

This field SHALL indicate the usage of the stream as described in [StreamUsageEnum](#).

**11.2.6.11.3. VideoCodec Field**

This field SHALL indicate the type of video codec being used by the corresponding video stream as described in [VideoCodecEnum](#).

**11.2.6.11.4. MinFrameRate Field**

This field SHALL indicate the minimum frame rate in frames per second for the corresponding video stream.

**11.2.6.11.5. MaxFrameRate Field**

This field SHALL indicate the maximum frame rate in frames per second for the corresponding video stream.

**11.2.6.11.6. MinResolution Field**

This field SHALL indicate the minimum resolution for the corresponding video stream.

**11.2.6.11.7. MaxResolution Field**

This field SHALL indicate the maximum resolution for the corresponding video stream.

**11.2.6.11.8. MinBitRate Field**

This field SHALL indicate the minimum bitrate for the corresponding video stream in bits per second.

**11.2.6.11.9. MaxBitRate Field**

This field SHALL indicate the maximum bitrate for the corresponding video stream in bits per second.

**11.2.6.11.10. KeyFrameInterval Field**

This field SHALL indicate the duration in milliseconds before a regular key-frame SHALL be generated. A value of 0 SHALL mean that no regular key-frames are generated. When using [push transports](#) with a stream, it is RECOMMENDED to use a value of 4000 (4 seconds). If the value requested does not exactly align with the framerate, then the next frame after the requested value SHALL be a regular key-frame.

**11.2.6.11.11. WatermarkEnabled Field**

This field indicates the status of an applied watermark for the specific video stream. An Enabled value of TRUE means that watermarking has been enabled for that stream.



Page 839



#### 11.2.6.11.12. OSDEnabled Field

This field indicates the status of the OSD (On-Screen Display) for the specific video stream. An Enabled value of TRUE means that OSD has been enabled for that stream.

#### 11.2.6.11.13. ReferenceCount Field

This field SHALL indicate the number of entities currently using this video stream. The node SHALL recompute this field to reflect the correct value at runtime (e.g., when restored from a persisted value after a reboot).

### 11.2.6.12. AudioStreamStruct Type

This struct is used to capture all constituent parameters of an audio stream in order to fully characterize it.

| ID   | Name           | Type              | Constraint    | Quality | Fallback | Access | Conformance |
|------|----------------|-------------------|---------------|---------|----------|--------|-------------|
| 0x00 | AudioStreamID  | AudioStreamIDType | all           |         |          |        | M           |
| 0x01 | StreamUsage    | StreamUsageEnum   | all           |         |          |        | M           |
| 0x02 | AudioCodec     | AudioCodecEnum    | all           |         |          |        | M           |
| 0x03 | ChannelCount   | uint8             | 1 to 8        |         |          |        | M           |
| 0x04 | SampleRate     | uint32            | min 1         |         |          |        | M           |
| 0x05 | BitRate        | uint32            | min 1         |         |          |        | M           |
| 0x06 | BitDepth       | uint8             | 8, 16, 24, 32 |         |          |        | M           |
| 0x07 | ReferenceCount | uint8             | all           |         |          |        | M           |

#### 11.2.6.12.1. AudioStreamID Field

This field SHALL indicate the uniquely allocated identifier for the audio stream.

#### 11.2.6.12.2. StreamUsage Field

This field SHALL indicate the usage of stream as described in [StreamUsageEnum](#).

#### 11.2.6.12.3. AudioCodec Field

This field SHALL indicate the type of audio codec being used by the corresponding audio stream as described in [AudioCodecEnum](#).

Page 840



**11.2.6.12.4. ChannelCount Field**

This field SHALL indicate the number of independent channels or tracks being used by the corresponding audio stream. e.g., 1 for mono, 2 for stereo

**11.2.6.12.5. SampleRate Field**

This field SHALL indicate the audio sample rate, in hertz (Hz).

**11.2.6.12.6. BitRate Field**

This field SHALL indicate the target bit rate in bits per second of the audio stream.

**11.2.6.12.7. BitDepth Field**

This field SHALL indicate the bit depth (8, 16, 24 or 32 bits) of the audio stream. It represents the number of bits of information used to represent each sample of the audio signal, and affects the resolution and dynamic range of the audio.

**11.2.6.12.8. ReferenceCount Field**

This field SHALL indicate the number of entities currently using this audio stream. The node SHALL recompute this field to reflect the correct value at runtime (e.g., when restored from a persisted value after a reboot).

**11.2.6.13. SnapshotStreamStruct Type**

This struct is used to capture all constituent parameters of a snapshot stream in order to fully characterize it.

| ID   | Name                     | Type                                   | Constraint | Quality | Fallback | Access | Conformance |
|------|--------------------------|----------------------------------------|------------|---------|----------|--------|-------------|
| 0x00 | <b>Snapshot-StreamID</b> | <a href="#">Snapshot-StreamID-Type</a> | all        |         |          |        | M           |
| 0x01 | <b>Image-Codec</b>       | <a href="#">Image-Codec-Enum</a>       | all        |         |          |        | M           |
| 0x02 | <b>FrameRate</b>         | uint16                                 | min 1      |         |          |        | M           |
| 0x03 | <b>MinResolution</b>     | <a href="#">VideoResolution-Struct</a> |            |         |          |        | M           |
| 0x04 | <b>MaxResolution</b>     | <a href="#">VideoResolution-Struct</a> |            |         |          |        | M           |
| 0x05 | <b>Quality</b>           | uint8                                  | 1 to 100   |         |          |        | M           |



Page 841



| ID   | Name                    | Type  | Constraint | Quality | Fallback | Access | Conformance |
|------|-------------------------|-------|------------|---------|----------|--------|-------------|
| 0x06 | <b>ReferenceCount</b>   | uint8 | all        |         |          |        | M           |
| 0x07 | <b>EncodedPixels</b>    | bool  | all        |         |          |        | M           |
| 0x08 | <b>HardwareEncoder</b>  | bool  | all        |         |          |        | M           |
| 0x09 | <b>WatermarkEnabled</b> | bool  | all        |         |          |        | WMARK       |
| 0x0A | <b>OSDEnabled</b>       | bool  | all        |         |          |        | OSD         |

#### 11.2.6.13.1. SnapshotStreamID Field

This field SHALL indicate the uniquely allocated identifier for the snapshot stream.

#### 11.2.6.13.2. ImageCodec Field

This field SHALL indicate the type of image codec being used by the corresponding snapshot stream as described in [ImageCodecEnum](#).

#### 11.2.6.13.3. FrameRate Field

This field SHALL indicate the frame rate as frames per second of the snapshot stream.

#### 11.2.6.13.4. MinResolution Field

This field SHALL indicate the minimum resolution for the corresponding snapshot stream.

#### 11.2.6.13.5. MaxResolution Field

This field SHALL indicate the maximum resolution for the corresponding snapshot stream.

#### 11.2.6.13.6. Quality Field

This field SHALL indicate a generic quality metric (integer between 1 and 100) as an input parameter to the image codec. A lower number indicates lower image quality. A higher value indicates higher image quality but larger file size and higher bit rate.

#### 11.2.6.13.7. ReferenceCount Field

This field SHALL indicate the number of entities currently using this snapshot stream. The node SHALL recompute this field to reflect the correct value at runtime (e.g., when restored from a persisted value after a reboot).

Page 842







#### 11.2.6.13.8. EncodedPixels Field

This field SHALL indicate if this entry counts in the [system encoded pixel rate](#) calculation.

This SHALL be true if the [SnapshotCapabilitiesStruct](#) for the selected ImageCodec and MaxResolution has [RequiresEncodedPixels](#) set to true.

#### 11.2.6.13.9. HardwareEncoder Field

This field SHALL indicate if one of the [system hardware encoders](#) is used by this snapshot stream.

This SHALL be true if the [SnapshotCapabilitiesStruct](#) for the selected ImageCodec and MaxResolution has [RequiresHardwareEncoder](#) set to true.

#### 11.2.6.13.10. WatermarkEnabled Field

This field indicates the status of an applied watermark for the specific snapshot stream. A value of TRUE means that watermarking has been enabled for that stream.

#### 11.2.6.13.11. OSDEnabled Field

This field indicates the status of the OSD (On-Screen Display) for the specific snapshot stream. A value of TRUE means that OSD has been enabled for that stream.

### 11.2.6.14. AVMetadataStruct Type

This struct is used to encode the metadata generated by the device and is included by the various transports that handle audio and video streams.

When encoded in TLV binary format and placed inside other standards, this SHALL be represented using the [RFC 8141](#) compliant string `urn:csa:matter:av-metadata`.

| ID   | Name                        | Type                           | Constraint | Quality | Fallback | Access | Conformance |
|------|-----------------------------|--------------------------------|------------|---------|----------|--------|-------------|
| 0x01 | <b>UTCTime</b>              | epoch-us                       | all        | X       |          |        | M           |
| 0x02 | <b>Motion-ZonesActive</b>   | list[ <a href="#">ZoneID</a> ] | min 1      |         |          |        | O           |
| 0x03 | <b>BlackAnd-WhiteActive</b> | bool                           | all        |         |          |        | O           |
| 0x04 | <b>UserDefined</b>          | octstr                         | max 256    |         |          |        | O           |

#### 11.2.6.14.1. UTCTime Field

This field SHALL represent the UTC time that this metadata belongs to. The field is sourced from the Time Synchronization cluster's UTCTime attribute.

If null, the device has no current source of wall clock time.



Page 843



#### 11.2.6.14.2. MotionZonesActive Field

This field SHALL represent the list of Motion Zones that are currently triggered.

#### 11.2.6.14.3. BlackAndWhiteActive Field

This field SHALL indicate if the sensor is currently active in black and white only mode. A value of true means the sensor and video encode process is operating in black and white only mode.

#### 11.2.6.14.4. UserDefined Field

This field SHALL be an octet string representing arbitrary format user defined metadata attached. The [UserDefined Field](#) field of the [ManuallyTriggerTransport](#) command can be used to populate this field. The format and meaning of this field is not defined in this specification and is up to the users, vendors, or ecosystems deploying it.

#### 11.2.6.15. VideoStreamID Type

This data type is derived from uint16 and represents an allocated video stream. This value starts at 0 and monotonically increases by 1 with each new allocation provisioned by the Node. A value incremented past 65534 SHALL wrap to 0. The Node SHALL verify that the incremented ID does not match any other ID. If such a match is found, the ID SHALL be incremented until a unique ID is found.

#### 11.2.6.16. AudioStreamID Type

This data type is derived from uint16 and represents an allocated audio stream. This value starts at 0 and monotonically increases by 1 with each new allocation provisioned by the Node. A value incremented past 65534 SHALL wrap to 0. The Node SHALL verify that the incremented ID does not match any other ID. If such a match is found, the ID SHALL be incremented until a unique ID is found.

#### 11.2.6.17. SnapshotStreamID Type

This data type is derived from uint16 and represents an allocated snapshot stream. This value starts at 0 and monotonically increases by 1 with each new allocation provisioned by the Node. A value incremented past 65534 SHALL wrap to 0. The Node SHALL verify that the incremented ID does not match any other ID. If such a match is found, the ID SHALL be incremented until a unique ID is found.

### 11.2.7. Attributes

*Table 20. Camera AV Stream Management Attributes*

| ID     | Name                         | Type  | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------------|-------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>MaxConcurrentEncoders</b> | uint8 | all        | F       |          | R V    | VDO   SNP   |

Page 844







| ID     | Name                         | Type                                     | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------------|------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0001 | MaxEncodedPixelRate          | uint32                                   | all        | F       |          | RV     | VDO   SNP   |
| 0x0002 | VideoSensorParams            | VideoSensor-ParamsStruct                 | all        | F       |          | RV     | VDO         |
| 0x0003 | NightVisionUsesInfrared      | bool                                     | all        | F       |          | RV     | NV          |
| 0x0004 | MinViewportResolution        | VideoResolution-Struct                   | all        | F       |          | RV     | VDO         |
| 0x0005 | RateDistortionTradeOffPoints | list[RateDistortionTradeOffPointsStruct] | all        | F       |          | RV     | VDO         |
| 0x0006 | MaxContent-BufferSize        | uint32                                   | all        | F       |          | RV     | M           |
| 0x0007 | MicrophoneCapabilities       | AudioCapabilitiesStruct                  | all        | F       |          | RV     | ADO         |
| 0x0008 | SpeakerCapabilities          | AudioCapabilitiesStruct                  | all        | F       |          | RV     | SPKR        |
| 0x0009 | TwoWayTalkSupport            | TwoWayTalkSupportTypeEnum                | all        | F       |          | RV     | SPKR        |
| 0x000A | SnapshotCapabilities         | list[SnapshotCapabilitiesStruct]         | all        | F       |          | RV     | SNP         |
| 0x000B | MaxNetwork-Bandwidth         | uint32                                   | all        | F       |          | RV     | M           |
| 0x000C | CurrentFrameRate             | uint16                                   | all        |         |          | RV     | VDO         |



Page 845



| ID     | Name                              | Type                       | Constraint | Quality | Fallback | Access | Conformance |
|--------|-----------------------------------|----------------------------|------------|---------|----------|--------|-------------|
| 0x000D | HDRModeEnabled                    | bool                       | all        | N       |          | RW M   | HDR         |
| 0x000E | SupportedStreamUsages             | list[StreamUsageEnum]      | all        | F       |          | R V    | M           |
| 0x000F | AllocatedVideoStreams             | list[VideoStreamStruct]    | all        | N       |          | R V    | VDO         |
| 0x0010 | AllocatedAudioStreams             | list[AudioStreamStruct]    | all        | N       |          | R V    | ADO         |
| 0x0011 | AllocatedSnapshotStreams          | list[SnapshotStreamStruct] | all        | N       |          | R V    | SNP         |
| 0x0012 | StreamUsagePriorities             | list[StreamUsageEnum]      | all        | N       |          | R V    | M           |
| 0x0013 | Soft-RecordingPrivacyModeEnabled  | bool                       | all        | N       |          | RW VO  | PRIV        |
| 0x0014 | Soft-LivestreamPrivacyModeEnabled | bool                       | all        | N       |          | RW VO  | PRIV        |
| 0x0015 | HardPrivacyModeOn                 | bool                       | all        |         | 0        | R V    | O           |
| 0x0016 | NightVision                       | TriStateAutoEnum           | all        | N       |          | RW M   | NV          |
| 0x0017 | NightVisionIllum                  | TriStateAutoEnum           | all        | N       |          | RW M   | [NV]        |
| 0x0018 | Viewport                          | ViewportStruct             | all        | N       |          | RW M   | VDO         |
| 0x0019 | SpeakerMuted                      | bool                       | all        | N       |          | RW M   | SPKR        |

Page 846







| ID     | Name                               | Type   | Constraint                                   | Quality | Fallback | Access | Conformance |
|--------|------------------------------------|--------|----------------------------------------------|---------|----------|--------|-------------|
| 0x001A | <b>Speaker-VolumeLevel</b>         | uint8  | Speaker-MinLevel to Speaker-MaxLevel         | N       |          | RW M   | SPKR        |
| 0x001B | <b>Speaker-MaxLevel</b>            | uint8  | Speaker-MinLevel to 254                      |         |          | R M    | SPKR        |
| 0x001C | <b>Speaker-MinLevel</b>            | uint8  | max Speaker-MaxLevel                         |         |          | R M    | SPKR        |
| 0x001D | <b>Micro-phone-Muted</b>           | bool   | all                                          | N       |          | RW M   | ADO         |
| 0x001E | <b>Micro-phoneVolumeLevel</b>      | uint8  | Micro-phone-MinLevel to Micro-phone-MaxLevel | N       |          | RW M   | ADO         |
| 0x001F | <b>Micro-phone-MaxLevel</b>        | uint8  | Micro-phone-MinLevel to 254                  |         |          | R M    | ADO         |
| 0x0020 | <b>Micro-phone-MinLevel</b>        | uint8  | max Micro-phone-MaxLevel                     |         |          | R M    | ADO         |
| 0x0021 | <b>Micro-phoneAGCEnabled</b>       | bool   | all                                          | N       | 1        | RW M   | [ADO]       |
| 0x0022 | <b>ImageRotation</b>               | uint16 | max 359                                      | N       |          | RW M   | [ICTL].b+   |
| 0x0023 | <b>Image-FlipHorizontal</b>        | bool   | all                                          | N       | 0        | RW M   | [ICTL].b+   |
| 0x0024 | <b>Image-FlipVertical</b>          | bool   | all                                          | N       | 0        | RW M   | [ICTL].b+   |
| 0x0025 | <b>LocalVideo-RecordingEnabled</b> | bool   | all                                          | N       |          | RW M   | VDO & STOR  |



Page 847



| ID     | Name                           | Type               | Constraint | Quality | Fallback | Access | Conformance |
|--------|--------------------------------|--------------------|------------|---------|----------|--------|-------------|
| 0x0026 | Local-SnapshotRecordingEnabled | bool               | all        | N       |          | RW M   | SNP & STOR  |
| 0x0027 | Status-LightEnabled            | bool               | all        | N       | 1        | RW M   | O           |
| 0x0028 | Status-Light-Brightness        | ThreeLevelAutoEnum | all        | N       |          | RW M   | O           |

#### 11.2.7.1. MaxConcurrentEncoders Attribute

This attribute SHALL indicate the maximum number of concurrent encoders supported by the camera.

#### 11.2.7.2. MaxEncodedPixelRate Attribute

This attribute SHALL indicate the maximum data rate in encoded pixels per second that the camera can produce given the hardware encoder resources it has. This value is manufacturer specified.

If the camera supports Snapshots and requires hardware encoder resources to produce those Snapshots, then this attribute SHALL be present, and a manufacturer specific value SHALL be present in each [SnapshotCapabilities MaxFrameRate](#) entry that requires hardware resources to produce.

#### 11.2.7.3. VideoSensorParams Attribute

This attribute SHALL indicate the set of video sensor [parameters](#) for the camera. These include the video sensor dimensions, its frame rate and HDR capabilities.

#### 11.2.7.4. NightVisionUsesInfrared Attribute

This attribute SHALL indicate if the night vision mode is infrared based or not. A value of TRUE indicates infrared mode with a cut filter being used. A value of FALSE indicates color is used. When infrared is active and the resulting content is in black and white, the [BlackAndWhiteActive](#) field inside any produced [AVMetadataStruct](#) SHALL be TRUE.

#### 11.2.7.5. MinViewportResolution Attribute

This attribute SHALL indicate the minimum resolution (width and height) in pixels that the camera allows for its viewport.

The choice of the minimum viewport width and height is, typically, directed towards maintaining the best image quality (reduced distortion) for a given size of the video sensor, for different camera functions, e.g., digital zoom. Furthermore, the minimum viewport size and the video sensor size

Page 848



also dictate the upscaling capabilities and requirements of the image processor.

#### **11.2.7.6. RateDistortionTradeOffPoints Attribute**

This attribute SHALL list the set of rate distortion trade-off points between resolution, frame rate and bitrate for each supported hardware encoder.

#### **11.2.7.7. MaxContentBufferSize Attribute**

This attribute SHALL indicate the maximum size of the content buffer in bytes. This buffer holds the compressed and/or raw content for audio/video pre-roll, queued transmissions, the current frame for each snapshot stream, and the metadata context for recording events. For devices which support more than one encoder, the device SHALL evenly allocate this buffer space amongst all streams that utilize pre-roll content such as the [Push AV Stream Transport Cluster](#).

#### **11.2.7.8. MicrophoneCapabilities Attribute**

This attribute SHALL indicate the audio capabilities of the microphone in terms of the codec used, supported sample rates and the number of channels.

#### **11.2.7.9. SpeakerCapabilities Attribute**

This attribute SHALL indicate the audio capabilities of the speaker in terms of the supported codecs, sample rates, and the number of channels when a speaker is present.

#### **11.2.7.10. TwoWayTalkSupport Attribute**

This attribute SHALL indicate the type of two-way talk support the device has, e.g., NotSupported, HalfDuplex, or FullDuplex.

#### **11.2.7.11. SnapshotCapabilities Attribute**

This attribute SHALL indicate the list of supported snapshot capabilities the device has. This list is a set of entries for image codec, resolution, maximum frame rate, hardware encoder, and encoded pixels.

#### **11.2.7.12. MaxNetworkBandwidth Attribute**

This attribute SHALL indicate the maximum network bandwidth in bits per second that the device would consume for the transmission of its media streams.

#### **11.2.7.13. CurrentFrameRate Attribute**

This attribute SHALL indicate the current logical frame rate of the sensor in frames per second.

#### **11.2.7.14. HDRModeEnabled Attribute**

This attribute indicates the currently selected High Dynamic Range (HDR) mode. A value of TRUE indicates that HDR video capturing is enabled. Otherwise, HDR video capturing is disabled.



Page 849



### 11.2.7.15. SupportedStreamUsages Attribute

This attribute SHALL indicate the list of [Stream Usages](#) that are supported by the camera. Manufacturers SHALL provide a usages list that is appropriate to their product. If a usage is found in this list, then it can be used in the [StreamUsagePriorities](#) attribute. The ordering and values of this list SHALL match the values found in [StreamUsagePriorities](#) after a factory reset.

### 11.2.7.16. AllocatedVideoStreams Attribute

This attribute SHALL indicate the list of allocated video streams on the device.

### 11.2.7.17. AllocatedAudioStreams Attribute

This attribute SHALL indicate the list of allocated audio streams on the device.

### 11.2.7.18. AllocatedSnapshotStreams Attribute

This attribute SHALL indicate the list of allocated snapshot streams on the device.

### 11.2.7.19. StreamUsagePriorities Attribute

This attribute SHALL indicate a list of the [video stream usages](#) represented in a ranked order of their priorities, starting with Index 0 having the stream usage type with the highest priority. See [Resource Management and Stream Priorities](#) for further details. Only usages found in the [SupportedStreamUsages](#) attribute can be included. To change the contents, use the [SetStreamPriorities](#) command. Manufacturers SHALL provide a default ranked priorities list that is appropriate to their product and this default ranking SHALL exactly match the contents of [SupportedStreamUsages](#). Clients can use the contents of the [SupportedStreamUsages](#) to restore this default state if the contents have been changed by the [SetStreamPriorities](#) command.

### 11.2.7.20. SoftRecordingPrivacyModeEnabled Attribute

This attribute indicates the current value of the soft privacy mode for transports using the [Stream Usage](#) types [Recording](#) and [Analysis](#). A value of TRUE indicates that delivery of video frames and audio samples from any streams to these transports is skipped. A value of TRUE also indicates that no new transports using these stream usage values can be created or started. When FALSE, these transports can be resumed or started, and have video frames and audio samples delivered.

When this attribute is set to TRUE, any active [WebRTC transports](#) using these stream usage types SHALL terminate the session by calling [End](#) using [WebRTCEndReasonEnum](#) PrivacyMode.

### 11.2.7.21. SoftLivestreamPrivacyModeEnabled Attribute

This attribute indicates the current value of the soft privacy mode for transports using the [Stream Usage](#) type [LiveView](#). A value of TRUE indicates that delivery of video frames and audio samples from any streams to these transports is skipped. A value of TRUE also indicates that no new transports using this stream usage type can be created or started. When FALSE, these transports can be resumed or started, and have video frames and audio samples delivered.

When this attribute is set to TRUE, any active [WebRTC transports](#) using this stream usage type SHALL terminate the session by calling [End](#) using [WebRTCEndReasonEnum](#) PrivacyMode.

Page 850



### 11.2.7.22. HardPrivacyModeOn Attribute

This attribute indicates the current value of the hard privacy mode for all streams. This is controlled via a physical button or switch, potentially. A value of TRUE indicates that all streams are currently paused. When FALSE, the streams MAY resume if they are not already paused by their corresponding soft privacy mode.

### 11.2.7.23. NightVision Attribute

This attribute indicates the currently selected Night Vision mode. A value of Off means the device will never activate its Night Vision mode of operation. A value of On means the Night Vision mode of operation is always active. A value of Auto means the device will automatically move between active and inactive based on the light level it detects.

### 11.2.7.24. NightVisionIllum Attribute

This attribute indicates the currently selected the Night Vision Illumination mode. A value of Off means the device will never activate its built-in Night Vision Illumination. A value of On means the built-in Night Vision Illumination is always active. A value of Auto means the device will automatically enable its built-in Night Vision Illumination based on the light level it detects.

### 11.2.7.25. Viewport Attribute

This attribute SHALL be a [ViewportStruct](#) representing the viewport to apply to all streams.

The coordinate values represent the upper left corner and lower right corner coordinates of the source rectangle on the sensor. The coordinate values are within the two-dimensional Cartesian plane of size [SensorWidth](#) and [SensorHeight](#) (See [VideoSensorParamsStruct](#) in the [VideoSensor-Params](#)) with the origin (0,0) being the upper left corner, positive X and Y values moving right and down across the Cartesian plane respectively, and (SensorWidth, SensorHeight) being the lower right corner.

When changing the Viewport, the aspect ratio of the sensor as indicated in the [VideoSensorParams](#) attribute SHOULD be preserved.

After a factory reset, this SHALL default to {0, 0, SensorWidth, SensorHeight}, using the SensorWidth and SensorHeight fields from the [VideoSensorParams](#) attribute.

When this attribute is changed, all Viewport values found in [DPTZStreams](#) SHALL be updated to the new values set here.

#### 11.2.7.25.1. Example

The following figure shows an example of a 1920x1080 viewport on a 2592x1944 (i.e. 5MP) sensor.



Page 851



![A coordinate system diagram showing a 1920x1080 viewport on a 5MP sensor. The X-axis ranges from 0 to 2591, and the Y-axis ranges from 0 to 1943. A blue rectangle represents the viewport, with its top-left corner at (325, 585) and its bottom-right corner at (2244, 1664). The width of the viewport is labeled as 1920 and the height as 1080.](b57ee06f1431b134d8354fa1edfa9562_img.jpg)

The figure is a 2D coordinate system diagram. The horizontal axis is labeled 'X' at the top, with values 0, X, and 2591. The vertical axis is labeled 'Y' on the left, with values 0, Y, and 1943. A large black rectangle represents the full sensor area. Inside this rectangle, a smaller blue rectangle represents a viewport. The top-left corner of the blue rectangle is labeled with the coordinates (325, 585). The bottom-right corner is labeled with the coordinates (2244, 1664). The width of the blue rectangle is indicated by a horizontal double-headed arrow at the bottom, labeled 1920. The height of the blue rectangle is indicated by a vertical double-headed arrow on the right, labeled 1080.

A coordinate system diagram showing a 1920x1080 viewport on a 5MP sensor. The X-axis ranges from 0 to 2591, and the Y-axis ranges from 0 to 1943. A blue rectangle represents the viewport, with its top-left corner at (325, 585) and its bottom-right corner at (2244, 1664). The width of the viewport is labeled as 1920 and the height as 1080.

Figure 32. Example of a 1920x1080 viewport (colored in blue) on a 5MP sensor.

#### 11.2.7.26. SpeakerMuted Attribute

This attribute indicates whether the speaker is currently muted or not. A value of TRUE indicates that the speaker has been muted and SHALL not play anything. A value of FALSE indicates that the Speaker is enabled.

#### 11.2.7.27. SpeakerVolumeLevel Attribute

This attribute indicates the current volume level of the speaker.

#### 11.2.7.28. SpeakerMaxLevel Attribute

This attribute indicates the maximum value of the SpeakerVolumeLevel that can be assigned.

#### 11.2.7.29. SpeakerMinLevel Attribute

This attribute indicates the minimum value of the SpeakerVolumeLevel that can be assigned.

#### 11.2.7.30. MicrophoneMuted Attribute

This attribute indicates whether the microphone is currently muted or not. A value of TRUE indicates that the microphone has been muted. In this state, the microphone data SHALL be replaced with all 0 bits, representing silence. A value of FALSE indicates that the microphone is On and is capable of transmitting audio.

Page 852



**11.2.7.31. MicrophoneVolumeLevel Attribute**

This attribute indicates the current gain or volume level of the microphone.

**11.2.7.32. MicrophoneMaxLevel Attribute**

This attribute indicates the maximum value of the MicrophoneVolumeLevel that can be assigned.

**11.2.7.33. MicrophoneMinLevel Attribute**

This attribute indicates the minimum value of the MicrophoneVolumeLevel that can be assigned.

**11.2.7.34. MicrophoneAGCEnabled Attribute**

This attribute indicates the currently selected AGC (Automatic Gain Control) mode for the microphone. A value of TRUE indicates that microphone AGC is enabled. Otherwise, it is disabled.

**11.2.7.35. ImageRotation Attribute**

This attribute indicates the amount of clockwise rotation in degrees that the image has been subjected to.

**11.2.7.36. ImageFlipHorizontal Attribute**

This attribute indicates whether the image has been flipped horizontally or not. A value of TRUE indicates that the image has been flipped horizontally.

**11.2.7.37. ImageFlipVertical Attribute**

This attribute indicates whether the image has been flipped vertically or not. A value of TRUE indicates that the image has been flipped vertically.

**11.2.7.38. LocalVideoRecordingEnabled Attribute**

This attribute indicates whether local storage based video recording is enabled. A value of TRUE indicates that local storage based video recording has been enabled.

**11.2.7.39. LocalSnapshotRecordingEnabled Attribute**

This attribute indicates whether local storage based snapshot recording is enabled. A value of TRUE indicates that local storage based snapshot recording has been enabled.

**11.2.7.40. StatusLightEnabled Attribute**

This attribute indicates whether the status light has been enabled or not. A value of TRUE indicates the status light has been enabled. When enabled, the camera MAY use it for visual signaling purposes to indicate various states of the camera.

**11.2.7.41. StatusLightBrightness Attribute**

This attribute indicates the brightness level of the status light.



Page 853



### 11.2.8. Commands

| ID   | Name                                  | Direction       | Response                       | Access | Quality | Conformance         |
|------|---------------------------------------|-----------------|--------------------------------|--------|---------|---------------------|
| 0x00 | <b>AudioStreamAllocate</b>            | client ⇒ server | AudioStreamAllocateResponse    | M      |         | ADO                 |
| 0x01 | <b>AudioStreamAllocateResponse</b>    | server ⇒ client | N                              |        |         | ADO                 |
| 0x02 | <b>AudioStreamDeallocate</b>          | client ⇒ server | Y                              | M      |         | ADO                 |
| 0x03 | <b>VideoStreamAllocate</b>            | client ⇒ server | VideoStreamAllocateResponse    | M      |         | VDO                 |
| 0x04 | <b>VideoStreamAllocateResponse</b>    | server ⇒ client | N                              |        |         | VDO                 |
| 0x05 | <b>VideoStreamModify</b>              | client ⇒ server | Y                              | M      |         | VDO & (WMARK   OSD) |
| 0x06 | <b>VideoStreamDeallocate</b>          | client ⇒ server | Y                              | M      |         | VDO                 |
| 0x07 | <b>SnapshotStreamAllocate</b>         | client ⇒ server | SnapshotStreamAllocateResponse | M      |         | SNP                 |
| 0x08 | <b>SnapshotStreamAllocateResponse</b> | server ⇒ client | N                              |        |         | SNP                 |
| 0x09 | <b>SnapshotStreamModify</b>           | client ⇒ server | Y                              | M      |         | SNP & (WMARK   OSD) |
| 0x0A | <b>SnapshotStreamDeallocate</b>       | client ⇒ server | Y                              | M      |         | SNP                 |
| 0x0B | <b>SetStreamPriorities</b>            | client ⇒ server | Y                              | A      |         | M                   |

Page 854







| ID   | Name                           | Direction                      | Response                | Access | Quality | Conformance |
|------|--------------------------------|--------------------------------|-------------------------|--------|---------|-------------|
| 0x0C | <b>CaptureSnapshot</b>         | client $\Rightarrow$<br>server | CaptureSnapshotResponse | O      | L       | SNP         |
| 0x0D | <b>CaptureSnapshotResponse</b> | server $\Rightarrow$<br>client | N                       |        | L       | SNP         |

### 11.2.8.1. AudioStreamAllocate Command

This command SHALL allocate an audio stream on the camera and return an allocated audio stream identifier.

| ID   | Name                | Type            | Constraint                          | Quality | Fallback | Conformance |
|------|---------------------|-----------------|-------------------------------------|---------|----------|-------------|
| 0x00 | <b>StreamUsage</b>  | StreamUsageEnum | Recording,<br>Analysis,<br>LiveView |         |          | M           |
| 0x01 | <b>AudioCodec</b>   | AudioCodecEnum  | all                                 |         |          | M           |
| 0x02 | <b>ChannelCount</b> | uint8           | 1 to 8                              |         |          | M           |
| 0x03 | <b>SampleRate</b>   | uint32          | min 1                               |         |          | M           |
| 0x04 | <b>BitRate</b>      | uint32          | min 1                               |         |          | M           |
| 0x05 | <b>BitDepth</b>     | uint8           | 8, 16, 24, 32                       |         |          | M           |

#### 11.2.8.1.1. StreamUsage Field

This field SHALL indicate the usage of the stream (Recording, LiveView, etc) that this allocation is for.

#### 11.2.8.1.2. AudioCodec Field

This field SHALL indicate the type of Codec used by the allocated stream.

#### 11.2.8.1.3. ChannelCount Field

This field SHALL indicate the number of channels used by the allocated stream, e.g., Mono (1), Stereo (2), etc.

#### 11.2.8.1.4. SampleRate Field

This field SHALL indicate the sampling rate of the audio stream in Hz. Typical values would be 48000 (48 kHz), 32000 (32 kHz) or 16000 (16 kHz).




Page 855



#### 11.2.8.1.5. BitRate Field

This field SHALL indicate the bitrate of the specified audio codec in bits per second. The default bitrate MAY vary based on the type of device and codec.

#### 11.2.8.1.6. BitDepth Field

This field SHALL indicate the number of bits of information (8, 16, 24 or 32 bits) used to represent each sample of the audio signal.

#### 11.2.8.1.7. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If the requested StreamUsage is not found in the [StreamUsagePriorities](#) attribute:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If an unsupported AudioCodec, ChannelCount, SampleRate, BitRate, or BitDepth is requested:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If there is an existing stream in [AllocatedAudioStreams](#) that matches this request:
  - Return the existing AudioStreamID in [AudioStreamAllocateResponse](#), and end processing with no other side effects.
- If there are not enough resources to allocate a new audio stream:
  - Fail the command with the status code RESOURCE\_EXHAUSTED, and end processing with no other side effects.
- Allocate a new AudioStreamID
- Create and store a new [AudioStreamStruct](#) for the allocated stream mapped against the new AudioStreamID.
- Append the new [AudioStreamStruct](#) to the [AllocatedAudioStreams](#).
- Return the newly allocated AudioStreamID in [AudioStreamAllocateResponse](#).

### 11.2.8.2. AudioStreamAllocateResponse Command

This command SHALL be sent by the camera in response to the AudioStreamAllocate command, carrying the newly allocated or re-used audio stream identifier.

| ID | Name                 | Type                              | Constraint | Quality | Fallback | Conformance |
|----|----------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <b>AudioStreamID</b> | <a href="#">AudioStreamIDType</a> | all        |         |          | M           |

#### 11.2.8.2.1. AudioStreamID Field

The AudioStreamID field SHALL be a [AudioStreamIDType](#) representing the unique audio stream

Page 856



identifier.

### 11.2.8.3. AudioStreamDeallocate Command

This command SHALL deallocate an audio stream on the camera, corresponding to the given audio stream identifier.

| ID | Name          | Type              | Constraint | Quality | Fallback | Conformance |
|----|---------------|-------------------|------------|---------|----------|-------------|
| 0  | AudioStreamID | AudioStreamIDType | all        |         |          | M           |

#### 11.2.8.3.1. AudioStreamID Field

The AudioStreamID field SHALL be a [AudioStreamIDType](#) representing the unique audio stream identifier for the stream that needs to be deallocated.

#### 11.2.8.3.2. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the AudioStreamID does not match an entry in [AllocatedAudioStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the reference count for the stream with AudioStreamID is greater than 0:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If the StreamUsage for the stream with AudioStreamID is [Internal](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- Deallocate the audio stream with AudioStreamID.
- Remove the entry for AudioStreamID from [AllocatedAudioStreams](#).
- Respond with the status code SUCCESS.

### 11.2.8.4. VideoStreamAllocate Command

This command SHALL allocate a video stream on the camera and return an allocated video stream identifier.

| ID   | Name        | Type            | Constraint                          | Quality | Fallback | Conformance |
|------|-------------|-----------------|-------------------------------------|---------|----------|-------------|
| 0x00 | StreamUsage | StreamUsageEnum | Recording,<br>Analysis,<br>LiveView |         |          | M           |




Page 857



| ID   | Name                    | Type                                  | Constraint        | Quality | Fallback | Conformance |
|------|-------------------------|---------------------------------------|-------------------|---------|----------|-------------|
| 0x01 | <b>VideoCodec</b>       | <a href="#">VideoCodecEnum</a>        | all               |         |          | M           |
| 0x02 | <b>MinFrameRate</b>     | uint16                                | 1 to MaxFrameRate |         |          | M           |
| 0x03 | <b>MaxFrameRate</b>     | uint16                                | min 1             |         |          | M           |
| 0x04 | <b>MinResolution</b>    | <a href="#">VideoResolutionStruct</a> |                   |         |          | M           |
| 0x05 | <b>MaxResolution</b>    | <a href="#">VideoResolutionStruct</a> |                   |         |          | M           |
| 0x06 | <b>MinBitRate</b>       | uint32                                | 1 to MaxBitRate   |         |          | M           |
| 0x07 | <b>MaxBitRate</b>       | uint32                                | min 1             |         |          | M           |
| 0x08 | <b>KeyFrameInterval</b> | uint16                                | 0 to 65500        |         |          | M           |
| 0x09 | <b>WatermarkEnabled</b> | bool                                  | all               |         |          | WMARK       |
| 0x0A | <b>OSDEnabled</b>       | bool                                  | all               |         |          | OSD         |

#### 11.2.8.4.1. StreamUsage Field

This field SHALL indicate the usage of the stream (Recording, LiveView, etc) that this allocation is for.

#### 11.2.8.4.2. VideoCodec Field

This field SHALL indicate the type of codec used by the allocated video stream.

#### 11.2.8.4.3. MinFrameRate Field

This field SHALL indicate the minimum frame rate in frames per second of the allocated video stream.

#### 11.2.8.4.4. MaxFrameRate Field

This field SHALL indicate the maximum frame rate in frames per second of the allocated video stream.

#### 11.2.8.4.5. MinResolution Field

This field SHALL indicate the minimum resolution of the allocated video stream.

Page 858



#### 11.2.8.4.6. MaxResolution Field

This field SHALL indicate the maximum resolution of the allocated video stream.

#### 11.2.8.4.7. MinBitRate Field

This field SHALL indicate the minimum bitrate in bits per second of the allocated video stream.

#### 11.2.8.4.8. MaxBitRate Field

This field SHALL indicate the maximum bitrate in bits per second of the allocated video stream.

#### 11.2.8.4.9. KeyFrameInterval Field

This field SHALL indicate the duration in milliseconds before a regular key-frame is generated. See [KeyFrameInterval](#) for further details.

#### 11.2.8.4.10. WatermarkEnabled Field

This field SHALL indicate whether a watermark can be applied on the video stream. A value of TRUE means that watermarking has been enabled for that stream.

#### 11.2.8.4.11. OSDEnabled Field

This field SHALL indicate whether the OSD (On-Screen Display) can be applied on the video stream. A value of TRUE means that OSD has been enabled for that stream.

#### 11.2.8.4.12. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If the requested StreamUsage is not found in the [StreamUsagePriorities](#):
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If an unsupported VideoCodec, MinFrameRate, MaxFrameRate, MinResolution, MaxResolution, MinBitRate, MaxBitRate, or KeyFrameInterval is requested:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If there is an existing stream in [AllocatedVideoStreams](#) that matches this request:
  - Return the existing VideoStreamID in [VideoStreamAllocateResponse](#), and end processing with no other side effects.
- If there are not enough resources to allocate a new video stream:
  - Fail the command with the status code RESOURCE\_EXHAUSTED, and end processing with no other side effects.
- Allocate a new VideoStreamID
- Create and store a new [VideoStreamStruct](#) for the allocated stream mapped against the new VideoStreamID.



Page 859



- Append the new [VideoStreamStruct](#) to the [AllocatedVideoStreams](#).
- If [DigitalPTZ](#) is supported in [Camera AV Settings User Level Management](#):
  - Add a new [DPTZStruct](#) entry in [DPTZStreams](#) using the new VideoStreamID and current value of [Viewport](#).
- Return the newly allocated VideoStreamID in [VideoStreamAllocateResponse](#).

#### 11.2.8.5. VideoStreamAllocateResponse Command

This command SHALL be sent by the camera in response to the VideoStreamAllocate command, carrying the newly allocated or re-used video stream identifier.

| ID | Name                 | Type                              | Constraint | Quality | Fallback | Conformance |
|----|----------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <b>VideoStreamID</b> | <a href="#">VideoStreamIDType</a> | all        |         |          | M           |

##### 11.2.8.5.1. VideoStreamID Field

This field SHALL be a [VideoStreamIDType](#) representing the newly created unique video stream identifier.

#### 11.2.8.6. VideoStreamModify Command

This command SHALL be used to modify a stream specified by the VideoStreamID.

| ID | Name                    | Type                              | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <b>VideoStreamID</b>    | <a href="#">VideoStreamIDType</a> | all        |         |          | M           |
| 1  | <b>WatermarkEnabled</b> | bool                              | all        |         |          | [WMARK].d+  |
| 2  | <b>OSDEnabled</b>       | bool                              | all        |         |          | [OSD].d+    |

##### 11.2.8.6.1. VideoStreamID Field

This field SHALL be a [VideoStreamIDType](#) representing the video stream to modify.

##### 11.2.8.6.2. WatermarkEnabled Field

This field SHALL indicate whether a watermark can be applied on the video stream. A value of TRUE means that watermarking has been requested for that stream. If this field is not present, then no change to the existing value SHALL be made.

##### 11.2.8.6.3. OSDEnabled Field

This field SHALL indicate whether the OSD (On-Screen Display) can be applied on the video stream.

Page 860







A value of TRUE means that OSD has been requested for that stream. If this field is not present, then no change to the existing value SHALL be made.

#### 11.2.8.6.4. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the VideoStreamID does not match an entry in [AllocatedVideoStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the requested change is unable to be made at this time:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If the StreamUsage for the stream with VideoStreamID is [Internal](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- Modify the fields of the video stream corresponding to the included VideoStreamID.
- Respond with the status code SUCCESS.

#### 11.2.8.7. VideoStreamDeallocate Command

This command SHALL deallocate a video stream on the camera, corresponding to the given video stream identifier.

| ID | Name                 | Type                              | Constraint | Quality | Fallback | Conformance |
|----|----------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <b>VideoStreamID</b> | <a href="#">VideoStreamIDType</a> | all        |         |          | M           |

##### 11.2.8.7.1. VideoStreamID Field

This field SHALL be a [VideoStreamIDType](#) for the stream to be deallocated.

#### 11.2.8.7.2. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the VideoStreamID does not match an entry in [AllocatedVideoStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the reference count for the stream with VideoStreamID is greater than 0:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If the StreamUsage for the stream with VideoStreamID is [Internal](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing



Page 861



with no other side effects.

- If [DigitalPTZ](#) is supported in [Camera AV Settings User Level Management](#):
  - Remove the entry for VideoStreamID from [DPTZStreams](#).
- Deallocate the video stream with VideoStreamID.
- Remove the entry for VideoStreamID from [AllocatedVideoStreams](#).
- Respond with the status code SUCCESS.

#### 11.2.8.8. SnapshotStreamAllocate Command

This command SHALL allocate a snapshot stream on the device and return an allocated snapshot stream identifier.

| ID   | Name                    | Type                                  | Constraint | Quality | Fallback | Conformance |
|------|-------------------------|---------------------------------------|------------|---------|----------|-------------|
| 0x00 | <b>ImageCodec</b>       | <a href="#">ImageCodecEnum</a>        | all        |         |          | M           |
| 0x01 | <b>MaxFrameRate</b>     | uint16                                | min 1      |         |          | M           |
| 0x02 | <b>MinResolution</b>    | <a href="#">VideoResolutionStruct</a> |            |         |          | M           |
| 0x03 | <b>MaxResolution</b>    | <a href="#">VideoResolutionStruct</a> |            |         |          | M           |
| 0x04 | <b>Quality</b>          | uint8                                 | 1 to 100   |         |          | M           |
| 0x05 | <b>WatermarkEnabled</b> | bool                                  | all        |         |          | WMARK       |
| 0x06 | <b>OSDEnabled</b>       | bool                                  | all        |         |          | OSD         |

##### 11.2.8.8.1. ImageCodec Field

This field SHALL indicate the type of image codec to be used by the allocated snapshot stream as described in [ImageCodecEnum](#).

##### 11.2.8.8.2. MaxFrameRate Field

This field SHALL indicate the maximum frame rate in frames per second of the allocated snapshot stream.

##### 11.2.8.8.3. MinResolution Field

This field SHALL indicate the minimum resolution of the allocated snapshot stream.

##### 11.2.8.8.4. MaxResolution Field

This field SHALL indicate the maximum resolution of the allocated snapshot stream.

Page 862



#### 11.2.8.8.5. Quality Field

This field SHALL indicate a codec quality metric(integer between 1 and 100) for the allocated snapshot stream.

#### 11.2.8.8.6. WatermarkEnabled Field

This field SHALL indicate whether a watermark can be applied on the snapshot stream. A value of TRUE means that watermarking has been requested for that stream.

This field MAY be ignored if [RequiresHardwareEncoder](#) is FALSE on the matching entry from [SnapshotCapabilities](#). When ignored, the associated WatermarkEnabled entry for the Video Stream that is the source of this snapshot MAY be used.

#### 11.2.8.8.7. OSDEnabled Field

This field SHALL indicate whether the OSD (On-Screen Display) can be applied on the snapshot stream. A value of TRUE means that OSD has been requested for that stream.

This field MAY be ignored if [RequiresHardwareEncoder](#) is FALSE on the matching entry from [SnapshotCapabilities](#). When ignored, the associated OSDEnabled entry for the Video Stream that is the source of this snapshot MAY be used.

#### 11.2.8.8.8. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If an unsupported ImageCodec, MaxFrameRate, MinResolution, MaxResolution, or Quality is requested:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If there is an existing stream in [AllocatedSnapshotStreams](#) that matches this request:
  - Return the existing SnapshotStreamID in [SnapshotStreamAllocateResponse](#), and end processing with no other side effects.
- If there are not enough resources to allocate a new snapshot stream:
  - Fail the command with the status code RESOURCE\_EXHAUSTED, and end processing with no other side effects.
- Allocate a new SnapshotStreamID
- Create and store a new [SnapshotStreamStruct](#) for the allocated stream mapped against the new SnapshotStreamID.
- Append the new [SnapshotStreamStruct](#) to the [AllocatedSnapshotStreams](#).
- Return the newly allocated SnapshotStreamID in [SnapshotStreamAllocateResponse](#).

#### 11.2.8.9. SnapshotStreamAllocateResponse Command

This command SHALL be sent by the device in response to the SnapshotStreamAllocate command, carrying the newly allocated or re-used snapshot stream identifier.



Page 863



| ID | Name                            | Type                                   | Constraint | Quality | Fallback | Conformance |
|----|---------------------------------|----------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Snapsho<b>t</b>-StreamID</b> | <a href="#">Snapshot-StreamID-Type</a> | all        |         |          | M           |

#### 11.2.8.9.1. SnapshotStreamID Field

The SnapshotStreamID field SHALL be an unsigned 16 bit integer representing the unique snapshot stream identifier.

#### 11.2.8.10. SnapshotStreamDeallocate Command

This command SHALL deallocate an snapshot stream on the camera, corresponding to the given snapshot stream identifier.

| ID | Name                            | Type                                   | Constraint | Quality | Fallback | Conformance |
|----|---------------------------------|----------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Snapsho<b>t</b>-StreamID</b> | <a href="#">Snapshot-StreamID-Type</a> | all        |         |          | M           |

##### 11.2.8.10.1. SnapshotStreamID Field

The SnapshotStreamID field SHALL be an unsigned 16 bit integer representing the unique snapshot stream identifier for the stream that needs to be deallocated.

##### 11.2.8.10.2. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the SnapshotStreamID does not match an entry in [AllocatedSnapshotStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the reference count for the stream with SnapshotStreamID is greater than 0:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- Deallocate the snapshot stream with SnapshotStreamID.
- Remove the entry for SnapshotStreamID from [AllocatedSnapshotStreams](#).
- Respond with the status code SUCCESS.

#### 11.2.8.11. SnapshotStreamModify Command

This command SHALL be used to modify a stream specified by the VideoStreamID.

Page 864







| ID | Name                                 | Type                                             | Constraint | Quality | Fallback | Conformance |
|----|--------------------------------------|--------------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Snapsho<b>t</b>-<br/>StreamID</b> | <a href="#">Snapshot-<br/>StreamID-<br/>Type</a> | all        |         |          | M           |
| 1  | <b>Water-<br/>markEn-<br/>abled</b>  | bool                                             | all        |         |          | [WMARK].d+  |
| 2  | <b>OSD<b>E</b>nabled</b>             | bool                                             | all        |         |          | [OSD].d+    |

#### 11.2.8.11.1. SnapshotStreamID Field

This field SHALL be a [SnapshotStreamIDType](#) representing the snapshot stream to modify.

#### 11.2.8.11.2. WatermarkEnabled Field

This field SHALL indicate whether a watermark can be applied on the video stream. A value of TRUE means that watermarking has been requested for that stream.

If this field is not present, then no change to the existing value SHALL be made.

#### 11.2.8.11.3. OSD**E**nabled Field

This field SHALL indicate whether the OSD (On-Screen Display) can be applied on the video stream. A value of TRUE means that OSD has been requested for that stream.

If this field is not present, then no change to the existing value SHALL be made.

#### 11.2.8.11.4. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the SnapshotStreamID does not match an entry in [AllocatedSnapshotStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the [RequiresHardwareEncoder](#) is FALSE on the matching entry from [SnapshotCapabilities](#)
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If the requested change is unable to be made at this time:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- Modify the fields of the snapshot stream corresponding to the included SnapshotStreamID.
- Respond with the status code SUCCESS.




Page 865



### 11.2.8.12. SetStreamPriorities Command

This command SHALL set the relative priorities of the various [stream usages](#) on the camera. The camera then bases its allocation of resources for each stream allocation based on the order of these stream priorities. In order to avoid the complexity of dynamically changing the configurations of currently active streams, this command SHALL NOT be invoked when there are allocated streams. If changes are required while streams are allocated, all existing streams would need to be deallocated before invoking this command.

| ID | Name                    | Type                  | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|-----------------------|------------|---------|----------|-------------|
| 0  | <b>StreamPriorities</b> | list[StreamUsageEnum] | desc       |         |          | M           |

#### 11.2.8.12.1. StreamPriorities Field

The StreamPriorities field SHALL contain a list of stream usages in decreasing order of stream priorities, starting at index 0 of the list, with no duplicate values allowed, and only containing entries found in [SupportedStreamUsages](#).

#### 11.2.8.12.2. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If there are any entries in [AllocatedSnapshotStreams](#), [AllocatedVideoStreams](#), or [AllocatedAudioStreams](#):
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If any requested value in StreamPriorities is not found in [SupportedStreamUsages](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If there are duplicate stream usages in StreamPriorities field:
  - Fail the command with the status code ALREADY\_EXISTS, and end processing with no other side effects.
- Update the [StreamUsagePriorities](#) attribute with the contents of StreamPriorities.

### 11.2.8.13. CaptureSnapshot Command

This command SHALL return a Snapshot from the camera.

| ID | Name                     | Type                   | Constraint | Quality | Fallback | Conformance |
|----|--------------------------|------------------------|------------|---------|----------|-------------|
| 0  | <b>Snapshot-StreamID</b> | Snapshot-StreamID-Type | all        | X       |          | M           |

Page 866







| ID | Name                       | Type                                  | Constraint | Quality | Fallback | Conformance |
|----|----------------------------|---------------------------------------|------------|---------|----------|-------------|
| 1  | <b>RequestedResolution</b> | <a href="#">VideoResolutionStruct</a> |            |         |          | M           |

#### 11.2.8.13.1. SnapshotStreamID Field

The SnapshotStreamID field SHALL be a [SnapshotStreamIDType](#) representing the allocated Snapshot Stream to use, or null to allow automatic stream selection.

#### 11.2.8.13.2. RequestedResolution Field

The RequestedResolution field SHALL be a [VideoResolutionStruct](#) representing the preferred resolution of the snapshot.

#### 11.2.8.13.3. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If there are no entries in [AllocatedSnapshotStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the SnapshotStreamID is not null, and does not match an entry in [AllocatedSnapshotStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If either [SoftLivestreamPrivacyModeEnabled](#) or [HardPrivacyModeOn](#) is true:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If the SnapshotStreamID is null:
  - Use the closest existing snapshot stream that is greater than or equal to the RequestedResolution size.
  - If there are no allocated streams greater than or equal to the RequestedResolution:
    - Use the stream with the closest possible resolution.
- If the requested size is smaller than the stream's native size, and there are available resources to downscale:
  - Downscale the stream's snapshot to the RequestedResolution size.
- Return the snapshot in the corresponding [CaptureSnapshotResponse](#) command.

#### 11.2.8.14. CaptureSnapshotResponse Command

This command SHALL be sent by the device in response to the CaptureSnapshot command, carrying the requested snapshot.




Page 867



| ID | Name       | Type                  | Constraint | Quality | Fallback | Conformance |
|----|------------|-----------------------|------------|---------|----------|-------------|
| 0  | Data       | octstr                |            |         |          | M           |
| 1  | ImageCodec | ImageCodecEnum        | all        |         |          | M           |
| 2  | Resolution | VideoResolutionStruct |            |         |          | M           |

#### 11.2.8.14.1. Data Field

The Data field SHALL be an octet string representing the image data.

#### 11.2.8.14.2. ImageCodec Field

The ImageCodec field SHALL be an [ImageCodecEnum](#) representing the codec used to encode the image. This SHALL match the value found in the corresponding allocated snapshot stream and is provided for convenience.

#### 11.2.8.14.3. Resolution Field

The Resolution field SHALL be a [VideoResolutionStruct](#) representing the resolution of the supplied image.

## 11.3. Camera AV Settings User Level Management

This cluster provides an interface into controls associated with the operation of a camera that provides pan, tilt, and zoom functions, either mechanically, or against a digital image.

### 11.3.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Rev | Description     |
|-----|-----------------|
| 1   | Initial release |

### 11.3.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | AVSUM     |

### 11.3.3. Cluster ID

| ID     | Name                                     |
|--------|------------------------------------------|
| 0x0552 | Camera AV Settings User Level Management |

Page 868



### 11.3.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

*Table 21. Camera AV Settings User Level Management Features*

| Bit | Code     | Feature           | Conformance            | Summary                          |
|-----|----------|-------------------|------------------------|----------------------------------|
| 0   | DPTZ     | DigitalPTZ        | O.a+                   | Digital PTZ support              |
| 1   | MPAN     | MechanicalPan     | O.a+                   | Mechanical Pan support           |
| 2   | MTILT    | MechanicalTilt    | O.a+                   | Mechanical Tilt support          |
| 3   | MZOOM    | MechanicalZoom    | O.a+                   | Mechanical Zoom support          |
| 4   | MPRESETS | MechanicalPresets | [MPAN   MTILT   MZOOM] | Mechanical saved presets support |

#### 11.3.4.1. DigitalPTZ Feature

This feature indicates that per video stream digital pan, tilt, and zoom is supported.

#### 11.3.4.2. MechanicalPan Feature

This feature indicates that mechanical pan is supported on the camera.

#### 11.3.4.3. MechanicalTilt Feature

This feature indicates that mechanical tilt is supported on the camera.

#### 11.3.4.4. MechanicalZoom Feature

This feature indicates that mechanical zoom is supported on the camera.

#### 11.3.4.5. MechanicalPresets Feature

This feature indicates that the storage of presets is supported on the camera.

### 11.3.5. Data Types

#### 11.3.5.1. PhysicalMovementEnum Type

This data type is derived from enum8.

The PhysicalMovementEnum provides an enumeration of the possible physical movement states in which the camera could be.




Page 869



| Value | Name          | Summary                                                        | Conformance |
|-------|---------------|----------------------------------------------------------------|-------------|
| 0     | <b>Idle</b>   | The camera is idle.                                            | M           |
| 1     | <b>Moving</b> | The camera is moving to a new value of Pan, Tilt, and/or Zoom. | M           |

#### 11.3.5.1.1. Idle Value

The camera is idle, there is no movement active.

#### 11.3.5.1.2. Moving Value

The camera is moving to a new value of Pan, Tilt, and/or Zoom as a result of the reception of a command that changes one or more of these values.

#### 11.3.5.2. DPTZStruct Type

This type is used to indicate support for the per stream digital pan, tilt, and zoom values.

| ID | Name                 | Type              | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------------|-------------------|------------|---------|----------|--------|-------------|
| 0  | <b>VideoStreamID</b> | VideoStreamIDType | all        |         |          |        | M           |
| 1  | <b>Viewport</b>      | Viewport-Struct   | all        |         |          |        | M           |

##### 11.3.5.2.1. VideoStreamID Field

This field SHALL indicate the video stream this applies to.

##### 11.3.5.2.2. Viewport Field

This field SHALL indicate the per stream viewport applied to this video stream. See [Viewport](#) for details on the coordinate system.

#### 11.3.5.3. MPTZStruct Type

This type is used to indicate the mechanical pan, tilt, and zoom values.

| ID | Name        | Type  | Constraint         | Quality | Fallback | Access | Conformance |
|----|-------------|-------|--------------------|---------|----------|--------|-------------|
| 0  | <b>Pan</b>  | int16 | PanMin to PanMax   |         |          |        | MPAN        |
| 1  | <b>Tilt</b> | int16 | TiltMin to TiltMax |         |          |        | MTILT       |
| 2  | <b>Zoom</b> | uint8 | 1 to Zoom-Max      |         |          |        | MZOOM       |

Page 870



#### 11.3.5.3.1. Pan Field

This field SHALL indicate the mechanical pan value in angular degrees of angle. A zero value SHALL indicate the home position horizontal reference for the direction of view of the camera. A negative value SHALL indicate a leftward rotation of the camera about the vertical axis of the camera coordinate system. A positive value SHALL indicate a rightward rotation of the camera about the vertical axis of the camera coordinate system.

#### 11.3.5.3.2. Tilt Field

This field SHALL indicate the mechanical tilt value in angular degrees of angle. A zero value SHALL indicate a vertical reference for the direction of view of the camera. A negative value SHALL indicate a downward rotation of the camera about the horizontal axis of the camera coordinate system. A positive value SHALL indicate an upward rotation of the camera about the horizontal axis of the camera coordinate system.

#### 11.3.5.3.3. Zoom Field

This field SHALL indicate the zoom value to use. A value of 1 SHALL indicate the widest possible optical field of view. A value of ZoomMax SHALL indicate the narrowest possible field of optical view.

### 11.3.5.4. MPTZPresetStruct Type

This type is used to save a preset location for mechanical pan, tilt and zoom.

| ID | Name            | Type       | Constraint      | Quality | Fallback | Access | Conformance |
|----|-----------------|------------|-----------------|---------|----------|--------|-------------|
| 0  | <b>PresetID</b> | uint8      | 1 to MaxPresets |         |          |        | M           |
| 1  | <b>Name</b>     | string     | max 32          |         |          |        | M           |
| 2  | <b>Settings</b> | MPTZStruct |                 |         |          |        | M           |

#### 11.3.5.4.1. PresetID Field

This SHALL be derived from uint8 and represents the ID for a saved set of preset values for mechanical pan, tilt and zoom.

#### 11.3.5.4.2. Name Field

The SHALL be a string representing the name of the Preset.

#### 11.3.5.4.3. Settings Field

This SHALL hold the mechanical pan, tilt and zoom values.



Page 871



### 11.3.6. Attributes

Table 22. Camera AV Settings User Level Management Attributes

| ID | Name                 | Type                                      | Constraint     | Quality | Fallback | Access | Conformance                |
|----|----------------------|-------------------------------------------|----------------|---------|----------|--------|----------------------------|
| 0  | <b>MPTZPosition</b>  | <a href="#">MPTZStruct</a>                | all            | N       |          | R V    | MPAN  <br>MTILT  <br>MZOOM |
| 1  | <b>MaxPresets</b>    | uint8                                     | all            | F       |          | R V    | MPRESETS                   |
| 2  | <b>MPTZPresets</b>   | list[ <a href="#">MPTZPresetsStruct</a> ] | max MaxPresets | N       |          | R V    | MPRESETS                   |
| 3  | <b>DPTZStreams</b>   | list[ <a href="#">DPTZStream</a> ]        | all            | N       |          | R V    | DPTZ                       |
| 4  | <b>ZoomMax</b>       | uint8                                     | 2 to 100       |         |          | R V    | MZOOM                      |
| 5  | <b>TiltMin</b>       | int16                                     | -180 to 179    |         |          | R V    | MTILT                      |
| 6  | <b>TiltMax</b>       | int16                                     | -179 to 180    |         |          | R V    | MTILT                      |
| 7  | <b>PanMin</b>        | int16                                     | -180 to 179    |         |          | R V    | MPAN                       |
| 8  | <b>PanMax</b>        | int16                                     | -179 to 180    |         |          | R V    | MPAN                       |
| 9  | <b>MovementState</b> | <a href="#">Physical-MovementEnum</a>     | all            |         |          | R V    | MPAN  <br>MTILT  <br>MZOOM |

#### 11.3.6.1. MPTZPosition Attribute

This attribute indicates the currently selected mechanical pan, tilt, and zoom position.

#### 11.3.6.2. MaxPresets Attribute

This attribute indicates the maximum number of presets for the mechanical pan, tilt, zoom.

#### 11.3.6.3. MPTZPresets Attribute

This attribute SHALL be a list of [MPTZPresetStruct](#). Each entry in the list contains a preset for mechanical pan, tilt, and/or zoom, the values for which are represented by an instance of an [MPTZStruct](#).

#### 11.3.6.4. DPTZStreams Attribute

This attribute is a list of [DPTZStream](#). If a video stream is listed, it means digital movement is supported via [DPTZSetViewport](#) or [DPTZRelativeMove](#). The initial values for each Viewport entry SHALL be the values found in the global [Viewport](#).

Page 872



#### 11.3.6.5. ZoomMax Attribute

This attribute SHALL indicate the maximum value for the mechanical zoom specified by the camera manufacturer that allows for increments of 1 to be noticeable. The handling of this value is implementation specific.

#### 11.3.6.6. TiltMin Attribute

This attribute SHALL indicate the minimum value for the mechanical tilt specified by the camera manufacturer in angular degrees.

#### 11.3.6.7. TiltMax Attribute

This attribute SHALL indicate the maximum value for the mechanical tilt specified by the camera manufacturer in angular degrees.

#### 11.3.6.8. PanMin Attribute

This attribute SHALL indicate the minimum value for the mechanical pan specified by the camera manufacturer in angular degrees.

#### 11.3.6.9. PanMax Attribute

This attribute SHALL indicate the maximum value for the mechanical pan specified by the camera manufacturer in angular degrees.

#### 11.3.6.10. MovementState Attribute

This attribute SHALL indicate the current movement state of the camera.

### 11.3.7. Commands

| ID | Name             | Direction                   | Response | Access | Conformance          |
|----|------------------|-----------------------------|----------|--------|----------------------|
| 0  | MPTZSetPosition  | client $\Rightarrow$ server | Y        | 0      | MPAN   MTILT   MZOOM |
| 1  | MPTZRelativeMove | client $\Rightarrow$ server | Y        | 0      | MPAN   MTILT   MZOOM |
| 2  | MPTZMoveToPreset | client $\Rightarrow$ server | Y        | 0      | MPRESETS             |
| 3  | MPTZSavePreset   | client $\Rightarrow$ server | Y        | 0      | MPRESETS             |
| 4  | MPTZRemovePreset | client $\Rightarrow$ server | Y        | 0      | MPRESETS             |
| 5  | DPTZSetViewport  | client $\Rightarrow$ server | Y        | 0      | DPTZ                 |
| 6  | DPTZRelativeMove | client $\Rightarrow$ server | Y        | 0      | [DPTZ]               |



Page 873



### 11.3.7.1. MPTZSetPosition Command

This command SHALL move the camera to the provided values for pan, tilt, and zoom in the mechanical PTZ. The data for this command SHALL be as follows:

| ID | Name        | Type  | Constraint         | Quality | Fallback | Conformance |
|----|-------------|-------|--------------------|---------|----------|-------------|
| 0  | <b>Pan</b>  | int16 | PanMin to PanMax   |         |          | [MPAN].b+   |
| 1  | <b>Tilt</b> | int16 | TiltMin to TiltMax |         |          | [MTILT].b+  |
| 2  | <b>Zoom</b> | uint8 | 1 to Zoom-Max      |         |          | [MZOOM].b+  |

#### 11.3.7.1.1. Pan Field

This field SHALL indicate the absolute pan value in angular degrees.

#### 11.3.7.1.2. Tilt Field

This field SHALL indicate the absolute tilt value in angular degrees.

#### 11.3.7.1.3. Zoom Field

This field SHALL indicate the absolute zoom value.

#### 11.3.7.1.4. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the camera is already engaged in a command that results in a physical move, or if the camera is otherwise unable to apply the changes at the time of receipt:
  - Fail the command with the status code BUSY, and end processing with no other side effects.
- Initiate movement of the camera to the new values of Pan, Tilt, or Zoom.
- Set `MovementState` to `Moving`.
- Respond with the status code SUCCESS.
- Once the camera has completed the physical movement to the target values:
  - Set `MovementState` to `Idle`.
  - Update the values in `MptzPosition` to the values as received. Any values that are not present in this command's fields SHALL NOT be modified.

### 11.3.7.2. MPTZRelativeMove Command

This command SHALL move the camera by the delta values relative to the currently defined position. The data for this command SHALL be as follows:

Page 874



| ID | Name             | Type  | Constraint                                        | Quality | Fallback | Conformance |
|----|------------------|-------|---------------------------------------------------|---------|----------|-------------|
| 0  | <b>PanDelta</b>  | int16 | (-1 * (PanMax - PanMin)) to (PanMax - PanMin)     |         | 0        | [MPAN].c+   |
| 1  | <b>TiltDelta</b> | int16 | (-1 * (TiltMax - TiltMin)) to (TiltMax - TiltMin) |         | 0        | [MTILT].c+  |
| 2  | <b>ZoomDelta</b> | int8  | (-1 * (ZoomMax - 1)) to (ZoomMax - 1)             |         | 0        | [MZOOM].c+  |

#### 11.3.7.2.1. PanDelta Field

This field SHALL indicate the change in the pan value in degrees relative to the current location. A value of 0 means no movement. A negative value means move left. A positive value means move right.

#### 11.3.7.2.2. TiltDelta Field

This field SHALL indicate the change in the tilt value in degrees relative to the current location. A value of 0 means no movement. A negative value means move down. A positive value means move up.

#### 11.3.7.2.3. ZoomDelta Field

This field SHALL indicate the percentage change in the zoom value relative to the current zoom value on the camera. A value of 0 means no change. A negative value means zoom out. A positive value means zoom in.

#### 11.3.7.2.4. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the camera is already engaged in a command that results in a physical move, or if the camera is otherwise unable to apply the changes at this time:
  - Fail the command with the status code BUSY, and end processing with no other side effects.
- If PanDelta is present:
  - Add PanDelta to the Pan value in MptzPosition and clip the resulting value to be between PanMin and PanMax, inclusive.
- If TiltDelta is present:
  - Add TiltDelta to the Tilt value in MptzPosition and clip the resulting value to be between Tilt-




Page 875



Min and TiltMax, inclusive.

- If ZoomDelta is present:
  - Add ZoomDelta to the Zoom value in MptzPosition and clip the resulting value to be between 1 and ZoomMax, inclusive.
- Initiate movement of the camera to the new values of Pan, Tilt, or Zoom.
- Set [MovementState](#) to [Moving](#).
- Respond with the status code SUCCESS.
- Once the camera has completed the physical movement to the target values:
  - Set [MovementState](#) to [Idle](#).
  - Update the values in [MptzPosition](#) to the new values of Pan, Tilt, and Zoom.

### 11.3.7.3. MPTZMoveToPreset Command

This command SHALL move the camera to the positions specified by the Preset passed. The data for this command SHALL be as follows:

| ID | Name            | Type  | Constraint      | Quality | Fallback | Conformance |
|----|-----------------|-------|-----------------|---------|----------|-------------|
| 0  | <b>PresetID</b> | uint8 | 1 to MaxPresets |         |          | M           |

#### 11.3.7.3.1. PresetID Field

This field SHALL match the PresetID of an entry in [MptzPresets](#).

#### 11.3.7.3.2. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the provided PresetID does not match an entry in [MptzPresets](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the camera is already engaged in a command that results in a physical move, or if the camera is otherwise unable to apply new Pan, Tilt, or Zoom values:
  - Fail the command with the status code BUSY, and end processing with no other side effects.
- Initiate movement of the camera to the applicable values for Pan, Tilt, and Zoom found in the entry identified by the provided PresetID.
- Set [MovementState](#) to [Moving](#).
- Respond with the status code SUCCESS.
- Once the camera has completed the physical movement to the target values:
  - Set [MovementState](#) to [Idle](#).
  - Update the values in [MptzPosition](#) to the new values for Pan, Tilt, and Zoom as obtained

Page 876







from the provided PresetID prior to the initiation of movement of the camera.

#### 11.3.7.4. MPTZSavePreset Command

This command allows creating a new preset or updating the values of an existing one. The data for this command SHALL be as follows:

| ID | Name            | Type   | Constraint      | Quality | Fallback | Conformance |
|----|-----------------|--------|-----------------|---------|----------|-------------|
| 0  | <b>PresetID</b> | uint8  | 1 to MaxPresets |         |          | O           |
| 1  | <b>Name</b>     | string | max 32          |         |          | M           |

##### 11.3.7.4.1. PresetID Field

This field SHALL indicate the ID of an entry in [MptzPresets](#).

##### 11.3.7.4.2. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the PresetID field is not present:
  - If the size of [MptzPresets](#) is greater than or equal to [MaxPresets](#):
    - Fail the command with the status code RESOURCE\_EXHAUSTED, and end processing with no other side effects.
  - Generate a new PresetID value. This value starts at 1 and monotonically increases by 1 with each new saved preset.
  - A value incremented past [MaxPresets](#) wraps to 1.
  - The camera verifies that the incremented ID does not match any other ID. If such a match is found:
    - The ID is incremented until a unique ID is found, wrapping to 1 if the value equals [MaxPresets](#).
  - Create a new entry in [MptzPresets](#) using the new PresetID, the provided Name field, and the current values of [MptzPosition](#).
- Else:
  - If the PresetID matches an existing entry in [MptzPresets](#):
    - Update that entry using the provided Name field and the current values of [MptzPosition](#).
  - Else:
    - If the size of [MptzPresets](#) is greater than or equal to [MaxPresets](#):
      - Fail the command with the status code RESOURCE\_EXHAUSTED, and end processing with no other side effects.
    - Create a new entry in [MptzPresets](#) using the provided PresetID, the provided Name field, and the current values of [MptzPosition](#).



Page 877



- Respond with the status code SUCCESS.

### 11.3.7.5. MPTZRemovePreset Command

This command SHALL remove a preset entry from the `PresetMptzTable`. The data for this command SHALL be as follows:

| ID | Name            | Type  | Constraint      | Quality | Fallback | Conformance |
|----|-----------------|-------|-----------------|---------|----------|-------------|
| 0  | <b>PresetID</b> | uint8 | 1 to MaxPresets |         |          | M           |

#### 11.3.7.5.1. PresetID Field

This field SHALL indicate the ID of an entry in `MptzPresets`.

#### 11.3.7.5.2. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If the PresetID does not exist in `MptzPresets`:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- Remove the entry for the provided PresetID from `MptzPresets`.
- Respond with the status code SUCCESS

### 11.3.7.6. DPTZSetViewport Command

This command allows for setting the digital viewport for a specific Video Stream. This command is a per-stream version of the `Viewport Attribute`. The data for this command SHALL be as follows:

| ID | Name                 | Type              | Constraint | Quality | Fallback | Conformance |
|----|----------------------|-------------------|------------|---------|----------|-------------|
| 0  | <b>VideoStreamID</b> | VideoStreamIDType | all        |         |          | M           |
| 1  | <b>Viewport</b>      | ViewportStruct    |            |         |          | M           |

#### 11.3.7.6.1. VideoStreamID Field

This field SHALL be a `VideoStreamIDType` representing the video stream to modify.

#### 11.3.7.6.2. Viewport Field

This field SHALL be a `ViewportStruct` representing the new viewport to apply to the requested stream. The aspect ratio of the viewport SHALL match the aspect ratio of the stream requested.

Page 878



### 11.3.7.6.3. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If a VideoStreamID entry does not exist in [DPTZStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side-effects.
- If the requested viewport is outside of the defined allowed range:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side-effects.
- Update the entry in [DPTZStreams](#) with the requested Viewport.
- Apply the new Viewport to the requested video stream.
- Respond with the status code SUCCESS

### 11.3.7.7. DPTZRelativeMove Command

This command SHALL change the per stream viewport by the amount specified in a relative fashion. This allows for multiple users to interact with a directional arrow based user interface. It is RECOMMENDED to increment or decrement the values by 10% of the SensorWidth and SensorHeight found in [VideoSensorParams](#).

The data for this command SHALL be as follows:

| ID | Name                 | Type                              | Constraint  | Quality | Fallback | Conformance |
|----|----------------------|-----------------------------------|-------------|---------|----------|-------------|
| 0  | <b>VideoStreamID</b> | <a href="#">VideoStreamIDType</a> | all         |         |          | M           |
| 1  | <b>DeltaX</b>        | int16                             |             |         | 0        | O.d+        |
| 2  | <b>DeltaY</b>        | int16                             |             |         | 0        | O.d+        |
| 3  | <b>ZoomDelta</b>     | int8                              | -100 to 100 |         | 0        | O.d+        |

#### 11.3.7.7.1. VideoStreamID Field

This field SHALL be a [VideoStreamIDType](#) representing the video stream to modify.

#### 11.3.7.7.2. DeltaX Field

This field SHALL represent the number of pixels to move the [Viewport](#) on the X axis within the SensorWidth and SensorHeight found in [VideoSensorParams](#). A value of 0 means no movement. A negative value means move the viewport left. A positive value means move the viewport right.

#### 11.3.7.7.3. DeltaY Field

This field SHALL represent the number of pixels to move the [Viewport](#) on the Y axis within the SensorWidth and SensorHeight found in [VideoSensorParams](#). A value of 0 means no movement. A negative value means move the viewport down. A positive value means move the viewport up.




Page 879



#### 11.3.7.7.4. ZoomDelta Field

This field SHALL represent a percentage change to the size of the [Viewport](#) is within the SensorWidth and SensorHeight found in [VideoSensorParams](#). A value of 0 means no change. A negative value means make the viewport larger. A positive value means make the viewport smaller.

#### 11.3.7.7.5. Effect on Receipt

The process below SHALL be followed by the camera when receiving this command:

- If a VideoStreamID entry does not exist in [DPTZStreams](#):
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side-effects.
- If DeltaX is present and not 0:
  - Add DeltaX to the X1 and X2 fields of the VideoStreamID viewport bounding rectangle.
- If DeltaY is present and not 0:
  - Add DeltaY to the Y1 and Y2 fields of the VideoStreamID viewport bounding rectangle.
- If ZoomDelta is present and not 0:
  - Scale the VideoStreamID viewport bounding rectangle by the percentage value; anchoring the re-scaled rectangle at the center point of the existing viewport.
- If the aspect ratio following application of the delta values does not match the aspect ratio of the video stream:
  - Clip the viewport to the aspect ratio of the video stream while maintaining the upper left location.
- If the resultant requested viewport is smaller than the [MinViewportResolution](#)
  - Use size in [MinViewportResolution](#) while preserving the upper left location if possible.
- If the requested viewport is larger than [SensorWidth](#) or [SensorHeight](#) in the [VideoSensorParams](#):
  - Use the sensor size values.
- If any portion of requested viewport falls outside the sensor Cartesian plane:
  - Change the upper left of the requested viewport to the nearest point allowing the viewport to be within the sensor Cartesian plane.
- Apply the new viewport values to the video stream with ID VideoStreamID.
- Update the entry in [DPTZStreams](#) with the new viewport values.
- Respond with the status code SUCCESS

## 11.4. WebRTC Transport

### 11.4.1. Background Info

WebRTC (Web Real-Time Communication) is a real-time communication transport technology built on a set of standards that allows audio and video communication between two peers and also supports the transport of arbitrary data between them using an Offer/Answer model.

Page 880



It supports numerous use cases such as P2P communication and live stream broadcasting, etc. Readers unfamiliar with WebRTC should read all of [RFC 8825](#) to understand the concepts and understand the interplay between the IETF RFCs and the W3C browser specifications.

Matter devices implementing WebRTC SHALL conform to the following:

- Implement all IETF required elements in [RFC 8825](#) and all sub-requirements found within its dependent RFCs.
- Support at least the [WebRTC Non-Browser](#) type as defined in [RFC 8825](#).

The list below is not exhaustive (see full details in [RFC 8825](#)), but are the important RFCs and concepts to understand for Matter's WebRTC implementation:

- [RFC 8866](#): SDP - The Session Description Protocol
- [RFC 3264](#) [<https://www.rfc-editor.org/rfc/rfc3264>]: An Offer/Answer Model with Session Description Protocol (SDP)
- [RFC 8489](#): STUN Protocol for discovering public and NAT mapped IP addresses
- [RFC 8656](#): TURN Protocol for relaying media through firewalls
- [RFC 8834](#) [<https://www.rfc-editor.org/rfc/rfc8839>]: Media Transport and Use of RTP in WebRTC
- [RFC 8445](#) [<https://www.rfc-editor.org/rfc/rfc8839>]: Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal
- [RFC 8839](#): Session Description Protocol (SDP) Offer/Answer Procedures for Interactive Connectivity Establishment (ICE)
- [W3C WebRTC](#) [<https://www.w3.org/TR/webrtc/>]: Real-Time Communication in Browsers

Unlike [RFC 8825](#) and [W3C WebRTC](#) [<https://www.w3.org/TR/webrtc/>], Matter provides a full signaling implementation for transport of all commands between Nodes and while this implementation does not follow the naming conventions of [RFC 9429 JSEP](#) [<https://www.rfc-editor.org/rfc/rfc9429>], it aims to provide a transparent approach to endpoints that are both JSEP and Matter so that all WebRTC signaling can be passed through.

It is RECOMMENDED that Requestors implement support for the SDP `imageattr` attribute using the procedures defined in [RFC 9429 Section 3.6](#) [<https://www.rfc-editor.org/rfc/rfc9429#section-3.6>] to properly indicate their screen sizes for receiving video streams.

## 11.4.2. Operating Roles

This section defines two roles, [Provider](#) and [Requestor](#), which are reflected in the application clusters defined in this section. The roles are not mutually exclusive, with devices implementing one or both depending on their functionality.

### 11.4.2.1. Provider

The Provider role is expressed by implementing the [WebRTC Transport Provider Cluster](#) and is typically implemented by devices with video and audio capabilities that produce streams that are consumed by a Requestor. Providers don't initiate outbound sessions and only receive requests to start



Page 881



them. In the example flows shown below the Camera is the Provider.

### 11.4.2.2. Requestor

The Requestor role is expressed by implementing the [WebRTC Transport Requestor Cluster](#) and is implemented by devices which want to watch or listen to the streams produced by a Provider. Requestors only initiate outbound sessions. In the example flows shown below the Controller is the Requestor.

### 11.4.3. Signaling Flows

The following sequence diagrams show the back and forth commands, statuses, and command responses that are involved in the WebRTC session lifecycle.

#### 11.4.3.1. Normal Flow

In this flow, the controller starts the signaling sequence by providing an SDP Offer to the camera via [ProvideOffer](#). If the camera is successful in starting a session, it SHALL send a [ProvideOfferResponse](#) with the allocated WebRTC session ID, the allocated video stream ID, and the allocated audio stream ID. Otherwise, it SHALL respond with a StatusReport with a FAILURE status code. Subsequently, the camera SHALL follow up with an SDP Answer. The second phase is the trickle ICE candidate exchange, where both peers determine their ICE candidates and exchange them via [ProvideICECandidates](#) and [ICECandidates](#). In the third phase, the actual connection is established and the WebRTC session becomes active.

Lastly, when the controller needs to end the session, it SHALL send the [EndSession](#) command to the camera. If the camera needs to end the session, it SHALL send the [End](#) command to the controller.

![Sequence diagram showing the WebRTC session lifecycle between a Controller (Requestor) and a Camera (Provider).](fc18db4d80e3df7b298a14cc5eb65e3a_img.jpg)

The diagram illustrates the WebRTC session lifecycle between a Controller (Requestor) and a Camera (Provider). It is divided into four main phases:

- Initialization (Controller initiates session knowing camera is already online):**
  - Controller sends `WebRTCProvider::ProvideOffer(NULL, SDP, StreamUsage, NULL, NULL, ICEServers, ICETransportPolicy)` to Camera.
  - Camera responds with `WebRTCProvider::ProvideOfferResponse{WebRTCSessionID, VideoStreamID, AudioStreamID}`.
  - Controller sends `WebRTCRequestor::Answer(WebRTCSessionID, SDP)` to Camera.
  - Camera responds with `WebRTCRequestor::Answer command status SUCCESS`.
- Trickle ICE candidate exchange (multiple possible, any order):**
  - Controller sends `WebRTCRequestor::ICECandidates(WebRTCSessionID, ICECandidates)` to Camera.
  - Camera responds with `WebRTCRequestor::ICECandidates status SUCCESS`.
  - Camera sends `WebRTCProvider::ProvideICECandidates(WebRTCSessionID, ICECandidates)` to Controller.
  - Controller responds with `WebRTCProvider::ProvideICECandidates status SUCCESS`.
- Active Session:**
  - Controller sends `Media Flow` to Camera.
- End session (it can be done by either side):**
  - Controller sends `WebRTCProvider::EndSession(WebRTCSessionID, Reason)` to Camera.
  - Camera responds with `EndSession status SUCCESS`.

Sequence diagram showing the WebRTC session lifecycle between a Controller (Requestor) and a Camera (Provider).

Page 882






### 11.4.3.2. Battery Camera in Standby Flow

In this flow, the controller sends the [SolicitOffer](#) command to the camera, which wakes up and replies with [SolicitOfferResponse](#) with an allocated WebRTCSessionID and the *DeferredOffer* parameter set to TRUE. The Video or Audio Stream IDs MAY be NULL if the camera can't determine the stream assignments this early. The Camera would then begin its process of initializing all the relevant components, which MAY take a while. For the Controller, the *DeferredOffer:TRUE* is the signal that up to 30 seconds MAY elapse before the Camera can send the [Offer](#) to the Controller.

During the time it takes for the camera to fully initialize all its components, the controller SHOULD determine its ICE candidates so that all the candidates are ready by the time the Camera calls [Offer](#). The Controller would then respond with its Answer including ICE candidates via the [ProvideAnswer](#) command.

During the ICE candidate exchange phase of this flow, it is expected that only the Camera would send Trickle ICE candidates via [ICECandidates](#) since the Controller SHOULD have determined and sent its ICE candidates within its initial SDP Answer command.

![Sequence diagram for Battery Camera in Standby Flow showing interactions between Controller and Camera.](d647827890b4f5b7e0f14937f9e41587_img.jpg)

```

sequenceDiagram
    participant Controller
    participant Camera
    Note left of Camera: Begin initialization from standby process
    Note over Controller, Camera: Initialization (Controller Using the SolicitOffer flow for a battery camera in standby)
    Controller->>Camera: WebRTCProvider::SolicitOffer(StreamUsage, NULL, NULL,ICEServers,ICETransportPolicy)
    Camera-->>Controller: WebRTCProvider::SolicitOfferResponse(WebRTCSessionID, true, NULL, NULL)
    Controller-->>Camera: Generate ICE Candidates, wait for camera to send its Offer
    Controller->>Camera: WebRTCRequestor::Offer(WebRTCSessionID, SDP)
    Camera-->>Controller: WebRTCRequestor::Offer command status SUCCESS
    Controller->>Camera: WebRTCProvider::ProvideAnswer(WebRTCSessionID, SDP)
    Camera-->>Controller: WebRTCProvider::ProvideAnswer command status SUCCESS
    Note over Controller, Camera: Trickle ICE candidate exchange (multiple possible, any order)
    Controller->>Camera: WebRTCRequestor::ICECandidates(WebRTCSessionID, ICECandidates)
    Camera-->>Controller: WebRTCRequestor::ICECandidates status SUCCESS
    Note over Controller, Camera: Active Session
    Controller-->>Camera: Media Flow
    Note over Controller, Camera: End session (it can be done by either side)
    Controller->>Camera: WebRTCProvider::EndSession(WebRTCSessionID, Reason)
    Camera-->>Controller: EndSession status SUCCESS
  
```

Sequence diagram for Battery Camera in Standby Flow showing interactions between Controller and Camera.

#### NOTE

See [Determining If Battery Powered](#) for the appropriate logic for when to use this [SolicitOffer](#) based flow.

### 11.4.3.3. Camera Initiated Flow

In this flow, the camera is the initiator of the WebRTC session and assumes the [Requestor](#) role, with the Controller assuming the [Provider](#) role. This flow is only supported if the Camera implements [WebRTC Transport Requestor Cluster](#) and the other side (Controller) implements [WebRTC Transport Provider Cluster](#).



Page 883



The Camera begins by sending the [ProvideOffer](#) command to the Controller and getting back a [ProvideOfferResponse](#). The Controller then sends a [Answer](#) command to the Camera. The rest of the flow is the same as in [WebRTC Normal Flow](#).

This flow is used when the Camera needs to start the streaming session, such as in an outbound call from a TV with a built-in camera or an Intercom style system, when the Camera has both the [Provider](#) and [Requestor](#) roles.

![Sequence diagram showing the WebRTC signaling flow between a Camera and a Controller. The flow is divided into four main sections: Initialization, Trickle ICE candidate exchange, Active Session, and End session. The Camera initiates the session by sending a ProvideOffer command to the Controller, which responds with a ProvideOfferResponse. The Camera then sends an Answer command to the Controller, which responds with a SUCCESS status. The Trickle ICE candidate exchange section shows the Camera sending ICECandidates to the Controller, which responds with a SUCCESS status. The Camera then sends ProvideICECandidates to the Controller, which also responds with a SUCCESS status. The Active Session section shows the Camera sending Media Flow to the Controller. The End session section shows the Camera sending an EndSession command to the Controller, which responds with a SUCCESS status.](6bf6442555ad45b5b3ec1f6e174c08ce_img.jpg)

```

sequenceDiagram
    participant Camera
    participant Controller
    Note over Camera, Controller: Initialization (Camera initiates session to a Controller, eg outbound call from a TV)
    Camera->>Controller: WebRTCProvider::ProvideOffer(NULL, SDP, StreamUsage, NULL, NULL,ICEServers, ICETransportPolicy)
    Controller-->>Camera: WebRTCProvider::ProvideOfferResponse{WebRTCSessionID, VideoStreamID, AudioStreamID}
    Camera->>Controller: WebRTCRequestor::Answer(WebRTCSessionID, SDP)
    Controller-->>Camera: WebRTCRequestor::Answer command status SUCCESS
    Note over Camera, Controller: Trickle ICE candidate exchange (multiple possible, any order)
    Camera->>Controller: WebRTCRequestor::ICECandidates(WebRTCSessionID, ICECandidates)
    Controller-->>Camera: WebRTCRequestor::ICECandidates status SUCCESS
    Camera->>Controller: WebRTCProvider::ProvideICECandidates(WebRTCSessionID, ICECandidates)
    Controller-->>Camera: WebRTCProvider::ProvideICECandidates status SUCCESS
    Note over Camera, Controller: Active Session
    Camera->>Controller: Media Flow
    Note over Camera, Controller: End session (it can be done by either side)
    Camera->>Controller: WebRTCProvider::EndSession(WebRTCSessionID, Reason)
    Controller-->>Camera: EndSession status SUCCESS
  
```

Sequence diagram showing the WebRTC signaling flow between a Camera and a Controller. The flow is divided into four main sections: Initialization, Trickle ICE candidate exchange, Active Session, and End session. The Camera initiates the session by sending a ProvideOffer command to the Controller, which responds with a ProvideOfferResponse. The Camera then sends an Answer command to the Controller, which responds with a SUCCESS status. The Trickle ICE candidate exchange section shows the Camera sending ICECandidates to the Controller, which responds with a SUCCESS status. The Camera then sends ProvideICECandidates to the Controller, which also responds with a SUCCESS status. The Active Session section shows the Camera sending Media Flow to the Controller. The End session section shows the Camera sending an EndSession command to the Controller, which responds with a SUCCESS status.

#### 11.4.3.4. Signaling Modes

There are two signaling modes depending on the network topology of the camera, the Matter controller and the livestream viewer entities.

##### 11.4.3.4.1. In-Home Streaming

In this situation, all the entities share the same local area network and there are no firewall restrictions between any of them. There would be no use of STUN/TURN servers and the signaling SHALL be done completely over a Matter CASE session. In the example shown below both the controller and the liverview client are the same device/node. The WebRTC session SHALL be established between the Matter controller and the camera after the signaling is done between them.

Page 884







![Sequence diagram for Out-Of-Home Streaming. It shows two MatterController instances and two Camera instances. The top MatterController sends a '1) CASE over TCP' message to the top Camera. The top Camera then sends a '2) WebRTC P2P Connection' message back to the top MatterController.](ac154d1e5e63f795f345ea5102219fc6_img.jpg)

```

sequenceDiagram
    participant MC1 as MatterController
    participant C1 as Camera
    participant MC2 as MatterController
    participant C2 as Camera
    MC1->>C1: 1) CASE over TCP
    C1->>MC1: 2) WebRTC P2P Connection
  
```

Sequence diagram for Out-Of-Home Streaming. It shows two MatterController instances and two Camera instances. The top MatterController sends a '1) CASE over TCP' message to the top Camera. The top Camera then sends a '2) WebRTC P2P Connection' message back to the top MatterController.

#### 11.4.3.4.2. Out-Of-Home Streaming

In this situation, the viewer and the camera are likely not in the same network or there could be firewall restrictions that prevent direct communication between them. In this case, a Matter controller that has a CASE session with the camera is needed to coordinate the signaling phase between the camera and the viewer device. The Matter controller exchanges the necessary signaling data with the viewer through an ecosystem specific mechanism.

![Sequence diagram for Out-Of-Home Streaming with a LiveViewClient. It shows two MatterController instances, two Camera instances, and two LiveViewClient instances. The top MatterController sends a '1) CASE over TCP' message to the top Camera. The top MatterController then sends a '2) EcoSystem specific messages' message to the top LiveViewClient. Finally, the top Camera sends a '3) WebRTC P2P Connection' message to the top LiveViewClient.](0c11b3b53bc74c8370eab63165354c67_img.jpg)

```

sequenceDiagram
    participant MC1 as MatterController
    participant C1 as Camera
    participant LVC1 as LiveViewClient
    participant MC2 as MatterController
    participant C2 as Camera
    participant LVC2 as LiveViewClient
    MC1->>C1: 1) CASE over TCP
    MC1->>LVC1: 2) EcoSystem specific messages
    C1->>LVC1: 3) WebRTC P2P Connection
  
```

Sequence diagram for Out-Of-Home Streaming with a LiveViewClient. It shows two MatterController instances, two Camera instances, and two LiveViewClient instances. The top MatterController sends a '1) CASE over TCP' message to the top Camera. The top MatterController then sends a '2) EcoSystem specific messages' message to the top LiveViewClient. Finally, the top Camera sends a '3) WebRTC P2P Connection' message to the top LiveViewClient.

#### 11.4.3.5. Determining If Battery Powered

For camera devices, Controllers SHOULD use the Power Source cluster and the features and attributes found within (See [Power Source Cluster](#), in [\[MatterCore\]](#)) to determine if a device is currently operating on battery power. The pseudo code for this is as follows:

```

// Returns true if device is currently known to be battery powered, false otherwise
function on_battery_power
    // Create a empty list of power source instances, and then add them sorted by the
    // Order attribute lowest to highest
    list[power_source_instances]
    for each endpoint in device:
        If endpoint contains a 'Power Source Cluster':
            let power_source_instance be that endpoints 'Power Source Cluster'
            // Check if the power source applies to the whole device (empty list) or the
            // cameras endpoint
            If power_source_instance.EndpointList attribute is an empty list or
            power_source_instance.EndpointList contains the endpoint-id of the camera devices
            endpoint:
                power_source_instances.insert_by_rank(power_source_instance,
                power_source_instance.Order)
  
```



Page 885



```
// Go through the resulting list
for each power_source in power_source_instances:
    If WIRED feature is present and power_source.Status == Active:
        return false
    If BAT feature is present and power_source.Status == Active:
        return true

// No definitive information was found so assume it's not battery powered
return false
```

### 11.4.4. SFrame End-to-End Encryption

To allow for cameras to be deployed in complex ecosystems where high bitrate media streams only need to be transmitted out of the home once, the [Secure Frame \(SFrame\)](#) protocol SHALL be supported by a device.

SFrame provides an end-to-end encryption and authentication mechanism for media frames in a multi-party conference call, in which central media servers (Selective Forwarding Units or SFUs) can access the media metadata needed to make forwarding decisions, without having access to the actual media.

While SFrames are not yet part of the core WebRTC standard when this cluster's initial release occurred, the W3C has designed a mechanism that allows them to be supported within web browsers and other WebRTC compliant devices via [W3C Encoded Transforms](https://www.w3.org/TR/webrtc-encoded-transform/) [<https://www.w3.org/TR/webrtc-encoded-transform/>]. This specification will state how cameras are to implement SFrame and its key distribution so that any device or ecosystem can implement end-to-end encryption.

The IETF has begun the standardization process for SFrame support inside RTP and SDP in conjunction with the W3C work. Servers SHALL support SFrame in RTP via the process identified in [draft-ietf-avtcore-rtp-sframe](https://datatracker.ietf.org/doc/html/draft-ietf-avtcore-rtp-sframe) [<https://datatracker.ietf.org/doc/html/draft-ietf-avtcore-rtp-sframe>].

Use of SFrame for any WebRTC session is optional.

Within the overall design of SFrame, the Matter CASE session provides the preexisting secure signaling channel to exchange the values for the SFrame KID, base\_key, and cipher suite.

#### 11.4.4.1. KID and Ratcheting

Devices SHALL use a ratchet step size R of 8 bits. This leaves 8 to 56 bits for use as the "key generation" value. The resulting KID will always be at least 2 bytes long.

Providers SHOULD ratchet their keys at least once every 10 minutes using the algorithm described in [Section 5.1](https://www.rfc-editor.org/rfc/rfc9605.html#name-sender-keys) [<https://www.rfc-editor.org/rfc/rfc9605.html#name-sender-keys>] of [RFC 9605](#). Devices SHALL keep the previous ratchet key iteration around for one ratchet period to handle any in-flight or retransmissions on the two-way talk channel.

Requestors SHALL ratchet their sending keys when they detect a ratchet by the Provider.

Page 886



#### 11.4.4.2. CTR Handling

Providers involved in an SFrame enabled WebRTC sessions SHALL utilize a single session-wide CTR value space that starts at 0 for each session. The CTR value SHALL increment by one for every new frame transmitted on any media line or Data Channel. Since the CTR values increase by one for each frame sent over any transport, the CTR could be non-monotonic for any given stream and SHOULD NOT be used for any packet loss detection. Providers SHALL NOT use any CTR values greater than  $2^{63} - 1$ .

Requestors SHALL use 64 bit CTR values in the range of  $2^{63}$  and  $2^{64} - 1$ . Ecosystems need to ensure that each participant on the far end of a SFU uses a random starting CTR value within this range.

#### 11.4.4.3. Packetization Mode

Nodes SHALL use the "per frame" mode of SFrame operation as defined in Section 4.1 of [RFC 9605](#).

#### 11.4.4.4. Key-frame Handling

When SFrame is used, Nodes SHALL include the "Short Extension for Non-Scalable Streams" RTP header extension as defined in [RFC 9626](#) Section 3.2, for all non-discardable key-frames transmitted. This extension SHALL NOT be included for non key-frames.

### 11.4.5. Data Types

#### 11.4.5.1. WebRTCSessionID Type

This data type is derived from uint16.

It represents an active WebRTC session. This value starts at 0 and monotonically increases by 1 with each new allocation provisioned by the Node. A value incremented past 65534 SHALL wrap to 0. The Node SHALL verify that the incremented ID does not match any other active session ID. If such a match is found, the ID SHALL be incremented until a unique ID is found.

#### 11.4.5.2. WebRTCEndReasonEnum Type

This data type is derived from enum8.

| Value | Name       | Summary                                                                   | Conformance |
|-------|------------|---------------------------------------------------------------------------|-------------|
| 0     | ICEFailed  | No media connection could be established to the other party               | M           |
| 1     | ICETimeout | The call timed out whilst waiting for ICE candidate gathering to complete | M           |
| 2     | UserHangup | The user chose to end the call                                            | M           |



Page 887



| Value | Name              | Summary                                                                                                                                             | Conformance |
|-------|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 3     | UserBusy          | The remote party is busy                                                                                                                            | M           |
| 4     | Replaced          | The call was replaced by another call                                                                                                               | M           |
| 5     | NoUserMedia       | An error code when there is no local mic/camera to use. This may be because the hardware isn't plugged in, or the user has explicitly denied access | M           |
| 6     | InviteTimeout     | The call timed out whilst waiting for the offer/answer step to complete                                                                             | M           |
| 7     | AnsweredElsewhere | The call was answered from a different device                                                                                                       | M           |
| 8     | OutOfResources    | The call was unable to continue due to not enough resources or available streams                                                                    | M           |
| 9     | MediaTimeout      | The call ended due to a media timeout                                                                                                               | M           |
| 10    | LowPower          | The call ended due to hitting a low power condition                                                                                                 | M           |
| 11    | PrivacyMode       | The call ended due to the camera being set into a privacy mode.                                                                                     | M           |
| 12    | UnknownReason     | Unknown or unspecified reason                                                                                                                       | M           |

#### 11.4.5.3. ICEServerStruct Type

This type SHALL specify the [RFC 8825](#) compliant [ICE servers](#) used to facilitate the negotiation of peer-to-peer connections through NATs (Network Address Translators) and firewalls. It mimics the model used in the W3C WebRTC API [RTCIceServer](#) [<https://www.w3.org/TR/webrtc/#dom-rtciceserver>] dictionary with the addition of a Matter specific field for specifying the Root Certificate of any ICE servers that require TLS.

There are two types of ICE Servers which help to discover the public IP address of a device and relay media traffic when direct peer-to-peer communication is not possible:

Page 888



- **STUN** Servers, which help to discover the public IP address and NAT/Firewall type if any, of a device. When a WebRTC session starts, it contacts the STUN server, which returns the device's public IP and port number. This information is used to generate ICE candidates for the peer-to-peer connection setup.
- **TURN** Servers, which are used when STUN is not sufficient to establish a peer-to-peer connection—typically such as when devices are behind symmetric NATs, which STUN cannot traverse. TURN servers act as a relay between the peers, routing the media traffic between them.

| ID | Name              | Type         | Constraint           | Quality | Fallback | Access | Conformance |
|----|-------------------|--------------|----------------------|---------|----------|--------|-------------|
| 0  | <b>URLs</b>       | list[string] | max 10<br>[max 2000] |         |          |        | M           |
| 1  | <b>Username</b>   | string       | max 508              |         |          |        | O           |
| 2  | <b>Credential</b> | string       | max 512              |         |          |        | O           |
| 3  | <b>CAID</b>       | TLSCAID      | 0 to 65534           |         |          |        | O           |

#### 11.4.5.3.1. URLs Field

This field SHALL specify a list of URLs pointing to the STUN and/or TURN servers. The URL scheme distinguishes whether it is a STUN or TURN server (`stun:`, `stuns:`, `turn:`, or `turns:` respectively). This field maps to the [RTCIceServer urls](https://www.w3.org/TR/webrtc/#dom-rtciceserver-urls) [<https://www.w3.org/TR/webrtc/#dom-rtciceserver-urls>] field.

#### 11.4.5.3.2. Username Field

(Optional for STUN, usually required for TURN) The [RFC 8489](#) compliant UTF-8 encoded username required for authentication with the STUN or TURN servers found in the URLs field. This field maps to the [RTCIceServer username](https://www.w3.org/TR/webrtc/#dom-rtciceserver-username) [<https://www.w3.org/TR/webrtc/#dom-rtciceserver-username>] field.

#### 11.4.5.3.3. Credential Field

(Optional for STUN, usually required for TURN) The [RFC 8489](#) compliant UTF-8 encoded short-term credential (password) used for authentication with the STUN or TURN servers found in the URLs field. This field maps to the [RTCIceServer credential](https://www.w3.org/TR/webrtc/#dom-rtciceserver-credential) [<https://www.w3.org/TR/webrtc/#dom-rtciceserver-credential>] field.

#### 11.4.5.3.4. CAID Field

This field represents the TLSRCAC via its assigned TLSCAID (see Chapter 14, [Certificate Authority ID \(CAID\) Mapping](#) and [TLS Certificate Management Commands](#) sections in [[MatterCore](#)]) that will validate the certificate chain presented by the entries in the urls field. It SHALL be set to a valid value if a `turns:` or `stuns:` url is present in the urls field and SHALL be used to validate those servers' presented TLS root certificates.

### 11.4.5.4. ICECandidateStruct Type

This type SHALL specify the [RFC 8825](#) compliant [ICE Candidate](#) used to facilitate the negotiation of peer-to-peer connections through NATs (Network Address Translators) and firewalls. It mimics the model used in the W3C WebRTC API [RTCIceCandidate](https://www.w3.org/TR/webrtc/#rtccandidate) [<https://www.w3.org/TR/webrtc/#rtccandidate>].



Page 889



interface] dictionary.

| ID | Name                  | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>Candidate</b>      | string |            |         |          |        | M           |
| 1  | <b>SDPMid</b>         | string | min 1      | X       |          |        | M           |
| 2  | <b>SDPM-LineIndex</b> | uint16 |            | X       |          |        | M           |

#### 11.4.5.4.1. Candidate Field

This field SHALL specify the [RFC 8825](#) compliant [RFC 8839 candidate-attribute](#) field in string form. This is the same value as the W3C WebRTC API RTCIceCandidate [candidate](#) [<https://www.w3.org/TR/webrtc/#dom-rtcicecandidate-candidate>] value. The RFCs define no min or max length on this value.

**Note:** This string is not the same string as doing a `candidate.toString()` on a RTCIceCandidate ECMAScript object itself. Some browsers and ECMAScript libraries use non-standard ways to serialize `sdpMid` and `sdpMLineIndex` into the resulting string, but this is not defined in the W3 specification. This specification requires those fields to be passed directly using the named struct fields [SDPMid](#) and [SDPMLineIndex](#).

#### 11.4.5.4.2. SDPMid Field

This field SHALL specify the Candidate's media stream identification tag which uniquely identifies the media stream within the component with which the candidate is associated, or null if no such association exists. This is the same value as the W3C WebRTC API RTCIceCandidate [sdpMid](#) [<https://www.w3.org/TR/webrtc/#dom-rtcicecandidate-sdpmid>] value. The RFCs define no max length on this value.

#### 11.4.5.4.3. SDPMLineIndex Field

This field SHALL specify the zero-based index number of the media description (as defined in [RFC 8866](#)) in the SDP with which the Candidate is associated or null if no such association exists. This is the same value as the W3C WebRTC API RTCIceCandidate [sdpMLineIndex](#) [<https://www.w3.org/TR/webrtc/#dom-rtcicecandidate-sdpmlineindex>] value.

### 11.4.5.5. WebRTCSessionStruct Type

This type stores all the relevant values associated with an active WebRTC session.

| Access Modifier: Fabric Scoped |                   |                                  |            |         |          |        |             |
|--------------------------------|-------------------|----------------------------------|------------|---------|----------|--------|-------------|
| ID                             | Name              | Type                             | Constraint | Quality | Fallback | Access | Conformance |
| 0                              | <b>ID</b>         | <a href="#">WebRTC-SessionID</a> | all        |         |          |        | M           |
| 1                              | <b>PeerNodeID</b> | node-id                          | all        |         |          |        | M           |

Page 890



| Access Modifier: Fabric Scoped |                 |                   |     |   |  |  |   |
|--------------------------------|-----------------|-------------------|-----|---|--|--|---|
| 2                              | PeerEndpointID  | endpointno        | all |   |  |  | M |
| 3                              | StreamUsage     | StreamUsageEnum   | all |   |  |  | M |
| 4                              | VideoStreamID   | VideoStreamIDType | all | X |  |  | M |
| 5                              | AudioStreamID   | AudioStreamIDType | all | X |  |  | M |
| 6                              | MetadataEnabled | bool              | all |   |  |  | M |

This values of PeerNodeID and FabricIndex are used to validate the source of, or select the correct remote target, for WebRTC session related commands. The implicit field FabricIndex exists since this structure is defined as Fabric Scoped.

#### 11.4.5.5.1. ID Field

This field contains the WebRTC Session ID for this session.

#### 11.4.5.5.2. PeerNodeID Field

This field contains the NodeId for the peer entity involved in this session.

#### 11.4.5.5.3. PeerEndpointID Field

This field contains the EndpointId for the peer entity involved in this session.

#### 11.4.5.5.4. StreamUsage Field

This field contains the [StreamUsageEnum](#) of this session.

#### 11.4.5.5.5. VideoStreamID Field

This field contains the [VideoStreamIDType](#) that is used by this session. A null value means no video stream is currently associated with this session.

#### 11.4.5.5.6. AudioStreamID Field

This field contains the [AudioStreamIDType](#) that is used by this session. A null value means no audio stream is currently associated with this session.

#### 11.4.5.5.7. MetadataEnabled Field

This field indicates if [metadata](#) is active in this session.




Page 891



## 11.5. WebRTC Transport Provider Cluster

The WebRTC transport provider cluster provides a way for stream providers (e.g. Cameras) to stream or receive their data through WebRTC. Devices implementing this cluster SHALL also implement [Camera AV Stream Management Cluster](#) on the same endpoint.

### 11.5.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                              |
|----------|----------------------------------------------------------|
| 1        | Initial version of the WebRTC Transport Provider Cluster |

### 11.5.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | WEBRTCP   |

### 11.5.3. Cluster ID

| ID     | Name                      |
|--------|---------------------------|
| 0x0553 | WebRTC Transport Provider |

### 11.5.4. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code     | Feature  | Conformance | Summary                                           |
|-----|----------|----------|-------------|---------------------------------------------------|
| 0   | METADATA | Metadata | P, O        | Supports metadata transmission in WebRTC sessions |

#### 11.5.4.1. Metadata Feature

When this feature is supported and a session activates it, a WebRTC DataChannel using the protocol name `urn:csa:matter:av-metadata` SHALL be used for transmitting the metadata. The ability to include metadata is supported on a per session basis.

This feature is designed to be [JSEP](#) compliant with the [RTCDatChannel](https://www.w3.org/TR/webrtc/#rtcdat频道) [<https://www.w3.org/TR/webrtc/#rtcdat频道>] object interface and consists of [AVMetadataStruct](#) content.

If [SFrame End-to-End Encryption](#) is active in a session, all metadata transmissions SHALL be sent using the protocol name `urn:csa:matter:sframe:av-metadata` instead with each transmission being wrapped in SFrames.

Page 892







## 11.5.5. Data Types

### 11.5.5.1. SFrameStruct Type

This type SHALL specify the [RFC 9605](#) data needed to use [SFrames](#) as an end-to-end encryption mechanism with WebRTC.

| ID | Name               | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|--------------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>CipherSuite</b> | uint16 | min 1      |         |          |        | M           |
| 1  | <b>BaseKey</b>     | octstr | max 128    |         |          |        | M           |
| 2  | <b>KID</b>         | octstr | 2 to 8     |         |          |        | M           |

#### 11.5.5.1.1. CipherSuite Field

This field SHALL specify the SFrame cipher suite value as defined in [RFC 9605](#) Section 8.1 Cipher Suites table, and maintained in the IANA [SFrame Registry](#) [<https://www.iana.org/assignments/sframe/sframe.xhtml>].

#### 11.5.5.1.2. BaseKey Field

This field SHALL specify the SFrame base\_key value to use for a session. The length of this key depends on the selected cipher suite's Nk value as defined in [Section 4.5 Cipher Suites](#) [<https://www.rfc-editor.org/rfc/rfc9605.html#name-cipher-suites>].

#### 11.5.5.1.3. KID Field

This field SHALL specify the initial SFrame KID (Key Id) value to be used. The bottom 8 bits of this value will be overwritten and used for ratchet step tracking.

## 11.5.6. Attributes

| ID     | Name                   | Type                                        | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------|---------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>CurrentSessions</b> | list[ <a href="#">WebRTCSessionStruct</a> ] | all        |         |          | R M S  | M           |

### 11.5.6.1. CurrentSessions Attribute

This attribute SHALL be a list of [WebRTCSessionStruct](#), which represents all the active WebRTC Sessions.

## 11.5.7. Commands




Page 893



| ID   | Name                         | Direction       | Response              | Access | Quality | Conformance |
|------|------------------------------|-----------------|-----------------------|--------|---------|-------------|
| 0x00 | <b>SolicitOffer</b>          | client ⇒ server | SolicitOffer-Response | O F    | L       | M           |
| 0x01 | <b>SolicitOffer-Response</b> | client ⇐ server | N                     |        | L       | M           |
| 0x02 | <b>ProvideOffer</b>          | client ⇒ server | ProvideOfferResponse  | O F    | L       | M           |
| 0x03 | <b>ProvideOfferResponse</b>  | client ⇐ server | N                     |        | L       | M           |
| 0x04 | <b>ProvideAnswer</b>         | client ⇒ server | Y                     | O F    | L       | M           |
| 0x05 | <b>ProvideICE-Candidates</b> | client ⇒ server | Y                     | O F    | L       | M           |
| 0x06 | <b>EndSession</b>            | client ⇒ server | Y                     | O F    | L       | M           |

#### 11.5.7.1. SolicitOffer Command

Requests that the Provider initiates a new session with the Offer / Answer flow in a way that allows for options to be passed and work with devices needing the [standby flow](#). This command SHALL have the following data fields:

| ID | Name                         | Type                   | Constraint | Quality | Fallback | Conformance |
|----|------------------------------|------------------------|------------|---------|----------|-------------|
| 0  | <b>StreamUsage</b>           | StreamUsageEnum        | all        |         |          | M           |
| 1  | <b>OriginatingEndpointID</b> | endpoint-no            | all        |         |          | M           |
| 2  | <b>VideoStreamID</b>         | VideoStreamIDType      | all        | X       |          | O.a+        |
| 3  | <b>AudioStreamID</b>         | AudioStreamIDType      | all        | X       |          | O.a+        |
| 4  | <b>ICEServers</b>            | list[ICEServer-Struct] | max 10     |         |          | O           |
| 5  | <b>ICETransportPolicy</b>    | string                 | max 16     |         |          | O           |

Page 894



| ID | Name             | Type         | Constraint | Quality | Fallback | Conformance |
|----|------------------|--------------|------------|---------|----------|-------------|
| 6  | Meta-dataEnabled | bool         | all        |         |          | METADATA    |
| 7  | SFrameConfig     | SFrameStruct | all        |         |          | P, O        |

#### 11.5.7.1.1. StreamUsage Field

This field SHALL contain the [StreamUsageEnum](#) that indicates the stream usage for this session and is used per [Resource Management and Stream Priorities](#).

#### 11.5.7.1.2. OriginatingEndpointID Field

This field SHALL indicate the endpoint that originates this command. This endpoint SHALL be used when acting as a client to invoke the commands on the Requestor cluster.

#### 11.5.7.1.3. AudioStreamID Field

This field SHALL indicate the audio stream to use, not use, or let be automatically selected.

- If not present, no audio should be included in the resulting Offer.
- If present and null, then automatic stream assignment or creation is requested.
- If present and a valid audio stream ID, use only this specific stream.

#### 11.5.7.1.4. VideoStreamID Field

This field SHALL indicate the video stream to use, not use, or let be automatically selected.

- If not present, no video should be included in the resulting Offer.
- If present and null, then automatic stream assignment or creation is requested.
- If present and a valid video stream ID, use only this specific stream.

#### 11.5.7.1.5. ICEServers Field

This field SHALL be a list of [ICEServerStruct](#) which contains the ICE servers and their credentials to use for this session. See [ICEServerStruct](#) for further details.

#### 11.5.7.1.6. ICETransportPolicy Field

This field SHALL contain a string which dictates the gathering and usage of ICE candidates. Specifically whether all candidates are used or if restrictions are applied to only use TURN server candidates. It is important for both security and connectivity behavior, as it allows applications to define a preferred approach to network routing and privacy. This field SHALL mirror the acceptable values in the W3C WebRTC API [RTCIceTransportPolicy](#) [<https://www.w3.org/TR/webrtc/#rtcicetransportpolicy-enum>] enum, which are listed below for convenience:




Page 895



| Value   | Description                                                                                                                                                                                                                                                                                                                                   |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 'all'   | This is the default setting in most cases. The ICE agent can gather candidates from all available network interfaces (both public and private IP addresses). This setting provides the highest probability of establishing a direct peer-to-peer connection without the need for relay servers like TURN (Traversal Using Relays around NAT). |
| 'relay' | The ICE agent will only use relay candidates provided by TURN servers. This policy enhances privacy and security because it prevents the disclosure of the user's private IP addresses and ensures that all traffic goes through a controlled relay server. However, it may increase latency and dependency on the relay infrastructure.      |

#### 11.5.7.1.7. MetadataEnabled Field

This field indicates if [metadata](#) transmission SHALL be active in this session.

#### 11.5.7.1.8. SFrameConfig Field

This field if present indicates that [SFrame End-to-End Encryption](#) SHALL be active in this session using the configuration provided.

#### 11.5.7.1.9. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If [HardPrivacyModeOn](#) is true:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If [SoftLivestreamPrivacyModeEnabled](#) is true and *StreamUsage* is [LiveView](#):
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If [SoftRecordingPrivacyModeEnabled](#) is true and *StreamUsage* is [Recording](#) or [Analysis](#):
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If *StreamUsage* is not found in the [StreamUsagePriorities](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If *VideoStreamID* is present and is not null and does not match a value in [Allocated-VideoStreams](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.

Page 896







- If *VideoStreamID* is present and is null and [AllocatedVideoStreams](#) is empty:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If *AudioStreamID* is present and is not null and does not match a value in [AllocatedAudioStreams](#):
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If *AudioStreamID* is present and is null and [AllocatedAudioStreams](#) is empty:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If *SFrameConfig* is present:
  - If the [CipherSuite](#) field of the passed in *SFrameConfig* is not a supported value:
    - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
  - If the length of the [BaseKey](#) field of the passed in *SFrameConfig* does not match the expected length for a key using the [CipherSuite](#):
    - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- For each URL in the [URLs](#) field of each [ICEServerStruct](#) in the passed in *ICEServers*:
  - If the URL scheme is **turns** or **stuns**, and the UTCTime attribute of the Time Synchronization cluster is null:
    - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- Create a new [WebRTCSessionID](#)
- Create a new [WebRTCSessionStruct](#) associated with the accessing fabric, populated with the passed in values from this command, the *OriginatingEndpointID* field as the [PeerEndpointID](#), and the accessing Peer Node ID entry stored in the Secure Session Context (See Chapter 4 Secure Channel, Secure Session Context section, in [\[MatterCore\]](#)) as the [PeerNodeID](#). The [PeerNodeID](#), [PeerEndpointID](#) and the associated fabric, SHALL be used as the destination for all commands for the corresponding [WebRTCSessionID](#).
- If in [standby mode](#):
  - Respond with a [SolicitOfferResponse](#) with [DeferredOffer](#) set to TRUE.
  - Perform device specific steps to exit standby mode. This SHALL take less than 30 seconds.
- Else:
  - Respond with a [SolicitOfferResponse](#) with [DeferredOffer](#) set to FALSE.
- If *VideoStreamID* is present and is null:
  - Automatically select an existing [video stream](#) per the [Resource Management and Stream Priorities](#).
  - Store the used *VideoStreamID* in the [WebRTCSessionStruct](#)




Page 897



- If `AudioStreamID` is present and is null:
  - Automatically select an existing `audio stream` per the [Resource Management and Stream Priorities](#).
  - Store the used `AudioStreamID` in the `WebRTCSessionStruct`
- If not able to meet the [Resource Management and Stream Priorities](#) conditions or unable to provide another `WebRTC` session:
  - Invoke [End](#) with Reason set to `OutOfResources`, and end processing with no other side effects.
- Internally increment the `ReferenceCount` on any used video streams.
- Internally increment the `ReferenceCount` on any used audio streams.
- Store the `WebRTCSessionStruct` in the [CurrentSessions](#)
- Generate the SDP Offer and invoke [Offer](#), and if the passed in `ICEServers` and `ICETransportPolicy` were present, include those fields in the command.

#### 11.5.7.2. SolicitOfferResponse Command

This command SHALL be generated in response to a [SolicitOffer](#) command.

This response contains information about the session and streams created and/or if a deferred offer will take place.

| ID | Name                         | Type                              | Constraint | Quality | Fallback | Conformance                                |
|----|------------------------------|-----------------------------------|------------|---------|----------|--------------------------------------------|
| 0  | <code>WebRTCSessionID</code> | <a href="#">WebRTCSessionID</a>   | all        |         |          | M                                          |
| 1  | <code>DeferredOffer</code>   | bool                              | all        |         |          | M                                          |
| 2  | <code>VideoStreamID</code>   | <a href="#">VideoStreamIDType</a> | all        | X       |          | <a href="#">SolicitOffer.VideoStreamID</a> |
| 3  | <code>AudioStreamID</code>   | <a href="#">AudioStreamIDType</a> | all        | X       |          | <a href="#">SolicitOffer.AudioStreamID</a> |

Upon receipt, the client SHALL create a new [WebRTCSessionStruct](#) populated with the values from this command, along with the accessing Peer Node ID and Local Fabric Index entries stored in the Secure Session Context as the `PeerNodeID` and `FabricIndex` values, and store it in the `WebRTC` Transport Requestor cluster's [CurrentSessions](#) attribute.

The session establishment SHALL be considered failed unless a [Offer](#) command is received by the Requestor from the [PeerEndpointID](#) / `FabricIndex` within 30 seconds.

Page 898



**11.5.7.2.1. WebRTCSessionID Field**

This field SHALL contain the ID of the established WebRTC session.

**11.5.7.2.2. DeferredOffer Field**

This field SHALL indicates the delayed processing hint of the provider.

If DeferredOffer is FALSE, the VideoStreamID and AudioStreamID fields SHALL NOT be null in this response and the Provider will without delay invoke the [Offer](#) command. If DeferredOffer is TRUE, the VideoStreamID and AudioStreamID fields MAY be non-null in this response, if the stream mapping logic can be done while in its low-power state, or they MAY be null, if it cannot. When TRUE, this is a hint to the Requestor that there will be a larger than normal amount of time before the [Offer](#) command will be invoked and the Requestor SHOULD use this extra time gap to begin its own ICE Candidate generation until the Offer arrives. (See further details in the section [WebRTC Battery Camera in Standby Flow](#))

**11.5.7.2.3. VideoStreamID Field**

This field SHALL contain the [VideoStreamIDType](#) used for the session if known or null if unknown at this time.

**11.5.7.2.4. AudioStreamID Field**

This field SHALL contain the [AudioStreamIDType](#) used for the session if known or null if unknown at this time.

**11.5.7.3. ProvideOffer Command**

This command allows an SDP Offer to be set and start a new session. This command can also be used in the re-offer flow of an existing session to change the details of the SDP (e.g. to enable/disable two-way talk).

This command SHALL have the following data fields:

| ID | Name                                  | Type                              | Constraint | Quality | Fallback | Conformance |
|----|---------------------------------------|-----------------------------------|------------|---------|----------|-------------|
| 0  | <a href="#">WebRTCSessionID</a>       | <a href="#">WebRTCSessionID</a>   | all        | X       |          | M           |
| 1  | <a href="#">SDP</a>                   | string                            | all        |         |          | M           |
| 2  | <a href="#">StreamUsage</a>           | <a href="#">StreamUsageEnum</a>   | all        |         |          | M           |
| 3  | <a href="#">OriginatingEndpointID</a> | endpoint-no                       | all        |         |          | M           |
| 4  | <a href="#">VideoStreamID</a>         | <a href="#">VideoStreamIDType</a> | all        | X       |          | O.c+        |



Page 899



| ID | Name               | Type                    | Constraint | Quality | Fallback | Conformance |
|----|--------------------|-------------------------|------------|---------|----------|-------------|
| 5  | AudioStreamID      | AudioStreamIDType       | all        | X       |          | O,c+        |
| 6  | ICEServers         | list[ICE-Server-Struct] | max 10     |         |          | O           |
| 7  | ICETransportPolicy | string                  | max 16     |         |          | O           |
| 8  | MetadataEnabled    | bool                    | all        |         |          | METADATA    |
| 9  | SFrameConfig       | SFrameStruct            | all        |         |          | P, O        |

#### 11.5.7.3.1. WebRTCSessionID Field

This field SHALL be a [WebRTCSessionID](#) and contain the ID of an established WebRTC session or null if requesting a new session.

#### 11.5.7.3.2. SDP Field

This field SHALL contain the string based [SDP Offer](#). See [WebRTC Transport](#) for further details on SDP and Offer/Answer semantics.

#### 11.5.7.3.3. StreamUsage Field

This field SHALL contain the [StreamUsageEnum](#) that indicates the stream usage for this session.

#### 11.5.7.3.4. OriginatingEndpointID Field

This field SHALL indicate the endpoint that originates this command. This endpoint SHALL be used when acting as a client to invoke the commands on the Requestor cluster.

#### 11.5.7.3.5. VideoStreamID Field

This field SHALL have the following semantics:

- If not present, video is not being requested.
- If present and null, automatic assignment of a video stream is requested.
- If present and not null, the specific stream identified by the [VideoStreamIDType](#) is requested.

In a reOffer flow, this field SHALL be set to the existing VideoStreamID stored for this session.

#### 11.5.7.3.6. AudioStreamID Field

This field SHALL have the following semantics:

Page 900



- If not present, audio is not being requested.
- If present and null, automatic assignment of a audio stream is requested.
- If present and not null, the specific stream identified by the [AudioStreamIDType](#) is requested.

In a reOffer flow, this field SHALL be set to the existing AudioStreamID stored for this session.

#### 11.5.7.3.7. ICEServers Field

This field SHALL be a list of [ICEServerStruct](#) which contains the ICE servers and their credentials to use for this session. See [ICEServerStruct](#) for further details.

#### 11.5.7.3.8. ICETransportPolicy Field

This field controls the gathering and usage of ICE candidates and SHALL have one of the values found in [ICETransportPolicy](#).

#### 11.5.7.3.9. MetadataEnabled Field

This field indicates if [metadata](#) transmission SHALL be active in this session.

#### 11.5.7.3.10. SFrameConfig Field

This field if present indicates that [SFrame End-to-End Encryption](#) SHALL be active in this session using the configuration provided.

#### 11.5.7.3.11. Effect on Receipt

The process below SHALL be followed by the server when receiving this command:

- If [WebRTCSessionID](#) is not null and does not match a value in [CurrentSessions](#):
  - Respond with a response status of NOT\_FOUND
- If [WebRTCSessionID](#) is null:
  - If [HardPrivacyModeOn](#) is true:
    - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
  - If [SoftLivestreamPrivacyModeEnabled](#) is true and [StreamUsage](#) is [LiveView](#):
    - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
  - If [SoftRecordingPrivacyModeEnabled](#) is true and [StreamUsage](#) is [Recording](#) or [Analysis](#):
    - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
  - If the passed in [StreamUsage](#) is not found in the [StreamUsagePriorities](#):
    - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
  - If [VideoStreamID](#) is present and is not null and does not match a value in [Allocated-](#)



Page 901



**VideoStreams:**

- Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If *VideoStreamID* is present and is null:
  - If *AllocatedVideoStreams* is empty:
    - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
    - Automatically select an existing [video stream](#) per the [Resource Management and Stream Priorities](#).
- If *AudioStreamID* is present and is not null and does not match a value in *AllocatedAudioStreams*:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If *AudioStreamID* is present and is null:
  - If *AllocatedAudioStreams* is empty:
    - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
    - Automatically select an existing [audio stream](#) per the [Resource Management and Stream Priorities](#).
- If not able to meet the [Resource Management and Stream Priorities](#) conditions or unable to provide another WebRTC session:
  - Respond with a response status of RESOURCE\_EXHAUSTED
- If *SFrameConfig* is present:
- If the *CipherSuite* field of the passed in *SFrameConfig* is not a supported value:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- If the length of the *BaseKey* field of the passed in *SFrameConfig* does not match the expected length for a key using the *CipherSuite*:
  - Fail the command with the status code DYNAMIC\_CONSTRAINT\_ERROR, and end processing with no other side effects.
- For each URL in the *URLs* field of each *ICEServerStruct* in the passed in *ICEServers*:
  - If the URL scheme is **turns** or **stuns**, and the UTCTime attribute of the Time Synchronization cluster is null:
    - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- Create a new *WebRTCSessionID*
- Create a new *WebRTCSessionStruct* associated with the accessing fabric, populated with the passed in values from this command, the *OriginatingEndpointID* field as the *PeerEndpointID*, and the accessing Peer Node ID entry stored in the Secure Session Context (See Chapter 4

Page 902







Secure Channel, Secure Session Context section, in [\[MatterCore\]](#) as the [PeerNodeID](#). The [PeerNodeID](#), [PeerEndpointID](#) and the associated fabric, SHALL be used as the destination for all asynchronous commands for the corresponding [WebRTCSessionID](#).

- Internally increment the [ReferenceCount](#) on any used video streams.
- Internally increment the [ReferenceCount](#) on any used audio streams.
- Store the [WebRTCSessionStruct](#) in the [CurrentSessions](#)
- Else:
  - If the accessing Peer Node ID stored in the Secure Session Context and the accessing fabric do not match the [PeerNodeID](#) and associated fabric for the *WebRTCSessionID* entry in [CurrentSessions](#):
    - Respond with a response status of NOT\_FOUND
- Respond with a [ProvideOfferResponse](#)
- Process the SDP Offer, begin the ICE Candidate gathering phase, create the SDP Answer, and invoke [Answer](#) on the sessions [PeerEndpointID](#) / [FabricIndex](#)

#### 11.5.7.4. ProvideOfferResponse Command

This command contains information about the session and streams created as a response to the requestor's offer.

This command SHALL have the following data fields:

| ID | Name                            | Type                              | Constraint | Quality | Fallback | Conformance                                      |
|----|---------------------------------|-----------------------------------|------------|---------|----------|--------------------------------------------------|
| 0  | <a href="#">WebRTCSessionID</a> | <a href="#">WebRTCSessionID</a>   | all        |         |          | M                                                |
| 1  | <a href="#">VideoStreamID</a>   | <a href="#">VideoStreamIDType</a> | all        | X       |          | <a href="#">WebRTCPromideOffer.VideoStreamID</a> |
| 2  | <a href="#">AudioStreamID</a>   | <a href="#">AudioStreamIDType</a> | all        | X       |          | <a href="#">WebRTCPromideOffer.AudioStreamID</a> |

Upon receipt, the client SHALL create a new [WebRTCSessionStruct](#) populated with the values from this command, along with the accessing Peer Node ID and Local Fabric Index entries stored in the Secure Session Context as the [PeerNodeID](#) and [FabricIndex](#) values, and store it in the WebRTC Transport Requestor cluster's [CurrentSessions](#) attribute.

##### 11.5.7.4.1. WebRTCSessionID Field

This field SHALL contain the [WebRTCSessionID](#) of the established WebRTC session.




Page 903



#### 11.5.7.4.2. VideoStreamID Field

This field SHALL contain the [VideoStreamIDType](#) used for this session. If no video stream was used, null SHALL be passed.

#### 11.5.7.4.3. AudioStreamID Field

This field SHALL contain the [AudioStreamIDType](#) used for this session. If no audio stream was used, null SHALL be passed.

### 11.5.7.5. ProvideAnswer Command

This command SHALL be initiated from a Node in response to an Offer that was previously received from a remote peer. It SHALL have the following data fields:

| ID | Name            | Type            | Constraint | Quality | Fallback | Conformance |
|----|-----------------|-----------------|------------|---------|----------|-------------|
| 0  | WebRTCSessionID | WebRTCSessionID | all        |         |          | M           |
| 1  | SDP             | string          | all        |         |          | M           |

This command SHALL respond with a response status of NOT\_FOUND if the WebRTCSessionID does not match an entry in [CurrentSessions](#), or if the matching entry's associated fabric and PeerNodeID do not match the accessing fabric and the Peer Node ID entry stored in the Secure Session Context of the session this command was received on.

#### 11.5.7.5.1. WebRTCSessionID Field

This field SHALL contain the [WebRTCSessionID](#) of the established WebRTC session.

#### 11.5.7.5.2. SDP Field

This field SHALL contain the string based [SDP](#) Answer. See [WebRTC Transport](#) for further details on SDP and Offer/Answer semantics.

### 11.5.7.6. ProvideICECandidates Command

This command allows for string based [ICE candidates](#) [<https://rfc-editor.org/rfc/rfc8839#section-5.1>] generated after the initial Offer / Answer exchange, via a JSEP [onicecandidate](#) [<https://datatracker.ietf.org/doc/html/rfc9429#section-4.1.20>] event, a DOM [rtcpeerconnectioniceevent](#) [<https://www.w3.org/TR/webrtc/#dom-rtcpeerconnectioniceevent>] event, or other WebRTC compliant implementations, to be added to a session during the gathering phase. This is typically used for STUN or TURN discovered candidates, or to indicate the end of gathering state.

| ID | Name            | Type            | Constraint | Quality | Fallback | Conformance |
|----|-----------------|-----------------|------------|---------|----------|-------------|
| 0  | WebRTCSessionID | WebRTCSessionID | all        |         |          | M           |

Page 904







| ID | Name          | Type                     | Constraint | Quality | Fallback | Conformance |
|----|---------------|--------------------------|------------|---------|----------|-------------|
| 1  | ICECandidates | list[ICECandidateStruct] | min 1      |         |          | M           |

This command SHALL respond with a response status of NOT\_FOUND if the `WebRTCSessionID` does not match an entry in `CurrentSessions`, or if the matching entry's associated fabric and `PeerNodeID` do not match the accessing fabric and the Peer Node ID entry stored in the Secure Session Context of the session this command was received on.

#### 11.5.7.6.1. WebRTCSessionID Field

This field SHALL contain the `WebRTCSessionID` of the established WebRTC session.

#### 11.5.7.6.2. ICECandidates Field

This field SHALL contain a list of `JSEP` compliant `ICE Candidate Format` [<https://datatracker.ietf.org/doc/html/rfc9429#section-3.5.2.1>] objects.

### 11.5.7.7. EndSession Command

This command instructs the stream provider to end the WebRTC session.

| ID | Name            | Type                | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------------|------------|---------|----------|-------------|
| 0  | WebRTCSessionID | WebRTCSessionID     | all        |         |          | M           |
| 1  | Reason          | WebRTCEndReasonEnum | all        |         |          | M           |

#### 11.5.7.7.1. WebRTCSessionID Field

This field SHALL contain the `WebRTCSessionID` of the established WebRTC session.

#### 11.5.7.7.2. Reason Field

This field SHALL be one of the values in `WebRTCEndReasonEnum`.

#### 11.5.7.7.3. Effect on Receipt

The process below SHALL be followed by the server when receiving this command or when the Provider detects a `MEDIA_TIMEOUT`:

- If `WebRTCSessionID` does not match a value in `CurrentSessions`:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the accessing fabric and Peer Node ID entry stored in the Secure Session Context do not match



Page 905



the associated fabric and `PeerNodeID` field of the `WebRTCSessionID` entry in `CurrentSessions`:

- Fail the command with the status code `NOT_FOUND`, and end processing with no other side effects.
- Internally decrement the `ReferenceCount` on any used video streams.
- Internally decrement the `ReferenceCount` on any used audio streams.
- Remove the entry in the `CurrentSessions` for `WebRTCSessionID`.

## 11.6. WebRTC Transport Requestor Cluster

The WebRTC transport requestor cluster provides a way for stream consumers (e.g. Matter Stream Viewer) to establish a WebRTC connection with a stream provider that implements the [WebRTC Transport Provider Cluster](#).

### 11.6.1. Revision History

The global `ClusterRevision` attribute value SHALL be the highest revision number in the table below.

| Revision | Description                                               |
|----------|-----------------------------------------------------------|
| 1        | Initial version of the WebRTC Transport Requestor Cluster |

### 11.6.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | WEBRTCR   |

### 11.6.3. Cluster ID

| ID     | Name                       |
|--------|----------------------------|
| 0x0554 | WebRTC Transport Requestor |

### 11.6.4. Attributes

| ID     | Name                   | Type                                        | Constraint | Quality | Fallback | Access | Conformance |
|--------|------------------------|---------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>CurrentSessions</b> | list[ <a href="#">WebRTCSessionStruct</a> ] | all        |         |          | R A S  | M           |

#### 11.6.4.1. CurrentSessions Attribute

This attribute SHALL be a list of [WebRTCSessionStruct](#), which represents all the active WebRTC Sessions on this Node.

Page 906



### 11.6.5. Commands

| ID   | Name                 | Direction                   | Response | Access | Quality | Conformance |
|------|----------------------|-----------------------------|----------|--------|---------|-------------|
| 0x00 | <b>Offer</b>         | client $\Rightarrow$ server | Y        | O      | L       | M           |
| 0x01 | <b>Answer</b>        | client $\Rightarrow$ server | Y        | O      | L       | M           |
| 0x02 | <b>ICECandidates</b> | client $\Rightarrow$ server | Y        | O      | L       | M           |
| 0x03 | <b>End</b>           | client $\Rightarrow$ server | Y        | O      | L       | M           |

#### 11.6.5.1. Offer Command

This command provides the stream requestor with WebRTC session details. It is sent following the receipt of a [SolicitOffer](#) command or a re-[Offer](#) initiated by the Provider.

| ID | Name                            | Type                                                | Constraint | Quality | Fallback | Conformance |
|----|---------------------------------|-----------------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>WebRTCSes-<br/>sionID</b>    | <a href="#">WebRTCSes-<br/>sionID</a>               | all        |         |          | M           |
| 1  | <b>SDP</b>                      | string                                              | all        |         |          | M           |
| 2  | <b>ICEServers</b>               | list[ <a href="#">ICE-<br/>Server-<br/>Struct</a> ] | max 10     |         |          | O           |
| 3  | <b>ICETrans-<br/>portPolicy</b> | string                                              | max 16     |         |          | O           |

This command SHALL respond with a response status of NOT\_FOUND if the WebRTCSessionID does not match an entry in [CurrentSessions](#), or if the matching entry's associated fabric and [PeerNodeID](#) do not match the accessing fabric and the Peer Node ID entry stored in the Secure Session Context (see Chapter 4 Secure Channel, Secure Session Context section, in [\[MatterCore\]](#)) of the session this command was received on.

##### 11.6.5.1.1. WebRTCSessionID Field

This field SHALL contain the ID of the established WebRTC session.

##### 11.6.5.1.2. SDP Field

This field SHALL contain the string based [SDP](#) Offer. See [WebRTC Transport](#) for further details on SDP and Offer/Answer semantics.




Page 907



#### 11.6.5.1.3. ICEServers Field

This field SHALL be a list of [ICEServerStruct](#) which contains the ICE servers and their credentials to use for this session. See [ICEServerStruct](#) for further details.

#### 11.6.5.1.4. ICETransportPolicy Field

This field controls the gathering and usage of ICE candidates and SHALL have one of the values found in [ICETransportPolicy](#).

### 11.6.5.2. Answer Command

This command provides the stream requestor with the WebRTC session details (i.e. Session ID and SDP answer), It is the next command in the Offer/Answer flow to the [ProvideOffer](#) command.

| ID | Name                             | Type                             | Constraint | Quality | Fallback | Conformance |
|----|----------------------------------|----------------------------------|------------|---------|----------|-------------|
| 0  | <a href="#">WebRTCSes-sionID</a> | <a href="#">WebRTCSes-sionID</a> | all        |         |          | M           |
| 1  | <a href="#">SDP</a>              | string                           | all        |         |          | M           |

This command SHALL respond with a response status of NOT\_FOUND if the WebRTCSessionID does not match an entry in [CurrentSessions](#), or if the matching entry's associated fabric and [PeerNodeID](#) do not match the accessing fabric and the Peer Node ID entry stored in the Secure Session Context of the session this command was received on.

#### 11.6.5.2.1. WebRTCSessionID Field

This field SHALL contain the [WebRTCSessionID](#) of the established WebRTC session.

#### 11.6.5.2.2. SDP Field

This field SHALL contain the string based [SDP](#) Answer. See [WebRTC Transport](#) for further details on SDP and Offer/Answer semantics.

### 11.6.5.3. ICECandidates Command

This command allows for the object based [ICE candidates](#) [<https://rfc-editor.org/rfc/rfc8839#section-5.1>] generated after the initial Offer / Answer exchange, via a JSEP [onicecandidate](#) [<https://data-tracker.ietf.org/doc/html/rfc9429#section-4.1.20>] event, a DOM [rtcpeerconnectioniceevent](#) [<https://www.w3.org/TR/webrtc/#dom-rtcpeerconnectioniceevent>] event, or other WebRTC compliant implementations, to be added to a session during the gathering phase. This is typically used for STUN or TURN discovered candidates, or to indicate the end of gathering state.

| ID | Name                             | Type                             | Constraint | Quality | Fallback | Conformance |
|----|----------------------------------|----------------------------------|------------|---------|----------|-------------|
| 0  | <a href="#">WebRTCSes-sionID</a> | <a href="#">WebRTCSes-sionID</a> | all        |         |          | M           |

Page 908







| ID | Name          | Type                     | Constraint | Quality | Fallback | Conformance |
|----|---------------|--------------------------|------------|---------|----------|-------------|
| 1  | ICECandidates | list[ICECandidateStruct] | min 1      |         |          | M           |

This command SHALL respond with a response status of NOT\_FOUND if the WebRTCSessionID does not match an entry in [CurrentSessions](#), or if the matching entry's associated fabric and [PeerNodeID](#) do not match the accessing fabric and the Peer Node ID entry stored in the Secure Session Context of the session this command was received on.

#### 11.6.5.3.1. WebRTCSessionID Field

This field SHALL contain the [WebRTCSessionID](#) of the established WebRTC session.

#### 11.6.5.3.2. ICECandidates Field

This field SHALL contain a list of [JSEP](#) compliant [ICE Candidate Format](#) [<https://datatracker.ietf.org/doc/html/rfc9429#section-3.5.2.1>] objects.

#### 11.6.5.4. End Command

This command notifies the stream requestor that the provider has ended the WebRTC session.

| ID | Name            | Type                | Constraint | Quality | Fallback | Conformance |
|----|-----------------|---------------------|------------|---------|----------|-------------|
| 0  | WebRTCSessionID | WebRTCSessionID     | all        |         |          | M           |
| 1  | Reason          | WebRTCEndReasonEnum | all        |         |          | M           |

#### 11.6.5.4.1. WebRTCSessionID Field

This field SHALL contain the [WebRTCSessionID](#) of the established WebRTC session.

#### 11.6.5.4.2. Reason Field

This field SHALL be one of the values in [WebRTCEndReasonEnum](#).

#### 11.6.5.4.3. Effect on Receipt

The process below SHALL be followed by the server when receiving this command:

- If WebRTCSessionID does not match a value in [CurrentSessions](#):
  - Respond with a response status of NOT\_FOUND
- If the accessing Peer Node ID stored in the Secure Session Context and the accessing fabric do not match the [PeerNodeID](#) and associated fabric for the WebRTCSessionID entry in [CurrentSessions](#):



Page 909



- Respond with a response status of NOT\_FOUND
- Remove the entry in the [CurrentSessions](#) for WebRTCSessionID

## 11.7. Push AV Stream Transport Cluster

This cluster implements the upload of Audio and Video streams from the [Camera AV Stream Management Cluster](#) using suitable push-based transports. Push AV Stream Transport is the transmission of a stream of media to a server, initiated by the activation of an associated trigger. A push transport can be triggered from a camera operating in an always-on mode for supporting 24/7 style recording, triggered by events based on motion zones defined in the [Zone Management Cluster](#), or manually triggered using commands or bindings.

A push transport SHALL be allocated before it is intended to be used, and then it is subsequently started when its configured trigger is activated.

An allocated push transport consists of five main logical things:

- A container format, which specifies how the individual media frames are formatted or multiplexed together
- An ingestion format which specifies how it is signaled and transmitted to the far end.
- A trigger which specifies when transport will occur.
- Which media stream/s to package together in the container format.
- Various options to the above.

All push transport [ingest methods](#) SHALL use TLS as specified by the core specification. TLS Client Certificates SHALL be used for Authorization and Identification of a Node on the underlying TLS connection (see Chapter 14, TLS Certificate Management and TLS Client Management sections in [\[MatterCore\]](#)). Nodes supporting this cluster SHALL also support the TLS Client Management Cluster and its dependencies.

### 11.7.1. CMAF Ingestion

CMAF Ingestion as defined in [DASH-IF Live Media Ingest Protocol](#) version 1.2 and newer SHALL be supported.

Nodes SHALL support both [Interface-1: CMAF Ingest](#) [<https://dashif.org/Ingest/#interface-1>] and [Interface-2: DASH and HLS Ingest](#) [<https://dashif.org/Ingest/#interface-2>].

Nodes SHALL use [HTTP/2](#) or newer, for all CMAF Ingestion HTTP based operations.

Nodes using [CMAFIngest](#) as the ingestion method SHALL use [CMAF](#) as the [container format](#).

#### 11.7.1.1. Background

The Matter Node is considered the [CMAF ingest source](#) [<https://dashif.org/Ingest/#ingest-source>]. The [CMAF receiving-entity](#) [<https://dashif.org/Ingest/#receiving-entity>] is the server that the Matter Node will send the media stream to. The receiving-entity details along with the media streams that make up the [ingest-stream](#) [<https://dashif.org/Ingest/#ingest-stream>] are provisioned in a [TransportOptionsStruct](#).

Page 910







Matter's implementation of CMAF Ingest allows for optional end-to-end media encryption using the standard procedure defined in [CENCISOBMFF](#) and [CENC](#). [CENC](#) is an ISO standard for supporting end-to-end encryption of CMAF media files. Controllers/Ecosystems MAY utilize CENC in their deployments, but management and generation of the CENC key is outside the scope of this standard. Matter supports both initial CENC key assignment using the [CMAFContainerOptionsStruct](#) struct via the [AllocatePushTransport](#) command and CENC key-rotation by a Controller after initial provisioning using the [ModifyPushTransport](#) command. When CENC mode is active, Nodes SHALL use the AES-128 CBC [cbc](#) mode of CENC as defined in Section 10.4 of [ISO-23001:7-2023](#) or later.

In CMAF, the basic units of the protocol are Segments, Tracks, and Sessions.

#### 11.7.1.1.1. Segment

A Segment is a fixed duration [ISOBMFF](#) file which contains the Audio, Video, and/or Metadata samples themselves. A Segment MAY multiplex Audio and Video if configured to do so, otherwise the Segment would contain a single type of media.

#### 11.7.1.1.2. Track

A Track is a symbolic name applied to a sequence of one or more [Segments](#), of the same media type, from the same source. In Matter, an [Audio Stream](#) maps to an audio Track, a [Video Stream](#) maps to a video Track, and one or more [metadata content](#) maps to a metadata Track. All Segments within the same Track utilize the same fixed duration, except the last Segment which may be less than or equal to that duration. Additionally, all Segments within the same Track are sequentially numbered per the [Segment Numbering](#) rules.

#### 11.7.1.1.3. Session

A Session is defined as the set of one or more [Tracks](#), that lasts for a duration of time. The duration of a Session can be variable or fixed. The Session's duration is based on the duration of the [Trigger Type](#) that caused its transmission to occur. In Matter's CMAF usage, a Session can be considered a low level logical event, though one delineated only by Motion detection, Command invocation timings, or fixed durations.

### 11.7.1.2. Operation

CMAF at its core is a sequence of HTTP PUT/POST operations for each media [Segment](#), within each [Track](#), within each [Session](#). Every operation is sent to a unique URL, which is known as the [POST\\_URL](#) [[https://dashif.org/Ingest/#post\\_url](https://dashif.org/Ingest/#post_url)]. Each unique URL contains information about the Session, Track, and Segment. Each unique URL is comprised of two components that are concatenated together.

The first component of the [POST\\_URL](#) is a static value called the [publishing\\_point\\_URL](#) [[https://dashif.org/Ingest/#publishing\\_point\\_url](https://dashif.org/Ingest/#publishing_point_url)]. The [publishing\\_point\\_URL](#) contains the scheme, host-name of the server, and whatever initial URL path components the receiving-entity would like to receive. Typically, deployments encode user specific information or other ecosystem specific items within the initial URL path values in the [publishing\\_point\\_URL](#).

For Matter deployments, the [publishing\\_point\\_URL](#) SHALL use the [https](#) scheme, SHALL NOT contain the URL fragment character <#>, SHALL NOT contain the URL query character [?](#), and SHALL end




Page 911



with a URL forward slash character /. The publishing\_point\_URL MAY contain as many URL path components as fit within the allocated space of the [URL](#) field. Any publishing\_point\_URL issued to a Matter device SHALL allow for one or more Sessions.

An example of a publishing\_point\_url is: [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/)

The second component of the POST\_URL is a dynamically computed string that includes the [Session](#) name, [Track](#) name, and [Segment](#) name. Each of these three values are placed in that order as extended paths at the end of the publishing\_point\_URL. The Session and Segment names also contain numerically increasing portions of their string, which allows for the receiving-entity to determine the event time bounds information along with the individual segment information.

An example of the second component is: `session_1/media1/segment_1001.m4s`. In this example, `session_1` is the session name, `media1` is the track name, and `segment_1001.m4s` is the segment name.

For Matter deployments, the extended path SHALL be comprised of the three elements in the following order: `session_name/track_name/segment_name` and each sub-portions SHALL follow these rules:

`session_name`: Consists of the fixed value `session_` followed by a monotonically increasing `SessionNumber` numeric string managed by this cluster. `SessionNumber` SHALL be of type uint64 and start with value 1 when a transport is first allocated.

`track_name`: Consists of a provisioned string provided in the [TrackName](#) field.

`segment_name`: Consists of the fixed value `segment_` followed by a monotonically increasing `SegmentNumber` numeric string managed by this cluster, followed by a period `.`, followed by the media type's [Segment Extension](#).

When the fixed and variable pieces are put together the extended paths are: `session_<SessionNumber>/<TrackName>/segment_<SegmentNumber>. <SegmentExtension>`

### 11.7.1.3. Segment Numbering

In Matter's usage of CMAF, `SegmentNumber` SHALL be of type uint16 and start at 1001 for each [Track](#) within each [Session](#). In practice, a `SegmentNumber` will likely never exceed 9999 due to the Session length duration limit.

### 11.7.1.4. Segment Extension

In Matter's usage of CMAF, the following table SHALL determine the value for `SegmentExtension`:

| Extension | Mime-Type         | Usage                                  |
|-----------|-------------------|----------------------------------------|
| m4s       | video/iso.segment | When the track contains video or audio |

### 11.7.1.5. Track Naming

When using an interleaved transport where both VideoStreamID and AudioStreamID are populated

Page 912






in the `TransportOptionsStruct`, it is RECOMMENDED to use the `Track` name `media` when a single track is used, or `media<N>` if multiple interleaved tracks are used via `Session Grouping`.

When using a non-interleaved transport where only the `VideoStreamID` is populated in the `TransportOptionsStruct`, it is RECOMMENDED to use a `Track` name starting with `video` when a single track is used, or `video<N>` if multiple non-interleaved video tracks are used via `Session Grouping`.

When using a non-interleaved transport where only the `AudioStreamID` is populated in the `TransportOptionsStruct`, it is RECOMMENDED to use a `Track` name starting with `audio` when a single track is used, or `audio<N>` if multiple non-interleaved audio tracks are used via `Session Grouping`.

Implementations SHALL keep an internal value on the Transport which tracks the current `Segment Number` for the Track.

### 11.7.1.6. Session Numbering

In Matter's usage of CMAF, there are two types of `Session` durations that affect when the `Session-Number` changes for an allocated transport.

- Fixed duration Sessions are used with `Continuous` triggers. These sessions SHALL have a fixed duration of five minutes.
- Variable duration Sessions with max durations are used with `Motion` and `Command` triggers. These sessions SHALL have a minimum duration of two segments, and a maximum duration of five minutes.

Implementations SHALL keep a persisted internal mapping of the combination of `fabric-idx` and `SessionGroup Field` which stores the following values:

- A `SessionNumber` of type `uint64`.
- A `SessionStartedTimestamp` of type `systime-ms`.

`SessionNumber` SHALL initially start at 1. It SHALL increment by 1, with every Trigger activation, or if the current `SystemTimeStamp` value at the time of a transmission is greater than 5 minutes past the `SessionStartedTimestamp`. Upon incrementing the `SessionNumber`, the `SessionStartedTimestamp` SHALL be set to the current `SystemTimeStamp` value.

### 11.7.1.7. Transport Grouping via Session Grouping

In some ecosystem topologies it can be advantageous to send different streams/resolutions/encodings of the same content to different locations. For example, content analysis could be done on another Matter Node, but long term storage of the content takes place elsewhere.

Another possible topology is one where the long term storage location wants to store multiple sizes of the same content to allow for adaptive streaming playback.

Either style of deployment can be achieved by having provisioned Transports linked to each using the `Session Group` semantic. CMAF transports on the same fabric, which specify the same value for `SessionGroup`, SHALL use the same shared `session number` inside the CMAF path fields. This allows for different streams to be correlated at the CMAF server side correctly, or out-of-band synchronization of metadata produced by analysis. When Session Grouping is used, all Tracks SHALL have



Page 913



unique names.

When using the same SessionGroup number across multiple transports, Controllers SHOULD use the same Trigger setups for those transports, so that the resulting media streams line up correctly.

### 11.7.1.8. Interface-1 CMAF Examples

#### 11.7.1.8.1. Single Track

Using the examples and rules above the sequence of POST\_URL values for a three segment session using a combined audio and video track would be:

- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/media/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/media/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/media/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/media/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/media/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/media/segment_1003.m4s)

#### 11.7.1.8.2. Separate Tracks

Using the examples and rules above the sequence of POST\_URL values for a three segment session using separate tracks for audio and video would be:

- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video1/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video1/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/audio1/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/audio1/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video1/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video1/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/audio1/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/audio1/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video1/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video1/segment_1003.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/audio1/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/audio1/segment_1003.m4s)

#### 11.7.1.8.3. Separate Tracks with Multiple Video

Using the examples and rules above the sequence of POST\_URL values for a three segment session using separate tracks for audio and video would be:

- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video1/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video1/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video2/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video2/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/)

Page 914







audio1/segment\_1001.m4s

- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video1/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video1/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video2/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video2/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/audio1/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/audio1/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video1/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video1/segment_1003.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/video2/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/video2/segment_1003.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/audio1/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/audio1/segment_1003.m4s)

#### 11.7.1.8.4. Single Track over Multiple Sessions

Using the examples and rules above the sequence of POST\_URL values for three sessions of three segments each using a combined audio and video track would be:

- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/media/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/media/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/media/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/media/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_1/media/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_1/media/segment_1003.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_2/media/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_2/media/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_2/media/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_2/media/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_2/media/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_2/media/segment_1003.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_3/media/segment\\_1001.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_3/media/segment_1001.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_3/media/segment\\_1002.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_3/media/segment_1002.m4s)
- [https://ingest.example.com/provider\\_supplied\\_arbitrary\\_data/in/base/part/of/url/session\\_3/media/segment\\_1003.m4s](https://ingest.example.com/provider_supplied_arbitrary_data/in/base/part/of/url/session_3/media/segment_1003.m4s)

### 11.7.2. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.



Page 915



| Revision | Description     |
|----------|-----------------|
| 1        | Initial Release |

### 11.7.3. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | PAVST     |

### 11.7.4. Cluster ID

| ID     | Name                     |
|--------|--------------------------|
| 0x0555 | Push AV Stream Transport |

### 11.7.5. Features

This cluster SHALL support the FeatureMap bitmap attribute as defined below.

| Bit | Code        | Feature            | Conformance | Summary                                           |
|-----|-------------|--------------------|-------------|---------------------------------------------------|
| 0   | PERZONESENS | PerZoneSensitivity | O           | Supports a sensitivity value per Zone             |
| 1   | METADATA    | Metadata           | P, O        | Supports metadata transmission in Push transports |

#### 11.7.5.1. PerZoneSensitivity Feature

When this feature is supported, the [Sensitivity](#) for a Motion Trigger can be set per zone. When not supported, only a single [sensitivity](#) can be used for all Motion Triggers.

#### 11.7.5.2. Metadata Feature

When this feature is supported and a transport activates it, metadata SHALL be included within the uploaded data.

### 11.7.6. Data Types

#### 11.7.6.1. TransportTriggerTypeEnum Type

This data type is derived from enum8.

The Trigger Type determines the basic operation of the Push Transport and when it will actually transmit content.

Page 916



| Value | Name              | Summary                                          | Conformance |
|-------|-------------------|--------------------------------------------------|-------------|
| 0     | <b>Command</b>    | Triggered only via a command invocation          | M           |
| 1     | <b>Motion</b>     | Triggered via motion detection or command        | M           |
| 2     | <b>Continuous</b> | Triggered always when transport status is Active | M           |

#### 11.7.6.1.1. Command Value

When set to this value, transport will only occur if [ManuallyTriggerTransport](#) is invoked.

#### 11.7.6.1.2. Motion Value

When set to this value, transport will occur if either the Motion Detector becomes triggered, or [ManuallyTriggerTransport](#) is invoked. This is generally known as event driven recording.

#### 11.7.6.1.3. Continuous Value

When set to this value, transport will always occur so long as the [TransportStatus](#) is Active. This is generally known as 24/7 always-on recording.

### 11.7.6.2. TransportStatusEnum Type

This data type is derived from enum8.

| Value | Name            | Summary                                    | Conformance |
|-------|-----------------|--------------------------------------------|-------------|
| 0     | <b>Active</b>   | Push Transport can transport AV Streams    | M           |
| 1     | <b>Inactive</b> | Push Transport cannot transport AV Streams | M           |

### 11.7.6.3. ContainerFormatEnum Type

This data type is derived from enum8.

| Value | Name        | Summary               | Conformance |
|-------|-------------|-----------------------|-------------|
| 0     | <b>CMAF</b> | CMAF container format | M           |

#### 11.7.6.3.1. CMAF Value

CMAF (Common Media Application Format) is a container format based on the [ISO Base Media File Format](#) and is described in [MPEGCMAF](#). Nodes using CMAF as the container format SHALL also use CMAFIngest as the ingestion format.



Page 917



#### 11.7.6.4. IngestMethodsEnum Type

This data type is derived from enum8.

| Value | Name              | Summary               | Conformance |
|-------|-------------------|-----------------------|-------------|
| 0     | <b>CMAFIngest</b> | CMAF ingestion format | M           |

##### 11.7.6.4.1. CMAFIngest Value

This value SHALL mean that CMAF Ingestion is utilized. See [CMAF Ingestion](#) for full details.

#### 11.7.6.5. TriggerActivationReasonEnum Type

This data type is derived from enum8.

| Value | Name                 | Summary                                          | Conformance |
|-------|----------------------|--------------------------------------------------|-------------|
| 0     | <b>UserInitiated</b> | Trigger has been activated by user action        | M           |
| 1     | <b>Automation</b>    | Trigger has been activated by automation         | M           |
| 2     | <b>Emergency</b>     | Trigger has been activated for emergency reasons | M           |

#### 11.7.6.6. SupportedFormatStruct Type

This struct holds the combination of container format and ingest method which represents a valid combination for a transport.

| ID | Name                    | Type                                 | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------------------|--------------------------------------|------------|---------|----------|--------|-------------|
| 0  | <b>Container-Format</b> | <a href="#">Container-FormatEnum</a> | all        |         |          |        | M           |
| 1  | <b>Ingest-Method</b>    | <a href="#">Ingest-Method-Enum</a>   | all        |         |          |        | M           |

##### 11.7.6.6.1. ContainerFormat Field

This field SHALL indicate a supported [container format](#) that when combined with IngestMethod, can be used in a transport.

##### 11.7.6.6.2. IngestMethod Field

This field SHALL indicate a supported [ingest method](#) that when combined with ContainerFormat, can be used in a transport.

Page 918







### 11.7.6.7. CMAFInterfaceEnum Type

This data type is derived from `enum8`. This type indicates the exact mode of CMAF that is in use.

| Value | Name                  | Summary                                 | Conformance |
|-------|-----------------------|-----------------------------------------|-------------|
| 0     | <b>Interface1</b>     | CMAF Interface-1 Mode                   | M           |
| 1     | <b>Interface2DASH</b> | CMAF Interface-2 Mode with DASH Support | P, M        |
| 2     | <b>Interface2HLS</b>  | CMAF Interface-2 Mode with HLS Support  | P, M        |

#### 11.7.6.7.1. Interface1 Value

This value indicates that only the operations specified in [CMAF Interface-1](https://dashif.org/Ingest/#interface-1) [<https://dashif.org/Ingest/#interface-1>] will be done.

#### 11.7.6.7.2. Interface2DASH Value

This value indicates the operations specified in [CMAF Interface-2](https://dashif.org/Ingest/#interface-2) [<https://dashif.org/Ingest/#interface-2>] with the [DASH specific portions](https://dashif.org/Ingest/#dash-ingest-requirements) [<https://dashif.org/Ingest/#dash-ingest-requirements>] will be done.

#### 11.7.6.7.3. Interface2HLS Value

This value indicates the operations specified in [CMAF Interface-2](https://dashif.org/Ingest/#interface-2) [<https://dashif.org/Ingest/#interface-2>] with the [HLS specific portions](https://dashif.org/Ingest/#hls-ingest-requirements) [<https://dashif.org/Ingest/#hls-ingest-requirements>] will be done.

### 11.7.6.8. CMAFContainerOptionsStruct Type

This struct encodes options for configuration of the CMAF container format.

| ID | Name                    | Type                              | Constraint               | Quality | Fallback | Access | Conformance |
|----|-------------------------|-----------------------------------|--------------------------|---------|----------|--------|-------------|
| 0  | <b>CMAFInterface</b>    | <a href="#">CMAFInterfaceEnum</a> | all                      |         |          |        | M           |
| 1  | <b>Segment-Duration</b> | uint16                            | 500 to 65500             |         |          |        | M           |
| 2  | <b>ChunkDuration</b>    | uint16                            | 0 to (SegmentDuration/2) |         |          |        | M           |
| 3  | <b>Session-Group</b>    | uint8                             | all                      |         |          |        | M           |
| 4  | <b>Track-Name</b>       | string                            | 1 to 16                  |         |          |        | M           |
| 5  | <b>CENCKey</b>          | octstr                            | 16                       |         |          |        | P, O        |




Page 919



| ID | Name            | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------|--------|------------|---------|----------|--------|-------------|
| 6  | CENCKeyID       | octstr | 16         |         |          |        | P, CENCKey  |
| 7  | MetadataEnabled | bool   | all        |         |          |        | [META-DATA] |

#### 11.7.6.8.1. CMAFInterface Field

This field SHALL indicate the selected Interface of the CMAF container. The Interface chosen determines the number and type of operations that occur within each CMAF session. See [CMAFInterfaceEnum](#) for details on CMAF Interfaces.

#### 11.7.6.8.2. SegmentDuration Field

This field SHALL indicate the segment duration (in milliseconds) of the CMAF container. This value SHALL be a multiple of the [KeyFrameInterval](#) for the associated video stream. It is RECOMMENDED to use a value of 4000 (4 seconds).

#### 11.7.6.8.3. ChunkDuration Field

This field SHALL indicate the chunk duration (in milliseconds) of the CMAF container. A value of 0 SHALL indicate that chunks are not used.

When chunking is used, an even divisor of SegmentDuration SHOULD be used that aligns with the video frame rate and audio frame duration. RECOMMENDED values are 1/2, 1/4, or 1/8 of the SegmentDuration depending on the end to end latency requirements needed. Each chunk results in an additional 144 bytes of overhead in the resulting file.

#### 11.7.6.8.4. SessionGroup Field

This field SHALL identify the grouping semantic of the CMAF [Session](#) numbering between various CMAF transports on the same Fabric. See [Session Grouping](#) for more details.

#### 11.7.6.8.5. TrackName Field

This field SHALL identify the CMAF [Track](#) name value used inside the CMAF computed extended path fields portion of the CMAF POST\_URL. See [Track Naming](#) for full details.

#### 11.7.6.8.6. CENCKey Field

This field, if present, SHALL indicate the [CENC](#) key to be used to encrypt the CMAF data. When absent, the CMAF data SHALL be sent without CENC encryption added. See [CMAF Background](#) for further details on CMAF CENC encryption.

#### 11.7.6.8.7. CENCKeyID Field

This field, if present, SHALL indicate the opaque [CENC](#) Key ID (KID) that represents the key in the Controllers ecosystem. This field maps to the KID value as specified in ISO 23001-7:2023 or later.

Page 920







See [CMAF Background](#) for further details on CMAF CENC encryption.

#### 11.7.6.8.8. MetadataEnabled Field

This field, if present and true, indicates that [AVMetadataStruct](#) based Metadata tracks and boxes MAY be included in the CMAF segments. If this field is not present or is false, metadata tracks and boxes SHALL NOT be included.

Metadata within CMAF segments when used, SHALL be encoded as follows:

- Use `urim` as the codec-type.
- Use `meta` as the content-type.
- Use `urn:csa:matter:av-metadata` as the uri.

Placement of the metadata SHALL be as follows:

- Use a single Track for time-synced data points as described in [CMAF-Ingest Interface-1 Section 6.6 Requirements for Timed Metadata Tracks](#) [<https://dashif.org/Ingest/#interface-1-timed-metadata>].
- Use a single Box for non-time synced data points.

#### 11.7.6.9. ContainerOptionsStruct Type

This struct encodes the specific container type options struct

| ID | Name                        | Type                                       | Constraint | Quality | Fallback | Access | Conformance           |
|----|-----------------------------|--------------------------------------------|------------|---------|----------|--------|-----------------------|
| 0  | <b>ContainerType</b>        | <a href="#">ContainerFormatEnum</a>        | all        |         |          |        | M                     |
| 1  | <b>CMAFContainerOptions</b> | <a href="#">CMAFContainerOptionsStruct</a> |            |         |          |        | ContainerType == CMAF |

##### 11.7.6.9.1. ContainerType Field

This field SHALL indicate the container type chosen for this transport.

##### 11.7.6.9.2. CMAFContainerOptions Field

This field SHALL contain a [CMAF Container Options](#) if the ContainerType is set to CMAF, otherwise this field SHALL be omitted.

#### 11.7.6.10. TransportZoneOptionsStruct Type

This struct encodes the options that configure the per [Zone](#) portion of a Trigger configuration.




Page 921



| ID | Name               | Type   | Constraint | Quality | Fallback | Access | Conformance  |
|----|--------------------|--------|------------|---------|----------|--------|--------------|
| 0  | <b>Zone</b>        | ZoneID | all        | X       |          |        | M            |
| 1  | <b>Sensitivity</b> | uint8  | 1 to 10    |         |          |        | PERZONE-SENS |

#### 11.7.6.10.1. Zone Field

This field SHALL be a [Motion ZoneID](#) found in the [Zone Management Cluster](#) which SHALL cause the trigger to activate. If not null, motion in this zone will activate the trigger. If null, motion anywhere in the complement of the union of all the [Zones](#) defined in the [Zone Management Cluster](#) on this endpoint will activate the trigger.

#### 11.7.6.10.2. Sensitivity Field

This field SHALL indicate how sensitive the trigger for the specified Zone is, and SHALL match the same implementation specifics as the [Sensitivity](#) attribute in the [Zone Management Cluster](#). This field SHALL only be included when [PerZoneSensitivity](#) is supported, otherwise the value from [MotionSensitivity](#) is used.

#### 11.7.6.11. TransportTriggerOptionsStruct Type

This struct encodes the conditions and options that configures the trigger for the push transport. The transport SHALL only start transmitting AV Streams when it's associated trigger is activated.

| ID | Name                      | Type                                       | Constraint | Quality | Fallback | Access | Conformance                            |
|----|---------------------------|--------------------------------------------|------------|---------|----------|--------|----------------------------------------|
| 0  | <b>Trigger-Type</b>       | Transport-Trigger-TypeEnum                 | all        |         |          |        | M                                      |
| 1  | <b>Motion-Zones</b>       | list[TransportZoneOptionsStruct]           |            | X       |          |        | Trigger-Type == Motion                 |
| 2  | <b>Motion-Sensitivity</b> | uint8                                      | 1 to 10    | X       |          |        | Trigger-Type == Motion & !PERZONE-SENS |
| 3  | <b>Motion-TimeControl</b> | Transport-Motion-Trigger-TimeControlStruct |            |         |          |        | Trigger-Type == Motion                 |

Page 922







| ID | Name                 | Type   | Constraint | Quality | Fallback | Access | Conformance                                    |
|----|----------------------|--------|------------|---------|----------|--------|------------------------------------------------|
| 4  | <b>MaxPreRollLen</b> | uint16 | all        |         |          |        | TriggerType == Command   TriggerType == Motion |

#### 11.7.6.11.1. TriggerType Field

This field SHALL indicate the type of the transport trigger.

#### 11.7.6.11.2. MotionZones Field

This field SHALL be a list of [TransportZoneOptionsStruct](#) containing the [Motion](#) Zones to trigger on. If this list is null, empty, or the [Zone Management Cluster](#) is not supported on this endpoint, then motion anywhere SHALL cause the trigger to activate. The maximum size of this list is [MaxZones](#).

#### 11.7.6.11.3. MotionSensitivity Field

This field SHALL indicate how sensitive the trigger is to motion and SHALL match the same implementation specifics as [Sensitivity](#). This field SHALL NOT be used if the [PerZoneSensitivity](#) feature is supported, as a Zone specific value is available in the [TransportZoneOptionsStruct Sensitivity](#) field. If this is null and the [Zone Management Cluster](#) is supported on this endpoint, then the value found in the [Sensitivity](#) attribute in the [Zone Management Cluster](#) SHALL be used. If this is null and the [Zone Management Cluster](#) is not supported on this endpoint, a value of 10 SHALL be used.

#### 11.7.6.11.4. MotionTimeControl Field

This field SHALL control timing around repeated activation of the trigger (see [TransportMotionTriggerTimeControlStruct](#)). If [TriggerType](#) is [Motion Value](#), this field SHALL be required.

#### 11.7.6.11.5. MaxPreRollLen Field

This field SHALL indicate the maximum duration in milliseconds of pre-roll content that can be included, if the [TriggerType](#) is [Motion Value](#) or [Command Value](#), when the trigger activates.

A value of 0 SHALL indicate that no extra segments beyond the one containing the trigger point will be sent.

When using a non 0 value, the value SHALL be greater than or equal to the value of the stream's [KeyFrameInterval](#) and it SHOULD be a multiple of that value if larger.

The actual amount transmitted will always be less than or equal to the per stream storage amount found in the [MaxContentBufferSize](#).

Since a transmission caused by a trigger activation always begins on the Container Format's segment (or [key-frame](#)) boundary, if the trigger occurs mid segment, the entire segment still needs to be sent. This time delta between the actual trigger point and the start of the segment is counted as




Page 923



part of the pre-roll length. Thus, for more than the current segment to be sent as pre-roll, the full size of a segment must fit within the remainder of this length. For this reason, it is RECOMMENDED that a value of at least two times [SegmentDuration](#) be used so that a full segment is always included if available.

#### 11.7.6.12. **TransportMotionTriggerTimeControlStruct** Type

This struct is used to encode a set of values for controlling the lifecycle of a motion triggered transport.

| ID | Name                        | Type      | Constraint | Quality | Fallback | Access | Conformance |
|----|-----------------------------|-----------|------------|---------|----------|--------|-------------|
| 0  | <b>InitialDuration</b>      | uint16    | min 1      |         |          |        | M           |
| 1  | <b>AugmentationDuration</b> | uint16    | all        |         |          |        | M           |
| 2  | <b>MaxDuration</b>          | elapsed-s | min 1      |         |          |        | M           |
| 3  | <b>BlindDuration</b>        | uint16    | all        |         |          |        | M           |

When a Motion Trigger is activated, either by receiving a [ManuallyTriggerTransport](#) command, or when motion is initially detected which matches a configured motion trigger, the Node SHALL start the push transport configured with this trigger see ([TransportOptionsStruct](#)).

This places the Node in a Motion Detected state, at which point the Node SHALL internally track two values.

##### **TimeSinceActivation**

The time in seconds since the trigger was activated.

##### **MotionDetectedDuration**

Initially set to the InitialDuration value.

However, if additional motion is detected during this period, the Node SHALL increase the MotionDetectedDuration value by the AugmentationDuration value. This process may occur repeatedly but after the first increase of MotionDetectedDuration the Node SHALL NOT increase the MotionDetectedDuration value unless the previous MotionDetectedDuration has been exceeded by the TimeSinceActivation.

If the TimeSinceActivation value exceeds the MaxDuration or MotionDetectedDuration value, the Node SHALL stop detecting motion for this trigger for the period of the BlindDuration value.

Since multiple triggers (and corresponding push transports) may be activated by the same motion, the Node SHALL perform this process independently for each motion trigger activated.

Page 924







#### 11.7.6.12.1. InitialDuration Field

This field SHALL indicate the initial duration in seconds after motion is first detected before the Node could emit a MotionStopped event.

#### 11.7.6.12.2. AugmentationDuration Field

This field SHALL indicate the duration in seconds that the MotionDetectedDuration value is to be extended by if motion is still detected during this period.

#### 11.7.6.12.3. MaxDuration Field

This field SHALL indicate the maximum duration in seconds after initial motion detection that additional motion will be detected. The MaxDuration field value SHALL be greater or equal to the InitialDuration field value.

#### 11.7.6.12.4. BlindDuration Field

This field SHALL indicate the duration in seconds after a transport finishes transmitting that the Node SHALL NOT activate the trigger again.

### 11.7.6.13. TransportOptionsStruct Type

This encodes the options and configuration of a transport.

| ID | Name             | Type                          | Constraint | Quality | Fallback | Access | Conformance |
|----|------------------|-------------------------------|------------|---------|----------|--------|-------------|
| 0  | StreamUsage      | StreamUsageEnum               | all        |         |          |        | M           |
| 1  | VideoStreamID    | VideoStreamIDType             | all        | X       |          |        | O.a+        |
| 2  | AudioStreamID    | AudioStreamIDType             | all        | X       |          |        | O.a+        |
| 3  | TLSEndpointID    | TLSEndpointID                 | 0 to 65534 |         |          |        | M           |
| 4  | URL              | string                        | 13 to 2000 |         |          |        | M           |
| 5  | TriggerOptions   | TransportTriggerOptionsStruct |            |         |          |        | M           |
| 6  | IngestMethod     | IngestMethodEnum              | all        |         |          |        | M           |
| 7  | ContainerOptions | ContainerOptionsStruct        |            |         |          |        | M           |




Page 925



| ID | Name        | Type    | Constraint | Quality | Fallback | Access | Conformance |
|----|-------------|---------|------------|---------|----------|--------|-------------|
| 8  | Expiry-Time | epoch-s | all        |         |          |        | 0           |

#### 11.7.6.13.1. StreamUsage Field

This field contains the [StreamUsageEnum](#) of this transport.

#### 11.7.6.13.2. VideoStreamID Field

This field SHALL have the following semantics:

- If not present, video isn't requested.
- If present and null, automatic video stream assignment is requested.
- If present and non-null, the specific video stream identified by the [VideoStreamIDType](#) is requested.

#### 11.7.6.13.3. AudioStreamID Field

This field SHALL have the following semantics:

- If not present, audio isn't requested.
- If present and null, automatic audio stream assignment is requested.
- If present and non-null, the specific audio stream identified by the [AudioStreamIDType](#) is requested.

#### 11.7.6.13.4. TLSEndpointID Field

This field SHALL be a TLSEndpointID representing a provisioned TLS Endpoint, which SHALL have valid TLSCAID and TLSCCDID values (see Chapter 14, Certificate Authority ID (CAID) Mapping and the ProvisionEndpoint command in the TLS Client Management Cluster sections in [\[MatterCore\]](#)).

#### 11.7.6.13.5. URL Field

This field SHALL be a valid string in [RFC 3986](#) format representing the upload location. The field SHALL use the [https](#) scheme which will be validated by the underlying TLSEndpointID.

When the IngestMethod is CMAFIngest, this SHALL be the CMAF [publishing\\_point\\_URL](#) [[https://dashif.org/Ingest/#publishing\\_point\\_url](https://dashif.org/Ingest/#publishing_point_url)] to transport the AV Stream to. The URL length does not need to include space for the full CMAF POST\_URL fields which specify the session, track, and segment names as these will be internally appended.

#### 11.7.6.13.6. TriggerOptions Field

This field SHALL be of type [TransportTriggerOptionsStruct](#) and represents the Trigger Type and its sub options.

Page 926







**11.7.6.13.7. IngestMethod Field**

This field SHALL be of type [IngestMethodsEnum](#) and represents the Ingest Method to be used.

**11.7.6.13.8. ContainerOptions Field**

This field SHALL be of type [ContainerOptionsStruct](#) and represents the type of Push AV Stream Container to be uploaded and any additional options relating to the Container Format used.

**11.7.6.13.9. ExpiryTime Field**

This field SHALL be an unsigned 32 bit integer representing the TTL in seconds of a transport allocation. If not present, the transport SHALL never expire.

**11.7.6.14. TransportConfigurationStruct Type**

This encodes the current configuration of an allocated transport.

| Access Modifier: Fabric Scoped |                  |                           |            |         |          |        |             |
|--------------------------------|------------------|---------------------------|------------|---------|----------|--------|-------------|
| ID                             | Name             | Type                      | Constraint | Quality | Fallback | Access | Conformance |
| 0                              | ConnectionID     | PushTransportConnectionID | 0 to 65534 |         |          |        | M           |
| 1                              | TransportStatus  | TransportStatusEnum       | all        |         |          |        | M           |
| 2                              | TransportOptions | TransportOptionsStruct    |            |         |          |        | O           |

**11.7.6.14.1. ConnectionID Field**

This field SHALL be a [PushTransportConnectionID](#) representing a unique transport.

**11.7.6.14.2. TransportStatus Field**

This field SHALL represent the [Stream Transport Status](#) of the transport.

**11.7.6.14.3. TransportOptions Field**

This field SHALL represent the [Stream Transport Options](#) of the transport.

**11.7.6.15. PushTransportConnectionID Type**

This data type is derived from uint16.

It represents an allocated transport. This value starts at 0 and monotonically increases by 1 with each new allocation provisioned by the Node. A value incremented past 65534 SHALL wrap to 0. The Node SHALL verify that the incremented ID does not match any other ID. If such a match is




Page 927



found, the ID SHALL be incremented until a unique ID is found.

## 11.7.7. Status Codes

### 11.7.7.1. StatusCodeEnum Type

This data type is derived from enum8.

| Value | Name                          | Summary                                                                              | Conformance |
|-------|-------------------------------|--------------------------------------------------------------------------------------|-------------|
| 0x02  | <b>InvalidTLSEndpoint</b>     | The specified TLSEndpointID cannot be found.                                         | M           |
| 0x03  | <b>InvalidStream</b>          | The specified VideoStreamID or AudioStreamID cannot be found.                        | M           |
| 0x04  | <b>InvalidURL</b>             | The specified URL is invalid.                                                        | M           |
| 0x05  | <b>InvalidZone</b>            | A specified ZoneID was invalid.                                                      | M           |
| 0x06  | <b>InvalidCombination</b>     | The specified combination of Ingestion method and Container format is not supported. | M           |
| 0x07  | <b>InvalidTriggerType</b>     | The trigger type is invalid for this command.                                        | M           |
| 0x08  | <b>InvalidTransportStatus</b> | The Stream Transport Status is invalid for this command.                             | M           |
| 0x09  | <b>InvalidOptions</b>         | The requested Container options are not supported with the streams indicated.        | M           |
| 0x0A  | <b>InvalidStreamUsage</b>     | The requested StreamUsage is not allowed.                                            | M           |
| 0x0B  | <b>InvalidTime</b>            | Time sync has not occurred yet.                                                      | M           |

### 11.7.8. Attributes

Page 928







| ID     | Name                      | Type                                                 | Constraint | Quality | Fallback | Access | Conformance |
|--------|---------------------------|------------------------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>SupportedFormats</b>   | list[ <a href="#">SupportedFormatStruct</a> ]        | min 1      | F       |          | R V    | M           |
| 0x0001 | <b>CurrentConnections</b> | list[ <a href="#">TransportConfigurationStruct</a> ] | desc       | N       |          | R V S  | M           |

#### 11.7.8.1. SupportedFormats Attribute

This attribute SHALL contain a list of [Supported Container Format](#) structs, which represents the combinations of Ingestion Method and Container Format that the Node supports. Nodes SHALL support at least the combination [CMAFIngest,CMAF](#).

#### 11.7.8.2. CurrentConnections Attribute

This attribute SHALL be a list of [TransportConfigurationStruct](#) which represents all the allocated connections added via [AllocatePushTransport](#). When this attribute is read over a non Large Message (See Large Message Quality in the Data Model section of [\[MatterCore\]](#)) capable transport, the TransportOptions field SHALL NOT be included. To get the full details of the connections use the [FindTransport](#) command. The maximum size of this list is run-time dependent upon the resource constraints of the system as described in [Resource Management and Stream Priorities](#) and the currently used bandwidth of the total available specified by [MaxNetworkBandwidth](#).

### 11.7.9. Commands

| ID   | Name                                 | Direction       | Response                      | Access | Quality | Conformance |
|------|--------------------------------------|-----------------|-------------------------------|--------|---------|-------------|
| 0x00 | <b>AllocatePushTransport</b>         | client → server | AllocatePushTransportResponse | M F    | L       | M           |
| 0x01 | <b>AllocatePushTransportResponse</b> | server → client | N                             |        | L       | M           |
| 0x02 | <b>DeallocatePushTransport</b>       | client → server | Y                             | M F    |         | M           |
| 0x03 | <b>ModifyPushTransport</b>           | client → server | Y                             | M F    |         | M           |




Page 929



| ID   | Name                            | Direction                   | Response              | Access | Quality | Conformance |
|------|---------------------------------|-----------------------------|-----------------------|--------|---------|-------------|
| 0x04 | <b>SetTransportStatus</b>       | client $\Rightarrow$ server | Y                     | M F    |         | M           |
| 0x05 | <b>ManuallyTriggerTransport</b> | client $\Rightarrow$ server | Y                     | O F    |         | M           |
| 0x06 | <b>FindTransport</b>            | client $\Rightarrow$ server | FindTransportResponse | O F    | L       | M           |
| 0x07 | <b>FindTransportResponse</b>    | server $\Rightarrow$ client | N                     |        | L       | M           |

### 11.7.9.1. AllocatePushTransport Command

This command SHALL allocate a transport and return a [PushTransportConnectionID](#).

| ID | Name                    | Type                                   | Constraint | Quality | Fallback | Conformance |
|----|-------------------------|----------------------------------------|------------|---------|----------|-------------|
| 0  | <b>TransportOptions</b> | <a href="#">TransportOptionsStruct</a> |            |         |          | M           |

#### 11.7.9.1.1. TransportOptions Field

This field SHALL represent the configuration options of the transport to be allocated.

#### 11.7.9.1.2. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If the UTCTime attribute of the Time Synchronization cluster is null:
  - Fail the command with the cluster-specific status code of InvalidTime, and end processing with no other side effects.
- If an entry for the [TLSEndpointID](#) field, of the passed in *TransportOptions*, is not found in the ProvisionedEndpoints list attribute of the TLS Client Management Cluster:
  - Fail the command with the cluster-specific status code of InvalidTLSEndpoint, and end processing with no other side effects.
- If the associated fabric of that entry does not match the accessing fabric:
  - Fail the command with the cluster-specific status code of InvalidTLSEndpoint, and end processing with no other side effects.
- If that entry does not contain a valid non-null CCDID:
  - Fail the command with the cluster-specific status code of InvalidTLSEndpoint, and end processing with no other side effects.

Page 930



- cessing with no other side effects.
- If the requested combination of [IngestMethod](#) and [ContainerType](#) from the [ContainerOptions](#) fields, of the passed in *TransportOptions*, is not in [SupportedContentFormats](#):
    - Fail the command with the cluster-specific status code of `InvalidCombination`, and end processing with no other side effects.
  - If the URL is invalid:
    - Fail the command with the cluster-specific status code of `InvalidURL`, and end processing with no other side effects.
  - If the *StreamUsage* field's value is not present in the [StreamUsagePriorities](#) list:
    - Fail the command with the cluster-specific status code of `InvalidStreamUsage`, and end processing with no other side effects.
  - If the [MotionZones](#) field is present in the *TriggerOptions* field of *TransportOptions*:
    - If there are any entries with duplicate values for the [Zone](#) field in [MotionZones](#):
      - Fail the command with the status code `ALREADY_EXISTS`, and end processing with no other side effects.
    - If the length of the [MotionZones](#) list is greater than [MaxZones](#):
      - Fail the command with the status code `DYNAMIC_CONSTRAINT_ERROR`, and end processing with no other side effects.
    - If the [MotionZones](#) list in the *TriggerOptions* field of *TransportOptions* contains an invalid [ZoneID](#):
      - Fail the command with the cluster-specific status code of `InvalidZone`, and end processing with no other side effects.
  - If this new transport would exceed the [bandwidth limits](#):
    - Fail the command with `RESOURCE_EXHAUSTED`, and end processing with no other side effects.
  - If the [VideoStreamID](#) field of the passed in *TransportOptions* is present and null:
    - If [AllocatedVideoStreams](#) is empty:
      - Fail the command with the status code `INVALID_IN_STATE`, and end processing with no other side effects.
    - Automatically select an existing [video stream](#) per the [Resource Management and Stream Priorities](#).
    - Save the resulting [VideoStreamID](#) into the *TransportOptions*.
  - If the [AudioStreamID](#) field of the passed in *TransportOptions* is present and null:
    - If [AllocatedAudioStreams](#) is empty:
      - Fail the command with the status code `INVALID_IN_STATE`, and end processing with no other side effects.
    - Automatically select an existing [audio stream](#) per the [Resource Management and Stream Priorities](#).



Page 931



- Save the resulting [AudioStreamID](#) into the *TransportOptions*.
- If the [VideoStreamID](#) field of the passed in *TransportOptions* is present, and an entry for it is not found in the [AllocatedVideoStreams](#) list:
  - Fail the command with the cluster-specific status code of [InvalidStream](#), and end processing with no other side effects.
- If the [AudioStreamID](#) field of the passed in *TransportOptions* is present, and an entry for it is not found in the [AllocatedAudioStreams](#) list:
  - Fail the command with the cluster-specific status code of [InvalidStream](#), and end processing with no other side effects.
- If the ContainerOptions [ContainerType](#) is [CMAF](#):
  - If the requested [SegmentDuration](#) is not a multiple of [KeyFrameInterval](#):
    - Fail the command with the cluster-specific status code of [InvalidOptions](#), and end processing with no other side effects.
- Create a new [PushTransportConnectionID](#)
- Using the [TLSEndpointID](#) field of the passed in *TransportOptions*, increment the [ReferenceCount](#) field of the matching [EndpointID](#) entry in the TLS Client Management Cluster's [ProvisionedEndpoints](#) list.
- Allocate a new [TransportConfigurationStruct](#) associated with the accessing fabric and set the [ConnectionID](#) and [TransportOptions](#) fields of that struct to the new values.
- Set the [TransportStatus](#) field of the new [TransportConfigurationStruct](#) to [Inactive](#).
- Persistently store the resulting [TransportConfigurationStruct](#).
- Update the contents of the [CurrentConnections](#) list attribute to include the new entry.
- If the [TransportOptions](#) field has a non null [ExpiryTime](#) field:
  - Keep track of the time in seconds since allocation for this transport, and once this exceeds the [ExpiryTime](#) the Node SHALL stop any transport for this transport and deallocate it.
- Return the resulting [TransportConfigurationStruct](#) of this allocation in the corresponding [AllocatePushTransportResponse](#) command.

On reboot the Node SHALL restart any transports which were transporting previously.

#### 11.7.9.2. AllocatePushTransportResponse Command

This command SHALL be generated in response to a successful [AllocatePushTransport](#) command.

| ID | Name                                    | Type                                          | Constraint | Quality | Fallback | Conformance |
|----|-----------------------------------------|-----------------------------------------------|------------|---------|----------|-------------|
| 0  | <a href="#">Transport-Configuration</a> | <a href="#">Transport-ConfigurationStruct</a> |            |         |          | M           |

Page 932



#### 11.7.9.2.1. TransportConfiguration Field

This field SHALL be a [TransportConfigurationStruct](#) representing the newly allocated transport. If automatic stream selection was requested, the used Stream ID fields will be present in the TransportOptions field.

#### 11.7.9.3. DeallocatePushTransport Command

This command SHALL be generated to request the Node deallocates the specified transport.

| ID | Name         | Type                      | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------------|------------|---------|----------|-------------|
| 0  | ConnectionID | PushTransportConnectionID | 0 to 65534 |         |          | M           |

##### 11.7.9.3.1. ConnectionID Field

This field SHALL be a [PushTransportConnectionID](#) representing the allocated transport to deallocate.

##### 11.7.9.3.2. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If no entry can be found for the passed in *ConnectionID* in the [CurrentConnections](#) list attribute:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the associated fabric of that entry is not the accessing fabric:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the transport is currently uploading:
  - Fail the command with the status code BUSY, and end processing with no other side effects.
- Remove that entry from the [CurrentConnections](#) list attribute.
- Using the [TLSEndpointID](#) field of that entry, decrement the ReferenceCount field of the matching EndpointID entry in the TLS Client Management Cluster's ProvisionedEndpoints list.
- Deallocate the transport using the passed in *ConnectionID*.

#### 11.7.9.4. ModifyPushTransport Command

This command is used to request the Node modifies the configuration of the specified push transport.



Page 933



| ID | Name             | Type                      | Constraint | Quality | Fallback | Conformance |
|----|------------------|---------------------------|------------|---------|----------|-------------|
| 0  | ConnectionID     | PushTransportConnectionID | 0 to 65534 |         |          | M           |
| 1  | TransportOptions | TransportOptionsStruct    |            |         |          | M           |

#### 11.7.9.4.1. ConnectionID Field

This field SHALL be a [PushTransportConnectionID](#) representing the transport to modify.

#### 11.7.9.4.2. TransportOptions Field

This field SHALL represent the [Transport Options](#) to modify.

#### 11.7.9.4.3. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If the UTCTime attribute of the Time Synchronization cluster is null:
  - Fail the command with the cluster-specific status code of InvalidTime, and end processing with no other side effects.
- If no entry can be found for the passed in *ConnectionID* in the [CurrentConnections](#) list attribute:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the associated fabric of that entry is not the accessing fabric:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the transport is currently uploading:
  - Fail the command with the status code BUSY, and end processing with no other side effects.
- On that entry, update the [TransportOptions](#) field, of the [TransportConfiguration](#) field, to the passed in *TransportOptions*.

#### 11.7.9.5. SetTransportStatus Command

This command SHALL be generated to request the Node modifies the Transport Status of a specified transport or all transports.

| ID | Name         | Type                      | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------------|------------|---------|----------|-------------|
| 0  | ConnectionID | PushTransportConnectionID | all        | X       |          | M           |

Page 934







| ID | Name                   | Type                                | Constraint | Quality | Fallback | Conformance |
|----|------------------------|-------------------------------------|------------|---------|----------|-------------|
| 1  | <b>TransportStatus</b> | <a href="#">TransportStatusEnum</a> | all        |         |          | M           |

#### 11.7.9.5.1. ConnectionID Field

This field SHALL be a [PushTransportConnectionID](#) representing the transport to modify. If null is passed, all transports belonging to the calling fabric will be modified.

#### 11.7.9.5.2. TransportStatus Field

This field SHALL be a [TransportStatusEnum](#) and represent the new transport status to apply.

#### 11.7.9.5.3. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If the passed in *TransportStatus* is set to Active, and the UTCTime attribute of the Time Synchronization cluster is null:
  - Fail the command with the cluster-specific status code of InvalidTime, and end processing with no other side effects.
- Create a temporary list
- If the passed in *ConnectionID* field is null:
  - For each entry in [CurrentConnections](#):
    - If the associated fabric of that entry is the accessing fabric:
      - Add the [ConnectionID](#) of that entry to the temporary list.
  - Else:
    - If no entry can be found for the passed in *ConnectionID* in the [CurrentConnections](#) list:
      - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
    - If the associated fabric of that entry is not the accessing fabric:
      - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
      - Add *ConnectionID* to the temporary list
- For each [PushTransportConnectionID](#) in the temporary list:
  - If the passed in *TransportStatus* field is set to Inactive:
    - Disable transmissions on the transport identified by the id.
    - Remove any queued items for upload on the transport.
    - Terminate any uploads currently in progress by using the HTTP/2 stream cancel process, as defined in Section 6.4 of [RFC 9113](#).




Page 935



- Else if the passed in *TransportStatus* field is set to Active:
  - Enable transmissions on the transport identified by the id.
  - If all [Privacy Related attributes](#) are False:
    - If the transport's trigger type is [Continuous](#):
      - Begin transmission immediately.
    - Else if the transport's trigger type is [Command](#) or [Motion](#), and the underlying trigger is currently active and still within the [Time Control Bounds](#):
      - Begin transmission immediately.
- Set [TransportStatus](#) of the transport identified by the id to the value in the [TransportStatus](#) field of this command.

#### 11.7.9.6. ManuallyTriggerTransport Command

This command SHALL be generated to request the Node to manually start the specified push transport.

| ID | Name                     | Type                                                       | Constraint | Quality | Fallback | Conformance |
|----|--------------------------|------------------------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>Connec-tionID</b>     | <a href="#">PushTrans-portConnec-tionID</a>                | 0 to 65534 |         |          | M           |
| 1  | <b>Activation-Reason</b> | <a href="#">TriggerActi-vationReaso-nEnum</a>              | all        |         |          | M           |
| 2  | <b>TimeCon-trol</b>      | <a href="#">Transport-MotionTrig-gerTimeCon-trolStruct</a> |            |         |          | O           |
| 3  | <b>UserDefined</b>       | octstr                                                     | max 256    |         |          | [METADATA]  |

##### 11.7.9.6.1. ConnectionID Field

This field SHALL be a [PushTransportConnectionID](#) representing the push transport to start or stop.

##### 11.7.9.6.2. ActivationReason Field

This field SHALL provide information as to why the transport was started or stopped.

##### 11.7.9.6.3. TimeControl Field

This field SHALL be a struct of type [TransportMotionTriggerTimeControlStruct](#), but the [BlindDuration](#) field SHALL be ignored.

Page 936







#### 11.7.9.6.4. UserDefined Field

This field SHALL be an octet string representing arbitrary format user defined metadata that will be included in the recording via the [UserDefined Field](#) field of [AVMetadataStruct](#). The format and meaning of this field is not defined in this specification and is up to the users, vendors, or ecosystems deploying it.

#### 11.7.9.6.5. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If the UTCTime attribute of the Time Synchronization cluster is null:
  - Fail the command with the cluster-specific status code of InvalidTime, and end processing with no other side effects.
- If no mapping can be found for the ConnectionID:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If the associated fabric of the entry in the [CurrentConnections](#) attribute which is identified by ConnectionID is not the accessing fabric:
  - Fail the command with the status code NOT\_FOUND, and end processing with no other side effects.
- If [HardPrivacyModeOn](#) is true:
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If [SoftLivestreamPrivacyModeEnabled](#) is true and [StreamUsage Field](#) for the ConnectionID is [LiveView](#):
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If [SoftRecordingPrivacyModeEnabled](#) is true and [StreamUsage Field](#) for the ConnectionID is [Recording or Analysis](#):
  - Fail the command with the status code INVALID\_IN\_STATE, and end processing with no other side effects.
- If the transport is already transmitting:
  - Fail the command with the status code BUSY, and end processing with no other side effects.
- If the [TransportStatus](#) of the push transport is Inactive:
  - Fail the command with a cluster-specific status code of InvalidTransportStatus, and end processing with no other side effects.
- If the trigger type for the specified transport is [Continuous](#):
  - Fail the command with a cluster-specific status code of InvalidTriggerType, and end processing with no other side effects.
- If the trigger type for the specified transport is [Command](#) and the TimeControl field is not present:



Page 937



- Fail the command with the status code `DYNAMIC_CONSTRAINT_ERROR`, and end processing with no other side effects.
- If the `TimeControl` field is not present:
  - Look up the `MotionTimeControl` field in the in the allocated `ConnectionID` and use those values as the `TimeControl`.
- Begin transmission using the `TimeControl` values, but ignore the `BlindDuration` field.
- Generate a `PushTransportBegin` event with `ConnectionID` set to the `ConnectionID` field of this command, the `ActivationReason` field set to the `ActivationReason` field of this command and the `TriggerType` field set to `Command`.
- Asynchronously generate the `PushTransportEnd` event as normal when the `TimeControl` values indicate this transmission will end.

### 11.7.9.7. FindTransport Command

This command SHALL return the `Transport Configuration` for the specified push transport or all allocated transports for the fabric if null.

| ID | Name         | Type                      | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------------|------------|---------|----------|-------------|
| 0  | ConnectionID | PushTransportConnectionID | all        | X       |          | M           |

#### 11.7.9.7.1. ConnectionID Field

This field SHALL be a `PushTransportConnectionID` or NULL representing the allocated push transport.

#### 11.7.9.7.2. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If `ConnectionID` is null:
  - If the `CurrentConnections` list is empty:
    - Fail the command with the status code `NOT_FOUND`.
  - For each entry in `CurrentConnections`:
    - If the associated fabric of the entry matches the accessing fabric:
      - Add the full `TransportConfigurationStruct` to the resulting list.
- Else if `ConnectionID` is not null:
  - If an entry matching `ConnectionID` is not found in the `CurrentConnections` list:
    - Fail the command with the status code `NOT_FOUND`.
  - If the associated fabric of the matching list entry does not match the accessing fabric:
    - Fail the command with the status code `NOT_FOUND`.

Page 938



- Add a single entry to the resulting list containing the full [Transport Configuration](#) that matches ConnectionID.
- If the resulting list is empty:
  - Fail the command with the status code NOT\_FOUND.
- Return the resulting list in the corresponding [FindTransportResponse](#) command.

#### 11.7.9.8. FindTransportResponse Command

This command SHALL be generated in response to a successful [FindTransport](#) command.

| ID | Name                           | Type                                                 | Constraint | Quality | Fallback | Conformance |
|----|--------------------------------|------------------------------------------------------|------------|---------|----------|-------------|
| 0  | <b>TransportConfigurations</b> | list[ <a href="#">TransportConfigurationStruct</a> ] |            |         |          | M           |

##### 11.7.9.8.1. TransportConfigurations Field

This field SHALL be a list of [Transport Configurations](#).

#### 11.7.10. Events

| ID   | Name                      | Priority | Quality | Access | Conformance |
|------|---------------------------|----------|---------|--------|-------------|
| 0x00 | <b>PushTransportBegin</b> | INFO     |         | V      | M           |
| 0x01 | <b>PushTransportEnd</b>   | INFO     |         | V      | M           |

##### 11.7.10.1. PushTransportBegin Event

This event SHALL indicate a push transport transmission has begun.

The data on this event SHALL contain the following information.

| ID | Name                    | Type                                        | Constraint | Quality | Fallback | Conformance            |
|----|-------------------------|---------------------------------------------|------------|---------|----------|------------------------|
| 0  | <b>ConnectionID</b>     | <a href="#">PushTransportConnectionID</a>   | 0 to 65534 |         |          | M                      |
| 1  | <b>TriggerType</b>      | <a href="#">TransportTriggerTypeEnum</a>    | all        |         |          | M                      |
| 2  | <b>ActivationReason</b> | <a href="#">TriggerActivationReasonEnum</a> | all        |         |          | TriggerType == Command |



Page 939



#### 11.7.10.1.1. ConnectionID Field

This field SHALL be a [PushTransportConnectionID](#) representing the push transport which started transmitting.

#### 11.7.10.1.2. TriggerType Field

This field SHALL represent the type of trigger which caused this event to be emitted.

#### 11.7.10.1.3. ActivationReason field

This field SHALL only be present when the TriggerType is Command and provides the reason for the event.

### 11.7.10.2. PushTransportEnd Event

This event SHALL indicate a push transport transmission has ended.

The data on this event SHALL contain the following information.

| ID | Name         | Type                      | Constraint | Quality | Fallback | Conformance |
|----|--------------|---------------------------|------------|---------|----------|-------------|
| 0  | ConnectionID | PushTransportConnectionID | 0 to 65534 |         |          | M           |

#### 11.7.10.2.1. ConnectionID Field

This field SHALL be a [PushTransportConnectionID](#) representing the push transport which stopped transmitting.

## 11.8. Chime Cluster

This cluster provides facilities to configure and play Chime sounds, such as those used in a doorbell.

### 11.8.1. Revision History

The global ClusterRevision attribute value SHALL be the highest revision number in the table below.

| Revision | Description     |
|----------|-----------------|
| 1        | Initial release |

### 11.8.2. Classification

| Hierarchy | Role        | Scope    | PICS Code |
|-----------|-------------|----------|-----------|
| Base      | Application | Endpoint | CHIME     |

Page 940







### 11.8.3. Cluster ID

| ID     | Name  |
|--------|-------|
| 0x0556 | Chime |

### 11.8.4. Data Types

#### 11.8.4.1. ChimeSoundStruct Type

This struct is used to encode information needed to define a Chime Sound.

| ID | Name           | Type   | Constraint | Quality | Fallback | Access | Conformance |
|----|----------------|--------|------------|---------|----------|--------|-------------|
| 0  | <b>ChimeID</b> | uint8  | all        |         |          |        | M           |
| 1  | <b>Name</b>    | string | 1 to 48    |         |          |        | M           |

##### 11.8.4.1.1. ChimeID Field

This field SHALL represent the unique ID for a Chime sound.

##### 11.8.4.1.2. Name Field

This field SHALL represent the unique user friendly name of the Chime Sound.

### 11.8.5. Attributes

| ID     | Name                          | Type                                | Constraint | Quality | Fallback | Access | Conformance |
|--------|-------------------------------|-------------------------------------|------------|---------|----------|--------|-------------|
| 0x0000 | <b>Installed-Chime-Sounds</b> | list[ <a href="#">Chime-Sound</a> ] | 1 to 255   | F       |          | R V    | M           |
| 0x0001 | <b>Selected-Chime</b>         | uint8                               | all        | N       |          | RW VO  | M           |
| 0x0002 | <b>Enabled</b>                | bool                                | all        | N       |          | RW VO  | M           |

##### 11.8.5.1. InstalledChimeSounds Attribute

This attribute SHALL contain all installed chime sounds, represented by a list of [Chime Sounds](#). Each entry in this list SHALL have a unique [ChimeID](#) value and a unique [Name](#) value.

##### 11.8.5.2. SelectedChime Attribute

This attribute SHALL indicate the currently selected chime sound that will be played when [Play-ChimeSound](#) is invoked and SHALL be the [ChimeID](#) value for the requested Chime Sound within [InstalledChimeSounds](#).

This attribute MAY be written by the client to request a different chime sound. An attempt to write




Page 941



a value that is not contained within [InstalledChimeSounds](#) SHALL be failed with a NOT\_FOUND response. Writes to this attribute while a chime is currently playing SHALL NOT affect the playback in progress and SHALL only apply starting at the next PlayChimeSound command invocation.

### 11.8.5.3. Enabled Attribute

This attribute SHALL indicate if chime sounds can currently be played or not, and MAY be written by the client to enable / disable playing of chime sounds.

## 11.8.6. Commands

| ID   | Name                  | Direction                      | Response | Access | Quality | Conformance |
|------|-----------------------|--------------------------------|----------|--------|---------|-------------|
| 0x00 | <b>PlayChimeSound</b> | client $\Rightarrow$<br>server | N        | O      |         | M           |

### 11.8.6.1. PlayChimeSound Command

This command will play the currently selected chime.

#### 11.8.6.1.1. Effect on Receipt

The following process SHALL be followed when the server receives this command:

- If [Enabled](#) is currently false:
  - The server SHALL immediately respond with a status code of SUCCESS, and end processing with no other side-effects.
- If a chime sound is currently being played:
  - The server SHALL immediately respond with a status code of SUCCESS, and end processing with no other side-effects.
- Play the chime sound associated with [SelectedChime](#)

Page 942



